/*! For license information please see diagram-viewer.client.a4a964cd.js.LICENSE.txt */
!function(t){var r={};function __webpack_require__(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}__webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,i){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,r){if(1&r&&(t=__webpack_require__(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)__webpack_require__.d(i,o,function(r){return t[r]}.bind(null,o));return i},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="/bundles/app/js/",__webpack_require__(__webpack_require__.s=0)}({"./chessboard/src/board/board.config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a})),i.d(r,"c",(function(){return l}));var o={getOptions:"web_user_callback_get_board_settings",getStyles:"web_themes_data_callback",updateOption:{animationType:"web_user_game_settings_email_callback_animation_type",boardStyle:"web_user_game_settings_email_callback_board_color",coordinates:"web_user_game_settings_email_callback_coordinates",darkMode:"web_user_game_settings_callback_dark_mode_toggle",highlightLegalMoves:"web_user_game_settings_email_callback_show_legal_moves_toggle",highlightMoves:"web_user_game_settings_email_callback_highlight_last_move_toggle",moveListDisplayType:"web_user_game_settings_email_callback_move_list_display_type",pieceStyle:"web_user_game_settings_email_callback_piece",playSounds:"web_user_game_settings_email_callback_sound_toggle",soundTheme:"web_user_game_settings_email_callback_sound_theme",showTimestamps:"web_user_game_settings_email_callback_show_timestamps"}},a=[{key:"0",value:null},{key:"1",value:"inside"},{key:"2",value:"outside"}],l={pieces:["real3d"],animations:["arcade","natural"]}},"./chessboard/src/board/board.helper.js":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),a=i.n(o),l=i("./node_modules/@babel/runtime/helpers/classCallCheck.js"),h=i.n(l),g=i("./node_modules/@babel/runtime/helpers/createClass.js"),y=i.n(g),_=i("./chessboard/src/board/board.config.js"),x=i("./utils/browser.js"),w=function(){function BoardHelper(){h()(this,BoardHelper)}return y()(BoardHelper,null,[{key:"getAnimationType",value:function getAnimationType(t){return"battle"===t?"default":t}},{key:"getAnimationTypes",value:function getAnimationTypes(t,r){if(!Array.isArray(t))return t;var i=a()(t),o=["battle"];return _.c.pieces.indexOf(r)>=0&&(o=o.concat(_.c.animations)),o.forEach((function(t){var r=i.findIndex((function(r){return r.code===t}));r>-1&&i.splice(r,1)})),i}},{key:"getPieceStyles",value:function getPieceStyles(t){if(!Array.isArray(t)||"IE"!==Object(x.b)().name)return t;var r=t.findIndex((function(t){return"real3d"===t.code}));return r>-1&&t.splice(r,1),t}},{key:"getCoordinatePositioning",value:function getCoordinatePositioning(t){var r=_.b.find((function(r){return[r.key,r.value].includes(t)}));return r?r.value:null}},{key:"pieceChangeRequiresRefresh",value:function pieceChangeRequiresRefresh(t,r){var i=t===r,o=_.c.pieces.indexOf(t)>-1||_.c.pieces.indexOf(r)>-1;return!i&&o}},{key:"animationChangeRequiresRefresh",value:function animationChangeRequiresRefresh(t,r){return _.c.animations.indexOf(t)>-1||_.c.animations.indexOf(r)>-1}},{key:"validateSize",value:function validateSize(t,r,i,o){var a=Math.min(t,r);return a=Math.max(a,i),a=(a=Math.floor(a/o)*o)>=i?a:a+o}}]),BoardHelper}();r.a=w},"./chessboard/src/board/board.service.js":function(t,r,i){"use strict";var o=i("./node_modules/axios/index.js"),a=i.n(o),l=i("./utils/dark-mode.ts"),h=i("./utils/router.js"),g=i("./chessboard/src/board/board.config.js"),y=i("./chessboard/src/board/board.helper.js");r.a={getDefaultOptions:function getDefaultOptions(){return{allowMarkings:!0,animationType:"default",autoPromote:!1,boardStyle:"green",captureKeyStrokes:!0,coordinates:"inside",darkMode:l.b,diagramStyle:!0,enabled:!0,highlightColor:"#f8f893",highlightLegalMoves:!1,highlightMoves:!0,highlightOpacity:.5,isWhiteOnBottom:!1,legalPositionCheck:"full",moveMethod:"drag",overlayInAnalysisMode:!0,pieceStyle:"neo",playSounds:!0,premoveHighlightColor:"#f42a32",premoveHighlightOpacity:.5,real3D:!1,rounded:!0,soundTheme:"default",showTimestamps:0}},getOptions:function getOptions(){return a.a.get(h.a.generate(g.a.getOptions)).then((function(t){return t.data})).then((function(t){return{animationType:y.a.getAnimationType(t.animationType),boardSize:t.boardSize,boardStyle:t.colorScheme,darkMode:Object(l.a)(),highlightLegalMoves:Boolean(t.highlightLegalMoves),highlightMoves:"1"===t.highlightMoves,isWhiteOnBottom:Boolean(t.isWhiteOnBottom),moveListDisplayType:t.moveListDisplayType,moveMethod:t.moveMethod,pieceStyle:t.pieceStyle,playSounds:"1"===t.playSounds,soundTheme:t.soundTheme,coordinates:y.a.getCoordinatePositioning(t.boardCoords),showTimestamps:t.showTimestamps}}))},getStyles:function getStyles(){return a.a.get(h.a.generate(g.a.getStyles)).then((function(t){return t.data}))},updateOption:function updateOption(t,r){var i=h.a.generate(g.a.updateOption[t]);return a.a.post(i,{action:r}).then((function(t){return t.data}))}}},"./chessboard/src/components/chessboard/ChessSounds/index.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return A}));var o=i("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=i.n(o),l=i("./node_modules/@babel/runtime/helpers/createClass.js"),h=i.n(l),g=i("./utils/shared/add-directive-event-listeners.helper.js"),y=window.AudioContext||window.webkitAudioContext,_=Boolean(y);function isSuspended(){return _}function resumeAudio(t){if(y){if(window.chessComAudioContext||(window.chessComAudioContext=function newAudioContext(){try{return new y}catch(t){return null}}()),!window.chessComAudioContext||!window.chessComAudioContext.resume)return _=!1,void t();window.chessComAudioContext.resume().then((function(){_=!1,t()}))}}var x=i("./utils/sound/config.js"),w=i("./utils/window/post-message.ts"),S=i("./utils/sound/get-urls.js"),M=function(){function Sound(t,r){a()(this,Sound),this.code=t,this.theme=r,this.tags=[]}return h()(Sound,[{key:"load",value:function load(){this.unload(),this.addTag()}},{key:"addTag",value:function addTag(){var t=document.createElement("audio");t.setAttribute("preload","auto"),Object(S.a)(this.code,this.theme).forEach((function(r){var i=r.split(".").pop(),o="mp3"===i?"audio/mpeg":"audio/".concat(i),a=document.createElement("source");a.setAttribute("src",r),a.setAttribute("type",o),t.appendChild(a)})),document.body.appendChild(t),t.pause&&t.pause(),this.tags.push(t)}},{key:"unload",value:function unload(){for(;this.tags.length;){var t=this.tags.shift();t.parentNode&&t.parentNode.removeChild(t)}}},{key:"play",value:function play(){var t=this.tags.find((function(t){return t.paused||t.ended}));if(!t){if(this.tags.length>=5)return;return this.addTag(),void this.play()}var r=t.play();r&&r.catch((function(){}))}}]),Sound}(),T=0,P=!1;function enableSound(){isSuspended()&&resumeAudio((function(){T=0,P=!1,Object(w.a)({key:x.c.SOUND_ENABLED}),window.$unbindSound&&window.$unbindSound()}))}function whenEnabled(t){window.addEventListener("message",(function listener(r){r&&r.data&&r.data.key===x.c.SOUND_ENABLED&&(t(),window.removeEventListener("message",listener))}))}function loadSound(t,r){var i=new M(t,r);return isSuspended()?(!function waitUserInteraction(){window.$unbindSound||Object(g.a)("Sound",window,{mousedown:enableSound,keydown:enableSound,touchstart:enableSound,touchend:enableSound})}(),whenEnabled((function(){return i.load()}))):i.load(),i}function unloadSound(t){t.unload()}var C=["game-start","game-end","capture","castle","premove","move-self","move-check","move-opponent","promote","notify","tenseconds","illegal"],A=function(){function ChessSounds(t,r){a()(this,ChessSounds),this.sounds={},this.load(t,r)}return h()(ChessSounds,[{key:"load",value:function load(t,r){var i=this,o=r;r||(o=C),o.forEach((function(r){i.sounds[r]=loadSound(r,t)}))}},{key:"play",value:function play(t){!function playSound(t){isSuspended()?!P&&T>x.b?(T=0,P=!0,Object(w.a)({key:x.c.SOUND_SUSPENDED})):P||(T++,enableSound(),whenEnabled((function(){return t.play()}))):t.play()}(this.sounds[t])}},{key:"removeAll",value:function removeAll(){Object.values(this.sounds).forEach(unloadSound),this.sounds={}}}]),ChessSounds}()},"./chessboard/src/event-hub.js":function(t,r,i){"use strict";var o=i("./node_modules/tiny-emitter/index.js"),a=i.n(o),l=i("./node_modules/vue/dist/vue.esm.js"),h=document.querySelector('[data-v3-event-emitter-migration="true"]')?new a.a:new l.default;h instanceof l.default&&(h.emit=h.$emit,h.off=h.$off,h.on=h.$on,h.once=h.$once),r.a=h},"./chessboard/src/game/api/premoves/index.js":function(t,r,i){"use strict";i.d(r,"c",(function(){return _})),i.d(r,"a",(function(){return x})),i.d(r,"b",(function(){return w}));var o=i("./chessboard/src/game/history.js"),a=i("./chessboard/src/game/game.lib.js"),l=i("./chessboard/src/game/game.premoves.lib.js"),h=i("./chessboard/src/game/state.js"),g=i("./chessboard/src/game/api/select-node.js"),y=i("./chessboard/src/game/line.js"),_=function makePremove(t,r){var i=a.a.getJCEMove(t,r);return null===i?(o.b.add(t.history,o.a.ILLEGAL_MOVE),t):y.a.isHead(t.jce._lines(),t.tree.selected)||t.settings.analysis?t.settings.analysis?void 0:(l.a.premove(t,i)?(o.b.add(t.history,o.a.PREMOVE),h.a.updateState(t)):o.b.add(t.history,o.a.ILLEGAL_MOVE),t):Object(g.a)(t,y.a.getHeadIds(t.jce._lines(),t.tree.selected.line))},x=function cancelPremoves(t){return l.a.cancelPremoves(t)&&(o.b.add(t.history,o.a.CANCEL_PREMOVES),h.a.updateState(t)),t},w=function consumePremove(t){return t.premoves.length?(l.a.consumePremove(t)?(o.b.add(t.history,o.a.MAKE_MOVE),h.a.updateState(t)):x(t),t):t}},"./chessboard/src/game/api/select-node.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return _}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./chessboard/src/game/game.lib.js"),h=i("./chessboard/src/game/line.js"),g=i("./chessboard/src/game/history.js"),y=i("./chessboard/src/game/state.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var _=function selectNode(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=h.a.findNode(t.jce._lines(),r,i,o),_=_objectSpread({},t.tree.selected),x=_.line,w=_.move;if(!a)return t;var S={};return S=r.move+i<0&&r.line===a.ids.line?{line:0,move:-1}:a.ids,l.a.selectNode(t,S),g.b.add(t.history,g.a.JUMP_TO_POSITION,{from:{line:x,move:w},to:S}),y.a.updateState(t)}},"./chessboard/src/game/api/set-hand.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a}));i("./chessboard/src/game/state.js");var o={p:1,n:32,b:256,r:2048,q:16384},a=function setHand(t,r,i){return t.jce._hand[r]=i.split("").reduce((function(t,r){return t+o[r]}),0),t.setup.hand=t.jce.hand(),t}},"./chessboard/src/game/engine/JCE.js":function(t,r,i){"use strict";var o,a,l,h=i("./node_modules/@babel/runtime/helpers/typeof.js"),g=i.n(h),y=(o=function(){var t=[[2637767806,863464769],[720845184,95069639],[1155203408,610415943],[2618685246,1655139042],[1971536997,1218186377],[848342074,540017087],[263957791,1627660921],[3896152207,4076560586],[226391645,1484086288],[436746274,3467632685],[2516964848,3797861296],[3491888988,3510251221],[1086189917,1248276018],[18044180,1876255637],[1572111136,1190386149],[597658413,2146900428],[97624494,2243205793],[1738507407,1854916977],[1950989311,2149575947],[2098318769,3283594736],[2194108574,2015279052],[4079062812,2500884588],[856979699,2941369318],[1270058469,3877737539],[2858720366,3170717948],[2378012835,1387254795],[2278688587,2178388503],[435406673,3555273441],[3031118064,1655806655],[2063925420,1107589828],[3376753832,436852829],[615148625,1302492416],[1285502018,1963045959],[346460119,1016137793],[2803604355,1176288659],[55085973,2968618255],[1669016372,4287873088],[164740250,1037634196],[896886403,883023163],[1935551383,2764331555],[410153072,4055711755],[533441746,1505690343],[3541084098,3466290517],[3214426080,4267541060],[2675233103,1951705124],[1374411850,3115986997],[1552073989,3684348154],[4244110986,875606593],[844343081,3115990494],[2356462440,135999605],[3116133511,377238503],[2129956651,2197966368],[299173332,3276914047],[1701379241,745972291],[1306570996,254977976],[2530644806,214138461],[1122123979,1667800879],[1831591130,3801192033],[1116211970,920967505],[1594837592,2551651254],[972591349,2046373768],[2479207924,1935030411],[1675376029,2367888248],[3960916618,3935874422],[1398143232,3265801671],[133930885,1520005442],[1351827834,2829577566],[2076951437,2723839804],[435980918,2364847828],[1668970368,3738157273],[2185864314,3993911799],[2041407829,31969768],[346864372,2004703094],[4047877822,3437142421],[3669961416,538399484],[616810829,4190688246],[3144558884,4030272234],[216165387,2513010905],[2761740594,3216997572],[3919406634,4096014649],[669429112,2434161727],[2234904640,3111407601],[1421079802,1598085235],[1924213810,310373675],[4002762044,2067865415],[2592451728,2586110625],[1890340057,4031717877],[4189625662,2577429954],[2276713138,3049850801],[2741429688,3310307512],[2924122950,3426712818],[421576781,1193704381],[2277442246,3030264553],[153237420,595540057],[4278711886,4176286928],[2380848297,4030514510],[2618700582,1303682185],[3018992701,185284845],[957243316,1291916363],[1543415220,1898408169],[504378001,531073412],[2591337657,1692896435],[1333852064,903543556],[1661259930,188168388],[561112646,2197961224],[1536910315,2632972300],[1349168372,2307429186],[411152329,2745631190],[1694697476,1081411140],[3755185459,2631660711],[4019355068,4027326706],[2066937809,3761668332],[3120395808,3878773315],[94890149,2109283191],[3045629038,358812277],[1249184265,3465901047],[3477490924,2308583306],[4114113436,3875911716],[1014604031,1434513279],[3991324799,2222416029],[2040431088,1539915569],[2253613964,4081224332],[2547464012,1611168627],[2722521980,4281500978],[71289574,213969824],[2450408597,903689630],[1894451515,364024012],[1939968537,374938813],[1447259295,3785468557],[4021046128,1664847745],[3139524504,3562928047],[1173487682,4065269608],[2467266804,3907744866],[4284945151,3486998177],[2925674454,1953016432],[3710671816,1271453948],[2129465869,1422863833],[587093076,18243356],[3373793513,2411305257],[2156648078,1791034213],[3737413652,1534461430],[468575139,2935304962],[1129551363,3603256834],[2861996892,1763494778],[2826449619,2465197654],[1704209531,1014895022],[3738359347,3402630390],[569410928,4095796581],[3021312909,2108247612],[2444777957,2664129360],[282063667,3773661258],[682545472,3188439005],[3318488457,1917822038],[1447622272,4045023041],[757420137,4038580915],[2613420942,4146703316],[4012836163,150381244],[2938127093,3428591704],[1208226490,3086335530],[2935205706,1446903363],[430957978,3830532479],[1381578755,3757172800],[4109399782,1596778224],[288855589,1954372339],[3169178148,2256716053],[2644780093,3895892303],[107966643,1071681559],[1304747544,2607225372],[1359190711,1898207171],[3229237120,3273634996],[3027167685,3863637628],[3011615298,2883984519],[564135827,978463264],[770797430,362326607],[1983662611,1907583229],[4153656423,48268960],[3609759233,720080177],[3727911466,1270989899],[200708787,2366086947],[744508026,393422515],[1213261630,65757284],[3485747185,3845951003],[2958861301,1680248217],[2598470344,3163845864],[2767997908,4233451722],[3881113485,1492930166],[1773764017,2764062206],[4189435844,2898689174],[4234838742,1267095035],[2624081078,3302114327],[2395569449,390426320],[1728307101,690284926],[3309827454,1118258254],[2028172868,3888829086],[4271523049,909051386],[146617804,942892565],[2467685867,974297806],[2483428231,503635829],[3743260573,2018222096],[1002067894,2289153437],[3535252974,3738302271],[4154611160,1002664952],[3623154244,2349656961],[3646679180,3524329383],[862933752,4282853607],[2806008282,3272780913],[2734037942,3828874677],[1328176304,2137666995],[2278785213,2780788825],[381286368,1816476193],[2074232908,2316293454],[4087773386,3651330956],[967884669,3728964514],[4239349185,3213509668],[419231360,1463788948],[1275421624,2672384707],[1088456595,436245261],[2365565249,783696577],[1758083333,845223583],[2048846183,3530914274],[2635948261,124738415],[940630937,3069598626],[839474029,1253439921],[902477345,165479306],[2836079689,2681188273],[2007115168,2093139645],[1363041891,1282466609],[1130479818,1063857938],[3644959908,1260430427],[1385135238,46497915],[1386975934,3110156681],[2635987502,4233461619],[1915744629,4117939016],[487743653,285736599],[2049219159,3960249250],[69242857,3908563670],[1511066720,1488527520],[215590039,1703564952],[1459430344,4184955468],[676103291,2642967214],[83799035,3182827979],[1949179493,476101251],[2593534694,1493478716],[2283504289,995211746],[1349412676,3449243940],[2954378677,1878813305],[249149717,3329151870],[1578231917,1483986052],[4135085182,890874990],[461755528,3505523909],[3669622373,634949665],[219487622,2914465301],[2825233742,3703631897],[2479105382,2935590907],[2582097898,3187672881],[1221328648,1843341402],[2140891889,3958868911],[1482849818,345750049],[751922730,3178831411],[3546542069,4036458902],[216179596,877293293],[444615341,3117393729],[2424254530,494454238],[1344234989,3003337991],[929188581,2760877801],[2507911009,1879899982],[980166547,1311840394],[3566535507,1790747461],[143525013,2311336672],[4181962471,4273938872],[1815842366,862009811],[911175674,1179575598],[3591335374,3694215714],[1452686093,3393294272],[385158879,2447709103],[4011414929,1264623507],[1448477120,911094312],[3971299641,2289992053],[3133647265,2234591563],[3007628400,964409938],[1708345684,3673411261],[3031964479,2843021794],[3022128657,2480338599],[118850112,473449293],[2048127371,3202109429],[3158349745,382018770],[1505327237,3807570472],[2568424029,3272693060],[1866609495,3888556537],[844703982,1852802964],[3504617058,682636099],[1448882679,3733580327],[821387540,2215744532],[3631471417,311618895],[2077838877,2383929020],[3352949096,1688694420],[2491080787,3998672444],[3368630402,4182204255],[983299419,2837414346],[3651215291,1033373924],[265429091,3988955082],[3019003608,2896212153],[2955948456,3025235588],[903690197,2266253487],[3925215275,89402958],[3959093811,3609545561],[2455088053,223552128],[3115011301,2133669107],[1765081558,673805649],[3324795129,2111392191],[3443871631,432345706],[3152559950,3425427147],[3699649406,672784944],[3129545774,7668664],[2747044893,173040075],[3925243406,852328481],[164095314,3161868591],[2234471571,1302682825],[2164784335,105893718],[159995093,536831360],[599199451,425051327],[3274759746,1680930461],[1192619331,3903085578],[2832721114,3078660237],[91404660,4030521531],[3044880024,1578375623],[3906596030,754177855],[803516785,1894094672],[288455592,2030430096],[2143232492,2317305324],[388352703,3406060288],[2521731420,3588403719],[1043041227,4028028525],[3195290851,2468913324],[4166724431,3168683191],[1228226538,968516529],[500177583,3444787306],[533367442,4252082053],[4236023256,657816314],[413575568,3367198397],[3435884549,3334062733],[1004255532,1135705894],[2859513268,4170618274],[3914086821,1251487871],[3080761716,3489067886],[3571165255,699353261],[773372954,3648014952],[769693293,2939128604],[3116440923,507748478],[1687629160,3739431776],[2489486648,3502376324],[3686847158,2878383449],[3530767427,902211375],[2121652637,2493976397],[1827477891,930064171],[2549918411,4029725732],[2071415163,844118802],[2236083679,3088894868],[2040110303,4144562891],[3489536313,1133419300],[2190878435,2301466071],[2465915458,2448602097],[1675766804,2073834499],[3329799896,1613253148],[1483966600,1348836071],[159505618,2527621997],[2674227354,1695130688],[2683539437,1927873839],[3833196123,2570082188],[3891433165,759819981],[1455453349,2179602430],[1430583255,1957776111],[2067726741,4235143439],[303380021,2998980439],[2136024795,3126725799],[2054591852,1051702291],[1029141665,489794361],[2317027384,569642164],[2068461795,624418658],[2499875684,1830645251],[1302894490,4319401],[1002663431,2406815191],[1560941298,2060652753],[2141002286,515773223],[3661248027,475092913],[3705503008,2419919909],[914567990,3496539911],[3462935583,2039034761],[2878378006,2379243316],[1133857586,1390159333],[3023618742,2140726761],[282908558,944874642],[3686955701,1148723903],[2604456805,4163675010],[3061545110,377179268],[3218002352,76459088],[2836503392,916455101],[536836808,151306053],[2886925079,404221671],[2936593041,2011015485],[453815187,1852163908],[3042568989,82176306],[3279635891,4174836410],[3282689058,2360003049],[4088968807,1516570623],[2680453086,1322680794],[1731693966,3438253771],[1842894553,1294307894],[2736377365,2964642609],[121205621,521330014],[2324595870,3005710757],[3784465521,676493813],[1958759409,2030833406],[1306150933,1016370058],[2636541290,482366508],[1950415745,1695073534],[322077955,3746046623],[3602873262,3829181504],[1211684447,1861645455],[504701736,4080111082],[2407799203,1223857855],[1925743434,1498920209],[3617596327,845198428],[2498480299,3484773806],[2680229135,2560201696],[3731399221,1536412390],[2756509305,2924710846],[2635957500,3459716133],[1372762539,769635894],[802677945,3878474636],[1707760534,3075809808],[3714687192,2872792173],[1615679922,1606381794],[1940556374,1337437342],[445390489,731124040],[2864974375,64601760],[1984806574,2141516710],[513390958,1890172555],[744398315,1475299139],[982749166,852662657],[652663695,4260736510],[1184061125,82616221],[3363191899,147951756],[1064069880,1507328085],[2138882964,547595589],[2616926846,3186935246],[2298715513,3606862940],[2414381911,811477686],[2694745228,900437726],[4202576185,2201114451],[3602305260,3323446937],[3756663274,2658490339],[3061587876,2171079416],[3390977925,2850497765],[486312941,224925241],[3515712841,3510684394],[1322319486,2647200565],[3839619171,1148450258],[392296762,1154854654],[1401523788,957405781],[1934485528,527352730],[645968162,3131215255],[696971825,3361451947],[2038689491,1946699733],[1723966113,2785859721],[2652365974,1118037185],[3988018407,3134982149],[1354171594,3053634345],[1287854075,2631782435],[1723106141,2662328866],[563845090,1878819261],[639520332,171129501],[534957223,1696062352],[3612364282,2283204027],[3109494688,1304463816],[500957989,630925278],[3477030536,2149497258],[4109750364,281719363],[951472732,564407054],[922095147,2767874048],[3946156928,829677774],[2622281253,2086286851],[2936811901,850242186],[630086272,3340782667],[2340986210,1296336989],[4107355543,3865114709],[3560210278,3968418243],[3868847493,2967450637],[611513888,2083325060],[3265390517,3025776309],[2874106961,3424470508],[1668707698,2923258228],[2778598353,24320552],[292356118,3415510793],[754567370,86994591],[185141877,1621715171],[2884558258,3722473457],[1492107531,111281805],[3336927864,4225337056],[782994598,1021838039],[346133860,18281270],[2080909533,1649329040],[3612065399,3859901127],[2151962287,284556115],[3957975594,3745718727],[52533817,3998775856],[1232633839,397383972],[2716413964,3629253960],[1531307298,3836851439],[3030137657,2500401718],[3561556693,653345841],[313061910,2945718466],[2065276,3342140708],[410498334,1470588117],[2726640512,4051654894],[2570984935,758567696],[3008987264,3462702678],[623860175,228525243],[3527183895,1829844480],[467272850,3890501742],[568376656,650516927],[990477018,4035508558],[2366955227,817792110],[4183621538,989198068],[946958343,1639184195],[3395758993,3924097558],[1690887473,3220519765],[605184237,1255270525],[275515833,1926424610],[2142902612,283494960],[2021972412,1823828440],[105373677,3448326697],[1666662384,1042433908],[1338566998,261206307],[498685668,1344755577],[3101233780,3119109371],[2733370951,3808165089],[3656512268,3449289481],[4025308119,1607880299],[778896067,1612183167],[2846510368,3674754715],[3058428120,2991822529],[1892379383,3268787440],[2565895844,4154602030],[3213117192,98999135],[2495816991,116985075],[1040203361,1785041385],[3106252493,69316595],[1639829808,2087117568],[3213709576,3799911752],[604681594,2340981536],[4236730699,2938666503],[4009938384,1878897714],[2701667332,1725918218],[2182473079,1258184],[3550198211,2760750799],[657991062,875584532],[1640976276,3380476221],[460041378,2924352091],[1972323596,2287414795],[2510248061,1350206297],[2959337826,3762681165],[1625877874,3235902929],[2070189957,1429368735],[4245163299,1839731898],[2358312347,138364248],[275739390,2179122576],[2037777210,972544338],[2766930226,1984733259],[1933485829,4209310327],[3034118011,3286589799],[2653025529,62078937],[2641780289,2679545709],[3540781195,2787026415],[1569993599,3215949659],[441337890,3947723353],[1878946792,459505587],[3724105660,920173002],[1691411102,3934795955],[148741087,3647709027],[142506469,2776440083],[3811107376,3823285243],[472209891,252266174],[1913386482,1867329194],[2960608550,482740699],[1145005292,1513558421],[1091751784,1687823886],[3625186042,3086337482],[1712140887,940065262],[1504455800,1945702563],[3896940088,2003245591],[2478191531,4197739e3],[3233871270,250924495],[3404865229,1131917964],[1462204167,429621621],[1349259705,3641608989],[3627860584,2048468319],[1244251718,1513180369],[3979211282,371413143],[3043187861,4285699810],[581894202,3060983825],[1390895705,1811317301],[2599134010,3337406128],[2488233440,2436161462],[1816641224,2208816697],[1792034756,815866116],[2779893723,2695577703],[2084952115,2951772258],[1351806869,169269771],[2469979804,86740603],[1163545420,4264616949],[1795352113,2511146232],[1796715044,3134635815],[3521170642,1538900329],[3725363621,1455009392],[1342594643,1512127734],[2618386938,662157428],[2028859350,2494504685],[1841905045,648351336],[4002935891,4033319405],[850071259,1768358867],[979915719,3876018087],[830889197,1629549437],[1744763229,2455795856],[522919199,368499868],[3063822504,2522639205],[2861636095,407686388],[4097602344,1945259027],[4215946617,1251639506],[894485042,534122652],[924809191,1807237502],[1811585710,1589663609],[3439653887,1722232],[3810997538,105152714],[2677100683,4291805514],[77233985,102407776],[4239834691,2851274395],[148802076,2006440603],[2409138150,126301601],[3048474397,3217504870],[588133437,4221603123],[1139638106,263087485],[982032635,3165674595],[562514827,1294842959],[467575086,905357513],[1405117894,3370530088],[3813285157,242912619],[3601878331,1985076606],[1586505598,2092146221],[738488098,103663229],[2970334297,321718822],[1068097019,1742926233],[235518094,420804527],[283685722,4092504887],[2666392744,3799169331],[3569817788,1256762975],[2169728352,292617248],[2444571896,2239859206],[3967907832,1066404216],[420376911,2913277294],[3046293305,2956347747],[2311278792,2477686209],[2885955184,4172514290],[3030078181,2275536480],[4212469731,4280736393],[1046900335,1773022229],[995380926,1414273529],[3892683234,2429494358],[615726237,2127712535],[3880203074,2071130305],[176180504,3070850165],[1474506861,2283723599],[1256707747,1857412043],[764236850,359687368],[3521530334,511649419],[2318567964,3992868140],[128167623,2518992858],[2220129756,1042300052],[2567608573,1349636707],[441446694,384760969],[4143447316,829506048],[817912603,2738025500],[2368091832,357934982],[1187643061,1561463042],[3438021235,3030161697],[1318922279,895468690],[434876457,1130220303],[1180291767,1132759596],[2520707785,1798553137],[1962430872,2958700157],[1510954061,3534879512],[57831539,3269538993],[3354831405,3852135009],[891783098,2698494511],[2555636406,996018997],[2881342935,3982231648],[3473267445,2894952368],[1238029452,3958679326],[2051805420,559465638],[3655936674,1186951582],[330209165,167662935],[1929681327,2450868735],[1313566811,2458925988],[4283920930,3243182650],[1438004300,4185567150],[3093439067,89876832],[3401620219,3721579956],[3673745794,2682874719],[3053321309,825410712],[822915968,3681514755],[3900685126,561657358],[553823814,1857753416],[4166295066,983949325],[128359165,3426887194],[3300989119,3884968622],[4193552686,3647722552],[452189154,1569670618],[4122259632,3537825460],[2519387887,2821594244],[74333898,2940550377],[4032631446,2173999692],[2521268686,1934310532],[2620314688,2177785789],[1378755571,2455646622],[394133753,4231198609],[734399075,2800989170],[573292462,1634883078],[1214417373,3426576256],[2110224475,2399009920],[2331215665,3224086912],[531326186,698539511],[3839443603,583861850],[2644531398,2017784332],[616620850,3070237104],[590349237,2798642861],[3582377217,3317831670],[1582708616,1596570667],[2126148205,2358511947],[173450736,3219362418],[3616831144,1323437318],[2655785577,3131359031],[401600069,2967397952],[496349349,4244179910],[2479612086,2579650653],[1710903074,2049666425],[3589924952,690291925],[3266682943,1900485231],[1496318498,3025542656],[3459221058,3389461212],[2091479615,3140389256],[663040899,1207089672],[3323704225,1105530508],[353318429,2879253542],[2674540957,941987316],[1688550857,620657353],[338551967,4286217277],[204689992,2239736295],[178008789,3940832005],[3871613304,3300636974],[1911672356,2429684487],[4055679954,1974461722],[3878217928,1009991796],[2533095482,310920740],[2174833823,3596041637],[1604814460,2939543881],[1452830254,4092397851],[2441027029,4169690209],[3524103304,3372213855]],r=[[836181454,1689436944],[2776523577,3710710688],[4049974663,3750330768],[519497435,2979405513]],i=[[1892447193,197291556],[3793382197,3742120663],[3838936,2994760034],[479846099,1018728609],[3476112862,182272649],[3504620154,1427438450],[2009473484,2679350403],[1738755500,1129731339]],o=[4174784170,2938602761],a={p:0,P:1,n:2,N:3,b:4,B:5,r:6,R:7,q:8,Q:9,k:10,K:11},l=[];l[5]=1,l[6]=0,l[9]=3,l[10]=2,l[17]=5,l[18]=4,l[33]=7,l[34]=6,l[65]=9,l[66]=8,l[129]=11,l[130]=10;var h,g=[2,5,10,20,40,80,160,64],y=["","0000000","000000","00000","0000","000","00","0",""];function to32BitHex(t){var r=t.toString(16);return y[r.length]+r}function to64BitHex(t){return to32BitHex(t[0])+to32BitHex(t[1])}function hash(l,h){var y,_,x,w,S,M,T,P,C,A,O,L,I=l.split(" "),R=I[0].split("/"),j="w"===I[1],N=0,k=Number(j),D=k?3:4;for(x=7;x>=0;x-=1)for(w=0,T=(S=R[x]).length,M=0;M<T;M+=1)P=S[M],(O=a[P])>=0&&(y=(y^(C=t[64*O+8*(7-x)+w])[0])>>>0,_=(_^C[1])>>>0,O===k&&x===D&&(N|=1<<w)),w+=Number(P)||1;return"-"!==I[2]&&((A=I[2]).indexOf("K")>-1&&(y=(y^(C=r[0])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("Q")>-1&&(y=(y^(C=r[2])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("k")>-1&&(y=(y^(C=r[1])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("q")>-1&&(y=(y^(C=r[3])[0])>>>0,_=(_^C[1])>>>0)),I[3]&&"-"!==I[3]&&(L=I[3].charCodeAt(0)-97,g[L]&N&&(y=(y^(C=i[L])[0])>>>0,_=(_^C[1])>>>0)),j&&(y=(y^o[0])>>>0,_=(_^o[1])>>>0),h&&"hex"===h?to64BitHex([y,_]):[y,_]}function wrap(t){var r,i,o,a,l={};function parseBook(t,r){var o,a,l,h,g,y,_=i.getUint16(t+8),x=i.getUint16(t+10);return a=_>>9&7,h=_>>3&7,g=7&_,y=_>>12&7,4==(l=_>>6&7)&&r&&a===h&&"-"!==r&&(7===g&&(0===a&&r.indexOf("K")>-1||7===a&&r.indexOf("k")>-1)?g-=1:0===g&&(0===a&&r.indexOf("Q")>-1||7===a&&r.indexOf("q")>-1)&&(g+=2)),o=String.fromCharCode(l+97)+(a+1)+String.fromCharCode(g+97)+(h+1),y&&(o+="nbrq"[y-1]),{move:o,weight:x}}function query(t){return"string"==typeof t&&(t={fen:t}),r(t)}if(l={query:query,pick:function pick(t){var r,i,o,a,l,h=0;if(function sortMoves(t){t.sort((function sorter(t,r){return r.weight-t.weight}))}(r=(t=t||{}).moves||query(t)),o=r.length){if(t.type&&1!==o&&"best"!==t.type){if("random"===t.type){for(a=Math.floor(Math.random()*r.sum)+1,l=0;l<o-1&&!(a<=(h+=r[l].weight));l+=1);return r[l].move}return"randomDisregardWeight"===t.type?r[Math.floor(Math.random()*o)].move:"worst"===t.type?r[o-1].move:((i=parseInt(t.type)||1)<0&&(i=o+i+1),i<1?i=1:i>o&&(i=o),r[i-1].move)}return r[0].move}}},t.getUint32)r=function bufferBookFind(t){var r,o,a,l,h,g=i.length||i.byteLength||0,y=t.offset||0,_=t.fen,x=t.chess960,w=t.checkAll,S=[],M=0;for(t.hash?"string"==typeof(r=t.hash)&&(r=function hex64ToDec(t){return[parseInt(t.substr(0,8),16),parseInt(t.substr(8),16)]}(r)):r=hash(_),!x&&_&&(h=_.split(" ")[2]),y=0;y<g;y+=16)if(i.getUint32(y)===r[0]&&i.getUint32(y+4)===r[1])a=parseBook(y,h),S[S.length]=a,M+=a.weight,o=!0;else if(o&&!w)break;if(S.sum=M,t.relative)for(l=S.length-1;l>=0;l-=1)S[l].relative=Math.round(S[l].weight/M*1e4);return S},i=t,l.buffer=i;else for(a in r=function jsonBookFind(t){var r,i,a,h,g,y,_=0,x=t.fen;if(l.useFen)a=x.replace(/ \d+ \d+$/,""),(r=o[a])||(h=a.replace(/[a-h][1-8]$/,"-"))!==a&&(r=o[h]);else if(t.hash||(t.hash=hash(x,"hex")),r=o[t.hash]){if(r[0]&&r[0].n&&(r=r[0]),r.n&&!r.b)return[];if(r.b)r=function decompressMoves(t){var r,i=[],o=t.b.length;for(r=0;r<o;++r)i.push({move:t.b[r],weight:t.w[r]});return i}(r);else if(!t.chess960&&x)for(y=x.split(" ")[2],i=r.length-1;i>=0;i-=1)(g=r[i].move.match(/e([18])([ah])\1/))&&("h"===g[2]&&("1"===g[1]&&y.indexOf("K")>-1||"8"===g[1]&&y.indexOf("k")>-1)?r[i]={move:"e"+g[1]+"g"+g[1],weight:r[i].weight}:"a"===g[2]&&("1"===g[1]&&y.indexOf("Q")>-1||"8"===g[1]&&y.indexOf("q")>-1)&&(r[i]={move:"e"+g[1]+"c"+g[1],weight:r[i].weight}))}if(r)for(i=r.length-1;i>=0;i-=1)_+=Number(r[i].weight);else r=[];return r.sum=_,r},o=t,l.json=o,o){l.useFen=a.indexOf(" ")>-1;break}return l}function getBook(t,r){!function ajaxLoad(t,r){var i=new XMLHttpRequest,o=t.toLowerCase().indexOf(".json")>-1;function onload(){var t;if(i.status>=200&&i.status<300||304===i.status||0===i.status||1223===i.status)if(o)try{r(null,JSON.parse(i.response))}catch(a){r(a)}else t=new DataView(i.response),r(null,t);else r(new Error("Error code: "+i.status))}i.open("GET",t,!0),o||(i.responseType="arraybuffer"),i.onload=onload,i.onerror=onload,i.send()}(t,(function onload(t,i){var o;if(i&&(o=wrap(i)),r)return r(t,o);if(t)throw t;return o}))}return{hash:hash,loadBook:(h={},function loadBook(t,r){h[t]?h[t].book?setTimeout((function(){r(null,h[t].book)}),0):h[t].cbs.push(r):(h[t]={cbs:[r]},getBook(t,(function onload(r,i){var o=h[t].cbs;r?delete h[t]:(h[t].book=i,h[t].cbs=void 0),o.forEach((function(t){setTimeout((function(){t(r,i)}),0)}))})))}),to64BitHex:to64BitHex,zobristPiece:t,zobristCastle:r,zobristEnPassant:i,zobristTurn:o,zobristPieceValue:a,zobristPieceValueNumbers:l}}(),a=function init(){var t,r,i,a,l={Chess:0,Chess960:1,Crazyhouse:2,"3-check":3,"King of the Hill":4,Bughouse:5,chess960:1,Fischerandom:1,fischerandom:1,crazyhouse:2,"three-check":3,kingofthehill:4,koth:4,bughouse:5},h=["Chess","Chess960","Crazyhouse","3-check","King of the Hill","Bughouse"],y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=0,S=0,M=0,T=-1,P=32,C=128,A=252,O=255,L=512,I=112,R=14,j=21,N=127,k="pnbrqkPNBRQK",D="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",B=[];B[5]=[-16,-17,-15],B[6]=[16,17,15],B[8]=[-18,-33,-31,-14,18,33,31,14],B[16]=[-17,-15,17,15],B[32]=[-16,1,16,-1],B[64]=[-17,-16,-15,1,17,16,15,-1],B[128]=[-17,-16,-15,1,17,16,15,-1];var G={P:5,p:6,N:9,n:10,B:17,b:18,R:33,r:34,Q:65,q:66,K:129,k:130},H={P:4,p:4,N:8,n:8,B:16,b:16,R:32,r:32,Q:64,q:64,K:128,k:128},V={5:"P",6:"p",9:"N",10:"n",17:"B",18:"b",33:"R",34:"r",65:"Q",66:"q",129:"K",130:"k"},U={9:"N",10:"N",17:"B",18:"B",33:"R",34:"R",65:"Q",66:"Q",129:"K",130:"K"},z=[80,0,0,0,0,0,0,96,0,0,0,0,0,0,80,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,96,96,96,96,96,96,224,0,224,96,96,96,96,96,96,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,80,0,0,0,0,0,0,96,0,0,0,0,0,0,80],W=[336,80,80,0,0,0,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,360,508,252,0,252,508,360,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,0,0,0,80,80,336],q=[336,80,80,0,0,0,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,360,508,252,0,252,508,488,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,96,0,0,80,80,336],$=[336,80,80,0,0,96,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,488,508,252,0,252,508,360,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,0,0,0,80,80,336],X=[336,80,80,0,0,96,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,488,508,252,0,252,508,488,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,96,0,0,80,80,336],K=[336,80,80,112,112,112,96,352,96,96,112,112,112,80,336,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,352,352,480,480,488,508,252,0,252,508,488,480,480,480,352,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,336,80,80,112,112,112,96,352,96,96,112,112,112,80,336],Y=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,33,16,31,15,0,0,0,0,0,0,0,0,0,0,0,18,17,16,15,14,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,-14,-15,-16,-17,-18,0,0,0,0,0,0,0,0,0,0,0,-15,-31,-16,-33,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Z=[0,5,8,11,14],Q=[31,7,7,7,63],J={P:0,p:0,N:5,n:5,B:8,b:8,R:11,r:11,Q:14,q:14},ee=[4,8,16,P,64],te=["","N","B","R","Q"],ne={CAPTURE:1,BIG_PAWN:2,EP_CAPTURE:4,ANY_CAPTURE:5,PROMOTION:8,KSIDE_CASTLE:16,QSIDE_CASTLE:32,KQSIDE_CASTLE:48,DROP:64,DROP_OR_PROMOTE:72},re=[0,6,1],ie={K:119,Q:112,k:7,q:0,A:112,B:113,C:114,D:115,E:116,F:117,G:118,H:119,a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},oe=["Event","Site","Date","Round","White","Black","Result"],ae=["Event","Site","Date","Round","White","Black","Result","Variant","SetUp","FEN","WhiteA","WhiteB","BlackA","BlackB"];function rank(t){return t>>4}function file(t){return 7&t}function algebraic(t){return String.fromCharCode(file(t)+97)+(8-rank(t))}function swapColor(t){return 3-t}function hashNum(t,r){t[0]=(t[0]^r[0])>>>0,t[1]=(t[1]^r[1])>>>0}function completeFen(t){var r,i;return(r=[""," w - - 0 1"," - - 0 1"," - 0 1"," 0 1"," 1"][(i=(t=t.trim()).split(" ")).length])&&t?t+=r:"0"===i[5]&&(i[5]=1,t=i.join(" ")),t}function createVariantZobristNumbers(){o.zobristCheck=[[441249556,340005552],[1040760204,311043682],[1621584863,1749286446],[1006868636,1625552915],[1953853171,24921145],[161251506,1935545265]]}function validateFen(t,r){var i,o,a,h,g,y,_,x,w,S,M,T,P,C,A,O,L,I,R,j,N=/^(?:[A-H]{1,2}[a-h]{0,2}|[A-H]{0,2}[a-h]{1,2}|KQ?k?q?|Qk?q?|kq?|q|-)$/,D=1*r===l.Crazyhouse||l[r]===l.Crazyhouse||1*r===l.Bughouse||l[r]===l.Bughouse,B=0,G=0,H=!0,V="",U={0:0,7:0},z={0:0,7:0},W={0:"k",7:"K"},q={0:"r",7:"R"},$=1*r===l.Chess960||l[r]===l.Chess960;if(!t)return 1;if((1*r===l.Bughouse||l[r]===l.Bughouse)&&2===(g=t.split(" | ")).length)return 0===(y=validateFen(g[0],r))&&(y=validateFen(g[1],r)),y;if(g=t.split(/\s+/),(1*r===l["3-check"]||l[r]===l["3-check"])&&7===g.length&&(h=g.pop(),!/^\+[0-3]\+[0-3]$/.test(h)||"+3+3"===h))return 14;if(6!==g.length)return 1;if(/\D|.{7,}|^0|^$/.test(g[5]))return 2;if(/\D|.{7,}|^0.|^$/.test(g[4]))return 3;if(!/^(?:-|[abcdefgh][36])$/.test(g[3]))return 4;if(S=g[2],$){if(!N.test(S))return 12}else if(!/^(?:KQ?k?q?|Qk?q?|kq?|q|-)$/.test(S)){if(void 0!==r||!N.test(S))return 5;$=!0}if("w"!==g[1]&&"b"!==g[1])return 6;if(D&&(g[0]=g[0].replace(/~(?=.*\/)/g,"")),o=g[0].split("/"),D&&9===o.length&&(h=o.pop(),!/^[pnbrq]{0,63}$/i.test(h)))return 13;if(8!==o.length)return 7;if("3"===g[3][1]&&"w"===g[1]||"6"===g[3][1]&&"b"===g[1])return 11;for("-"!==g[3]&&(_=4==(G="3"===g[3][1]?4:3)?5:2,B=g[3].charCodeAt(0)-97,H=!1,V=4===G?"P":"p"),i=0;i<o.length;++i){for(I=0,R=!1,j=0;j<o[i].length;j++)if(+(a=o[i][j])==+a){if(R)return 8;I+=1*a,R=!0}else{if(-1===k.indexOf(a))return 9;if(H||G!==i||B!==I||V!==a||(H=!0),_===i&&B===I)return 11;i%7==0&&(a===W[i]?z[i]=1<<I:a===q[i]&&(U[i]|=1<<I)),++I,R=!1}if(8!==I)return 10}if(!H)return 11;if("-"!==S)if($)for(T={0:0,1:0,2:252,4:248,8:240,16:224,32:192,64:128,128:0},M={0:0,1:0,2:1,4:3,8:7,16:15,32:31,64:63,128:0},L={0:[0,0],7:[0,0]},i=S.length-1;i>=0;--i){if(A=S.charCodeAt(i),O&&O>A&&O-A<8)return 15;if(75===A?P=U[C=7]&T[z[C]]:81===A?P=U[C=7]&M[z[C]]:107===A?P=U[C=0]&T[z[C]]:113===A?P=U[C=0]&M[z[C]]:(P=1<<A-((C=A>=97?0:7)?65:97),O=A),!P||0!=(P&P-1))return 15;if(z[C]<2||z[C]>64||(P&U[C])!==P)return 15;if(++L[C][1*(z[C]<P)]>1)return 15}else{if((x=(S.indexOf("K")>-1?128:0)|(S.indexOf("Q")>-1?1:0))&&(16!==z[7]||(x&U[7])!==x))return 15;if((w=(S.indexOf("k")>-1?128:0)|(S.indexOf("q")>-1?1:0))&&(16!==z[0]||(w&U[0])!==w))return 15}return 0}function handToString(t,r){var i,o,a="",l=0,h=r?6:0;if(t)for(;l<5;){for(i=t>>Z[l]&Q[l],o=0;o<i;++o)a+=k[l+h];++l}return a}function hashEP(t,r,i,a){t[i+1]!==a&&t[i-1]!==a||hashNum(r,o.zobristEnPassant[file(i)])}function addPawnMove(t,i,o){var a;(0===r||2&_[i])&&(rank(i)%7==0?(a=o|ne.PROMOTION|t<<7|i<<R,x[S++]=8388608|a,x[S++]=6291456|a,x[S++]=4194304|a,x[S++]=2097152|a):x[S++]=o|t<<7|i<<R)}function kingOfTheHillWin(t){switch(t){case 67:case 68:case 51:case 52:return!0}return!1}function canCastle960(t,r,i,o){var a,l,h,g=r+(i-r%8),y=i>r%8?1:-1;for(h=r+y;h!==g;h+=y)if(t[h])return!1;if(l=(a=1===o?1===y?118:114:1===y?6:2)-y,_[a]||t[a]&&a!==r&&a!==g||t[l]&&l!==r&&l!==g)return!1;if(a!==r)for(h=r+(y=a>r?1:-1);h!==a;h+=y)if(h!==g&&t[h]||_[h])return!1;return!0}var se=function(){function createLine(t,r,i,o,a,h){var g,y,_,x,w,S,M,T,P,C,A,O,L=[],I="",R=!0,j=r[i],N=j.length,k="";if(j.commands&&!h)for(w in j.commands)k+="[%"+w+" "+j.commands[w]+"]";for(j.initComment&&(k=(k+" "+j.initComment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),k&&L.push("{"+k+"}"),_=0;_<N;++_){if(M=1===(y=j[_]).color,I="",k="",g=y.commands,o!==l.Bughouse?(R&&!M?I=t+"...":M&&(I=t+"."),a&&(M||R)&&(I+=" ")):(L.bughouseOrder||(L.bughouseOrder=[]),L.bughouseOrder.push(y.bughouseOrder),_||(L.blackCountOffset=2===j[0].color?1:0)),I+=y.san,y.annotation&&(I+=y.annotation),y.additionalAnnotation&&(I+=" "+y.additionalAnnotation.join(" ")),R=!1,void 0===y.time||g||(g={clk:(C=y.time,A=void 0,O=void 0,A=Math.floor(C%36e3/600),O=Math.floor(C%36e3%600)/10,Math.floor(C/36e3)+":"+(A<10?"0":"")+A+":"+(O<10?"0":"")+O)}),g&&!h)for(w in g)k+="[%"+w+" "+g[w]+"]";if(y.comment&&(k=(k+" "+y.comment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),k&&(I+=" {"+k+"}",R=!0),L.push(I),y.lines)for(T=y.lines.length,x=0;x<T;++x)r[P=y.lines[x]].length&&((S=createLine(t,r,P,o,a,h))[0]="("+S[0],S[S.length-1]+=")",L=L.concat(S),R=!0);M||t++}return L}function createHeader(t,r){return"["+t+' "'+String(r).replace(/(\"|\\)/g,"\\$1")+'"]'}return function generatePgn(t,r,i,o,a,h){var g,y,_="string"==typeof t.newline?t.newline:"\n",x=void 0===t.spaceAfterPeriods||t.spaceAfterPeriods,w="";for(g in w+=createHeader("Event",r.Event)+_,w+=createHeader("Site",r.Site)+_,w+=createHeader("Date",r.Date)+_,w+=createHeader("Round",r.Round)+_,a===l.Bughouse?(w+=createHeader("WhiteA",r.WhiteA||"?")+_,w+=createHeader("BlackA",r.BlackA||"?")+_,w+=createHeader("WhiteB",r.WhiteB||"?")+_,w+=createHeader("BlackB",r.BlackB||"?")+_):(w+=createHeader("White",r.White)+_,w+=createHeader("Black",r.Black)+_),w+=createHeader("Result",r.Result)+_,a&&(w+=createHeader("Variant",r.Variant)+_),r.FEN&&r.FEN!==D&&(w+=createHeader("SetUp","1")+_,w+=createHeader("FEN",r.FEN)+_),r)-1===ae.indexOf(g)&&(w+=createHeader(g,r[g])+_);if(w+=_,y=createLine(o,i,0,a,x,t.hideCommands),a===l.Bughouse){if(h.isDependent)return y;y=function makeBugHousePgn(t,r,i){var o=r,a=t.siblingGame.pgn(),l=0,h=0,g=[];for(r.bughouseOrder=r.bughouseOrder||[],a.bughouseOrder=a.bughouseOrder||[];r.bughouseOrder.length||a.bughouseOrder.length;)!r.bughouseOrder.length||a.bughouseOrder.length&&r.bughouseOrder[0]>a.bughouseOrder[0]?(a.bughouseOrder.shift(),g.push("B")):(r.bughouseOrder.shift(),g.push("A"));return r=[],g.forEach((function(g){var y,_,x,w="";"A"===g?(y=o,_=++l,x=t.startingMoveNumber()):(y=a,_=++h,x=t.siblingGame.startingMoveNumber()),w=String(Math.floor((_+1)/2)+x-1),(y.blackCountOffset+_)%2?w+=g:w+=g.toLowerCase(),w+="."+(i?" ":"")+y.shift(),r.push(w)})),r}(h,y,x)}return y.push(r.Result),w+function wordWrap(t,r,i){return r<1?t:(r="number"==typeof r?r:80,t.replace(new RegExp("(.{1,"+r+"})(?: |$|\r?\n)","g"),"$1"+i).slice(0,-i.length))}(y.join(" "),t.maxWidth,_)}}(),ce=function(){var t="!?‼⁇⁉⁈□∇Δ∞⩲⩱±∓⨀⟳→↑⇆∆⌓⇔⇗⟫⟪✕⊥⊕○⇄↻⊙~",r=/\[%(\S+)\s([^\]]+)\]/,i=/^(?:[+=~\/\-\u2212]+|T?N|RR|D)$/;function extractCommands(t){var i,o,a={};do{(i=r.exec(t.value))&&(o=!0,t.value=t.value.replace(i[0],"").trim(),a[i[1]]=i[2])}while(i);o&&(t.commands=a)}function isSplitGame(t,r,i){for(var o;++r<i;)if(o=t[r].match(/^\s*(\S+)/))return/^(?:\[|1(?:\.|$))/.test(o[1])}return function tokenize(r,o){var a,l,h,g,y,_,x,w="tags",S=[],M={type:w,value:""},T=0,P=[],C=!0;for(o=o||{},g=(a=r.split(/\r?\n/)).length,l=0;l<g;++l)if("%"!==(h=a[l].trim())[0])if(h){if(_=(h=" "+h+" ").length,y=0,C)for(;y<_;++y)if(x=h[y],"tags"===w){if("["===x)M={type:w="tagName",value:""};else if(x.trim()){M={type:w="san",value:""},C=!1;break}}else if("tagName"===w)M.value&&""===x.trim()?(S.push(M),w="tagValueStart"):" "!==x&&(M.value+=x);else if("tagValueStart"===w){if('"'===x||"“"===x)M={type:w="tagValue",value:""};else if(x.trim())return!1}else if("tagValue"===w)'"'===x||"”"===x?(S.push(M),"]"===h[y+1]?(M={type:w="tags",value:""},++y):w="tagEnd"):("\\"===x&&y+2<_&&(x=h[++y]),y>0&&(M.value+=x));else if("]"===x)M={type:w="tags",value:""};else if(x.trim())return!1;for(;y<_;++y)if(x=h[y],"san"===w)if(t.indexOf(x)>-1)"!"===x||"?"===x||t.indexOf(x)<6&&(x=["!!","??","!?","?!"][t.indexOf(x)-2])?(M.value&&S.push(M),M={type:"a",value:x},"!"!==h[y+1]&&"?"!==h[y+1]||(M.value+=h[++y]),S.push(M),M={type:"san",value:""}):("∞"===x&&"=/"===M.value?(M.type="aa",M.value+=x):(M.value&&(i.test(M.value)&&("--"!==M.value||o.rejectNullMoves)&&(M.type="aa"),S.push(M)),M={type:"aa",value:x},"↑"===x&&"↑"===h[y+1]&&(M.value="↻",++y)),S.push(M),M={type:"san",value:""});else if(" "===x||"\t"===x||"\n"===x||"\r"===x||"{"===x||"("===x||")"===x){if(M.value){if("$"===M.value[0])M.type="nag";else if("*"===M.value||"1-0"===M.value||"0-1"===M.value||"1/2-1/2"===M.value||"½-½"===M.value){if(y+1<_)return!1;M.type="result","½-½"===M.value&&(M.value="1/2-1/2")}i.test(M.value)&&("--"!==M.value||o.rejectNullMoves)&&(M.type="aa"),S.push(M),M={type:w,value:""}}if(" "===x||"\t"===x||"\n"===x||"\r"===x)w="san";else if("{"===x)w="comment";else if("("===x)w="san",S.push({type:"variationStart",value:++T});else if(S.push({type:"variationEnd",value:T}),w="san",!T--)return!1;M.type=w}else if("."===x||!M.value&&+x==+x&&"-"!==h[y+1]&&"/"!==h[y+1]){if(+x==+x)switch(M.number||(M.number=""),M.number+=x,h[y+1]){case"A":case"a":case"B":case"b":M.number+=h[++y],S.push({type:"number",value:M.number}),delete M.number}}else M.value+=x;else 0===y&&(M.value=M.value.trim()),"}"!==x?("\\"===x&&y+2<_&&(x=h[++y]),M.value+=x):(M.value=M.value.trim(),M.value.indexOf("[")>-1&&extractCommands(M),S.push(M),M={type:w="san",value:""})}else"tags"===w?(w="san",C=!1):"comment"!==w&&"tagValueStart"!==w&&!T&&S.length&&isSplitGame(a,l,g)&&("tagValue"!==S[S.length-1].type&&(P.push(S),S=[]),w="tags",C=!0);return P.push(S),P}}();function Chess(ae,le){var ue,de,he=0,pe=!0,fe=[],me=1,ge=[],ve=T,ye=0,be=1,_e=1,xe=[],we=[xe],Se=0;xe.id=Se;var Me={},Ee=[],Te=!1,Pe=!1,Ce=makeMoveChess;function hashPosition(){var t,r,i,a=1===me?[4174784170,2938602761]:[0,0];for(i=0;i<120;++i)136&i&&(i+=8),(t=de[i])&&hashNum(a,o.zobristPiece[64*o.zobristPieceValueNumbers[t&O]+8*(7-rank(i))+file(i)]);if(Pe)for(r=1;r<3;++r)ge[r]&&(0!=(ge[r]&ge[r]-1)?(hashNum(a,o.zobristCastle[r-1]),hashNum(a,o.zobristCastle[r+1])):ge[r]>1<<file(fe[r])?hashNum(a,o.zobristCastle[r-1]):hashNum(a,o.zobristCastle[r+1]));else{for(r=1;r<3;++r)ge[r]&&(ge[r]&ne.KSIDE_CASTLE&&hashNum(a,o.zobristCastle[r-1]),ge[r]&ne.QSIDE_CASTLE&&hashNum(a,o.zobristCastle[r+1]));Te?function hashHand(t,r){var i,a,l,h,g,y,_,x=0;for(i=1;i<3;++i){if(a=r[i])for(l=0;l<5;){for(g=x+63*l,h=a>>Z[l]&Q[l],y=0;y<h;++y)hashNum(t,[31*(_=o.zobristPiece[g++])[0]>>>0,17*_[1]>>>0]);++l}x=315}}(a,ue._hand):he===l["3-check"]&&function hash3Check(t,r){r[1]&&hashNum(t,o.zobristCheck[r[1]-1]),r[2]&&hashNum(t,o.zobristCheck[r[2]+2])}(a,Ee)}return ve!==T&&hashEP(de,a,ve+(1===me?16:-16),4|me),a}function getCurrentHash(){var t;return xe.length?t=xe[xe.length-1].hash:(xe.hash||(xe.hash=hashPosition()),t=xe.hash),[t[0],t[1]]}function setVariant(t,r){he!==(he=t?l[t]||1*t||l[String(t).replace(/ /g,"").toLowerCase()]||l.Chess:0)&&(he===l.Bughouse?(Te=!0,ue.isDependent||(ue.siblingGame=Chess(),ue.siblingGame.hashing(pe),ue.siblingGame.isDependent=!0,ue.siblingGame.siblingGame=ue,ue.siblingGame.header({Variant:"Bughouse"})),createVariantZobristNumbers(),Ce=makeMoveVariant):(delete ue.siblingGame,Te=he===l.Crazyhouse,Pe=he===l.Chess960,he?(createVariantZobristNumbers(),Ce=makeMoveVariant):Ce=makeMoveChess),r||updateSetup(generateFen()))}function disambiguate960Rook(t,r){for(var i,o,a=t>7?1:2;!(136&t);){if((i=de[t])&a)if(i&P){if(o)return;o=t%8+(1===a?65:97)}else if(i&C)return o;t+=r}}function _clear(t,r,i){de=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],me=1,fe[1]=T,fe[2]=T,ge[1]=0,ge[2]=0,ue._hand[1]=0,ue._hand[2]=0,Ee[1]=0,Ee[2]=0,ve=T,ye=0,be=1,r||(we=[xe=[]],Se=0,xe.id=Se,Me={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},t?setHeader(["Variant",t]):setVariant(!1,i),i||updateSetup(generateFen()))}function reset(){_clear(0,!1,!0),xe.hash=[1178310168,378666140],de=[34,10,18,66,130,18,10,34,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,33,9,17,65,129,17,9,33],_e=1,fe[1]=116,fe[2]=4,ge[1]=48,ge[2]=48}function load(t,r,i,o){var a,g,_,x,w,S,M,A,O,I,R,j,N=0;if(o?(j=(a=t.split(" "))[3],R=a[2]):(j=(a=t.trim().split(/\s+/))[3]||"-",R=a[2]||"-"),void 0===r?(31&R.charCodeAt(0))<9&&setVariant(l.Chess960,!0):setVariant(r,!0),g=a[0],!o&&!(g=function fixFenPieces(t,r){var i,o,a=t.length,h=0,g=0,y=r&&(r===l.Crazyhouse||r===l.Bughouse);for(i=0;i<a;++i)if(+(o=t[i])!=+o)if("/"===o){if(8!==g&&(t=t.substr(0,i)+(8-g)+t.substr(i),++i,++a),g=0,++h>7){if(!y&&i<a-1||!/^[pnbrq]{0,63}$/i.test(t.substr(i+1)))return!1;break}}else if(G[o]){if(++g>8)return!1}else{if("~"!==o)return!1;y&&i&&/[nbrq]/i.test(t[i-1])||(t=t.substr(0,i)+t.substr(i+1),--i,--a)}else(g+=1*o)>8&&(t=t.substr(0,i)+(o-(g-8))+t.substr(i+1),g=8);return t}(g,he)))return!1;if(x=g.length,_clear(h[he],i,!0),Te){if(he===l.Bughouse&&!ue.isDependent&&(S=t.split(" | "),!ue.siblingGame.load(1===S.length?t:S[1],r,i,o)))return reset(),!1;for(w=0;w<x;++w)if(+(M=g[w])!=+M)if("/"===M){if(N>111){for(++w;w<x;++w)M=g[w],ue._hand[M<"a"?1:2]+=1<<J[M]>>>0;break}N+=8}else de[N]=G[M],"~"===g[w+1]&&(++w,de[N]|=L),de[N]&C&&(fe[3&de[N]]=N),++N;else N+=1*M}else for(w=0;w<x;++w)+(M=g[w])!=+M?"/"===M?N+=8:(de[N]=G[M],de[N]&C&&(fe[3&de[N]]=N),++N):N+=1*M;if(me="b"===a[1]?2:1,"-"!==R)if(Pe){for(O={1:[0,0],2:[0,0]},w=R.length-1;w>=0;--w)75===(_=R.charCodeAt(w))?_=disambiguate960Rook(119,-1):81===_?_=disambiguate960Rook(112,1):107===_?_=disambiguate960Rook(7,-1):113===_&&(_=disambiguate960Rook(0,1)),A=_<97?1:2,I=ie[String.fromCharCode(_)],(M=de[I])===(P|A)&&(_>=97?fe[A]>=1&&fe[A]<=6&&(ge[A]|=1<<_-97):fe[A]>=113&&fe[A]<=118&&(ge[A]|=1<<_-65),++O[A][1*(fe[A]<I)]);(O[1][0]>1||O[1][1]>1)&&(ge[1]=0),(O[2][0]>1||O[2][1]>1)&&(ge[2]=0)}else{if(!o)for(w=R.length-1;w>=0;--w)M=de[ie[R[w]]],A=R.charCodeAt(w)<97?1:2,M===(P|A)&&fe[A]===(1===A?116:4)||(R=R.substr(0,w)+R.substr(w+1)||"-");for(w=R.length-1;w>=0;--w)switch(R[w]){case"K":ge[1]|=ne.KSIDE_CASTLE;break;case"Q":ge[1]|=ne.QSIDE_CASTLE;break;case"k":ge[2]|=ne.KSIDE_CASTLE;break;case"q":ge[2]|=ne.QSIDE_CASTLE}}return!o&&(2!==j.length||1===me&&"6"!==j[1]||2===me&&"3"!==j[1]||de[j.charCodeAt(0)-97+16*(8-("3"===j[1]?4:5))]!==(4|swapColor(me))||de[y[j]])&&(j="-"),ve="-"===j?T:y[j],ye=1*a[4]||0,be=1*a[5]||1,he===l["3-check"]&&(a[6]&&"+3+3"!==a[6]&&(S=a[6].match(/^\+([0-3])\+([0-3])$/)),S=S||[0,0,0],Ee[1]=1*S[1],Ee[2]=1*S[2]),i||(_e=be,updateSetup(generateFen())),!0}function generateFen(){return he?function generateVariantFen(){var t,r,i,o=0,a="",h="";for(t=0;t<120;++t)136&t&&(o&&(a+=o),a+="/",o=0,t+=8),(i=de[t])?(o&&(a+=o,o=0),a+=V[i&O],Te&&i&L&&(a+="~")):++o;if(o&&(a+=o),Te&&(a+="/"+handToString(ue._hand[1],!0)+handToString(ue._hand[2])),Pe){for(r=ge[2],t=0;r;)1&r&&(h=String.fromCharCode(t+97)+h),r>>=1,++t;for(r=ge[1],t=0;r;)1&r&&(h=String.fromCharCode(t+65)+h),r>>=1,++t}else ge[1]&ne.KSIDE_CASTLE&&(h+="K"),ge[1]&ne.QSIDE_CASTLE&&(h+="Q"),ge[2]&ne.KSIDE_CASTLE&&(h+="k"),ge[2]&ne.QSIDE_CASTLE&&(h+="q");return a+=" "+(1===me?"w":"b")+" "+(h||"-")+" "+(ve===T?"-":algebraic(ve))+" "+ye+" "+be,he===l["3-check"]?a+=" +"+Ee[1]+"+"+Ee[2]:he!==l.Bughouse||ue.isDependent||(a+=" | "+ue.siblingGame.fen()),a}():function generateStandardFen(){var t,r,i=0,o="",a="";for(t=0;t<120;++t)136&t&&(i&&(o+=i),o+="/",i=0,t+=8),(r=de[t])?(i&&(o+=i,i=0),o+=V[r&O]):++i;return i&&(o+=i),ge[1]&ne.KSIDE_CASTLE&&(a+="K"),ge[1]&ne.QSIDE_CASTLE&&(a+="Q"),ge[2]&ne.KSIDE_CASTLE&&(a+="k"),ge[2]&ne.QSIDE_CASTLE&&(a+="q"),o+" "+(1===me?"w":"b")+" "+(a||"-")+" "+(ve===T?"-":algebraic(ve))+" "+ye+" "+be}()}function setHeader(t){var r,i,o;for(r=0;r<t.length;r+=2)i=t[r],o=t[r+1],i&&("Variant"===i&&(setVariant(o),o=he?h[he]:void 0),"Result"===i&&"*"!==o&&"1-0"!==o&&"0-1"!==o&&"1/2-1/2"!==o&&(o="*"),void 0!==o?Me[i]=String(o):oe.indexOf(i)>-1?Me[i]="Date"===i?"????.??.??":"?":delete Me[i]);return Me}function updateSetup(t){xe.length>0||Se||(t!==D?(Me.SetUp="1",Me.FEN=t,xe.hash=null):(delete Me.SetUp,delete Me.FEN,xe.hash=[1178310168,378666140]))}function get(t){var r=de[y[t]];return r?{type:V[r&A|2],color:3&r,promoted:0!=(r&L)}:null}function calculateLegalMoveInfo(o,l){var h,g,y,x,w,S,M,P,O,L,R,j,N,k,D=me,G=C|D,H=_;if(t=[],r=0,i=0,a=0,H[0]=H[1]=H[2]=H[3]=H[4]=H[5]=H[6]=H[7]=H[16]=H[17]=H[18]=H[19]=H[20]=H[21]=H[22]=H[23]=H[32]=H[33]=H[34]=H[35]=H[36]=H[37]=H[38]=H[39]=H[48]=H[49]=H[50]=H[51]=H[52]=H[53]=H[54]=H[55]=H[64]=H[65]=H[66]=H[67]=H[68]=H[69]=H[70]=H[71]=H[80]=H[81]=H[82]=H[83]=H[84]=H[85]=H[86]=H[87]=H[96]=H[97]=H[98]=H[99]=H[100]=H[101]=H[102]=H[103]=H[112]=H[113]=H[114]=H[115]=H[116]=H[117]=H[118]=H[119]=0,l!==T){for(N=function chooseKingThreats(t,r){return Pe&&ge[t]?K:ge[t]&ne.KSIDE_CASTLE&&!de[r+1]&&!de[r+2]?ge[t]&ne.QSIDE_CASTLE&&!de[r-1]&&!de[r-2]&&!de[r-3]?(a=ne.KQSIDE_CASTLE,X):(a=ne.KSIDE_CASTLE,q):ge[t]&ne.QSIDE_CASTLE&&!de[r-1]&&!de[r-2]&&!de[r-3]?(a=ne.QSIDE_CASTLE,$):W}(D,l),h=0;h<120;++h)if(136&h&&(h+=8),x=de[h])if(x&D)(!o||(0|x)&o)&&t.push(h);else if(0!=((k=N[h-l+119])&x))if(4&x)for(L=B[x],g=1;g<3;++g)136&(P=h+L[g])||(H[P]|=1,P===l&&(++r,H[h]|=2));else for(O=(L=B[x&A]).length,j=x&I,g=0;g<O;++g)if(R=L[g],!(l>(P=h)&&R<0&&l-P>16||l<P&&R>0&&P-l>16))for(;!(136&(P+=R));){if(H[P]|=1,w=de[P]){if(w&D)if(P===l){for(y=P-R;y!==h;y-=R)H[y]|=2;H[h]|=2,++r,j&&0==(136&(P+=R))&&(H[P]|=1)}else if(j&&256&k&&r<2)for(M=P+R;0==(136&M);){if(S=de[M]){S===G&&(H[P]|=4+(Math.abs(R)<<3),++i);break}M+=R}break}if(!j)break}r>1&&(t=[l])}else t=function getPieces(t,r){var i,o,a=[];for(i=0;i<120;++i)136&i&&(i+=8),(o=t[i])&&(o&r)===r&&a.push(i);return a}(de,D|o)}function validateEnPassant(t,i){var o,a,l,h=i+16*(1===me?1:-1);return(1!==r||0!=(2&_[i])||0!=(2&_[h]))&&(o=de[t],de[i]=o,de[t]=0,a=de[h],de[h]=0,l=inCheck(),de[t]=o,de[i]=0,de[h]=a,!l)}function addCastlingMoves(t){var r,i,o;if(Pe){if(ge[t])for(i=(r=fe[t])%8,o=0;o<8;++o)ge[t]&1<<o&&canCastle960(de,r,o,t)&&(x[S++]=(o>i?ne.KSIDE_CASTLE:ne.QSIDE_CASTLE)+(r<<7)+(r+(o-i)<<R),++o)}else a&ne.KSIDE_CASTLE&&(i=(r=fe[t])+2,0===_[r+1]&&0===_[r+2]&&(x[S++]=ne.KSIDE_CASTLE+(r<<7)+(i<<R))),a&ne.QSIDE_CASTLE&&(i=(r=fe[t])-2,0===_[r-1]&&0===_[r-2]&&(x[S++]=ne.QSIDE_CASTLE+(r<<7)+(i<<R)))}function generateMoves(o,a){var l,h,g,y,T,P,C,O,L,N,k=me,D=swapColor(k),G=fe[k];for(calculateLegalMoveInfo(o,G),M=t.length,S=w,L=0;L<M;++L)if(l=t[L],y=de[l],!(r&&i&&4&_[l]))if(4&y)for(P=B[y],0!==i&&0!=(4&_[l])&&_[l]>>3!=16||(T=l+P[0],0===de[T]&&(addPawnMove(l,T,0),re[k]===rank(l)&&(T+=P[0],de[T]||addPawnMove(l,T,ne.BIG_PAWN)))),h=1;h<3;++h)136&(T=l+(C=P[h]))||i&&4&_[l]&&_[l]>>3!==Math.abs(C)||(de[T]&D?addPawnMove(l,T,ne.CAPTURE):T===ve&&validateEnPassant(l,T)&&(x[S++]=ne.EP_CAPTURE|l<<7|T<<R));else{if(i&&4&_[l]){if(8&y)continue;if(!(z[l-fe[k]+119]&y))continue;P=[C=_[l]>>3,-C]}else P=B[y&A];if(N=l<<7,l===G){for(h=0;h<8;++h)0==(136&(T=l+(C=P[h])))&&(de[T]?de[T]&D&&0==(1&_[T])&&(x[S++]=ne.CAPTURE|N|T<<R):0==(1&_[T])&&(x[S++]=N|T<<R));0===r&&addCastlingMoves(k)}else for(g=P.length,O=y&I,h=0;h<g;++h)for(C=P[h],T=l;!(136&(T+=C));){if(de[T]){de[T]&D&&(0===r||2&_[T])&&(x[S++]=ne.CAPTURE|N|T<<R);break}if((0===r||2&_[T])&&(x[S++]=N|T<<R),!O)break}}return Te&&function drop(t,i,o){var a,l,h,g,y;if(!t)for(i&&(i>>=26),g=0;g<5;++g)if((!i||(0|i)==1<<g)&&ue._hand[o]&Q[g]<<Z[g]){for(0===g?(a=16,l=103,h=ne.DROP):(a=0,l=119,h=ne.DROP|g<<j),y=a;y<=l;++y)136&y&&(y+=8),de[y]||(0===r||1===r&&2&_[y])&&(x[S++]=h|y<<R);if(i)return}}(a,o,k),S}function inCheckAfterMove(t,r,i,o){var a,h,g,y,_,x,w,S;if(he===l["King of the Hill"]&&t&C&&kingOfTheHillWin(i))return!0;if(o&ne.KQSIDE_CASTLE&&(i=1===me?o&ne.KSIDE_CASTLE?117:115:o&ne.KSIDE_CASTLE?5:3,t=P,S=!0),(a=fe[swapColor(me)])===T)return!1;if(0==(t&C)&&z[i-a+119]&t)for(_=t&I,y=i+(g=Y[i-a+119]);0==(136&y);){if(y===a){if(4&t){if(1==(3&t)?a-i<0:a-i>0)return!0;break}return!0}if(y!==r&&de[y]||!_)break;y+=g}if(!S){if((h=z[r-a+119])&I&&(g=Y[r-a+119])!==Y[i-a+119])for(y=a-g;0==(136&y);){if(y!==r&&(x=de[y])){if(x&me&&h&x&&x&I)return!0;break}y-=g}if(o&ne.EP_CAPTURE&&(h=z[(w=i+16*(1===me?1:-1))-a+119])&I)for(y=a-(g=Y[w-a+119]);0==(136&y);){if(y!==r&&y!==w){if(y===i)break;if(x=de[y]){if(x&me&&h&x&&x&I)return!0;break}}y-=g}}return!1}function moveToSan(t,r){var i,o,a,h,g,y,_="";return t&ne.KQSIDE_CASTLE?_=t&ne.KSIDE_CASTLE?"O-O":"O-O-O":t&ne.DROP?((i=t>>j)&&(_+=te[i]),_+="@"+algebraic(a=t>>R&N)):(a=t>>R&N,4&(h=de[o=t>>7&N])?(t&ne.ANY_CAPTURE&&(_+=String.fromCharCode(file(o)+97)+"x"),_+=algebraic(a),t&ne.PROMOTION&&(_+="="+te[i=t>>j])):(_+=U[h&O],M>1&&(_+=function getDisambiguator(t,r,i){var o,a,l,h,g,y;if(S<2)return"";for(t&=A,y=0;y<S;++y)if(i===(o=x[y])>>R&&(l=o>>7&N)!==r&&de[l]&t){if(a=!0,rank(r)===rank(l)){if(h)return algebraic(r);g=!0}if(file(r)===file(l)){if(g)return algebraic(r);h=!0}}return a?h?String(8-rank(r)):String.fromCharCode(file(r)+97):""}(h,o,a)),t&ne.ANY_CAPTURE&&(_+="x"),_+=algebraic(a))),r||(t&ne.KQSIDE_CASTLE?(o=t>>7&N,a=t>>R&N):t&ne.DROP_OR_PROMOTE&&(h=ee[i]+me),inCheckAfterMove(h,o,a,t)&&(Ce(t,o,a,i),g=w,w=S,y=M,he!==l.Chess&&isVariantWin()?_+="#":generateMoves()-w?_+="+":_+="#",S=w,w=g,M=y,reverseMove(xe.pop()))),_}function kingAttacked(t){return fe[t]!==T&&function attacked(t,r){var i,o,a,l,h=B[8],g=8|t;for(i=0;i<8;++i)if(0==(136&(a=r+h[i]))&&((o=de[a])&g)===g)return!0;for(h=B[128],i=0;i<8;++i)for(a=r+(l=h[i]);0==(136&a);){if(o=de[a]){if(o&t&&z[r-a+119]&o){if(!(4&o))return!0;if(1===t?r-a<0:r-a>0)return!0}break}a+=l}return!1}(swapColor(t),fe[t])}function inCheck(){return kingAttacked(me)}function inCheckmate(){return inCheck()&&0===generateMoves()}function inStalemate(){var t=!inCheck()&&0===generateMoves();return t&&he===l.Bughouse&&!ue.isDependent&&(t=ue.siblingGame.inStalemate()),t}function insufficientMaterial(t){var r,i,o=0,a=0,l=0;for(i=0;i<120;++i)if(136&i&&(i+=8),r=de[i]){if(t&&0==(r&t))continue;if(100&r)return!1;if(8&r){if(a||o++)return!1}else if(16&r){if(o)return!1;if(++a,(rank(i)+i)%2&&++l,l&&a!==l)return!1}}return!0}function inThreefoldRepetition(){if(ye<8)return!1;for(var t,r=getCurrentHash(),i=!1,o=ye,a=!1,l=xe,h=l.length-1;;){if((h-=2)<0){if(l.id){h=l.atMoveNode+h+2,l=we[l.parentId];continue}if(-2===h)return!1;t=l.hash,a=!0}else t=l[h].hash,l[h].halfMoves>o||o<2?a=!0:o=l[h].halfMoves;if(t[0]===r[0]&&t[1]===r[1]){if(i)return!0;i=!0}if(a)return!1}}function modifyHand(t){var r,i,a,h,g,y,_,x,w,S=t.move;if(he===l.Crazyhouse||S&ne.DROP?(i=ue._hand,g=t.hash,w=t.color):(i=ue.siblingGame._hand,t.handSibling=!0,pe&&((y=ue.siblingGame._history()).length?g=y[y.length-1].hash:(y.hash||(y.hash=ue.siblingGame._hashPosition()),g=y.hash)),w=swapColor(t.color)),t.captured){switch((t.captured&L?4:t.captured&A)&A){case 4:_=0;break;case 8:_=1;break;case 16:_=2;break;case P:_=3;break;default:_=4}r=1<<Z[_],pe&&(h=i[w]>>Z[_]&Q[_],x=o.zobristPiece[h+63*_+(1===w?0:315)])}else r=-1<<Z[a=S>>j],pe&&(h=i[w]>>Z[a]&Q[a],x=o.zobristPiece[h-1+63*a+(1===w?0:315)]);i[w]+=r,t.handChange=r,pe&&hashNum(g,[31*x[0]>>>0,17*x[1]>>>0])}function makeMoveChess(t,r,i,a){var l,h,g,y,_,x,w,S,M=me,A=swapColor(M),I={move:t,epSquare:ve,halfMoves:ye,castlingW:ge[1],castlingB:ge[2],color:M},R=1===M;pe&&(y=getCurrentHash(),I.hash=y,hashNum(y,o.zobristTurn),ve!==T&&hashEP(de,y,ve+(R?16:-16),4|M)),0==(t&ne.KQSIDE_CASTLE)?Te&&t&ne.DROP?(de[i]=ee[a]|M,pe&&hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[de[i]]+8*(7-rank(i))+file(i)]),modifyHand(I),w=0):(w=de[r],(S=de[i])&&(I.captured=S,pe&&hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[de[i]&O]+8*(7-rank(i))+file(i)]),S&P&&ge[A]&&(Pe?rank(i)===(R?0:7)&&(g=1<<file(i),ge[A]&g&&(ge[A]^=g,pe&&(g>1<<file(fe[M])?hashNum(y,o.zobristCastle[A-1]):hashNum(y,o.zobristCastle[A+1])))):i===(R?7:119)?ge[A]&ne.KSIDE_CASTLE&&(ge[A]^=ne.KSIDE_CASTLE,pe&&hashNum(y,o.zobristCastle[A-1])):i===(R?0:112)&&ge[A]&ne.QSIDE_CASTLE&&(ge[A]^=ne.QSIDE_CASTLE,pe&&hashNum(y,o.zobristCastle[A+1])))),de[i]=t&ne.PROMOTION?ee[a]|M|L:de[r],de[r]=0,pe&&(hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[w&O]+8*(7-rank(r))+file(r)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[de[i]&O]+8*(7-rank(i))+file(i)]))):w=C,t&ne.EP_CAPTURE?(R?(x=i+16,_=6):(x=i-16,_=8),I.captured=4|A,de[x]=0,pe&&hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[4|A]+8*(_-rank(i))+file(i)])):w&C?(Pe?(t&ne.KQSIDE_CASTLE&&(de[i]=0,de[r]=0,t&ne.KSIDE_CASTLE?R?(l=118,h=117):(l=6,h=5):R?(l=114,h=115):(l=2,h=3),de[l]=M|C,de[h]=M|P,pe&&(hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[C|M]+8*(7-rank(r))+file(r)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[P|M]+8*(7-rank(i))+file(i)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[C|M]+8*(7-rank(l))+file(l)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[P|M]+8*(7-rank(h))+file(h)]))),pe&&(0!=(ge[M]&ge[M]-1)?(hashNum(y,o.zobristCastle[M-1]),hashNum(y,o.zobristCastle[M+1])):ge[M]>1<<file(fe[M])?hashNum(y,o.zobristCastle[M-1]):hashNum(y,o.zobristCastle[M+1])),fe[M]=l||i):(t&ne.KQSIDE_CASTLE&&(de[i]=de[r],de[r]=0,t&ne.KSIDE_CASTLE?(l=i-1,h=i+1):(l=i+1,h=i-2),de[l]=de[h],de[h]=0,pe&&(hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[C|M]+8*(7-rank(r))+file(r)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[P|M]+8*(7-rank(h))+file(h)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[C|M]+8*(7-rank(i))+file(i)]),hashNum(y,o.zobristPiece[64*o.zobristPieceValueNumbers[P|M]+8*(7-rank(l))+file(l)]))),pe&&(ge[M]&ne.KSIDE_CASTLE&&hashNum(y,o.zobristCastle[M-1]),ge[M]&ne.QSIDE_CASTLE&&hashNum(y,o.zobristCastle[M+1])),fe[M]=i),ge[M]=0):w&P&&ge[M]&&(Pe?rank(r)===(R?7:0)&&(g=1<<file(r),ge[M]&g&&(ge[M]^=g,pe&&(g>1<<file(fe[M])?hashNum(y,o.zobristCastle[M-1]):hashNum(y,o.zobristCastle[M+1])))):r===(R?119:7)?ge[M]&ne.KSIDE_CASTLE&&(ge[M]^=ne.KSIDE_CASTLE,pe&&hashNum(y,o.zobristCastle[M-1])):r===(R?112:0)&&ge[M]&ne.QSIDE_CASTLE&&(ge[M]^=ne.QSIDE_CASTLE,pe&&hashNum(y,o.zobristCastle[M+1]))),t&ne.BIG_PAWN?(ve=R?i+16:i-16,pe&&hashEP(de,y,i,4|A)):ve=T,4&w||t&ne.ANY_CAPTURE?ye=0:ye++,me=A,xe.push(I)}function makeMoveVariant(t,r,i,a){var h,g=me;makeMoveChess(t,r,i,a),h=xe[xe.length-1],Te?(ye=h.halfMoves+1,h.captured&&modifyHand(h),he===l.Bughouse&&(h.bughouseOrder=ue.moveCount()-1+ue.siblingGame.moveCount())):he===l["3-check"]&&kingAttacked(me)&&(h.checked=!0,pe&&Ee[g]&&hashNum(h.hash,o.zobristCheck[Ee[g]+(1===g?-1:2)]),++Ee[g],pe&&hashNum(h.hash,o.zobristCheck[Ee[g]+(1===g?-1:2)]))}function reverseMove(t){var r,i,o=me,a=swapColor(o),h=t.move,g=h>>R&N,y=h>>7&N;if(me=a,ge[2]=t.castlingB,ge[1]=t.castlingW,ve=t.epSquare,ye=t.halfMoves,he){if(Pe&&h&ne.KQSIDE_CASTLE)return h&ne.KSIDE_CASTLE?1===a?(i=118,r=117):(i=6,r=5):1===a?(i=114,r=115):(i=2,r=3),de[i]=0,de[r]=0,de[y]=a|C,de[g]=a|P,void(fe[a]=y);if(t.handChange&&(he!==l.Crazyhouse&&t.handSibling?ue.siblingGame._hand[swapColor(a)]-=t.handChange:ue._hand[a]-=t.handChange),h&ne.DROP)return void(de[g]=0);t.checked&&--Ee[a]}h&ne.PROMOTION?(de[y]=4|a,de[g]=h&ne.CAPTURE?t.captured:0):(de[y]=de[g],h&ne.KQSIDE_CASTLE?(de[g]=0,h&ne.KSIDE_CASTLE?(r=g+1,i=g-1):(r=g-2,i=g+1),de[r]=a|P,de[i]=0,fe[a]=y):(g===fe[a]&&(fe[a]=y),h&ne.CAPTURE?de[g]=t.captured:(de[g]=0,h&ne.EP_CAPTURE&&(de[g-(1===a?-16:16)]=4|o))))}function beautifyMove(t,r,i){var o,a,l=t>>R&N,h={color:me,to:algebraic(l),flags:t&N};return Te&&0!=(t&ne.DROP)?(a=t>>j,h.drop=a,h.piece=ee[a]+me):(o=t>>7&N,h.from=algebraic(o),h.piece=de[o],t&ne.PROMOTION&&(a=t>>j,h.promotion=ee[a]+me),t&ne.CAPTURE?h.captured=de[l]:t&ne.EP_CAPTURE&&(h.captured=4|swapColor(me))),h.san=r||moveToSan(t,i),h}function isVariantWin(){return he===l["3-check"]?3===Ee[swapColor(me)]:he===l["King of the Hill"]?kingOfTheHillWin(fe[swapColor(me)]):void 0}function isBughouseWin(){if(he===l.Bughouse)return ue.siblingGame.inCheckmate()}function createVariation(){var t=[],r=generateFen(),i=xe.length-1,o=xe[i];return!!o&&(t.parentId=Se,t.id=we.length,xe.curFen=r,o.lines||(o.lines=[]),o.lines.push(t.id),o.move?reverseMove(o):(ve=o.epSquare,--ye,me=swapColor(me)),2===me&&--be,t.atMoveNode=i,t.hash=i?xe[i-1].hash:xe.hash,Se=t.id,we.push(t),xe=t,!0)}function selectLine(t){var r=generateFen();xe.curFen=r,xe=we[t],Se=t,load(xe.curFen,he,!0,!0)}return ue={WHITE:1,BLACK:2,PAWN:4,KNIGHT:8,BISHOP:16,ROOK:P,QUEEN:64,KING:C,FLAGS:ne,load:load,reset:reset,moves:function moves(t){var r,i,o,moves=[],a=moveToSan;for(t&&(t.verbose&&(a=beautifyMove),t.type&&(i=t.type|t.type<<24),o=t.noDrop),generateMoves(i,o),r=0;r<S;++r)moves.push(a(x[r]));return moves},inCheck:inCheck,inCheckmate:inCheckmate,inStalemate:inStalemate,isBughouseWin:isBughouseWin,in50MoveRule:function in50MoveRule(){return ye>=100},inDraw:function inDraw(){return ye>=100||inStalemate()||insufficientMaterial()||inThreefoldRepetition()||Boolean(function isBughouseDraw(){if(he===l.Bughouse)return ue.siblingGame.in50MoveRule()||ue.siblingGame.inThreefoldRepetition()}())},insufficientMaterial:insufficientMaterial,inThreefoldRepetition:inThreefoldRepetition,isVariantWin:isVariantWin,gameOver:function gameOver(){return ue.inDraw()||inCheckmate()||Boolean(isVariantWin())||Boolean(isBughouseWin())},isPositionValid:function isPositionValid(t){var r,i,o,a=0;if(!1!==(t=t||{}).pawns)for(r=0;r<=119;){if(4&(o=de[r]))return!1;8==++r&&(r=112)}if(!1!==t.kings){for(r=0;r<=119;++r)if(136&r&&(r+=8),(o=de[r])&C){if(++a>2)return!1;if(i&&i&o)return!1;i=3&o}if(2!==a)return!1}return!1===t.check||!1===t.kings&&fe[swapColor(me)]===T||!kingAttacked(swapColor(me))},validateFen:validateFen,fen:generateFen,pgn:function pgn(t){return(t=t||{}).useResultHeader||Se||(isVariantWin()||inCheckmate()?Me.Result=2===me?"1-0":"0-1":ue.inStalemate()?Me.Result="1/2-1/2":isBughouseWin()&&(Me.Result=1===ue.siblingGame.turn()?"1-0":"0-1")),se(t,Me,we,_e,he,ue)},loadPgn:function loadPgn(t,r,i){var o,a,h,g,y,_,x,w,S,M={},T=0;if("number"!=typeof r&&(i=i||r,r=0),i=i||{},"string"==typeof t&&(i.singleGame&&(t=t.replace(/(?:\r?\n\s*){2,}/g,"\n")),t=ue.tokenizePgn(t,i)),r<0&&(r=t.length+r),!(g=t[r]))return!1;for(reset(),a=g.length,o=0;o<a&&"tagName"===(h=g[o]).type;++o){if(!g[o+1]||"tagValue"!==g[o+1].type)return!1;++o,"FEN"===h.value?x=completeFen(g[o].value):M[h.value]=g[o].value}if(i.variant&&(M.Variant=i.variant),M.Variant&&!x&&(x=D),x||"1"===M.SetUp)if("0"===M.SetUp)M.FEN=x;else if(!x||!load(x,M.Variant))return!1;for(ue.header(M),_=(y=ue)._history();o<a;++o)if("san"===(h=g[o]).type&&0===T){if(!y.move(h.value)){if(!i.skipBadLines||!(0!==Se||xe.length&&i.allowBadMainLine))return reset(),!1;T=1}}else if("result"===h.type&&"*"===Me.Result)setHeader(["Result",h.value]);else if("a"===h.type&&0===T&&_[_.length-1])_[_.length-1].annotation=h.value;else if("nag"!==h.type&&"aa"!==h.type||0!==T||!_[_.length-1]){if("comment"===h.type&&0===T)_.length?(h.value.trim()&&(_[_.length-1].comment=h.value),h.commands&&(_[_.length-1].commands=h.commands,h.commands.clk&&(_[_.length-1].time=(w=h.commands.clk,S=void 0,10*(3600*(S=w.split(":"))[0]+60*S[1]+1*S[2]))))):(_.initComment=String(h.value),h.commands&&(_.commands=h.commands));else if("variationStart"===h.type){if(T>0)++T;else if(!createVariation())return reset(),!1;_=y._history()}else if("variationEnd"===h.type)T>0&&--T,0===T&&(selectLine(_.parentId),_=y._history());else if("number"===h.type&&he===l.Bughouse){if(!(y=/b/i.test(h.value.slice(-1))?ue.siblingGame:ue))return!1;_=y._history()}}else _[_.length-1].additionalAnnotation||(_[_.length-1].additionalAnnotation=[]),-1===_[_.length-1].additionalAnnotation.indexOf(h.value)&&_[_.length-1].additionalAnnotation.push(h.value);return!0},header:function header(t){return Array.isArray(t)?setHeader(t):"object"===g()(t)?(Object.keys(t).forEach((function(r){setHeader([r,t[r]])})),Me):Me},turn:function turn(t){return 1!==t&&2!==t||(me=t),me},move:function playMove(t){var r,i,a,h,g,_,w,M,P,O,I,D,B;if("string"==typeof t){switch(t[h=t.length-1]){case"+":case"#":t=t.substr(0,h)}for(P=k.indexOf(t[0])>6?H[t[0]]:"O"===t[0]?C:4,Te&&(-1===t.indexOf("@")?O=!0:(O=!1,P<<=24)),generateMoves(P,O),h=0;h<S;++h)if(t===(_=moveToSan(x[h],!0))){i=x[h];break}if(!i)return"--"===t?function makeNullMove(){var t,r={color:me,san:"--",epSquare:ve},i={color:me,san:"--"};return pe&&(t=getCurrentHash(),r.hash=t,hashNum(t,o.zobristTurn),ve!==T&&hashEP(de,t,ve+(1===me?16:-16),4|me)),ve=T,ye++,1===(me=swapColor(me))&&++be,xe.push(r),i}():(t=Chess.fixSanMove(t,de,me))?playMove(t):null;w=i>>7&N,M=i>>R&N,a=i>>j}else{if(t.drop){switch(t.drop){case"p":a=0;break;case"n":a=1;break;case"b":a=2;break;case"r":a=3;break;case"q":a=4;break;default:return null}P=1<<26+a}else{if(t.promotion)switch(t.promotion){case"q":a=4;break;case"n":a=1;break;case"r":a=3;break;case"b":a=2;break;default:return null}w=y[t.from],O=!0,P=de[w]&A}for(M=y[t.to],r=((a?a<<j:0)|M<<R)>>7|w,generateMoves(P,O),h=0;h<S;++h)if(x[h]>>7===r){i=x[h];break}if(!i)return(t=Chess.fixObjMove(t,de,me))?playMove(t):null}return B=i&ne.DROP_OR_PROMOTE?ee[a]+me:de[w],g=beautifyMove(i,_,!0),I=inCheckAfterMove(B,w,M,i),Ce(i,w,M,a),I&&(he!==l.Chess&&isVariantWin()||0===generateMoves()?g.san+="#":g.san+="+"),(D=xe[xe.length-1]).san=g.san,g.piece&L&&(D.promoted=!0),1===me&&++be,g},undo:function undo(t){var r=xe.pop();return r?(1===me&&--be,r.move?(reverseMove(r),!!t||beautifyMove(r.move,r.san)):(ve=r.epSquare,--ye,me=swapColor(me),!!t||{san:"--",color:r.color})):null},clear:function clear(t){_clear(t)},put:function put(t,r,i){var o,a=y[r],l=!1,h=de[a],g=3&h,_=t.color;if(isNaN(a)||!t.type||!_||-1===k.indexOf(t.type))return!1;if(de[a]=H[t.type]|_|(t.promoted?L:0),de[a]&C&&(fe[_]=a),h&&de[fe[g]]&&de[fe[g]]!==(C|g)){for(o=0;o<120;++o)136&o&&(o+=8),de[o]===(C|g)&&(fe[g]=o,l=!0);l||(fe[g]=T)}return i||load(generateFen(),he,!0,!1),!0},get:get,remove:function remove(t,r){var i,o=de[y[t]],a=get(t),l=3&o;if(de[y[t]]=0,o&C)for(fe[l]=T,ge[l]=0,i=0;i<120;++i)if(136&i&&(i+=8),de[i]===(C|l)){fe[o.color]=i;break}return r||load(generateFen(),he,!0,!1),a},history:function history(t,r){for(var i,o=[],a=xe,l=a.length;;){if(-1==--l){if(a.id&&!r){l=a.atMoveNode,a=we[a.parentId];continue}break}t?((i=beautifyMove(a[l].move,a[l].san)).color=a[l].color,!l&&a.initComment&&(i.firstComment=a.initComment),void 0!==a[l].comment&&(i.comment=a[l].comment),void 0!==a[l].time&&(i.time=a[l].time),void 0!==a[l].annotation&&(i.annotation=a[l].annotation),void 0!==a[l].additionalAnnotation&&(i.additionalAnnotation=a[l].additionalAnnotation),void 0!==a[l].commands&&(i.commands=a[l].commands),void 0!==a[l].captured&&(i.captured=a[l].captured),void 0!==a[l].promoted&&(i.promoted=a[l].promoted),void 0!==a[l].lines&&(i.lines=a[l].lines),void 0!==a[l].bughouseOrder&&(i.bughouseOrder=a[l].bughouseOrder),k.indexOf(a[l].san[0])>6?i.piece=H[a[l].san[0]]:"O"===a[l].san[0]?i.piece=C:i.piece=4,i.piece|=i.color,o.unshift(i)):o.unshift(a[l].san)}return o},hashes:function hashes(){for(var hashes=[],t=xe,r=t.length;;){if(-1==--r){if(t.id){r=t.atMoveNode,t=we[t.parentId];continue}t.hash||getCurrentHash(),hashes.unshift(t.hash);break}hashes.unshift(t[r].hash)}return hashes},moveCount:function moveCount(){return xe.length},startingMoveNumber:function startingMoveNumber(){return _e},completeFen:completeFen,createVariation:createVariation,selectLine:selectLine,hash:function hash(){var hash=getCurrentHash();return he!==l.Bughouse||ue.isDependent?hash:[hash,ue.siblingGame.hash()]},hashing:function hashing(t){pe=t,he!==l.Bughouse||ue.isDependent||ue.siblingGame.hashing(pe)},hand:function hand(){if(Te)return handToString(ue._hand[1],!0)+handToString(ue._hand[2])},checks:function checks(){if(he===l["3-check"])return[Ee[1],Ee[2]]},tokenizePgn:ce,_hand:[],_history:function _history(t){return t&&(Se=(xe=t).id),xe},_lines:function _lines(){return we},_hashPosition:hashPosition,_board:function _board(){return de}},ae&&load(ae,le)||reset(),ue}return Chess.fixSanMove=function(t,r,i){var o,a,l;if(/0|[?!+#]$|[18][QNRB]$|^P/.test(t))return t.replace(/[?!+#]+$/,"").replace(/0/g,"O").replace(/([18])([QNRB])$/,"$1=$2").replace(/^P/,"");if(a=t.indexOf("=")>0?-4:-2,o=t.substr(a,2),i=swapColor(i),r[y[o]]&i||/^[a-h]x?[a-h]/.test(t)){if(-1===t.indexOf("x"))return t.slice(0,a)+"x"+t.substr(a)}else if(t.indexOf("x")>-1)return t.replace("x","");return(l=t.match(/^([KQNRB]?)([a-h][1-8]?|[1-8])(x?[a-h][1-8])=?(.?)$/))?r[y[l[2]]]?{from:l[2],to:o,promotion:l[4].toLowerCase()}:l[1]+l[3]+l[4]:void 0},Chess.fixObjMove=function(t,r,i){if(r[y[t.from]]===(C|i)&&t.to&&t.from[1]===t.to[1]){if(t.from<t.to)return"O-O";if(t.from>t.to)return"O-O-O"}},Chess.variants=h,Chess}(),l=function ENGINE_MANAGER(t){var r=["bench","d","eval","flip","isready","perft","ponderhit","stop","uci","ucinewgame"],i=[{cmd:"position",args:["fen","startpos","moves","continuation"]},{cmd:"go",args:["binc","btime","confidence","depth","infinite","mate","mindepth","mintime","maxdepth","maxtime","movestogo","movetime","ponder","searchmoves","shallow","winc","wtime"]}],a=["moves","searchmoves"],l=["ponder","infinite","startpos"],h=/Total Evaluation[\s\S]+\n$/i;function createWebWorker(t,r,i){var o=new Worker(t||"stockfish.js"),a={terminate:function terminate(){o.terminate()},postMessage:postMessage,addEventListener:function addEventListener(t,r){a["on"+t]=r}};function postMessage(t){o.postMessage(t)}return o.onmessage=function(t){a.onmessage(t)},o.onerror=function(l){if(r.pathToNonWasmEngine&&r.pathToNonWasmEngine!==t){l.preventDefault&&l.preventDefault();try{o.terminate()}catch(l){}return(o=createWebWorker(r.pathToNonWasmEngine,r,i)).onmessage=function(t){a.onmessage(t)},function requeue(t){t.length&&t.forEach((function(t){t.message="",postMessage(t.cmd)}))}(i._activeCommands()),!1}if(r.onError)return r.onError(l)},a}function parseSearchLine(t){var r,i,o,a,l,h={},g=["lowerbound","upperbound","score"],y=["depth","seldepth","time","nodes","multipv","cp","mate","currmovenumber","hashfull","nps","tbhits","sbhits","cpuload"],_=["depth","seldepth","time","nodes","pv","multipv","score","cp","mate","lowerbound","upperbound","currmove","currmovenumber","hashfull","nps","tbhits","sbhits","cpuload","string","refutation","currline","bestmove","ponder","baseTurn","pvSan","bestmoveSan","ponderSan","bmc"],x=["pv","pvSan","string","refutation","currline"];for(i=(r=t.split(" ")).length,o="info"===r[0]?1:0,h.mtype=r[0];o<i;o+=1)r[o]&&(!l||a&&_.indexOf(r[o])>-1?(l=r[o],g.indexOf(l)>-1?(h[l]=!0,l=null):a=x.indexOf(l)>-1||-1===_.indexOf(l)):(y.indexOf(l)>-1&&(r[o]=Number(r[o])),a?(void 0===h[l]&&(h[l]=[]),h[l].push(r[o])):(h[l]=r[o],l=null)));return"(none)"!==h.bestmove&&"0000"!==h.bestmove||(h.bestmove=void 0,h.bestmoveSan=void 0),"(none)"!==h.ponder&&"0000"!==h.ponder||(h.ponder=void 0,h.ponderSan=void 0),h}function getFirstWord(t){var r=t.indexOf(" ");return-1===r?t:t.substr(0,r)}return function loadEngine(g,y){var _,x,w={},S=function createWorker(t,r){var i=t.pathToNonWasmEngine&&"undefined"==typeof WebAssembly?t.pathToNonWasmEngine:t.enginePath||t.pathToEngineWorker;if(t.pathToWasmEngine&&(i+="#"+t.pathToWasmEngine),"undefined"!=typeof Worker)return createWebWorker(i,t,r)}(g,w),M=[],T=[];function onmessage(r){var i,o,a,l,g,y,_="string"==typeof r?r:r.data;if(w)if((null===(i=_.indexOf)||void 0===i?void 0:i.call(_,"\n"))>-1)for(g=_.split("\n"),y=0;y<g.length;y+=1)onmessage(g[y]);else if(t.log&&console.log("debug (onmessage): "+_),w.stream&&w.stream(_),M.length&&0!==_.indexOf("No such option")&&0!==_.indexOf("id ")&&0!==_.indexOf("Stockfish")&&0!==_.indexOf("info string variant")&&(a=function determineQueueNum(t,r){var i,o,a,l,h=getFirstWord(t);if("bench"!==r[0].cmd&&"perft"!==r[0].cmd)for(i="uciok"===h||"option"===h?"uci":"readyok"===h||"ready"===h?"isready":"json"===h?"fetch":"bestmove"===h||"info"===h?"go":"other",l=r.length,a=0;a<l;a+=1)if((o=getFirstWord(r[a].cmd))===i||"other"===i&&("d"===o||"eval"===o))return a;return 0}(_,M),l=M[a])){if(l.stream&&!l.discard&&l.stream(_),void 0===l.message?l.message="":""!==l.message&&(l.message+="\n"),l.message+=_,"uciok"===getFirstWord(_))o=!0;else if("readyok"===getFirstWord(_)||"ready"===getFirstWord(_))o=!0,w.ready=!0;else if(0!==_.indexOf("bestmove")&&"bestmove"!==getFirstWord(_)||"bench"===l.cmd)if("d"===l.cmd)0!==_.indexOf("Legal uci moves")&&0!==_.indexOf("Key is")||(l.done=!0,o=!0);else if("fetch json"===l.cmd)try{l.message=JSON.parse(l.message.replace(/^json /gm,"").replace(/\n/g,"")),o=!0}catch(r){}else"eval"===l.cmd?h.test(l.message)&&(o=!0):(0===_.indexOf("pawn key")||0===_.indexOf("Nodes/second")||0===_.indexOf("Unknown command"))&&(o=!0);else o=!0,l.message=_;o&&(M.splice(a,1),l.cb&&!l.discard?l.cb(l.message):l.ondiscard&&l.ondiscard())}}function bestMoveSearch(){var r,i,o,a,l,h=1,g=[],y=[],x=null,S=T[0].args,M=T[0].cb,P=T[0].stream,C=S.timeout,A=1;function convertpv(t){var r=[],i=y[t]||createSanPv(g[t]);return g[t].forEach((function oneach(t,o){r.push({moveSan:i[o],moveLan:t})})),r}function getpv(t,r,i,o){var a;for(a=g.length-1;a>=0;a-=1)if(g[a][0]===t)return convertpv(a);return i?[{moveSan:r,moveLan:t},{moveSan:o,moveLan:i}]:r?[{moveSan:r,moveLan:t}]:[]}function convertScore(t){0===t.mate?(t.mateIn=0,t.cp=-31800*A):(t.mateIn=Number(t.mate*A)||null,"number"!=typeof t.mateIn||isNaN(t.mateIn)||"number"==typeof t.cp?(t.cp*=A,9===Math.abs(t.cp)&&(t.cp=0),S.normalize&&t.depth<=14&&"number"==typeof loadEngine._previousCP&&1===t.multipv&&function normalize(t){var r=.03*Math.pow(32,t.depth/14);t.cp=loadEngine._previousCP+(t.cp-loadEngine._previousCP)*r}(t)):t.cp=31800*A*(t.mate/Math.abs(t.mate))),t.score=t.cp/100}function addBestMoveProps(l){var g;if(l.baseTurn=o,l.cp=r,l.score=r/100,l.mate=i,l.mateIn=x,l.depth=h,l.moveLan=l.bestmove,l.moveLan){if(l.move=t.uciToObj(l.moveLan)[0],!(g=a.move(l.move)))throw w.forceStop(),new Error("Bad moveLan in line: "+l.moveLan+" at "+a.fen()+"\ndata: "+JSON.stringify(l)+"\nargs: "+JSON.stringify(S));if(l.moveSan=l.bestmoveSan=g.san,l.ponder&&("(none)"!==l.ponder||"0000"!==l.ponder)){if(!(g=a.move(t.uciToObj(l.ponder)[0])))throw w.forceStop(),new Error("Bad ponder in line: "+l.ponder+" at "+a.fen()+"\ndata: "+JSON.stringify(l)+"\nargs: "+JSON.stringify(S));l.ponderSan=g.san,a.undo(!0)}a.undo(!0)}}function createSanPv(r){var i,o,l=r.length,h=[];for(i=0;i<l;++i){if(!(o=a.move(t.uciToObj(r[i])[0])))throw w.forceStop(),new Error("Bad pv in line: "+r[i]+" ("+i+") at "+a.fen()+"\npv: "+JSON.stringify(r)+"\nargs: "+JSON.stringify(S));h.push(o.san)}for(i=0;i<l;++i)a.undo(!0);return h}function createTimeout(){C&&(clearTimeout(_),_=setTimeout((function(){w.stop(),M&&(M(),M=void 0)}),C))}S.timeout=void 0,T[0].started=!0,S.difficulty>=0&&S.difficulty<20?(w.setoption("Skill Level",S.difficulty),S.maximumError>=0&&S.maximumError<=4999&&w.setoption("Skill Level Maximum Error",S.maximumError),S.errorProbability>=1&&S.errorProbability<=128&&w.setoption("Skill Level Probability",S.errorProbability)):w.setoption("Skill Level",20),void 0!==S.contempt?w.setoption("Contempt",S.contempt):w.setoption("Contempt","0"),S.multiPv>1?w.setoption("MultiPV",S.multiPv):w.setoption("MultiPV",1),S.movetime||S.wtime&&S.btime||S.depth||(S.btime=S.btime||72e3,S.wtime=S.wtime||72e3),!S.startpos&&S.fen||S.moves||S.variant?(a=t.createGame({fen:S.fen?(l=S.fen,(l+"").replace(/\[([qrbnp]*)\]/i,"/$1").replace(/([0-3])\+([0-3]) (\d+ \d+)/,(function(t,r,i,o){return o+" +"+(3-r)+"+"+(3-i)}))):"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",moves:S.moves,variant:S.variant,disableHashing:!0})).turn()===a.WHITE?o="w":(o="b",A=-1):(o="w",a=t.createGame({disableHashing:!0})),w.setVariant(S.variant),w.position(S),w.go(S,(function returnBestMove(t){var i=parseSearchLine(t);if(addBestMoveProps(i),h>14&&r<5e3&&r>-5e3&&(loadEngine._previousCP=r),i.pv=getpv(i.moveLan,i.moveSan),1===i.pv.length&&i.ponder&&(i.pv=getpv(i.moveLan,i.moveSan,i.ponder,i.ponderSan)),M)try{M(i)}catch(o){console.error(o)}T.shift(),T.length>0&&bestMoveSearch(),clearTimeout(_)}),(function streamInfo(t){var a=parseSearchLine(t);a.score&&(a.baseTurn=o,convertScore(a),!a.multipv&&a.depth&&(a.multipv=1),1!==a.multipv&&0!==a.depth||(r=a.cp,i=a.mate,x=a.mateIn)),a.pv&&P&&(a.pvSan=createSanPv(a.pv)),!a.pv||a.lowerbound||a.upperbound||(g.push(a.pv),P&&y.push(a.pvSan)),a.depth>h?h=a.depth:"bestmove"===a.mtype&&addBestMoveProps(a),!P||0===a.mateIn&&a.pv||P(a),createTimeout()})),createTimeout()}function startUp(){w.isready((function onstart(){g.settings?w.uci((function onuci(){Object.keys(g.settings).forEach((function oneach(t){w.setoption(t,g.settings[t])})),y&&y(w)})):y&&y(w)}))}return w.send=function(r,i,o){var a;r=String(r).trim(),t.log&&console.log("debug (send): "+r),"ucinewgame"!==r&&"flip"!==r&&"stop"!==r&&"ponderhit"!==r&&0!==r.indexOf("position")&&0!==r.indexOf("setoption")?M[M.length]={cmd:r,cb:i,stream:o}:a=!0,S&&(S.postMessage(r),a&&i&&setTimeout(i,0))},w._activeCommands=function(){return M},w.quit=function(){S&&S.terminate&&(S.terminate(),S=null,w.ready=void 0),clearTimeout(_)},r.forEach((function oneach(t){w[t]=function makeSCmd(r,i){w.send(t,r,i)}})),i.forEach((function oneach(t){w[t.cmd]=function makeCCmd(r,i,o){var h=[t.cmd];x&&r.fen&&(r.fen=function convertStockfishVariantFen(t){return(t+"").replace(/^([^/]+)((?:\/[^/]+){7})\/([qrbnp]*)/i,"$1$2[$3]").replace(/( \d+ \d+) \+([0-3])\+([0-3])/,(function(t,r,i,o){return" "+(3-i)+"+"+(3-o)+r}))}(r.fen)),t.args.forEach((function oneach(t){if(r[t]||0===r[t]){if(a.indexOf(t)>-1){if(!r[t]||!r[t].length)return;Array.isArray(r[t])&&(r[t]=r[t].join(" "))}h.push(t),-1===l.indexOf(t)&&h.push(r[t])}})),w.send(h.join(" "),i,o)}})),w.setoption=function(t,r){w.send("setoption name "+t+" value "+r)},w.setVariant=function(t){var r;t!==x&&(r=String(t).toLowerCase().replace(/ |-/g,""),t&&"chess"!==r?"chess960"===r?(w.setoption("UCI_Variant","chess"),w.setoption("UCI_Chess960","true")):("threecheck"===r&&(r="3check"),w.setoption("UCI_Variant",r),w.setoption("UCI_Chess960","false")):(r=void 0,w.setoption("UCI_Variant","chess"),w.setoption("UCI_Chess960","false")),x=r)},w.loadBook=function(t,r){o.loadBook(t,(function onload(i,o){w.book=o,w.pathToBook=t,w.bookLoaded=!0,i&&(console.error("Error loading opening book."),console.error(i),w.pathToBook=null,w.bookLoaded=!1),r()}))},w.getBestMove=function(r,i,o){var a;if((r=r||{}).fen=r.fen||r.baseFen,r.is960&&(r.variant="Chess960"),w.bookLoaded&&r.useBook&&(a=function getBookMove(r){var i,o,a;if(a=r.moves&&r.moves.length?t.getFenFromMoves(r.fen,r.moves,r.variant):r.fen,(i=w.book.pick({fen:a,type:void 0!==r.bookPick?r.bookPick:"random",chess960:"Chess960"===r.variant}))&&(t.getLegalMoves(a,r.variant).some((function(t){if(t.from+t.to+(t.promotion||"")===i)return o=t,!0})),o))return{moveSan:o.san,moveLan:i,move:{from:o.from,to:o.to,promotion:o.promotion||null},baseTurn:a.split(" ")[1],pv:[{moveSan:o.san,moveLan:i}],depth:null,score:null,mateIn:null,isBookMove:!0}}(r)))return setTimeout((function(){a.mtype="bestmove",i(a)}),0);!function queueBestMoveSearch(t,r,i){T.push({args:t,cb:r,stream:i}),1===T.length&&bestMoveSearch()}(r,i,o)},w.stopAll=function(r){var i,o=M.length,a=0;function ondiscard(){0==(a-=1)&&r()}for(T=[],i=0;i<o;i+=1)t.log&&console.log("debug (stop_moves): "+i,getFirstWord(M[i].cmd)),"go"!==getFirstWord(M[i].cmd)||M[i].discard||(w.stop(),M[i].discard=!0,r&&(a+=1,M[i].ondiscard=ondiscard));r&&!a&&w.isready(r)},w.restartEngine=function(t){return w.stopAll(),w.quit(),M=[],T=[],w.bookLoaded&&!g.book&&((g=JSON.parse(JSON.stringify(g))).book=w.book),loadEngine(g,t)},w.forceStop=function(){w.stopAll((function(){}))},w.stopFast=function(t,r){var i;w.stopAll((function(){clearTimeout(i),t(w)})),i=setTimeout((function(){w.restartEngine(t)}),r||5e3)},"undefined"!=typeof Worker&&(function addListener(){S.addEventListener("message",onmessage,!1)}(),g.book&&(w.book=g.book,w.bookLoaded=!0,w.pathToBook=g.pathToBook),!w.book&&g.pathToBook?w.loadBook(g.pathToBook,startUp):setTimeout(startUp,0),w.getFenFromMoves=t.getFenFromMoves,w.getLegalMoves=t.getLegalMoves,w.getPositionInfo=t.getPositionInfo,w.isFenValid=t.isFenValid,w.ready=!1,w)}},function(){var t,r=a(),i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",h=252,y={4:"p",5:"P",6:"p",8:"n",9:"N",10:"n",16:"b",17:"B",18:"b",32:"r",33:"R",34:"r",64:"q",65:"Q",66:"q",128:"k",129:"K",130:"k"},_="pnbrq",x=512,w="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!?{~}(^)[_]@#$,./&-*++=",S="qnrbkp";function decodeTCN(t){var r,i,o,a,l=t.length,h=[];for(r=0;r<l;r+=2)a={},i=w.indexOf(t[r]),(o=w.indexOf(t[r+1]))>63&&(a.promotion=S[Math.floor((o-64)/3)],o=i+(i<16?-8:8)+(o-1)%3-1),i>75?a.drop=S[i-79]:a.from=w[i%8]+(Math.floor(i/8)+1),a.to=w[o%8]+(Math.floor(o/8)+1),h.push(a);return h}function uciToObj(t){var r,i,o=t.split(" "),a=o.length,l=[];if(t)for(r=0;r<a;++r)4===(i=o[r]).length?"@"===i[1]?l.push({drop:i[0].toLowerCase(),to:i.substr(2,2)}):l.push({from:i.substr(0,2),to:i.substr(2,2)}):l.push({from:i.substr(0,2),to:i.substr(2,2),promotion:i[4]});return l}function isSameMove(t,r){return t.san===r.san||t.from==r.from&&t.to==r.to&&t.promotion==r.promotion&&t.drop==r.drop}function makePremove(t,i,o){var l,h,g,y,_,x=t.header().Variant,w=getPremoves(t.fen(),i,x);if(w){for(l=w.length-1;l>=0;--l)if(isSameMove(h=w[l],o)){g=!0;break}if(g)return h.drop?t.put({type:h.drop,color:i},h.to,!0):(y=t.remove(h.from,!0),h.flags===r.FLAGS.KSIDE_CASTLE?(_=t.remove("Chess960"===x?h.to:"h"+h.from[1],!0),t.put(y,"g"+h.from[1],!0),t.put(_,"f"+h.from[1],!0)):h.flags===r.FLAGS.QSIDE_CASTLE?(_=t.remove("Chess960"===x?h.to:"a"+h.from[1],!0),t.put(y,"c"+h.from[1],!0),t.put(_,"d"+h.from[1],!0)):(h.promotion&&(y.type=h.promotion,y.promoted=!0),t.put(y,h.to,!0))),h}if(o.from&&(o=a.fixObjMove(o,t._board(),i)))return makePremove(t,i,{san:o})}function getPieces(t,r){var i,o,a,l=r?{}:[],g=t._board();if(r)for(i=112;i>=0;++i)136&i&&(i-=24),(o=g[i])&&(l[a=w[7&i]+(8-(i>>4))]={type:y[o&h],color:3&o,promoted:0!=(o&x),square:a});else for(i=112;i>=0;++i)136&i&&(i-=24),(o=g[i])&&l.push({type:y[o&h],color:3&o,promoted:0!=(o&x),rank:8-(i>>4),file:1+(7&i)});return l}function makeMoves(t,r,i,o){var a,l,h,g,y,_,x,w,S,M;for(i=i||{},"string"==typeof r&&(r=r.trim().split(" ")),h=r.length,a=0;a<h;a+=1){if(y="b"===r[a].board||"B"===r[a].board?t.siblingGame:t,_="string"==typeof r[a]?uciToObj(r[a])[0]:r[a].san?r[a].san:r[a],!y.move(_)){if(!i.autoPromote){if(i.skipBadLines)break;return!1}if(!0===i.autoPromote?_.promotion="q":_.promotion=i.autoPromote,!y.move(_)){if(i.skipBadLines)break;return!1}}if(w=(x=y._history())[x.length-1],o&&(S=parseInt(o[a],10)),("number"!=typeof S||isNaN(S))&&(S=parseInt(r[a].time,10)),"number"!=typeof S||isNaN(S)||(w.time=S,S=void 0),r[a].firstComment&&(x.initComment=r[a].firstComment),r[a].comment&&(w.comment=r[a].comment),r[a].annotation&&(w.annotation=r[a].annotation),r[a].additionalAnnotation&&(w.additionalAnnotation=r[a].additionalAnnotation),r[a].commands&&(w.commands=r[a].commands),r[a].lines)for(g=r[a].lines.length,l=0;l<g;++l){if(M=t._history().id,t.createVariation(),!makeMoves(t,r[a].lines[l],i)&&!i.skipBadLines)return!1;t.selectLine(M)}}return!0}function extendChess(t){var r,o,l=-1,h=0;function fixContComment(r){var i=t._lines()[r.ids.line];return i.initComment&&(r.comment=(i.initComment+" "+(r.comment||"")).trim(),i.initComment=""),!0}t.extended||(t.extended=!0,r={header:t.header,load:t.load,loadPgn:t.loadPgn,createVariation:t.createVariation,undo:t.undo,pgn:t.pgn},t._move=t.move,t.premoves=[],t.undo=function(){return t.deletePosition(l,h)},t.isLegalMove=function(i){return!!t._move(i)&&r.undo(!0)},t.premove=function(r,i){var o,l=t.premoves.length,h=a();return l?h.load(t.premoves[l-1].fen,t.header().Variant):h.load(t.fen(),t.header().Variant),(o=makePremove(h,i,r))?(t.premoves.push({move:o,pieces:getPieces(h),fen:h.fen()}),o):null},t.getPieces=function(r){return getPieces(t,r)},t.origHistory=t.history,t.history=function(r,i){var o,a,l,h=[],y=t._history(),_=y.length,x=t._lines();for("boolean"==typeof r&&(r={verbose:r}),r=r||{},i&&(r.noParentLines=i),r.toCurrent&&(_=t.ids().move+1);;){if(-1==--_){if(y.id&&!r.noParentLines){_=y.atMoveNode,y=x[y.parentId];continue}break}if(r.verbose){for(a in o={},y[_])if(y[_][a]&&"object"===g()(y[_][a]))for(l in o[a]=y[_][a].constructor===Array?[]:{},y[_][a])o[a][l]=y[_][a][l];else o[a]=y[_][a];h.unshift(o)}else h.unshift(y[_].san)}return h},t._getPos=function(o,a){var g,y;return"number"!=typeof o&&(o=l),"number"!=typeof a&&(a=h),g=(y=t._lines())[a],o>=0?g[o]:g.id?g.atMoveNode?y[g.parentId][g.atMoveNode-1]:t._getPos(g.atMoveNode-1,g.parentId):{fen:r.header().FEN||i,hash:g.hash,initial:!0}},t.move=function(r,i){var o,a,g,y,_=t._history();if(r&&("string"==typeof r||r.to&&(r.from||r.drop))){if(h===_.id&&l<_.length-1||i){if(t.moveForward(i,r))return!0;l<_.length-1&&(t.selectPosition(l+1),t.createVariation(),_=t._history())}t.siblingGame&&(g=t.isDependent?t.siblingGame.fen():t.fen()),(o=t._move(r))&&(normalizeMoveObj(o),h=_.id,a=_[l=_.length-1],y=t._getPos(l-1),t.siblingGame?(t.isDependent?a.fen=t.siblingGame.fen():a.fen=t.fen(),a.beforeFen=g):(a.fen=t.fen(),a.beforeFen=y.fen),y.initial?(a.moveNumber=0,a.previous=null):(a.moveNumber=y.moveNumber+1,a.previous=y.ids,y.isContinuation&&fixContComment(y)),h&&0===l&&t._lines()[_.parentId][_.atMoveNode].move===a.move&&(a.isContinuation=!0),a.flags=o.flags,a.to=o.to,a.from=o.from,a.drop=o.drop,a.capturedStr=o.captured,a.promotion=o.promotion,a.piece=o.piece,o.promoted&&(a.promoted=!0),o.capturedPromotedPawn&&(a.capturedPromotedPawn=!0),a.ids={move:l,line:h})}return o},t.header=t.headers=function(i){var o=r.header(i);return t.siblingGame&&extendChess(t.siblingGame),o},t.load=function(i,o,a,g){var y=r.load(i,o,a,g);return t.siblingGame&&extendChess(t.siblingGame),y&&!a&&(l=-1,h=0),y},t.removeEmptyLines=function(){var r,i,o=t._lines();for(r=o.length-1;r>0;--r)o[r].length||(o[r]=void 0,i=!0);i&&t.reorderLines()},t.loadPgn=function(i,o,a){var g=r.loadPgn(i,o,a),y=t._history();return t.removeEmptyLines(),l=y.length-1,h=y.id,g},t.ids=function(){return{move:l,line:h}},t.selectLine=function(r){t.selectPosition(null,r)},t.moveBackward=function(){var r;if(l<=1)if(0===h){if(-1===l)return!1;t.selectPosition(l-1)}else(r=t._getPos(l-1,h)).isContinuation?t.selectPosition(t._history().atMoveNode,t._history().parentId):r.initial?t.selectPosition(-1,0):t.selectPosition(r.ids.move,r.ids.line);else t.selectPosition(l-1);return!0},t.moveForward=function(r,i){var o,g,y,_,x,w,S=t._lines();if("string"==typeof i&&(i={san:i}),!(o=S[h][l+1])||i&&!isSameMove(i,o)){if(i&&o&&o.lines)for(x=o.lines.length,_=0;_<x;++_)if((y=S[o.lines[_]][0])&&isSameMove(i,y)){o=y,w=!0;break}if(!w&&r&&(g=S[h][l])&&g.lines)for(x=g.lines.length,_=0;_<x;++_)if((y=S[g.lines[_]][0])&&y.isContinuation&&(y=S[g.lines[_]][1])&&(!i||isSameMove(i,y))){o=y,w=!0;break}if(!w)return!!(i&&i.san&&(i=a.fixSanMove(i.san,t._board(),t.turn()))||i&&i.to&&i.from&&Math.abs(i.to.charCodeAt(0)-i.from.charCodeAt(0))>1&&(i=a.fixObjMove(i,t._board(),t.turn())))&&t.moveForward(r,i)}return t.selectPosition(o.ids.move,o.ids.line)},t.moveVariation=function(r,i){var o,a,l,h=t._lines(),g=h[r];if(g&&g.id)for(a=(o=h[g.parentId][g.atMoveNode].lines).length-1;a>=0;--a)if(o[a]===r&&o[l=a-(i?1:-1)])return o[a]=o[l],o[l]=r,t.reorderLines(),!0;return!1},t.promoteVariation=function(r,i){for(var o,a,g,y,_,x,w=t._lines(),S=w[r];S&&S[0]&&S.id&&(-1!==i||S.parentId);){for(o=w[g=S.parentId],y=S.atMoveNode,S[0].lines=o[y].lines.concat(S[0].lines||[]),o[y].lines=void 0,x=o.length-y,a=o.splice(y,x),_=0;_<x;++_)a[_].ids.line=r,a[_].ids.move=_;for(a.id=r,a.parentId=g,a.atMoveNode=y,a.hash=S.hash,0===y?(a.initComment=o.initComment,o.initComment=S.initComment):S.initComment&&(o[y-1].comment=((o[y-1].comment||"")+" "+S.initComment).trim()),w[r]=a,x=S.length,_=0;_<x;++_)S[_].ids.line=g,S[_].ids.move=_+y,o.push(S[_]);for(a[0].isContinuation=!!S[0].isContinuation&&fixContComment(a[0]),o[y].isContinuation=!y&&"number"==typeof o.parentId&&w[o.parentId][o.atMoveNode].move===o[0].move&&fixContComment(o[y]),x=o[y].lines.length,_=0;_<x;++_)w[o[y].lines[_]].atMoveNode=y,w[o[y].lines[_]][0]&&(w[o[y].lines[_]][0].isContinuation=w[o[y].lines[_]][0].move===o[y].move&&fixContComment(w[o[y].lines[_]][0]));if(h===r?(h=g,l+=y):h===g&&l>=y&&(h=r,l-=y),1===i)break;S=w[r=g]}return void 0!==o&&(t._history(w[h]),t.reorderLines(),!l&&w[h][0].isContinuation&&t.selectPosition(w[h].atMoveNode,w[h].parentId),!0)},t.reorderLines=function(r,i){var a,l,g,y,_,x,w,S,M,T,P=t._lines();for(r?M=i.length-1:(r=0,i=[P[0]],M=0,o=!1),g=(a=P[r]).length,l=0;l<g;++l)if((y=a[l]).ids.line=M,y.lines)for(_=y.lines.length,x=0;x<_;++x)(S=P[w=y.lines[x]])?(S.atMoveNode=l,T=i.length,y.lines[x]=T,S.parentId=M,o||w!==h||(o=!0,h=T),i.push(S),t.reorderLines(w,i)):(1===y.lines.length?delete y.lines:y.lines.splice(x,1),--x,--_);r||t.saveLines(i,!0)},t.createVariation=function(){var i,o,a,g,y=t._history(),_=t._lines();return l===y.length-1?(i=r.createVariation(),y=t._history(),l=y.length-1,h=y.id,i):-1!==l&&(o=[],a=y[l],o.parentId=y.id,o.id=_.length,a.lines||(a.lines=[]),a.lines.push(o.id),g=t._getPos(l-1),o.hash=g.hash,o.atMoveNode=l,_.push(o),t.selectPosition(-1,o.id))},t.selectLineEnd=function(r){return"number"!=typeof r&&(r=h),(r!==h||l<t._history().length-1)&&t.selectPosition(null,r,!0)},t.selectLineStart=function(){var r,i;return h?(l>1||1===l&&!t._getPos(0).isContinuation?r=t._history():(i=t._getPos(-1),r=t._lines()[i.ids?i.ids.line:0]),t.selectPosition(r.id?r[1]&&r[0].isContinuation?1:0:-1,r.id)):-1!==l&&t.selectPosition(-1,0)},t.selectPosition=function(i,o,a){var g=t._lines(),y=t._history();if("number"==typeof o&&(o!==h||a)){if(o<0||o>=g.length)return!1;if(y=g[o],"number"!=typeof i)i=y.length-1;else if(i<-1||i>=y.length)return!1;h=o,t._history(y),a=!0}if("number"==typeof i&&(i!==l||a)){if(i<-1||i>=y.length)return!1;r.load(t._getPos(i).fen,r.header().Variant,!0,!0),l=i}return!0},t.resetToMainLine=function(){var r=t._lines();t.selectLineEnd(0),r.length>1&&(r.length=1,t.reorderLines())},t.saveLines=function(r,i){var o,a,l,h=t._lines(),g=r.length;for(r!==h&&(h.length=0),a=0;a<g;++a){if(o=r[a],a&&"number"!=typeof o.parentId)return!1;r!==h&&h.push(o),o.id=a}return i||(l=t.ids(),t.selectPosition(-1,0,!0),t.selectPosition(l.move,l.line)),!0},t.deletePosition=function(r,i){var o,a,g=t._lines();return!(!g[i]||!(g[i][r]||-1===r&&0!==i))&&(i&&(0===r||1===r&&g[i][0].isContinuation)&&(r=-1),h>0&&i!==h?a=!1!==(o=function descendsFromMove(t,r,i){for(var o,a=t[r];"number"==typeof(o=a.parentId);){if(o===i)return a.atMoveNode;a=t[o]}return!1}(g,h,i))&&o>=r:i===h&&r<=l&&(a=!0),a&&(r>1?t.selectPosition(r-1,i):(t.selectPosition(g[i][0].isContinuation||1===r?1:0,i),t.moveBackward())),r>0?g[i].length=r:i?g[i]=null:g[0].length=0,t.reorderLines(),t.ids())},t.mark=function(r,i){var o=l<0?t._lines()[h]:t._lines()[h][l],a=r.type,g=1;r.color&&("arrow"===a?t.mark({key:r.color+r.key,type:"cal"},i):"square"===a&&t.mark({key:r.color+r.key,type:"csl"},i)),"cal"!==a&&"csl"!==a&&(a="c_"+a,g=0),o.commands&&o.commands[a]&&(o.commands[a]=o.commands[a].split(",").filter((function rm(t){return t.slice(g).split(";")[0]!==r.key.slice(g)})).join(","),o.commands[a]||delete o.commands[a]),i||(o.commands||(o.commands={}),o.commands[a]=(o.commands[a]?o.commands[a]+",":"")+r.key+(r.data?";"+r.data.join(";"):""))},t.markings=function(){var r,i,o,a,g,y,_,x,w={},S=l<0?t._lines()[h]:t._lines()[h][l],M={cal:"arrow",csl:"square"};for(i in S.commands){if(o=S.commands[i],M[i])i=M[i],a=0;else{if("c_"!==i.substr(0,2))continue;i=i.slice(2),a=1}for(w[i]=w[i]||{},y=(g=o.split(",")).length,r=0;r<y;++r)a?(x=(_=g[r].split(";")).shift(),w[i][x]=w[i][x]||{type:i,key:x},w[i][x].data=_):(x=g[r].slice(1),w[i][x]=w[i][x]||{type:i,key:x},w[i][x].color=g[r][0])}return w},t.clearMarkings=function(){var r,i=l<0?t._lines()[h]:t._lines()[h][l];for(r in i.commands)/^c[sa]l$|^c_/.test(r)&&delete i.commands[r]},t.pgn=function(i){var o,a=t.ids();return t.selectLineEnd(0),o=r.pgn(i),t.selectPosition(a.move,a.line),o},t.loadMoves=function(r,i){var o,a,g;if(i=i||{},"string"==typeof r&&(r=decodeTCN(r)),r){for(i.atCurrent||t.selectPosition(-1,0),g=h,a=r.length,o=0;o<a;++o){if(!t.move(r[o],!0)&&(r[o].promotion=!0===i.autoPromote?"q":i.autoPromote,!t.move(r[o],!0)))return!1;h!==g&&"merge"!==i.method&&(t.promoteVariation(h,1),"promote"!==i.method&&(t._history()[l].lines=void 0,t.reorderLines()),g=h)}"merge"!==i.method&&"promote"!==i.method&&t.deletePosition(l+1,h)}return!0})}function createGame(t){var r,o;if((t=t||{}).game)return t.game;if(r=a(),t.analysis&&extendChess(r),t.disableHashing&&r.hashing(!1),t.pgn){if(!(r.loadPgn(t.pgn,t.index,t.options)||"detect"===t.variant&&a.variants.some((function(i){return t.options=t.options||{},t.options.variant=i,r.loadPgn(t.pgn,t.index,t.options)}))))return!1}else{if(t.headers&&(t.variant=t.headers.Variant||t.variant,t.fen||(t.fen=t.headers.FEN)),"detect"===t.variant&&t.fen&&(t.fen.indexOf("|")>-1?t.variant="Bughouse":9===t.fen.split("/").length?t.variant="Crazyhouse":t.fen.indexOf("+")>-1?t.variant="3-check":t.variant=void 0),(t.fen||t.variant)&&!r.load(t.fen||i,t.variant))return!1;t.headers&&"object"===g()(t.headers)&&!Array.isArray(t.headers)&&r.header(t.headers)}if(t.tcn)if("object"===g()(t.tcn)){if(!function playBughouseTCN(t,r,i){var o,a,l,h=[decodeTCN(r[0]),decodeTCN(r[1])],g=[0,0],y=[0,0],_=h[0].length+h[1].length,x=Math.max(0|i[0][0],0|i[0][1],0|i[1][0],0|i[1][1]),w=[0,0],S=[0,0];for(o=[[x+=600-x%600,x],[x,x]];_--;){if(S[0]=w[0]+o[0][y[0]]-i[0][g[0]]||0,S[1]=w[1]+o[1][y[1]]-i[1][g[1]]||0,h[a=S[0]<=S[1]?0:1][g[a]]||(a^=1),(!(l=a?t.siblingGame:t).move(h[a][g[a]])||_&&l.inCheckmate()&&l.undo(!0))&&!(l=(a^=1)?t.siblingGame:t).move(h[a][g[a]]))return!1;l._history()[g[a]].time=i[a][g[a]],o[a][y[a]]=i[a][g[a]],w[a]=S[a],y[a]^=1,++g[a]}return!0}(r,t.tcn,t.timestamps||[[],[]]))return!1}else o=decodeTCN(t.tcn);else o=t.moves;return!(o&&!makeMoves(r,o,t,t.timestamps))&&r}function normalizeMoveObj(t){return t&&(t.piece&x&&(t.promoted=!0),t.piece=y[t.piece&h],t.captured&&(t.captured&x&&(t.capturedPromotedPawn=!0),t.captured=y[255&t.captured]),t.promotion&&(t.promotion=y[t.promotion&h]),void 0!==t.drop&&(t.drop=_[t.drop])),t}function normalizeHistory(t){var r,i,o,a,l,h,g,y=t.history(!0,!0);if(t.siblingGame){for(r=t.siblingGame.history(!0,!0),o=y.length+r.length,i=[],a=0;a<o;++a)!y.length||r.length&&r[0].bughouseOrder<y[0].bughouseOrder?(l=r.shift()).board="b":(l=y.shift()).board="a",i.push(l);y=i}for(o=y.length,a=0;a<o;++a)if((h=y[a]).fen||normalizeMoveObj(h),h.lines)for(g=h.lines.length-1;g>=0;--g)t.selectLine(h.lines[g]),h.lines[g]=normalizeHistory(t).moves;return{moves:y}}function getPremoves(t,i,o){var l,h,g,y,x,w,S,M,T=[];function pawnCapture(t){var o,a=x[0]+"x"+t;if(1===i&&7===l||2===i&&2===l)for(o=4;o>0;--o)T.push({color:i,to:t,flags:r.FLAGS.CAPTURE|r.FLAGS.PROMOTION,from:x,promotion:1<<o+2,piece:4,san:a+"="+_[o].toUpperCase()});else 1===l&&2===i||8===l&&1===i||T.push({color:i,to:t,flags:r.FLAGS.CAPTURE,from:x,piece:4,san:a})}if(1!==i&&2!==i||!r.load(t,o||"chess"))return null;for(t=r.fen(),(y=a()).clear(),o&&y.header({Variant:o}),r.turn(i),y.turn(i),l=1;l<9;++l)for(h=1;h<9;++h)x=String.fromCharCode(h+96)+l,(g=r.get(x))&&(r.remove(x,!0),g.color===i&&("p"===g.type?(h>1&&pawnCapture(String.fromCharCode(h-1+96)+(l+(1===i?1:-1))),h<8&&pawnCapture(String.fromCharCode(h+1+96)+(l+(1===i?1:-1)))):"k"===g.type&&(S=x[0],M=l),y.put(g,x,!0),T=T.concat(y.moves({verbose:!0})),y.remove(x,!0)));return"-"!==(w=t.split(" ")[2])&&w.split("").forEach((function(t){(1===i&&t<"a"||2===i&&t>="a")&&("k"===(t=t.toLowerCase())?T.push({color:i,to:"g"+M,flags:r.FLAGS.KSIDE_CASTLE,from:"e"+M,piece:128,san:"O-O"}):"q"===t?T.push({color:i,to:"c"+M,flags:r.FLAGS.QSIDE_CASTLE,from:"e"+M,piece:128,san:"O-O-O"}):t>S?T.push({color:i,to:t+M,flags:r.FLAGS.KSIDE_CASTLE,from:S+M,piece:128,san:"O-O"}):T.push({color:i,to:t+M,flags:r.FLAGS.QSIDE_CASTLE,from:S+M,piece:128,san:"O-O-O"}))})),(T=T.concat(r.moves({verbose:!0}))).forEach((function(t){normalizeMoveObj(t)})),T}function getLegalMoves(t,i){var o,a,l,h;if("string"==typeof t){if(!(a=r).load(t,i))return null}else a=createGame(t);for(h=(o=a.moves({verbose:!0})).length,l=0;l<h;++l)normalizeMoveObj(o[l]);return o}function jce(r,i){return(t=t||l(jce))(r,i)}return jce.gameFingerprints=function gameFingerprints(t){var r,a,l,h,g,y,_,x,w,S=createGame(t),M=[""],T=[];if(!S)return!1;for(w=(x=S.header()).Variant||"",y=S.hashes(),r="function"==typeof S.origHistory?S.origHistory(!0):S.history(!0),g=y.length,a=[y[0][0],y[0][1]],T.push(o.to64BitHex(a)+w),y[0]=o.to64BitHex(y[0]),l=1;l<g;++l)a[0]=(a[0]^y[l][0]*(l+58465))>>>0,a[1]=(a[1]^y[l][1]*(l+984))>>>0,y[l]=o.to64BitHex(y[l]),T.push(o.to64BitHex(a)+w),normalizeMoveObj(r[h=l-1]),_=(r[h].from?r[h].from:r[h].drop.toUpperCase()+"@")+r[h].to+(r[h].promotion||""),h&&(_=M[h]+" "+_),M.push(_);return{startingFen:x.FEN||i,hashes:y,fingerprints:T,moves:M,variant:x.Variant}},jce.getFenFromMoves=function getFenFromMoves(t,i,o){return r.reset(),r.load(t,o),!(i&&!makeMoves(r,i))&&r.fen()},jce.getLegalMoves=getLegalMoves,jce.getPremoves=getPremoves,jce.getPositionInfo=function getPositionInfo(t,i,o){var a,l,h,g={gameOver:!1,check:!1,checkmate:!1,draw:!1,stalemate:!1,threefold:!1,insufficient:!1};if(Array.isArray(i)||(o=i,i=null),"boolean"==typeof o?(a=o,o={}):a=(o=o||{}).variant,"string"==typeof t){if(0!==(h=r).validateFen(t,a)||!h.load(t,a))return!1}else h=createGame(t);return!(i&&!makeMoves(h,i))&&(o.getLegalMoves?(l=getLegalMoves({game:h}),g.legalMoves=l):l=h.moves(),h.inCheck()?(g.check=!0,g.checkmate=0===l.length):g.stalemate=0===l.length,o.premove&&(o.check=!1,o.kings=!1),g.threefold=h.inThreefoldRepetition(),g.insufficient=h.insufficientMaterial(o.color),g.fiftyMoveRule=h.in50MoveRule(),g.draw=g.stalemate||g.threefold||g.insufficient||g.fiftyMoveRule||h.inDraw(),o.skipValidation||(g.isValid=h.isPositionValid(o)),a&&(g.variantWin=h.isVariantWin(),void 0===g.variantWin&&(g.variantWin=h.isBughouseWin())),g.gameOver=g.checkmate||g.draw||Boolean(g.variantWin),g)},jce.isFenValid=function isFenValid(t,i){return 0===r.validateFen(t,i)},jce.encodeTCN=function encodeTCN(t){var r,i,o,a,l="";for(Array.isArray(t)||(t=[t]),i=t.length,r=0;r<i;r+=1)o=t[r].drop?79+S.indexOf(t[r].drop):w.indexOf(t[r].from[0])+8*(t[r].from[1]-1),a=w.indexOf(t[r].to[0])+8*(t[r].to[1]-1),t[r].promotion&&(a=3*S.indexOf(t[r].promotion)+64+(a<o?9+a-o:a-o-7)),l+=w[o]+w[a];return l},jce.decodeTCN=decodeTCN,jce.uciToObj=uciToObj,jce.generatePgn=function generatePgn(t){var r;return(t=t||{}).disableHashing=!0,!!(r=createGame(t))&&r.pgn(t)},jce.pgnToFen=function pgnToFen(t,i){var o,a,l=[];if(r.reset(),!r.loadPgn(t))return!1;if(o=r.moveCount(),"number"==typeof i){for(i<0&&(i=o+i+1),a=o-1;a>=i&&a>=0;a-=1)r.undo();return r.fen()}for(a=0;a<=o;a+=1)l.unshift(r.fen()),r.undo();return l},jce.pgnToJson=function pgnToJson(t,i,o){var a,l=[],h=r;return"number"!=typeof i&&(o=i,i=void 0),a=h.tokenizePgn(t,o),i<0&&(i=a.length+i),!!a&&(o&&o.includeFen&&(h=createGame({analysis:!0})),a.forEach((function(t,r){var a,g;r===i||void 0===i?h.loadPgn([t],0,o)?(g=normalizeHistory(h),a=h.header(),l.push({headers:a,moves:g.moves})):l.push(!1):l.push(void 0)})),"number"==typeof i?l[i]:l)},jce.sanToObj=function sanToObj(t,i,o){return r.reset(),!!r.load(i,o)&&normalizeMoveObj(r.move(t))},jce.completeFen=r.completeFen,jce.shortenFen=function shortenFen(t,i){return r.completeFen(t).split(" ").slice(0,i||4).join(" ")},jce.createGame=createGame,jce.getPositionDetails=function getPositionDetails(t,r){var i,o,a,l;if((t=t||{}).disableHashing=!0,!(i=createGame(t)))return null;if(r)if(t.premove){if(!(a=makePremove(i,t.color,r)))return null}else{if(!(a=i.move(r)))return null;i.extended||normalizeMoveObj(a)}return l=i.fen(),t.premove&&(t.check=!1,t.kings=!1),t.skipValidation||i.isPositionValid(t)?(o=l.split(" "),{fen:l,pieces:getPieces(i),sideToMove:i.turn(),castling:o[2],epSquare:"-"===o[3]?null:o[3],halfMoves:+o[4],moveNumber:+o[5],move:a,hand:i.hand(),checks:i.checks()}):null},jce.predict=function predict(t,r){var i=Math.min(Math.max(.20773843*Math.atan(2.49085889*t/100-2.47841945*r/100)+.02262979*t/100-.02256839*r/100+.52239679,0),1),o=Math.min(Math.max(-.20720905*Math.atan(2.49626837*t/100-2.48220286*r/100)+-.02352551*t/100+.02172627*r/100+.49443923,0),1),a=Math.min(Math.max(Math.exp(.037043456*t/100+.178106427*r/100-8.069742932)+.004823544*Math.exp(-1.364136591*Math.pow(t/100-r/100,2))+-.001625539,0),1),l=i+o+a;return{w:i/l,b:o/l,d:a/l}},jce.FLAGS=r.FLAGS,jce.loadECO=function loadECO(t,r){o.loadBook(t,(function onload(t,i){if(!i||!i.json)return r(t||new Error("Invalid book"));r(t,(function queryECO(t){var r,a,l,h,g,y,_,x,w;if(t.hash)a="string"==typeof t.hash?[o.hex64ToDec(t.hash)]:[t.hash],h=1;else{if(!(r=createGame(t)))return!1;h=(a=r.hashes()).length}for(l=0;l<h;++l)if(g=i.json[o.to64BitHex(a[l])]){if(g.constructor===Array)if(y&&-1===g[0].m.indexOf(y.m)){for(x=g.length-1;x>=0;--x)if(!x||-1!==g[x].m.indexOf(y.m)){(w=g[x]).e=g[0].e,w.s=g[0].s,w.mate=g[0].mate,w.v=g[0].v,w.h=g[0].h,w.n=w.n||g[0].n,w.u=w.u||g[0].u,w.c=w.c||g[0].c;break}}else w=g[0];else w=g;(w.n||t.allowNameless)&&(y=w)}else t.mustEndInBook&&(y=void 0);if(y)return _={name:y.n},y.m&&(_.moves=y.m),void 0!==y.d&&(_.sdiff=y.d/100),y.c&&(_.code=y.c,_.url=y.u||y.n.replace(/[\u00e1-\u00e5]/g,"a").replace(/[\u0107\u010d]/g,"c").replace(/[\u00e9\u00e8\u0117\u0113]/g,"e").replace(/[\u00f3\u00f6\u00f8]/g,"o").replace(/[\u016f\u00fc]/g,"u").replace(/['+,]/g,"").replace(/[^a-z0-9.]+/gi,"-").replace(/(with-\d|St)\.+-?/,"$1-")),y.e?(_.eval=y.e,_.depth=y.h,_.score=y.e[0].cp/100,void 0!==y.e[0].mate&&(_.mate=y.e[0].mate)):(_.score=y.s/100,void 0!==y.mate&&(_.mate=y.mate)),y.v&&(_.bad=!0),_}),i.json)}))},jce}());r.a=y},"./chessboard/src/game/game.lib.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return g}));var o=i("./chessboard/src/game/engine/JCE.js"),a=i("./chessboard/src/game/line.js"),l=i("./chessboard/src/game/index.js"),h=i("./chessboard/src/game/utils.js"),g={createJce:function createJce(t){var r=Object.assign({},t,{analysis:!0});return o.a.createGame(r)||null},updateIdsFromJce:function updateIdsFromJce(t){return t&&t.jce?(t.tree.selected=t.jce.ids(),t):null},getSelectedIds:function getSelectedIds(t){return t.jce.ids()},getPositionInfo:function getPositionInfo(t){var r=o.a.getPositionInfo({game:t.jce},{skipValidation:!0,getLegalMoves:!0});return t.settings.premoves?r.legalPremoves=g.getLegalPremoves(t):r.legalPremoves=[],r},getPositionDetails:function getPositionDetails(t){return Object.assign(o.a.getPositionDetails({game:t.jce,kings:!1,skipValidation:!0}),{hand:g.getHand(t)})},addExtraCastlingMoves:function addExtraCastlingMoves(t){t.setup.legalMoves.forEach((function(r){16!==r.flags&&32!==r.flags||("chess960"===t.variant?g.addCastlingMoves960(t,r):g.addCastlingMoves(t,r))}))},addCastlingMoves:function addCastlingMoves(t,r){var i=1===r.color?1:8;(16===r.flags?[8]:[1,2]).forEach((function(o){t.setup.legalMoves.push({color:r.color,flags:r.flags,piece:"k",from:r.from,san:16===r.flags?"O-O":"O-O-O",to:h.a.getSanFromFileRank({file:o,rank:i})})}))},addCastlingMoves960:function addCastlingMoves960(t,r){for(var i=h.a.getFileRankFromSan(r.from).rank,o=1,a=0;a<2;){var l=h.a.getPieceAt(t,{file:o,rank:i});void 0!==l&&"r"===l.type&&a++,(1===a&&32===r.flags||2===a&&16===r.flags)&&t.setup.legalMoves.push({color:r.color,flags:r.flags,piece:"k",from:r.from,san:16===r.flags?"O-O":"O-O-O",to:h.a.getSanFromFileRank({file:o,rank:i})})}o++},getHeaders:function getHeaders(t){return t.jce.header()},getFen:function getFen(t){return t.jce.fen()},getPgn:function getPgn(t,r){return t.jce.pgn(r)},getPremoves:function getPremoves(t){return t.jce.premoves},getHand:function getHand(t){return t.jce.hand()},getChecks:function getChecks(t){return t.jce.checks()},getLegalPremoves:function getLegalPremoves(t){return o.a.getPremoves(t.jce.premoves&&t.jce.premoves.length>0?t.jce.premoves[t.jce.premoves.length-1].fen:t.jce.fen(),t.setup.playingAs,t.variant)},load:function load(t,r){return t.jce.load(r)&&g.updateIdsFromJce(t),t},loadPgn:function loadPgn(t,r){return t.jce.loadPgn(r)&&g.updateIdsFromJce(t),t},loadPgnSoft:function loadPgnSoft(t,r){if(!t.jce.loadPgn(r)){var i=o.a.createGame({variant:"detect",pgn:r});i&&(r=i.pgn())}return t.jce.loadPgn(r)||g.updateIdsFromJce(t),t},createVariation:function createVariation(t){return t.jce.createVariation()&&(t.jce.reorderLines(),g.updateIdsFromJce(t)),t},getJCEMove:function getJCEMove(t,r){var i=r;return g.isValidMoveObject(r)?(i.san?i=o.a.sanToObj(i.san,g.getFen(t),t.variant):i.tcn&&(i=o.a.decodeTCN(i.tcn)[0]),i):null},move:function move(t,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!r)return null;var o=!1;if(!1===i){var a=r.from?t.jce.get(r.from):null,l=r.to?t.jce.get(r.to):null;if(a&&l&&"k"===l.type)return null;t.jce.remove(r.to),t.jce.remove(r.from);var h=r.drop||r.put;o=t.jce.put(a||{type:h.toLowerCase(),color:h&&h.toUpperCase()===h?1:2},r.to),r.from&&a&&null===r.to&&(o=!0)}else r.drop&&(r.drop=r.drop.toLowerCase()),o=t.jce.move(r);return o&&g.updateIdsFromJce(t),o},selectLine:function selectLine(t,r){var i=a.a.getLine(t.tree.lines,r);return i&&(t.jce.selectLine(r),t.tree.selected={line:r,move:i.length-1}),t},selectNode:function selectNode(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{line:0,move:0};return t.jce.selectPosition(r.move,r.line),t},updateHeaders:function updateHeaders(t,r){return t.jce.header(r)},clear:function clear(t){return t.jce.clear(t.variant)},isFileRankEqual:function isFileRankEqual(t,r){return t.file&&r.file&&t.rank&&r.rank&&t.file===r.file&&t.rank===r.rank},isValidMoveObject:function isValidMoveObject(t){return"string"==typeof t.from&&"string"==typeof t.to||"string"==typeof t.san||"string"==typeof t.tcn||!t.from&&"string"==typeof t.to&&"string"==typeof t.drop||null===t.to&&"string"==typeof t.from||!t.from&&"string"==typeof t.to&&"string"==typeof t.put},movesMatch:function movesMatch(t,r){return!(t.from!==r.from||t.to!==r.to||t.promotion&&t.promotion!==r.promotion||t.drop&&t.drop!==r.drop)},getMoveNumber:function getMoveNumber(t,r){return 1===t?Math.ceil(r/2+1):Math.floor(r/2+1)},isUserTurn:function isUserTurn(t){return t.setup.playingAs===t.setup.sideToMove},getFens:function getFens(t){var r=[t.setup.fen];return(t.tree.lines||i("./web/core/api/move-list/move-list.js").default.state.lines)[0].forEach((function(t){r.push(t.fen)})),r},getLastTcn:function getLastTcn(t){var r=l.a.getTcn(t);return r.substr(r.length-2)},getSanMoves:function getSanMoves(t,r){var o=[];return(t.tree.lines||i("./web/core/api/move-list/move-list.js").default.state.lines)[0].some((function(t,i){return"number"==typeof r&&i>=r||(o.push(t.san),!1)})),o}}},"./chessboard/src/game/game.premoves.lib.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a}));var o=i("./chessboard/src/game/game.lib.js"),a={premove:function premove(t,r){var i=!1;return t.settings.premoves&&!t.settings.analysis&&t.jce.premoves.length<8&&(i=t.jce.premove(r,t.setup.playingAs)),i},cancelPremoves:function cancelPremoves(t){return!!t.jce.premoves.length&&(t.jce.premoves.length=0,!0)},consumePremove:function consumePremove(t){if(t.jce.premoves.length){var r=t.jce.premoves.shift();if(o.a.move(t,r.move)){var i=t.jce.premoves.map((function(t){return t}));t.jce.premoves.length=0;for(var l=0;l<i.length;l+=1){var h=i[l];if(delete h.move.san,!a.premove(t,h.move))break}return!0}}return!1}}},"./chessboard/src/game/history.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a}));var o={ADD_BLINKING_SQUARE:"ADD_BLINKING_SQUARE",CLEAR_ARROW:"CLEAR_ARROW",CLEAR_BLINKING_SQUARE:"CLEAR_BLINKING_SQUARE",CLEAR_EFFECT:"CLEAR_EFFECT",CLEAR_MARKED_SQUARE:"CLEAR_MARKED_SQUARE",INIT:"INIT",LOAD:"LOAD",MAKE_MOVE:"MAKE_MOVE",ILLEGAL_MOVE:"ILLEGAL_MOVE",JUMP_TO_POSITION:"JUMP_TO_POSITION",TREE_CHANGE:"TREE_CHANGE",TREE_AMENDED:"TREE_AMENDED",SETTINGS_CHANGE:"SETTINGS_CHANGE",PGN_HEADERS_UPDATED:"PGN_HEADERS_UPDATED",CANCEL_PREMOVES:"CANCEL_PREMOVES",PREMOVE:"PREMOVE",GUESS_THE_MOVE:"GUESS_THE_MOVE",CANCEL_GUESS_THE_MOVE:"CANCEL_GUESS_THE_MOVE",UPDATE_NODE:"UPDATE_NODE"},a={MAX_HISTORY_LIMIT:200,getInitialHistory:function getInitialHistory(){return[]},add:function add(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t.length>a.MAX_HISTORY_LIMIT-1){var o=t.findIndex((function(t){return null!==t}));t[o]=null}t.push({type:r,payload:i})},getLastItem:function getLastItem(t){return t[t.length-1]}}},"./chessboard/src/game/index.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return K}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./chessboard/src/game/utils.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}var h=i("./chessboard/src/game/game.lib.js"),g=i("./chessboard/src/game/api/select-node.js"),y=i("./chessboard/src/game/history.js"),_=i("./chessboard/src/game/state.js"),x=i("./chessboard/src/game/engine/JCE.js"),w=i("./chessboard/src/game/line.js");function create_variation_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function create_variation_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?create_variation_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):create_variation_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var S=function createVariation(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=create_variation_objectSpread({},t.tree.selected);if(!t.settings.variations)return null;void 0!==i.line&&void 0!==i.move?h.a.selectNode(t,i):i=t.tree.selected;var a=w.a.getNode(t.jce._lines(),{line:i.line,move:i.move}).san;return h.a.createVariation(t),r&&h.a.move(t,a),y.b.add(t.history,y.a.JUMP_TO_POSITION,{from:o,to:i}),_.a.updateState(t)},M=function shouldNotMutateLine(t){return-1!==t.tree.selected.move&&t.settings.mainLineIsImmutable&&w.a.isMainLine(t.tree.selected.line)},T=function isValidMove(t,r){return null!==x.a.getPositionDetails({fen:h.a.getFen(t),variant:h.a.getHeaders(t).Variant||"Chess"},r)},P=function makeMove(t,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=h.a.getJCEMove(t,r);if(null===o)return y.b.add(t.history,y.a.ILLEGAL_MOVE),t;var a=t.settings.analysis||i;if(!w.a.isHead(t.jce._lines(),t.tree.selected)){if(!a)return Object(g.a)(t,w.a.getHeadIds(t.jce._lines(),t.tree.selected.line));var l=w.a.getNextMatchingNode(t.jce._lines(),t.tree.selected,o);if(l)return Object(g.a)(t,l.ids);if(T(t,o)){if(y.b.add(t.history,y.a.TREE_AMENDED),t.settings.variations)return h.a.selectNode(t,{line:t.tree.selected.line,move:t.tree.selected.move+1}),h.a.createVariation(t),_.a.updateState(t),makeMove(t,o);if(!t.settings.mainLineIsImmutable)return w.a.prune(t.jce._lines(),t.tree.selected),makeMove(t,o)}return y.b.add(t.history,y.a.ILLEGAL_MOVE),t}if(!a&&!h.a.isUserTurn(t))return y.b.add(t.history,y.a.ILLEGAL_MOVE),t;if(a&&t.settings.variations&&M(t)&&T(t,o)){var x=w.a.getNextMatchingNode(t.jce._lines(),t.tree.selected,o);return x?Object(g.a)(t,x.ids):(S(t,!0),_.a.updateState(t),makeMove(t,o))}return!M(t)&&h.a.move(t,o,t.settings.rules)?(y.b.add(t.history,y.a.MAKE_MOVE,o),_.a.updateState(t)):(y.b.add(t.history,y.a.ILLEGAL_MOVE),t)},C=function setPlayingAs(t,r){return[1,2].indexOf(r)>=0&&(t.setup.playingAs=r),t},A=i("./chessboard/src/game/api/premoves/index.js"),O=function changeSettings(t,r){var i=Object.prototype.hasOwnProperty.call(r,"premoves")&&t.settings.premoves!==r.premoves;return t.settings=Object.assign(t.settings,r),t.settings.premoves||Object(A.a)(t),y.b.add(t.history,y.a.SETTINGS_CHANGE),i&&_.a.updateState(t),t},L=function loadFromFen(t,r){return r?(w.a.clearAllMarkings(t.jce._lines()),h.a.load(t,r),y.b.add(t.history,y.a.LOAD),_.a.updateState(t)):null},I=function clearMarkings(t,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=w.a.getNode(t.jce._lines(),r)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;return(o.arrows&&o.arrows.length||o.squares&&o.squares.length||o.effects&&o.effects.length)&&(o.arrows=[],o.squares=[],o.effects=[],i&&(_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE))),t},R=function convertFileToInteger(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.charCodeAt(0)-97+1},j=function createGame(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={id:l.a.getId(),variant:t.variant||"chess",settings:Object.assign(_.a.getInitialSettings(),t.settings),setup:Object.assign(_.a.getInitialSetup(),t.setup),tree:Object.assign(_.a.getInitialTree(),t.tree),history:y.b.getInitialHistory(),markings:Object.assign(_.a.getInitialMarkings(),t.markings),premoves:[]};return C(r,t.player||1),Object.defineProperty(r,"jce",{writable:!1,enumerable:!1,configurable:!1,value:h.a.createJce(t)}),h.a.updateIdsFromJce(r),y.b.add(r.history,y.a.INIT),r.jce.siblingGame&&!r.sibling&&(r.sibling={id:l.a.getId(),variant:r.variant||"chess",sibling:r,settings:r.settings,setup:_.a.getInitialSetup(),tree:_.a.getInitialTree(),history:y.b.getInitialHistory(),markings:Object.assign(_.a.getInitialMarkings(),t.markings),premoves:[]},Object.defineProperty(r.sibling,"jce",{writable:!1,enumerable:!1,configurable:!1,value:h.a.createJce({game:r.jce.siblingGame})}),h.a.updateIdsFromJce(r.sibling)),_.a.updateState(r),r},N=i("./chessboard/src/game/move-node/helper.js");function select_line_start_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}var k=function selectLineStart(t){var r=w.a.getSelectedLine(t),i=0,o=function select_line_start_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?select_line_start_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):select_line_start_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({},t.tree.selected);0===t.tree.selected.move&&void 0!==r.parentId?(h.a.selectLine(t,r.parentId),r=w.a.getSelectedLine(t)):w.a.isMainLine(r.id)&&(i=-1);var l={line:r.id,move:i};return h.a.selectNode(t,l),y.b.add(t.history,y.a.JUMP_TO_POSITION,{from:o,to:l}),_.a.updateState(t)},D=function deleteNode(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign(t.tree.selected,r);return i.line>0&&(i.move<=0||w.a.isFirstVisibleNode(t.jce._lines(),i))&&(i.move=-1),t.jce.deletePosition(i.move,i.line),y.b.add(t.history,y.a.TREE_CHANGE),_.a.updateState(t),t},B=function deleteRemainingNodes(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign(t.tree.selected,r);return D(t,{move:i.move+1,line:i.line})},G=function getTcn(t,r){var o=t.jce&&t.jce._lines()||i("./web/core/api/move-list/move-list.js").default.state.lines;return x.a.encodeTCN(w.a.getLine(o,r)||o[0])},H=i("./chessboard/src/game/move-list/helper.js"),V=i("./chessboard/src/game/api/set-hand.js"),U=function loadFromTcn(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.a.getInitialFen(),o=arguments.length>3?arguments[3]:void 0;L(t,i);var a=x.a.decodeTCN(r);return a?(a.forEach((function(r){"Crazyhouse"!==t.variant&&"Bughouse"!==t.variant||!r.drop||Object(V.a)(t,t.setup.sideToMove,r.drop),P(t,r,!0)})),_.a.updateState(t),o?Object(g.a)(t,t.tree.selected,-1):(y.b.add(t.history,y.a.LOAD),t)):null},z=function markArrow(t,r,i){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=w.a.getNode(t.jce._lines(),i)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;return a.arrows||(a.arrows=[]),a.arrows.find((function(t){return h.a.isFileRankEqual(t.fromFileRank,r.fromFileRank)&&h.a.isFileRankEqual(t.toFileRank,r.toFileRank)}))||(a.arrows.push(r),o&&(_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE))),t},W=function markEffect(t){var r=t.game,i=t.effect,o=t.ids,a=t.persist,l=t.updateState,g=void 0===l||l;if(a)return r.setup.effects=i?[i]:null,_.a.updateState(r),r;var x=w.a.getNode(r.jce._lines(),o)||w.a.getNode(r.jce._lines(),h.a.getSelectedIds(r))||r.tree.initialMarkings;return x.effects||(x.effects=[]),x.effects.find((function(t){return h.a.isFileRankEqual(t.square,i.square)}))||(x.effects.push(i),g&&(_.a.updateState(r),y.b.add(r.history,y.a.TREE_CHANGE))),r},q=function markSquare(t,r,i){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=w.a.getNode(t.jce._lines(),i)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;return a.squares||(a.squares=[]),a.squares.find((function(t){return h.a.isFileRankEqual(t,r)}))||(a.squares.push(r),o&&(_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE))),t},$=function fixTcn(t,r){var i=j({variant:t.variant,fen:l.a.getFirstFen(t)});return U(i,r,i.setup.fen),G(i)};function merge_tcn_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function select_line_end_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function select_line_end_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?select_line_end_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):select_line_end_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var X=function selectLineEnd(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.tree.selected.line,i=w.a.getLine(t.jce._lines(),r).length-1,o=select_line_end_objectSpread({},t.tree.selected);if(t.tree.selected.move!==i||r!==t.tree.selected.line){var a={line:r,move:i};return h.a.selectNode(t,a),y.b.add(t.history,y.a.JUMP_TO_POSITION,{from:o,to:a}),_.a.updateState(t)}return t};function reset_to_main_line_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}var K={addBlinkingSquare:function addBlinkingSquare(t,r,i,o){var h=l.a.getId(),g=function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({id:h,interval:r,times:i},o);return t.markings.blinkingSquares.push(g),setTimeout((function(){var r=t.markings.blinkingSquares.findIndex((function(t){return t.id===h}));t.markings.blinkingSquares.splice(r,1)}),0),t},addVariant:function addVariant(t,r){return r?(Object(g.a)(t,{line:0,move:0}),r.match(/.{2}/g).forEach((function(r){return P(t,{tcn:r},!0)})),t):t},canMoveBackward:function canMoveBackward(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===t.tree.selected.line&&t.tree.selected.move-r<-1)return!1;var o=t.tree.lines||i("./web/core/api/move-list/move-list.js").default.state.lines;return null!==w.a.findNode(o,t.tree.selected,-1*r,!1)},canMoveForward:function canMoveForward(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=t.tree.lines||i("./web/core/api/move-list/move-list.js").default.state.lines;return null!==w.a.findNode(o,t.tree.selected,r,!1)},changeSettings:O,clearAnalysis:function clearAnalysis(t){var r=K.resetToMainLine(t),i=w.a.clearAnalysis(r.jce._lines());return r.jce.saveLines(i),y.b.add(r.history,y.a.TREE_CHANGE),_.a.updateState(t)},clearArrow:function clearArrow(t,r,i){var o=w.a.getNode(t.jce._lines(),i)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;o.arrows||(o.arrows=[]);var a=o.arrows.findIndex((function(t){return h.a.isFileRankEqual(t.fromFileRank,r.fromFileRank)&&h.a.isFileRankEqual(t.toFileRank,r.toFileRank)}));return-1!==a&&(o.arrows.splice(a,1),_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE)),t},clearBlinkingSquare:function clearBlinkingSquare(t,r){return t.markings.blinkingSquares[r]&&delete t.markings.blinkingSquares[r],t},clearBoard:function clearBoard(t){return O(t,{rules:!1}),L(t,"8/8/8/8/8/8/8/8 w - - 0 1"),y.b.add(t.history,y.a.LOAD),_.a.updateState(t)},clearEffect:function clearEffect(t,r,i){var o=w.a.getNode(t.jce._lines(),i)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;o.effects||(o.effects=[]);var a=o.effects.findIndex((function(t){return h.a.isFileRankEqual(t.square,r.square)}));return-1!==a&&(o.effects.splice(a,1),_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE)),t},clearMarkedSquare:function clearMarkedSquare(t,r,i){var o=w.a.getNode(t.jce._lines(),i)||w.a.getNode(t.jce._lines(),h.a.getSelectedIds(t))||t.tree.initialMarkings;o.squares||(o.squares=[]);var a=o.squares.findIndex((function(t){return h.a.isFileRankEqual(t,r)}));return-1!==a&&(o.squares.splice(a,1),_.a.updateState(t),y.b.add(t.history,y.a.TREE_CHANGE)),t},clearMarkings:I,clearNodes:function clearNodes(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.jce._lines();if(!i)return t;if(void 0===r.line&&void 0===r.move)return i.forEach((function(t){t.forEach((function(t,r){return w.a.clearNode(i,{line:t.ids.line,move:r})}))})),y.b.add(t.history,y.a.TREE_CHANGE),t;if(void 0===r.move){var o=w.a.getLine(t.jce._lines(),r.line);return o?(o.forEach((function(t,r){return w.a.clearNode(i,{line:o.id,move:r})})),y.b.add(t.history,y.a.TREE_CHANGE),t):t}return w.a.getNode(i,r)?(w.a.clearNode(i,r),y.b.add(t.history,y.a.TREE_CHANGE),t):t},convertLanToFileRanks:function convertLanToFileRanks(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{fromFileRank:{file:R(t[0]),rank:Number(t[1])},toFileRank:{file:R(t[2]),rank:Number(t[3])}}},createGame:j,createVariation:S,deleteLine:function deleteLine(t,r){return t.jce.deletePosition(-1,r)?(y.b.add(t.history,y.a.TREE_CHANGE),_.a.updateState(t),t):null},deleteNode:D,deleteRemainingNodes:B,getCurrentFullLine:function getCurrentFullLine(t){var r=t.jce._history().length-t.jce.ids().move-1,i=t.jce.history(!0);return 0===r?i:i.slice(0,-r)},getPgn:function getPgn(t,r){return h.a.getPgn(t,r)},getPgnHeaders:function getPgnHeaders(t){return h.a.getHeaders(t)},getSelectedNode:function getSelectedNode(t){return w.a.getSelectedNode(t)},getTcn:G,isMoveLegal:function isMoveLegal(t,r){var i=!1;if(!t.settings.rules)return!0;for(var o=0;o<t.setup.legalMoves.length;o++){var a=t.setup.legalMoves[o];if(a.from===r.from&&a.to===r.to){i=!0;break}}return i},loadFromFen:L,loadFromLan:function loadFromLan(t,r,i,o){var a=r.map((function(t){return x.a.encodeTCN({from:t.slice(0,2),to:t.slice(2,4),promotion:t.slice(4,5)||void 0})})).join("");return K.loadFromTcn(t,a,i,o)},loadFromPgn:function loadFromPgn(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!r)return t;var a=Object(H.b)(r);return o&&!t.jce.loadPgn(a)?h.a.loadPgnSoft(t,a):h.a.loadPgn(t,a),_.a.updateState(t),i?Object(g.a)(t,t.tree.selected,i):(y.b.add(t.history,y.a.LOAD),t)},loadFromSanMoves:function loadFromSanMoves(t,r,i,o){return r&&r.length?(i&&h.a.load(t,i),r.forEach((function(r){return P(t,{san:r},!0)})),_.a.updateState(t),o?Object(g.a)(t,t.tree.selected,-1):(y.b.add(t.history,y.a.LOAD),t)):null},loadFromTcn:U,makeMove:P,makeOpponentMove:function makeOpponentMove(t,r){return C(t,3-t.setup.playingAs),P(t,r),C(t,3-t.setup.playingAs),_.a.updateState(t)},markArrow:z,markEffect:W,markSquare:q,mergeTcn:function mergeTcn(t,r,i){if("string"!=typeof r||t.settings.mainLineIsImmutable)return null;if(""===r)return k(t),U(t,"",t.setup.fen);var o=function merge_tcn_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?merge_tcn_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):merge_tcn_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({},t.tree.selected),l=G(t),h=r,_=t.history.length-1;if(!(l.includes(h)||h.includes(l)||(l=$(t,l),h=$(t,h),l.includes(h)||h.includes(l))))return U(t,h);if(h.length<l.length)Object(g.a)(t,{line:0,move:h.length/2-1}),B(t);else{if(!(h.length>l.length))return t;var S;if(Object(g.a)(t,{line:0,move:l.length/2-1}),h.slice(l.length).match(/.{2}/g).forEach((function(r){S=x.a.decodeTCN(r)[0],"Crazyhouse"!==t.variant&&"Bughouse"!==t.variant||!S.drop||Object(V.a)(t,t.setup.sideToMove,S.drop),P(t,S,!0)})),t.history.slice(_+1).some((function(t){return t&&t.type===y.a.ILLEGAL_MOVE})))return Object(g.a)(t,o),B(t),t.history=t.history.slice(0,_),mergeTcn(t,$(t,h))}if(i)return Object(g.a)(t,t.tree.selected,-1);if(o.line!==t.tree.selected.line||o.move!==t.tree.selected.move){var M=w.a.getNode(t.jce._lines(),o)?o:t.tree.selected;return Object(g.a)(t,M)}return t},moveBackward:function moveBackward(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(g.a)(t,t.tree.selected,-1*r,!1)},moveForward:function moveForward(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(g.a)(t,t.tree.selected,r,!1)},moveToEnd:function moveToEnd(t){return w.a.isMainLine(t.tree.selected.line)||h.a.selectLine(t,0),X(t),_.a.updateState(t)},moveToStart:function moveToStart(t){return w.a.isMainLine(t.tree.selected.line)||h.a.selectLine(t,0),k(t),_.a.updateState(t)},moveVariation:function moveVariation(t,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=w.a.getLine(t.jce._lines(),r);if(o&&void 0!==o.parentId){var a=w.a.getLine(t.jce._lines(),o.parentId)[o.atMoveNode],l=-1;if(a.lines.forEach((function(t,i){r===t&&(l=i)})),l>-1){var h=null;i&&l>0?(h=a.lines[l-1],a.lines[l-1]=r,a.lines[l]=h):!i&&l<a.lines.length-1&&(h=a.lines[l+1],a.lines[l+1]=r,a.lines[l]=h)}y.b.add(t.history,y.a.TREE_CHANGE)}return t},promoteVariation:function promoteVariation(t,r){var i=r;void 0===i&&(i=t.tree.selected);var o=w.a.getLine(t.jce._lines(),i.line);if(o&&void 0!==o.parentId)for(var a=i.move,l=function _loop(){if(t.settings.mainLineIsImmutable&&w.a.isMainLine(o.parentId))return"break";var r=w.a.getLine(t.jce._lines(),o.parentId),i=w.a.isContinuation(t.jce._lines(),o.id)?1:0,l=o[i]&&o[i].commentBefore,g=o.atMoveNode,y=o.slice(0);o.length=0,l&&r[g-1]&&(r[g-1].comment?(" "!==r[g-1].comment.substr(-1)&&(r[g-1].comment+=" "),r[g-1].comment+=l):r[g-1].comment=l,delete y[i].commentBefore,delete o.initComment);var _=r.slice(g),x=_[0].lines.map((function(t){return t}));delete _[0].lines,_.forEach((function(r,i){r.lines&&r.lines.length&&r.lines.forEach((function(r){var a=w.a.getLine(t.jce._lines(),r);a.parentId=o.id,a.atMoveNode=i}))})),r.length=g,y.forEach((function(i){i.ids={line:r.id,move:r.length},i.lines&&i.lines.length&&i.lines.forEach((function(i){var o=w.a.getLine(t.jce._lines(),i);o.parentId=r.id,o.atMoveNode=r.length})),r.push(i)})),_.forEach((function(t,r){t.ids={line:o.id,move:r},o.push(t)})),r[g].lines=x,r[g].lines.forEach((function(i){w.a.getLine(t.jce._lines(),i).parentId=r.id})),h.a.selectNode(t,{line:r.id,move:g+a}),o=w.a.getLine(t.jce._lines(),o.parentId),a=g+a};void 0!==o.parentId;){if("break"===l())break}return t.jce.saveLines(t.tree.lines),y.b.add(t.history,y.a.TREE_CHANGE),_.a.updateState(t)},resetToMainLine:function resetToMainLine(t){var r=function reset_to_main_line_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?reset_to_main_line_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):reset_to_main_line_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({},t.tree.selected);w.a.isMainLine(t.tree.selected.line)||h.a.selectLine(t,0),X(t);var i=t.tree.selected;return t.tree.lines.length=1,t.tree.lines=w.a.rebuildIds(t.tree.lines),t.jce.saveLines(t.tree.lines),y.b.add(t.history,y.a.JUMP_TO_POSITION,{from:r,to:i}),_.a.updateState(t)},selectLineEnd:X,selectLineStart:k,selectNode:g.a,setPlayingAs:C,updateMarkings:function updateMarkings(t){var r=t.arrow,i=t.effect,o=t.game,a=t.ids,l=t.square,h=t.resetFirst,g=!1;return(void 0===h||h)&&I(o,a,g),r&&z(o,r,a,g),i&&W({game:o,effect:i,ids:a,updateState:g}),l&&q(o,l,a,g),_.a.updateState(o),y.b.add(o.history,y.a.TREE_CHANGE),o},updateNode:function updateNode(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,o=t.jce._lines(),a=w.a.findNode(o,r);if(!a||!i||i.commentBefore&&!w.a.isFirstVisibleNode(o,r))return null;var l=w.a.getLine(o,r.line);if(void 0===i.commentBefore&&w.a.isFirstVisibleNode(o,r)?delete l.initComment:i.commentBefore&&(l.initComment=i.commentBefore),i.insertCommentAfterLastNode&&l.length){var h=l[l.length-1];h&&(h.comment=i.insertCommentAfterLastNode,delete i.insertCommentAfterLastNode)}if(i.annotation&&(i.annotation=Object(N.b)(a,i.annotation)?"":Object(N.v)(i.annotation)),i.additionalAnnotation){if(!Object(N.o)(i.additionalAnnotation))return null;Object(N.a)(a,i.additionalAnnotation)&&(i.additionalAnnotation=[]),i.additionalAnnotation=[].concat(Object(N.v)(i.additionalAnnotation))}return Object.assign(a,i),y.b.add(t.history,y.a.UPDATE_NODE,{line:r.line,move:r.move}),_.a.updateState(t)},updatePgnHeaders:function updatePgnHeaders(t,r){if(!r)return null;var i=Object.keys(r).reduce((function(t,i){return"Date"===i&&"number"==typeof r[i]&&(r[i]=l.a.formatJSTimestampForPgn(r[i])),t.push(i),t.push(r[i]),t}),[]);return h.a.updateHeaders(t,i),y.b.add(t.history,y.a.PGN_HEADERS_UPDATED),t.setup.result=_.a.getResult(t),t}}},"./chessboard/src/game/line.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o={getLine:function getLine(t,r){return t[r]||null},getNode:function getNode(t,r,i){if("number"==typeof r){if(void 0!==i){var a=o.getLine(t,Math.max(0,r));return a?a[i]:null}return null}if(!r)return null;var l=o.getLine(t,Math.max(0,r.line));return l?l[r.move]:null},getSelectedLine:function getSelectedLine(t){return o.getLine(t.jce._lines(),t.tree.selected.line)},getSelectedNode:function getSelectedNode(t){return o.getNode(t.jce._lines(),t.tree.selected)},nodeIsSelected:function nodeIsSelected(t,r){return!!(r||r.line||r.move)&&(t.selected.line===r.line&&t.selected.move===r.move)},getLinesFromJce:function getLinesFromJce(t){return o.formatLinesFromJce(t.jce._lines())},getJceSelectedLine:function getJceSelectedLine(t){return t._lines()[t._history().id]},formatLinesFromJce:function formatLinesFromJce(t){return o.consolidateComments(t)},consolidateComments:function consolidateComments(t){return t.map((function(r){var i=o.isContinuation(t,r.id)?o.getNode(t,r.id,1):o.getNode(t,r.id,0);return i?(r.initComment&&(i.commentBefore=r.initComment),r):r}))},isContinuation:function isContinuation(t,r){var i=o.getLine(t,r);if(!i)return!1;if(void 0!==i.parentId&&void 0!==i[0]){var a=o.getNode(t,i.parentId,i.atMoveNode);return!(!a||!a.move)&&a.move===i[0].move}return!1},isMainLine:function isMainLine(t){return 0===t},getNextNodeIds:function getNextNodeIds(t,r){return!t||t.move+r<0?null:{line:t.line,move:t.move+r}},getNextContinuationLineId:function getNextContinuationLineId(t,r){var i=o.getNode(t,r);if(!i||!i.lines)return null;var a=i.lines.find((function(r){return o.isContinuation(t,r)}));return-1!==a?a:null},getParentNode:function getParentNode(t,r){var i={line:t[r.line].parentId,move:t[r.line].atMoveNode};return o.findNode(t,i)},getParentNodeIds:function getParentNodeIds(t,r){var i=o.getLine(t,r.line);return i&&void 0!==i.parentId?{line:i.parentId,move:i.atMoveNode}:null},deleteRemainingNodes:function deleteRemainingNodes(t,r){return t?(t.length=r+1,t):null},deleteNode:function deleteNode(t,r){return o.prune(t,{line:r.line,move:r.move-1})},deleteLine:function deleteLine(t,r){var i=o.getLine(t,r);if(void 0!==i.parentId){var a=o.getNode(t,{line:i.parentId,move:i.atMoveNode});a.lines=a.lines.filter((function(t){return t!==r})),0===a.lines.length&&delete a.lines}var l=t.filter((function(t){return o.isMainLine(t.id)||t.id!==r}));return o.rebuildIds(l)},rebuildIds:function rebuildIds(t){var r=[];return t.forEach((function(t,i){t.id!==i&&(r[t.id]=i)})),t.map((function(i){return i.id=void 0!==r[i.id]?r[i.id]:i.id,void 0!==r[i.parentId]&&(i.parentId=r[i.parentId]),i.forEach((function(i){i.ids.line=void 0!==r[i.ids.line]?r[i.ids.line]:i.ids.line,i.lines&&i.lines.length>0&&(i.lines=i.lines.map((function(t){return void 0!==r[t]?r[t]:t})).filter((function(r){return void 0!==t[r]})),0===i.lines.length&&delete i.lines)})),i}))},prune:function prune(t,r){return o.getNode(t,{line:r.line,move:r.move+1})?(t[r.line]=o.deleteRemainingNodes(t[r.line],r.move),!o.isMainLine(r.line)&&o.isFirstVisibleNode(t,r)&&t.splice(t.findIndex((function(t){return t.id===r.line})),1),t.sort((function(t,r){return t.id-r.id})).reduce((function(t,r){var i=o.getNode(t,{line:r.parentId,move:r.atMoveNode});return(o.isMainLine(r.id)||i)&&t.push(r),t}),[])):t},isFirstNodeInTree:function isFirstNodeInTree(t){return 0===t.line&&-1===t.move},isFirstVisibleNode:function isFirstVisibleNode(t,r){return o.isContinuation(t,r.line)?1===r.move:0===r.move},isFirstNodeInLine:function isFirstNodeInLine(t,r){return r&&t&&t[r.line]&&t[r.line][0]&&t[r.line][0].ids&&t[r.line][0].ids.line===r.line&&t[r.line][0].ids.move===r.move},isHead:function isHead(t,r){return r&&t[r.line].length-1===r.move||!1},getHeadIds:function getHeadIds(t,r){return{line:r,move:t[r].length-1}},nodeMatchesMove:function nodeMatchesMove(t,r,i){var a=o.getNode(t,r);return!!a&&(a.from===i.from&&a.to===i.to&&(a.promotion||null)===(i.promotion||null))},shouldMatchMove:function shouldMatchMove(t,r,i){return t&&1===r&&0===i},getNextMatchingNode:function getNextMatchingNode(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=o.getNode(t,r),l=o.getNode(t,r.line,r.move+1),h=t.reduce((function(t,r){return t.concat(r)}),[]).filter((function(t){return a&&t.moveNumber===a.moveNumber+1||l&&t.moveNumber===l.moveNumber})).filter((function(r){return!!(a&&r.ids.line===a.ids.line||l&&r.ids.line===l.ids.line)||(!!(a&&a.lines&&-1!==a.lines.indexOf(r.ids.line)&&o.isContinuation(t,r.ids.line))||!(!l||!l.lines||-1===l.lines.indexOf(r.ids.line)||o.isContinuation(t,r.ids.line)))})).filter((function(r){return o.nodeMatchesMove(t,r.ids,i)})).sort((function(t,r){return t.ids.line-r.ids.line}))[0];return h||null},clearNode:function clearNode(t,r){var i=o.getNode(t,r);return i?(delete i.comment,delete i.annotation,i):null},findNode:function findNode(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!t||void 0===i.line)return null;if("string"==typeof a)switch(i.move){case"begin":i.move=0;break;case"end":i.move=t[0].length-1}else if(void 0===i.move)return t[i.line];return a&&0!==Math.abs(a)&&(i=new Array(Math.abs(a)).fill(a/Math.abs(a)).reduce((function(i,a){if(null===i)return null;var h=o.isContinuation(t,i.line),g=o.getNextNodeIds(i,a);if(o.getNode(t,g)&&(-1!==a||!h||0!==g.move))return g;switch(a){case 1:return l?i:null!==(r=o.getNextContinuationLineId(t,i))?{line:r,move:1}:null;case-1:return g=h?o.getParentNodeIds(t,i):o.getNextNodeIds(o.getParentNodeIds(t,i),-1),o.getNode(t,g)?g:i;default:return null}}),i)),o.getNode(t,i)||null},clearNodeMarkings:function clearNodeMarkings(t,r){var i=o.getNode(t,r);return i?(delete i.squares,delete i.arrows,delete i.effects,i):null},clearNodeAnalysis:function clearNodeAnalysis(t,r){var i=o.getNode(t,r);return i?(delete i.comment,delete i.annotation,delete i.additionalAnnotation,i):null},clearAllMarkings:function clearAllMarkings(t){return t?(t.forEach((function(r){r.length>0&&r.forEach((function(r){return o.clearNodeMarkings(t,{line:r.ids.line,move:r.ids.move})}))})),t):null},clearAnalysis:function clearAnalysis(t){return t?(t.forEach((function(r){r.length>0&&r.forEach((function(r){return o.clearNodeAnalysis(t,{line:r.ids.line,move:r.ids.move})}))})),t):null}}},"./chessboard/src/game/move-list/helper.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return l})),i.d(r,"b",(function(){return h})),i.d(r,"c",(function(){return g}));var o=i("./web/core/api/move-list/config.js"),a=i("./chessboard/src/game/move-node/helper.js"),l=function hasTreeLines(t){return Boolean(t&&t.tree&&t.tree.lines)},h=function normalizePgnAnnotation(t){return Object.keys(o.c).forEach((function(r){t=t.replace(new RegExp("\\".concat(r,"\\b"),"gm"),Object(a.v)(r))})),t},g=function updateScrollPosition(t){var r=t.moveIds,i=t.moveList,o=t.scrollEl;if(r&&i&&o){var a=i.getComponentRefByLineMove(r.line,r.move);if(a){var l=o.getBoundingClientRect(),h=a.$el?a.$el.getBoundingClientRect():a.getBoundingClientRect(),g=o.scrollTop,y=l.top+Math.floor(l.height/2)-h.top;o.scrollTop=g-y}}}},"./chessboard/src/game/move-node/helper.js":function(t,r,i){"use strict";i.d(r,"v",(function(){return h})),i.d(r,"a",(function(){return g})),i.d(r,"b",(function(){return y})),i.d(r,"o",(function(){return _})),i.d(r,"g",(function(){return x})),i.d(r,"h",(function(){return w})),i.d(r,"i",(function(){return S})),i.d(r,"j",(function(){return M})),i.d(r,"k",(function(){return T})),i.d(r,"l",(function(){return P})),i.d(r,"p",(function(){return C})),i.d(r,"n",(function(){return A})),i.d(r,"q",(function(){return O})),i.d(r,"r",(function(){return L})),i.d(r,"s",(function(){return I})),i.d(r,"t",(function(){return R})),i.d(r,"u",(function(){return j})),i.d(r,"c",(function(){return N})),i.d(r,"d",(function(){return k})),i.d(r,"f",(function(){return D})),i.d(r,"m",(function(){return B})),i.d(r,"e",(function(){return displayNumber}));var o=i("./chessboard/src/game/line.js"),a=i("./web/core/api/move-list/config.js"),l=i("./web/core/api/move-list/context-menu/config.js"),h=function normalizeAnnotation(t){return Object.prototype.hasOwnProperty.call(a.c,t)||Object.prototype.hasOwnProperty.call(a.b,t)?_(t)?a.c[t]:normalizeAnnotation(a.b[t]):t||""},g=function additionalAnnotationExists(t,r){return t.additionalAnnotation&&Array.isArray(t.additionalAnnotation)&&h(t.additionalAnnotation[0])===h(r)},y=function annotationExists(t,r){return h(t.annotation)===h(r)},_=function isNagFormat(t){return t&&"$"===t.charAt(0)},x=function hasAdditionalAnnotation(t){return t.additionalAnnotation&&t.additionalAnnotation[0]},w=function hasAnnotation(t){return Object.prototype.hasOwnProperty.call(t,"annotation")},S=function hasComment(t){return Boolean(t&&"string"==typeof t.comment)},M=function hasCommentBefore(t){return Boolean(t&&"string"==typeof t.commentBefore)},T=function hasLines(t){return Boolean(t&&t.lines&&t.lines.length)},P=function isEnPassant(t){return 4===t.flags},C=function isOnFirstLineOfParent(t,r){return t.ids.line===r.lines[0]},A=function isLastMoveOnLine(t,r){return t.ids.move===r.lines[t.ids.line].length-1},O=function isOnLastLineOfParent(t,r){return t.ids.line===r.lines[r.lines.length-1]},L=function isOnMainLine(t){return o.a.isMainLine(t.ids.line)},I=function nodeIsALimit(t,r,i){return Object.prototype.hasOwnProperty.call(t,i)&&Object.prototype.hasOwnProperty.call(t[i],"ids")&&t[i].ids.move===r.ids.move&&t[i].ids.line===r.ids.line},R=function nodeIsAfterNodeLimitEnd(t,r){var i=t[l.g.END];return!(!i||!Object.prototype.hasOwnProperty.call(i,"ids"))&&(r.ids.line>i.ids.line||r.ids.line===i.ids.line&&r.ids.move>i.ids.move)},j=function nodeIsBeforeLimitBegin(t,r){var i=t[l.g.BEGIN];return!(!i||!Object.prototype.hasOwnProperty.call(i,"ids"))&&(r.ids.line<t.begin.ids.line||r.ids.line===t.begin.ids.line&&r.ids.move<t.begin.ids.move)},N=function canBeDeleted(t,r){return!(r&&L(t))},k=function cleanCommentString(t){var r;return" "===(r=(r=t.replace(/<\/?[^>]+(>|$)/g,"")).replace(/&nbsp;/g," "))&&(r=""),r},D=function generateAnnotationString(t){var r,i,o="";return t.annotation&&(o="".concat(o).concat(h(t.annotation))),1===(null===(r=t.additionalAnnotation)||void 0===r?void 0:r.length)&&(o="".concat(o,"&nbsp;").concat(h(t.additionalAnnotation[0]))),(null===(i=t.additionalAnnotation)||void 0===i?void 0:i.length)>1&&(o="".concat(o,"&nbsp;").concat(h(t.additionalAnnotation.join("")))),o},B=function isFirstNodeOnFormattedLine(t){return 0===t.ids.move};function displayNumber(t,r){var i="";return function shouldShowDisplayNumber(t){return Boolean(t.isWhite||t.isFirstNodeOnLine||t.previousHasComment||t.previousHasLines)}(t)&&(i+="".concat(t.nodeMoveNumber+(r-1),"."),function shouldShowEllipsisOnBlackMoveNumber(t){return Boolean(!t.isWhite&&(t.previousHasComment||t.previousHasLines||t.isFirstNodeOnLine))}(t)&&(i+=".."),i+="&nbsp;"),i}},"./chessboard/src/game/state.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return _}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./chessboard/src/game/line.js"),h=i("./chessboard/src/game/game.lib.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var g={},y={q:9,r:5,b:3,n:3,p:1,k:0},_={getInitialSettings:function getInitialSettings(){return{variations:!1,analysis:!1,mainLineIsImmutable:!1,rules:!0,premoves:!1,GTM:!1}},getInitialSetup:function getInitialSetup(){return{ranks:8,files:8}},getInitialTree:function getInitialTree(){return{initialMarkings:{arrows:[],effects:[],squares:[]}}},getInitialMarkings:function getInitialMarkings(){return{arrows:[],blinkingSquares:[],effects:[],squares:[]}},clearState:function clearState(t){return t.setup=_.getInitialSetup(),t},updateState:function updateState(t){t.setup=Object.assign({},t.setup,h.a.getPositionInfo(t),h.a.getPositionDetails(t)),h.a.addExtraCastlingMoves(t),t.tree.lines=l.a.getLinesFromJce(t),t.tree.selected=t.jce.ids(),t.tree.selectedNode=l.a.getSelectedNode(t),t.setup.capturedPieces=_.getCapturedPieces(t.setup),t.setup.capturedScores=_.getCapturedScores(t.setup),t.setup.result=_.getResult(t),t.premoves=h.a.getPremoves(t),t.variant=h.a.getHeaders(t).Variant||t.variant,t.startingMoveNumber=t.setup.moveNumber;var r=l.a.getNode(t.tree.lines,h.a.getSelectedIds(t))||t.tree.initialMarkings;return r&&(t.markings.squares=r.squares?r.squares.map((function(t){return _objectSpread({},t)})):[],t.markings.arrows=r.arrows?r.arrows.map((function(t){return _objectSpread({},t)})):[],t.setup.effects?t.markings.effects=t.setup.effects:r.effects?t.markings.effects=r.effects.map((function(t){return _objectSpread({},t)})):t.markings.effects=[]),g[t.id]=!0,t.sibling&&!g[t.sibling.id]&&(t.sibling=_.updateState(t.sibling)),g={},t},getCapturedPieces:function getCapturedPieces(t){return t.pieces.reduce((function(t,r){if("k"===r.type)return t;var i=r.promoted?"p":r.type;return t[r.color-1][i]-=1,t}),[{p:8,n:2,b:2,r:2,q:1},{p:8,n:2,b:2,r:2,q:1}])},getCapturedScores:function getCapturedScores(t){return t.pieces.reduce((function(t,r){return t[r.color-1]+=y[r.type],t}),[0,0])},getResult:function getResult(t){var r=h.a.getHeaders(t).Result;return"*"!==r?r:t.setup.insufficient||t.setup.stalemate?"1/2-1/2":t.setup.gameOver&&!t.setup.draw?1===t.setup.sideToMove?"0-1":"1-0":"*"}}},"./chessboard/src/game/utils.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return g}));var o=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),a=i.n(o),l=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),h=i.n(l);function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){h()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var g={getId:function getId(t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array(t||20).fill().reduce((function(t){return t+r.charAt(Math.floor(Math.random()*r.length))}),"")},getInitialFen:function getInitialFen(){return"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},formatJSTimestampForPgn:function formatJSTimestampForPgn(t){var r=new Date(t),i="0".concat(r.getUTCDate()).slice(-2),o="0".concat(r.getUTCMonth()+1).slice(-2);return"".concat(r.getFullYear(),"-").concat(o,"-").concat(i)},getSanFromFileRank:function getSanFromFileRank(t){return t&&t.file&&t.rank?String.fromCharCode(96+t.file)+t.rank.toString():null},getFileRankFromSan:function getFileRankFromSan(t){return t?{file:t.toLowerCase().charCodeAt(0)-96,rank:Number(t.charAt(1))}:null},getPieceAt:function getPieceAt(t,r){return t.setup.pieces.find((function(t){return t.file===r.file&&t.rank===r.rank}))},cloneGame:function cloneGame(t){return{id:t.id,variant:t.variant,jce:t.jce,tree:g.cloneTree(t.tree),setup:JSON.parse(JSON.stringify(t.setup)),markings:_objectSpread({},t.markings),settings:_objectSpread({},t.settings),history:a()(t.history),premoves:t.premoves.map((function(t){return JSON.parse(JSON.stringify(t))}))}},cloneTree:function cloneTree(t){return _objectSpread(_objectSpread({},t),{},{initialMarkings:JSON.parse(JSON.stringify(t.initialMarkings)),selected:_objectSpread({},t.selected),selectedNode:t.selectedNode?_objectSpread(_objectSpread({},t.selectedNode),{},{ids:_objectSpread({},t.selectedNode.ids),hash:a()(t.selectedNode.hash),lines:t.selectedNode.lines&&a()(t.selectedNode.lines),arrows:t.selectedNode.arrows&&a()(t.selectedNode.arrows)}):null})},getFirstFen:function getFirstFen(t){return t.tree.lines[0].length?t.tree.lines[0][0].beforeFen:t.setup.fen}}},"./core/board-layout/api/toggle-body-class.ts":function(t,r,i){"use strict";i.d(r,"a",(function(){return toggleBodyClass}));var o=i("./utils/types.ts");function toggleBodyClass(t,r){var i=document.body.classList;(Object(o.b)(r)?r:!i.contains(t))?i.add(t):i.remove(t)}},"./core/navigation/config/targets.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./core/navigation/config/targets.js")},"./core/utils/dom/copy-to-clipboard.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o=function copyCustomValueToClipboard(t){var r=document.createElement("input");r.value=t,document.body.appendChild(r),function copyInputValueToBuffer(t){t&&(t.focus({preventScroll:!0}),t.select(),document.execCommand("copy"))}(r),document.body.removeChild(r)}},"./core/utils/features/constants.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o={ADMIN_USER_LIVE_CHESS_PRIORITY:"data-admin-user-live-chess-priority",ANALYSIS_GAME_PGN_SUPPORT:"data-feature-game-analysis-support-for-game-pgn",ADS_PLAYWIRE_INTEGRATION:"data-feature-ads-playwire-integration",CHESSBOARD_BETA:"data-feature-chessboard-beta",CHESSBOARD_REPORTING_PLUGIN:"data-feature-chessboard-reporting-plugin",CHESS_TODAY:"data-feature-chess-today",CHESS_VARIANTS:"data-feature-chess-variants",DE_NEW_CHESSBOARD:"data-diagram-editor-new-chessboard-migration",EVENTS_REDIRECT:"data-feature-events-redirect",GAME_OF_THE_DAY:"data-feature-game-of-the-day-widget",IS_LIVE:"data-is-live",IS_NOT_MESSAGEABLE_REASON:"data-feature-is-not-messageable-reason",LEADERBOARD_TREND:"data-feature-leaderboard-trend",LESSONS_BOOKMARKS:"data-feature-lessons-bookmarks",LIBRARY:"data-feature-library",MULTI_PGN_VIEWER:"data-feature-multi-pgn-viewer",FORM_CHIPS_NEW_DS:"data-feature-form-chips-new-ds",NEW_GAME_MODAL_USE_PLAY_ONLINE:"data-new-game-modal-use-play-online",PAGE_WITH_NEW_CHESSBOARD_AND_DIAGRAMS_IN_COMMENTS:"data-feature-page-with-new-chessboard-and-diagrams-in-comments",PAYMENTS_PURCHASE_WITH_TAX:"data-feature-payments-purchase-with-tax",PGN_ANNOTATIONS:"data-feature-pgn-annotation-for-download",PLATFORM_USER_NOTICES:"data-feature-platform-user-notices",PLAY_ONLINE:"data-feature-play-online",PLAY_RCN:"data-feature-play-rcn",PAYMENTS_PAYU_REDIRECT:"data-feature-payments-payu-redirect",PUZZLE_RESET:"data-feature-puzzle-reset",PUZZLE_RUSH_LEADERBOARD_FIX:"data-feature-puzzle-rush-leaderboard-fix",OLD_BOARD_IMAGE_SIZE_150:"data-feature-old-board-image-size-150",REGISTER_FACEBOOK:"data-feature-register-facebook",REDIRECT_TO_WEB_PAGE_PLAY:"data-feature-redirect-to-web-page-play",SEO_EXIT_RETENTION_MODAL:"data-feature-seo-exit-retention-modal",SEO_FIRST_TIME_MODAL:"data-feature-seo-first-time-modal",V5_NEW_FRIENDS_REDESIGN:"data-feature-v5-new-friends-redesign",V5_NEW_CLUBS_PAGES:"data-feature-v5-new-clubs-pages",V5_PROFILE_HEADER:"data-feature-v5-profile-header"}},"./core/utils/features/index.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return h}));var o=i("./core/navigation/config/targets.js"),a={},l=document.getElementById(o.targets.NAV_ROOT),h=function hasFeatureAccess(t,r){var i=r||l;return a[t]||(a[t]=Boolean(i&&i.getAttribute(t))),a[t]}},"./live/src/es6/browser/window.js":function(t,r,i){"use strict";(function(t){var i="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};r.a=i}).call(this,i("./node_modules/webpack/buildin/global.js"))},"./live/src/es6/core/timer.utils.js":function(t,r,i){"use strict";var o=i("./live/src/es6/browser/window.js"),a={};["setTimeout","setInterval","clearTimeout","clearInterval"].forEach((function(t){a[t]=o.a[t].bind(o.a)})),r.a=a},"./live/src/es6/core/type.utils.js":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/typeof.js"),a=i.n(o);function isNull(t){return null===t}function isUndefined(t){return void 0===t}function isObject(t){return!isNull(t)&&"object"===a()(t)}r.a={isString:function isString(t){return"string"==typeof t},isFunction:function isFunction(t){return"function"==typeof t},isNumber:function isNumber(t){return"number"==typeof t},isNil:function isNil(t){return isNull(t)||isUndefined(t)},isObject:isObject,isPlainObject:function isPlainObject(t){return!!isObject(t)&&(t.constructor&&"Object"===t.constructor.name)},isArray:function isArray(t){return Array.isArray(t)},isError:function isError(t){if(!isObject(t))return!1;var r=Object.prototype.toString.call(t);return"[object Error]"===r||"[object DOMException]"===r},isUndefined:isUndefined}},"./node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(t,r){t.exports=function _arrayWithHoles(t){if(Array.isArray(t))return t}},"./node_modules/@babel/runtime/helpers/asyncToGenerator.js":function(t,r){function asyncGeneratorStep(t,r,i,o,a,l,h){try{var g=t[l](h),y=g.value}catch(_){return void i(_)}g.done?r(y):Promise.resolve(y).then(o,a)}t.exports=function _asyncToGenerator(t){return function(){var r=this,i=arguments;return new Promise((function(o,a){var l=t.apply(r,i);function _next(t){asyncGeneratorStep(l,o,a,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(l,o,a,_next,_throw,"throw",t)}_next(void 0)}))}}},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/classCallCheck.js")},"./node_modules/@babel/runtime/helpers/createClass.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/createClass.js")},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/defineProperty.js")},"./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(t,r){t.exports=function _iterableToArrayLimit(t,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],o=!0,a=!1,l=void 0;try{for(var h,g=t[Symbol.iterator]();!(o=(h=g.next()).done)&&(i.push(h.value),!r||i.length!==r);o=!0);}catch(y){a=!0,l=y}finally{try{o||null==g.return||g.return()}finally{if(a)throw l}}return i}}},"./node_modules/@babel/runtime/helpers/nonIterableRest.js":function(t,r){t.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},"./node_modules/@babel/runtime/helpers/slicedToArray.js":function(t,r,i){var o=i("./node_modules/@babel/runtime/helpers/arrayWithHoles.js"),a=i("./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),l=i("./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js"),h=i("./node_modules/@babel/runtime/helpers/nonIterableRest.js");t.exports=function _slicedToArray(t,r){return o(t)||a(t,r)||l(t,r)||h()}},"./node_modules/@babel/runtime/helpers/toConsumableArray.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/toConsumableArray.js")},"./node_modules/@babel/runtime/helpers/typeof.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/typeof.js")},"./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js")},"./node_modules/@babel/runtime/regenerator/index.js":function(t,r,i){t.exports=i("./node_modules/regenerator-runtime/runtime.js")},"./node_modules/@chesscom/chessboard/dist/chessboard/chessboard.js":function(t,r,i){(function(r){t.exports=function(t){var r={};function __webpack_require__(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,i){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,r){if(1&r&&(t=__webpack_require__(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)__webpack_require__.d(i,o,function(r){return t[r]}.bind(null,o));return i},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="/bundles/app/js/",__webpack_require__(__webpack_require__.s=120)}([function(t,r,i){"use strict";var o;i.d(r,"a",(function(){return o})),function(t){!function(t){t.Event="Event",t.State="State"}(t.LogCodes||(t.LogCodes={})),function(t){t.DraggingPiece="draggingPiece",t.HideHoverSquare="hideHoverSquare",t.MachineState="machineState",t.PromotionMove="promotionMove",t.SoundPlayed="soundPlayed",t.SelectedPiece="selectedPiece"}(t.State||(t.State={})),function(t){t.AddMove="AddMove",t.BlinkSquare="BlinkSquare",t.ClearMarkings="ClearMarkings",t.CreateContinuation="CreateContinuation",t.CreateGame="CreateGame",t.DeletePosition="DeletePosition",t.DrawAgreed="DrawAgreed",t.DrawClaimed="DrawClaimed",t.GameResigned="GameResigned",t.IllegalMove="IllegalMove",t.LineCommentUpdated="LineCommentUpdated",t.LineUpdated="LineUpdated",t.Load="Load",t.Mark="Mark",t.Move="Move",t.MoveBackward="MoveBackward",t.MoveForward="MoveForward",t.MoveVariation="MoveVariation",t.NodeUpdated="NodeUpdated",t.OutOfTime="OutOfTime",t.PromoteVariation="PromoteVariation",t.Reload="Reload",t.ResetGame="ResetGame",t.ResetToMainLine="ResetToMainLine",t.SelectLineEnd="SelectLineEnd",t.SelectNode="SelectNode",t.SelectLineStart="SelectLineStart",t.SetBoardPosition="SetBoardPosition",t.SetPlayingAs="SetPlayingAs",t.TurnSet="TurnSet",t.Undo="Undo",t.UpdatePGNHeaders="UpdatePGNHeaders"}(t.APIEvents||(t.APIEvents={})),function(t){t.PromotionAreaClosePointerdown="PromotionAreaClosePointerdown",t.PromotionPiecePointerdown="PromotionPiecePointerdown"}(t.BoardEvents||(t.BoardEvents={})),function(t){t.Create="Create",t.Destroy="Destroy",t.ModeChanged="ModeChanged",t.RendererSet="RendererSet"}(t.InstanceEvents||(t.InstanceEvents={})),function(t){t.Update="UpdateOptions"}(t.OptionsEvents||(t.OptionsEvents={})),function(t){t.Play="PlaySound"}(t.SoundEvents||(t.SoundEvents={})),function(t){t.Resize="Resize"}(t.UIEvents||(t.UIEvents={})),function(t){t.MousedownLeft="MousedownLeft",t.MousedownRight="MousedownRight",t.PointerdownLeft="PointerdownLeft",t.PointerdownRight="PointerdownRight",t.Pointermove="Pointermove",t.Pointerup="Pointerup",t.Wheel="Wheel"}(t.UserEvents||(t.UserEvents={}))}(o||(o={}))},function(t,r){t.exports=function _defineProperty(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}},function(t,r,i){"use strict";var o;i.d(r,"a",(function(){return o})),function(t){!function(t){t[t.White=1]="White",t[t.Black=2]="Black"}(t.ColorsAsNumbers||(t.ColorsAsNumbers={})),function(t){t.Bughouse="bughouse",t.Chess="chess",t.Chess960="chess960",t.Crazyhouse="crazyhouse",t.KingOfTheHill="kingofthehill",t.ThreeCheck="threecheck"}(t.Variants||(t.Variants={})),function(t){t.White="w",t.Black="b"}(t.ColorsAsLetters||(t.ColorsAsLetters={})),function(t){t.White="white",t.Black="black"}(t.ColorsAsWords||(t.ColorsAsWords={})),t.DefaultTimeControl=5,function(t){t.Black="?",t.Event="?",t.Date="????.??.??",t.Site="?",t.Value="?",t.Result="*",t.Round="?",t.White="?"}(t.EmptyPGNHeaders||(t.EmptyPGNHeaders={})),function(t){!function(t){t[t.Capture=1]="Capture",t[t.BigPawn=2]="BigPawn",t[t.EPCapture=4]="EPCapture",t[t.AnyCapture=5]="AnyCapture",t[t.Promotion=8]="Promotion",t[t.CapturePromotion=9]="CapturePromotion",t[t.KingsideCastle=16]="KingsideCastle",t[t.QueensideCastle=32]="QueensideCastle",t[t.AnyCastle=48]="AnyCastle",t[t.Drop=64]="Drop",t[t.DropOrCapture=69]="DropOrCapture",t[t.DropOrPromote=72]="DropOrPromote"}(t.Flags||(t.Flags={})),function(t){t[t.Capture=0]="Capture",t[t.Castle=1]="Castle",t[t.Check=2]="Check",t[t.Checkmate=3]="Checkmate",t[t.Normal=4]="Normal",t[t.Premove=5]="Premove",t[t.Promotion=6]="Promotion"}(t.Types||(t.Types={}))}(t.Move||(t.Move={})),function(t){!function(t){!function(t){!function(t){t.Image="Image",t.Star="Star",t.TextBox="TextBox"}(t.Types||(t.Types={}))}(t.CustomItem||(t.CustomItem={})),function(t){!function(t){t.Alternative="Alternative",t.BestMove="BestMove",t.Blunder="Blunder",t.Book="Book",t.Brilliant="Brilliant",t.CheckmateBlack="CheckmateBlack",t.CheckmateWhite="CheckmateWhite",t.Correct="Correct",t.Critical="Critical",t.DrawBlack="DrawBlack",t.DrawWhite="DrawWhite",t.Excellent="Excellent",t.FastWin="FastWin",t.Forced="Forced",t.FreePiece="FreePiece",t.Gamechanger="Gamechanger",t.Good="Good",t.GreatFind="GreatFind",t.Inaccuracy="Inaccuracy",t.Incorrect="Incorrect",t.Mate="Mate",t.MissedWin="MissedWin",t.Mistake="Mistake",t.ResignBlack="ResignBlack",t.ResignWhite="ResignWhite",t.Sharp="Sharp",t.Takeback="Takeback",t.Threat="Threat",t.TimeoutBlack="TimeoutBlack",t.TimeoutWhite="TimeoutWhite",t.Undo="Undo",t.Winner="Winner"}(t.Types||(t.Types={}))}(t.Effect||(t.Effect={})),function(t){t.alt="a",t.custom="c",t.default="d",t.shift="s",t.ctrl="l"}(t.ColorKeys||(t.ColorKeys={})),function(t){t.a="alt",t.c="custom",t.d="default",t.s="shift",t.l="ctrl"}(t.JCEColorsMap||(t.JCEColorsMap={})),function(t){t.Arrow="arrow",t.Effect="effect",t.Square="square",t.CustomItem="customItem"}(t.Types||(t.Types={}))}(t.Marking||(t.Marking={}))}(t.Node||(t.Node={})),function(t){!function(t){t.p="pawn",t.n="knight",t.b="bishop",t.r="rook",t.q="queen",t.k="king"}(t.Names||(t.Names={})),function(t){t.Pawn="p",t.Knight="n",t.Bishop="b",t.Rook="r",t.Queen="q",t.King="k"}(t.Types||(t.Types={}))}(t.Piece||(t.Piece={})),function(t){!function(t){t.Color="#ffff00",t[t.Opacity=.5]="Opacity"}(t.Defaults||(t.Defaults={})),function(t){t.Analysis="analysis",t.Move="move",t.Premove="premove",t.Selection="selection"}(t.Types||(t.Types={}))}(t.HighlightedSquare||(t.HighlightedSquare={})),function(t){t.Blitz="blitz",t.Bullet="bullet",t.Rapid="rapid"}(t.TimeControlTypes||(t.TimeControlTypes={})),function(t){t.Black="0-1",t.Draw="1/2-1/2",t.None="*",t.White="1-0"}(t.Results||(t.Results={}))}(o||(o={}))},function(t,r,i){"use strict";i.r(r),i.d(r,"ACESFilmicToneMapping",(function(){return me})),i.d(r,"AddEquation",(function(){return D})),i.d(r,"AddOperation",(function(){return ue})),i.d(r,"AdditiveAnimationBlendMode",(function(){return sn})),i.d(r,"AdditiveBlending",(function(){return R})),i.d(r,"AlphaFormat",(function(){return Ke})),i.d(r,"AlwaysDepth",(function(){return te})),i.d(r,"AlwaysStencilFunc",(function(){return Bn})),i.d(r,"AmbientLight",(function(){return AmbientLight})),i.d(r,"AmbientLightProbe",(function(){return AmbientLightProbe})),i.d(r,"AnimationClip",(function(){return AnimationClip})),i.d(r,"AnimationLoader",(function(){return AnimationLoader})),i.d(r,"AnimationMixer",(function(){return AnimationMixer})),i.d(r,"AnimationObjectGroup",(function(){return AnimationObjectGroup})),i.d(r,"AnimationUtils",(function(){return Yo})),i.d(r,"ArcCurve",(function(){return ArcCurve})),i.d(r,"ArrayCamera",(function(){return ArrayCamera})),i.d(r,"ArrowHelper",(function(){return ArrowHelper})),i.d(r,"Audio",(function(){return Audio})),i.d(r,"AudioAnalyser",(function(){return AudioAnalyser})),i.d(r,"AudioContext",(function(){return da})),i.d(r,"AudioListener",(function(){return AudioListener})),i.d(r,"AudioLoader",(function(){return AudioLoader})),i.d(r,"AxesHelper",(function(){return AxesHelper})),i.d(r,"AxisHelper",(function(){return AxisHelper})),i.d(r,"BackSide",(function(){return P})),i.d(r,"BasicDepthPacking",(function(){return bn})),i.d(r,"BasicShadowMap",(function(){return x})),i.d(r,"BinaryTextureLoader",(function(){return BinaryTextureLoader})),i.d(r,"Bone",(function(){return Bone})),i.d(r,"BooleanKeyframeTrack",(function(){return BooleanKeyframeTrack})),i.d(r,"BoundingBoxHelper",(function(){return BoundingBoxHelper})),i.d(r,"Box2",(function(){return Box2})),i.d(r,"Box3",(function(){return Box3})),i.d(r,"Box3Helper",(function(){return Box3Helper})),i.d(r,"BoxBufferGeometry",(function(){return BoxBufferGeometry})),i.d(r,"BoxGeometry",(function(){return BoxGeometry})),i.d(r,"BoxHelper",(function(){return BoxHelper})),i.d(r,"BufferAttribute",(function(){return BufferAttribute})),i.d(r,"BufferGeometry",(function(){return BufferGeometry})),i.d(r,"BufferGeometryLoader",(function(){return BufferGeometryLoader})),i.d(r,"ByteType",(function(){return Be})),i.d(r,"Cache",(function(){return Zo})),i.d(r,"Camera",(function(){return Camera})),i.d(r,"CameraHelper",(function(){return CameraHelper})),i.d(r,"CanvasRenderer",(function(){return CanvasRenderer})),i.d(r,"CanvasTexture",(function(){return CanvasTexture})),i.d(r,"CatmullRomCurve3",(function(){return CatmullRomCurve3})),i.d(r,"CineonToneMapping",(function(){return fe})),i.d(r,"CircleBufferGeometry",(function(){return CircleBufferGeometry})),i.d(r,"CircleGeometry",(function(){return CircleGeometry})),i.d(r,"ClampToEdgeWrapping",(function(){return Ee})),i.d(r,"Clock",(function(){return Clock})),i.d(r,"ClosedSplineCurve3",(function(){return ClosedSplineCurve3})),i.d(r,"Color",(function(){return Color})),i.d(r,"ColorKeyframeTrack",(function(){return ColorKeyframeTrack})),i.d(r,"CompressedTexture",(function(){return CompressedTexture})),i.d(r,"CompressedTextureLoader",(function(){return CompressedTextureLoader})),i.d(r,"ConeBufferGeometry",(function(){return ConeBufferGeometry})),i.d(r,"ConeGeometry",(function(){return ConeGeometry})),i.d(r,"CubeCamera",(function(){return CubeCamera})),i.d(r,"CubeGeometry",(function(){return BoxGeometry})),i.d(r,"CubeReflectionMapping",(function(){return ye})),i.d(r,"CubeRefractionMapping",(function(){return be})),i.d(r,"CubeTexture",(function(){return CubeTexture})),i.d(r,"CubeTextureLoader",(function(){return CubeTextureLoader})),i.d(r,"CubeUVReflectionMapping",(function(){return we})),i.d(r,"CubeUVRefractionMapping",(function(){return Se})),i.d(r,"CubicBezierCurve",(function(){return CubicBezierCurve})),i.d(r,"CubicBezierCurve3",(function(){return CubicBezierCurve3})),i.d(r,"CubicInterpolant",(function(){return CubicInterpolant})),i.d(r,"CullFaceBack",(function(){return g})),i.d(r,"CullFaceFront",(function(){return y})),i.d(r,"CullFaceFrontBack",(function(){return _})),i.d(r,"CullFaceNone",(function(){return h})),i.d(r,"Curve",(function(){return Curve})),i.d(r,"CurvePath",(function(){return CurvePath})),i.d(r,"CustomBlending",(function(){return k})),i.d(r,"CustomToneMapping",(function(){return ge})),i.d(r,"CylinderBufferGeometry",(function(){return CylinderBufferGeometry})),i.d(r,"CylinderGeometry",(function(){return CylinderGeometry})),i.d(r,"Cylindrical",(function(){return Cylindrical})),i.d(r,"DataTexture",(function(){return DataTexture})),i.d(r,"DataTexture2DArray",(function(){return DataTexture2DArray})),i.d(r,"DataTexture3D",(function(){return DataTexture3D})),i.d(r,"DataTextureLoader",(function(){return DataTextureLoader})),i.d(r,"DecrementStencilOp",(function(){return Pn})),i.d(r,"DecrementWrapStencilOp",(function(){return An})),i.d(r,"DefaultLoadingManager",(function(){return Qo})),i.d(r,"DepthFormat",(function(){return tt})),i.d(r,"DepthStencilFormat",(function(){return nt})),i.d(r,"DepthTexture",(function(){return DepthTexture})),i.d(r,"DirectionalLight",(function(){return DirectionalLight})),i.d(r,"DirectionalLightHelper",(function(){return DirectionalLightHelper})),i.d(r,"DiscreteInterpolant",(function(){return DiscreteInterpolant})),i.d(r,"DodecahedronBufferGeometry",(function(){return DodecahedronBufferGeometry})),i.d(r,"DodecahedronGeometry",(function(){return DodecahedronGeometry})),i.d(r,"DoubleSide",(function(){return C})),i.d(r,"DstAlphaFactor",(function(){return K})),i.d(r,"DstColorFactor",(function(){return Z})),i.d(r,"DynamicBufferAttribute",(function(){return DynamicBufferAttribute})),i.d(r,"DynamicCopyUsage",(function(){return qn})),i.d(r,"DynamicDrawUsage",(function(){return Gn})),i.d(r,"DynamicReadUsage",(function(){return Un})),i.d(r,"EdgesGeometry",(function(){return EdgesGeometry})),i.d(r,"EdgesHelper",(function(){return EdgesHelper})),i.d(r,"EllipseCurve",(function(){return EllipseCurve})),i.d(r,"EqualDepth",(function(){return ie})),i.d(r,"EqualStencilFunc",(function(){return Rn})),i.d(r,"EquirectangularReflectionMapping",(function(){return _e})),i.d(r,"EquirectangularRefractionMapping",(function(){return xe})),i.d(r,"Euler",(function(){return Euler})),i.d(r,"EventDispatcher",(function(){return EventDispatcher})),i.d(r,"ExtrudeBufferGeometry",(function(){return ExtrudeBufferGeometry})),i.d(r,"ExtrudeGeometry",(function(){return ExtrudeGeometry})),i.d(r,"Face3",(function(){return Face3})),i.d(r,"Face4",(function(){return Face4})),i.d(r,"FaceColors",(function(){return fs})),i.d(r,"FileLoader",(function(){return FileLoader})),i.d(r,"FlatShading",(function(){return A})),i.d(r,"Float32Attribute",(function(){return Float32Attribute})),i.d(r,"Float32BufferAttribute",(function(){return Float32BufferAttribute})),i.d(r,"Float64Attribute",(function(){return Float64Attribute})),i.d(r,"Float64BufferAttribute",(function(){return Float64BufferAttribute})),i.d(r,"FloatType",(function(){return Ue})),i.d(r,"Fog",(function(){return Fog})),i.d(r,"FogExp2",(function(){return FogExp2})),i.d(r,"Font",(function(){return Font})),i.d(r,"FontLoader",(function(){return FontLoader})),i.d(r,"FrontSide",(function(){return T})),i.d(r,"Frustum",(function(){return Frustum})),i.d(r,"GLBufferAttribute",(function(){return GLBufferAttribute})),i.d(r,"GLSL1",(function(){return Xn})),i.d(r,"GLSL3",(function(){return Kn})),i.d(r,"GammaEncoding",(function(){return pn})),i.d(r,"Geometry",(function(){return Geometry})),i.d(r,"GeometryUtils",(function(){return gs})),i.d(r,"GreaterDepth",(function(){return ae})),i.d(r,"GreaterEqualDepth",(function(){return oe})),i.d(r,"GreaterEqualStencilFunc",(function(){return Dn})),i.d(r,"GreaterStencilFunc",(function(){return Nn})),i.d(r,"GridHelper",(function(){return GridHelper})),i.d(r,"Group",(function(){return Group})),i.d(r,"HalfFloatType",(function(){return ze})),i.d(r,"HemisphereLight",(function(){return HemisphereLight})),i.d(r,"HemisphereLightHelper",(function(){return HemisphereLightHelper})),i.d(r,"HemisphereLightProbe",(function(){return HemisphereLightProbe})),i.d(r,"IcosahedronBufferGeometry",(function(){return IcosahedronBufferGeometry})),i.d(r,"IcosahedronGeometry",(function(){return IcosahedronGeometry})),i.d(r,"ImageBitmapLoader",(function(){return ImageBitmapLoader})),i.d(r,"ImageLoader",(function(){return ImageLoader})),i.d(r,"ImageUtils",(function(){return er})),i.d(r,"ImmediateRenderObject",(function(){return ImmediateRenderObject})),i.d(r,"IncrementStencilOp",(function(){return Tn})),i.d(r,"IncrementWrapStencilOp",(function(){return Cn})),i.d(r,"InstancedBufferAttribute",(function(){return InstancedBufferAttribute})),i.d(r,"InstancedBufferGeometry",(function(){return InstancedBufferGeometry})),i.d(r,"InstancedInterleavedBuffer",(function(){return InstancedInterleavedBuffer})),i.d(r,"InstancedMesh",(function(){return InstancedMesh})),i.d(r,"Int16Attribute",(function(){return Int16Attribute})),i.d(r,"Int16BufferAttribute",(function(){return Int16BufferAttribute})),i.d(r,"Int32Attribute",(function(){return Int32Attribute})),i.d(r,"Int32BufferAttribute",(function(){return Int32BufferAttribute})),i.d(r,"Int8Attribute",(function(){return Int8Attribute})),i.d(r,"Int8BufferAttribute",(function(){return Int8BufferAttribute})),i.d(r,"IntType",(function(){return He})),i.d(r,"InterleavedBuffer",(function(){return InterleavedBuffer})),i.d(r,"InterleavedBufferAttribute",(function(){return InterleavedBufferAttribute})),i.d(r,"Interpolant",(function(){return Interpolant})),i.d(r,"InterpolateDiscrete",(function(){return Qt})),i.d(r,"InterpolateLinear",(function(){return Jt})),i.d(r,"InterpolateSmooth",(function(){return en})),i.d(r,"InvertStencilOp",(function(){return On})),i.d(r,"JSONLoader",(function(){return JSONLoader})),i.d(r,"KeepStencilOp",(function(){return Mn})),i.d(r,"KeyframeTrack",(function(){return KeyframeTrack})),i.d(r,"LOD",(function(){return LOD})),i.d(r,"LatheBufferGeometry",(function(){return LatheBufferGeometry})),i.d(r,"LatheGeometry",(function(){return LatheGeometry})),i.d(r,"Layers",(function(){return Layers})),i.d(r,"LensFlare",(function(){return LensFlare})),i.d(r,"LessDepth",(function(){return ne})),i.d(r,"LessEqualDepth",(function(){return re})),i.d(r,"LessEqualStencilFunc",(function(){return jn})),i.d(r,"LessStencilFunc",(function(){return In})),i.d(r,"Light",(function(){return Light})),i.d(r,"LightProbe",(function(){return LightProbe})),i.d(r,"Line",(function(){return Line})),i.d(r,"Line3",(function(){return Line3})),i.d(r,"LineBasicMaterial",(function(){return LineBasicMaterial})),i.d(r,"LineCurve",(function(){return LineCurve})),i.d(r,"LineCurve3",(function(){return LineCurve3})),i.d(r,"LineDashedMaterial",(function(){return LineDashedMaterial})),i.d(r,"LineLoop",(function(){return LineLoop})),i.d(r,"LinePieces",(function(){return hs})),i.d(r,"LineSegments",(function(){return LineSegments})),i.d(r,"LineStrip",(function(){return ds})),i.d(r,"LinearEncoding",(function(){return dn})),i.d(r,"LinearFilter",(function(){return Ie})),i.d(r,"LinearInterpolant",(function(){return LinearInterpolant})),i.d(r,"LinearMipMapLinearFilter",(function(){return ke})),i.d(r,"LinearMipMapNearestFilter",(function(){return je})),i.d(r,"LinearMipmapLinearFilter",(function(){return Ne})),i.d(r,"LinearMipmapNearestFilter",(function(){return Re})),i.d(r,"LinearToneMapping",(function(){return he})),i.d(r,"Loader",(function(){return Loader})),i.d(r,"LoaderUtils",(function(){return oa})),i.d(r,"LoadingManager",(function(){return LoadingManager})),i.d(r,"LogLuvEncoding",(function(){return mn})),i.d(r,"LoopOnce",(function(){return Kt})),i.d(r,"LoopPingPong",(function(){return Zt})),i.d(r,"LoopRepeat",(function(){return Yt})),i.d(r,"LuminanceAlphaFormat",(function(){return Je})),i.d(r,"LuminanceFormat",(function(){return Qe})),i.d(r,"MOUSE",(function(){return a})),i.d(r,"Material",(function(){return Material})),i.d(r,"MaterialLoader",(function(){return MaterialLoader})),i.d(r,"Math",(function(){return Qn})),i.d(r,"MathUtils",(function(){return Qn})),i.d(r,"Matrix3",(function(){return Matrix3})),i.d(r,"Matrix4",(function(){return Matrix4})),i.d(r,"MaxEquation",(function(){return V})),i.d(r,"Mesh",(function(){return Mesh})),i.d(r,"MeshBasicMaterial",(function(){return MeshBasicMaterial})),i.d(r,"MeshDepthMaterial",(function(){return MeshDepthMaterial})),i.d(r,"MeshDistanceMaterial",(function(){return MeshDistanceMaterial})),i.d(r,"MeshFaceMaterial",(function(){return MeshFaceMaterial})),i.d(r,"MeshLambertMaterial",(function(){return MeshLambertMaterial})),i.d(r,"MeshMatcapMaterial",(function(){return MeshMatcapMaterial})),i.d(r,"MeshNormalMaterial",(function(){return MeshNormalMaterial})),i.d(r,"MeshPhongMaterial",(function(){return MeshPhongMaterial})),i.d(r,"MeshPhysicalMaterial",(function(){return MeshPhysicalMaterial})),i.d(r,"MeshStandardMaterial",(function(){return MeshStandardMaterial})),i.d(r,"MeshToonMaterial",(function(){return MeshToonMaterial})),i.d(r,"MinEquation",(function(){return H})),i.d(r,"MirroredRepeatWrapping",(function(){return Te})),i.d(r,"MixOperation",(function(){return le})),i.d(r,"MultiMaterial",(function(){return MultiMaterial})),i.d(r,"MultiplyBlending",(function(){return N})),i.d(r,"MultiplyOperation",(function(){return ce})),i.d(r,"NearestFilter",(function(){return Pe})),i.d(r,"NearestMipMapLinearFilter",(function(){return Le})),i.d(r,"NearestMipMapNearestFilter",(function(){return Ae})),i.d(r,"NearestMipmapLinearFilter",(function(){return Oe})),i.d(r,"NearestMipmapNearestFilter",(function(){return Ce})),i.d(r,"NeverDepth",(function(){return ee})),i.d(r,"NeverStencilFunc",(function(){return Ln})),i.d(r,"NoBlending",(function(){return L})),i.d(r,"NoColors",(function(){return ps})),i.d(r,"NoToneMapping",(function(){return de})),i.d(r,"NormalAnimationBlendMode",(function(){return an})),i.d(r,"NormalBlending",(function(){return I})),i.d(r,"NotEqualDepth",(function(){return se})),i.d(r,"NotEqualStencilFunc",(function(){return kn})),i.d(r,"NumberKeyframeTrack",(function(){return NumberKeyframeTrack})),i.d(r,"Object3D",(function(){return Object3D})),i.d(r,"ObjectLoader",(function(){return ObjectLoader})),i.d(r,"ObjectSpaceNormalMap",(function(){return wn})),i.d(r,"OctahedronBufferGeometry",(function(){return OctahedronBufferGeometry})),i.d(r,"OctahedronGeometry",(function(){return OctahedronGeometry})),i.d(r,"OneFactor",(function(){return z})),i.d(r,"OneMinusDstAlphaFactor",(function(){return Y})),i.d(r,"OneMinusDstColorFactor",(function(){return Q})),i.d(r,"OneMinusSrcAlphaFactor",(function(){return X})),i.d(r,"OneMinusSrcColorFactor",(function(){return q})),i.d(r,"OrthographicCamera",(function(){return OrthographicCamera})),i.d(r,"PCFShadowMap",(function(){return w})),i.d(r,"PCFSoftShadowMap",(function(){return S})),i.d(r,"PMREMGenerator",(function(){return PMREMGenerator})),i.d(r,"ParametricBufferGeometry",(function(){return ParametricBufferGeometry})),i.d(r,"ParametricGeometry",(function(){return ParametricGeometry})),i.d(r,"Particle",(function(){return Particle})),i.d(r,"ParticleBasicMaterial",(function(){return ParticleBasicMaterial})),i.d(r,"ParticleSystem",(function(){return ParticleSystem})),i.d(r,"ParticleSystemMaterial",(function(){return ParticleSystemMaterial})),i.d(r,"Path",(function(){return Path})),i.d(r,"PerspectiveCamera",(function(){return PerspectiveCamera})),i.d(r,"Plane",(function(){return Plane})),i.d(r,"PlaneBufferGeometry",(function(){return PlaneBufferGeometry})),i.d(r,"PlaneGeometry",(function(){return PlaneGeometry})),i.d(r,"PlaneHelper",(function(){return PlaneHelper})),i.d(r,"PointCloud",(function(){return PointCloud})),i.d(r,"PointCloudMaterial",(function(){return PointCloudMaterial})),i.d(r,"PointLight",(function(){return PointLight})),i.d(r,"PointLightHelper",(function(){return PointLightHelper})),i.d(r,"Points",(function(){return Points})),i.d(r,"PointsMaterial",(function(){return PointsMaterial})),i.d(r,"PolarGridHelper",(function(){return PolarGridHelper})),i.d(r,"PolyhedronBufferGeometry",(function(){return PolyhedronBufferGeometry})),i.d(r,"PolyhedronGeometry",(function(){return PolyhedronGeometry})),i.d(r,"PositionalAudio",(function(){return PositionalAudio})),i.d(r,"PropertyBinding",(function(){return PropertyBinding})),i.d(r,"PropertyMixer",(function(){return PropertyMixer})),i.d(r,"QuadraticBezierCurve",(function(){return QuadraticBezierCurve})),i.d(r,"QuadraticBezierCurve3",(function(){return QuadraticBezierCurve3})),i.d(r,"Quaternion",(function(){return Quaternion})),i.d(r,"QuaternionKeyframeTrack",(function(){return QuaternionKeyframeTrack})),i.d(r,"QuaternionLinearInterpolant",(function(){return QuaternionLinearInterpolant})),i.d(r,"REVISION",(function(){return o})),i.d(r,"RGBADepthPacking",(function(){return _n})),i.d(r,"RGBAFormat",(function(){return Ze})),i.d(r,"RGBAIntegerFormat",(function(){return ct})),i.d(r,"RGBA_ASTC_10x10_Format",(function(){return Lt})),i.d(r,"RGBA_ASTC_10x5_Format",(function(){return Ct})),i.d(r,"RGBA_ASTC_10x6_Format",(function(){return At})),i.d(r,"RGBA_ASTC_10x8_Format",(function(){return Ot})),i.d(r,"RGBA_ASTC_12x10_Format",(function(){return It})),i.d(r,"RGBA_ASTC_12x12_Format",(function(){return Rt})),i.d(r,"RGBA_ASTC_4x4_Format",(function(){return _t})),i.d(r,"RGBA_ASTC_5x4_Format",(function(){return xt})),i.d(r,"RGBA_ASTC_5x5_Format",(function(){return wt})),i.d(r,"RGBA_ASTC_6x5_Format",(function(){return St})),i.d(r,"RGBA_ASTC_6x6_Format",(function(){return Mt})),i.d(r,"RGBA_ASTC_8x5_Format",(function(){return Et})),i.d(r,"RGBA_ASTC_8x6_Format",(function(){return Tt})),i.d(r,"RGBA_ASTC_8x8_Format",(function(){return Pt})),i.d(r,"RGBA_BPTC_Format",(function(){return jt})),i.d(r,"RGBA_ETC2_EAC_Format",(function(){return bt})),i.d(r,"RGBA_PVRTC_2BPPV1_Format",(function(){return gt})),i.d(r,"RGBA_PVRTC_4BPPV1_Format",(function(){return mt})),i.d(r,"RGBA_S3TC_DXT1_Format",(function(){return ut})),i.d(r,"RGBA_S3TC_DXT3_Format",(function(){return dt})),i.d(r,"RGBA_S3TC_DXT5_Format",(function(){return ht})),i.d(r,"RGBDEncoding",(function(){return yn})),i.d(r,"RGBEEncoding",(function(){return fn})),i.d(r,"RGBEFormat",(function(){return et})),i.d(r,"RGBFormat",(function(){return Ye})),i.d(r,"RGBIntegerFormat",(function(){return st})),i.d(r,"RGBM16Encoding",(function(){return vn})),i.d(r,"RGBM7Encoding",(function(){return gn})),i.d(r,"RGB_ETC1_Format",(function(){return vt})),i.d(r,"RGB_ETC2_Format",(function(){return yt})),i.d(r,"RGB_PVRTC_2BPPV1_Format",(function(){return ft})),i.d(r,"RGB_PVRTC_4BPPV1_Format",(function(){return pt})),i.d(r,"RGB_S3TC_DXT1_Format",(function(){return lt})),i.d(r,"RGFormat",(function(){return ot})),i.d(r,"RGIntegerFormat",(function(){return at})),i.d(r,"RawShaderMaterial",(function(){return RawShaderMaterial})),i.d(r,"Ray",(function(){return Ray})),i.d(r,"Raycaster",(function(){return Raycaster})),i.d(r,"RectAreaLight",(function(){return RectAreaLight})),i.d(r,"RedFormat",(function(){return rt})),i.d(r,"RedIntegerFormat",(function(){return it})),i.d(r,"ReinhardToneMapping",(function(){return pe})),i.d(r,"RepeatWrapping",(function(){return Me})),i.d(r,"ReplaceStencilOp",(function(){return En})),i.d(r,"ReverseSubtractEquation",(function(){return G})),i.d(r,"RingBufferGeometry",(function(){return RingBufferGeometry})),i.d(r,"RingGeometry",(function(){return RingGeometry})),i.d(r,"SRGB8_ALPHA8_ASTC_10x10_Format",(function(){return qt})),i.d(r,"SRGB8_ALPHA8_ASTC_10x5_Format",(function(){return Ut})),i.d(r,"SRGB8_ALPHA8_ASTC_10x6_Format",(function(){return zt})),i.d(r,"SRGB8_ALPHA8_ASTC_10x8_Format",(function(){return Wt})),i.d(r,"SRGB8_ALPHA8_ASTC_12x10_Format",(function(){return $t})),i.d(r,"SRGB8_ALPHA8_ASTC_12x12_Format",(function(){return Xt})),i.d(r,"SRGB8_ALPHA8_ASTC_4x4_Format",(function(){return Nt})),i.d(r,"SRGB8_ALPHA8_ASTC_5x4_Format",(function(){return kt})),i.d(r,"SRGB8_ALPHA8_ASTC_5x5_Format",(function(){return Dt})),i.d(r,"SRGB8_ALPHA8_ASTC_6x5_Format",(function(){return Bt})),i.d(r,"SRGB8_ALPHA8_ASTC_6x6_Format",(function(){return Ft})),i.d(r,"SRGB8_ALPHA8_ASTC_8x5_Format",(function(){return Gt})),i.d(r,"SRGB8_ALPHA8_ASTC_8x6_Format",(function(){return Ht})),i.d(r,"SRGB8_ALPHA8_ASTC_8x8_Format",(function(){return Vt})),i.d(r,"Scene",(function(){return Scene})),i.d(r,"SceneUtils",(function(){return vs})),i.d(r,"ShaderChunk",(function(){return Gi})),i.d(r,"ShaderLib",(function(){return Vi})),i.d(r,"ShaderMaterial",(function(){return ShaderMaterial})),i.d(r,"ShadowMaterial",(function(){return ShadowMaterial})),i.d(r,"Shape",(function(){return Shape})),i.d(r,"ShapeBufferGeometry",(function(){return ShapeBufferGeometry})),i.d(r,"ShapeGeometry",(function(){return ShapeGeometry})),i.d(r,"ShapePath",(function(){return ShapePath})),i.d(r,"ShapeUtils",(function(){return qo})),i.d(r,"ShortType",(function(){return Fe})),i.d(r,"Skeleton",(function(){return Skeleton})),i.d(r,"SkeletonHelper",(function(){return SkeletonHelper})),i.d(r,"SkinnedMesh",(function(){return SkinnedMesh})),i.d(r,"SmoothShading",(function(){return O})),i.d(r,"Sphere",(function(){return Sphere})),i.d(r,"SphereBufferGeometry",(function(){return SphereBufferGeometry})),i.d(r,"SphereGeometry",(function(){return SphereGeometry})),i.d(r,"Spherical",(function(){return Spherical})),i.d(r,"SphericalHarmonics3",(function(){return SphericalHarmonics3})),i.d(r,"Spline",(function(){return Spline})),i.d(r,"SplineCurve",(function(){return SplineCurve})),i.d(r,"SplineCurve3",(function(){return SplineCurve3})),i.d(r,"SpotLight",(function(){return SpotLight})),i.d(r,"SpotLightHelper",(function(){return SpotLightHelper})),i.d(r,"Sprite",(function(){return Sprite})),i.d(r,"SpriteMaterial",(function(){return SpriteMaterial})),i.d(r,"SrcAlphaFactor",(function(){return $})),i.d(r,"SrcAlphaSaturateFactor",(function(){return J})),i.d(r,"SrcColorFactor",(function(){return W})),i.d(r,"StaticCopyUsage",(function(){return Wn})),i.d(r,"StaticDrawUsage",(function(){return Fn})),i.d(r,"StaticReadUsage",(function(){return Vn})),i.d(r,"StereoCamera",(function(){return StereoCamera})),i.d(r,"StreamCopyUsage",(function(){return $n})),i.d(r,"StreamDrawUsage",(function(){return Hn})),i.d(r,"StreamReadUsage",(function(){return zn})),i.d(r,"StringKeyframeTrack",(function(){return StringKeyframeTrack})),i.d(r,"SubtractEquation",(function(){return B})),i.d(r,"SubtractiveBlending",(function(){return j})),i.d(r,"TOUCH",(function(){return l})),i.d(r,"TangentSpaceNormalMap",(function(){return xn})),i.d(r,"TetrahedronBufferGeometry",(function(){return TetrahedronBufferGeometry})),i.d(r,"TetrahedronGeometry",(function(){return TetrahedronGeometry})),i.d(r,"TextBufferGeometry",(function(){return TextBufferGeometry})),i.d(r,"TextGeometry",(function(){return TextGeometry})),i.d(r,"Texture",(function(){return Texture})),i.d(r,"TextureLoader",(function(){return TextureLoader})),i.d(r,"TorusBufferGeometry",(function(){return TorusBufferGeometry})),i.d(r,"TorusGeometry",(function(){return TorusGeometry})),i.d(r,"TorusKnotBufferGeometry",(function(){return TorusKnotBufferGeometry})),i.d(r,"TorusKnotGeometry",(function(){return TorusKnotGeometry})),i.d(r,"Triangle",(function(){return Triangle})),i.d(r,"TriangleFanDrawMode",(function(){return un})),i.d(r,"TriangleStripDrawMode",(function(){return ln})),i.d(r,"TrianglesDrawMode",(function(){return cn})),i.d(r,"TubeBufferGeometry",(function(){return TubeBufferGeometry})),i.d(r,"TubeGeometry",(function(){return TubeGeometry})),i.d(r,"UVMapping",(function(){return ve})),i.d(r,"Uint16Attribute",(function(){return Uint16Attribute})),i.d(r,"Uint16BufferAttribute",(function(){return Uint16BufferAttribute})),i.d(r,"Uint32Attribute",(function(){return Uint32Attribute})),i.d(r,"Uint32BufferAttribute",(function(){return Uint32BufferAttribute})),i.d(r,"Uint8Attribute",(function(){return Uint8Attribute})),i.d(r,"Uint8BufferAttribute",(function(){return Uint8BufferAttribute})),i.d(r,"Uint8ClampedAttribute",(function(){return Uint8ClampedAttribute})),i.d(r,"Uint8ClampedBufferAttribute",(function(){return Uint8ClampedBufferAttribute})),i.d(r,"Uniform",(function(){return Uniform})),i.d(r,"UniformsLib",(function(){return Hi})),i.d(r,"UniformsUtils",(function(){return ki})),i.d(r,"UnsignedByteType",(function(){return De})),i.d(r,"UnsignedInt248Type",(function(){return Xe})),i.d(r,"UnsignedIntType",(function(){return Ve})),i.d(r,"UnsignedShort4444Type",(function(){return We})),i.d(r,"UnsignedShort5551Type",(function(){return qe})),i.d(r,"UnsignedShort565Type",(function(){return $e})),i.d(r,"UnsignedShortType",(function(){return Ge})),i.d(r,"VSMShadowMap",(function(){return M})),i.d(r,"Vector2",(function(){return Vector2})),i.d(r,"Vector3",(function(){return Vector3})),i.d(r,"Vector4",(function(){return Vector4})),i.d(r,"VectorKeyframeTrack",(function(){return VectorKeyframeTrack})),i.d(r,"Vertex",(function(){return Vertex})),i.d(r,"VertexColors",(function(){return ms})),i.d(r,"VideoTexture",(function(){return VideoTexture})),i.d(r,"WebGL1Renderer",(function(){return WebGL1Renderer})),i.d(r,"WebGLCubeRenderTarget",(function(){return WebGLCubeRenderTarget})),i.d(r,"WebGLMultisampleRenderTarget",(function(){return WebGLMultisampleRenderTarget})),i.d(r,"WebGLRenderTarget",(function(){return WebGLRenderTarget})),i.d(r,"WebGLRenderTargetCube",(function(){return WebGLRenderTargetCube})),i.d(r,"WebGLRenderer",(function(){return WebGLRenderer})),i.d(r,"WebGLUtils",(function(){return WebGLUtils})),i.d(r,"WireframeGeometry",(function(){return WireframeGeometry})),i.d(r,"WireframeHelper",(function(){return WireframeHelper})),i.d(r,"WrapAroundEnding",(function(){return rn})),i.d(r,"XHRLoader",(function(){return XHRLoader})),i.d(r,"ZeroCurvatureEnding",(function(){return tn})),i.d(r,"ZeroFactor",(function(){return U})),i.d(r,"ZeroSlopeEnding",(function(){return nn})),i.d(r,"ZeroStencilOp",(function(){return Sn})),i.d(r,"sRGBEncoding",(function(){return hn}));const o="122",a={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},l={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},h=0,g=1,y=2,_=3,x=0,w=1,S=2,M=3,T=0,P=1,C=2,A=1,O=2,L=0,I=1,R=2,j=3,N=4,k=5,D=100,B=101,G=102,H=103,V=104,U=200,z=201,W=202,q=203,$=204,X=205,K=206,Y=207,Z=208,Q=209,J=210,ee=0,te=1,ne=2,re=3,ie=4,oe=5,ae=6,se=7,ce=0,le=1,ue=2,de=0,he=1,pe=2,fe=3,me=4,ge=5,ve=300,ye=301,be=302,_e=303,xe=304,we=306,Se=307,Me=1e3,Ee=1001,Te=1002,Pe=1003,Ce=1004,Ae=1004,Oe=1005,Le=1005,Ie=1006,Re=1007,je=1007,Ne=1008,ke=1008,De=1009,Be=1010,Fe=1011,Ge=1012,He=1013,Ve=1014,Ue=1015,ze=1016,We=1017,qe=1018,$e=1019,Xe=1020,Ke=1021,Ye=1022,Ze=1023,Qe=1024,Je=1025,et=Ze,tt=1026,nt=1027,rt=1028,it=1029,ot=1030,at=1031,st=1032,ct=1033,lt=33776,ut=33777,dt=33778,ht=33779,pt=35840,ft=35841,mt=35842,gt=35843,vt=36196,yt=37492,bt=37496,_t=37808,xt=37809,wt=37810,St=37811,Mt=37812,Et=37813,Tt=37814,Pt=37815,Ct=37816,At=37817,Ot=37818,Lt=37819,It=37820,Rt=37821,jt=36492,Nt=37840,kt=37841,Dt=37842,Bt=37843,Ft=37844,Gt=37845,Ht=37846,Vt=37847,Ut=37848,zt=37849,Wt=37850,qt=37851,$t=37852,Xt=37853,Kt=2200,Yt=2201,Zt=2202,Qt=2300,Jt=2301,en=2302,tn=2400,nn=2401,rn=2402,an=2500,sn=2501,cn=0,ln=1,un=2,dn=3e3,hn=3001,pn=3007,fn=3002,mn=3003,gn=3004,vn=3005,yn=3006,bn=3200,_n=3201,xn=0,wn=1,Sn=0,Mn=7680,En=7681,Tn=7682,Pn=7683,Cn=34055,An=34056,On=5386,Ln=512,In=513,Rn=514,jn=515,Nn=516,kn=517,Dn=518,Bn=519,Fn=35044,Gn=35048,Hn=35040,Vn=35045,Un=35049,zn=35041,Wn=35046,qn=35050,$n=35042,Xn="100",Kn="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(t,r){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(r)&&i[t].push(r)},hasEventListener:function(t,r){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(r)},removeEventListener:function(t,r){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(r);-1!==t&&i.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const r=this._listeners[t.type];if(void 0!==r){t.target=this;const i=r.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,t)}}});const Yn=[];for(let ys=0;ys<256;ys++)Yn[ys]=(ys<16?"0":"")+ys.toString(16);let Zn=1234567;const Qn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return(Yn[255&t]+Yn[t>>8&255]+Yn[t>>16&255]+Yn[t>>24&255]+"-"+Yn[255&r]+Yn[r>>8&255]+"-"+Yn[r>>16&15|64]+Yn[r>>24&255]+"-"+Yn[63&i|128]+Yn[i>>8&255]+"-"+Yn[i>>16&255]+Yn[i>>24&255]+Yn[255&o]+Yn[o>>8&255]+Yn[o>>16&255]+Yn[o>>24&255]).toUpperCase()},clamp:function(t,r,i){return Math.max(r,Math.min(i,t))},euclideanModulo:function(t,r){return(t%r+r)%r},mapLinear:function(t,r,i,o,a){return o+(t-r)*(a-o)/(i-r)},lerp:function(t,r,i){return(1-i)*t+i*r},smoothstep:function(t,r,i){return t<=r?0:t>=i?1:(t=(t-r)/(i-r))*t*(3-2*t)},smootherstep:function(t,r,i){return t<=r?0:t>=i?1:(t=(t-r)/(i-r))*t*t*(t*(6*t-15)+10)},randInt:function(t,r){return t+Math.floor(Math.random()*(r-t+1))},randFloat:function(t,r){return t+Math.random()*(r-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Zn=t%2147483647),Zn=16807*Zn%2147483647,(Zn-1)/2147483646},degToRad:function(t){return t*Qn.DEG2RAD},radToDeg:function(t){return t*Qn.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,r,i,o,a){const l=Math.cos,h=Math.sin,g=l(i/2),y=h(i/2),_=l((r+o)/2),x=h((r+o)/2),w=l((r-o)/2),S=h((r-o)/2),M=l((o-r)/2),T=h((o-r)/2);switch(a){case"XYX":t.set(g*x,y*w,y*S,g*_);break;case"YZY":t.set(y*S,g*x,y*w,g*_);break;case"ZXZ":t.set(y*w,y*S,g*x,g*_);break;case"XZX":t.set(g*x,y*T,y*M,g*_);break;case"YXY":t.set(y*M,g*x,y*T,g*_);break;case"ZYZ":t.set(y*T,y*M,g*x,g*_);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}};class Vector2{constructor(t=0,r=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=r}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,r){return this.x=t,this.y=r,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,r){return void 0!==r?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,r)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this}sub(t,r){return void 0!==r?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,r)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const r=this.x,i=this.y,o=t.elements;return this.x=o[0]*r+o[3]*i+o[6],this.y=o[1]*r+o[4]*i+o[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,r){return this.x=Math.max(t.x,Math.min(r.x,this.x)),this.y=Math.max(t.y,Math.min(r.y,this.y)),this}clampScalar(t,r){return this.x=Math.max(t,Math.min(r,this.x)),this.y=Math.max(t,Math.min(r,this.y)),this}clampLength(t,r){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(r,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,i=this.y-t.y;return r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this}lerpVectors(t,r,i){return this.x=t.x+(r.x-t.x)*i,this.y=t.y+(r.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t}fromBufferAttribute(t,r,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(r),this.y=t.getY(r),this}rotateAround(t,r){const i=Math.cos(r),o=Math.sin(r),a=this.x-t.x,l=this.y-t.y;return this.x=a*i-l*o+t.x,this.y=a*o+l*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,r,i,o,a,l,h,g,y){const _=this.elements;return _[0]=t,_[1]=o,_[2]=h,_[3]=r,_[4]=a,_[5]=g,_[6]=i,_[7]=l,_[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const r=this.elements,i=t.elements;return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],this}extractBasis(t,r,i){return t.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const i=t.elements,o=r.elements,a=this.elements,l=i[0],h=i[3],g=i[6],y=i[1],_=i[4],x=i[7],w=i[2],S=i[5],M=i[8],T=o[0],P=o[3],C=o[6],A=o[1],O=o[4],L=o[7],I=o[2],R=o[5],j=o[8];return a[0]=l*T+h*A+g*I,a[3]=l*P+h*O+g*R,a[6]=l*C+h*L+g*j,a[1]=y*T+_*A+x*I,a[4]=y*P+_*O+x*R,a[7]=y*C+_*L+x*j,a[2]=w*T+S*A+M*I,a[5]=w*P+S*O+M*R,a[8]=w*C+S*L+M*j,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}determinant(){const t=this.elements,r=t[0],i=t[1],o=t[2],a=t[3],l=t[4],h=t[5],g=t[6],y=t[7],_=t[8];return r*l*_-r*h*y-i*a*_+i*h*g+o*a*y-o*l*g}getInverse(t,r){void 0!==r&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const i=t.elements,o=this.elements,a=i[0],l=i[1],h=i[2],g=i[3],y=i[4],_=i[5],x=i[6],w=i[7],S=i[8],M=S*y-_*w,T=_*x-S*g,P=w*g-y*x,C=a*M+l*T+h*P;if(0===C)return this.set(0,0,0,0,0,0,0,0,0);const A=1/C;return o[0]=M*A,o[1]=(h*w-S*l)*A,o[2]=(_*l-h*y)*A,o[3]=T*A,o[4]=(S*a-h*x)*A,o[5]=(h*g-_*a)*A,o[6]=P*A,o[7]=(l*x-w*a)*A,o[8]=(y*a-l*g)*A,this}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).getInverse(this).transpose()}transposeIntoArray(t){const r=this.elements;return t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8],this}setUvTransform(t,r,i,o,a,l,h){const g=Math.cos(a),y=Math.sin(a);this.set(i*g,i*y,-i*(g*l+y*h)+l+t,-o*y,o*g,-o*(-y*l+g*h)+h+r,0,0,1)}scale(t,r){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=r,i[4]*=r,i[7]*=r,this}rotate(t){const r=Math.cos(t),i=Math.sin(t),o=this.elements,a=o[0],l=o[3],h=o[6],g=o[1],y=o[4],_=o[7];return o[0]=r*a+i*g,o[3]=r*l+i*y,o[6]=r*h+i*_,o[1]=-i*a+r*g,o[4]=-i*l+r*y,o[7]=-i*h+r*_,this}translate(t,r){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=r*i[2],i[4]+=r*i[5],i[7]+=r*i[8],this}equals(t){const r=this.elements,i=t.elements;for(let o=0;o<9;o++)if(r[o]!==i[o])return!1;return!0}fromArray(t,r=0){for(let i=0;i<9;i++)this.elements[i]=t[i+r];return this}toArray(t=[],r=0){const i=this.elements;return t[r]=i[0],t[r+1]=i[1],t[r+2]=i[2],t[r+3]=i[3],t[r+4]=i[4],t[r+5]=i[5],t[r+6]=i[6],t[r+7]=i[7],t[r+8]=i[8],t}}let Jn;const er={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let r;if(t instanceof HTMLCanvasElement)r=t;else{void 0===Jn&&(Jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Jn.width=t.width,Jn.height=t.height;const i=Jn.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),r=Jn}return r.width>2048||r.height>2048?r.toDataURL("image/jpeg",.6):r.toDataURL("image/png")}};let tr=0;function Texture(t,r,i,o,a,l,h,g,y,_){Object.defineProperty(this,"id",{value:tr++}),this.uuid=Qn.generateUUID(),this.name="",this.image=void 0!==t?t:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==r?r:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:Ee,this.wrapT=void 0!==o?o:Ee,this.magFilter=void 0!==a?a:Ie,this.minFilter=void 0!==l?l:Ne,this.anisotropy=void 0!==y?y:1,this.format=void 0!==h?h:Ze,this.internalFormat=null,this.type=void 0!==g?g:De,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==_?_:dn,this.version=0,this.onUpdate=null}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=ve,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const o=this.image;if(void 0===o.uuid&&(o.uuid=Qn.generateUUID()),!r&&void 0===t.images[o.uuid]){let r;if(Array.isArray(o)){r=[];for(let t=0,i=o.length;t<i;t++)r.push(er.getDataURL(o[t]))}else r=er.getDataURL(o);t.images[o.uuid]={uuid:o.uuid,url:r}}i.image=o.uuid}return r||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==ve)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Me:t.x=t.x-Math.floor(t.x);break;case Ee:t.x=t.x<0?0:1;break;case Te:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Me:t.y=t.y-Math.floor(t.y);break;case Ee:t.y=t.y<0?0:1;break;case Te:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class Vector4{constructor(t=0,r=0,i=0,o=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=r,this.z=i,this.w=o}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,r,i,o){return this.x=t,this.y=r,this.z=i,this.w=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;case 3:this.w=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,r){return void 0!==r?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,r)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this.z=t.z+r.z,this.w=t.w+r.w,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this.z+=t.z*r,this.w+=t.w*r,this}sub(t,r){return void 0!==r?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,r)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this.w=t.w-r.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const r=this.x,i=this.y,o=this.z,a=this.w,l=t.elements;return this.x=l[0]*r+l[4]*i+l[8]*o+l[12]*a,this.y=l[1]*r+l[5]*i+l[9]*o+l[13]*a,this.z=l[2]*r+l[6]*i+l[10]*o+l[14]*a,this.w=l[3]*r+l[7]*i+l[11]*o+l[15]*a,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const r=Math.sqrt(1-t.w*t.w);return r<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/r,this.y=t.y/r,this.z=t.z/r),this}setAxisAngleFromRotationMatrix(t){let r,i,o,a;const l=.01,h=.1,g=t.elements,y=g[0],_=g[4],x=g[8],w=g[1],S=g[5],M=g[9],T=g[2],P=g[6],C=g[10];if(Math.abs(_-w)<l&&Math.abs(x-T)<l&&Math.abs(M-P)<l){if(Math.abs(_+w)<h&&Math.abs(x+T)<h&&Math.abs(M+P)<h&&Math.abs(y+S+C-3)<h)return this.set(1,0,0,0),this;r=Math.PI;const t=(y+1)/2,g=(S+1)/2,A=(C+1)/2,O=(_+w)/4,L=(x+T)/4,I=(M+P)/4;return t>g&&t>A?t<l?(i=0,o=.707106781,a=.707106781):(i=Math.sqrt(t),o=O/i,a=L/i):g>A?g<l?(i=.707106781,o=0,a=.707106781):(o=Math.sqrt(g),i=O/o,a=I/o):A<l?(i=.707106781,o=.707106781,a=0):(a=Math.sqrt(A),i=L/a,o=I/a),this.set(i,o,a,r),this}let A=Math.sqrt((P-M)*(P-M)+(x-T)*(x-T)+(w-_)*(w-_));return Math.abs(A)<.001&&(A=1),this.x=(P-M)/A,this.y=(x-T)/A,this.z=(w-_)/A,this.w=Math.acos((y+S+C-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,r){return this.x=Math.max(t.x,Math.min(r.x,this.x)),this.y=Math.max(t.y,Math.min(r.y,this.y)),this.z=Math.max(t.z,Math.min(r.z,this.z)),this.w=Math.max(t.w,Math.min(r.w,this.w)),this}clampScalar(t,r){return this.x=Math.max(t,Math.min(r,this.x)),this.y=Math.max(t,Math.min(r,this.y)),this.z=Math.max(t,Math.min(r,this.z)),this.w=Math.max(t,Math.min(r,this.w)),this}clampLength(t,r){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(r,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this.z+=(t.z-this.z)*r,this.w+=(t.w-this.w)*r,this}lerpVectors(t,r,i){return this.x=t.x+(r.x-t.x)*i,this.y=t.y+(r.y-t.y)*i,this.z=t.z+(r.z-t.z)*i,this.w=t.w+(r.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this.z=t[r+2],this.w=t[r+3],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t[r+2]=this.z,t[r+3]=this.w,t}fromBufferAttribute(t,r,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(r),this.y=t.getY(r),this.z=t.getZ(r),this.w=t.getW(r),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function WebGLRenderTarget(t,r,i){this.width=t,this.height=r,this.scissor=new Vector4(0,0,t,r),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,r),i=i||{},this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=r,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Ie,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function WebGLMultisampleRenderTarget(t,r,i){WebGLRenderTarget.call(this,t,r,i),this.samples=4}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(t,r){this.width===t&&this.height===r||(this.width=t,this.height=r,this.texture.image.width=t,this.texture.image.height=r,this.dispose()),this.viewport.set(0,0,t,r),this.scissor.set(0,0,t,r)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.samples=t.samples,this}});class Quaternion{constructor(t=0,r=0,i=0,o=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=r,this._z=i,this._w=o}static slerp(t,r,i,o){return i.copy(t).slerp(r,o)}static slerpFlat(t,r,i,o,a,l,h){let g=i[o+0],y=i[o+1],_=i[o+2],x=i[o+3];const w=a[l+0],S=a[l+1],M=a[l+2],T=a[l+3];if(x!==T||g!==w||y!==S||_!==M){let t=1-h;const r=g*w+y*S+_*M+x*T,i=r>=0?1:-1,o=1-r*r;if(o>Number.EPSILON){const a=Math.sqrt(o),l=Math.atan2(a,r*i);t=Math.sin(t*l)/a,h=Math.sin(h*l)/a}const a=h*i;if(g=g*t+w*a,y=y*t+S*a,_=_*t+M*a,x=x*t+T*a,t===1-h){const t=1/Math.sqrt(g*g+y*y+_*_+x*x);g*=t,y*=t,_*=t,x*=t}}t[r]=g,t[r+1]=y,t[r+2]=_,t[r+3]=x}static multiplyQuaternionsFlat(t,r,i,o,a,l){const h=i[o],g=i[o+1],y=i[o+2],_=i[o+3],x=a[l],w=a[l+1],S=a[l+2],M=a[l+3];return t[r]=h*M+_*x+g*S-y*w,t[r+1]=g*M+_*w+y*x-h*S,t[r+2]=y*M+_*S+h*w-g*x,t[r+3]=_*M-h*x-g*w-y*S,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,r,i,o){return this._x=t,this._y=r,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,r){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,o=t._y,a=t._z,l=t._order,h=Math.cos,g=Math.sin,y=h(i/2),_=h(o/2),x=h(a/2),w=g(i/2),S=g(o/2),M=g(a/2);switch(l){case"XYZ":this._x=w*_*x+y*S*M,this._y=y*S*x-w*_*M,this._z=y*_*M+w*S*x,this._w=y*_*x-w*S*M;break;case"YXZ":this._x=w*_*x+y*S*M,this._y=y*S*x-w*_*M,this._z=y*_*M-w*S*x,this._w=y*_*x+w*S*M;break;case"ZXY":this._x=w*_*x-y*S*M,this._y=y*S*x+w*_*M,this._z=y*_*M+w*S*x,this._w=y*_*x-w*S*M;break;case"ZYX":this._x=w*_*x-y*S*M,this._y=y*S*x+w*_*M,this._z=y*_*M-w*S*x,this._w=y*_*x+w*S*M;break;case"YZX":this._x=w*_*x+y*S*M,this._y=y*S*x+w*_*M,this._z=y*_*M-w*S*x,this._w=y*_*x-w*S*M;break;case"XZY":this._x=w*_*x-y*S*M,this._y=y*S*x-w*_*M,this._z=y*_*M+w*S*x,this._w=y*_*x+w*S*M;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return!1!==r&&this._onChangeCallback(),this}setFromAxisAngle(t,r){const i=r/2,o=Math.sin(i);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const r=t.elements,i=r[0],o=r[4],a=r[8],l=r[1],h=r[5],g=r[9],y=r[2],_=r[6],x=r[10],w=i+h+x;if(w>0){const t=.5/Math.sqrt(w+1);this._w=.25/t,this._x=(_-g)*t,this._y=(a-y)*t,this._z=(l-o)*t}else if(i>h&&i>x){const t=2*Math.sqrt(1+i-h-x);this._w=(_-g)/t,this._x=.25*t,this._y=(o+l)/t,this._z=(a+y)/t}else if(h>x){const t=2*Math.sqrt(1+h-i-x);this._w=(a-y)/t,this._x=(o+l)/t,this._y=.25*t,this._z=(g+_)/t}else{const t=2*Math.sqrt(1+x-i-h);this._w=(l-o)/t,this._x=(a+y)/t,this._y=(g+_)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,r){let i=t.dot(r)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*r.z-t.z*r.y,this._y=t.z*r.x-t.x*r.z,this._z=t.x*r.y-t.y*r.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Qn.clamp(this.dot(t),-1,1)))}rotateTowards(t,r){const i=this.angleTo(t);if(0===i)return this;const o=Math.min(1,r/i);return this.slerp(t,o),this}identity(){return this.set(0,0,0,1)}inverse(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,r){return void 0!==r?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,r)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,r){const i=t._x,o=t._y,a=t._z,l=t._w,h=r._x,g=r._y,y=r._z,_=r._w;return this._x=i*_+l*h+o*y-a*g,this._y=o*_+l*g+a*h-i*y,this._z=a*_+l*y+i*g-o*h,this._w=l*_-i*h-o*g-a*y,this._onChangeCallback(),this}slerp(t,r){if(0===r)return this;if(1===r)return this.copy(t);const i=this._x,o=this._y,a=this._z,l=this._w;let h=l*t._w+i*t._x+o*t._y+a*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=l,this._x=i,this._y=o,this._z=a,this;const g=1-h*h;if(g<=Number.EPSILON){const t=1-r;return this._w=t*l+r*this._w,this._x=t*i+r*this._x,this._y=t*o+r*this._y,this._z=t*a+r*this._z,this.normalize(),this._onChangeCallback(),this}const y=Math.sqrt(g),_=Math.atan2(y,h),x=Math.sin((1-r)*_)/y,w=Math.sin(r*_)/y;return this._w=l*x+this._w*w,this._x=i*x+this._x*w,this._y=o*x+this._y*w,this._z=a*x+this._z*w,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,r=0){return this._x=t[r],this._y=t[r+1],this._z=t[r+2],this._w=t[r+3],this._onChangeCallback(),this}toArray(t=[],r=0){return t[r]=this._x,t[r+1]=this._y,t[r+2]=this._z,t[r+3]=this._w,t}fromBufferAttribute(t,r){return this._x=t.getX(r),this._y=t.getY(r),this._z=t.getZ(r),this._w=t.getW(r),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Vector3{constructor(t=0,r=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=r,this.z=i}set(t,r,i){return void 0===i&&(i=this.z),this.x=t,this.y=r,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,r){return void 0!==r?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,r)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this.z=t.z+r.z,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this.z+=t.z*r,this}sub(t,r){return void 0!==r?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,r)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this}multiply(t,r){return void 0!==r?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,r)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,r){return this.x=t.x*r.x,this.y=t.y*r.y,this.z=t.z*r.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(rr.setFromEuler(t))}applyAxisAngle(t,r){return this.applyQuaternion(rr.setFromAxisAngle(t,r))}applyMatrix3(t){const r=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*r+a[3]*i+a[6]*o,this.y=a[1]*r+a[4]*i+a[7]*o,this.z=a[2]*r+a[5]*i+a[8]*o,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const r=this.x,i=this.y,o=this.z,a=t.elements,l=1/(a[3]*r+a[7]*i+a[11]*o+a[15]);return this.x=(a[0]*r+a[4]*i+a[8]*o+a[12])*l,this.y=(a[1]*r+a[5]*i+a[9]*o+a[13])*l,this.z=(a[2]*r+a[6]*i+a[10]*o+a[14])*l,this}applyQuaternion(t){const r=this.x,i=this.y,o=this.z,a=t.x,l=t.y,h=t.z,g=t.w,y=g*r+l*o-h*i,_=g*i+h*r-a*o,x=g*o+a*i-l*r,w=-a*r-l*i-h*o;return this.x=y*g+w*-a+_*-h-x*-l,this.y=_*g+w*-l+x*-a-y*-h,this.z=x*g+w*-h+y*-l-_*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const r=this.x,i=this.y,o=this.z,a=t.elements;return this.x=a[0]*r+a[4]*i+a[8]*o,this.y=a[1]*r+a[5]*i+a[9]*o,this.z=a[2]*r+a[6]*i+a[10]*o,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,r){return this.x=Math.max(t.x,Math.min(r.x,this.x)),this.y=Math.max(t.y,Math.min(r.y,this.y)),this.z=Math.max(t.z,Math.min(r.z,this.z)),this}clampScalar(t,r){return this.x=Math.max(t,Math.min(r,this.x)),this.y=Math.max(t,Math.min(r,this.y)),this.z=Math.max(t,Math.min(r,this.z)),this}clampLength(t,r){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(r,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this.z+=(t.z-this.z)*r,this}lerpVectors(t,r,i){return this.x=t.x+(r.x-t.x)*i,this.y=t.y+(r.y-t.y)*i,this.z=t.z+(r.z-t.z)*i,this}cross(t,r){return void 0!==r?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,r)):this.crossVectors(this,t)}crossVectors(t,r){const i=t.x,o=t.y,a=t.z,l=r.x,h=r.y,g=r.z;return this.x=o*g-a*h,this.y=a*l-i*g,this.z=i*h-o*l,this}projectOnVector(t){const r=t.lengthSq();if(0===r)return this.set(0,0,0);const i=t.dot(this)/r;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return nr.copy(this).projectOnVector(t),this.sub(nr)}reflect(t){return this.sub(nr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const r=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===r)return Math.PI/2;const i=this.dot(t)/r;return Math.acos(Qn.clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,i=this.y-t.y,o=this.z-t.z;return r*r+i*i+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,r,i){const o=Math.sin(r)*t;return this.x=o*Math.sin(i),this.y=Math.cos(r)*t,this.z=o*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,r,i){return this.x=t*Math.sin(r),this.y=i,this.z=t*Math.cos(r),this}setFromMatrixPosition(t){const r=t.elements;return this.x=r[12],this.y=r[13],this.z=r[14],this}setFromMatrixScale(t){const r=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),o=this.setFromMatrixColumn(t,2).length();return this.x=r,this.y=i,this.z=o,this}setFromMatrixColumn(t,r){return this.fromArray(t.elements,4*r)}setFromMatrix3Column(t,r){return this.fromArray(t.elements,3*r)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this.z=t[r+2],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t[r+2]=this.z,t}fromBufferAttribute(t,r,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(r),this.y=t.getY(r),this.z=t.getZ(r),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const nr=new Vector3,rr=new Quaternion;class Box3{constructor(t,r){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Vector3(1/0,1/0,1/0),this.max=void 0!==r?r:new Vector3(-1/0,-1/0,-1/0)}set(t,r){return this.min.copy(t),this.max.copy(r),this}setFromArray(t){let r=1/0,i=1/0,o=1/0,a=-1/0,l=-1/0,h=-1/0;for(let g=0,y=t.length;g<y;g+=3){const y=t[g],_=t[g+1],x=t[g+2];y<r&&(r=y),_<i&&(i=_),x<o&&(o=x),y>a&&(a=y),_>l&&(l=_),x>h&&(h=x)}return this.min.set(r,i,o),this.max.set(a,l,h),this}setFromBufferAttribute(t){let r=1/0,i=1/0,o=1/0,a=-1/0,l=-1/0,h=-1/0;for(let g=0,y=t.count;g<y;g++){const y=t.getX(g),_=t.getY(g),x=t.getZ(g);y<r&&(r=y),_<i&&(i=_),x<o&&(o=x),y>a&&(a=y),_>l&&(l=_),x>h&&(h=x)}return this.min.set(r,i,o),this.max.set(a,l,h),this}setFromPoints(t){this.makeEmpty();for(let r=0,i=t.length;r<i;r++)this.expandByPoint(t[r]);return this}setFromCenterAndSize(t,r){const i=or.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Vector3),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const r=t.geometry;void 0!==r&&(null===r.boundingBox&&r.computeBoundingBox(),ar.copy(r.boundingBox),ar.applyMatrix4(t.matrixWorld),this.union(ar));const i=t.children;for(let o=0,a=i.length;o<a;o++)this.expandByObject(i[o]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,r){return void 0===r&&(console.warn("THREE.Box3: .getParameter() target is now required"),r=new Vector3),r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,or),or.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let r,i;return t.normal.x>0?(r=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(r=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(r+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(r+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(r+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(r+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),r<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(pr),fr.subVectors(this.max,pr),sr.subVectors(t.a,pr),cr.subVectors(t.b,pr),lr.subVectors(t.c,pr),ur.subVectors(cr,sr),dr.subVectors(lr,cr),hr.subVectors(sr,lr);let r=[0,-ur.z,ur.y,0,-dr.z,dr.y,0,-hr.z,hr.y,ur.z,0,-ur.x,dr.z,0,-dr.x,hr.z,0,-hr.x,-ur.y,ur.x,0,-dr.y,dr.x,0,-hr.y,hr.x,0];return!!satForAxes(r,sr,cr,lr,fr)&&(r=[1,0,0,0,1,0,0,0,1],!!satForAxes(r,sr,cr,lr,fr)&&(mr.crossVectors(ur,dr),r=[mr.x,mr.y,mr.z],satForAxes(r,sr,cr,lr,fr)))}clampPoint(t,r){return void 0===r&&(console.warn("THREE.Box3: .clampPoint() target is now required"),r=new Vector3),r.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return or.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(or).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(ir[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ir[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ir[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ir[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ir[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ir[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ir[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ir[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ir)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function satForAxes(t,r,i,o,a){for(let l=0,h=t.length-3;l<=h;l+=3){gr.fromArray(t,l);const h=a.x*Math.abs(gr.x)+a.y*Math.abs(gr.y)+a.z*Math.abs(gr.z),g=r.dot(gr),y=i.dot(gr),_=o.dot(gr);if(Math.max(-Math.max(g,y,_),Math.min(g,y,_))>h)return!1}return!0}const ir=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],or=new Vector3,ar=new Box3,sr=new Vector3,cr=new Vector3,lr=new Vector3,ur=new Vector3,dr=new Vector3,hr=new Vector3,pr=new Vector3,fr=new Vector3,mr=new Vector3,gr=new Vector3,vr=new Box3;class Sphere{constructor(t,r){this.center=void 0!==t?t:new Vector3,this.radius=void 0!==r?r:-1}set(t,r){return this.center.copy(t),this.radius=r,this}setFromPoints(t,r){const i=this.center;void 0!==r?i.copy(r):vr.setFromPoints(t).getCenter(i);let o=0;for(let a=0,l=t.length;a<l;a++)o=Math.max(o,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(o),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const r=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=r*r}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,r){const i=this.center.distanceToSquared(t);return void 0===r&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),r=new Vector3),r.copy(t),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Box3),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const yr=new Vector3,br=new Vector3,_r=new Vector3,xr=new Vector3,wr=new Vector3,Sr=new Vector3,Mr=new Vector3;class Ray{constructor(t,r){this.origin=void 0!==t?t:new Vector3,this.direction=void 0!==r?r:new Vector3(0,0,-1)}set(t,r){return this.origin.copy(t),this.direction.copy(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,r){return void 0===r&&(console.warn("THREE.Ray: .at() target is now required"),r=new Vector3),r.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,yr)),this}closestPointToPoint(t,r){void 0===r&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),r=new Vector3),r.subVectors(t,this.origin);const i=r.dot(this.direction);return i<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const r=yr.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(yr.copy(this.direction).multiplyScalar(r).add(this.origin),yr.distanceToSquared(t))}distanceSqToSegment(t,r,i,o){br.copy(t).add(r).multiplyScalar(.5),_r.copy(r).sub(t).normalize(),xr.copy(this.origin).sub(br);const a=.5*t.distanceTo(r),l=-this.direction.dot(_r),h=xr.dot(this.direction),g=-xr.dot(_r),y=xr.lengthSq(),_=Math.abs(1-l*l);let x,w,S,M;if(_>0)if(x=l*g-h,w=l*h-g,M=a*_,x>=0)if(w>=-M)if(w<=M){const t=1/_;x*=t,w*=t,S=x*(x+l*w+2*h)+w*(l*x+w+2*g)+y}else w=a,x=Math.max(0,-(l*w+h)),S=-x*x+w*(w+2*g)+y;else w=-a,x=Math.max(0,-(l*w+h)),S=-x*x+w*(w+2*g)+y;else w<=-M?(x=Math.max(0,-(-l*a+h)),w=x>0?-a:Math.min(Math.max(-a,-g),a),S=-x*x+w*(w+2*g)+y):w<=M?(x=0,w=Math.min(Math.max(-a,-g),a),S=w*(w+2*g)+y):(x=Math.max(0,-(l*a+h)),w=x>0?a:Math.min(Math.max(-a,-g),a),S=-x*x+w*(w+2*g)+y);else w=l>0?-a:a,x=Math.max(0,-(l*w+h)),S=-x*x+w*(w+2*g)+y;return i&&i.copy(this.direction).multiplyScalar(x).add(this.origin),o&&o.copy(_r).multiplyScalar(w).add(br),S}intersectSphere(t,r){yr.subVectors(t.center,this.origin);const i=yr.dot(this.direction),o=yr.dot(yr)-i*i,a=t.radius*t.radius;if(o>a)return null;const l=Math.sqrt(a-o),h=i-l,g=i+l;return h<0&&g<0?null:h<0?this.at(g,r):this.at(h,r)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const r=t.normal.dot(this.direction);if(0===r)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/r;return i>=0?i:null}intersectPlane(t,r){const i=this.distanceToPlane(t);return null===i?null:this.at(i,r)}intersectsPlane(t){const r=t.distanceToPoint(this.origin);if(0===r)return!0;return t.normal.dot(this.direction)*r<0}intersectBox(t,r){let i,o,a,l,h,g;const y=1/this.direction.x,_=1/this.direction.y,x=1/this.direction.z,w=this.origin;return y>=0?(i=(t.min.x-w.x)*y,o=(t.max.x-w.x)*y):(i=(t.max.x-w.x)*y,o=(t.min.x-w.x)*y),_>=0?(a=(t.min.y-w.y)*_,l=(t.max.y-w.y)*_):(a=(t.max.y-w.y)*_,l=(t.min.y-w.y)*_),i>l||a>o?null:((a>i||i!=i)&&(i=a),(l<o||o!=o)&&(o=l),x>=0?(h=(t.min.z-w.z)*x,g=(t.max.z-w.z)*x):(h=(t.max.z-w.z)*x,g=(t.min.z-w.z)*x),i>g||h>o?null:((h>i||i!=i)&&(i=h),(g<o||o!=o)&&(o=g),o<0?null:this.at(i>=0?i:o,r)))}intersectsBox(t){return null!==this.intersectBox(t,yr)}intersectTriangle(t,r,i,o,a){wr.subVectors(r,t),Sr.subVectors(i,t),Mr.crossVectors(wr,Sr);let l,h=this.direction.dot(Mr);if(h>0){if(o)return null;l=1}else{if(!(h<0))return null;l=-1,h=-h}xr.subVectors(this.origin,t);const g=l*this.direction.dot(Sr.crossVectors(xr,Sr));if(g<0)return null;const y=l*this.direction.dot(wr.cross(xr));if(y<0)return null;if(g+y>h)return null;const _=-l*xr.dot(Mr);return _<0?null:this.at(_/h,a)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,r,i,o,a,l,h,g,y,_,x,w,S,M,T,P){const C=this.elements;return C[0]=t,C[4]=r,C[8]=i,C[12]=o,C[1]=a,C[5]=l,C[9]=h,C[13]=g,C[2]=y,C[6]=_,C[10]=x,C[14]=w,C[3]=S,C[7]=M,C[11]=T,C[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(t){const r=this.elements,i=t.elements;return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this}copyPosition(t){const r=this.elements,i=t.elements;return r[12]=i[12],r[13]=i[13],r[14]=i[14],this}extractBasis(t,r,i){return t.setFromMatrixColumn(this,0),r.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,r,i){return this.set(t.x,r.x,i.x,0,t.y,r.y,i.y,0,t.z,r.z,i.z,0,0,0,0,1),this}extractRotation(t){const r=this.elements,i=t.elements,o=1/Er.setFromMatrixColumn(t,0).length(),a=1/Er.setFromMatrixColumn(t,1).length(),l=1/Er.setFromMatrixColumn(t,2).length();return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[3]=0,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[7]=0,r[8]=i[8]*l,r[9]=i[9]*l,r[10]=i[10]*l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const r=this.elements,i=t.x,o=t.y,a=t.z,l=Math.cos(i),h=Math.sin(i),g=Math.cos(o),y=Math.sin(o),_=Math.cos(a),x=Math.sin(a);if("XYZ"===t.order){const t=l*_,i=l*x,o=h*_,a=h*x;r[0]=g*_,r[4]=-g*x,r[8]=y,r[1]=i+o*y,r[5]=t-a*y,r[9]=-h*g,r[2]=a-t*y,r[6]=o+i*y,r[10]=l*g}else if("YXZ"===t.order){const t=g*_,i=g*x,o=y*_,a=y*x;r[0]=t+a*h,r[4]=o*h-i,r[8]=l*y,r[1]=l*x,r[5]=l*_,r[9]=-h,r[2]=i*h-o,r[6]=a+t*h,r[10]=l*g}else if("ZXY"===t.order){const t=g*_,i=g*x,o=y*_,a=y*x;r[0]=t-a*h,r[4]=-l*x,r[8]=o+i*h,r[1]=i+o*h,r[5]=l*_,r[9]=a-t*h,r[2]=-l*y,r[6]=h,r[10]=l*g}else if("ZYX"===t.order){const t=l*_,i=l*x,o=h*_,a=h*x;r[0]=g*_,r[4]=o*y-i,r[8]=t*y+a,r[1]=g*x,r[5]=a*y+t,r[9]=i*y-o,r[2]=-y,r[6]=h*g,r[10]=l*g}else if("YZX"===t.order){const t=l*g,i=l*y,o=h*g,a=h*y;r[0]=g*_,r[4]=a-t*x,r[8]=o*x+i,r[1]=x,r[5]=l*_,r[9]=-h*_,r[2]=-y*_,r[6]=i*x+o,r[10]=t-a*x}else if("XZY"===t.order){const t=l*g,i=l*y,o=h*g,a=h*y;r[0]=g*_,r[4]=-x,r[8]=y*_,r[1]=t*x+a,r[5]=l*_,r[9]=i*x-o,r[2]=o*x-i,r[6]=h*_,r[10]=a*x+t}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Pr,t,Cr)}lookAt(t,r,i){const o=this.elements;return Lr.subVectors(t,r),0===Lr.lengthSq()&&(Lr.z=1),Lr.normalize(),Ar.crossVectors(i,Lr),0===Ar.lengthSq()&&(1===Math.abs(i.z)?Lr.x+=1e-4:Lr.z+=1e-4,Lr.normalize(),Ar.crossVectors(i,Lr)),Ar.normalize(),Or.crossVectors(Lr,Ar),o[0]=Ar.x,o[4]=Or.x,o[8]=Lr.x,o[1]=Ar.y,o[5]=Or.y,o[9]=Lr.y,o[2]=Ar.z,o[6]=Or.z,o[10]=Lr.z,this}multiply(t,r){return void 0!==r?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,r)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const i=t.elements,o=r.elements,a=this.elements,l=i[0],h=i[4],g=i[8],y=i[12],_=i[1],x=i[5],w=i[9],S=i[13],M=i[2],T=i[6],P=i[10],C=i[14],A=i[3],O=i[7],L=i[11],I=i[15],R=o[0],j=o[4],N=o[8],k=o[12],D=o[1],B=o[5],G=o[9],H=o[13],V=o[2],U=o[6],z=o[10],W=o[14],q=o[3],$=o[7],X=o[11],K=o[15];return a[0]=l*R+h*D+g*V+y*q,a[4]=l*j+h*B+g*U+y*$,a[8]=l*N+h*G+g*z+y*X,a[12]=l*k+h*H+g*W+y*K,a[1]=_*R+x*D+w*V+S*q,a[5]=_*j+x*B+w*U+S*$,a[9]=_*N+x*G+w*z+S*X,a[13]=_*k+x*H+w*W+S*K,a[2]=M*R+T*D+P*V+C*q,a[6]=M*j+T*B+P*U+C*$,a[10]=M*N+T*G+P*z+C*X,a[14]=M*k+T*H+P*W+C*K,a[3]=A*R+O*D+L*V+I*q,a[7]=A*j+O*B+L*U+I*$,a[11]=A*N+O*G+L*z+I*X,a[15]=A*k+O*H+L*W+I*K,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[4]*=t,r[8]*=t,r[12]*=t,r[1]*=t,r[5]*=t,r[9]*=t,r[13]*=t,r[2]*=t,r[6]*=t,r[10]*=t,r[14]*=t,r[3]*=t,r[7]*=t,r[11]*=t,r[15]*=t,this}determinant(){const t=this.elements,r=t[0],i=t[4],o=t[8],a=t[12],l=t[1],h=t[5],g=t[9],y=t[13],_=t[2],x=t[6],w=t[10],S=t[14];return t[3]*(+a*g*x-o*y*x-a*h*w+i*y*w+o*h*S-i*g*S)+t[7]*(+r*g*S-r*y*w+a*l*w-o*l*S+o*y*_-a*g*_)+t[11]*(+r*y*x-r*h*S-a*l*x+i*l*S+a*h*_-i*y*_)+t[15]*(-o*h*_-r*g*x+r*h*w+o*l*x-i*l*w+i*g*_)}transpose(){const t=this.elements;let r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[6],t[6]=t[9],t[9]=r,r=t[3],t[3]=t[12],t[12]=r,r=t[7],t[7]=t[13],t[13]=r,r=t[11],t[11]=t[14],t[14]=r,this}setPosition(t,r,i){const o=this.elements;return t.isVector3?(o[12]=t.x,o[13]=t.y,o[14]=t.z):(o[12]=t,o[13]=r,o[14]=i),this}getInverse(t,r){void 0!==r&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const i=this.elements,o=t.elements,a=o[0],l=o[1],h=o[2],g=o[3],y=o[4],_=o[5],x=o[6],w=o[7],S=o[8],M=o[9],T=o[10],P=o[11],C=o[12],A=o[13],O=o[14],L=o[15],I=M*O*w-A*T*w+A*x*P-_*O*P-M*x*L+_*T*L,R=C*T*w-S*O*w-C*x*P+y*O*P+S*x*L-y*T*L,j=S*A*w-C*M*w+C*_*P-y*A*P-S*_*L+y*M*L,N=C*M*x-S*A*x-C*_*T+y*A*T+S*_*O-y*M*O,k=a*I+l*R+h*j+g*N;if(0===k)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const D=1/k;return i[0]=I*D,i[1]=(A*T*g-M*O*g-A*h*P+l*O*P+M*h*L-l*T*L)*D,i[2]=(_*O*g-A*x*g+A*h*w-l*O*w-_*h*L+l*x*L)*D,i[3]=(M*x*g-_*T*g-M*h*w+l*T*w+_*h*P-l*x*P)*D,i[4]=R*D,i[5]=(S*O*g-C*T*g+C*h*P-a*O*P-S*h*L+a*T*L)*D,i[6]=(C*x*g-y*O*g-C*h*w+a*O*w+y*h*L-a*x*L)*D,i[7]=(y*T*g-S*x*g+S*h*w-a*T*w-y*h*P+a*x*P)*D,i[8]=j*D,i[9]=(C*M*g-S*A*g-C*l*P+a*A*P+S*l*L-a*M*L)*D,i[10]=(y*A*g-C*_*g+C*l*w-a*A*w-y*l*L+a*_*L)*D,i[11]=(S*_*g-y*M*g-S*l*w+a*M*w+y*l*P-a*_*P)*D,i[12]=N*D,i[13]=(S*A*h-C*M*h+C*l*T-a*A*T-S*l*O+a*M*O)*D,i[14]=(C*_*h-y*A*h-C*l*x+a*A*x+y*l*O-a*_*O)*D,i[15]=(y*M*h-S*_*h+S*l*x-a*M*x-y*l*T+a*_*T)*D,this}scale(t){const r=this.elements,i=t.x,o=t.y,a=t.z;return r[0]*=i,r[4]*=o,r[8]*=a,r[1]*=i,r[5]*=o,r[9]*=a,r[2]*=i,r[6]*=o,r[10]*=a,r[3]*=i,r[7]*=o,r[11]*=a,this}getMaxScaleOnAxis(){const t=this.elements,r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],o=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(r,i,o))}makeTranslation(t,r,i){return this.set(1,0,0,t,0,1,0,r,0,0,1,i,0,0,0,1),this}makeRotationX(t){const r=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,r,-i,0,0,i,r,0,0,0,0,1),this}makeRotationY(t){const r=Math.cos(t),i=Math.sin(t);return this.set(r,0,i,0,0,1,0,0,-i,0,r,0,0,0,0,1),this}makeRotationZ(t){const r=Math.cos(t),i=Math.sin(t);return this.set(r,-i,0,0,i,r,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,r){const i=Math.cos(r),o=Math.sin(r),a=1-i,l=t.x,h=t.y,g=t.z,y=a*l,_=a*h;return this.set(y*l+i,y*h-o*g,y*g+o*h,0,y*h+o*g,_*h+i,_*g-o*l,0,y*g-o*h,_*g+o*l,a*g*g+i,0,0,0,0,1),this}makeScale(t,r,i){return this.set(t,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,r,i){return this.set(1,r,i,0,t,1,i,0,t,r,1,0,0,0,0,1),this}compose(t,r,i){const o=this.elements,a=r._x,l=r._y,h=r._z,g=r._w,y=a+a,_=l+l,x=h+h,w=a*y,S=a*_,M=a*x,T=l*_,P=l*x,C=h*x,A=g*y,O=g*_,L=g*x,I=i.x,R=i.y,j=i.z;return o[0]=(1-(T+C))*I,o[1]=(S+L)*I,o[2]=(M-O)*I,o[3]=0,o[4]=(S-L)*R,o[5]=(1-(w+C))*R,o[6]=(P+A)*R,o[7]=0,o[8]=(M+O)*j,o[9]=(P-A)*j,o[10]=(1-(w+T))*j,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this}decompose(t,r,i){const o=this.elements;let a=Er.set(o[0],o[1],o[2]).length();const l=Er.set(o[4],o[5],o[6]).length(),h=Er.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),t.x=o[12],t.y=o[13],t.z=o[14],Tr.copy(this);const g=1/a,y=1/l,_=1/h;return Tr.elements[0]*=g,Tr.elements[1]*=g,Tr.elements[2]*=g,Tr.elements[4]*=y,Tr.elements[5]*=y,Tr.elements[6]*=y,Tr.elements[8]*=_,Tr.elements[9]*=_,Tr.elements[10]*=_,r.setFromRotationMatrix(Tr),i.x=a,i.y=l,i.z=h,this}makePerspective(t,r,i,o,a,l){void 0===l&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const h=this.elements,g=2*a/(r-t),y=2*a/(i-o),_=(r+t)/(r-t),x=(i+o)/(i-o),w=-(l+a)/(l-a),S=-2*l*a/(l-a);return h[0]=g,h[4]=0,h[8]=_,h[12]=0,h[1]=0,h[5]=y,h[9]=x,h[13]=0,h[2]=0,h[6]=0,h[10]=w,h[14]=S,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,r,i,o,a,l){const h=this.elements,g=1/(r-t),y=1/(i-o),_=1/(l-a),x=(r+t)*g,w=(i+o)*y,S=(l+a)*_;return h[0]=2*g,h[4]=0,h[8]=0,h[12]=-x,h[1]=0,h[5]=2*y,h[9]=0,h[13]=-w,h[2]=0,h[6]=0,h[10]=-2*_,h[14]=-S,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const r=this.elements,i=t.elements;for(let o=0;o<16;o++)if(r[o]!==i[o])return!1;return!0}fromArray(t,r=0){for(let i=0;i<16;i++)this.elements[i]=t[i+r];return this}toArray(t=[],r=0){const i=this.elements;return t[r]=i[0],t[r+1]=i[1],t[r+2]=i[2],t[r+3]=i[3],t[r+4]=i[4],t[r+5]=i[5],t[r+6]=i[6],t[r+7]=i[7],t[r+8]=i[8],t[r+9]=i[9],t[r+10]=i[10],t[r+11]=i[11],t[r+12]=i[12],t[r+13]=i[13],t[r+14]=i[14],t[r+15]=i[15],t}}const Er=new Vector3,Tr=new Matrix4,Pr=new Vector3(0,0,0),Cr=new Vector3(1,1,1),Ar=new Vector3,Or=new Vector3,Lr=new Vector3;class Euler{constructor(t=0,r=0,i=0,o=Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=r,this._z=i,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,r,i,o){return this._x=t,this._y=r,this._z=i,this._order=o||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,r,i){const o=Qn.clamp,a=t.elements,l=a[0],h=a[4],g=a[8],y=a[1],_=a[5],x=a[9],w=a[2],S=a[6],M=a[10];switch(r=r||this._order){case"XYZ":this._y=Math.asin(o(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-x,M),this._z=Math.atan2(-h,l)):(this._x=Math.atan2(S,_),this._z=0);break;case"YXZ":this._x=Math.asin(-o(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(g,M),this._z=Math.atan2(y,_)):(this._y=Math.atan2(-w,l),this._z=0);break;case"ZXY":this._x=Math.asin(o(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(-w,M),this._z=Math.atan2(-h,_)):(this._y=0,this._z=Math.atan2(y,l));break;case"ZYX":this._y=Math.asin(-o(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(S,M),this._z=Math.atan2(y,l)):(this._x=0,this._z=Math.atan2(-h,_));break;case"YZX":this._z=Math.asin(o(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(-x,_),this._y=Math.atan2(-w,l)):(this._x=0,this._y=Math.atan2(g,M));break;case"XZY":this._z=Math.asin(-o(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(S,_),this._y=Math.atan2(g,l)):(this._x=Math.atan2(-x,M),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+r)}return this._order=r,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(t,r,i){return Ir.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ir,r,i)}setFromVector3(t,r){return this.set(t.x,t.y,t.z,r||this._order)}reorder(t){return Rr.setFromEuler(this),this.setFromQuaternion(Rr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],r=0){return t[r]=this._x,t[r+1]=this._y,t[r+2]=this._z,t[r+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Ir=new Matrix4,Rr=new Quaternion;class Layers{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let jr=0;const Nr=new Vector3,kr=new Quaternion,Dr=new Matrix4,Br=new Vector3,Fr=new Vector3,Gr=new Vector3,Hr=new Quaternion,Vr=new Vector3(1,0,0),Ur=new Vector3(0,1,0),zr=new Vector3(0,0,1),Wr={type:"added"},qr={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:jr++}),this.uuid=Qn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const t=new Vector3,r=new Euler,i=new Quaternion,o=new Vector3(1,1,1);r._onChange((function onRotationChange(){i.setFromEuler(r,!1)})),i._onChange((function onQuaternionChange(){r.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,r){this.quaternion.setFromAxisAngle(t,r)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,r){return kr.setFromAxisAngle(t,r),this.quaternion.multiply(kr),this},rotateOnWorldAxis:function(t,r){return kr.setFromAxisAngle(t,r),this.quaternion.premultiply(kr),this},rotateX:function(t){return this.rotateOnAxis(Vr,t)},rotateY:function(t){return this.rotateOnAxis(Ur,t)},rotateZ:function(t){return this.rotateOnAxis(zr,t)},translateOnAxis:function(t,r){return Nr.copy(t).applyQuaternion(this.quaternion),this.position.add(Nr.multiplyScalar(r)),this},translateX:function(t){return this.translateOnAxis(Vr,t)},translateY:function(t){return this.translateOnAxis(Ur,t)},translateZ:function(t){return this.translateOnAxis(zr,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Dr.getInverse(this.matrixWorld))},lookAt:function(t,r,i){t.isVector3?Br.copy(t):Br.set(t,r,i);const o=this.parent;this.updateWorldMatrix(!0,!1),Fr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dr.lookAt(Fr,Br,this.up):Dr.lookAt(Br,Fr,this.up),this.quaternion.setFromRotationMatrix(Dr),o&&(Dr.extractRotation(o.matrixWorld),kr.setFromRotationMatrix(Dr),this.quaternion.premultiply(kr.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Wr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(qr)),this},clear:function(){for(let t=0;t<this.children.length;t++){const r=this.children[t];r.parent=null,r.dispatchEvent(qr)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Dr.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Dr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Dr),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,r){if(this[t]===r)return this;for(let i=0,o=this.children.length;i<o;i++){const o=this.children[i].getObjectByProperty(t,r);if(void 0!==o)return o}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fr,t,Gr),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fr,Hr,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return t.set(r[8],r[9],r[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].traverseVisible(t)},traverseAncestors:function(t){const r=this.parent;null!==r&&(t(r),r.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,r){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===r){const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateWorldMatrix(!1,!0)}},toJSON:function(t){const r=void 0===t||"string"==typeof t,i={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const o={};function serialize(r,i){return void 0===r[i.uuid]&&(r[i.uuid]=i.toJSON(t)),i.uuid}if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){o.geometry=serialize(t.geometries,this.geometry);const r=this.geometry.parameters;if(void 0!==r&&void 0!==r.shapes){const i=r.shapes;if(Array.isArray(i))for(let r=0,o=i.length;r<o;r++){const o=i[r];serialize(t.shapes,o)}else serialize(t.shapes,i)}}if(void 0!==this.material)if(Array.isArray(this.material)){const r=[];for(let i=0,o=this.material.length;i<o;i++)r.push(serialize(t.materials,this.material[i]));o.material=r}else o.material=serialize(t.materials,this.material);if(this.children.length>0){o.children=[];for(let r=0;r<this.children.length;r++)o.children.push(this.children[r].toJSON(t).object)}if(r){const r=extractFromCache(t.geometries),o=extractFromCache(t.materials),a=extractFromCache(t.textures),l=extractFromCache(t.images),h=extractFromCache(t.shapes);r.length>0&&(i.geometries=r),o.length>0&&(i.materials=o),a.length>0&&(i.textures=a),l.length>0&&(i.images=l),h.length>0&&(i.shapes=h)}return i.object=o,i;function extractFromCache(t){const r=[];for(const i in t){const o=t[i];delete o.metadata,r.push(o)}return r}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,r){if(void 0===r&&(r=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===r)for(let i=0;i<t.children.length;i++){const r=t.children[i];this.add(r.clone())}return this}});const $r=new Vector3,Xr=new Vector3,Kr=new Matrix3;class Plane{constructor(t,r){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Vector3(1,0,0),this.constant=void 0!==r?r:0}set(t,r){return this.normal.copy(t),this.constant=r,this}setComponents(t,r,i,o){return this.normal.set(t,r,i),this.constant=o,this}setFromNormalAndCoplanarPoint(t,r){return this.normal.copy(t),this.constant=-r.dot(this.normal),this}setFromCoplanarPoints(t,r,i){const o=$r.subVectors(i,r).cross(Xr.subVectors(t,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,r){return void 0===r&&(console.warn("THREE.Plane: .projectPoint() target is now required"),r=new Vector3),r.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new Vector3);const i=t.delta($r),o=this.normal.dot(i);if(0===o)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;const a=-(t.start.dot(this.normal)+this.constant)/o;return a<0||a>1?void 0:r.copy(i).multiplyScalar(a).add(t.start)}intersectsLine(t){const r=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return r<0&&i>0||i<0&&r>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,r){const i=r||Kr.getNormalMatrix(t),o=this.coplanarPoint($r).applyMatrix4(t),a=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(a),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const Yr=new Vector3,Zr=new Vector3,Qr=new Vector3,Jr=new Vector3,ei=new Vector3,ti=new Vector3,ni=new Vector3,ri=new Vector3,ii=new Vector3,oi=new Vector3;class Triangle{constructor(t,r,i){this.a=void 0!==t?t:new Vector3,this.b=void 0!==r?r:new Vector3,this.c=void 0!==i?i:new Vector3}static getNormal(t,r,i,o){void 0===o&&(console.warn("THREE.Triangle: .getNormal() target is now required"),o=new Vector3),o.subVectors(i,r),Yr.subVectors(t,r),o.cross(Yr);const a=o.lengthSq();return a>0?o.multiplyScalar(1/Math.sqrt(a)):o.set(0,0,0)}static getBarycoord(t,r,i,o,a){Yr.subVectors(o,r),Zr.subVectors(i,r),Qr.subVectors(t,r);const l=Yr.dot(Yr),h=Yr.dot(Zr),g=Yr.dot(Qr),y=Zr.dot(Zr),_=Zr.dot(Qr),x=l*y-h*h;if(void 0===a&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),a=new Vector3),0===x)return a.set(-2,-1,-1);const w=1/x,S=(y*g-h*_)*w,M=(l*_-h*g)*w;return a.set(1-S-M,M,S)}static containsPoint(t,r,i,o){return this.getBarycoord(t,r,i,o,Jr),Jr.x>=0&&Jr.y>=0&&Jr.x+Jr.y<=1}static getUV(t,r,i,o,a,l,h,g){return this.getBarycoord(t,r,i,o,Jr),g.set(0,0),g.addScaledVector(a,Jr.x),g.addScaledVector(l,Jr.y),g.addScaledVector(h,Jr.z),g}static isFrontFacing(t,r,i,o){return Yr.subVectors(i,r),Zr.subVectors(t,r),Yr.cross(Zr).dot(o)<0}set(t,r,i){return this.a.copy(t),this.b.copy(r),this.c.copy(i),this}setFromPointsAndIndices(t,r,i,o){return this.a.copy(t[r]),this.b.copy(t[i]),this.c.copy(t[o]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Yr.subVectors(this.c,this.b),Zr.subVectors(this.a,this.b),.5*Yr.cross(Zr).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Vector3),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Triangle.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,r){return Triangle.getBarycoord(t,this.a,this.b,this.c,r)}getUV(t,r,i,o,a){return Triangle.getUV(t,this.a,this.b,this.c,r,i,o,a)}containsPoint(t){return Triangle.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,r){void 0===r&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),r=new Vector3);const i=this.a,o=this.b,a=this.c;let l,h;ei.subVectors(o,i),ti.subVectors(a,i),ri.subVectors(t,i);const g=ei.dot(ri),y=ti.dot(ri);if(g<=0&&y<=0)return r.copy(i);ii.subVectors(t,o);const _=ei.dot(ii),x=ti.dot(ii);if(_>=0&&x<=_)return r.copy(o);const w=g*x-_*y;if(w<=0&&g>=0&&_<=0)return l=g/(g-_),r.copy(i).addScaledVector(ei,l);oi.subVectors(t,a);const S=ei.dot(oi),M=ti.dot(oi);if(M>=0&&S<=M)return r.copy(a);const T=S*y-g*M;if(T<=0&&y>=0&&M<=0)return h=y/(y-M),r.copy(i).addScaledVector(ti,h);const P=_*M-S*x;if(P<=0&&x-_>=0&&S-M>=0)return ni.subVectors(a,o),h=(x-_)/(x-_+(S-M)),r.copy(o).addScaledVector(ni,h);const C=1/(P+T+w);return l=T*C,h=w*C,r.copy(i).addScaledVector(ei,l).addScaledVector(ti,h)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const ai={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},si={h:0,s:0,l:0},ci={h:0,s:0,l:0};function hue2rgb(t,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(r-t)*i:i<.5?r:i<2/3?t+6*(r-t)*(2/3-i):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Color{constructor(t,r,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===r&&void 0===i?this.set(t):this.setRGB(t,r,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,r,i){return this.r=t,this.g=r,this.b=i,this}setHSL(t,r,i){if(t=Qn.euclideanModulo(t,1),r=Qn.clamp(r,0,1),i=Qn.clamp(i,0,1),0===r)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+r):i+r-i*r,a=2*i-o;this.r=hue2rgb(a,o,t+1/3),this.g=hue2rgb(a,o,t),this.b=hue2rgb(a,o,t-1/3)}return this}setStyle(t){function handleAlpha(r){void 0!==r&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,handleAlpha(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,handleAlpha(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){const r=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,o=parseInt(t[3],10)/100;return handleAlpha(t[5]),this.setHSL(r,i,o)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=r[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const r=ai[t];return void 0!==r?this.setHex(r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,r){return void 0===r&&(r=2),this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this}copyLinearToGamma(t,r){void 0===r&&(r=2);const i=r>0?1/r:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),l=Math.min(r,i,o);let h,g;const y=(l+a)/2;if(l===a)h=0,g=0;else{const t=a-l;switch(g=y<=.5?t/(a+l):t/(2-a-l),a){case r:h=(i-o)/t+(i<o?6:0);break;case i:h=(o-r)/t+2;break;case o:h=(r-i)/t+4}h/=6}return t.h=h,t.s=g,t.l=y,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,r,i){return this.getHSL(si),si.h+=t,si.s+=r,si.l+=i,this.setHSL(si.h,si.s,si.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpHSL(t,r){this.getHSL(si),t.getHSL(ci);const i=Qn.lerp(si.h,ci.h,r),o=Qn.lerp(si.s,ci.s,r),a=Qn.lerp(si.l,ci.l,r);return this.setHSL(i,o,a),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=ai,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class Face3{constructor(t,r,i,o,a,l){this.a=t,this.b=r,this.c=i,this.normal=o&&o.isVector3?o:new Vector3,this.vertexNormals=Array.isArray(o)?o:[],this.color=a&&a.isColor?a:new Color,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=void 0!==l?l:0}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let r=0,i=t.vertexNormals.length;r<i;r++)this.vertexNormals[r]=t.vertexNormals[r].clone();for(let r=0,i=t.vertexColors.length;r<i;r++)this.vertexColors[r]=t.vertexColors[r].clone();return this}}let li=0;function Material(){Object.defineProperty(this,"id",{value:li++}),this.uuid=Qn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=I,this.side=T,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=$,this.blendDst=X,this.blendEquation=D,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=re,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Bn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Mn,this.stencilZFail=Mn,this.stencilZPass=Mn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(t){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const r in t){const i=t[r];if(void 0===i){console.warn("THREE.Material: '"+r+"' parameter is undefined.");continue}if("shading"===r){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===A;continue}const o=this[r];void 0!==o?o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[r]=i:console.warn("THREE."+this.type+": '"+r+"' is not a property of this material.")}},toJSON:function(t){const r=void 0===t||"string"==typeof t;r&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(t){const r=[];for(const i in t){const o=t[i];delete o.metadata,r.push(o)}return r}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==I&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==T&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),r){const r=extractFromCache(t.textures),o=extractFromCache(t.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const r=t.clippingPlanes;let i=null;if(null!==r){const t=r.length;i=new Array(t);for(let o=0;o!==t;++o)i[o]=r[o].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const ui=new Vector3,di=new Vector2;function BufferAttribute(t,r,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=r,this.count=void 0!==t?t.length/r:0,this.normalized=!0===i,this.usage=Fn,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(t,r,i){BufferAttribute.call(this,new Int8Array(t),r,i)}function Uint8BufferAttribute(t,r,i){BufferAttribute.call(this,new Uint8Array(t),r,i)}function Uint8ClampedBufferAttribute(t,r,i){BufferAttribute.call(this,new Uint8ClampedArray(t),r,i)}function Int16BufferAttribute(t,r,i){BufferAttribute.call(this,new Int16Array(t),r,i)}function Uint16BufferAttribute(t,r,i){BufferAttribute.call(this,new Uint16Array(t),r,i)}function Int32BufferAttribute(t,r,i){BufferAttribute.call(this,new Int32Array(t),r,i)}function Uint32BufferAttribute(t,r,i){BufferAttribute.call(this,new Uint32Array(t),r,i)}function Float32BufferAttribute(t,r,i){BufferAttribute.call(this,new Float32Array(t),r,i)}function Float64BufferAttribute(t,r,i){BufferAttribute.call(this,new Float64Array(t),r,i)}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,r,i){t*=this.itemSize,i*=r.itemSize;for(let o=0,a=this.itemSize;o<a;o++)this.array[t+o]=r.array[i+o];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const r=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",o),a=new Color),r[i++]=a.r,r[i++]=a.g,r[i++]=a.b}return this},copyVector2sArray:function(t){const r=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),a=new Vector2),r[i++]=a.x,r[i++]=a.y}return this},copyVector3sArray:function(t){const r=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",o),a=new Vector3),r[i++]=a.x,r[i++]=a.y,r[i++]=a.z}return this},copyVector4sArray:function(t){const r=this.array;let i=0;for(let o=0,a=t.length;o<a;o++){let a=t[o];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",o),a=new Vector4),r[i++]=a.x,r[i++]=a.y,r[i++]=a.z,r[i++]=a.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let r=0,i=this.count;r<i;r++)di.fromBufferAttribute(this,r),di.applyMatrix3(t),this.setXY(r,di.x,di.y);else if(3===this.itemSize)for(let r=0,i=this.count;r<i;r++)ui.fromBufferAttribute(this,r),ui.applyMatrix3(t),this.setXYZ(r,ui.x,ui.y,ui.z);return this},applyMatrix4:function(t){for(let r=0,i=this.count;r<i;r++)ui.x=this.getX(r),ui.y=this.getY(r),ui.z=this.getZ(r),ui.applyMatrix4(t),this.setXYZ(r,ui.x,ui.y,ui.z);return this},applyNormalMatrix:function(t){for(let r=0,i=this.count;r<i;r++)ui.x=this.getX(r),ui.y=this.getY(r),ui.z=this.getZ(r),ui.applyNormalMatrix(t),this.setXYZ(r,ui.x,ui.y,ui.z);return this},transformDirection:function(t){for(let r=0,i=this.count;r<i;r++)ui.x=this.getX(r),ui.y=this.getY(r),ui.z=this.getZ(r),ui.transformDirection(t),this.setXYZ(r,ui.x,ui.y,ui.z);return this},set:function(t,r){return void 0===r&&(r=0),this.array.set(t,r),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,r){return this.array[t*this.itemSize]=r,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,r){return this.array[t*this.itemSize+1]=r,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,r){return this.array[t*this.itemSize+2]=r,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,r){return this.array[t*this.itemSize+3]=r,this},setXY:function(t,r,i){return t*=this.itemSize,this.array[t+0]=r,this.array[t+1]=i,this},setXYZ:function(t,r,i,o){return t*=this.itemSize,this.array[t+0]=r,this.array[t+1]=i,this.array[t+2]=o,this},setXYZW:function(t,r,i,o,a){return t*=this.itemSize,this.array[t+0]=r,this.array[t+1]=i,this.array[t+2]=o,this.array[t+3]=a,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;class DirectGeometry{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const r=[];let i,o,a=void 0;const l=t.faces;for(o=0;o<l.length;o++){const t=l[o];t.materialIndex!==a&&(a=t.materialIndex,void 0!==i&&(i.count=3*o-i.start,r.push(i)),i={start:3*o,materialIndex:a})}void 0!==i&&(i.count=3*o-i.start,r.push(i)),this.groups=r}fromGeometry(t){const r=t.faces,i=t.vertices,o=t.faceVertexUvs,a=o[0]&&o[0].length>0,l=o[1]&&o[1].length>0,h=t.morphTargets,g=h.length;let y;if(g>0){y=[];for(let t=0;t<g;t++)y[t]={name:h[t].name,data:[]};this.morphTargets.position=y}const _=t.morphNormals,x=_.length;let w;if(x>0){w=[];for(let t=0;t<x;t++)w[t]={name:_[t].name,data:[]};this.morphTargets.normal=w}const S=t.skinIndices,M=t.skinWeights,T=S.length===i.length,P=M.length===i.length;i.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let C=0;C<r.length;C++){const t=r[C];this.vertices.push(i[t.a],i[t.b],i[t.c]);const A=t.vertexNormals;if(3===A.length)this.normals.push(A[0],A[1],A[2]);else{const r=t.normal;this.normals.push(r,r,r)}const O=t.vertexColors;if(3===O.length)this.colors.push(O[0],O[1],O[2]);else{const r=t.color;this.colors.push(r,r,r)}if(!0===a){const t=o[0][C];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",C),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===l){const t=o[1][C];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",C),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(let r=0;r<g;r++){const i=h[r].vertices;y[r].data.push(i[t.a],i[t.b],i[t.c])}for(let r=0;r<x;r++){const t=_[r].vertexNormals[C];w[r].data.push(t.a,t.b,t.c)}T&&this.skinIndices.push(S[t.a],S[t.b],S[t.c]),P&&this.skinWeights.push(M[t.a],M[t.b],M[t.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function arrayMax(t){if(0===t.length)return-1/0;let r=t[0];for(let i=1,o=t.length;i<o;++i)t[i]>r&&(r=t[i]);return r}let hi=1;const pi=new Matrix4,fi=new Object3D,mi=new Vector3,gi=new Box3,vi=new Box3,yi=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:hi+=2}),this.uuid=Qn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,r){return this.attributes[t]=r,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,r,i){this.groups.push({start:t,count:r,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,r){this.drawRange.start=t,this.drawRange.count=r},applyMatrix4:function(t){const r=this.attributes.position;void 0!==r&&(r.applyMatrix4(t),r.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const r=(new Matrix3).getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const o=this.attributes.tangent;return void 0!==o&&(o.transformDirection(t),o.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return pi.makeRotationX(t),this.applyMatrix4(pi),this},rotateY:function(t){return pi.makeRotationY(t),this.applyMatrix4(pi),this},rotateZ:function(t){return pi.makeRotationZ(t),this.applyMatrix4(pi),this},translate:function(t,r,i){return pi.makeTranslation(t,r,i),this.applyMatrix4(pi),this},scale:function(t,r,i){return pi.makeScale(t,r,i),this.applyMatrix4(pi),this},lookAt:function(t){return fi.lookAt(t),fi.updateMatrix(),this.applyMatrix4(fi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(mi).negate(),this.translate(mi.x,mi.y,mi.z),this},setFromObject:function(t){const r=t.geometry;if(t.isPoints||t.isLine){const t=new Float32BufferAttribute(3*r.vertices.length,3),i=new Float32BufferAttribute(3*r.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(r.vertices)),this.setAttribute("color",i.copyColorsArray(r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){const t=new Float32BufferAttribute(r.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(r.lineDistances))}null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone())}else t.isMesh&&r&&r.isGeometry&&this.fromGeometry(r);return this},setFromPoints:function(t){const r=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];r.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Float32BufferAttribute(r,3)),this},updateFromObject:function(t){let r=t.geometry;if(t.isMesh){let t=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(t=void 0,r.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(r);t.verticesNeedUpdate=r.verticesNeedUpdate,t.normalsNeedUpdate=r.normalsNeedUpdate,t.colorsNeedUpdate=r.colorsNeedUpdate,t.uvsNeedUpdate=r.uvsNeedUpdate,t.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=t}if(!0===r.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1}if(!0===r.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1}if(!0===r.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1}if(r.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1}if(r.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1}return r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const r=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new BufferAttribute(r,3).copyVector3sArray(t.vertices)),t.normals.length>0){const r=new Float32Array(3*t.normals.length);this.setAttribute("normal",new BufferAttribute(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const r=new Float32Array(3*t.colors.length);this.setAttribute("color",new BufferAttribute(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const r=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new BufferAttribute(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const r=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new BufferAttribute(r,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const i in t.morphTargets){const r=[],o=t.morphTargets[i];for(let t=0,i=o.length;t<i;t++){const i=o[t],a=new Float32BufferAttribute(3*i.data.length,3);a.name=i.name,r.push(a.copyVector3sArray(i.data))}this.morphAttributes[i]=r}if(t.skinIndices.length>0){const r=new Float32BufferAttribute(4*t.skinIndices.length,4);this.setAttribute("skinIndex",r.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const r=new Float32BufferAttribute(4*t.skinWeights.length,4);this.setAttribute("skinWeight",r.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);const t=this.attributes.position,r=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),r)for(let i=0,o=r.length;i<o;i++){const t=r[i];gi.setFromBufferAttribute(t),this.morphTargetsRelative?(yi.addVectors(this.boundingBox.min,gi.min),this.boundingBox.expandByPoint(yi),yi.addVectors(this.boundingBox.max,gi.max),this.boundingBox.expandByPoint(yi)):(this.boundingBox.expandByPoint(gi.min),this.boundingBox.expandByPoint(gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const t=this.attributes.position,r=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(t){const i=this.boundingSphere.center;if(gi.setFromBufferAttribute(t),r)for(let t=0,a=r.length;t<a;t++){const i=r[t];vi.setFromBufferAttribute(i),this.morphTargetsRelative?(yi.addVectors(gi.min,vi.min),gi.expandByPoint(yi),yi.addVectors(gi.max,vi.max),gi.expandByPoint(yi)):(gi.expandByPoint(vi.min),gi.expandByPoint(vi.max))}gi.getCenter(i);let o=0;for(let r=0,a=t.count;r<a;r++)yi.fromBufferAttribute(t,r),o=Math.max(o,i.distanceToSquared(yi));if(r)for(let a=0,l=r.length;a<l;a++){const l=r[a],h=this.morphTargetsRelative;for(let r=0,a=l.count;r<a;r++)yi.fromBufferAttribute(l,r),h&&(mi.fromBufferAttribute(t,r),yi.add(mi)),o=Math.max(o,i.distanceToSquared(yi))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,r=this.getAttribute("position");if(void 0!==r){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*r.count),3),this.setAttribute("normal",i);else for(let t=0,r=i.count;t<r;t++)i.setXYZ(t,0,0,0);const o=new Vector3,a=new Vector3,l=new Vector3,h=new Vector3,g=new Vector3,y=new Vector3,_=new Vector3,x=new Vector3;if(t)for(let w=0,S=t.count;w<S;w+=3){const S=t.getX(w+0),M=t.getX(w+1),T=t.getX(w+2);o.fromBufferAttribute(r,S),a.fromBufferAttribute(r,M),l.fromBufferAttribute(r,T),_.subVectors(l,a),x.subVectors(o,a),_.cross(x),h.fromBufferAttribute(i,S),g.fromBufferAttribute(i,M),y.fromBufferAttribute(i,T),h.add(_),g.add(_),y.add(_),i.setXYZ(S,h.x,h.y,h.z),i.setXYZ(M,g.x,g.y,g.z),i.setXYZ(T,y.x,y.y,y.z)}else for(let t=0,w=r.count;t<w;t+=3)o.fromBufferAttribute(r,t+0),a.fromBufferAttribute(r,t+1),l.fromBufferAttribute(r,t+2),_.subVectors(l,a),x.subVectors(o,a),_.cross(x),i.setXYZ(t+0,_.x,_.y,_.z),i.setXYZ(t+1,_.x,_.y,_.z),i.setXYZ(t+2,_.x,_.y,_.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(t,r){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===r&&(r=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const o in i){if(void 0===t.attributes[o])continue;const a=i[o].array,l=t.attributes[o],h=l.array,g=l.itemSize*r,y=Math.min(h.length,a.length-g);for(let t=0,r=g;t<y;t++,r++)a[r]=h[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let r=0,i=t.count;r<i;r++)yi.fromBufferAttribute(t,r),yi.normalize(),t.setXYZ(r,yi.x,yi.y,yi.z)},toNonIndexed:function(){function convertBufferAttribute(t,r){const i=t.array,o=t.itemSize,a=t.normalized,l=new i.constructor(r.length*o);let h=0,g=0;for(let y=0,_=r.length;y<_;y++){h=r[y]*o;for(let t=0;t<o;t++)l[g++]=i[h++]}return new BufferAttribute(l,o,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new BufferGeometry,r=this.index.array,i=this.attributes;for(const l in i){const o=convertBufferAttribute(i[l],r);t.setAttribute(l,o)}const o=this.morphAttributes;for(const l in o){const i=[],a=o[l];for(let t=0,o=a.length;t<o;t++){const o=convertBufferAttribute(a[t],r);i.push(o)}t.morphAttributes[l]=i}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,h=a.length;l<h;l++){const r=a[l];t.addGroup(r.start,r.count,r.materialIndex)}return t},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const r=this.parameters;for(const i in r)void 0!==r[i]&&(t[i]=r[i]);return t}t.data={attributes:{}};const r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});const i=this.attributes;for(const g in i){const r=i[g],o=r.toJSON(t.data);""!==r.name&&(o.name=r.name),t.data.attributes[g]=o}const o={};let a=!1;for(const g in this.morphAttributes){const r=this.morphAttributes[g],i=[];for(let o=0,a=r.length;o<a;o++){const a=r[o],l=a.toJSON(t.data);""!==a.name&&(l.name=a.name),i.push(l)}i.length>0&&(o[g]=i,a=!0)}a&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(t.data.groups=JSON.parse(JSON.stringify(l)));const h=this.boundingSphere;return null!==h&&(t.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),t},clone:function(){return(new BufferGeometry).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const r={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(r));const o=t.attributes;for(const y in o){const t=o[y];this.setAttribute(y,t.clone(r))}const a=t.morphAttributes;for(const y in a){const t=[],i=a[y];for(let o=0,a=i.length;o<a;o++)t.push(i[o].clone(r));this.morphAttributes[y]=t}this.morphTargetsRelative=t.morphTargetsRelative;const l=t.groups;for(let y=0,_=l.length;y<_;y++){const t=l[y];this.addGroup(t.start,t.count,t.materialIndex)}const h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());const g=t.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const bi=new Matrix4,_i=new Ray,xi=new Sphere,wi=new Vector3,Si=new Vector3,Mi=new Vector3,Ei=new Vector3,Ti=new Vector3,Pi=new Vector3,Ci=new Vector3,Ai=new Vector3,Oi=new Vector3,Li=new Vector2,Ii=new Vector2,Ri=new Vector2,ji=new Vector3,Ni=new Vector3;function Mesh(t,r){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==r?r:new MeshBasicMaterial,this.updateMorphTargets()}function checkIntersection(t,r,i,o,a,l,h,g){let y;if(y=r.side===P?o.intersectTriangle(h,l,a,!0,g):o.intersectTriangle(a,l,h,r.side!==C,g),null===y)return null;Ni.copy(g),Ni.applyMatrix4(t.matrixWorld);const _=i.ray.origin.distanceTo(Ni);return _<i.near||_>i.far?null:{distance:_,point:Ni.clone(),object:t}}function checkBufferGeometryIntersection(t,r,i,o,a,l,h,g,y,_,x,w){wi.fromBufferAttribute(a,_),Si.fromBufferAttribute(a,x),Mi.fromBufferAttribute(a,w);const S=t.morphTargetInfluences;if(r.morphTargets&&l&&S){Ci.set(0,0,0),Ai.set(0,0,0),Oi.set(0,0,0);for(let t=0,r=l.length;t<r;t++){const r=S[t],i=l[t];0!==r&&(Ei.fromBufferAttribute(i,_),Ti.fromBufferAttribute(i,x),Pi.fromBufferAttribute(i,w),h?(Ci.addScaledVector(Ei,r),Ai.addScaledVector(Ti,r),Oi.addScaledVector(Pi,r)):(Ci.addScaledVector(Ei.sub(wi),r),Ai.addScaledVector(Ti.sub(Si),r),Oi.addScaledVector(Pi.sub(Mi),r)))}wi.add(Ci),Si.add(Ai),Mi.add(Oi)}t.isSkinnedMesh&&(t.boneTransform(_,wi),t.boneTransform(x,Si),t.boneTransform(w,Mi));const M=checkIntersection(t,r,i,o,wi,Si,Mi,ji);if(M){g&&(Li.fromBufferAttribute(g,_),Ii.fromBufferAttribute(g,x),Ri.fromBufferAttribute(g,w),M.uv=Triangle.getUV(ji,wi,Si,Mi,Li,Ii,Ri,new Vector2)),y&&(Li.fromBufferAttribute(y,_),Ii.fromBufferAttribute(y,x),Ri.fromBufferAttribute(y,w),M.uv2=Triangle.getUV(ji,wi,Si,Mi,Li,Ii,Ri,new Vector2));const t=new Face3(_,x,w);Triangle.getNormal(wi,Si,Mi,t.normal),M.face=t}return M}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const r=t.morphAttributes,i=Object.keys(r);if(i.length>0){const t=r[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++){const i=t[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}else{const r=t.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,r){const i=this.geometry,o=this.material,a=this.matrixWorld;if(void 0===o)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),xi.copy(i.boundingSphere),xi.applyMatrix4(a),!1===t.ray.intersectsSphere(xi))return;if(bi.getInverse(a),_i.copy(t.ray).applyMatrix4(bi),null!==i.boundingBox&&!1===_i.intersectsBox(i.boundingBox))return;let l;if(i.isBufferGeometry){const a=i.index,h=i.attributes.position,g=i.morphAttributes.position,y=i.morphTargetsRelative,_=i.attributes.uv,x=i.attributes.uv2,w=i.groups,S=i.drawRange;if(null!==a)if(Array.isArray(o))for(let i=0,M=w.length;i<M;i++){const M=w[i],T=o[M.materialIndex];for(let i=Math.max(M.start,S.start),o=Math.min(M.start+M.count,S.start+S.count);i<o;i+=3){const o=a.getX(i),w=a.getX(i+1),S=a.getX(i+2);l=checkBufferGeometryIntersection(this,T,t,_i,h,g,y,_,x,o,w,S),l&&(l.faceIndex=Math.floor(i/3),l.face.materialIndex=M.materialIndex,r.push(l))}}else{for(let i=Math.max(0,S.start),w=Math.min(a.count,S.start+S.count);i<w;i+=3){const w=a.getX(i),S=a.getX(i+1),M=a.getX(i+2);l=checkBufferGeometryIntersection(this,o,t,_i,h,g,y,_,x,w,S,M),l&&(l.faceIndex=Math.floor(i/3),r.push(l))}}else if(void 0!==h)if(Array.isArray(o))for(let i=0,M=w.length;i<M;i++){const a=w[i],M=o[a.materialIndex];for(let i=Math.max(a.start,S.start),o=Math.min(a.start+a.count,S.start+S.count);i<o;i+=3){l=checkBufferGeometryIntersection(this,M,t,_i,h,g,y,_,x,i,i+1,i+2),l&&(l.faceIndex=Math.floor(i/3),l.face.materialIndex=a.materialIndex,r.push(l))}}else{for(let i=Math.max(0,S.start),a=Math.min(h.count,S.start+S.count);i<a;i+=3){l=checkBufferGeometryIntersection(this,o,t,_i,h,g,y,_,x,i,i+1,i+2),l&&(l.faceIndex=Math.floor(i/3),r.push(l))}}}else if(i.isGeometry){const a=Array.isArray(o),h=i.vertices,g=i.faces;let y;const _=i.faceVertexUvs[0];_.length>0&&(y=_);for(let i=0,x=g.length;i<x;i++){const _=g[i],x=a?o[_.materialIndex]:o;if(void 0===x)continue;const w=h[_.a],S=h[_.b],M=h[_.c];if(l=checkIntersection(this,x,t,_i,w,S,M,ji),l){if(y&&y[i]){const t=y[i];Li.copy(t[0]),Ii.copy(t[1]),Ri.copy(t[2]),l.uv=Triangle.getUV(ji,w,S,M,Li,Ii,Ri,new Vector2)}l.face=_,l.faceIndex=i,r.push(l)}}}}});class BoxBufferGeometry extends BufferGeometry{constructor(t=1,r=1,i=1,o=1,a=1,l=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:r,depth:i,widthSegments:o,heightSegments:a,depthSegments:l};const h=this;o=Math.floor(o),a=Math.floor(a),l=Math.floor(l);const g=[],y=[],_=[],x=[];let w=0,S=0;function buildPlane(t,r,i,o,a,l,M,T,P,C,A){const O=l/P,L=M/C,I=l/2,R=M/2,j=T/2,N=P+1,k=C+1;let D=0,B=0;const G=new Vector3;for(let h=0;h<k;h++){const l=h*L-R;for(let g=0;g<N;g++){const w=g*O-I;G[t]=w*o,G[r]=l*a,G[i]=j,y.push(G.x,G.y,G.z),G[t]=0,G[r]=0,G[i]=T>0?1:-1,_.push(G.x,G.y,G.z),x.push(g/P),x.push(1-h/C),D+=1}}for(let h=0;h<C;h++)for(let t=0;t<P;t++){const r=w+t+N*h,i=w+t+N*(h+1),o=w+(t+1)+N*(h+1),a=w+(t+1)+N*h;g.push(r,i,a),g.push(i,o,a),B+=6}h.addGroup(S,B,A),S+=B,w+=D}buildPlane("z","y","x",-1,-1,i,r,t,l,a,0),buildPlane("z","y","x",1,-1,i,r,-t,l,a,1),buildPlane("x","z","y",1,1,t,i,r,o,l,2),buildPlane("x","z","y",1,-1,t,i,-r,o,l,3),buildPlane("x","y","z",1,-1,t,r,i,o,a,4),buildPlane("x","y","z",-1,-1,t,r,-i,o,a,5),this.setIndex(g),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(x,2))}}function cloneUniforms(t){const r={};for(const i in t){r[i]={};for(const o in t[i]){const a=t[i][o];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture)?r[i][o]=a.clone():Array.isArray(a)?r[i][o]=a.slice():r[i][o]=a}}return r}function mergeUniforms(t){const r={};for(let i=0;i<t.length;i++){const o=cloneUniforms(t[i]);for(const t in o)r[t]=o[t]}return r}const ki={clone:cloneUniforms,merge:mergeUniforms};function ShaderMaterial(t){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(t,r,i,o){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.focus=10,this.aspect=void 0!==r?r:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},ShaderMaterial.prototype.toJSON=function(t){const r=Material.prototype.toJSON.call(this,t);r.glslVersion=this.glslVersion,r.uniforms={};for(const o in this.uniforms){const i=this.uniforms[o].value;i&&i.isTexture?r.uniforms[o]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?r.uniforms[o]={type:"c",value:i.getHex()}:i&&i.isVector2?r.uniforms[o]={type:"v2",value:i.toArray()}:i&&i.isVector3?r.uniforms[o]={type:"v3",value:i.toArray()}:i&&i.isVector4?r.uniforms[o]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?r.uniforms[o]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?r.uniforms[o]={type:"m4",value:i.toArray()}:r.uniforms[o]={value:i}}Object.keys(this.defines).length>0&&(r.defines=this.defines),r.vertexShader=this.vertexShader,r.fragmentShader=this.fragmentShader;const i={};for(const o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(r.extensions=i),r},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(t,r){return Object3D.prototype.copy.call(this,t,r),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Vector3),this.updateWorldMatrix(!0,!1);const r=this.matrixWorld.elements;return t.set(-r[8],-r[9],-r[10]).normalize()},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,r){Object3D.prototype.updateWorldMatrix.call(this,t,r),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(t,r){return Camera.prototype.copy.call(this,t,r),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const r=.5*this.getFilmHeight()/t;this.fov=2*Qn.RAD2DEG*Math.atan(r),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Qn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Qn.RAD2DEG*Math.atan(Math.tan(.5*Qn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,r,i,o,a,l){this.aspect=t/r,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let r=t*Math.tan(.5*Qn.DEG2RAD*this.fov)/this.zoom,i=2*r,o=this.aspect*i,a=-.5*o;const l=this.view;if(null!==this.view&&this.view.enabled){const t=l.fullWidth,h=l.fullHeight;a+=l.offsetX*o/t,r-=l.offsetY*i/h,o*=l.width/t,i*=l.height/h}const h=this.filmOffset;0!==h&&(a+=t*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+o,r,r-i,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const r=Object3D.prototype.toJSON.call(this,t);return r.object.fov=this.fov,r.object.zoom=this.zoom,r.object.near=this.near,r.object.far=this.far,r.object.focus=this.focus,r.object.aspect=this.aspect,null!==this.view&&(r.object.view=Object.assign({},this.view)),r.object.filmGauge=this.filmGauge,r.object.filmOffset=this.filmOffset,r}});const Di=90;function CubeCamera(t,r,i){if(Object3D.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const o=new PerspectiveCamera(Di,1,t,r);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3(1,0,0)),this.add(o);const a=new PerspectiveCamera(Di,1,t,r);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(-1,0,0)),this.add(a);const l=new PerspectiveCamera(Di,1,t,r);l.layers=this.layers,l.up.set(0,0,1),l.lookAt(new Vector3(0,1,0)),this.add(l);const h=new PerspectiveCamera(Di,1,t,r);h.layers=this.layers,h.up.set(0,0,-1),h.lookAt(new Vector3(0,-1,0)),this.add(h);const g=new PerspectiveCamera(Di,1,t,r);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new Vector3(0,0,1)),this.add(g);const y=new PerspectiveCamera(Di,1,t,r);y.layers=this.layers,y.up.set(0,-1,0),y.lookAt(new Vector3(0,0,-1)),this.add(y),this.update=function(t,r){null===this.parent&&this.updateMatrixWorld();const _=t.xr.enabled,x=t.getRenderTarget();t.xr.enabled=!1;const w=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(r,o),t.setRenderTarget(i,1),t.render(r,a),t.setRenderTarget(i,2),t.render(r,l),t.setRenderTarget(i,3),t.render(r,h),t.setRenderTarget(i,4),t.render(r,g),i.texture.generateMipmaps=w,t.setRenderTarget(i,5),t.render(r,y),t.setRenderTarget(x),t.xr.enabled=_}}function CubeTexture(t,r,i,o,a,l,h,g,y,_){t=void 0!==t?t:[],r=void 0!==r?r:ye,h=void 0!==h?h:Ye,Texture.call(this,t,r,i,o,a,l,h,g,y,_),this.flipY=!1,this._needsFlipEnvMap=!0}function WebGLCubeRenderTarget(t,r,i){Number.isInteger(r)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),r=i),WebGLRenderTarget.call(this,t,t,r),r=r||{},this.texture=new CubeTexture(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture._needsFlipEnvMap=!1}function DataTexture(t,r,i,o,a,l,h,g,y,_,x,w){Texture.call(this,null,l,h,g,y,_,o,a,x,w),this.image={data:t||null,width:r||1,height:i||1},this.magFilter=void 0!==y?y:Pe,this.minFilter=void 0!==_?_:Pe,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(t,r){this.texture.type=r.type,this.texture.format=Ze,this.texture.encoding=r.encoding,this.texture.generateMipmaps=r.generateMipmaps,this.texture.minFilter=r.minFilter,this.texture.magFilter=r.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},o=new BoxBufferGeometry(5,5,5),a=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:P,blending:L});a.uniforms.tEquirect.value=r;const l=new Mesh(o,a),h=r.minFilter;r.minFilter===Ne&&(r.minFilter=Ie);return new CubeCamera(1,10,this).update(t,l),r.minFilter=h,l.geometry.dispose(),l.material.dispose(),this},WebGLCubeRenderTarget.prototype.clear=function(t,r,i,o){const a=t.getRenderTarget();for(let l=0;l<6;l++)t.setRenderTarget(this,l),t.clear(r,i,o);t.setRenderTarget(a)},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;const Bi=new Sphere,Fi=new Vector3;class Frustum{constructor(t,r,i,o,a,l){this.planes=[void 0!==t?t:new Plane,void 0!==r?r:new Plane,void 0!==i?i:new Plane,void 0!==o?o:new Plane,void 0!==a?a:new Plane,void 0!==l?l:new Plane]}set(t,r,i,o,a,l){const h=this.planes;return h[0].copy(t),h[1].copy(r),h[2].copy(i),h[3].copy(o),h[4].copy(a),h[5].copy(l),this}clone(){return(new this.constructor).copy(this)}copy(t){const r=this.planes;for(let i=0;i<6;i++)r[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const r=this.planes,i=t.elements,o=i[0],a=i[1],l=i[2],h=i[3],g=i[4],y=i[5],_=i[6],x=i[7],w=i[8],S=i[9],M=i[10],T=i[11],P=i[12],C=i[13],A=i[14],O=i[15];return r[0].setComponents(h-o,x-g,T-w,O-P).normalize(),r[1].setComponents(h+o,x+g,T+w,O+P).normalize(),r[2].setComponents(h+a,x+y,T+S,O+C).normalize(),r[3].setComponents(h-a,x-y,T-S,O-C).normalize(),r[4].setComponents(h-l,x-_,T-M,O-A).normalize(),r[5].setComponents(h+l,x+_,T+M,O+A).normalize(),this}intersectsObject(t){const r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),Bi.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Bi)}intersectsSprite(t){return Bi.center.set(0,0,0),Bi.radius=.7071067811865476,Bi.applyMatrix4(t.matrixWorld),this.intersectsSphere(Bi)}intersectsSphere(t){const r=this.planes,i=t.center,o=-t.radius;for(let a=0;a<6;a++){if(r[a].distanceToPoint(i)<o)return!1}return!0}intersectsBox(t){const r=this.planes;for(let i=0;i<6;i++){const o=r[i];if(Fi.x=o.normal.x>0?t.max.x:t.min.x,Fi.y=o.normal.y>0?t.max.y:t.min.y,Fi.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(Fi)<0)return!1}return!0}containsPoint(t){const r=this.planes;for(let i=0;i<6;i++)if(r[i].distanceToPoint(t)<0)return!1;return!0}}function WebGLAnimation(){let t=null,r=!1,i=null,o=null;function onAnimationFrame(r,a){i(r,a),o=t.requestAnimationFrame(onAnimationFrame)}return{start:function(){!0!==r&&null!==i&&(o=t.requestAnimationFrame(onAnimationFrame),r=!0)},stop:function(){t.cancelAnimationFrame(o),r=!1},setAnimationLoop:function(t){i=t},setContext:function(r){t=r}}}function WebGLAttributes(t,r){const i=r.isWebGL2,o=new WeakMap;return{get:function get(t){return t.isInterleavedBufferAttribute&&(t=t.data),o.get(t)},remove:function remove(r){r.isInterleavedBufferAttribute&&(r=r.data);const i=o.get(r);i&&(t.deleteBuffer(i.buffer),o.delete(r))},update:function update(r,a){if(r.isGLBufferAttribute){var l=o.get(r);return void((!l||l.version<r.version)&&o.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version}))}r.isInterleavedBufferAttribute&&(r=r.data);const h=o.get(r);void 0===h?o.set(r,function createBuffer(r,i){const o=r.array,a=r.usage,l=t.createBuffer();t.bindBuffer(i,l),t.bufferData(i,o,a),r.onUploadCallback();let h=5126;return o instanceof Float32Array?h=5126:o instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):o instanceof Uint16Array?h=5123:o instanceof Int16Array?h=5122:o instanceof Uint32Array?h=5125:o instanceof Int32Array?h=5124:o instanceof Int8Array?h=5120:o instanceof Uint8Array&&(h=5121),{buffer:l,type:h,bytesPerElement:o.BYTES_PER_ELEMENT,version:r.version}}(r,a)):h.version<r.version&&(!function updateBuffer(r,o,a){const l=o.array,h=o.updateRange;t.bindBuffer(a,r),-1===h.count?t.bufferSubData(a,0,l):(i?t.bufferSubData(a,h.offset*l.BYTES_PER_ELEMENT,l,h.offset,h.count):t.bufferSubData(a,h.offset*l.BYTES_PER_ELEMENT,l.subarray(h.offset,h.offset+h.count)),h.count=-1)}(h.buffer,r,a),h.version=r.version)}}}class PlaneBufferGeometry extends BufferGeometry{constructor(t,r,i,o){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:r,widthSegments:i,heightSegments:o};const a=(t=t||1)/2,l=(r=r||1)/2,h=Math.floor(i)||1,g=Math.floor(o)||1,y=h+1,_=g+1,x=t/h,w=r/g,S=[],M=[],T=[],P=[];for(let C=0;C<_;C++){const t=C*w-l;for(let r=0;r<y;r++){const i=r*x-a;M.push(i,-t,0),T.push(0,0,1),P.push(r/h),P.push(1-C/g)}}for(let C=0;C<g;C++)for(let t=0;t<h;t++){const r=t+y*C,i=t+y*(C+1),o=t+1+y*(C+1),a=t+1+y*C;S.push(r,i,a),S.push(i,o,a)}this.setIndex(S),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(P,2))}}const Gi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Hi={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},Vi={basic:{uniforms:mergeUniforms([Hi.common,Hi.specularmap,Hi.envmap,Hi.aomap,Hi.lightmap,Hi.fog]),vertexShader:Gi.meshbasic_vert,fragmentShader:Gi.meshbasic_frag},lambert:{uniforms:mergeUniforms([Hi.common,Hi.specularmap,Hi.envmap,Hi.aomap,Hi.lightmap,Hi.emissivemap,Hi.fog,Hi.lights,{emissive:{value:new Color(0)}}]),vertexShader:Gi.meshlambert_vert,fragmentShader:Gi.meshlambert_frag},phong:{uniforms:mergeUniforms([Hi.common,Hi.specularmap,Hi.envmap,Hi.aomap,Hi.lightmap,Hi.emissivemap,Hi.bumpmap,Hi.normalmap,Hi.displacementmap,Hi.fog,Hi.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Gi.meshphong_vert,fragmentShader:Gi.meshphong_frag},standard:{uniforms:mergeUniforms([Hi.common,Hi.envmap,Hi.aomap,Hi.lightmap,Hi.emissivemap,Hi.bumpmap,Hi.normalmap,Hi.displacementmap,Hi.roughnessmap,Hi.metalnessmap,Hi.fog,Hi.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Gi.meshphysical_vert,fragmentShader:Gi.meshphysical_frag},toon:{uniforms:mergeUniforms([Hi.common,Hi.aomap,Hi.lightmap,Hi.emissivemap,Hi.bumpmap,Hi.normalmap,Hi.displacementmap,Hi.gradientmap,Hi.fog,Hi.lights,{emissive:{value:new Color(0)}}]),vertexShader:Gi.meshtoon_vert,fragmentShader:Gi.meshtoon_frag},matcap:{uniforms:mergeUniforms([Hi.common,Hi.bumpmap,Hi.normalmap,Hi.displacementmap,Hi.fog,{matcap:{value:null}}]),vertexShader:Gi.meshmatcap_vert,fragmentShader:Gi.meshmatcap_frag},points:{uniforms:mergeUniforms([Hi.points,Hi.fog]),vertexShader:Gi.points_vert,fragmentShader:Gi.points_frag},dashed:{uniforms:mergeUniforms([Hi.common,Hi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Gi.linedashed_vert,fragmentShader:Gi.linedashed_frag},depth:{uniforms:mergeUniforms([Hi.common,Hi.displacementmap]),vertexShader:Gi.depth_vert,fragmentShader:Gi.depth_frag},normal:{uniforms:mergeUniforms([Hi.common,Hi.bumpmap,Hi.normalmap,Hi.displacementmap,{opacity:{value:1}}]),vertexShader:Gi.normal_vert,fragmentShader:Gi.normal_frag},sprite:{uniforms:mergeUniforms([Hi.sprite,Hi.fog]),vertexShader:Gi.sprite_vert,fragmentShader:Gi.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:Gi.background_vert,fragmentShader:Gi.background_frag},cube:{uniforms:mergeUniforms([Hi.envmap,{opacity:{value:1}}]),vertexShader:Gi.cube_vert,fragmentShader:Gi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Gi.equirect_vert,fragmentShader:Gi.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([Hi.common,Hi.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gi.distanceRGBA_vert,fragmentShader:Gi.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([Hi.lights,Hi.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Gi.shadow_vert,fragmentShader:Gi.shadow_frag}};function WebGLBackground(t,r,i,o,a){const l=new Color(0);let h,g,y=0,_=null,x=0,w=null;function setClear(t,r){i.buffers.color.setClear(t.r,t.g,t.b,r,a)}return{getClearColor:function(){return l},setClearColor:function(t,r){l.set(t),y=void 0!==r?r:1,setClear(l,y)},getClearAlpha:function(){return y},setClearAlpha:function(t){y=t,setClear(l,y)},render:function render(i,a,S,M){let C=!0===a.isScene?a.background:null;C&&C.isTexture&&(C=r.get(C));const A=t.xr,O=A.getSession&&A.getSession();O&&"additive"===O.environmentBlendMode&&(C=null),null===C?setClear(l,y):C&&C.isColor&&(setClear(C,1),M=!0),(t.autoClear||M)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),C&&(C.isCubeTexture||C.isWebGLCubeRenderTarget||C.mapping===we)?(void 0===g&&(g=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(Vi.cube.uniforms),vertexShader:Vi.cube.vertexShader,fragmentShader:Vi.cube.fragmentShader,side:P,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(t,r,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(g)),C.isWebGLCubeRenderTarget&&(C=C.texture),g.material.uniforms.envMap.value=C,g.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C._needsFlipEnvMap?-1:1,_===C&&x===C.version&&w===t.toneMapping||(g.material.needsUpdate=!0,_=C,x=C.version,w=t.toneMapping),i.unshift(g,g.geometry,g.material,0,0,null)):C&&C.isTexture&&(void 0===h&&(h=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(Vi.background.uniforms),vertexShader:Vi.background.vertexShader,fragmentShader:Vi.background.fragmentShader,side:T,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(h)),h.material.uniforms.t2D.value=C,!0===C.matrixAutoUpdate&&C.updateMatrix(),h.material.uniforms.uvTransform.value.copy(C.matrix),_===C&&x===C.version&&w===t.toneMapping||(h.material.needsUpdate=!0,_=C,x=C.version,w=t.toneMapping),i.unshift(h,h.geometry,h.material,0,0,null))}}}function WebGLBindingStates(t,r,i,o){const a=t.getParameter(34921),l=o.isWebGL2?null:r.get("OES_vertex_array_object"),h=o.isWebGL2||null!==l,g={},y=createBindingState(null);let _=y;function bindVertexArrayObject(r){return o.isWebGL2?t.bindVertexArray(r):l.bindVertexArrayOES(r)}function deleteVertexArrayObject(r){return o.isWebGL2?t.deleteVertexArray(r):l.deleteVertexArrayOES(r)}function createBindingState(t){const r=[],i=[],o=[];for(let l=0;l<a;l++)r[l]=0,i[l]=0,o[l]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:r,enabledAttributes:i,attributeDivisors:o,object:t,attributes:{},index:null}}function initAttributes(){const t=_.newAttributes;for(let r=0,i=t.length;r<i;r++)t[r]=0}function enableAttribute(t){enableAttributeAndDivisor(t,0)}function enableAttributeAndDivisor(i,a){const l=_.newAttributes,h=_.enabledAttributes,g=_.attributeDivisors;if(l[i]=1,0===h[i]&&(t.enableVertexAttribArray(i),h[i]=1),g[i]!==a){(o.isWebGL2?t:r.get("ANGLE_instanced_arrays"))[o.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,a),g[i]=a}}function disableUnusedAttributes(){const r=_.newAttributes,i=_.enabledAttributes;for(let o=0,a=i.length;o<a;o++)i[o]!==r[o]&&(t.disableVertexAttribArray(o),i[o]=0)}function vertexAttribPointer(r,i,a,l,h,g){!0!==o.isWebGL2||5124!==a&&5125!==a?t.vertexAttribPointer(r,i,a,l,h,g):t.vertexAttribIPointer(r,i,a,h,g)}function reset(){resetDefaultState(),_!==y&&(_=y,bindVertexArrayObject(_.object))}function resetDefaultState(){y.geometry=null,y.program=null,y.wireframe=!1}return{setup:function setup(a,y,x,w,S){let M=!1;if(h){const r=function getBindingState(r,i,a){const h=!0===a.wireframe;let y=g[r.id];void 0===y&&(y={},g[r.id]=y);let _=y[i.id];void 0===_&&(_={},y[i.id]=_);let x=_[h];void 0===x&&(x=createBindingState(function createVertexArrayObject(){return o.isWebGL2?t.createVertexArray():l.createVertexArrayOES()}()),_[h]=x);return x}(w,x,y);_!==r&&(_=r,bindVertexArrayObject(_.object)),M=function needsUpdate(t,r){const i=_.attributes,o=t.attributes;if(Object.keys(i).length!==Object.keys(o).length)return!0;for(const a in o){const t=i[a],r=o[a];if(void 0===t)return!0;if(t.attribute!==r)return!0;if(t.data!==r.data)return!0}return _.index!==r}(w,S),M&&function saveCache(t,r){const i={},o=t.attributes;for(const a in o){const t=o[a],r={};r.attribute=t,t.data&&(r.data=t.data),i[a]=r}_.attributes=i,_.index=r}(w,S)}else{const t=!0===y.wireframe;_.geometry===w.id&&_.program===x.id&&_.wireframe===t||(_.geometry=w.id,_.program=x.id,_.wireframe=t,M=!0)}!0===a.isInstancedMesh&&(M=!0),null!==S&&i.update(S,34963),M&&(!function setupVertexAttributes(a,l,h,g){if(!1===o.isWebGL2&&(a.isInstancedMesh||g.isInstancedBufferGeometry)&&null===r.get("ANGLE_instanced_arrays"))return;initAttributes();const y=g.attributes,_=h.getAttributes(),x=l.defaultAttributeValues;for(const r in _){const o=_[r];if(o>=0){const l=y[r];if(void 0!==l){const r=l.normalized,a=l.itemSize,h=i.get(l);if(void 0===h)continue;const y=h.buffer,_=h.type,x=h.bytesPerElement;if(l.isInterleavedBufferAttribute){const i=l.data,h=i.stride,w=l.offset;i&&i.isInstancedInterleavedBuffer?(enableAttributeAndDivisor(o,i.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=i.meshPerAttribute*i.count)):enableAttribute(o),t.bindBuffer(34962,y),vertexAttribPointer(o,a,_,r,h*x,w*x)}else l.isInstancedBufferAttribute?(enableAttributeAndDivisor(o,l.meshPerAttribute),void 0===g._maxInstanceCount&&(g._maxInstanceCount=l.meshPerAttribute*l.count)):enableAttribute(o),t.bindBuffer(34962,y),vertexAttribPointer(o,a,_,r,0,0)}else if("instanceMatrix"===r){const r=i.get(a.instanceMatrix);if(void 0===r)continue;const l=r.buffer,h=r.type;enableAttributeAndDivisor(o+0,1),enableAttributeAndDivisor(o+1,1),enableAttributeAndDivisor(o+2,1),enableAttributeAndDivisor(o+3,1),t.bindBuffer(34962,l),t.vertexAttribPointer(o+0,4,h,!1,64,0),t.vertexAttribPointer(o+1,4,h,!1,64,16),t.vertexAttribPointer(o+2,4,h,!1,64,32),t.vertexAttribPointer(o+3,4,h,!1,64,48)}else if("instanceColor"===r){const r=i.get(a.instanceColor);if(void 0===r)continue;const l=r.buffer,h=r.type;enableAttributeAndDivisor(o,1),t.bindBuffer(34962,l),t.vertexAttribPointer(o,3,h,!1,12,0)}else if(void 0!==x){const i=x[r];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(o,i);break;case 3:t.vertexAttrib3fv(o,i);break;case 4:t.vertexAttrib4fv(o,i);break;default:t.vertexAttrib1fv(o,i)}}}}disableUnusedAttributes()}(a,y,x,w),null!==S&&t.bindBuffer(34963,i.get(S).buffer))},reset:reset,resetDefaultState:resetDefaultState,dispose:function dispose(){reset();for(const t in g){const r=g[t];for(const t in r){const i=r[t];for(const t in i)deleteVertexArrayObject(i[t].object),delete i[t];delete r[t]}delete g[t]}},releaseStatesOfGeometry:function releaseStatesOfGeometry(t){if(void 0===g[t.id])return;const r=g[t.id];for(const i in r){const t=r[i];for(const r in t)deleteVertexArrayObject(t[r].object),delete t[r];delete r[i]}delete g[t.id]},releaseStatesOfProgram:function releaseStatesOfProgram(t){for(const r in g){const i=g[r];if(void 0===i[t.id])continue;const o=i[t.id];for(const t in o)deleteVertexArrayObject(o[t].object),delete o[t];delete i[t.id]}},initAttributes:initAttributes,enableAttribute:enableAttribute,disableUnusedAttributes:disableUnusedAttributes}}function WebGLBufferRenderer(t,r,i,o){const a=o.isWebGL2;let l;this.setMode=function setMode(t){l=t},this.render=function render(r,o){t.drawArrays(l,r,o),i.update(o,l,1)},this.renderInstances=function renderInstances(o,h,g){if(0===g)return;let y,_;if(a)y=t,_="drawArraysInstanced";else if(y=r.get("ANGLE_instanced_arrays"),_="drawArraysInstancedANGLE",null===y)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");y[_](l,o,h,g),i.update(h,l,g)}}function WebGLCapabilities(t,r,i){let o;function getMaxPrecision(r){if("highp"===r){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";r="mediump"}return"mediump"===r&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let l=void 0!==i.precision?i.precision:"highp";const h=getMaxPrecision(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);const g=!0===i.logarithmicDepthBuffer,y=t.getParameter(34930),_=t.getParameter(35660),x=t.getParameter(3379),w=t.getParameter(34076),S=t.getParameter(34921),M=t.getParameter(36347),T=t.getParameter(36348),P=t.getParameter(36349),C=_>0,A=a||!!r.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==o)return o;const i=r.get("EXT_texture_filter_anisotropic");return o=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,o},getMaxPrecision:getMaxPrecision,precision:l,logarithmicDepthBuffer:g,maxTextures:y,maxVertexTextures:_,maxTextureSize:x,maxCubemapSize:w,maxAttributes:S,maxVertexUniforms:M,maxVaryings:T,maxFragmentUniforms:P,vertexTextures:C,floatFragmentTextures:A,floatVertexTextures:C&&A,maxSamples:a?t.getParameter(36183):0}}function WebGLClipping(t){const r=this;let i=null,o=0,a=!1,l=!1;const h=new Plane,g=new Matrix3,y={value:null,needsUpdate:!1};function resetGlobalState(){y.value!==i&&(y.value=i,y.needsUpdate=o>0),r.numPlanes=o,r.numIntersection=0}function projectPlanes(t,i,o,a){const l=null!==t?t.length:0;let _=null;if(0!==l){if(_=y.value,!0!==a||null===_){const r=o+4*l,a=i.matrixWorldInverse;g.getNormalMatrix(a),(null===_||_.length<r)&&(_=new Float32Array(r));for(let i=0,y=o;i!==l;++i,y+=4)h.copy(t[i]).applyMatrix4(a,g),h.normal.toArray(_,y),_[y+3]=h.constant}y.value=_,y.needsUpdate=!0}return r.numPlanes=l,r.numIntersection=0,_}this.uniform=y,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,l){const h=0!==t.length||r||0!==o||a;return a=r,i=projectPlanes(t,l,0),o=t.length,h},this.beginShadows=function(){l=!0,projectPlanes(null)},this.endShadows=function(){l=!1,resetGlobalState()},this.setState=function(r,h,g){const _=r.clippingPlanes,x=r.clipIntersection,w=r.clipShadows,S=t.get(r);if(!a||null===_||0===_.length||l&&!w)l?projectPlanes(null):resetGlobalState();else{const t=l?0:o,r=4*t;let a=S.clippingState||null;y.value=a,a=projectPlanes(_,h,r,g);for(let o=0;o!==r;++o)a[o]=i[o];S.clippingState=a,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=t}}}function WebGLCubeMaps(t){let r=new WeakMap;function mapTextureMapping(t,r){return r===_e?t.mapping=ye:r===xe&&(t.mapping=be),t}function onTextureDispose(t){const i=t.target;i.removeEventListener("dispose",onTextureDispose);const o=r.get(i);void 0!==o&&(r.delete(i),o.dispose())}return{get:function get(i){if(i&&i.isTexture){const o=i.mapping;if(o===_e||o===xe){if(r.has(i)){return mapTextureMapping(r.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const a=t.getRenderList(),l=t.getRenderTarget(),h=t.getRenderState(),g=new WebGLCubeRenderTarget(o.height/2);return g.fromEquirectangularTexture(t,i),r.set(i,g),t.setRenderTarget(l),t.setRenderList(a),t.setRenderState(h),i.addEventListener("dispose",onTextureDispose),mapTextureMapping(g.texture,i.mapping)}return null}}}return i},dispose:function dispose(){r=new WeakMap}}}function WebGLExtensions(t){const r={};return{has:function(i){if(void 0!==r[i])return null!==r[i];let o;switch(i){case"WEBGL_depth_texture":o=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=t.getExtension(i)}return r[i]=o,null!==o},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),r[t]}}}function WebGLGeometries(t,r,i,o){const a=new WeakMap,l=new WeakMap;function onGeometryDispose(t){const h=t.target,g=a.get(h);null!==g.index&&r.remove(g.index);for(const i in g.attributes)r.remove(g.attributes[i]);h.removeEventListener("dispose",onGeometryDispose),a.delete(h);const y=l.get(g);y&&(r.remove(y),l.delete(g)),o.releaseStatesOfGeometry(g),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,i.memory.geometries--}function updateWireframeAttribute(t){const i=[],o=t.index,a=t.attributes.position;let h=0;if(null!==o){const t=o.array;h=o.version;for(let r=0,o=t.length;r<o;r+=3){const o=t[r+0],a=t[r+1],l=t[r+2];i.push(o,a,a,l,l,o)}}else{const t=a.array;h=a.version;for(let r=0,o=t.length/3-1;r<o;r+=3){const t=r+0,o=r+1,a=r+2;i.push(t,o,o,a,a,t)}}const g=new(arrayMax(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);g.version=h;const y=l.get(t);y&&r.remove(y),l.set(t,g)}return{get:function get(t,r){let o=a.get(r);return o||(r.addEventListener("dispose",onGeometryDispose),r.isBufferGeometry?o=r:r.isGeometry&&(void 0===r._bufferGeometry&&(r._bufferGeometry=(new BufferGeometry).setFromObject(t)),o=r._bufferGeometry),a.set(r,o),i.memory.geometries++,o)},update:function update(t){const i=t.attributes;for(const a in i)r.update(i[a],34962);const o=t.morphAttributes;for(const a in o){const t=o[a];for(let i=0,o=t.length;i<o;i++)r.update(t[i],34962)}},getWireframeAttribute:function getWireframeAttribute(t){const r=l.get(t);if(r){const i=t.index;null!==i&&r.version<i.version&&updateWireframeAttribute(t)}else updateWireframeAttribute(t);return l.get(t)}}}function WebGLIndexedBufferRenderer(t,r,i,o){const a=o.isWebGL2;let l,h,g;this.setMode=function setMode(t){l=t},this.setIndex=function setIndex(t){h=t.type,g=t.bytesPerElement},this.render=function render(r,o){t.drawElements(l,o,h,r*g),i.update(o,l,1)},this.renderInstances=function renderInstances(o,y,_){if(0===_)return;let x,w;if(a)x=t,w="drawElementsInstanced";else if(x=r.get("ANGLE_instanced_arrays"),w="drawElementsInstancedANGLE",null===x)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");x[w](l,y,h,o*g,_),i.update(y,l,_)}}function WebGLInfo(t){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function reset(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function update(t,i,o){switch(r.calls++,i){case 4:r.triangles+=o*(t/3);break;case 1:r.lines+=o*(t/2);break;case 3:r.lines+=o*(t-1);break;case 2:r.lines+=o*t;break;case 0:r.points+=o*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function numericalSort(t,r){return t[0]-r[0]}function absNumericalSort(t,r){return Math.abs(r[1])-Math.abs(t[1])}function WebGLMorphtargets(t){const r={},i=new Float32Array(8),o=[];for(let a=0;a<8;a++)o[a]=[a,0];return{update:function update(a,l,h,g){const y=a.morphTargetInfluences,_=void 0===y?0:y.length;let x=r[l.id];if(void 0===x){x=[];for(let t=0;t<_;t++)x[t]=[t,0];r[l.id]=x}for(let t=0;t<_;t++){const r=x[t];r[0]=t,r[1]=y[t]}x.sort(absNumericalSort);for(let t=0;t<8;t++)t<_&&x[t][1]?(o[t][0]=x[t][0],o[t][1]=x[t][1]):(o[t][0]=Number.MAX_SAFE_INTEGER,o[t][1]=0);o.sort(numericalSort);const w=h.morphTargets&&l.morphAttributes.position,S=h.morphNormals&&l.morphAttributes.normal;let M=0;for(let t=0;t<8;t++){const r=o[t],a=r[0],h=r[1];a!==Number.MAX_SAFE_INTEGER&&h?(w&&l.getAttribute("morphTarget"+t)!==w[a]&&l.setAttribute("morphTarget"+t,w[a]),S&&l.getAttribute("morphNormal"+t)!==S[a]&&l.setAttribute("morphNormal"+t,S[a]),i[t]=h,M+=h):(w&&void 0!==l.getAttribute("morphTarget"+t)&&l.deleteAttribute("morphTarget"+t),S&&void 0!==l.getAttribute("morphNormal"+t)&&l.deleteAttribute("morphNormal"+t),i[t]=0)}const T=l.morphTargetsRelative?1:1-M;g.getUniforms().setValue(t,"morphTargetBaseInfluence",T),g.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function WebGLObjects(t,r,i,o){let a=new WeakMap;return{update:function update(t){const l=o.render.frame,h=t.geometry,g=r.get(t,h);return a.get(g)!==l&&(h.isGeometry&&g.updateFromObject(t),r.update(g),a.set(g,l)),t.isInstancedMesh&&(i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),g},dispose:function dispose(){a=new WeakMap}}}function DataTexture2DArray(t,r,i,o){Texture.call(this,null),this.image={data:t||null,width:r||1,height:i||1,depth:o||1},this.magFilter=Pe,this.minFilter=Pe,this.wrapR=Ee,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(t,r,i,o){Texture.call(this,null),this.image={data:t||null,width:r||1,height:i||1,depth:o||1},this.magFilter=Pe,this.minFilter=Pe,this.wrapR=Ee,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Vi.physical={uniforms:mergeUniforms([Vi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Gi.meshphysical_vert,fragmentShader:Gi.meshphysical_frag},DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;const Ui=new Texture,zi=new DataTexture2DArray,Wi=new DataTexture3D,qi=new CubeTexture,$i=[],Xi=[],Ki=new Float32Array(16),Yi=new Float32Array(9),Zi=new Float32Array(4);function flatten(t,r,i){const o=t[0];if(o<=0||o>0)return t;const a=r*i;let l=$i[a];if(void 0===l&&(l=new Float32Array(a),$i[a]=l),0!==r){o.toArray(l,0);for(let o=1,a=0;o!==r;++o)a+=i,t[o].toArray(l,a)}return l}function arraysEqual(t,r){if(t.length!==r.length)return!1;for(let i=0,o=t.length;i<o;i++)if(t[i]!==r[i])return!1;return!0}function copyArray(t,r){for(let i=0,o=r.length;i<o;i++)t[i]=r[i]}function allocTexUnits(t,r){let i=Xi[r];void 0===i&&(i=new Int32Array(r),Xi[r]=i);for(let o=0;o!==r;++o)i[o]=t.allocateTextureUnit();return i}function setValueV1f(t,r){const i=this.cache;i[0]!==r&&(t.uniform1f(this.addr,r),i[0]=r)}function setValueV2f(t,r){const i=this.cache;if(void 0!==r.x)i[0]===r.x&&i[1]===r.y||(t.uniform2f(this.addr,r.x,r.y),i[0]=r.x,i[1]=r.y);else{if(arraysEqual(i,r))return;t.uniform2fv(this.addr,r),copyArray(i,r)}}function setValueV3f(t,r){const i=this.cache;if(void 0!==r.x)i[0]===r.x&&i[1]===r.y&&i[2]===r.z||(t.uniform3f(this.addr,r.x,r.y,r.z),i[0]=r.x,i[1]=r.y,i[2]=r.z);else if(void 0!==r.r)i[0]===r.r&&i[1]===r.g&&i[2]===r.b||(t.uniform3f(this.addr,r.r,r.g,r.b),i[0]=r.r,i[1]=r.g,i[2]=r.b);else{if(arraysEqual(i,r))return;t.uniform3fv(this.addr,r),copyArray(i,r)}}function setValueV4f(t,r){const i=this.cache;if(void 0!==r.x)i[0]===r.x&&i[1]===r.y&&i[2]===r.z&&i[3]===r.w||(t.uniform4f(this.addr,r.x,r.y,r.z,r.w),i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=r.w);else{if(arraysEqual(i,r))return;t.uniform4fv(this.addr,r),copyArray(i,r)}}function setValueM2(t,r){const i=this.cache,o=r.elements;if(void 0===o){if(arraysEqual(i,r))return;t.uniformMatrix2fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,o))return;Zi.set(o),t.uniformMatrix2fv(this.addr,!1,Zi),copyArray(i,o)}}function setValueM3(t,r){const i=this.cache,o=r.elements;if(void 0===o){if(arraysEqual(i,r))return;t.uniformMatrix3fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,o))return;Yi.set(o),t.uniformMatrix3fv(this.addr,!1,Yi),copyArray(i,o)}}function setValueM4(t,r){const i=this.cache,o=r.elements;if(void 0===o){if(arraysEqual(i,r))return;t.uniformMatrix4fv(this.addr,!1,r),copyArray(i,r)}else{if(arraysEqual(i,o))return;Ki.set(o),t.uniformMatrix4fv(this.addr,!1,Ki),copyArray(i,o)}}function setValueT1(t,r,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.safeSetTexture2D(r||Ui,a)}function setValueT2DArray1(t,r,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.setTexture2DArray(r||zi,a)}function setValueT3D1(t,r,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.setTexture3D(r||Wi,a)}function setValueT6(t,r,i){const o=this.cache,a=i.allocateTextureUnit();o[0]!==a&&(t.uniform1i(this.addr,a),o[0]=a),i.safeSetTextureCube(r||qi,a)}function setValueV1i(t,r){const i=this.cache;i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r)}function setValueV2i(t,r){const i=this.cache;arraysEqual(i,r)||(t.uniform2iv(this.addr,r),copyArray(i,r))}function setValueV3i(t,r){const i=this.cache;arraysEqual(i,r)||(t.uniform3iv(this.addr,r),copyArray(i,r))}function setValueV4i(t,r){const i=this.cache;arraysEqual(i,r)||(t.uniform4iv(this.addr,r),copyArray(i,r))}function setValueV1ui(t,r){const i=this.cache;i[0]!==r&&(t.uniform1ui(this.addr,r),i[0]=r)}function setValueV1fArray(t,r){t.uniform1fv(this.addr,r)}function setValueV1iArray(t,r){t.uniform1iv(this.addr,r)}function setValueV2iArray(t,r){t.uniform2iv(this.addr,r)}function setValueV3iArray(t,r){t.uniform3iv(this.addr,r)}function setValueV4iArray(t,r){t.uniform4iv(this.addr,r)}function setValueV2fArray(t,r){const i=flatten(r,this.size,2);t.uniform2fv(this.addr,i)}function setValueV3fArray(t,r){const i=flatten(r,this.size,3);t.uniform3fv(this.addr,i)}function setValueV4fArray(t,r){const i=flatten(r,this.size,4);t.uniform4fv(this.addr,i)}function setValueM2Array(t,r){const i=flatten(r,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(t,r){const i=flatten(r,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(t,r){const i=flatten(r,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function setValueT1Array(t,r,i){const o=r.length,a=allocTexUnits(i,o);t.uniform1iv(this.addr,a);for(let l=0;l!==o;++l)i.safeSetTexture2D(r[l]||Ui,a[l])}function setValueT6Array(t,r,i){const o=r.length,a=allocTexUnits(i,o);t.uniform1iv(this.addr,a);for(let l=0;l!==o;++l)i.safeSetTextureCube(r[l]||qi,a[l])}function SingleUniform(t,r,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}(r.type)}function PureArrayUniform(t,r,i){this.id=t,this.addr=i,this.cache=[],this.size=r.size,this.setValue=function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}(r.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){const r=this.cache;t instanceof Float32Array&&r.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(r,t)},StructuredUniform.prototype.setValue=function(t,r,i){const o=this.seq;for(let a=0,l=o.length;a!==l;++a){const l=o[a];l.setValue(t,r[l.id],i)}};const Qi=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(t,r){t.seq.push(r),t.map[r.id]=r}function parseUniform(t,r,i){const o=t.name,a=o.length;for(Qi.lastIndex=0;;){const l=Qi.exec(o),h=Qi.lastIndex;let g=l[1];const y="]"===l[2],_=l[3];if(y&&(g|=0),void 0===_||"["===_&&h+2===a){addUniform(i,void 0===_?new SingleUniform(g,t,r):new PureArrayUniform(g,t,r));break}{let t=i.map[g];void 0===t&&(t=new StructuredUniform(g),addUniform(i,t)),i=t}}}function WebGLUniforms(t,r){this.seq=[],this.map={};const i=t.getProgramParameter(r,35718);for(let o=0;o<i;++o){const i=t.getActiveUniform(r,o);parseUniform(i,t.getUniformLocation(r,i.name),this)}}function WebGLShader(t,r,i){const o=t.createShader(r);return t.shaderSource(o,i),t.compileShader(o),o}WebGLUniforms.prototype.setValue=function(t,r,i,o){const a=this.map[r];void 0!==a&&a.setValue(t,i,o)},WebGLUniforms.prototype.setOptional=function(t,r,i){const o=r[i];void 0!==o&&this.setValue(t,i,o)},WebGLUniforms.upload=function(t,r,i,o){for(let a=0,l=r.length;a!==l;++a){const l=r[a],h=i[l.id];!1!==h.needsUpdate&&l.setValue(t,h.value,o)}},WebGLUniforms.seqWithValue=function(t,r){const i=[];for(let o=0,a=t.length;o!==a;++o){const a=t[o];a.id in r&&i.push(a)}return i};let Ji=0;function getEncodingComponents(t){switch(t){case dn:return["Linear","( value )"];case hn:return["sRGB","( value )"];case fn:return["RGBE","( value )"];case gn:return["RGBM","( value, 7.0 )"];case vn:return["RGBM","( value, 16.0 )"];case yn:return["RGBD","( value, 256.0 )"];case pn:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case mn:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function getShaderErrors(t,r,i){const o=t.getShaderParameter(r,35713),a=t.getShaderInfoLog(r).trim();if(o&&""===a)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+a+function addLineNumbers(t){const r=t.split("\n");for(let i=0;i<r.length;i++)r[i]=i+1+": "+r[i];return r.join("\n")}(t.getShaderSource(r))}function getTexelDecodingFunction(t,r){const i=getEncodingComponents(r);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(t,r){const i=getEncodingComponents(r);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(t,r){let i;switch(r){case he:i="Linear";break;case pe:i="Reinhard";break;case fe:i="OptimizedCineon";break;case me:i="ACESFilmic";break;case ge:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,r){return t.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function replaceClippingPlaneNums(t,r){return t.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const eo=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(eo,includeReplacer)}function includeReplacer(t,r){const i=Gi[r];if(void 0===i)throw new Error("Can not resolve #include <"+r+">");return resolveIncludes(i)}const to=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,no=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(t){return t.replace(no,loopReplacer).replace(to,deprecatedLoopReplacer)}function deprecatedLoopReplacer(t,r,i,o){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(t,r,i,o)}function loopReplacer(t,r,i,o){let a="";for(let l=parseInt(r);l<parseInt(i);l++)a+=o.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return a}function generatePrecision(t){let r="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?r+="\n#define HIGH_PRECISION":"mediump"===t.precision?r+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(r+="\n#define LOW_PRECISION"),r}function WebGLProgram(t,r,i,o){const a=t.getContext(),l=i.defines;let h=i.vertexShader,g=i.fragmentShader;const y=function generateShadowMapTypeDefine(t){let r="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===w?r="SHADOWMAP_TYPE_PCF":t.shadowMapType===S?r="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===M&&(r="SHADOWMAP_TYPE_VSM"),r}(i),_=function generateEnvMapTypeDefine(t){let r="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ye:case be:r="ENVMAP_TYPE_CUBE";break;case we:case Se:r="ENVMAP_TYPE_CUBE_UV"}return r}(i),x=function generateEnvMapModeDefine(t){let r="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case be:case Se:r="ENVMAP_MODE_REFRACTION"}return r}(i),T=function generateEnvMapBlendingDefine(t){let r="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case ce:r="ENVMAP_BLENDING_MULTIPLY";break;case le:r="ENVMAP_BLENDING_MIX";break;case ue:r="ENVMAP_BLENDING_ADD"}return r}(i),P=t.gammaFactor>0?t.gammaFactor:1,C=i.isWebGL2?"":function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(i),A=function generateDefines(t){const r=[];for(const i in t){const o=t[i];!1!==o&&r.push("#define "+i+" "+o)}return r.join("\n")}(l),O=a.createProgram();let L,I,R=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(L=[A].filter(filterEmptyLine).join("\n"),L.length>0&&(L+="\n"),I=[C,A].filter(filterEmptyLine).join("\n"),I.length>0&&(I+="\n")):(L=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,A,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+P,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+x:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+y:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),I=[C,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,A,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+P,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+_:"",i.envMap?"#define "+x:"",i.envMap?"#define "+T:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+y:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==de?"#define TONE_MAPPING":"",i.toneMapping!==de?Gi.tonemapping_pars_fragment:"",i.toneMapping!==de?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Gi.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),h=resolveIncludes(h),h=replaceLightNums(h,i),h=replaceClippingPlaneNums(h,i),g=resolveIncludes(g),g=replaceLightNums(g,i),g=replaceClippingPlaneNums(g,i),h=unrollLoops(h),g=unrollLoops(g),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(R="#version 300 es\n",L=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+L,I=["#define varying in",i.glslVersion===Kn?"":"out highp vec4 pc_fragColor;",i.glslVersion===Kn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+I);const j=R+I+g,N=WebGLShader(a,35633,R+L+h),k=WebGLShader(a,35632,j);if(a.attachShader(O,N),a.attachShader(O,k),void 0!==i.index0AttributeName?a.bindAttribLocation(O,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(O,0,"position"),a.linkProgram(O),t.debug.checkShaderErrors){const t=a.getProgramInfoLog(O).trim(),r=a.getShaderInfoLog(N).trim(),i=a.getShaderInfoLog(k).trim();let o=!0,l=!0;if(!1===a.getProgramParameter(O,35714)){o=!1;const r=getShaderErrors(a,N,"vertex"),i=getShaderErrors(a,k,"fragment");console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(O,35715),"gl.getProgramInfoLog",t,r,i)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==r&&""!==i||(l=!1);l&&(this.diagnostics={runnable:o,programLog:t,vertexShader:{log:r,prefix:L},fragmentShader:{log:i,prefix:I}})}let D,B;return a.deleteShader(N),a.deleteShader(k),this.getUniforms=function(){return void 0===D&&(D=new WebGLUniforms(a,O)),D},this.getAttributes=function(){return void 0===B&&(B=function fetchAttributeLocations(t,r){const i={},o=t.getProgramParameter(r,35721);for(let a=0;a<o;a++){const o=t.getActiveAttrib(r,a).name;i[o]=t.getAttribLocation(r,o)}return i}(a,O)),B},this.destroy=function(){o.releaseStatesOfProgram(this),a.deleteProgram(O),this.program=void 0},this.name=i.shaderName,this.id=Ji++,this.cacheKey=r,this.usedTimes=1,this.program=O,this.vertexShader=N,this.fragmentShader=k,this}function WebGLPrograms(t,r,i,o,a,l){const h=[],g=o.isWebGL2,y=o.logarithmicDepthBuffer,_=o.floatVertexTextures,x=o.maxVertexUniforms,w=o.vertexTextures;let S=o.precision;const M={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},T=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function getTextureEncodingFromMap(t){let r;return t?t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding):r=dn,r}return{getParameters:function getParameters(a,h,T,A,O){const L=A.fog,I=a.isMeshStandardMaterial?A.environment:null,R=r.get(a.envMap||I),j=M[a.type],N=O.isSkinnedMesh?function getMaxBones(t){const r=t.skeleton.bones;if(_)return 1024;{const t=x,i=Math.floor((t-20)/4),o=Math.min(i,r.length);return o<r.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+r.length+" bones. This GPU supports "+o+"."),0):o}}(O):0;let k,D;if(null!==a.precision&&(S=o.getMaxPrecision(a.precision),S!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",S,"instead.")),j){const t=Vi[j];k=t.vertexShader,D=t.fragmentShader}else k=a.vertexShader,D=a.fragmentShader;const B=t.getRenderTarget();return{isWebGL2:g,shaderID:j,shaderName:a.type,vertexShader:k,fragmentShader:D,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:S,instancing:!0===O.isInstancedMesh,instancingColor:!0===O.isInstancedMesh&&null!==O.instanceColor,supportsVertexTextures:w,outputEncoding:null!==B?getTextureEncodingFromMap(B.texture):t.outputEncoding,map:!!a.map,mapEncoding:getTextureEncodingFromMap(a.map),matcap:!!a.matcap,matcapEncoding:getTextureEncodingFromMap(a.matcap),envMap:!!R,envMapMode:R&&R.mapping,envMapEncoding:getTextureEncodingFromMap(R),envMapCubeUV:!!R&&(R.mapping===we||R.mapping===Se),lightMap:!!a.lightMap,lightMapEncoding:getTextureEncodingFromMap(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===wn,tangentSpaceNormalMap:a.normalMapType===xn,clearcoatMap:!!a.clearcoatMap,clearcoatRoughnessMap:!!a.clearcoatRoughnessMap,clearcoatNormalMap:!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,gradientMap:!!a.gradientMap,sheen:!!a.sheen,transmissionMap:!!a.transmissionMap,combine:a.combine,vertexTangents:a.normalMap&&a.vertexTangents,vertexColors:a.vertexColors,vertexUvs:!!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatMap||a.clearcoatRoughnessMap||a.clearcoatNormalMap||a.displacementMap||a.transmissionMap),uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmissionMap||!a.displacementMap),fog:!!L,useFog:a.fog,fogExp2:L&&L.isFogExp2,flatShading:a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:y,skinning:a.skinning&&N>0,maxBones:N,useVertexTexture:_,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&T.length>0,shadowMapType:t.shadowMap.type,toneMapping:a.toneMapped?t.toneMapping:de,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,alphaTest:a.alphaTest,doubleSided:a.side===C,flipSided:a.side===P,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function getProgramCacheKey(r){const i=[];if(r.shaderID?i.push(r.shaderID):(i.push(r.fragmentShader),i.push(r.vertexShader)),void 0!==r.defines)for(const t in r.defines)i.push(t),i.push(r.defines[t]);if(!1===r.isRawShaderMaterial){for(let t=0;t<T.length;t++)i.push(r[T[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(r.customProgramCacheKey),i.join()},getUniforms:function getUniforms(t){const r=M[t.type];let i;if(r){const t=Vi[r];i=ki.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function acquireProgram(r,i){let o;for(let t=0,a=h.length;t<a;t++){const r=h[t];if(r.cacheKey===i){o=r,++o.usedTimes;break}}return void 0===o&&(o=new WebGLProgram(t,i,r,a),h.push(o)),o},releaseProgram:function releaseProgram(t){if(0==--t.usedTimes){const r=h.indexOf(t);h[r]=h[h.length-1],h.pop(),t.destroy()}},programs:h}}function WebGLProperties(){let t=new WeakMap;return{get:function get(r){let i=t.get(r);return void 0===i&&(i={},t.set(r,i)),i},remove:function remove(r){t.delete(r)},update:function update(r,i,o){t.get(r)[i]=o},dispose:function dispose(){t=new WeakMap}}}function painterSortStable(t,r){return t.groupOrder!==r.groupOrder?t.groupOrder-r.groupOrder:t.renderOrder!==r.renderOrder?t.renderOrder-r.renderOrder:t.program!==r.program?t.program.id-r.program.id:t.material.id!==r.material.id?t.material.id-r.material.id:t.z!==r.z?t.z-r.z:t.id-r.id}function reversePainterSortStable(t,r){return t.groupOrder!==r.groupOrder?t.groupOrder-r.groupOrder:t.renderOrder!==r.renderOrder?t.renderOrder-r.renderOrder:t.z!==r.z?r.z-t.z:t.id-r.id}function WebGLRenderList(t){const r=[];let i=0;const o=[],a=[],l={id:-1};function getNextRenderItem(o,a,h,g,y,_){let x=r[i];const w=t.get(h);return void 0===x?(x={id:o.id,object:o,geometry:a,material:h,program:w.program||l,groupOrder:g,renderOrder:o.renderOrder,z:y,group:_},r[i]=x):(x.id=o.id,x.object=o,x.geometry=a,x.material=h,x.program=w.program||l,x.groupOrder=g,x.renderOrder=o.renderOrder,x.z=y,x.group=_),i++,x}return{opaque:o,transparent:a,init:function init(){i=0,o.length=0,a.length=0},push:function push(t,r,i,l,h,g){const y=getNextRenderItem(t,r,i,l,h,g);(!0===i.transparent?a:o).push(y)},unshift:function unshift(t,r,i,l,h,g){const y=getNextRenderItem(t,r,i,l,h,g);(!0===i.transparent?a:o).unshift(y)},finish:function finish(){for(let t=i,o=r.length;t<o;t++){const i=r[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function sort(t,r){o.length>1&&o.sort(t||painterSortStable),a.length>1&&a.sort(r||reversePainterSortStable)}}}function WebGLRenderLists(t){let r=new WeakMap;return{get:function get(i,o){const a=r.get(i);let l;return void 0===a?(l=new WebGLRenderList(t),r.set(i,new WeakMap),r.get(i).set(o,l)):(l=a.get(o),void 0===l&&(l=new WebGLRenderList(t),a.set(o,l))),l},dispose:function dispose(){r=new WeakMap}}}function UniformsCache(){const t={};return{get:function(r){if(void 0!==t[r.id])return t[r.id];let i;switch(r.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return t[r.id]=i,i}}}let ro=0;function shadowCastingLightsFirst(t,r){return(r.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(t,r){const i=new UniformsCache,o=function ShadowUniformsCache(){const t={};return{get:function(r){if(void 0!==t[r.id])return t[r.id];let i;switch(r.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return t[r.id]=i,i}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let y=0;y<9;y++)a.probe.push(new Vector3);const l=new Vector3,h=new Matrix4,g=new Matrix4;return{setup:function setup(y,_,x){let w=0,S=0,M=0;for(let t=0;t<9;t++)a.probe[t].set(0,0,0);let T=0,P=0,C=0,A=0,O=0,L=0,I=0,R=0;const j=x.matrixWorldInverse;y.sort(shadowCastingLightsFirst);for(let t=0,r=y.length;t<r;t++){const r=y[t],_=r.color,x=r.intensity,N=r.distance,k=r.shadow&&r.shadow.map?r.shadow.map.texture:null;if(r.isAmbientLight)w+=_.r*x,S+=_.g*x,M+=_.b*x;else if(r.isLightProbe)for(let t=0;t<9;t++)a.probe[t].addScaledVector(r.sh.coefficients[t],x);else if(r.isDirectionalLight){const t=i.get(r);if(t.color.copy(r.color).multiplyScalar(r.intensity),t.direction.setFromMatrixPosition(r.matrixWorld),l.setFromMatrixPosition(r.target.matrixWorld),t.direction.sub(l),t.direction.transformDirection(j),r.castShadow){const t=r.shadow,i=o.get(r);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,a.directionalShadow[T]=i,a.directionalShadowMap[T]=k,a.directionalShadowMatrix[T]=r.shadow.matrix,L++}a.directional[T]=t,T++}else if(r.isSpotLight){const t=i.get(r);if(t.position.setFromMatrixPosition(r.matrixWorld),t.position.applyMatrix4(j),t.color.copy(_).multiplyScalar(x),t.distance=N,t.direction.setFromMatrixPosition(r.matrixWorld),l.setFromMatrixPosition(r.target.matrixWorld),t.direction.sub(l),t.direction.transformDirection(j),t.coneCos=Math.cos(r.angle),t.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),t.decay=r.decay,r.castShadow){const t=r.shadow,i=o.get(r);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,a.spotShadow[C]=i,a.spotShadowMap[C]=k,a.spotShadowMatrix[C]=r.shadow.matrix,R++}a.spot[C]=t,C++}else if(r.isRectAreaLight){const t=i.get(r);t.color.copy(_).multiplyScalar(x),t.position.setFromMatrixPosition(r.matrixWorld),t.position.applyMatrix4(j),g.identity(),h.copy(r.matrixWorld),h.premultiply(j),g.extractRotation(h),t.halfWidth.set(.5*r.width,0,0),t.halfHeight.set(0,.5*r.height,0),t.halfWidth.applyMatrix4(g),t.halfHeight.applyMatrix4(g),a.rectArea[A]=t,A++}else if(r.isPointLight){const t=i.get(r);if(t.position.setFromMatrixPosition(r.matrixWorld),t.position.applyMatrix4(j),t.color.copy(r.color).multiplyScalar(r.intensity),t.distance=r.distance,t.decay=r.decay,r.castShadow){const t=r.shadow,i=o.get(r);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,a.pointShadow[P]=i,a.pointShadowMap[P]=k,a.pointShadowMatrix[P]=r.shadow.matrix,I++}a.point[P]=t,P++}else if(r.isHemisphereLight){const t=i.get(r);t.direction.setFromMatrixPosition(r.matrixWorld),t.direction.transformDirection(j),t.direction.normalize(),t.skyColor.copy(r.color).multiplyScalar(x),t.groundColor.copy(r.groundColor).multiplyScalar(x),a.hemi[O]=t,O++}}A>0&&(r.isWebGL2||!0===t.has("OES_texture_float_linear")?(a.rectAreaLTC1=Hi.LTC_FLOAT_1,a.rectAreaLTC2=Hi.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Hi.LTC_HALF_1,a.rectAreaLTC2=Hi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=w,a.ambient[1]=S,a.ambient[2]=M;const N=a.hash;N.directionalLength===T&&N.pointLength===P&&N.spotLength===C&&N.rectAreaLength===A&&N.hemiLength===O&&N.numDirectionalShadows===L&&N.numPointShadows===I&&N.numSpotShadows===R||(a.directional.length=T,a.spot.length=C,a.rectArea.length=A,a.point.length=P,a.hemi.length=O,a.directionalShadow.length=L,a.directionalShadowMap.length=L,a.pointShadow.length=I,a.pointShadowMap.length=I,a.spotShadow.length=R,a.spotShadowMap.length=R,a.directionalShadowMatrix.length=L,a.pointShadowMatrix.length=I,a.spotShadowMatrix.length=R,N.directionalLength=T,N.pointLength=P,N.spotLength=C,N.rectAreaLength=A,N.hemiLength=O,N.numDirectionalShadows=L,N.numPointShadows=I,N.numSpotShadows=R,a.version=ro++)},state:a}}function WebGLRenderState(t,r){const i=new WebGLLights(t,r),o=[],a=[];return{init:function init(){o.length=0,a.length=0},state:{lightsArray:o,shadowsArray:a,lights:i},setupLights:function setupLights(t){i.setup(o,a,t)},pushLight:function pushLight(t){o.push(t)},pushShadow:function pushShadow(t){a.push(t)}}}function WebGLRenderStates(t,r){let i=new WeakMap;return{get:function get(o,a){let l;return!1===i.has(o)?(l=new WebGLRenderState(t,r),i.set(o,new WeakMap),i.get(o).set(a,l)):!1===i.get(o).has(a)?(l=new WebGLRenderState(t,r),i.get(o).set(a,l)):l=i.get(o).get(a),l},dispose:function dispose(){i=new WeakMap}}}function MeshDepthMaterial(t){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=bn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function MeshDistanceMaterial(t){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function WebGLShadowMap(t,r,i){let o=new Frustum;const a=new Vector2,l=new Vector2,h=new Vector4,g=[],y=[],_={},x={0:P,1:T,2:C},S=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),A=S.clone();A.defines.HORIZONAL_PASS=1;const O=new BufferGeometry;O.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const I=new Mesh(O,S),R=this;function VSMPass(i,o){const a=r.update(I);S.uniforms.shadow_pass.value=i.map.texture,S.uniforms.resolution.value=i.mapSize,S.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(o,null,a,S,I,null),A.uniforms.shadow_pass.value=i.mapPass.texture,A.uniforms.resolution.value=i.mapSize,A.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(o,null,a,A,I,null)}function getDepthMaterialVariant(t,r,i){const o=t<<0|r<<1|i<<2;let a=g[o];return void 0===a&&(a=new MeshDepthMaterial({depthPacking:_n,morphTargets:t,skinning:r}),g[o]=a),a}function getDistanceMaterialVariant(t,r,i){const o=t<<0|r<<1|i<<2;let a=y[o];return void 0===a&&(a=new MeshDistanceMaterial({morphTargets:t,skinning:r}),y[o]=a),a}function getDepthMaterial(r,i,o,a,l,h,g){let y=null,w=getDepthMaterialVariant,S=r.customDepthMaterial;if(!0===a.isPointLight&&(w=getDistanceMaterialVariant,S=r.customDistanceMaterial),void 0===S){let t=!1;!0===o.morphTargets&&(t=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let a=!1;!0===r.isSkinnedMesh&&(!0===o.skinning?a=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",r));y=w(t,a,!0===r.isInstancedMesh)}else y=S;if(t.localClippingEnabled&&!0===o.clipShadows&&0!==o.clippingPlanes.length){const t=y.uuid,r=o.uuid;let i=_[t];void 0===i&&(i={},_[t]=i);let a=i[r];void 0===a&&(a=y.clone(),i[r]=a),y=a}return y.visible=o.visible,y.wireframe=o.wireframe,y.side=g===M?null!==o.shadowSide?o.shadowSide:o.side:null!==o.shadowSide?o.shadowSide:x[o.side],y.clipShadows=o.clipShadows,y.clippingPlanes=o.clippingPlanes,y.clipIntersection=o.clipIntersection,y.wireframeLinewidth=o.wireframeLinewidth,y.linewidth=o.linewidth,!0===a.isPointLight&&!0===y.isMeshDistanceMaterial&&(y.referencePosition.setFromMatrixPosition(a.matrixWorld),y.nearDistance=l,y.farDistance=h),y}function renderObject(i,a,l,h,g){if(!1===i.visible)return;if(i.layers.test(a.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&g===M)&&(!i.frustumCulled||o.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,i.matrixWorld);const o=r.update(i),a=i.material;if(Array.isArray(a)){const r=o.groups;for(let y=0,_=r.length;y<_;y++){const _=r[y],x=a[_.materialIndex];if(x&&x.visible){const r=getDepthMaterial(i,o,x,h,l.near,l.far,g);t.renderBufferDirect(l,null,o,r,i,_)}}}else if(a.visible){const r=getDepthMaterial(i,o,a,h,l.near,l.far,g);t.renderBufferDirect(l,null,o,r,i,null)}}const y=i.children;for(let t=0,r=y.length;t<r;t++)renderObject(y[t],a,l,h,g)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=w,this.render=function(r,g,y){if(!1===R.enabled)return;if(!1===R.autoUpdate&&!1===R.needsUpdate)return;if(0===r.length)return;const _=t.getRenderTarget(),x=t.getActiveCubeFace(),w=t.getActiveMipmapLevel(),S=t.state;S.setBlending(L),S.buffers.color.setClear(1,1,1,1),S.buffers.depth.setTest(!0),S.setScissorTest(!1);for(let T=0,P=r.length;T<P;T++){const _=r[T],x=_.shadow;if(void 0===x){console.warn("THREE.WebGLShadowMap:",_,"has no shadow.");continue}if(!1===x.autoUpdate&&!1===x.needsUpdate)continue;a.copy(x.mapSize);const w=x.getFrameExtents();if(a.multiply(w),l.copy(x.mapSize),(a.x>i||a.y>i)&&(a.x>i&&(l.x=Math.floor(i/w.x),a.x=l.x*w.x,x.mapSize.x=l.x),a.y>i&&(l.y=Math.floor(i/w.y),a.y=l.y*w.y,x.mapSize.y=l.y)),null===x.map&&!x.isPointLightShadow&&this.type===M){const t={minFilter:Ie,magFilter:Ie,format:Ze};x.map=new WebGLRenderTarget(a.x,a.y,t),x.map.texture.name=_.name+".shadowMap",x.mapPass=new WebGLRenderTarget(a.x,a.y,t),x.camera.updateProjectionMatrix()}if(null===x.map){const t={minFilter:Pe,magFilter:Pe,format:Ze};x.map=new WebGLRenderTarget(a.x,a.y,t),x.map.texture.name=_.name+".shadowMap",x.camera.updateProjectionMatrix()}t.setRenderTarget(x.map),t.clear();const P=x.getViewportCount();for(let t=0;t<P;t++){const r=x.getViewport(t);h.set(l.x*r.x,l.y*r.y,l.x*r.z,l.y*r.w),S.viewport(h),x.updateMatrices(_,t),o=x.getFrustum(),renderObject(g,y,x.camera,_,this.type)}x.isPointLightShadow||this.type!==M||VSMPass(x,y),x.needsUpdate=!1}R.needsUpdate=!1,t.setRenderTarget(_,x,w)}}function WebGLState(t,r,i){const o=i.isWebGL2;const a=new function ColorBuffer(){let r=!1;const i=new Vector4;let o=null;const a=new Vector4(0,0,0,0);return{setMask:function(i){o===i||r||(t.colorMask(i,i,i,i),o=i)},setLocked:function(t){r=t},setClear:function(r,o,l,h,g){!0===g&&(r*=h,o*=h,l*=h),i.set(r,o,l,h),!1===a.equals(i)&&(t.clearColor(r,o,l,h),a.copy(i))},reset:function(){r=!1,o=null,a.set(-1,0,0,0)}}},l=new function DepthBuffer(){let r=!1,i=null,o=null,a=null;return{setTest:function(t){t?enable(2929):disable(2929)},setMask:function(o){i===o||r||(t.depthMask(o),i=o)},setFunc:function(r){if(o!==r){if(r)switch(r){case ee:t.depthFunc(512);break;case te:t.depthFunc(519);break;case ne:t.depthFunc(513);break;case re:t.depthFunc(515);break;case ie:t.depthFunc(514);break;case oe:t.depthFunc(518);break;case ae:t.depthFunc(516);break;case se:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);o=r}},setLocked:function(t){r=t},setClear:function(r){a!==r&&(t.clearDepth(r),a=r)},reset:function(){r=!1,i=null,o=null,a=null}}},_=new function StencilBuffer(){let r=!1,i=null,o=null,a=null,l=null,h=null,g=null,y=null,_=null;return{setTest:function(t){r||(t?enable(2960):disable(2960))},setMask:function(o){i===o||r||(t.stencilMask(o),i=o)},setFunc:function(r,i,h){o===r&&a===i&&l===h||(t.stencilFunc(r,i,h),o=r,a=i,l=h)},setOp:function(r,i,o){h===r&&g===i&&y===o||(t.stencilOp(r,i,o),h=r,g=i,y=o)},setLocked:function(t){r=t},setClear:function(r){_!==r&&(t.clearStencil(r),_=r)},reset:function(){r=!1,i=null,o=null,a=null,l=null,h=null,g=null,y=null,_=null}}};let x={},w=null,S=null,M=null,T=null,A=null,O=null,ce=null,le=null,ue=null,de=!1,he=null,pe=null,fe=null,me=null,ge=null;const ve=t.getParameter(35661);let ye=!1,be=0;const _e=t.getParameter(7938);-1!==_e.indexOf("WebGL")?(be=parseFloat(/^WebGL\ ([0-9])/.exec(_e)[1]),ye=be>=1):-1!==_e.indexOf("OpenGL ES")&&(be=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(_e)[1]),ye=be>=2);let xe=null,we={};const Se=new Vector4,Me=new Vector4;function createTexture(r,i,o){const a=new Uint8Array(4),l=t.createTexture();t.bindTexture(r,l),t.texParameteri(r,10241,9728),t.texParameteri(r,10240,9728);for(let h=0;h<o;h++)t.texImage2D(i+h,0,6408,1,1,0,6408,5121,a);return l}const Ee={};function enable(r){!0!==x[r]&&(t.enable(r),x[r]=!0)}function disable(r){!1!==x[r]&&(t.disable(r),x[r]=!1)}Ee[3553]=createTexture(3553,3553,1),Ee[34067]=createTexture(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),_.setClear(0),enable(2929),l.setFunc(re),setFlipSided(!1),setCullFace(g),enable(2884),setBlending(L);const Te={[D]:32774,[B]:32778,[G]:32779};if(o)Te[H]=32775,Te[V]=32776;else{const t=r.get("EXT_blend_minmax");null!==t&&(Te[H]=t.MIN_EXT,Te[V]=t.MAX_EXT)}const Pe={[U]:0,[z]:1,[W]:768,[$]:770,[J]:776,[Z]:774,[K]:772,[q]:769,[X]:771,[Q]:775,[Y]:773};function setBlending(r,i,o,a,l,h,g,y){if(r!==L){if(S||(enable(3042),S=!0),r===k)l=l||i,h=h||o,g=g||a,i===T&&l===ce||(t.blendEquationSeparate(Te[i],Te[l]),T=i,ce=l),o===A&&a===O&&h===le&&g===ue||(t.blendFuncSeparate(Pe[o],Pe[a],Pe[h],Pe[g]),A=o,O=a,le=h,ue=g),M=r,de=null;else if(r!==M||y!==de){if(T===D&&ce===D||(t.blendEquation(32774),T=D,ce=D),y)switch(r){case I:t.blendFuncSeparate(1,771,1,771);break;case R:t.blendFunc(1,1);break;case j:t.blendFuncSeparate(0,0,769,771);break;case N:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",r)}else switch(r){case I:t.blendFuncSeparate(770,771,1,771);break;case R:t.blendFunc(770,1);break;case j:t.blendFunc(0,769);break;case N:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",r)}A=null,O=null,le=null,ue=null,M=r,de=y}}else S&&(disable(3042),S=!1)}function setFlipSided(r){he!==r&&(r?t.frontFace(2304):t.frontFace(2305),he=r)}function setCullFace(r){r!==h?(enable(2884),r!==pe&&(r===g?t.cullFace(1029):r===y?t.cullFace(1028):t.cullFace(1032))):disable(2884),pe=r}function setPolygonOffset(r,i,o){r?(enable(32823),me===i&&ge===o||(t.polygonOffset(i,o),me=i,ge=o)):disable(32823)}function activeTexture(r){void 0===r&&(r=33984+ve-1),xe!==r&&(t.activeTexture(r),xe=r)}return{buffers:{color:a,depth:l,stencil:_},enable:enable,disable:disable,useProgram:function useProgram(r){return w!==r&&(t.useProgram(r),w=r,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,r){t.side===C?disable(2884):enable(2884);let i=t.side===P;r&&(i=!i),setFlipSided(i),t.blending===I&&!1===t.transparent?setBlending(L):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),a.setMask(t.colorWrite);const o=t.stencilWrite;_.setTest(o),o&&(_.setMask(t.stencilWriteMask),_.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),_.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(r){r!==fe&&(ye&&t.lineWidth(r),fe=r)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(3089):disable(3089)},activeTexture:activeTexture,bindTexture:function bindTexture(r,i){null===xe&&activeTexture();let o=we[xe];void 0===o&&(o={type:void 0,texture:void 0},we[xe]=o),o.type===r&&o.texture===i||(t.bindTexture(r,i||Ee[r]),o.type=r,o.texture=i)},unbindTexture:function unbindTexture(){const r=we[xe];void 0!==r&&void 0!==r.type&&(t.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)},compressedTexImage2D:function compressedTexImage2D(){try{t.compressedTexImage2D.apply(t,arguments)}catch(r){console.error("THREE.WebGLState:",r)}},texImage2D:function texImage2D(){try{t.texImage2D.apply(t,arguments)}catch(r){console.error("THREE.WebGLState:",r)}},texImage3D:function texImage3D(){try{t.texImage3D.apply(t,arguments)}catch(r){console.error("THREE.WebGLState:",r)}},scissor:function scissor(r){!1===Se.equals(r)&&(t.scissor(r.x,r.y,r.z,r.w),Se.copy(r))},viewport:function viewport(r){!1===Me.equals(r)&&(t.viewport(r.x,r.y,r.z,r.w),Me.copy(r))},reset:function reset(){x={},xe=null,we={},w=null,M=null,he=null,pe=null,a.reset(),l.reset(),_.reset()}}}function WebGLTextures(t,r,i,o,a,l,h){const g=a.isWebGL2,y=a.maxTextures,_=a.maxCubemapSize,x=a.maxTextureSize,w=a.maxSamples,S=new WeakMap;let M,T=!1;try{T="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(I){}function createCanvas(t,r){return T?new OffscreenCanvas(t,r):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function resizeImage(t,r,i,o){let a=1;if((t.width>o||t.height>o)&&(a=o/Math.max(t.width,t.height)),a<1||!0===r){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const o=r?Qn.floorPowerOfTwo:Math.floor,l=o(a*t.width),h=o(a*t.height);void 0===M&&(M=createCanvas(l,h));const g=i?createCanvas(l,h):M;g.width=l,g.height=h;return g.getContext("2d").drawImage(t,0,0,l,h),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+l+"x"+h+")."),g}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function isPowerOfTwo(t){return Qn.isPowerOfTwo(t.width)&&Qn.isPowerOfTwo(t.height)}function textureNeedsGenerateMipmaps(t,r){return t.generateMipmaps&&r&&t.minFilter!==Pe&&t.minFilter!==Ie}function generateMipmap(r,i,a,l){t.generateMipmap(r);o.get(i).__maxMipLevel=Math.log(Math.max(a,l))*Math.LOG2E}function getInternalFormat(i,o,a){if(!1===g)return o;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=o;return 6403===o&&(5126===a&&(l=33326),5131===a&&(l=33325),5121===a&&(l=33321)),6407===o&&(5126===a&&(l=34837),5131===a&&(l=34843),5121===a&&(l=32849)),6408===o&&(5126===a&&(l=34836),5131===a&&(l=34842),5121===a&&(l=32856)),33325!==l&&33326!==l&&34842!==l&&34836!==l||r.get("EXT_color_buffer_float"),l}function filterFallback(t){return t===Pe||t===Ce||t===Oe?9728:9729}function onTextureDispose(r){const i=r.target;i.removeEventListener("dispose",onTextureDispose),function deallocateTexture(r){const i=o.get(r);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),o.remove(r)}(i),i.isVideoTexture&&S.delete(i),h.memory.textures--}function onRenderTargetDispose(r){const i=r.target;i.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(r){const i=o.get(r),a=o.get(r.texture);if(!r)return;void 0!==a.__webglTexture&&t.deleteTexture(a.__webglTexture);r.depthTexture&&r.depthTexture.dispose();if(r.isWebGLCubeRenderTarget)for(let o=0;o<6;o++)t.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[o]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);o.remove(r.texture),o.remove(r)}(i),h.memory.textures--}let P=0;function setTexture2D(t,r){const a=o.get(t);if(t.isVideoTexture&&function updateVideoTexture(t){const r=h.render.frame;S.get(t)!==r&&(S.set(t,r),t.update())}(t),t.version>0&&a.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void uploadTexture(a,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+r),i.bindTexture(3553,a.__webglTexture)}function setTextureCube(r,a){const h=o.get(r);r.version>0&&h.__version!==r.version?function uploadCubeTexture(r,o,a){if(6!==o.image.length)return;initTexture(r,o),i.activeTexture(33984+a),i.bindTexture(34067,r.__webglTexture),t.pixelStorei(37440,o.flipY);const h=o&&(o.isCompressedTexture||o.image[0].isCompressedTexture),y=o.image[0]&&o.image[0].isDataTexture,x=[];for(let t=0;t<6;t++)x[t]=h||y?y?o.image[t].image:o.image[t]:resizeImage(o.image[t],!1,!0,_);const w=x[0],S=isPowerOfTwo(w)||g,M=l.convert(o.format),T=l.convert(o.type),P=getInternalFormat(o.internalFormat,M,T);let C;if(setTextureParameters(34067,o,S),h){for(let t=0;t<6;t++){C=x[t].mipmaps;for(let r=0;r<C.length;r++){const a=C[r];o.format!==Ze&&o.format!==Ye?null!==M?i.compressedTexImage2D(34069+t,r,P,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,r,P,a.width,a.height,0,M,T,a.data)}}r.__maxMipLevel=C.length-1}else{C=o.mipmaps;for(let t=0;t<6;t++)if(y){i.texImage2D(34069+t,0,P,x[t].width,x[t].height,0,M,T,x[t].data);for(let r=0;r<C.length;r++){const o=C[r].image[t].image;i.texImage2D(34069+t,r+1,P,o.width,o.height,0,M,T,o.data)}}else{i.texImage2D(34069+t,0,P,M,T,x[t]);for(let r=0;r<C.length;r++){const o=C[r];i.texImage2D(34069+t,r+1,P,M,T,o.image[t])}}r.__maxMipLevel=C.length}textureNeedsGenerateMipmaps(o,S)&&generateMipmap(34067,o,w.width,w.height);r.__version=o.version,o.onUpdate&&o.onUpdate(o)}(h,r,a):(i.activeTexture(33984+a),i.bindTexture(34067,h.__webglTexture))}const C={[Me]:10497,[Ee]:33071,[Te]:33648},A={[Pe]:9728,[Ce]:9984,[Oe]:9986,[Ie]:9729,[Re]:9985,[Ne]:9987};function setTextureParameters(i,l,h){h?(t.texParameteri(i,10242,C[l.wrapS]),t.texParameteri(i,10243,C[l.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,C[l.wrapR]),t.texParameteri(i,10240,A[l.magFilter]),t.texParameteri(i,10241,A[l.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),l.wrapS===Ee&&l.wrapT===Ee||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,filterFallback(l.magFilter)),t.texParameteri(i,10241,filterFallback(l.minFilter)),l.minFilter!==Pe&&l.minFilter!==Ie&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const y=r.get("EXT_texture_filter_anisotropic");if(y){if(l.type===Ue&&null===r.get("OES_texture_float_linear"))return;if(l.type===ze&&null===(g||r.get("OES_texture_half_float_linear")))return;(l.anisotropy>1||o.get(l).__currentAnisotropy)&&(t.texParameterf(i,y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(l.anisotropy,a.getMaxAnisotropy())),o.get(l).__currentAnisotropy=l.anisotropy)}}function initTexture(r,i){void 0===r.__webglInit&&(r.__webglInit=!0,i.addEventListener("dispose",onTextureDispose),r.__webglTexture=t.createTexture(),h.memory.textures++)}function uploadTexture(r,o,a){let h=3553;o.isDataTexture2DArray&&(h=35866),o.isDataTexture3D&&(h=32879),initTexture(r,o),i.activeTexture(33984+a),i.bindTexture(h,r.__webglTexture),t.pixelStorei(37440,o.flipY),t.pixelStorei(37441,o.premultiplyAlpha),t.pixelStorei(3317,o.unpackAlignment);const y=function textureNeedsPowerOfTwo(t){return!g&&(t.wrapS!==Ee||t.wrapT!==Ee||t.minFilter!==Pe&&t.minFilter!==Ie)}(o)&&!1===isPowerOfTwo(o.image),_=resizeImage(o.image,y,!1,x),w=isPowerOfTwo(_)||g,S=l.convert(o.format);let M,T=l.convert(o.type),P=getInternalFormat(o.internalFormat,S,T);setTextureParameters(h,o,w);const C=o.mipmaps;if(o.isDepthTexture)P=6402,g?P=o.type===Ue?36012:o.type===Ve?33190:o.type===Xe?35056:33189:o.type===Ue&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),o.format===tt&&6402===P&&o.type!==Ge&&o.type!==Ve&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),o.type=Ge,T=l.convert(o.type)),o.format===nt&&6402===P&&(P=34041,o.type!==Xe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),o.type=Xe,T=l.convert(o.type))),i.texImage2D(3553,0,P,_.width,_.height,0,S,T,null);else if(o.isDataTexture)if(C.length>0&&w){for(let t=0,r=C.length;t<r;t++)M=C[t],i.texImage2D(3553,t,P,M.width,M.height,0,S,T,M.data);o.generateMipmaps=!1,r.__maxMipLevel=C.length-1}else i.texImage2D(3553,0,P,_.width,_.height,0,S,T,_.data),r.__maxMipLevel=0;else if(o.isCompressedTexture){for(let t=0,r=C.length;t<r;t++)M=C[t],o.format!==Ze&&o.format!==Ye?null!==S?i.compressedTexImage2D(3553,t,P,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,P,M.width,M.height,0,S,T,M.data);r.__maxMipLevel=C.length-1}else if(o.isDataTexture2DArray)i.texImage3D(35866,0,P,_.width,_.height,_.depth,0,S,T,_.data),r.__maxMipLevel=0;else if(o.isDataTexture3D)i.texImage3D(32879,0,P,_.width,_.height,_.depth,0,S,T,_.data),r.__maxMipLevel=0;else if(C.length>0&&w){for(let t=0,r=C.length;t<r;t++)M=C[t],i.texImage2D(3553,t,P,S,T,M);o.generateMipmaps=!1,r.__maxMipLevel=C.length-1}else i.texImage2D(3553,0,P,S,T,_),r.__maxMipLevel=0;textureNeedsGenerateMipmaps(o,w)&&generateMipmap(h,o,_.width,_.height),r.__version=o.version,o.onUpdate&&o.onUpdate(o)}function setupFrameBufferTexture(r,a,h,g){const y=l.convert(a.texture.format),_=l.convert(a.texture.type),x=getInternalFormat(a.texture.internalFormat,y,_);i.texImage2D(g,0,x,a.width,a.height,0,y,_,null),t.bindFramebuffer(36160,r),t.framebufferTexture2D(36160,h,g,o.get(a.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function setupRenderBufferStorage(r,i,o){if(t.bindRenderbuffer(36161,r),i.depthBuffer&&!i.stencilBuffer){let a=33189;if(o){const r=i.depthTexture;r&&r.isDepthTexture&&(r.type===Ue?a=36012:r.type===Ve&&(a=33190));const o=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,o,a,i.width,i.height)}else t.renderbufferStorage(36161,a,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,r)}else if(i.depthBuffer&&i.stencilBuffer){if(o){const r=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,r)}else{const r=l.convert(i.texture.format),a=l.convert(i.texture.type),h=getInternalFormat(i.texture.internalFormat,r,a);if(o){const r=getRenderTargetSamples(i);t.renderbufferStorageMultisample(36161,r,h,i.width,i.height)}else t.renderbufferStorage(36161,h,i.width,i.height)}t.bindRenderbuffer(36161,null)}function setupDepthRenderbuffer(r){const i=o.get(r),a=!0===r.isWebGLCubeRenderTarget;if(r.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(r,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,r),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");o.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),setTexture2D(i.depthTexture,0);const a=o.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===tt)t.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==nt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,r)}else if(a){i.__webglDepthbuffer=[];for(let o=0;o<6;o++)t.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=t.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer[o],r,!1)}else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),setupRenderBufferStorage(i.__webglDepthbuffer,r,!1);t.bindFramebuffer(36160,null)}function getRenderTargetSamples(t){return g&&t.isWebGLMultisampleRenderTarget?Math.min(w,t.samples):0}let O=!1,L=!1;this.allocateTextureUnit=function allocateTextureUnit(){const t=P;return t>=y&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+y),P+=1,t},this.resetTextureUnits=function resetTextureUnits(){P=0},this.setTexture2D=setTexture2D,this.setTexture2DArray=function setTexture2DArray(t,r){const a=o.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,r):(i.activeTexture(33984+r),i.bindTexture(35866,a.__webglTexture))},this.setTexture3D=function setTexture3D(t,r){const a=o.get(t);t.version>0&&a.__version!==t.version?uploadTexture(a,t,r):(i.activeTexture(33984+r),i.bindTexture(32879,a.__webglTexture))},this.setTextureCube=setTextureCube,this.setupRenderTarget=function setupRenderTarget(r){const a=o.get(r),y=o.get(r.texture);r.addEventListener("dispose",onRenderTargetDispose),y.__webglTexture=t.createTexture(),h.memory.textures++;const _=!0===r.isWebGLCubeRenderTarget,x=!0===r.isWebGLMultisampleRenderTarget,w=isPowerOfTwo(r)||g;if(!g||r.texture.format!==Ye||r.texture.type!==Ue&&r.texture.type!==ze||(r.texture.format=Ze,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),_){a.__webglFramebuffer=[];for(let r=0;r<6;r++)a.__webglFramebuffer[r]=t.createFramebuffer()}else if(a.__webglFramebuffer=t.createFramebuffer(),x)if(g){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,a.__webglColorRenderbuffer);const i=l.convert(r.texture.format),o=l.convert(r.texture.type),h=getInternalFormat(r.texture.internalFormat,i,o),g=getRenderTargetSamples(r);t.renderbufferStorageMultisample(36161,g,h,r.width,r.height),t.bindFramebuffer(36160,a.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,a.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),r.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),setupRenderBufferStorage(a.__webglDepthRenderbuffer,r,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(_){i.bindTexture(34067,y.__webglTexture),setTextureParameters(34067,r.texture,w);for(let t=0;t<6;t++)setupFrameBufferTexture(a.__webglFramebuffer[t],r,36064,34069+t);textureNeedsGenerateMipmaps(r.texture,w)&&generateMipmap(34067,r.texture,r.width,r.height),i.bindTexture(34067,null)}else i.bindTexture(3553,y.__webglTexture),setTextureParameters(3553,r.texture,w),setupFrameBufferTexture(a.__webglFramebuffer,r,36064,3553),textureNeedsGenerateMipmaps(r.texture,w)&&generateMipmap(3553,r.texture,r.width,r.height),i.bindTexture(3553,null);r.depthBuffer&&setupDepthRenderbuffer(r)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){const r=t.texture;if(textureNeedsGenerateMipmaps(r,isPowerOfTwo(t)||g)){const a=t.isWebGLCubeRenderTarget?34067:3553,l=o.get(r).__webglTexture;i.bindTexture(a,l),generateMipmap(a,r,t.width,t.height),i.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function updateMultisampleRenderTarget(r){if(r.isWebGLMultisampleRenderTarget)if(g){const i=o.get(r);t.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,i.__webglFramebuffer);const a=r.width,l=r.height;let h=16384;r.depthBuffer&&(h|=256),r.stencilBuffer&&(h|=1024),t.blitFramebuffer(0,0,a,l,0,0,a,l,h,9728),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function safeSetTexture2D(t,r){t&&t.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),t=t.texture),setTexture2D(t,r)},this.safeSetTextureCube=function safeSetTextureCube(t,r){t&&t.isWebGLCubeRenderTarget&&(!1===L&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),L=!0),t=t.texture),setTextureCube(t,r)}}function WebGLUtils(t,r,i){const o=i.isWebGL2;return{convert:function convert(t){let i;if(t===De)return 5121;if(t===We)return 32819;if(t===qe)return 32820;if(t===$e)return 33635;if(t===Be)return 5120;if(t===Fe)return 5122;if(t===Ge)return 5123;if(t===He)return 5124;if(t===Ve)return 5125;if(t===Ue)return 5126;if(t===ze)return o?5131:(i=r.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(t===Ke)return 6406;if(t===Ye)return 6407;if(t===Ze)return 6408;if(t===Qe)return 6409;if(t===Je)return 6410;if(t===tt)return 6402;if(t===nt)return 34041;if(t===rt)return 6403;if(t===it)return 36244;if(t===ot)return 33319;if(t===at)return 33320;if(t===st)return 36248;if(t===ct)return 36249;if(t===lt||t===ut||t===dt||t===ht){if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===lt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===ut)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===dt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===ht)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===pt||t===ft||t===mt||t===gt){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(t===pt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ft)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===mt)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===gt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===vt)return i=r.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===yt||t===bt)&&(i=r.get("WEBGL_compressed_texture_etc"),null!==i)){if(t===yt)return i.COMPRESSED_RGB8_ETC2;if(t===bt)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===_t||t===xt||t===wt||t===St||t===Mt||t===Et||t===Tt||t===Pt||t===Ct||t===At||t===Ot||t===Lt||t===It||t===Rt||t===Nt||t===kt||t===Dt||t===Bt||t===Ft||t===Gt||t===Ht||t===Vt||t===Ut||t===zt||t===Wt||t===qt||t===$t||t===Xt?(i=r.get("WEBGL_compressed_texture_astc"),null!==i?t:null):t===jt?(i=r.get("EXT_texture_compression_bptc"),null!==i?t:null):t===Xe?o?34042:(i=r.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function ArrayCamera(t){PerspectiveCamera.call(this),this.cameras=t||[]}function Group(){Object3D.call(this),this.type="Group"}function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}function WebXRManager(t,r){const i=this;let o=null,a=1,l=null,h="local-floor",g=null;const y=[],_=new Map,x=new PerspectiveCamera;x.layers.enable(1),x.viewport=new Vector4;const w=new PerspectiveCamera;w.layers.enable(2),w.viewport=new Vector4;const S=[x,w],M=new ArrayCamera;M.layers.enable(1),M.layers.enable(2);let T=null,P=null;function onSessionEvent(t){const r=_.get(t.inputSource);r&&r.dispatchEvent({type:t.type,data:t.inputSource})}function onSessionEnd(){_.forEach((function(t,r){t.disconnect(r)})),_.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),L.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function onRequestReferenceSpace(t){l=t,L.setContext(o),L.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function updateInputSources(t){const r=o.inputSources;for(let i=0;i<y.length;i++)_.set(r[i],y[i]);for(let i=0;i<t.removed.length;i++){const r=t.removed[i],o=_.get(r);o&&(o.dispatchEvent({type:"disconnected",data:r}),_.delete(r))}for(let i=0;i<t.added.length;i++){const r=t.added[i],o=_.get(r);o&&o.dispatchEvent({type:"connected",data:r})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let r=y[t];return void 0===r&&(r=new WebXRController,y[t]=r),r.getTargetRaySpace()},this.getControllerGrip=function(t){let r=y[t];return void 0===r&&(r=new WebXRController,y[t]=r),r.getGripSpace()},this.getHand=function(t){let r=y[t];return void 0===r&&(r=new WebXRController,y[t]=r),r.getHandSpace()},this.setFramebufferScaleFactor=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){h=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getSession=function(){return o},this.setSession=function(t){if(o=t,null!==o){o.addEventListener("select",onSessionEvent),o.addEventListener("selectstart",onSessionEvent),o.addEventListener("selectend",onSessionEvent),o.addEventListener("squeeze",onSessionEvent),o.addEventListener("squeezestart",onSessionEvent),o.addEventListener("squeezeend",onSessionEvent),o.addEventListener("end",onSessionEnd);const t=r.getContextAttributes();!0!==t.xrCompatible&&r.makeXRCompatible();const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:a},l=new XRWebGLLayer(o,r,i);o.updateRenderState({baseLayer:l}),o.requestReferenceSpace(h).then(onRequestReferenceSpace),o.addEventListener("inputsourceschange",updateInputSources)}};const C=new Vector3,A=new Vector3;function updateCamera(t,r){null===r?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(r.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){M.near=w.near=x.near=t.near,M.far=w.far=x.far=t.far,T===M.near&&P===M.far||(o.updateRenderState({depthNear:M.near,depthFar:M.far}),T=M.near,P=M.far);const r=t.parent,i=M.cameras;updateCamera(M,r);for(let o=0;o<i.length;o++)updateCamera(i[o],r);t.matrixWorld.copy(M.matrixWorld);const a=t.children;for(let o=0,l=a.length;o<l;o++)a[o].updateMatrixWorld(!0);return 2===i.length?function setProjectionFromUnion(t,r,i){C.setFromMatrixPosition(r.matrixWorld),A.setFromMatrixPosition(i.matrixWorld);const o=C.distanceTo(A),a=r.projectionMatrix.elements,l=i.projectionMatrix.elements,h=a[14]/(a[10]-1),g=a[14]/(a[10]+1),y=(a[9]+1)/a[5],_=(a[9]-1)/a[5],x=(a[8]-1)/a[0],w=(l[8]+1)/l[0],S=h*x,M=h*w,T=o/(-x+w),P=T*-x;r.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(P),t.translateZ(T),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const O=h+T,L=g+T,I=S-P,R=M+(o-P),j=y*g/L*O,N=_*g/L*O;t.projectionMatrix.makePerspective(I,R,j,N,O,L)}(M,x,w):M.projectionMatrix.copy(x.projectionMatrix),M};let O=null;const L=new WebGLAnimation;L.setAnimationLoop((function onAnimationFrame(r,i){if(g=i.getViewerPose(l),null!==g){const r=g.views,i=o.renderState.baseLayer;t.setFramebuffer(i.framebuffer);let a=!1;r.length!==M.cameras.length&&(M.cameras.length=0,a=!0);for(let t=0;t<r.length;t++){const o=r[t],l=i.getViewport(o),h=S[t];h.matrix.fromArray(o.transform.matrix),h.projectionMatrix.fromArray(o.projectionMatrix),h.viewport.set(l.x,l.y,l.width,l.height),0===t&&M.matrix.copy(h.matrix),!0===a&&M.cameras.push(h)}}const a=o.inputSources;for(let t=0;t<y.length;t++){const r=y[t],o=a[t];r.update(o,i,l)}O&&O(r,i)})),this.setAnimationLoop=function(t){O=t},this.dispose=function(){}}function WebGLMaterials(t){function refreshUniformsCommon(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map),i.alphaMap&&(r.alphaMap.value=i.alphaMap),i.specularMap&&(r.specularMap.value=i.specularMap);const o=t.get(i).envMap;if(o){r.envMap.value=o,r.flipEnvMap.value=o.isCubeTexture&&o._needsFlipEnvMap?-1:1,r.reflectivity.value=i.reflectivity,r.refractionRatio.value=i.refractionRatio;const a=t.get(o).__maxMipLevel;void 0!==a&&(r.maxMipLevel.value=a)}let a,l;i.lightMap&&(r.lightMap.value=i.lightMap,r.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity),i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.roughnessMap?a=i.roughnessMap:i.metalnessMap?a=i.metalnessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap?a=i.emissiveMap:i.clearcoatMap?a=i.clearcoatMap:i.clearcoatNormalMap?a=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(a=i.clearcoatRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),r.uvTransform.value.copy(a.matrix)),i.aoMap?l=i.aoMap:i.lightMap&&(l=i.lightMap),void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),!0===l.matrixAutoUpdate&&l.updateMatrix(),r.uv2Transform.value.copy(l.matrix))}function refreshUniformsStandard(r,i){r.roughness.value=i.roughness,r.metalness.value=i.metalness,i.roughnessMap&&(r.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(r.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap),i.bumpMap&&(r.bumpMap.value=i.bumpMap,r.bumpScale.value=i.bumpScale,i.side===P&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,r.normalScale.value.copy(i.normalScale),i.side===P&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias);t.get(i).envMap&&(r.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function refreshFogUniforms(t,r){t.fogColor.value.copy(r.color),r.isFog?(t.fogNear.value=r.near,t.fogFar.value=r.far):r.isFogExp2&&(t.fogDensity.value=r.density)},refreshMaterialUniforms:function refreshMaterialUniforms(t,r,i,o){r.isMeshBasicMaterial?refreshUniformsCommon(t,r):r.isMeshLambertMaterial?(refreshUniformsCommon(t,r),function refreshUniformsLambert(t,r){r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap)}(t,r)):r.isMeshToonMaterial?(refreshUniformsCommon(t,r),function refreshUniformsToon(t,r){r.gradientMap&&(t.gradientMap.value=r.gradientMap);r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap);r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,r.side===P&&(t.bumpScale.value*=-1));r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),r.side===P&&t.normalScale.value.negate());r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias)}(t,r)):r.isMeshPhongMaterial?(refreshUniformsCommon(t,r),function refreshUniformsPhong(t,r){t.specular.value.copy(r.specular),t.shininess.value=Math.max(r.shininess,1e-4),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap);r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,r.side===P&&(t.bumpScale.value*=-1));r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),r.side===P&&t.normalScale.value.negate());r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias)}(t,r)):r.isMeshStandardMaterial?(refreshUniformsCommon(t,r),r.isMeshPhysicalMaterial?function refreshUniformsPhysical(t,r){refreshUniformsStandard(t,r),t.reflectivity.value=r.reflectivity,t.clearcoat.value=r.clearcoat,t.clearcoatRoughness.value=r.clearcoatRoughness,r.sheen&&t.sheen.value.copy(r.sheen);r.clearcoatMap&&(t.clearcoatMap.value=r.clearcoatMap);r.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=r.clearcoatRoughnessMap);r.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(r.clearcoatNormalScale),t.clearcoatNormalMap.value=r.clearcoatNormalMap,r.side===P&&t.clearcoatNormalScale.value.negate());t.transmission.value=r.transmission,r.transmissionMap&&(t.transmissionMap.value=r.transmissionMap)}(t,r):refreshUniformsStandard(t,r)):r.isMeshMatcapMaterial?(refreshUniformsCommon(t,r),function refreshUniformsMatcap(t,r){r.matcap&&(t.matcap.value=r.matcap);r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,r.side===P&&(t.bumpScale.value*=-1));r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),r.side===P&&t.normalScale.value.negate());r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias)}(t,r)):r.isMeshDepthMaterial?(refreshUniformsCommon(t,r),function refreshUniformsDepth(t,r){r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(refreshUniformsCommon(t,r),function refreshUniformsDistance(t,r){r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);t.referencePosition.value.copy(r.referencePosition),t.nearDistance.value=r.nearDistance,t.farDistance.value=r.farDistance}(t,r)):r.isMeshNormalMaterial?(refreshUniformsCommon(t,r),function refreshUniformsNormal(t,r){r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,r.side===P&&(t.bumpScale.value*=-1));r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),r.side===P&&t.normalScale.value.negate());r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias)}(t,r)):r.isLineBasicMaterial?(!function refreshUniformsLine(t,r){t.diffuse.value.copy(r.color),t.opacity.value=r.opacity}(t,r),r.isLineDashedMaterial&&function refreshUniformsDash(t,r){t.dashSize.value=r.dashSize,t.totalSize.value=r.dashSize+r.gapSize,t.scale.value=r.scale}(t,r)):r.isPointsMaterial?function refreshUniformsPoints(t,r,i,o){t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.size.value=r.size*i,t.scale.value=.5*o,r.map&&(t.map.value=r.map);r.alphaMap&&(t.alphaMap.value=r.alphaMap);let a;r.map?a=r.map:r.alphaMap&&(a=r.alphaMap);void 0!==a&&(!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uvTransform.value.copy(a.matrix))}(t,r,i,o):r.isSpriteMaterial?function refreshUniformsSprites(t,r){t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.rotation.value=r.rotation,r.map&&(t.map.value=r.map);r.alphaMap&&(t.alphaMap.value=r.alphaMap);let i;r.map?i=r.map:r.alphaMap&&(i=r.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function WebGLRenderer(t){const r=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==t.context?t.context:null,o=void 0!==t.alpha&&t.alpha,a=void 0===t.depth||t.depth,l=void 0===t.stencil||t.stencil,h=void 0!==t.antialias&&t.antialias,g=void 0===t.premultipliedAlpha||t.premultipliedAlpha,y=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,_=void 0!==t.powerPreference?t.powerPreference:"default",x=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let w=null,S=null;this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=dn,this.physicallyCorrectLights=!1,this.toneMapping=de,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const M=this;let T=!1,P=null,C=0,A=0,O=null,L=null,I=-1,R=null,j=null;const N=new Vector4,k=new Vector4;let D=null,B=r.width,G=r.height,H=1,V=null,U=null;const z=new Vector4(0,0,B,G),W=new Vector4(0,0,B,G);let q=!1;const $=new Frustum;let X=!1,K=!1;const Y=new Matrix4,Z=new Vector3,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function getTargetPixelRatio(){return null===O?H:1}let J,ee,te,ne,re,ie,oe,ae,se,ce,le,ue,he,pe,fe,me,ge,ve,ye,be,_e,xe=i;function getContext(t,i){for(let o=0;o<t.length;o++){const a=t[o],l=r.getContext(a,i);if(null!==l)return l}return null}try{const t={alpha:o,depth:a,stencil:l,antialias:h,premultipliedAlpha:g,preserveDrawingBuffer:y,powerPreference:_,failIfMajorPerformanceCaveat:x};if(r.addEventListener("webglcontextlost",onContextLost,!1),r.addEventListener("webglcontextrestored",onContextRestore,!1),null===xe){const r=["webgl2","webgl","experimental-webgl"];if(!0===M.isWebGL1Renderer&&r.shift(),xe=getContext(r,t),null===xe)throw getContext(r)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===xe.getShaderPrecisionFormat&&(xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Te){throw console.error("THREE.WebGLRenderer: "+Te.message),Te}function initGLContext(){J=new WebGLExtensions(xe),ee=new WebGLCapabilities(xe,J,t),!1===ee.isWebGL2&&(J.get("WEBGL_depth_texture"),J.get("OES_texture_float"),J.get("OES_texture_half_float"),J.get("OES_texture_half_float_linear"),J.get("OES_standard_derivatives"),J.get("OES_element_index_uint"),J.get("OES_vertex_array_object"),J.get("ANGLE_instanced_arrays")),J.get("OES_texture_float_linear"),be=new WebGLUtils(xe,J,ee),te=new WebGLState(xe,J,ee),te.scissor(k.copy(W).multiplyScalar(H).floor()),te.viewport(N.copy(z).multiplyScalar(H).floor()),ne=new WebGLInfo(xe),re=new WebGLProperties,ie=new WebGLTextures(xe,J,te,re,ee,be,ne),oe=new WebGLCubeMaps(M),ae=new WebGLAttributes(xe,ee),_e=new WebGLBindingStates(xe,J,ae,ee),se=new WebGLGeometries(xe,ae,ne,_e),ce=new WebGLObjects(xe,se,ae,ne),ge=new WebGLMorphtargets(xe),fe=new WebGLClipping(re),le=new WebGLPrograms(M,oe,J,ee,_e,fe),ue=new WebGLMaterials(re),he=new WebGLRenderLists(re),pe=new WebGLRenderStates(J,ee),me=new WebGLBackground(M,oe,te,ce,g),ve=new WebGLBufferRenderer(xe,J,ne,ee),ye=new WebGLIndexedBufferRenderer(xe,J,ne,ee),ne.programs=le.programs,M.capabilities=ee,M.extensions=J,M.properties=re,M.renderLists=he,M.state=te,M.info=ne}initGLContext();const we=new WebXRManager(M,xe);this.xr=we;const Se=new WebGLShadowMap(M,ce,ee.maxTextureSize);function onContextLost(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),T=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),T=!1,initGLContext()}function onMaterialDispose(t){const r=t.target;r.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(t){releaseMaterialProgramReference(t),re.remove(t)}(r)}function releaseMaterialProgramReference(t){const r=re.get(t).program;void 0!==r&&le.releaseProgram(r)}this.shadowMap=Se,this.getContext=function(){return xe},this.getContextAttributes=function(){return xe.getContextAttributes()},this.forceContextLoss=function(){const t=J.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=J.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(t){void 0!==t&&(H=t,this.setSize(B,G,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Vector2),t.set(B,G)},this.setSize=function(t,i,o){we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=t,G=i,r.width=Math.floor(t*H),r.height=Math.floor(i*H),!1!==o&&(r.style.width=t+"px",r.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Vector2),t.set(B*H,G*H).floor()},this.setDrawingBufferSize=function(t,i,o){B=t,G=i,H=o,r.width=Math.floor(t*o),r.height=Math.floor(i*o),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Vector4),t.copy(N)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,r,i,o){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,r,i,o),te.viewport(N.copy(z).multiplyScalar(H).floor())},this.getScissor=function(t){return t.copy(W)},this.setScissor=function(t,r,i,o){t.isVector4?W.set(t.x,t.y,t.z,t.w):W.set(t,r,i,o),te.scissor(k.copy(W).multiplyScalar(H).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(t){te.setScissorTest(q=t)},this.setOpaqueSort=function(t){V=t},this.setTransparentSort=function(t){U=t},this.getClearColor=function(){return me.getClearColor()},this.setClearColor=function(){me.setClearColor.apply(me,arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha.apply(me,arguments)},this.clear=function(t,r,i){let o=0;(void 0===t||t)&&(o|=16384),(void 0===r||r)&&(o|=256),(void 0===i||i)&&(o|=1024),xe.clear(o)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",onContextLost,!1),r.removeEventListener("webglcontextrestored",onContextRestore,!1),he.dispose(),pe.dispose(),re.dispose(),oe.dispose(),ce.dispose(),_e.dispose(),we.dispose(),Ee.stop()},this.renderBufferImmediate=function(t,r){_e.initAttributes();const i=re.get(t);t.hasPositions&&!i.position&&(i.position=xe.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=xe.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=xe.createBuffer()),t.hasColors&&!i.color&&(i.color=xe.createBuffer());const o=r.getAttributes();t.hasPositions&&(xe.bindBuffer(34962,i.position),xe.bufferData(34962,t.positionArray,35048),_e.enableAttribute(o.position),xe.vertexAttribPointer(o.position,3,5126,!1,0,0)),t.hasNormals&&(xe.bindBuffer(34962,i.normal),xe.bufferData(34962,t.normalArray,35048),_e.enableAttribute(o.normal),xe.vertexAttribPointer(o.normal,3,5126,!1,0,0)),t.hasUvs&&(xe.bindBuffer(34962,i.uv),xe.bufferData(34962,t.uvArray,35048),_e.enableAttribute(o.uv),xe.vertexAttribPointer(o.uv,2,5126,!1,0,0)),t.hasColors&&(xe.bindBuffer(34962,i.color),xe.bufferData(34962,t.colorArray,35048),_e.enableAttribute(o.color),xe.vertexAttribPointer(o.color,3,5126,!1,0,0)),_e.disableUnusedAttributes(),xe.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,r,i,o,a,l){null===r&&(r=Q);const h=a.isMesh&&a.matrixWorld.determinant()<0,g=setProgram(t,r,o,a);te.setMaterial(o,h);let y=i.index;const _=i.attributes.position;if(null===y){if(void 0===_||0===_.count)return}else if(0===y.count)return;let x,w=1;!0===o.wireframe&&(y=se.getWireframeAttribute(i),w=2),(o.morphTargets||o.morphNormals)&&ge.update(a,i,o,g),_e.setup(a,o,g,i,y);let S=ve;null!==y&&(x=ae.get(y),S=ye,S.setIndex(x));const M=null!==y?y.count:_.count,T=i.drawRange.start*w,P=i.drawRange.count*w,C=null!==l?l.start*w:0,A=null!==l?l.count*w:1/0,O=Math.max(T,C),L=Math.min(M,T+P,C+A)-1,I=Math.max(0,L-O+1);if(0!==I){if(a.isMesh)!0===o.wireframe?(te.setLineWidth(o.wireframeLinewidth*getTargetPixelRatio()),S.setMode(1)):S.setMode(4);else if(a.isLine){let t=o.linewidth;void 0===t&&(t=1),te.setLineWidth(t*getTargetPixelRatio()),a.isLineSegments?S.setMode(1):a.isLineLoop?S.setMode(2):S.setMode(3)}else a.isPoints?S.setMode(0):a.isSprite&&S.setMode(4);if(a.isInstancedMesh)S.renderInstances(O,I,a.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);S.renderInstances(O,I,t)}else S.render(O,I)}},this.compile=function(t,r){S=pe.get(t,r),S.init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(r.layers)&&(S.pushLight(t),t.castShadow&&S.pushShadow(t))})),S.setupLights(r);const i=new WeakMap;t.traverse((function(r){const o=r.material;if(o)if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=o[a];!1===i.has(l)&&(initMaterial(l,t,r),i.set(l))}else!1===i.has(o)&&(initMaterial(o,t,r),i.set(o))}))};let Me=null;const Ee=new WebGLAnimation;function projectObject(t,r,i,o){if(!1===t.visible)return;if(t.layers.test(r.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(r);else if(t.isLight)S.pushLight(t),t.castShadow&&S.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||$.intersectsSprite(t)){o&&Z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Y);const r=ce.update(t),a=t.material;a.visible&&w.push(t,r,a,i,Z.z,null)}}else if(t.isImmediateRenderObject)o&&Z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Y),w.push(t,null,t.material,i,Z.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==ne.render.frame&&(t.skeleton.update(),t.skeleton.frame=ne.render.frame),!t.frustumCulled||$.intersectsObject(t))){o&&Z.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Y);const r=ce.update(t),a=t.material;if(Array.isArray(a)){const o=r.groups;for(let l=0,h=o.length;l<h;l++){const h=o[l],g=a[h.materialIndex];g&&g.visible&&w.push(t,r,g,i,Z.z,h)}}else a.visible&&w.push(t,r,a,i,Z.z,null)}const a=t.children;for(let l=0,h=a.length;l<h;l++)projectObject(a[l],r,i,o)}function renderObjects(t,r,i){const o=!0===r.isScene?r.overrideMaterial:null;for(let a=0,l=t.length;a<l;a++){const l=t[a],h=l.object,g=l.geometry,y=null===o?l.material:o,_=l.group;if(i.isArrayCamera){j=i;const t=i.cameras;for(let i=0,o=t.length;i<o;i++){const o=t[i];h.layers.test(o.layers)&&(te.viewport(N.copy(o.viewport)),S.setupLights(o),renderObject(h,r,o,g,y,_))}}else j=null,renderObject(h,r,i,g,y,_)}}function renderObject(t,r,i,o,a,l){if(t.onBeforeRender(M,r,i,o,a,l),S=pe.get(r,j||i),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const o=setProgram(i,r,a,t);te.setMaterial(a),_e.reset(),function renderObjectImmediate(t,r){t.render((function(t){M.renderBufferImmediate(t,r)}))}(t,o)}else M.renderBufferDirect(i,r,o,a,t,l);t.onAfterRender(M,r,i,o,a,l),S=pe.get(r,j||i)}function initMaterial(t,r,i){!0!==r.isScene&&(r=Q);const o=re.get(t),a=S.state.lights,l=S.state.shadowsArray,h=a.state.version,g=le.getParameters(t,a.state,l,r,i),y=le.getProgramCacheKey(g);let _=o.program,x=!0;if(void 0===_)t.addEventListener("dispose",onMaterialDispose);else if(_.cacheKey!==y)releaseMaterialProgramReference(t);else if(o.lightsStateVersion!==h)x=!1;else{if(void 0!==g.shaderID){const i=t.isMeshStandardMaterial?r.environment:null;return void(o.envMap=oe.get(t.envMap||i))}x=!1}x&&(g.uniforms=le.getUniforms(t),t.onBeforeCompile(g,M),_=le.acquireProgram(g,y),o.program=_,o.uniforms=g.uniforms,o.outputEncoding=g.outputEncoding);const w=o.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(o.numClippingPlanes=fe.numPlanes,o.numIntersection=fe.numIntersection,w.clippingPlanes=fe.uniform),o.environment=t.isMeshStandardMaterial?r.environment:null,o.fog=r.fog,o.envMap=oe.get(t.envMap||o.environment),o.needsLights=function materialNeedsLights(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),o.lightsStateVersion=h,o.needsLights&&(w.ambientLightColor.value=a.state.ambient,w.lightProbe.value=a.state.probe,w.directionalLights.value=a.state.directional,w.directionalLightShadows.value=a.state.directionalShadow,w.spotLights.value=a.state.spot,w.spotLightShadows.value=a.state.spotShadow,w.rectAreaLights.value=a.state.rectArea,w.ltc_1.value=a.state.rectAreaLTC1,w.ltc_2.value=a.state.rectAreaLTC2,w.pointLights.value=a.state.point,w.pointLightShadows.value=a.state.pointShadow,w.hemisphereLights.value=a.state.hemi,w.directionalShadowMap.value=a.state.directionalShadowMap,w.directionalShadowMatrix.value=a.state.directionalShadowMatrix,w.spotShadowMap.value=a.state.spotShadowMap,w.spotShadowMatrix.value=a.state.spotShadowMatrix,w.pointShadowMap.value=a.state.pointShadowMap,w.pointShadowMatrix.value=a.state.pointShadowMatrix);const T=o.program.getUniforms(),P=WebGLUniforms.seqWithValue(T.seq,w);o.uniformsList=P}function setProgram(t,r,i,o){!0!==r.isScene&&(r=Q),ie.resetTextureUnits();const a=r.fog,l=i.isMeshStandardMaterial?r.environment:null,h=null===O?M.outputEncoding:O.texture.encoding,g=oe.get(i.envMap||l),y=re.get(i),_=S.state.lights;if(!0===X&&(!0===K||t!==R)){const r=t===R&&i.id===I;fe.setState(i,t,r)}i.version===y.__version?i.fog&&y.fog!==a||y.environment!==l||y.needsLights&&y.lightsStateVersion!==_.state.version?initMaterial(i,r,o):void 0===y.numClippingPlanes||y.numClippingPlanes===fe.numPlanes&&y.numIntersection===fe.numIntersection?(y.outputEncoding!==h||y.envMap!==g)&&initMaterial(i,r,o):initMaterial(i,r,o):(initMaterial(i,r,o),y.__version=i.version);let x=!1,w=!1,T=!1;const P=y.program,C=P.getUniforms(),A=y.uniforms;if(te.useProgram(P.program)&&(x=!0,w=!0,T=!0),i.id!==I&&(I=i.id,w=!0),x||R!==t){if(C.setValue(xe,"projectionMatrix",t.projectionMatrix),ee.logarithmicDepthBuffer&&C.setValue(xe,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),R!==t&&(R=t,w=!0,T=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const r=C.map.cameraPosition;void 0!==r&&r.setValue(xe,Z.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&C.setValue(xe,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&C.setValue(xe,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){C.setOptional(xe,o,"bindMatrix"),C.setOptional(xe,o,"bindMatrixInverse");const t=o.skeleton;if(t){const r=t.bones;if(ee.floatVertexTextures){if(void 0===t.boneTexture){let i=Math.sqrt(4*r.length);i=Qn.ceilPowerOfTwo(i),i=Math.max(i,4);const o=new Float32Array(i*i*4);o.set(t.boneMatrices);const a=new DataTexture(o,i,i,Ze,Ue);t.boneMatrices=o,t.boneTexture=a,t.boneTextureSize=i}C.setValue(xe,"boneTexture",t.boneTexture,ie),C.setValue(xe,"boneTextureSize",t.boneTextureSize)}else C.setOptional(xe,t,"boneMatrices")}}return(w||y.receiveShadow!==o.receiveShadow)&&(y.receiveShadow=o.receiveShadow,C.setValue(xe,"receiveShadow",o.receiveShadow)),w&&(C.setValue(xe,"toneMappingExposure",M.toneMappingExposure),y.needsLights&&function markUniformsLightsNeedsUpdate(t,r){t.ambientLightColor.needsUpdate=r,t.lightProbe.needsUpdate=r,t.directionalLights.needsUpdate=r,t.directionalLightShadows.needsUpdate=r,t.pointLights.needsUpdate=r,t.pointLightShadows.needsUpdate=r,t.spotLights.needsUpdate=r,t.spotLightShadows.needsUpdate=r,t.rectAreaLights.needsUpdate=r,t.hemisphereLights.needsUpdate=r}(A,T),a&&i.fog&&ue.refreshFogUniforms(A,a),ue.refreshMaterialUniforms(A,i,H,G),WebGLUniforms.upload(xe,y.uniformsList,A,ie)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(xe,y.uniformsList,A,ie),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&C.setValue(xe,"center",o.center),C.setValue(xe,"modelViewMatrix",o.modelViewMatrix),C.setValue(xe,"normalMatrix",o.normalMatrix),C.setValue(xe,"modelMatrix",o.matrixWorld),P}Ee.setAnimationLoop((function onAnimationFrame(t){we.isPresenting||Me&&Me(t)})),"undefined"!=typeof window&&Ee.setContext(window),this.setAnimationLoop=function(t){Me=t,we.setAnimationLoop(t),null===t?Ee.stop():Ee.start()},this.render=function(t,r){let i,o;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),o=arguments[3]),void 0!==r&&!0!==r.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===T)return;_e.resetDefaultState(),I=-1,R=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(r=we.getCamera(r)),!0===t.isScene&&t.onBeforeRender(M,t,r,i||O),S=pe.get(t,r),S.init(),Y.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),$.setFromProjectionMatrix(Y),K=this.localClippingEnabled,X=fe.init(this.clippingPlanes,K,r),w=he.get(t,r),w.init(),projectObject(t,r,0,M.sortObjects),w.finish(),!0===M.sortObjects&&w.sort(V,U),!0===X&&fe.beginShadows();const a=S.state.shadowsArray;Se.render(a,t,r),S.setupLights(r),!0===X&&fe.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),me.render(w,t,r,o);const l=w.opaque,h=w.transparent;l.length>0&&renderObjects(l,t,r),h.length>0&&renderObjects(h,t,r),!0===t.isScene&&t.onAfterRender(M,t,r),null!==O&&(ie.updateRenderTargetMipmap(O),ie.updateMultisampleRenderTarget(O)),te.buffers.depth.setTest(!0),te.buffers.depth.setMask(!0),te.buffers.color.setMask(!0),te.setPolygonOffset(!1),w=null,S=null},this.setFramebuffer=function(t){P!==t&&null===O&&xe.bindFramebuffer(36160,t),P=t},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return A},this.getRenderList=function(){return w},this.setRenderList=function(t){w=t},this.getRenderState=function(){return S},this.setRenderState=function(t){S=t},this.getRenderTarget=function(){return O},this.setRenderTarget=function(t,r=0,i=0){O=t,C=r,A=i,t&&void 0===re.get(t).__webglFramebuffer&&ie.setupRenderTarget(t);let o=P,a=!1;if(t){const i=re.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(o=i[r],a=!0):o=t.isWebGLMultisampleRenderTarget?re.get(t).__webglMultisampledFramebuffer:i,N.copy(t.viewport),k.copy(t.scissor),D=t.scissorTest}else N.copy(z).multiplyScalar(H).floor(),k.copy(W).multiplyScalar(H).floor(),D=q;if(L!==o&&(xe.bindFramebuffer(36160,o),L=o),te.viewport(N),te.scissor(k),te.setScissorTest(D),a){const o=re.get(t.texture);xe.framebufferTexture2D(36160,36064,34069+r,o.__webglTexture,i)}},this.readRenderTargetPixels=function(t,r,i,o,a,l,h){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let g=re.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==h&&(g=g[h]),g){let h=!1;g!==L&&(xe.bindFramebuffer(36160,g),h=!0);try{const g=t.texture,y=g.format,_=g.type;if(y!==Ze&&be.convert(y)!==xe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(_===De||be.convert(_)===xe.getParameter(35738)||_===Ue&&(ee.isWebGL2||J.get("OES_texture_float")||J.get("WEBGL_color_buffer_float"))||_===ze&&(ee.isWebGL2?J.get("EXT_color_buffer_float"):J.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===xe.checkFramebufferStatus(36160)?r>=0&&r<=t.width-o&&i>=0&&i<=t.height-a&&xe.readPixels(r,i,o,a,be.convert(y),be.convert(_),l):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{h&&xe.bindFramebuffer(36160,L)}}},this.copyFramebufferToTexture=function(t,r,i){void 0===i&&(i=0);const o=Math.pow(2,-i),a=Math.floor(r.image.width*o),l=Math.floor(r.image.height*o),h=be.convert(r.format);ie.setTexture2D(r,0),xe.copyTexImage2D(3553,i,h,t.x,t.y,a,l,0),te.unbindTexture()},this.copyTextureToTexture=function(t,r,i,o){void 0===o&&(o=0);const a=r.image.width,l=r.image.height,h=be.convert(i.format),g=be.convert(i.type);ie.setTexture2D(i,0),xe.pixelStorei(37440,i.flipY),xe.pixelStorei(37441,i.premultiplyAlpha),xe.pixelStorei(3317,i.unpackAlignment),r.isDataTexture?xe.texSubImage2D(3553,o,t.x,t.y,a,l,h,g,r.image.data):r.isCompressedTexture?xe.compressedTexSubImage2D(3553,o,t.x,t.y,r.mipmaps[0].width,r.mipmaps[0].height,h,r.mipmaps[0].data):xe.texSubImage2D(3553,o,t.x,t.y,h,g,r.image),0===o&&i.generateMipmaps&&xe.generateMipmap(3553),te.unbindTexture()},this.initTexture=function(t){ie.setTexture2D(t,0),te.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function WebGL1Renderer(t){WebGLRenderer.call(this,t)}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){if(null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,r,i){let o=null,a=null,l=null;const h=this._targetRay,g=this._grip,y=this._hand;if(t)if(y&&t.hand){l=!0;for(let o=0;o<=window.XRHand.LITTLE_PHALANX_TIP;o++)if(t.hand[o]){const a=r.getJointPose(t.hand[o],i),l=y.joints[o];null!==a&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.jointRadius=a.radius),l.visible=null!==a;const h=y.joints[window.XRHand.INDEX_PHALANX_TIP],g=y.joints[window.XRHand.THUMB_PHALANX_TIP],_=h.position.distanceTo(g.position),x=.02,w=.005;y.inputState.pinching&&_>x+w?(y.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!y.inputState.pinching&&_<=x-w&&(y.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==h&&(o=r.getPose(t.targetRaySpace,i),null!==o&&(h.matrix.fromArray(o.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale))),null!==g&&t.gripSpace&&(a=r.getPose(t.gripSpace,i),null!==a&&(g.matrix.fromArray(a.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale)));return null!==h&&(h.visible=null!==o),null!==g&&(g.visible=null!==a),null!==y&&(y.visible=null!==l),this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),WebGL1Renderer.prototype=Object.assign(Object.create(WebGLRenderer.prototype),{constructor:WebGL1Renderer,isWebGL1Renderer:!0});class FogExp2{constructor(t,r){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Color(t),this.density=void 0!==r?r:25e-5}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(t,r,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Color(t),this.near=void 0!==r?r:1,this.far=void 0!==i?i:1e3}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,r){return super.copy(t,r),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const r=super.toJSON(t);return null!==this.background&&(r.object.background=this.background.toJSON(t)),null!==this.environment&&(r.object.environment=this.environment.toJSON(t)),null!==this.fog&&(r.object.fog=this.fog.toJSON()),r}}function InterleavedBuffer(t,r){this.array=t,this.stride=r,this.count=void 0!==t?t.length/r:0,this.usage=Fn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Qn.generateUUID()}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,r,i){t*=this.stride,i*=r.stride;for(let o=0,a=this.stride;o<a;o++)this.array[t+o]=r.array[i+o];return this},set:function(t,r){return void 0===r&&(r=0),this.array.set(t,r),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const r=new InterleavedBuffer(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return r.setUsage(this.usage),r},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qn.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const io=new Vector3;function InterleavedBufferAttribute(t,r,i,o){this.name="",this.data=t,this.itemSize=r,this.offset=i,this.normalized=!0===o}function SpriteMaterial(t){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let oo;Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let r=0,i=this.data.count;r<i;r++)io.x=this.getX(r),io.y=this.getY(r),io.z=this.getZ(r),io.applyMatrix4(t),this.setXYZ(r,io.x,io.y,io.z);return this},setX:function(t,r){return this.data.array[t*this.data.stride+this.offset]=r,this},setY:function(t,r){return this.data.array[t*this.data.stride+this.offset+1]=r,this},setZ:function(t,r){return this.data.array[t*this.data.stride+this.offset+2]=r,this},setW:function(t,r){return this.data.array[t*this.data.stride+this.offset+3]=r,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=r,this.data.array[t+1]=i,this},setXYZ:function(t,r,i,o){return t=t*this.data.stride+this.offset,this.data.array[t+0]=r,this.data.array[t+1]=i,this.data.array[t+2]=o,this},setXYZW:function(t,r,i,o,a){return t=t*this.data.stride+this.offset,this.data.array[t+0]=r,this.data.array[t+1]=i,this.data.array[t+2]=o,this.data.array[t+3]=a,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new InterleavedBufferAttribute(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const ao=new Vector3,so=new Vector3,co=new Vector3,lo=new Vector2,uo=new Vector2,ho=new Matrix4,po=new Vector3,fo=new Vector3,mo=new Vector3,go=new Vector2,vo=new Vector2,yo=new Vector2;function Sprite(t){if(Object3D.call(this),this.type="Sprite",void 0===oo){oo=new BufferGeometry;const t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);oo.setIndex([0,1,2,0,2,3]),oo.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),oo.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=oo,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(t,r,i,o,a,l){lo.subVectors(t,i).addScalar(.5).multiply(o),void 0!==a?(uo.x=l*lo.x-a*lo.y,uo.y=a*lo.x+l*lo.y):uo.copy(lo),t.copy(r),t.x+=uo.x,t.y+=uo.y,t.applyMatrix4(ho)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(t,r){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),so.setFromMatrixScale(this.matrixWorld),ho.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),co.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&so.multiplyScalar(-co.z);const i=this.material.rotation;let o,a;0!==i&&(a=Math.cos(i),o=Math.sin(i));const l=this.center;transformVertex(po.set(-.5,-.5,0),co,l,so,o,a),transformVertex(fo.set(.5,-.5,0),co,l,so,o,a),transformVertex(mo.set(.5,.5,0),co,l,so,o,a),go.set(0,0),vo.set(1,0),yo.set(1,1);let h=t.ray.intersectTriangle(po,fo,mo,!1,ao);if(null===h&&(transformVertex(fo.set(-.5,.5,0),co,l,so,o,a),vo.set(0,1),h=t.ray.intersectTriangle(po,mo,fo,!1,ao),null===h))return;const g=t.ray.origin.distanceTo(ao);g<t.near||g>t.far||r.push({distance:g,point:ao.clone(),uv:Triangle.getUV(ao,po,fo,mo,go,vo,yo,new Vector2),face:null,object:this})},copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const bo=new Vector3,_o=new Vector3;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function SkinnedMesh(t,r){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,t,r),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(t){Object3D.prototype.copy.call(this,t,!1);const r=t.levels;for(let i=0,o=r.length;i<o;i++){const t=r[i];this.addLevel(t.object.clone(),t.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,r){void 0===r&&(r=0),r=Math.abs(r);const i=this.levels;let o;for(o=0;o<i.length&&!(r<i[o].distance);o++);return i.splice(o,0,{distance:r,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const r=this.levels;if(r.length>0){let i,o;for(i=1,o=r.length;i<o&&!(t<r[i].distance);i++);return r[i-1].object}return null},raycast:function(t,r){if(this.levels.length>0){bo.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(bo);this.getObjectForDistance(i).raycast(t,r)}},update:function(t){const r=this.levels;if(r.length>1){bo.setFromMatrixPosition(t.matrixWorld),_o.setFromMatrixPosition(this.matrixWorld);const i=bo.distanceTo(_o)/t.zoom;let o,a;for(r[0].object.visible=!0,o=1,a=r.length;o<a&&i>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(this._currentLevel=o-1;o<a;o++)r[o].object.visible=!1}},toJSON:function(t){const r=Object3D.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[];const i=this.levels;for(let o=0,a=i.length;o<a;o++){const t=i[o];r.object.levels.push({object:t.object.uuid,distance:t.distance})}return r}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,r){this.skeleton=t,void 0===r&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),r=this.matrixWorld),this.bindMatrix.copy(r),this.bindMatrixInverse.getInverse(r)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new Vector4,r=this.geometry.attributes.skinWeight;for(let i=0,o=r.count;i<o;i++){t.x=r.getX(i),t.y=r.getY(i),t.z=r.getZ(i),t.w=r.getW(i);const o=1/t.manhattanLength();o!==1/0?t.multiplyScalar(o):t.set(1,0,0,0),r.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Mesh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new Vector3,r=new Vector4,i=new Vector4,o=new Vector3,a=new Matrix4;return function(l,h){const g=this.skeleton,y=this.geometry;r.fromBufferAttribute(y.attributes.skinIndex,l),i.fromBufferAttribute(y.attributes.skinWeight,l),t.fromBufferAttribute(y.attributes.position,l).applyMatrix4(this.bindMatrix),h.set(0,0,0);for(let _=0;_<4;_++){const l=i.getComponent(_);if(0!==l){const i=r.getComponent(_);a.multiplyMatrices(g.bones[i].matrixWorld,g.boneInverses[i]),h.addScaledVector(o.copy(t).applyMatrix4(a),l)}}return h.applyMatrix4(this.bindMatrixInverse)}}()});const xo=new Matrix4,wo=new Matrix4;function Skeleton(t,r){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===r)this.calculateInverses();else if(this.bones.length===r.length)this.boneInverses=r.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,r=this.bones.length;t<r;t++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,r=this.bones.length;t<r;t++){const r=new Matrix4;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){for(let t=0,r=this.bones.length;t<r;t++){const r=this.bones[t];r&&r.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,r=this.bones.length;t<r;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.getInverse(r.parent.matrixWorld),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}},update:function(){const t=this.bones,r=this.boneInverses,i=this.boneMatrices,o=this.boneTexture;for(let a=0,l=t.length;a<l;a++){const o=t[a]?t[a].matrixWorld:wo;xo.multiplyMatrices(o,r[a]),xo.toArray(i,16*a)}void 0!==o&&(o.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(t){for(let r=0,i=this.bones.length;r<i;r++){const i=this.bones[r];if(i.name===t)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});const So=new Matrix4,Mo=new Matrix4,Eo=[],To=new Mesh;function InstancedMesh(t,r,i){Mesh.call(this,t,r),this.instanceMatrix=new BufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function LineBasicMaterial(t){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(t){return Mesh.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},setColorAt:function(t,r){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),r.toArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,r){r.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,r){const i=this.matrixWorld,o=this.count;if(To.geometry=this.geometry,To.material=this.material,void 0!==To.material)for(let a=0;a<o;a++){this.getMatrixAt(a,So),Mo.multiplyMatrices(i,So),To.matrixWorld=Mo,To.raycast(t,Eo);for(let t=0,i=Eo.length;t<i;t++){const i=Eo[t];i.instanceId=a,i.object=this,r.push(i)}Eo.length=0}},setMatrixAt:function(t,r){r.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Po=new Vector3,Co=new Vector3,Ao=new Matrix4,Oo=new Ray,Lo=new Sphere;function Line(t,r,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==r?r:new LineBasicMaterial,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const r=t.attributes.position,i=[0];for(let t=1,o=r.count;t<o;t++)Po.fromBufferAttribute(r,t-1),Co.fromBufferAttribute(r,t),i[t]=i[t-1],i[t]+=Po.distanceTo(Co);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const r=t.vertices,i=t.lineDistances;i[0]=0;for(let t=1,o=r.length;t<o;t++)i[t]=i[t-1],i[t]+=r[t-1].distanceTo(r[t])}return this},raycast:function(t,r){const i=this.geometry,o=this.matrixWorld,a=t.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Lo.copy(i.boundingSphere),Lo.applyMatrix4(o),Lo.radius+=a,!1===t.ray.intersectsSphere(Lo))return;Ao.getInverse(o),Oo.copy(t.ray).applyMatrix4(Ao);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l,g=new Vector3,y=new Vector3,_=new Vector3,x=new Vector3,w=this.isLineSegments?2:1;if(i.isBufferGeometry){const o=i.index,a=i.attributes.position;if(null!==o){const i=o.array;for(let o=0,l=i.length-1;o<l;o+=w){const l=i[o],w=i[o+1];g.fromBufferAttribute(a,l),y.fromBufferAttribute(a,w);if(Oo.distanceSqToSegment(g,y,x,_)>h)continue;x.applyMatrix4(this.matrixWorld);const S=t.ray.origin.distanceTo(x);S<t.near||S>t.far||r.push({distance:S,point:_.clone().applyMatrix4(this.matrixWorld),index:o,face:null,faceIndex:null,object:this})}}else for(let i=0,l=a.count-1;i<l;i+=w){g.fromBufferAttribute(a,i),y.fromBufferAttribute(a,i+1);if(Oo.distanceSqToSegment(g,y,x,_)>h)continue;x.applyMatrix4(this.matrixWorld);const o=t.ray.origin.distanceTo(x);o<t.near||o>t.far||r.push({distance:o,point:_.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const o=i.vertices,a=o.length;for(let i=0;i<a-1;i+=w){if(Oo.distanceSqToSegment(o[i],o[i+1],x,_)>h)continue;x.applyMatrix4(this.matrixWorld);const a=t.ray.origin.distanceTo(x);a<t.near||a>t.far||r.push({distance:a,point:_.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const r=t.morphAttributes,i=Object.keys(r);if(i.length>0){const t=r[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++){const i=t[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}else{const r=t.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Io=new Vector3,Ro=new Vector3;function LineSegments(t,r){Line.call(this,t,r),this.type="LineSegments"}function LineLoop(t,r){Line.call(this,t,r),this.type="LineLoop"}function PointsMaterial(t){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const r=t.attributes.position,i=[];for(let t=0,o=r.count;t<o;t+=2)Io.fromBufferAttribute(r,t),Ro.fromBufferAttribute(r,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Io.distanceTo(Ro);t.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const r=t.vertices,i=t.lineDistances;for(let t=0,o=r.length;t<o;t+=2)Io.copy(r[t]),Ro.copy(r[t+1]),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Io.distanceTo(Ro)}return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const jo=new Matrix4,No=new Ray,ko=new Sphere,Do=new Vector3;function Points(t,r){Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==r?r:new PointsMaterial,this.updateMorphTargets()}function testPoint(t,r,i,o,a,l,h){const g=No.distanceSqToPoint(t);if(g<i){const i=new Vector3;No.closestPointToPoint(t,i),i.applyMatrix4(o);const y=a.ray.origin.distanceTo(i);if(y<a.near||y>a.far)return;l.push({distance:y,distanceToRay:Math.sqrt(g),point:i,index:r,face:null,object:h})}}function VideoTexture(t,r,i,o,a,l,h,g,y){Texture.call(this,t,r,i,o,a,l,h,g,y),this.format=void 0!==h?h:Ye,this.minFilter=void 0!==l?l:Ie,this.magFilter=void 0!==a?a:Ie,this.generateMipmaps=!1;const _=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function updateVideo(){_.needsUpdate=!0,t.requestVideoFrameCallback(updateVideo)}))}function CompressedTexture(t,r,i,o,a,l,h,g,y,_,x,w){Texture.call(this,null,l,h,g,y,_,o,a,x,w),this.image={width:r,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(t,r,i,o,a,l,h,g,y){Texture.call(this,t,r,i,o,a,l,h,g,y),this.needsUpdate=!0}function DepthTexture(t,r,i,o,a,l,h,g,y,_){if((_=void 0!==_?_:tt)!==tt&&_!==nt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&_===tt&&(i=Ge),void 0===i&&_===nt&&(i=Xe),Texture.call(this,null,o,a,l,h,g,_,i,y),this.image={width:t,height:r},this.magFilter=void 0!==h?h:Pe,this.minFilter=void 0!==g?g:Pe,this.flipY=!1,this.generateMipmaps=!1}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,r){const i=this.geometry,o=this.matrixWorld,a=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),ko.copy(i.boundingSphere),ko.applyMatrix4(o),ko.radius+=a,!1===t.ray.intersectsSphere(ko))return;jo.getInverse(o),No.copy(t.ray).applyMatrix4(jo);const l=a/((this.scale.x+this.scale.y+this.scale.z)/3),h=l*l;if(i.isBufferGeometry){const a=i.index,l=i.attributes.position;if(null!==a){const i=a.array;for(let a=0,g=i.length;a<g;a++){const g=i[a];Do.fromBufferAttribute(l,g),testPoint(Do,g,h,o,t,r,this)}}else for(let i=0,g=l.count;i<g;i++)Do.fromBufferAttribute(l,i),testPoint(Do,i,h,o,t,r,this)}else{const a=i.vertices;for(let i=0,l=a.length;i<l;i++)testPoint(a[i],i,h,o,t,r,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const r=t.morphAttributes,i=Object.keys(r);if(i.length>0){const t=r[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,i=t.length;r<i;r++){const i=t[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}else{const r=t.morphTargets;void 0!==r&&r.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;let Bo=0;const Fo=new Matrix4,Go=new Object3D,Ho=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:Bo+=2}),this.uuid=Qn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(t){const r=(new Matrix3).getNormalMatrix(t);for(let i=0,o=this.vertices.length;i<o;i++){this.vertices[i].applyMatrix4(t)}for(let i=0,o=this.faces.length;i<o;i++){const t=this.faces[i];t.normal.applyMatrix3(r).normalize();for(let i=0,o=t.vertexNormals.length;i<o;i++)t.vertexNormals[i].applyMatrix3(r).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return Fo.makeRotationX(t),this.applyMatrix4(Fo),this},rotateY:function(t){return Fo.makeRotationY(t),this.applyMatrix4(Fo),this},rotateZ:function(t){return Fo.makeRotationZ(t),this.applyMatrix4(Fo),this},translate:function(t,r,i){return Fo.makeTranslation(t,r,i),this.applyMatrix4(Fo),this},scale:function(t,r,i){return Fo.makeScale(t,r,i),this.applyMatrix4(Fo),this},lookAt:function(t){return Go.lookAt(t),Go.updateMatrix(),this.applyMatrix4(Go.matrix),this},fromBufferGeometry:function(t){const r=this,i=null!==t.index?t.index:void 0,o=t.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const a=o.position,l=o.normal,h=o.color,g=o.uv,y=o.uv2;void 0!==y&&(this.faceVertexUvs[1]=[]);for(let x=0;x<a.count;x++)r.vertices.push((new Vector3).fromBufferAttribute(a,x)),void 0!==h&&r.colors.push((new Color).fromBufferAttribute(h,x));function addFace(t,i,o,a){const _=void 0===h?[]:[r.colors[t].clone(),r.colors[i].clone(),r.colors[o].clone()],x=void 0===l?[]:[(new Vector3).fromBufferAttribute(l,t),(new Vector3).fromBufferAttribute(l,i),(new Vector3).fromBufferAttribute(l,o)],w=new Face3(t,i,o,x,_,a);r.faces.push(w),void 0!==g&&r.faceVertexUvs[0].push([(new Vector2).fromBufferAttribute(g,t),(new Vector2).fromBufferAttribute(g,i),(new Vector2).fromBufferAttribute(g,o)]),void 0!==y&&r.faceVertexUvs[1].push([(new Vector2).fromBufferAttribute(y,t),(new Vector2).fromBufferAttribute(y,i),(new Vector2).fromBufferAttribute(y,o)])}const _=t.groups;if(_.length>0)for(let x=0;x<_.length;x++){const t=_[x],r=t.start;for(let o=r,a=r+t.count;o<a;o+=3)void 0!==i?addFace(i.getX(o),i.getX(o+1),i.getX(o+2),t.materialIndex):addFace(o,o+1,o+2,t.materialIndex)}else if(void 0!==i)for(let x=0;x<i.count;x+=3)addFace(i.getX(x),i.getX(x+1),i.getX(x+2));else for(let x=0;x<a.count;x+=3)addFace(x,x+1,x+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ho).negate(),this.translate(Ho.x,Ho.y,Ho.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,r=this.boundingSphere.radius,i=0===r?1:1/r,o=new Matrix4;return o.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(o),this},computeFaceNormals:function(){const t=new Vector3,r=new Vector3;for(let i=0,o=this.faces.length;i<o;i++){const o=this.faces[i],a=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c];t.subVectors(h,l),r.subVectors(a,l),t.cross(r),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const r=new Array(this.vertices.length);for(let i=0,o=this.vertices.length;i<o;i++)r[i]=new Vector3;if(t){const t=new Vector3,i=new Vector3;for(let o=0,a=this.faces.length;o<a;o++){const a=this.faces[o],l=this.vertices[a.a],h=this.vertices[a.b],g=this.vertices[a.c];t.subVectors(g,h),i.subVectors(l,h),t.cross(i),r[a.a].add(t),r[a.b].add(t),r[a.c].add(t)}}else{this.computeFaceNormals();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];r[i.a].add(i.normal),r[i.b].add(i.normal),r[i.c].add(i.normal)}}for(let i=0,o=this.vertices.length;i<o;i++)r[i].normalize();for(let i=0,o=this.faces.length;i<o;i++){const t=this.faces[i],o=t.vertexNormals;3===o.length?(o[0].copy(r[t.a]),o[1].copy(r[t.b]),o[2].copy(r[t.c])):(o[0]=r[t.a].clone(),o[1]=r[t.b].clone(),o[2]=r[t.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,r=this.faces.length;t<r;t++){const r=this.faces[t],i=r.vertexNormals;3===i.length?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let r=0,i=this.faces.length;r<i;r++){const t=this.faces[r];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let r=0,i=t.vertexNormals.length;r<i;r++)t.__originalVertexNormals[r]?t.__originalVertexNormals[r].copy(t.vertexNormals[r]):t.__originalVertexNormals[r]=t.vertexNormals[r].clone()}const t=new Geometry;t.faces=this.faces;for(let r=0,i=this.morphTargets.length;r<i;r++){if(!this.morphNormals[r]){this.morphNormals[r]={},this.morphNormals[r].faceNormals=[],this.morphNormals[r].vertexNormals=[];const t=this.morphNormals[r].faceNormals,i=this.morphNormals[r].vertexNormals;for(let r=0,o=this.faces.length;r<o;r++){const r=new Vector3,o={a:new Vector3,b:new Vector3,c:new Vector3};t.push(r),i.push(o)}}const i=this.morphNormals[r];t.vertices=this.morphTargets[r].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,r=this.faces.length;t<r;t++){const r=this.faces[t],o=i.faceNormals[t],a=i.vertexNormals[t];o.copy(r.normal),a.a.copy(r.vertexNormals[0]),a.b.copy(r.vertexNormals[1]),a.c.copy(r.vertexNormals[2])}}for(let r=0,i=this.faces.length;r<i;r++){const t=this.faces[r];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,r,i){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let o;const a=this.vertices.length,l=this.vertices,h=t.vertices,g=this.faces,y=t.faces,_=this.colors,x=t.colors;void 0===i&&(i=0),void 0!==r&&(o=(new Matrix3).getNormalMatrix(r));for(let w=0,S=h.length;w<S;w++){const t=h[w].clone();void 0!==r&&t.applyMatrix4(r),l.push(t)}for(let w=0,S=x.length;w<S;w++)_.push(x[w].clone());for(let w=0,S=y.length;w<S;w++){const t=y[w];let r,l;const h=t.vertexNormals,_=t.vertexColors,x=new Face3(t.a+a,t.b+a,t.c+a);x.normal.copy(t.normal),void 0!==o&&x.normal.applyMatrix3(o).normalize();for(let i=0,a=h.length;i<a;i++)r=h[i].clone(),void 0!==o&&r.applyMatrix3(o).normalize(),x.vertexNormals.push(r);x.color.copy(t.color);for(let i=0,o=_.length;i<o;i++)l=_[i],x.vertexColors.push(l.clone());x.materialIndex=t.materialIndex+i,g.push(x)}for(let w=0,S=t.faceVertexUvs.length;w<S;w++){const r=t.faceVertexUvs[w];void 0===this.faceVertexUvs[w]&&(this.faceVertexUvs[w]=[]);for(let t=0,i=r.length;t<i;t++){const i=r[t],o=[];for(let t=0,r=i.length;t<r;t++)o.push(i[t].clone());this.faceVertexUvs[w].push(o)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},r=[],i=[],o=Math.pow(10,4);for(let h=0,g=this.vertices.length;h<g;h++){const a=this.vertices[h],l=Math.round(a.x*o)+"_"+Math.round(a.y*o)+"_"+Math.round(a.z*o);void 0===t[l]?(t[l]=h,r.push(this.vertices[h]),i[h]=r.length-1):i[h]=i[t[l]]}const a=[];for(let h=0,g=this.faces.length;h<g;h++){const t=this.faces[h];t.a=i[t.a],t.b=i[t.b],t.c=i[t.c];const r=[t.a,t.b,t.c];for(let i=0;i<3;i++)if(r[i]===r[(i+1)%3]){a.push(h);break}}for(let h=a.length-1;h>=0;h--){const t=a[h];this.faces.splice(t,1);for(let r=0,i=this.faceVertexUvs.length;r<i;r++)this.faceVertexUvs[r].splice(t,1)}const l=this.vertices.length-r.length;return this.vertices=r,l},setFromPoints:function(t){this.vertices=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];this.vertices.push(new Vector3(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,r=t.length;for(let h=0;h<r;h++)t[h]._id=h;t.sort((function materialIndexSort(t,r){return t.materialIndex-r.materialIndex}));const i=this.faceVertexUvs[0],o=this.faceVertexUvs[1];let a,l;i&&i.length===r&&(a=[]),o&&o.length===r&&(l=[]);for(let h=0;h<r;h++){const r=t[h]._id;a&&a.push(i[r]),l&&l.push(o[r])}a&&(this.faceVertexUvs[0]=a),l&&(this.faceVertexUvs[1]=l)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const r=this.parameters;for(const i in r)void 0!==r[i]&&(t[i]=r[i]);return t}const r=[];for(let _=0;_<this.vertices.length;_++){const t=this.vertices[_];r.push(t.x,t.y,t.z)}const i=[],o=[],a={},l=[],h={},g=[],y={};for(let _=0;_<this.faces.length;_++){const t=this.faces[_],r=!0,o=!1,a=void 0!==this.faceVertexUvs[0][_],l=t.normal.length()>0,h=t.vertexNormals.length>0,g=1!==t.color.r||1!==t.color.g||1!==t.color.b,y=t.vertexColors.length>0;let x=0;if(x=setBit(x,0,0),x=setBit(x,1,r),x=setBit(x,2,o),x=setBit(x,3,a),x=setBit(x,4,l),x=setBit(x,5,h),x=setBit(x,6,g),x=setBit(x,7,y),i.push(x),i.push(t.a,t.b,t.c),i.push(t.materialIndex),a){const t=this.faceVertexUvs[0][_];i.push(getUvIndex(t[0]),getUvIndex(t[1]),getUvIndex(t[2]))}if(l&&i.push(getNormalIndex(t.normal)),h){const r=t.vertexNormals;i.push(getNormalIndex(r[0]),getNormalIndex(r[1]),getNormalIndex(r[2]))}if(g&&i.push(getColorIndex(t.color)),y){const r=t.vertexColors;i.push(getColorIndex(r[0]),getColorIndex(r[1]),getColorIndex(r[2]))}}function setBit(t,r,i){return i?t|1<<r:t&~(1<<r)}function getNormalIndex(t){const r=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==a[r]||(a[r]=o.length/3,o.push(t.x,t.y,t.z)),a[r]}function getColorIndex(t){const r=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==h[r]||(h[r]=l.length,l.push(t.getHex())),h[r]}function getUvIndex(t){const r=t.x.toString()+t.y.toString();return void 0!==y[r]||(y[r]=g.length/2,g.push(t.x,t.y)),y[r]}return t.data={},t.data.vertices=r,t.data.normals=o,l.length>0&&(t.data.colors=l),g.length>0&&(t.data.uvs=[g]),t.data.faces=i,t},clone:function(){return(new Geometry).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const r=t.vertices;for(let w=0,S=r.length;w<S;w++)this.vertices.push(r[w].clone());const i=t.colors;for(let w=0,S=i.length;w<S;w++)this.colors.push(i[w].clone());const o=t.faces;for(let w=0,S=o.length;w<S;w++)this.faces.push(o[w].clone());for(let w=0,S=t.faceVertexUvs.length;w<S;w++){const r=t.faceVertexUvs[w];void 0===this.faceVertexUvs[w]&&(this.faceVertexUvs[w]=[]);for(let t=0,i=r.length;t<i;t++){const i=r[t],o=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];o.push(r.clone())}this.faceVertexUvs[w].push(o)}}const a=t.morphTargets;for(let w=0,S=a.length;w<S;w++){const t={};if(t.name=a[w].name,void 0!==a[w].vertices){t.vertices=[];for(let r=0,i=a[w].vertices.length;r<i;r++)t.vertices.push(a[w].vertices[r].clone())}if(void 0!==a[w].normals){t.normals=[];for(let r=0,i=a[w].normals.length;r<i;r++)t.normals.push(a[w].normals[r].clone())}this.morphTargets.push(t)}const l=t.morphNormals;for(let w=0,S=l.length;w<S;w++){const t={};if(void 0!==l[w].vertexNormals){t.vertexNormals=[];for(let r=0,i=l[w].vertexNormals.length;r<i;r++){const i=l[w].vertexNormals[r],o={};o.a=i.a.clone(),o.b=i.b.clone(),o.c=i.c.clone(),t.vertexNormals.push(o)}}if(void 0!==l[w].faceNormals){t.faceNormals=[];for(let r=0,i=l[w].faceNormals.length;r<i;r++)t.faceNormals.push(l[w].faceNormals[r].clone())}this.morphNormals.push(t)}const h=t.skinWeights;for(let w=0,S=h.length;w<S;w++)this.skinWeights.push(h[w].clone());const g=t.skinIndices;for(let w=0,S=g.length;w<S;w++)this.skinIndices.push(g[w].clone());const y=t.lineDistances;for(let w=0,S=y.length;w<S;w++)this.lineDistances.push(y[w]);const _=t.boundingBox;null!==_&&(this.boundingBox=_.clone());const x=t.boundingSphere;return null!==x&&(this.boundingSphere=x.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry{constructor(t,r,i,o,a,l){super(),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:i,widthSegments:o,heightSegments:a,depthSegments:l},this.fromBufferGeometry(new BoxBufferGeometry(t,r,i,o,a,l)),this.mergeVertices()}}class CircleBufferGeometry extends BufferGeometry{constructor(t,r,i,o){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:r,thetaStart:i,thetaLength:o},t=t||1,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI;const a=[],l=[],h=[],g=[],y=new Vector3,_=new Vector2;l.push(0,0,0),h.push(0,0,1),g.push(.5,.5);for(let x=0,w=3;x<=r;x++,w+=3){const a=i+x/r*o;y.x=t*Math.cos(a),y.y=t*Math.sin(a),l.push(y.x,y.y,y.z),h.push(0,0,1),_.x=(l[w]/t+1)/2,_.y=(l[w+1]/t+1)/2,g.push(_.x,_.y)}for(let x=1;x<=r;x++)a.push(x,x+1,0);this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}}class CircleGeometry extends Geometry{constructor(t,r,i,o){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new CircleBufferGeometry(t,r,i,o)),this.mergeVertices()}}class CylinderBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a,l,h,g){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:i,radialSegments:o,heightSegments:a,openEnded:l,thetaStart:h,thetaLength:g};const y=this;t=void 0!==t?t:1,r=void 0!==r?r:1,i=i||1,o=Math.floor(o)||8,a=Math.floor(a)||1,l=void 0!==l&&l,h=void 0!==h?h:0,g=void 0!==g?g:2*Math.PI;const _=[],x=[],w=[],S=[];let M=0;const T=[],P=i/2;let C=0;function generateCap(i){const a=M,l=new Vector2,T=new Vector3;let A=0;const O=!0===i?t:r,L=!0===i?1:-1;for(let t=1;t<=o;t++)x.push(0,P*L,0),w.push(0,L,0),S.push(.5,.5),M++;const I=M;for(let t=0;t<=o;t++){const r=t/o*g+h,i=Math.cos(r),a=Math.sin(r);T.x=O*a,T.y=P*L,T.z=O*i,x.push(T.x,T.y,T.z),w.push(0,L,0),l.x=.5*i+.5,l.y=.5*a*L+.5,S.push(l.x,l.y),M++}for(let t=0;t<o;t++){const r=a+t,o=I+t;!0===i?_.push(o,o+1,r):_.push(o+1,o,r),A+=3}y.addGroup(C,A,!0===i?1:2),C+=A}!function generateTorso(){const l=new Vector3,A=new Vector3;let O=0;const L=(r-t)/i;for(let y=0;y<=a;y++){const _=[],C=y/a,O=C*(r-t)+t;for(let t=0;t<=o;t++){const r=t/o,a=r*g+h,y=Math.sin(a),T=Math.cos(a);A.x=O*y,A.y=-C*i+P,A.z=O*T,x.push(A.x,A.y,A.z),l.set(y,L,T).normalize(),w.push(l.x,l.y,l.z),S.push(r,1-C),_.push(M++)}T.push(_)}for(let t=0;t<o;t++)for(let r=0;r<a;r++){const i=T[r][t],o=T[r+1][t],a=T[r+1][t+1],l=T[r][t+1];_.push(i,o,l),_.push(o,a,l),O+=6}y.addGroup(C,O,0),C+=O}(),!1===l&&(t>0&&generateCap(!0),r>0&&generateCap(!1)),this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(x,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}}class CylinderGeometry extends Geometry{constructor(t,r,i,o,a,l,h,g){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:i,radialSegments:o,heightSegments:a,openEnded:l,thetaStart:h,thetaLength:g},this.fromBufferGeometry(new CylinderBufferGeometry(t,r,i,o,a,l,h,g)),this.mergeVertices()}}class ConeGeometry extends CylinderGeometry{constructor(t,r,i,o,a,l,h){super(0,t,r,i,o,a,l,h),this.type="ConeGeometry",this.parameters={radius:t,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:h}}}class ConeBufferGeometry extends CylinderBufferGeometry{constructor(t,r,i,o,a,l,h){super(0,t,r,i,o,a,l,h),this.type="ConeBufferGeometry",this.parameters={radius:t,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:h}}}class PolyhedronBufferGeometry extends BufferGeometry{constructor(t,r,i,o){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:r,radius:i,detail:o},i=i||1;const a=[],l=[];function subdivideFace(t,r,i,o){const a=o+1,l=[];for(let h=0;h<=a;h++){l[h]=[];const o=t.clone().lerp(i,h/a),g=r.clone().lerp(i,h/a),y=a-h;for(let t=0;t<=y;t++)l[h][t]=0===t&&h===a?o:o.clone().lerp(g,t/y)}for(let h=0;h<a;h++)for(let t=0;t<2*(a-h)-1;t++){const r=Math.floor(t/2);t%2==0?(pushVertex(l[h][r+1]),pushVertex(l[h+1][r]),pushVertex(l[h][r])):(pushVertex(l[h][r+1]),pushVertex(l[h+1][r+1]),pushVertex(l[h+1][r]))}}function pushVertex(t){a.push(t.x,t.y,t.z)}function getVertexByIndex(r,i){const o=3*r;i.x=t[o+0],i.y=t[o+1],i.z=t[o+2]}function correctUV(t,r,i,o){o<0&&1===t.x&&(l[r]=t.x-1),0===i.x&&0===i.z&&(l[r]=o/2/Math.PI+.5)}function azimuth(t){return Math.atan2(t.z,-t.x)}!function subdivide(t){const i=new Vector3,o=new Vector3,a=new Vector3;for(let l=0;l<r.length;l+=3)getVertexByIndex(r[l+0],i),getVertexByIndex(r[l+1],o),getVertexByIndex(r[l+2],a),subdivideFace(i,o,a,t)}(o=o||0),function applyRadius(t){const r=new Vector3;for(let i=0;i<a.length;i+=3)r.x=a[i+0],r.y=a[i+1],r.z=a[i+2],r.normalize().multiplyScalar(t),a[i+0]=r.x,a[i+1]=r.y,a[i+2]=r.z}(i),function generateUVs(){const t=new Vector3;for(let i=0;i<a.length;i+=3){t.x=a[i+0],t.y=a[i+1],t.z=a[i+2];const o=azimuth(t)/2/Math.PI+.5,h=(r=t,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);l.push(o,1-h)}var r;(function correctUVs(){const t=new Vector3,r=new Vector3,i=new Vector3,o=new Vector3,h=new Vector2,g=new Vector2,y=new Vector2;for(let _=0,x=0;_<a.length;_+=9,x+=6){t.set(a[_+0],a[_+1],a[_+2]),r.set(a[_+3],a[_+4],a[_+5]),i.set(a[_+6],a[_+7],a[_+8]),h.set(l[x+0],l[x+1]),g.set(l[x+2],l[x+3]),y.set(l[x+4],l[x+5]),o.copy(t).add(r).add(i).divideScalar(3);const w=azimuth(o);correctUV(h,x+0,t,w),correctUV(g,x+2,r,w),correctUV(y,x+4,i,w)}})(),function correctSeam(){for(let t=0;t<l.length;t+=6){const r=l[t+0],i=l[t+2],o=l[t+4],a=Math.max(r,i,o),h=Math.min(r,i,o);a>.9&&h<.1&&(r<.2&&(l[t+0]+=1),i<.2&&(l[t+2]+=1),o<.2&&(l[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(a.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t,r){const i=(1+Math.sqrt(5))/2,o=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,r),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:r}}}class DodecahedronGeometry extends Geometry{constructor(t,r){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:r},this.fromBufferGeometry(new DodecahedronBufferGeometry(t,r)),this.mergeVertices()}}const Vo=new Vector3,Uo=new Vector3,zo=new Vector3,Wo=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(t,r){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:r},r=void 0!==r?r:1,t.isGeometry&&(t=(new BufferGeometry).fromGeometry(t));const i=Math.pow(10,4),o=Math.cos(Qn.DEG2RAD*r),a=t.getIndex(),l=t.getAttribute("position"),h=a?a.count:l.count,g=[0,0,0],y=["a","b","c"],_=new Array(3),x={},w=[];for(let S=0;S<h;S+=3){a?(g[0]=a.getX(S),g[1]=a.getX(S+1),g[2]=a.getX(S+2)):(g[0]=S,g[1]=S+1,g[2]=S+2);const{a:t,b:r,c:h}=Wo;if(t.fromBufferAttribute(l,g[0]),r.fromBufferAttribute(l,g[1]),h.fromBufferAttribute(l,g[2]),Wo.getNormal(zo),_[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,_[1]=`${Math.round(r.x*i)},${Math.round(r.y*i)},${Math.round(r.z*i)}`,_[2]=`${Math.round(h.x*i)},${Math.round(h.y*i)},${Math.round(h.z*i)}`,_[0]!==_[1]&&_[1]!==_[2]&&_[2]!==_[0])for(let i=0;i<3;i++){const t=(i+1)%3,r=_[i],a=_[t],l=Wo[y[i]],h=Wo[y[t]],S=`${r}_${a}`,M=`${a}_${r}`;M in x&&x[M]?(zo.dot(x[M].normal)<=o&&(w.push(l.x,l.y,l.z),w.push(h.x,h.y,h.z)),x[M]=null):S in x||(x[S]={index0:g[i],index1:g[t],normal:zo.clone()})}}for(const S in x)if(x[S]){const{index0:t,index1:r}=x[S];Vo.fromBufferAttribute(l,t),Uo.fromBufferAttribute(l,r),w.push(Vo.x,Vo.y,Vo.z),w.push(Uo.x,Uo.y,Uo.z)}this.setAttribute("position",new Float32BufferAttribute(w,3))}}const Earcut_triangulate=function(t,r,i){i=i||2;const o=r&&r.length,a=o?r[0]*i:t.length;let l=linkedList(t,0,a,i,!0);const h=[];if(!l||l.next===l.prev)return h;let g,y,_,x,w,S,M;if(o&&(l=function eliminateHoles(t,r,i,o){const a=[];let l,h,g,y,_;for(l=0,h=r.length;l<h;l++)g=r[l]*o,y=l<h-1?r[l+1]*o:t.length,_=linkedList(t,g,y,o,!1),_===_.next&&(_.steiner=!0),a.push(getLeftmost(_));for(a.sort(compareX),l=0;l<a.length;l++)eliminateHole(a[l],i),i=filterPoints(i,i.next);return i}(t,r,l,i)),t.length>80*i){g=_=t[0],y=x=t[1];for(let r=i;r<a;r+=i)w=t[r],S=t[r+1],w<g&&(g=w),S<y&&(y=S),w>_&&(_=w),S>x&&(x=S);M=Math.max(_-g,x-y),M=0!==M?1/M:0}return earcutLinked(l,h,i,g,y,M),h};function linkedList(t,r,i,o,a){let l,h;if(a===function signedArea(t,r,i,o){let a=0;for(let l=r,h=i-o;l<i;l+=o)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}(t,r,i,o)>0)for(l=r;l<i;l+=o)h=insertNode(l,t[l],t[l+1],h);else for(l=i-o;l>=r;l-=o)h=insertNode(l,t[l],t[l+1],h);return h&&equals(h,h.next)&&(removeNode(h),h=h.next),h}function filterPoints(t,r){if(!t)return t;r||(r=t);let i,o=t;do{if(i=!1,o.steiner||!equals(o,o.next)&&0!==area(o.prev,o,o.next))o=o.next;else{if(removeNode(o),o=r=o.prev,o===o.next)break;i=!0}}while(i||o!==r);return r}function earcutLinked(t,r,i,o,a,l,h){if(!t)return;!h&&l&&function indexCurve(t,r,i,o){let a=t;do{null===a.z&&(a.z=zOrder(a.x,a.y,r,i,o)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(t){let r,i,o,a,l,h,g,y,_=1;do{for(i=t,t=null,l=null,h=0;i;){for(h++,o=i,g=0,r=0;r<_&&(g++,o=o.nextZ,o);r++);for(y=_;g>0||y>0&&o;)0!==g&&(0===y||!o||i.z<=o.z)?(a=i,i=i.nextZ,g--):(a=o,o=o.nextZ,y--),l?l.nextZ=a:t=a,a.prevZ=l,l=a;i=o}l.nextZ=null,_*=2}while(h>1);return t}(a)}(t,o,a,l);let g,y,_=t;for(;t.prev!==t.next;)if(g=t.prev,y=t.next,l?isEarHashed(t,o,a,l):isEar(t))r.push(g.i/i),r.push(t.i/i),r.push(y.i/i),removeNode(t),t=y.next,_=y.next;else if((t=y)===_){h?1===h?earcutLinked(t=cureLocalIntersections(filterPoints(t),r,i),r,i,o,a,l,2):2===h&&splitEarcut(t,r,i,o,a,l):earcutLinked(filterPoints(t),r,i,o,a,l,1);break}}function isEar(t){const r=t.prev,i=t,o=t.next;if(area(r,i,o)>=0)return!1;let a=t.next.next;for(;a!==t.prev;){if(pointInTriangle(r.x,r.y,i.x,i.y,o.x,o.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(t,r,i,o){const a=t.prev,l=t,h=t.next;if(area(a,l,h)>=0)return!1;const g=a.x<l.x?a.x<h.x?a.x:h.x:l.x<h.x?l.x:h.x,y=a.y<l.y?a.y<h.y?a.y:h.y:l.y<h.y?l.y:h.y,_=a.x>l.x?a.x>h.x?a.x:h.x:l.x>h.x?l.x:h.x,x=a.y>l.y?a.y>h.y?a.y:h.y:l.y>h.y?l.y:h.y,w=zOrder(g,y,r,i,o),S=zOrder(_,x,r,i,o);let M=t.prevZ,T=t.nextZ;for(;M&&M.z>=w&&T&&T.z<=S;){if(M!==t.prev&&M!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;if(M=M.prevZ,T!==t.prev&&T!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&area(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;M&&M.z>=w;){if(M!==t.prev&&M!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;T&&T.z<=S;){if(T!==t.prev&&T!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&area(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function cureLocalIntersections(t,r,i){let o=t;do{const a=o.prev,l=o.next.next;!equals(a,l)&&intersects(a,o,o.next,l)&&locallyInside(a,l)&&locallyInside(l,a)&&(r.push(a.i/i),r.push(o.i/i),r.push(l.i/i),removeNode(o),removeNode(o.next),o=t=l),o=o.next}while(o!==t);return filterPoints(o)}function splitEarcut(t,r,i,o,a,l){let h=t;do{let t=h.next.next;for(;t!==h.prev;){if(h.i!==t.i&&isValidDiagonal(h,t)){let g=splitPolygon(h,t);return h=filterPoints(h,h.next),g=filterPoints(g,g.next),earcutLinked(h,r,i,o,a,l),void earcutLinked(g,r,i,o,a,l)}t=t.next}h=h.next}while(h!==t)}function compareX(t,r){return t.x-r.x}function eliminateHole(t,r){if(r=function findHoleBridge(t,r){let i=r;const o=t.x,a=t.y;let l,h=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=o&&t>h){if(h=t,t===o){if(a===i.y)return i;if(a===i.next.y)return i.next}l=i.x<i.next.x?i:i.next}}i=i.next}while(i!==r);if(!l)return null;if(o===h)return l;const g=l,y=l.x,_=l.y;let x,w=1/0;i=l;do{o>=i.x&&i.x>=y&&o!==i.x&&pointInTriangle(a<_?o:h,a,y,_,a<_?h:o,a,i.x,i.y)&&(x=Math.abs(a-i.y)/(o-i.x),locallyInside(i,t)&&(x<w||x===w&&(i.x>l.x||i.x===l.x&&sectorContainsSector(l,i)))&&(l=i,w=x)),i=i.next}while(i!==g);return l}(t,r)){const i=splitPolygon(r,t);filterPoints(r,r.next),filterPoints(i,i.next)}}function sectorContainsSector(t,r){return area(t.prev,t,r.prev)<0&&area(r.next,t,t.next)<0}function zOrder(t,r,i,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)*a)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function getLeftmost(t){let r=t,i=t;do{(r.x<i.x||r.x===i.x&&r.y<i.y)&&(i=r),r=r.next}while(r!==t);return i}function pointInTriangle(t,r,i,o,a,l,h,g){return(a-h)*(r-g)-(t-h)*(l-g)>=0&&(t-h)*(o-g)-(i-h)*(r-g)>=0&&(i-h)*(l-g)-(a-h)*(o-g)>=0}function isValidDiagonal(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!function intersectsPolygon(t,r){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==r.i&&i.next.i!==r.i&&intersects(i,i.next,t,r))return!0;i=i.next}while(i!==t);return!1}(t,r)&&(locallyInside(t,r)&&locallyInside(r,t)&&function middleInside(t,r){let i=t,o=!1;const a=(t.x+r.x)/2,l=(t.y+r.y)/2;do{i.y>l!=i.next.y>l&&i.next.y!==i.y&&a<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==t);return o}(t,r)&&(area(t.prev,t,r.prev)||area(t,r.prev,r))||equals(t,r)&&area(t.prev,t,t.next)>0&&area(r.prev,r,r.next)>0)}function area(t,r,i){return(r.y-t.y)*(i.x-r.x)-(r.x-t.x)*(i.y-r.y)}function equals(t,r){return t.x===r.x&&t.y===r.y}function intersects(t,r,i,o){const a=sign(area(t,r,i)),l=sign(area(t,r,o)),h=sign(area(i,o,t)),g=sign(area(i,o,r));return a!==l&&h!==g||(!(0!==a||!onSegment(t,i,r))||(!(0!==l||!onSegment(t,o,r))||(!(0!==h||!onSegment(i,t,o))||!(0!==g||!onSegment(i,r,o)))))}function onSegment(t,r,i){return r.x<=Math.max(t.x,i.x)&&r.x>=Math.min(t.x,i.x)&&r.y<=Math.max(t.y,i.y)&&r.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function locallyInside(t,r){return area(t.prev,t,t.next)<0?area(t,r,t.next)>=0&&area(t,t.prev,r)>=0:area(t,r,t.prev)<0||area(t,t.next,r)<0}function splitPolygon(t,r){const i=new Node(t.i,t.x,t.y),o=new Node(r.i,r.x,r.y),a=t.next,l=r.prev;return t.next=r,r.prev=t,i.next=a,a.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function insertNode(t,r,i,o){const a=new Node(t,r,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,r,i){this.i=t,this.x=r,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const qo={area:function(t){const r=t.length;let i=0;for(let o=r-1,a=0;a<r;o=a++)i+=t[o].x*t[a].y-t[a].x*t[o].y;return.5*i},isClockWise:function(t){return qo.area(t)<0},triangulateShape:function(t,r){const i=[],o=[],a=[];removeDupEndPts(t),addContour(i,t);let l=t.length;r.forEach(removeDupEndPts);for(let g=0;g<r.length;g++)o.push(l),l+=r[g].length,addContour(i,r[g]);const h=Earcut_triangulate(i,o);for(let g=0;g<h.length;g+=3)a.push(h.slice(g,g+3));return a}};function removeDupEndPts(t){const r=t.length;r>2&&t[r-1].equals(t[0])&&t.pop()}function addContour(t,r){for(let i=0;i<r.length;i++)t.push(r[i].x),t.push(r[i].y)}class ExtrudeBufferGeometry extends BufferGeometry{constructor(t,r){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:r},t=Array.isArray(t)?t:[t];const i=this,o=[],a=[];for(let l=0,h=t.length;l<h;l++){addShape(t[l])}function addShape(t){const l=[],h=void 0!==r.curveSegments?r.curveSegments:12,g=void 0!==r.steps?r.steps:1;let y=void 0!==r.depth?r.depth:100,_=void 0===r.bevelEnabled||r.bevelEnabled,x=void 0!==r.bevelThickness?r.bevelThickness:6,w=void 0!==r.bevelSize?r.bevelSize:x-2,S=void 0!==r.bevelOffset?r.bevelOffset:0,M=void 0!==r.bevelSegments?r.bevelSegments:3;const T=r.extrudePath,P=void 0!==r.UVGenerator?r.UVGenerator:$o;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=r.amount);let C,A,O,L,I,R=!1;T&&(C=T.getSpacedPoints(g),R=!0,_=!1,A=T.computeFrenetFrames(g,!1),O=new Vector3,L=new Vector3,I=new Vector3),_||(M=0,x=0,w=0,S=0);const j=t.extractPoints(h);let N=j.shape;const k=j.holes;if(!qo.isClockWise(N)){N=N.reverse();for(let t=0,r=k.length;t<r;t++){const r=k[t];qo.isClockWise(r)&&(k[t]=r.reverse())}}const D=qo.triangulateShape(N,k),B=N;for(let r=0,i=k.length;r<i;r++){const t=k[r];N=N.concat(t)}function scalePt2(t,r,i){return r||console.error("THREE.ExtrudeGeometry: vec does not exist"),r.clone().multiplyScalar(i).add(t)}const G=N.length,H=D.length;function getBevelVec(t,r,i){let o,a,l;const h=t.x-r.x,g=t.y-r.y,y=i.x-t.x,_=i.y-t.y,x=h*h+g*g,w=h*_-g*y;if(Math.abs(w)>Number.EPSILON){const w=Math.sqrt(x),S=Math.sqrt(y*y+_*_),M=r.x-g/w,T=r.y+h/w,P=((i.x-_/S-M)*_-(i.y+y/S-T)*y)/(h*_-g*y);o=M+h*P-t.x,a=T+g*P-t.y;const C=o*o+a*a;if(C<=2)return new Vector2(o,a);l=Math.sqrt(C/2)}else{let t=!1;h>Number.EPSILON?y>Number.EPSILON&&(t=!0):h<-Number.EPSILON?y<-Number.EPSILON&&(t=!0):Math.sign(g)===Math.sign(_)&&(t=!0),t?(o=-g,a=h,l=Math.sqrt(x)):(o=h,a=g,l=Math.sqrt(x/2))}return new Vector2(o/l,a/l)}const V=[];for(let r=0,i=B.length,o=i-1,a=r+1;r<i;r++,o++,a++)o===i&&(o=0),a===i&&(a=0),V[r]=getBevelVec(B[r],B[o],B[a]);const U=[];let z,W=V.concat();for(let r=0,i=k.length;r<i;r++){const t=k[r];z=[];for(let r=0,i=t.length,o=i-1,a=r+1;r<i;r++,o++,a++)o===i&&(o=0),a===i&&(a=0),z[r]=getBevelVec(t[r],t[o],t[a]);U.push(z),W=W.concat(z)}for(let r=0;r<M;r++){const t=r/M,i=x*Math.cos(t*Math.PI/2),o=w*Math.sin(t*Math.PI/2)+S;for(let r=0,a=B.length;r<a;r++){const t=scalePt2(B[r],V[r],o);v(t.x,t.y,-i)}for(let r=0,a=k.length;r<a;r++){const t=k[r];z=U[r];for(let r=0,a=t.length;r<a;r++){const a=scalePt2(t[r],z[r],o);v(a.x,a.y,-i)}}}const q=w+S;for(let r=0;r<G;r++){const t=_?scalePt2(N[r],W[r],q):N[r];R?(L.copy(A.normals[0]).multiplyScalar(t.x),O.copy(A.binormals[0]).multiplyScalar(t.y),I.copy(C[0]).add(L).add(O),v(I.x,I.y,I.z)):v(t.x,t.y,0)}for(let r=1;r<=g;r++)for(let t=0;t<G;t++){const i=_?scalePt2(N[t],W[t],q):N[t];R?(L.copy(A.normals[r]).multiplyScalar(i.x),O.copy(A.binormals[r]).multiplyScalar(i.y),I.copy(C[r]).add(L).add(O),v(I.x,I.y,I.z)):v(i.x,i.y,y/g*r)}for(let r=M-1;r>=0;r--){const t=r/M,i=x*Math.cos(t*Math.PI/2),o=w*Math.sin(t*Math.PI/2)+S;for(let r=0,a=B.length;r<a;r++){const t=scalePt2(B[r],V[r],o);v(t.x,t.y,y+i)}for(let r=0,a=k.length;r<a;r++){const t=k[r];z=U[r];for(let r=0,a=t.length;r<a;r++){const a=scalePt2(t[r],z[r],o);R?v(a.x,a.y+C[g-1].y,C[g-1].x+i):v(a.x,a.y,y+i)}}}function sidewalls(t,r){let i=t.length;for(;--i>=0;){const o=i;let a=i-1;a<0&&(a=t.length-1);for(let t=0,i=g+2*M;t<i;t++){const i=G*t,l=G*(t+1);f4(r+o+i,r+a+i,r+a+l,r+o+l)}}}function v(t,r,i){l.push(t),l.push(r),l.push(i)}function f3(t,r,a){addVertex(t),addVertex(r),addVertex(a);const l=o.length/3,h=P.generateTopUV(i,o,l-3,l-2,l-1);addUV(h[0]),addUV(h[1]),addUV(h[2])}function f4(t,r,a,l){addVertex(t),addVertex(r),addVertex(l),addVertex(r),addVertex(a),addVertex(l);const h=o.length/3,g=P.generateSideWallUV(i,o,h-6,h-3,h-2,h-1);addUV(g[0]),addUV(g[1]),addUV(g[3]),addUV(g[1]),addUV(g[2]),addUV(g[3])}function addVertex(t){o.push(l[3*t+0]),o.push(l[3*t+1]),o.push(l[3*t+2])}function addUV(t){a.push(t.x),a.push(t.y)}!function buildLidFaces(){const t=o.length/3;if(_){let t=0,r=G*t;for(let i=0;i<H;i++){const t=D[i];f3(t[2]+r,t[1]+r,t[0]+r)}t=g+2*M,r=G*t;for(let i=0;i<H;i++){const t=D[i];f3(t[0]+r,t[1]+r,t[2]+r)}}else{for(let t=0;t<H;t++){const r=D[t];f3(r[2],r[1],r[0])}for(let t=0;t<H;t++){const r=D[t];f3(r[0]+G*g,r[1]+G*g,r[2]+G*g)}}i.addGroup(t,o.length/3-t,0)}(),function buildSideFaces(){const t=o.length/3;let r=0;sidewalls(B,r),r+=B.length;for(let i=0,o=k.length;i<o;i++){const t=k[i];sidewalls(t,r),r+=t.length}i.addGroup(t,o.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),this.computeVertexNormals()}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return function toJSON(t,r,i){if(i.shapes=[],Array.isArray(t))for(let o=0,a=t.length;o<a;o++){const r=t[o];i.shapes.push(r.uuid)}else i.shapes.push(t.uuid);void 0!==r.extrudePath&&(i.options.extrudePath=r.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}}const $o={generateTopUV:function(t,r,i,o,a){const l=r[3*i],h=r[3*i+1],g=r[3*o],y=r[3*o+1],_=r[3*a],x=r[3*a+1];return[new Vector2(l,h),new Vector2(g,y),new Vector2(_,x)]},generateSideWallUV:function(t,r,i,o,a,l){const h=r[3*i],g=r[3*i+1],y=r[3*i+2],_=r[3*o],x=r[3*o+1],w=r[3*o+2],S=r[3*a],M=r[3*a+1],T=r[3*a+2],P=r[3*l],C=r[3*l+1],A=r[3*l+2];return Math.abs(g-x)<.01?[new Vector2(h,1-y),new Vector2(_,1-w),new Vector2(S,1-T),new Vector2(P,1-A)]:[new Vector2(g,1-y),new Vector2(x,1-w),new Vector2(M,1-T),new Vector2(C,1-A)]}};class ExtrudeGeometry extends Geometry{constructor(t,r){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:r},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,r)),this.mergeVertices()}toJSON(){const t=super.toJSON();return function toJSON$1(t,r,i){if(i.shapes=[],Array.isArray(t))for(let o=0,a=t.length;o<a;o++){const r=t[o];i.shapes.push(r.uuid)}else i.shapes.push(t.uuid);void 0!==r.extrudePath&&(i.options.extrudePath=r.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}}class IcosahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t,r){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,r),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:r}}}class IcosahedronGeometry extends Geometry{constructor(t,r){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:r},this.fromBufferGeometry(new IcosahedronBufferGeometry(t,r)),this.mergeVertices()}}class LatheBufferGeometry extends BufferGeometry{constructor(t,r,i,o){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:r,phiStart:i,phiLength:o},r=Math.floor(r)||12,i=i||0,o=o||2*Math.PI,o=Qn.clamp(o,0,2*Math.PI);const a=[],l=[],h=[],g=1/r,y=new Vector3,_=new Vector2;for(let x=0;x<=r;x++){const a=i+x*g*o,w=Math.sin(a),S=Math.cos(a);for(let i=0;i<=t.length-1;i++)y.x=t[i].x*w,y.y=t[i].y,y.z=t[i].x*S,l.push(y.x,y.y,y.z),_.x=x/r,_.y=i/(t.length-1),h.push(_.x,_.y)}for(let x=0;x<r;x++)for(let r=0;r<t.length-1;r++){const i=r+x*t.length,o=i,l=i+t.length,h=i+t.length+1,g=i+1;a.push(o,l,g),a.push(l,h,g)}if(this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2)),this.computeVertexNormals(),o===2*Math.PI){const i=this.attributes.normal.array,o=new Vector3,a=new Vector3,l=new Vector3,h=r*t.length*3;for(let r=0,g=0;r<t.length;r++,g+=3)o.x=i[g+0],o.y=i[g+1],o.z=i[g+2],a.x=i[h+g+0],a.y=i[h+g+1],a.z=i[h+g+2],l.addVectors(o,a).normalize(),i[g+0]=i[h+g+0]=l.x,i[g+1]=i[h+g+1]=l.y,i[g+2]=i[h+g+2]=l.z}}}class LatheGeometry extends Geometry{constructor(t,r,i,o){super(),this.type="LatheGeometry",this.parameters={points:t,segments:r,phiStart:i,phiLength:o},this.fromBufferGeometry(new LatheBufferGeometry(t,r,i,o)),this.mergeVertices()}}class OctahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t,r){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,r),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:r}}}class OctahedronGeometry extends Geometry{constructor(t,r){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:r},this.fromBufferGeometry(new OctahedronBufferGeometry(t,r)),this.mergeVertices()}}function ParametricBufferGeometry(t,r,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:r,stacks:i};const o=[],a=[],l=[],h=[],g=1e-5,y=new Vector3,_=new Vector3,x=new Vector3,w=new Vector3,S=new Vector3;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const M=r+1;for(let T=0;T<=i;T++){const o=T/i;for(let i=0;i<=r;i++){const M=i/r;t(M,o,_),a.push(_.x,_.y,_.z),M-g>=0?(t(M-g,o,x),w.subVectors(_,x)):(t(M+g,o,x),w.subVectors(x,_)),o-g>=0?(t(M,o-g,x),S.subVectors(_,x)):(t(M,o+g,x),S.subVectors(x,_)),y.crossVectors(w,S).normalize(),l.push(y.x,y.y,y.z),h.push(M,o)}}for(let T=0;T<i;T++)for(let t=0;t<r;t++){const r=T*M+t,i=T*M+t+1,a=(T+1)*M+t+1,l=(T+1)*M+t;o.push(r,i,l),o.push(i,a,l)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}function ParametricGeometry(t,r,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:r,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(t,r,i)),this.mergeVertices()}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry;class PlaneGeometry extends Geometry{constructor(t,r,i,o){super(),this.type="PlaneGeometry",this.parameters={width:t,height:r,widthSegments:i,heightSegments:o},this.fromBufferGeometry(new PlaneBufferGeometry(t,r,i,o)),this.mergeVertices()}}class PolyhedronGeometry extends Geometry{constructor(t,r,i,o){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:r,radius:i,detail:o},this.fromBufferGeometry(new PolyhedronBufferGeometry(t,r,i,o)),this.mergeVertices()}}class RingBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a,l){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:r,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:l},t=t||.5,r=r||1,a=void 0!==a?a:0,l=void 0!==l?l:2*Math.PI,i=void 0!==i?Math.max(3,i):8;const h=[],g=[],y=[],_=[];let x=t;const w=(r-t)/(o=void 0!==o?Math.max(1,o):1),S=new Vector3,M=new Vector2;for(let T=0;T<=o;T++){for(let t=0;t<=i;t++){const o=a+t/i*l;S.x=x*Math.cos(o),S.y=x*Math.sin(o),g.push(S.x,S.y,S.z),y.push(0,0,1),M.x=(S.x/r+1)/2,M.y=(S.y/r+1)/2,_.push(M.x,M.y)}x+=w}for(let T=0;T<o;T++){const t=T*(i+1);for(let r=0;r<i;r++){const o=r+t,a=o,l=o+i+1,g=o+i+2,y=o+1;h.push(a,l,y),h.push(l,g,y)}}this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(y,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}}class RingGeometry extends Geometry{constructor(t,r,i,o,a,l){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:r,thetaSegments:i,phiSegments:o,thetaStart:a,thetaLength:l},this.fromBufferGeometry(new RingBufferGeometry(t,r,i,o,a,l)),this.mergeVertices()}}class ShapeBufferGeometry extends BufferGeometry{constructor(t,r){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:r},r=r||12;const i=[],o=[],a=[],l=[];let h=0,g=0;if(!1===Array.isArray(t))addShape(t);else for(let y=0;y<t.length;y++)addShape(t[y]),this.addGroup(h,g,y),h+=g,g=0;function addShape(t){const h=o.length/3,y=t.extractPoints(r);let _=y.shape;const x=y.holes;!1===qo.isClockWise(_)&&(_=_.reverse());for(let r=0,i=x.length;r<i;r++){const t=x[r];!0===qo.isClockWise(t)&&(x[r]=t.reverse())}const w=qo.triangulateShape(_,x);for(let r=0,i=x.length;r<i;r++){const t=x[r];_=_.concat(t)}for(let r=0,i=_.length;r<i;r++){const t=_[r];o.push(t.x,t.y,0),a.push(0,0,1),l.push(t.x,t.y)}for(let r=0,o=w.length;r<o;r++){const t=w[r],o=t[0]+h,a=t[1]+h,l=t[2]+h;i.push(o,a,l),g+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return function toJSON$2(t,r){if(r.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const o=t[i];r.shapes.push(o.uuid)}else r.shapes.push(t.uuid);return r}(this.parameters.shapes,t)}}class ShapeGeometry extends Geometry{constructor(t,r){super(),this.type="ShapeGeometry","object"==typeof r&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),r=r.curveSegments),this.parameters={shapes:t,curveSegments:r},this.fromBufferGeometry(new ShapeBufferGeometry(t,r)),this.mergeVertices()}toJSON(){const t=Geometry.prototype.toJSON.call(this);return function toJSON$3(t,r){if(r.shapes=[],Array.isArray(t))for(let i=0,o=t.length;i<o;i++){const o=t[i];r.shapes.push(o.uuid)}else r.shapes.push(t.uuid);return r}(this.parameters.shapes,t)}}class SphereBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a,l,h){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:r,heightSegments:i,phiStart:o,phiLength:a,thetaStart:l,thetaLength:h},t=t||1,r=Math.max(3,Math.floor(r)||8),i=Math.max(2,Math.floor(i)||6),o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,l=void 0!==l?l:0,h=void 0!==h?h:Math.PI;const g=Math.min(l+h,Math.PI);let y=0;const _=[],x=new Vector3,w=new Vector3,S=[],M=[],T=[],P=[];for(let C=0;C<=i;C++){const S=[],A=C/i;let O=0;0==C&&0==l?O=.5/r:C==i&&g==Math.PI&&(O=-.5/r);for(let i=0;i<=r;i++){const g=i/r;x.x=-t*Math.cos(o+g*a)*Math.sin(l+A*h),x.y=t*Math.cos(l+A*h),x.z=t*Math.sin(o+g*a)*Math.sin(l+A*h),M.push(x.x,x.y,x.z),w.copy(x).normalize(),T.push(w.x,w.y,w.z),P.push(g+O,1-A),S.push(y++)}_.push(S)}for(let C=0;C<i;C++)for(let t=0;t<r;t++){const r=_[C][t+1],o=_[C][t],a=_[C+1][t],h=_[C+1][t+1];(0!==C||l>0)&&S.push(r,o,h),(C!==i-1||g<Math.PI)&&S.push(o,a,h)}this.setIndex(S),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(T,3)),this.setAttribute("uv",new Float32BufferAttribute(P,2))}}class SphereGeometry extends Geometry{constructor(t,r,i,o,a,l,h){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:r,heightSegments:i,phiStart:o,phiLength:a,thetaStart:l,thetaLength:h},this.fromBufferGeometry(new SphereBufferGeometry(t,r,i,o,a,l,h)),this.mergeVertices()}}class TetrahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(t,r){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,r),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:r}}}class TetrahedronGeometry extends Geometry{constructor(t,r){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:r},this.fromBufferGeometry(new TetrahedronBufferGeometry(t,r)),this.mergeVertices()}}class TextBufferGeometry extends ExtrudeBufferGeometry{constructor(t,r){const i=(r=r||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new BufferGeometry;const o=i.generateShapes(t,r.size);r.depth=void 0!==r.height?r.height:50,void 0===r.bevelThickness&&(r.bevelThickness=10),void 0===r.bevelSize&&(r.bevelSize=8),void 0===r.bevelEnabled&&(r.bevelEnabled=!1),super(o,r),this.type="TextBufferGeometry"}}class TextGeometry extends Geometry{constructor(t,r){super(),this.type="TextGeometry",this.parameters={text:t,parameters:r},this.fromBufferGeometry(new TextBufferGeometry(t,r)),this.mergeVertices()}}class TorusBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:r,radialSegments:i,tubularSegments:o,arc:a},t=t||1,r=r||.4,i=Math.floor(i)||8,o=Math.floor(o)||6,a=a||2*Math.PI;const l=[],h=[],g=[],y=[],_=new Vector3,x=new Vector3,w=new Vector3;for(let S=0;S<=i;S++)for(let l=0;l<=o;l++){const M=l/o*a,T=S/i*Math.PI*2;x.x=(t+r*Math.cos(T))*Math.cos(M),x.y=(t+r*Math.cos(T))*Math.sin(M),x.z=r*Math.sin(T),h.push(x.x,x.y,x.z),_.x=t*Math.cos(M),_.y=t*Math.sin(M),w.subVectors(x,_).normalize(),g.push(w.x,w.y,w.z),y.push(l/o),y.push(S/i)}for(let S=1;S<=i;S++)for(let t=1;t<=o;t++){const r=(o+1)*S+t-1,i=(o+1)*(S-1)+t-1,a=(o+1)*(S-1)+t,h=(o+1)*S+t;l.push(r,i,h),l.push(i,a,h)}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(g,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}}class TorusGeometry extends Geometry{constructor(t,r,i,o,a){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:r,radialSegments:i,tubularSegments:o,arc:a},this.fromBufferGeometry(new TorusBufferGeometry(t,r,i,o,a)),this.mergeVertices()}}class TorusKnotBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a,l){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:r,tubularSegments:i,radialSegments:o,p:a,q:l},t=t||1,r=r||.4,i=Math.floor(i)||64,o=Math.floor(o)||8,a=a||2,l=l||3;const h=[],g=[],y=[],_=[],x=new Vector3,w=new Vector3,S=new Vector3,M=new Vector3,T=new Vector3,P=new Vector3,C=new Vector3;for(let A=0;A<=i;++A){const h=A/i*a*Math.PI*2;calculatePositionOnCurve(h,a,l,t,S),calculatePositionOnCurve(h+.01,a,l,t,M),P.subVectors(M,S),C.addVectors(M,S),T.crossVectors(P,C),C.crossVectors(T,P),T.normalize(),C.normalize();for(let t=0;t<=o;++t){const a=t/o*Math.PI*2,l=-r*Math.cos(a),h=r*Math.sin(a);x.x=S.x+(l*C.x+h*T.x),x.y=S.y+(l*C.y+h*T.y),x.z=S.z+(l*C.z+h*T.z),g.push(x.x,x.y,x.z),w.subVectors(x,S).normalize(),y.push(w.x,w.y,w.z),_.push(A/i),_.push(t/o)}}for(let A=1;A<=i;A++)for(let t=1;t<=o;t++){const r=(o+1)*(A-1)+(t-1),i=(o+1)*A+(t-1),a=(o+1)*A+t,l=(o+1)*(A-1)+t;h.push(r,i,l),h.push(i,a,l)}function calculatePositionOnCurve(t,r,i,o,a){const l=Math.cos(t),h=Math.sin(t),g=i/r*t,y=Math.cos(g);a.x=o*(2+y)*.5*l,a.y=o*(2+y)*h*.5,a.z=o*Math.sin(g)*.5}this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(y,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}}class TorusKnotGeometry extends Geometry{constructor(t,r,i,o,a,l,h){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:r,tubularSegments:i,radialSegments:o,p:a,q:l},void 0!==h&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(t,r,i,o,a,l)),this.mergeVertices()}}class TubeBufferGeometry extends BufferGeometry{constructor(t,r,i,o,a){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:r,radius:i,radialSegments:o,closed:a},r=r||64,i=i||1,o=o||8,a=a||!1;const l=t.computeFrenetFrames(r,a);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const h=new Vector3,g=new Vector3,y=new Vector2;let _=new Vector3;const x=[],w=[],S=[],M=[];function generateSegment(a){_=t.getPointAt(a/r,_);const y=l.normals[a],S=l.binormals[a];for(let t=0;t<=o;t++){const r=t/o*Math.PI*2,a=Math.sin(r),l=-Math.cos(r);g.x=l*y.x+a*S.x,g.y=l*y.y+a*S.y,g.z=l*y.z+a*S.z,g.normalize(),w.push(g.x,g.y,g.z),h.x=_.x+i*g.x,h.y=_.y+i*g.y,h.z=_.z+i*g.z,x.push(h.x,h.y,h.z)}}!function generateBufferData(){for(let t=0;t<r;t++)generateSegment(t);generateSegment(!1===a?r:0),function generateUVs(){for(let t=0;t<=r;t++)for(let i=0;i<=o;i++)y.x=t/r,y.y=i/o,S.push(y.x,y.y)}(),function generateIndices(){for(let t=1;t<=r;t++)for(let r=1;r<=o;r++){const i=(o+1)*(t-1)+(r-1),a=(o+1)*t+(r-1),l=(o+1)*t+r,h=(o+1)*(t-1)+r;M.push(i,a,h),M.push(a,l,h)}}()}(),this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(x,3)),this.setAttribute("normal",new Float32BufferAttribute(w,3)),this.setAttribute("uv",new Float32BufferAttribute(S,2))}toJSON(){const t=BufferGeometry.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class TubeGeometry extends Geometry{constructor(t,r,i,o,a,l){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:r,radius:i,radialSegments:o,closed:a},void 0!==l&&console.warn("THREE.TubeGeometry: taper has been removed.");const h=new TubeBufferGeometry(t,r,i,o,a);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals,this.fromBufferGeometry(h),this.mergeVertices()}}class WireframeGeometry extends BufferGeometry{constructor(t){super(),this.type="WireframeGeometry";const r=[],i=[0,0],o={},a=["a","b","c"];if(t&&t.isGeometry){const l=t.faces;for(let t=0,r=l.length;t<r;t++){const r=l[t];for(let t=0;t<3;t++){const l=r[a[t]],h=r[a[(t+1)%3]];i[0]=Math.min(l,h),i[1]=Math.max(l,h);const g=i[0]+","+i[1];void 0===o[g]&&(o[g]={index1:i[0],index2:i[1]})}}for(const i in o){const a=o[i];let l=t.vertices[a.index1];r.push(l.x,l.y,l.z),l=t.vertices[a.index2],r.push(l.x,l.y,l.z)}}else if(t&&t.isBufferGeometry){const a=new Vector3;if(null!==t.index){const l=t.attributes.position,h=t.index;let g=t.groups;0===g.length&&(g=[{start:0,count:h.count,materialIndex:0}]);for(let t=0,r=g.length;t<r;++t){const r=g[t],a=r.start;for(let t=a,l=a+r.count;t<l;t+=3)for(let r=0;r<3;r++){const a=h.getX(t+r),l=h.getX(t+(r+1)%3);i[0]=Math.min(a,l),i[1]=Math.max(a,l);const g=i[0]+","+i[1];void 0===o[g]&&(o[g]={index1:i[0],index2:i[1]})}}for(const t in o){const i=o[t];a.fromBufferAttribute(l,i.index1),r.push(a.x,a.y,a.z),a.fromBufferAttribute(l,i.index2),r.push(a.x,a.y,a.z)}}else{const i=t.attributes.position;for(let t=0,o=i.count/3;t<o;t++)for(let l=0;l<3;l++){const o=3*t+l;a.fromBufferAttribute(i,o),r.push(a.x,a.y,a.z);const h=3*t+(l+1)%3;a.fromBufferAttribute(i,h),r.push(a.x,a.y,a.z)}}}this.setAttribute("position",new Float32BufferAttribute(r,3))}}var Xo=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,WireframeGeometry:WireframeGeometry});function ShadowMaterial(t){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}function RawShaderMaterial(t){ShaderMaterial.call(this,t),this.type="RawShaderMaterial"}function MeshStandardMaterial(t){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xn,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function MeshPhysicalMaterial(t){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Qn.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function MeshPhongMaterial(t){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xn,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshToonMaterial(t){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xn,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshNormalMaterial(t){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xn,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshLambertMaterial(t){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ce,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshMatcapMaterial(t){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xn,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LineDashedMaterial(t){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(t){return MeshStandardMaterial.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Color).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(t){return LineBasicMaterial.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Ko=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const Yo={arraySlice:function(t,r,i){return Yo.isTypedArray(t)?new t.constructor(t.subarray(r,void 0!==i?i:t.length)):t.slice(r,i)},convertArray:function(t,r,i){return!t||!i&&t.constructor===r?t:"number"==typeof r.BYTES_PER_ELEMENT?new r(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const r=t.length,i=new Array(r);for(let o=0;o!==r;++o)i[o]=o;return i.sort((function compareTime(r,i){return t[r]-t[i]})),i},sortedArray:function(t,r,i){const o=t.length,a=new t.constructor(o);for(let l=0,h=0;h!==o;++l){const o=i[l]*r;for(let i=0;i!==r;++i)a[h++]=t[o+i]}return a},flattenJSON:function(t,r,i,o){let a=1,l=t[0];for(;void 0!==l&&void 0===l[o];)l=t[a++];if(void 0===l)return;let h=l[o];if(void 0!==h)if(Array.isArray(h))do{h=l[o],void 0!==h&&(r.push(l.time),i.push.apply(i,h)),l=t[a++]}while(void 0!==l);else if(void 0!==h.toArray)do{h=l[o],void 0!==h&&(r.push(l.time),h.toArray(i,i.length)),l=t[a++]}while(void 0!==l);else do{h=l[o],void 0!==h&&(r.push(l.time),i.push(h)),l=t[a++]}while(void 0!==l)},subclip:function(t,r,i,o,a){a=a||30;const l=t.clone();l.name=r;const h=[];for(let y=0;y<l.tracks.length;++y){const t=l.tracks[y],r=t.getValueSize(),g=[],_=[];for(let l=0;l<t.times.length;++l){const h=t.times[l]*a;if(!(h<i||h>=o)){g.push(t.times[l]);for(let i=0;i<r;++i)_.push(t.values[l*r+i])}}0!==g.length&&(t.times=Yo.convertArray(g,t.times.constructor),t.values=Yo.convertArray(_,t.values.constructor),h.push(t))}l.tracks=h;let g=1/0;for(let y=0;y<l.tracks.length;++y)g>l.tracks[y].times[0]&&(g=l.tracks[y].times[0]);for(let y=0;y<l.tracks.length;++y)l.tracks[y].shift(-1*g);return l.resetDuration(),l},makeClipAdditive:function(t,r,i,o){void 0===r&&(r=0),void 0===i&&(i=t),(void 0===o||o<=0)&&(o=30);const a=i.tracks.length,l=r/o;for(let h=0;h<a;++h){const r=i.tracks[h],o=r.ValueTypeName;if("bool"===o||"string"===o)continue;const a=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===o}));if(void 0===a)continue;let g=0;const y=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=y/3);let _=0;const x=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(_=x/3);const w=r.times.length-1;let S;if(l<=r.times[0]){const t=g,i=y-g;S=Yo.arraySlice(r.values,t,i)}else if(l>=r.times[w]){const t=w*y+g,i=t+y-g;S=Yo.arraySlice(r.values,t,i)}else{const t=r.createInterpolant(),i=g,o=y-g;t.evaluate(l),S=Yo.arraySlice(t.resultBuffer,i,o)}if("quaternion"===o){(new Quaternion).fromArray(S).normalize().conjugate().toArray(S)}const M=a.times.length;for(let t=0;t<M;++t){const r=t*x+_;if("quaternion"===o)Quaternion.multiplyQuaternionsFlat(a.values,r,S,0,a.values,r);else{const t=x-2*_;for(let i=0;i<t;++i)a.values[r+i]-=S[i]}}}return t.blendMode=sn,t}};function Interpolant(t,r,i,o){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==o?o:new r.constructor(i),this.sampleValues=r,this.valueSize=i}function CubicInterpolant(t,r,i,o){Interpolant.call(this,t,r,i,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(t,r,i,o){Interpolant.call(this,t,r,i,o)}function DiscreteInterpolant(t,r,i,o){Interpolant.call(this,t,r,i,o)}function KeyframeTrack(t,r,i,o){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===r||0===r.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Yo.convertArray(r,this.TimeBufferType),this.values=Yo.convertArray(i,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}function BooleanKeyframeTrack(t,r,i){KeyframeTrack.call(this,t,r,i)}function ColorKeyframeTrack(t,r,i,o){KeyframeTrack.call(this,t,r,i,o)}function NumberKeyframeTrack(t,r,i,o){KeyframeTrack.call(this,t,r,i,o)}function QuaternionLinearInterpolant(t,r,i,o){Interpolant.call(this,t,r,i,o)}function QuaternionKeyframeTrack(t,r,i,o){KeyframeTrack.call(this,t,r,i,o)}function StringKeyframeTrack(t,r,i,o){KeyframeTrack.call(this,t,r,i,o)}function VectorKeyframeTrack(t,r,i,o){KeyframeTrack.call(this,t,r,i,o)}function AnimationClip(t,r,i,o){this.name=t,this.tracks=i,this.duration=void 0!==r?r:-1,this.blendMode=void 0!==o?o:an,this.uuid=Qn.generateUUID(),this.duration<0&&this.resetDuration()}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const r=[],i=[];Yo.flattenJSON(t.keys,r,i,"value"),t.times=r,t.values=i}return void 0!==r.parse?r.parse(t):new r(t.name,t.times,t.values,t.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){const r=this.parameterPositions;let i=this._cachedIndex,o=r[i],a=r[i-1];e:{t:{let l;n:{r:if(!(t<o)){for(let l=i+2;;){if(void 0===o){if(t<a)break r;return i=r.length,this._cachedIndex=i,this.afterEnd_(i-1,t,a)}if(i===l)break;if(a=o,o=r[++i],t<o)break t}l=r.length;break n}if(t>=a)break e;{const h=r[1];t<h&&(i=2,a=h);for(let l=i-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(i===l)break;if(o=a,a=r[--i-1],t>=a)break t}l=i,i=0}}for(;i<l;){const o=i+l>>>1;t<r[o]?l=o:i=o+1}if(o=r[i],a=r[i-1],void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(void 0===o)return i=r.length,this._cachedIndex=i,this.afterEnd_(i-1,a,t)}this._cachedIndex=i,this.intervalChanged_(i,a,o)}return this.interpolate_(i,a,t,o)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const r=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=t*o;for(let l=0;l!==o;++l)r[l]=i[a+l];return r},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:tn,endingEnd:tn},intervalChanged_:function(t,r,i){const o=this.parameterPositions;let a=t-2,l=t+1,h=o[a],g=o[l];if(void 0===h)switch(this.getSettings_().endingStart){case nn:a=t,h=2*r-i;break;case rn:a=o.length-2,h=r+o[a]-o[a+1];break;default:a=t,h=i}if(void 0===g)switch(this.getSettings_().endingEnd){case nn:l=t,g=2*i-r;break;case rn:l=1,g=i+o[1]-o[0];break;default:l=t-1,g=r}const y=.5*(i-r),_=this.valueSize;this._weightPrev=y/(r-h),this._weightNext=y/(g-i),this._offsetPrev=a*_,this._offsetNext=l*_},interpolate_:function(t,r,i,o){const a=this.resultBuffer,l=this.sampleValues,h=this.valueSize,g=t*h,y=g-h,_=this._offsetPrev,x=this._offsetNext,w=this._weightPrev,S=this._weightNext,M=(i-r)/(o-r),T=M*M,P=T*M,C=-w*P+2*w*T-w*M,A=(1+w)*P+(-1.5-2*w)*T+(-.5+w)*M+1,O=(-1-S)*P+(1.5+S)*T+.5*M,L=S*P-S*T;for(let I=0;I!==h;++I)a[I]=C*l[_+I]+A*l[y+I]+O*l[g+I]+L*l[x+I];return a}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(t,r,i,o){const a=this.resultBuffer,l=this.sampleValues,h=this.valueSize,g=t*h,y=g-h,_=(i-r)/(o-r),x=1-_;for(let w=0;w!==h;++w)a[w]=l[y+w]*x+l[g+w]*_;return a}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(KeyframeTrack,{toJSON:function(t){const r=t.constructor;let i;if(void 0!==r.toJSON)i=r.toJSON(t);else{i={name:t.name,times:Yo.convertArray(t.times,Array),values:Yo.convertArray(t.values,Array)};const r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Jt,InterpolantFactoryMethodDiscrete:function(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let r;switch(t){case Qt:r=this.InterpolantFactoryMethodDiscrete;break;case Jt:r=this.InterpolantFactoryMethodLinear;break;case en:r=this.InterpolantFactoryMethodSmooth}if(void 0===r){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=r,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qt;case this.InterpolantFactoryMethodLinear:return Jt;case this.InterpolantFactoryMethodSmooth:return en}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const r=this.times;for(let i=0,o=r.length;i!==o;++i)r[i]+=t}return this},scale:function(t){if(1!==t){const r=this.times;for(let i=0,o=r.length;i!==o;++i)r[i]*=t}return this},trim:function(t,r){const i=this.times,o=i.length;let a=0,l=o-1;for(;a!==o&&i[a]<t;)++a;for(;-1!==l&&i[l]>r;)--l;if(++l,0!==a||l!==o){a>=l&&(l=Math.max(l,1),a=l-1);const t=this.getValueSize();this.times=Yo.arraySlice(i,a,l),this.values=Yo.arraySlice(this.values,a*t,l*t)}return this},validate:function(){let t=!0;const r=this.getValueSize();r-Math.floor(r)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,o=this.values,a=i.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let l=null;for(let h=0;h!==a;h++){const r=i[h];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,h,r),t=!1;break}if(null!==l&&l>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,h,r,l),t=!1;break}l=r}if(void 0!==o&&Yo.isTypedArray(o))for(let h=0,g=o.length;h!==g;++h){const r=o[h];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,h,r),t=!1;break}}return t},optimize:function(){const t=Yo.arraySlice(this.times),r=Yo.arraySlice(this.values),i=this.getValueSize(),o=this.getInterpolation()===en,a=t.length-1;let l=1;for(let h=1;h<a;++h){let a=!1;const g=t[h];if(g!==t[h+1]&&(1!==h||g!==g[0]))if(o)a=!0;else{const t=h*i,o=t-i,l=t+i;for(let h=0;h!==i;++h){const i=r[t+h];if(i!==r[o+h]||i!==r[l+h]){a=!0;break}}}if(a){if(h!==l){t[l]=t[h];const o=h*i,a=l*i;for(let t=0;t!==i;++t)r[a+t]=r[o+t]}++l}}if(a>0){t[l]=t[a];for(let t=a*i,o=l*i,h=0;h!==i;++h)r[o+h]=r[t+h];++l}return l!==t.length?(this.times=Yo.arraySlice(t,0,l),this.values=Yo.arraySlice(r,0,l*i)):(this.times=t,this.values=r),this},clone:function(){const t=Yo.arraySlice(this.times,0),r=Yo.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,r);return i.createInterpolant=this.createInterpolant,i}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Qt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(t,r,i,o){const a=this.resultBuffer,l=this.sampleValues,h=this.valueSize,g=(i-r)/(o-r);let y=t*h;for(let _=y+h;y!==_;y+=4)Quaternion.slerpFlat(a,0,l,y-h,l,y,g);return a}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:Jt,InterpolantFactoryMethodLinear:function(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Qt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(t){const r=[],i=t.tracks,o=1/(t.fps||1);for(let a=0,l=i.length;a!==l;++a)r.push(parseKeyframeTrack(i[a]).scale(o));return new AnimationClip(t.name,t.duration,r,t.blendMode)},toJSON:function(t){const r=[],i=t.tracks,o={name:t.name,duration:t.duration,tracks:r,uuid:t.uuid,blendMode:t.blendMode};for(let a=0,l=i.length;a!==l;++a)r.push(KeyframeTrack.toJSON(i[a]));return o},CreateFromMorphTargetSequence:function(t,r,i,o){const a=r.length,l=[];for(let h=0;h<a;h++){let t=[],g=[];t.push((h+a-1)%a,h,(h+1)%a),g.push(0,1,0);const y=Yo.getKeyframeOrder(t);t=Yo.sortedArray(t,1,y),g=Yo.sortedArray(g,1,y),o||0!==t[0]||(t.push(a),g.push(g[0])),l.push(new NumberKeyframeTrack(".morphTargetInfluences["+r[h].name+"]",t,g).scale(1/i))}return new AnimationClip(t,-1,l)},findByName:function(t,r){let i=t;if(!Array.isArray(t)){const r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let o=0;o<i.length;o++)if(i[o].name===r)return i[o];return null},CreateClipsFromMorphTargetSequences:function(t,r,i){const o={},a=/^([\w-]*?)([\d]+)$/;for(let h=0,g=t.length;h<g;h++){const r=t[h],i=r.name.match(a);if(i&&i.length>1){const t=i[1];let a=o[t];a||(o[t]=a=[]),a.push(r)}}const l=[];for(const h in o)l.push(AnimationClip.CreateFromMorphTargetSequence(h,o[h],r,i));return l},parseAnimation:function(t,r){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const addNonemptyTrack=function(t,r,i,o,a){if(0!==i.length){const l=[],h=[];Yo.flattenJSON(i,l,h,o),0!==l.length&&a.push(new t(r,l,h))}},i=[],o=t.name||"default",a=t.fps||30,l=t.blendMode;let h=t.length||-1;const g=t.hierarchy||[];for(let y=0;y<g.length;y++){const t=g[y].keys;if(t&&0!==t.length)if(t[0].morphTargets){const r={};let o;for(o=0;o<t.length;o++)if(t[o].morphTargets)for(let i=0;i<t[o].morphTargets.length;i++)r[t[o].morphTargets[i]]=-1;for(const a in r){const r=[],l=[];for(let i=0;i!==t[o].morphTargets.length;++i){const i=t[o];r.push(i.time),l.push(i.morphTarget===a?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+a+"]",r,l))}h=r.length*(a||1)}else{const o=".bones["+r[y].name+"]";addNonemptyTrack(VectorKeyframeTrack,o+".position",t,"pos",i),addNonemptyTrack(QuaternionKeyframeTrack,o+".quaternion",t,"rot",i),addNonemptyTrack(VectorKeyframeTrack,o+".scale",t,"scl",i)}}if(0===i.length)return null;return new AnimationClip(o,h,i,l)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){let t=0;for(let r=0,i=this.tracks.length;r!==i;++r){const i=this.tracks[r];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let r=0;r<this.tracks.length;r++)t=t&&this.tracks[r].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let r=0;r<this.tracks.length;r++)t.push(this.tracks[r].clone());return new AnimationClip(this.name,this.duration,t,this.blendMode)}});const Zo={enabled:!1,files:{},add:function(t,r){!1!==this.enabled&&(this.files[t]=r)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function LoadingManager(t,r,i){const o=this;let a=!1,l=0,h=0,g=void 0;const y=[];this.onStart=void 0,this.onLoad=t,this.onProgress=r,this.onError=i,this.itemStart=function(t){h++,!1===a&&void 0!==o.onStart&&o.onStart(t,l,h),a=!0},this.itemEnd=function(t){l++,void 0!==o.onProgress&&o.onProgress(t,l,h),l===h&&(a=!1,void 0!==o.onLoad&&o.onLoad())},this.itemError=function(t){void 0!==o.onError&&o.onError(t)},this.resolveURL=function(t){return g?g(t):t},this.setURLModifier=function(t){return g=t,this},this.addHandler=function(t,r){return y.push(t,r),this},this.removeHandler=function(t){const r=y.indexOf(t);return-1!==r&&y.splice(r,2),this},this.getHandler=function(t){for(let r=0,i=y.length;r<i;r+=2){const i=y[r],o=y[r+1];if(i.global&&(i.lastIndex=0),i.test(t))return o}return null}}const Qo=new LoadingManager;function Loader(t){this.manager=void 0!==t?t:Qo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(t,r){const i=this;return new Promise((function(o,a){i.load(t,o,r,a)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const Jo={};function FileLoader(t){Loader.call(this,t)}function AnimationLoader(t){Loader.call(this,t)}function CompressedTextureLoader(t){Loader.call(this,t)}function ImageLoader(t){Loader.call(this,t)}function CubeTextureLoader(t){Loader.call(this,t)}function DataTextureLoader(t){Loader.call(this,t)}function TextureLoader(t){Loader.call(this,t)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(t,r,i,o,a,l,h,g){Curve.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=r||0,this.xRadius=i||1,this.yRadius=o||1,this.aStartAngle=a||0,this.aEndAngle=l||2*Math.PI,this.aClockwise=h||!1,this.aRotation=g||0}function ArcCurve(t,r,i,o,a,l){EllipseCurve.call(this,t,r,i,i,o,a,l),this.type="ArcCurve"}function CubicPoly(){let t=0,r=0,i=0,o=0;function init(a,l,h,g){t=a,r=h,i=-3*a+3*l-2*h-g,o=2*a-2*l+h+g}return{initCatmullRom:function(t,r,i,o,a){init(r,i,a*(i-t),a*(o-r))},initNonuniformCatmullRom:function(t,r,i,o,a,l,h){let g=(r-t)/a-(i-t)/(a+l)+(i-r)/l,y=(i-r)/l-(o-r)/(l+h)+(o-i)/h;g*=l,y*=l,init(r,i,g,y)},calc:function(a){const l=a*a;return t+r*a+i*l+o*(l*a)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(t,r,i,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,l=Zo.get(t);if(void 0!==l)return a.manager.itemStart(t),setTimeout((function(){r&&r(l),a.manager.itemEnd(t)}),0),l;if(void 0!==Jo[t])return void Jo[t].push({onLoad:r,onProgress:i,onError:o});const h=t.match(/^data:(.*?)(;base64)?,(.*)$/);let g;if(h){const i=h[1],l=!!h[2];let g=h[3];g=decodeURIComponent(g),l&&(g=atob(g));try{let o;const l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":const t=new Uint8Array(g.length);for(let i=0;i<g.length;i++)t[i]=g.charCodeAt(i);o="blob"===l?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const r=new DOMParser;o=r.parseFromString(g,i);break;case"json":o=JSON.parse(g);break;default:o=g}setTimeout((function(){r&&r(o),a.manager.itemEnd(t)}),0)}catch(y){setTimeout((function(){o&&o(y),a.manager.itemError(t),a.manager.itemEnd(t)}),0)}}else{Jo[t]=[],Jo[t].push({onLoad:r,onProgress:i,onError:o}),g=new XMLHttpRequest,g.open("GET",t,!0),g.addEventListener("load",(function(r){const i=this.response,o=Jo[t];if(delete Jo[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Zo.add(t,i);for(let t=0,r=o.length;t<r;t++){const r=o[t];r.onLoad&&r.onLoad(i)}a.manager.itemEnd(t)}else{for(let t=0,i=o.length;t<i;t++){const i=o[t];i.onError&&i.onError(r)}a.manager.itemError(t),a.manager.itemEnd(t)}}),!1),g.addEventListener("progress",(function(r){const i=Jo[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onProgress&&o.onProgress(r)}}),!1),g.addEventListener("error",(function(r){const i=Jo[t];delete Jo[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onError&&o.onError(r)}a.manager.itemError(t),a.manager.itemEnd(t)}),!1),g.addEventListener("abort",(function(r){const i=Jo[t];delete Jo[t];for(let t=0,o=i.length;t<o;t++){const o=i[t];o.onError&&o.onError(r)}a.manager.itemError(t),a.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)g.setRequestHeader(t,this.requestHeader[t]);g.send(null)}return a.manager.itemStart(t),g},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,r,i,o){const a=this,l=new FileLoader(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(t,(function(i){try{r(a.parse(JSON.parse(i)))}catch(l){o?o(l):console.error(l),a.manager.itemError(t)}}),i,o)},parse:function(t){const r=[];for(let i=0;i<t.length;i++){const o=AnimationClip.parse(t[i]);r.push(o)}return r}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(t,r,i,o){const a=this,l=[],h=new CompressedTexture;h.image=l;const g=new FileLoader(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(a.withCredentials);let y=0;function loadTexture(_){g.load(t[_],(function(t){const i=a.parse(t,!0);l[_]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},y+=1,6===y&&(1===i.mipmapCount&&(h.minFilter=Ie),h.format=i.format,h.needsUpdate=!0,r&&r(h))}),i,o)}if(Array.isArray(t))for(let _=0,x=t.length;_<x;++_)loadTexture(_);else g.load(t,(function(t){const i=a.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let r=0;r<t;r++){l[r]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)l[r].mipmaps.push(i.mipmaps[r*i.mipmapCount+t]),l[r].format=i.format,l[r].width=i.width,l[r].height=i.height}}else h.image.width=i.width,h.image.height=i.height,h.mipmaps=i.mipmaps;1===i.mipmapCount&&(h.minFilter=Ie),h.format=i.format,h.needsUpdate=!0,r&&r(h)}),i,o);return h}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,r,i,o){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,l=Zo.get(t);if(void 0!==l)return a.manager.itemStart(t),setTimeout((function(){r&&r(l),a.manager.itemEnd(t)}),0),l;const h=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){h.removeEventListener("load",onImageLoad,!1),h.removeEventListener("error",onImageError,!1),Zo.add(t,this),r&&r(this),a.manager.itemEnd(t)}function onImageError(r){h.removeEventListener("load",onImageLoad,!1),h.removeEventListener("error",onImageError,!1),o&&o(r),a.manager.itemError(t),a.manager.itemEnd(t)}return h.addEventListener("load",onImageLoad,!1),h.addEventListener("error",onImageError,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(h.crossOrigin=this.crossOrigin),a.manager.itemStart(t),h.src=t,h}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(t,r,i,o){const a=new CubeTexture,l=new ImageLoader(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let h=0;function loadTexture(i){l.load(t[i],(function(t){a.images[i]=t,h++,6===h&&(a.needsUpdate=!0,r&&r(a))}),void 0,o)}for(let g=0;g<t.length;++g)loadTexture(g);return a}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(t,r,i,o){const a=this,l=new DataTexture,h=new FileLoader(this.manager);return h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(a.withCredentials),h.load(t,(function(t){const i=a.parse(t);i&&(void 0!==i.image?l.image=i.image:void 0!==i.data&&(l.image.width=i.width,l.image.height=i.height,l.image.data=i.data),l.wrapS=void 0!==i.wrapS?i.wrapS:Ee,l.wrapT=void 0!==i.wrapT?i.wrapT:Ee,l.magFilter=void 0!==i.magFilter?i.magFilter:Ie,l.minFilter=void 0!==i.minFilter?i.minFilter:Ie,l.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(l.format=i.format),void 0!==i.type&&(l.type=i.type),void 0!==i.mipmaps&&(l.mipmaps=i.mipmaps,l.minFilter=Ne),1===i.mipmapCount&&(l.minFilter=Ie),l.needsUpdate=!0,r&&r(l,i))}),i,o),l}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(t,r,i,o){const a=new Texture,l=new ImageLoader(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(t,(function(i){a.image=i;const o=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);a.format=o?Ye:Ze,a.needsUpdate=!0,void 0!==r&&r(a)}),i,o),a}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,r){const i=this.getUtoTmapping(t);return this.getPoint(i,r)},getPoints:function(t){void 0===t&&(t=5);const r=[];for(let i=0;i<=t;i++)r.push(this.getPoint(i/t));return r},getSpacedPoints:function(t){void 0===t&&(t=5);const r=[];for(let i=0;i<=t;i++)r.push(this.getPointAt(i/t));return r},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const r=[];let i,o=this.getPoint(0),a=0;r.push(0);for(let l=1;l<=t;l++)i=this.getPoint(l/t),a+=i.distanceTo(o),r.push(a),o=i;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,r){const i=this.getLengths();let o=0;const a=i.length;let l;l=r||t*i[a-1];let h,g=0,y=a-1;for(;g<=y;)if(o=Math.floor(g+(y-g)/2),h=i[o]-l,h<0)g=o+1;else{if(!(h>0)){y=o;break}y=o-1}if(o=y,i[o]===l)return o/(a-1);const _=i[o];return(o+(l-_)/(i[o+1]-_))/(a-1)},getTangent:function(t,r){const i=1e-4;let o=t-i,a=t+i;o<0&&(o=0),a>1&&(a=1);const l=this.getPoint(o),h=this.getPoint(a),g=r||(l.isVector2?new Vector2:new Vector3);return g.copy(h).sub(l).normalize(),g},getTangentAt:function(t,r){const i=this.getUtoTmapping(t);return this.getTangent(i,r)},computeFrenetFrames:function(t,r){const i=new Vector3,o=[],a=[],l=[],h=new Vector3,g=new Matrix4;for(let S=0;S<=t;S++){const r=S/t;o[S]=this.getTangentAt(r,new Vector3),o[S].normalize()}a[0]=new Vector3,l[0]=new Vector3;let y=Number.MAX_VALUE;const _=Math.abs(o[0].x),x=Math.abs(o[0].y),w=Math.abs(o[0].z);_<=y&&(y=_,i.set(1,0,0)),x<=y&&(y=x,i.set(0,1,0)),w<=y&&i.set(0,0,1),h.crossVectors(o[0],i).normalize(),a[0].crossVectors(o[0],h),l[0].crossVectors(o[0],a[0]);for(let S=1;S<=t;S++){if(a[S]=a[S-1].clone(),l[S]=l[S-1].clone(),h.crossVectors(o[S-1],o[S]),h.length()>Number.EPSILON){h.normalize();const t=Math.acos(Qn.clamp(o[S-1].dot(o[S]),-1,1));a[S].applyMatrix4(g.makeRotationAxis(h,t))}l[S].crossVectors(o[S],a[S])}if(!0===r){let r=Math.acos(Qn.clamp(a[0].dot(a[t]),-1,1));r/=t,o[0].dot(h.crossVectors(a[0],a[t]))>0&&(r=-r);for(let i=1;i<=t;i++)a[i].applyMatrix4(g.makeRotationAxis(o[i],r*i)),l[i].crossVectors(o[i],a[i])}return{tangents:o,normals:a,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,r){const i=r||new Vector2,o=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const l=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=o;for(;a>o;)a-=o;a<Number.EPSILON&&(a=l?0:o),!0!==this.aClockwise||l||(a===o?a=-o:a-=o);const h=this.aStartAngle+t*a;let g=this.aX+this.xRadius*Math.cos(h),y=this.aY+this.yRadius*Math.sin(h);if(0!==this.aRotation){const t=Math.cos(this.aRotation),r=Math.sin(this.aRotation),i=g-this.aX,o=y-this.aY;g=i*t-o*r+this.aX,y=i*r+o*t+this.aY}return i.set(g,y)},EllipseCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},EllipseCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},EllipseCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;const ea=new Vector3,ta=new CubicPoly,na=new CubicPoly,ra=new CubicPoly;function CatmullRomCurve3(t,r,i,o){Curve.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=r||!1,this.curveType=i||"centripetal",this.tension=void 0!==o?o:.5}function CatmullRom(t,r,i,o,a){const l=.5*(o-r),h=.5*(a-i),g=t*t;return(2*i-2*o+l+h)*(t*g)+(-3*i+3*o-2*l-h)*g+l*t+i}function QuadraticBezier(t,r,i,o){return function QuadraticBezierP0(t,r){const i=1-t;return i*i*r}(t,r)+function QuadraticBezierP1(t,r){return 2*(1-t)*t*r}(t,i)+function QuadraticBezierP2(t,r){return t*t*r}(t,o)}function CubicBezier(t,r,i,o,a){return function CubicBezierP0(t,r){const i=1-t;return i*i*i*r}(t,r)+function CubicBezierP1(t,r){const i=1-t;return 3*i*i*t*r}(t,i)+function CubicBezierP2(t,r){return 3*(1-t)*t*t*r}(t,o)+function CubicBezierP3(t,r){return t*t*t*r}(t,a)}function CubicBezierCurve(t,r,i,o){Curve.call(this),this.type="CubicBezierCurve",this.v0=t||new Vector2,this.v1=r||new Vector2,this.v2=i||new Vector2,this.v3=o||new Vector2}function CubicBezierCurve3(t,r,i,o){Curve.call(this),this.type="CubicBezierCurve3",this.v0=t||new Vector3,this.v1=r||new Vector3,this.v2=i||new Vector3,this.v3=o||new Vector3}function LineCurve(t,r){Curve.call(this),this.type="LineCurve",this.v1=t||new Vector2,this.v2=r||new Vector2}function LineCurve3(t,r){Curve.call(this),this.type="LineCurve3",this.v1=t||new Vector3,this.v2=r||new Vector3}function QuadraticBezierCurve(t,r,i){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Vector2,this.v1=r||new Vector2,this.v2=i||new Vector2}function QuadraticBezierCurve3(t,r,i){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Vector3,this.v1=r||new Vector3,this.v2=i||new Vector3}function SplineCurve(t){Curve.call(this),this.type="SplineCurve",this.points=t||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,r){const i=r||new Vector3,o=this.points,a=o.length,l=(a-(this.closed?0:1))*t;let h,g,y=Math.floor(l),_=l-y;this.closed?y+=y>0?0:(Math.floor(Math.abs(y)/a)+1)*a:0===_&&y===a-1&&(y=a-2,_=1),this.closed||y>0?h=o[(y-1)%a]:(ea.subVectors(o[0],o[1]).add(o[0]),h=ea);const x=o[y%a],w=o[(y+1)%a];if(this.closed||y+2<a?g=o[(y+2)%a]:(ea.subVectors(o[a-1],o[a-2]).add(o[a-1]),g=ea),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let r=Math.pow(h.distanceToSquared(x),t),i=Math.pow(x.distanceToSquared(w),t),o=Math.pow(w.distanceToSquared(g),t);i<1e-4&&(i=1),r<1e-4&&(r=i),o<1e-4&&(o=i),ta.initNonuniformCatmullRom(h.x,x.x,w.x,g.x,r,i,o),na.initNonuniformCatmullRom(h.y,x.y,w.y,g.y,r,i,o),ra.initNonuniformCatmullRom(h.z,x.z,w.z,g.z,r,i,o)}else"catmullrom"===this.curveType&&(ta.initCatmullRom(h.x,x.x,w.x,g.x,this.tension),na.initCatmullRom(h.y,x.y,w.y,g.y,this.tension),ra.initCatmullRom(h.z,x.z,w.z,g.z,this.tension));return i.set(ta.calc(_),na.calc(_),ra.calc(_)),i},CatmullRomCurve3.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let r=0,i=t.points.length;r<i;r++){const i=t.points[r];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CatmullRomCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let r=0,i=this.points.length;r<i;r++){const i=this.points[r];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},CatmullRomCurve3.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let r=0,i=t.points.length;r<i;r++){const i=t.points[r];this.points.push((new Vector3).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,r){const i=r||new Vector2,o=this.v0,a=this.v1,l=this.v2,h=this.v3;return i.set(CubicBezier(t,o.x,a.x,l.x,h.x),CubicBezier(t,o.y,a.y,l.y,h.y)),i},CubicBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,r){const i=r||new Vector3,o=this.v0,a=this.v1,l=this.v2,h=this.v3;return i.set(CubicBezier(t,o.x,a.x,l.x,h.x),CubicBezier(t,o.y,a.y,l.y,h.y),CubicBezier(t,o.z,a.z,l.z,h.z)),i},CubicBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,r){const i=r||new Vector2;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve.prototype.getPointAt=function(t,r){return this.getPoint(t,r)},LineCurve.prototype.getTangent=function(t,r){const i=r||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i},LineCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,r){const i=r||new Vector3;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},LineCurve3.prototype.getPointAt=function(t,r){return this.getPoint(t,r)},LineCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,r){const i=r||new Vector2,o=this.v0,a=this.v1,l=this.v2;return i.set(QuadraticBezier(t,o.x,a.x,l.x),QuadraticBezier(t,o.y,a.y,l.y)),i},QuadraticBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,r){const i=r||new Vector3,o=this.v0,a=this.v1,l=this.v2;return i.set(QuadraticBezier(t,o.x,a.x,l.x),QuadraticBezier(t,o.y,a.y,l.y),QuadraticBezier(t,o.z,a.z,l.z)),i},QuadraticBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,r){const i=r||new Vector2,o=this.points,a=(o.length-1)*t,l=Math.floor(a),h=a-l,g=o[0===l?l:l-1],y=o[l],_=o[l>o.length-2?o.length-1:l+1],x=o[l>o.length-3?o.length-1:l+2];return i.set(CatmullRom(h,g.x,y.x,_.x,x.x),CatmullRom(h,g.y,y.y,_.y,x.y)),i},SplineCurve.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(let r=0,i=t.points.length;r<i;r++){const i=t.points[r];this.points.push(i.clone())}return this},SplineCurve.prototype.toJSON=function(){const t=Curve.prototype.toJSON.call(this);t.points=[];for(let r=0,i=this.points.length;r<i;r++){const i=this.points[r];t.points.push(i.toArray())}return t},SplineCurve.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(let r=0,i=t.points.length;r<i;r++){const i=t.points[r];this.points.push((new Vector2).fromArray(i))}return this};var ia=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(t){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}function Shape(t){Path.call(this,t),this.uuid=Qn.generateUUID(),this.type="Shape",this.holes=[]}function Light(t,r){Object3D.call(this),this.type="Light",this.color=new Color(t),this.intensity=void 0!==r?r:1}function HemisphereLight(t,r,i){Light.call(this,t,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(r)}function LightShadow(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500)),this.focus=1}function SpotLight(t,r,i,o,a,l){Light.call(this,t,r),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==o?o:Math.PI/3,this.penumbra=void 0!==a?a:0,this.decay=void 0!==l?l:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function PointLight(t,r,i,o){Light.call(this,t,r),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new PointLightShadow}function OrthographicCamera(t,r,i,o,a,l){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==r?r:1,this.top=void 0!==i?i:1,this.bottom=void 0!==o?o:-1,this.near=void 0!==a?a:.1,this.far=void 0!==l?l:2e3,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(t,r){Light.call(this,t,r),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(t,r){Light.call(this,t,r),this.type="AmbientLight"}function RectAreaLight(t,r,i,o){Light.call(this,t,r),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==o?o:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),r=this.curves[this.curves.length-1].getPoint(1);t.equals(r)||this.curves.push(new LineCurve(r,t))},getPoint:function(t){const r=t*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=r){const t=i[o]-r,a=this.curves[o],l=a.getLength(),h=0===l?0:1-t/l;return a.getPointAt(h)}o++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let r=0;for(let i=0,o=this.curves.length;i<o;i++)r+=this.curves[i].getLength(),t.push(r);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const r=[];for(let i=0;i<=t;i++)r.push(this.getPoint(i/t));return this.autoClose&&r.push(r[0]),r},getPoints:function(t){t=t||12;const r=[];let i;for(let o=0,a=this.curves;o<a.length;o++){const l=a[o],h=l&&l.isEllipseCurve?2*t:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?t*l.points.length:t,g=l.getPoints(h);for(let t=0;t<g.length;t++){const o=g[t];i&&i.equals(o)||(r.push(o),i=o)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Curve.prototype.copy.call(this,t),this.curves=[];for(let r=0,i=t.curves.length;r<i;r++){const i=t.curves[r];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=Curve.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let r=0,i=this.curves.length;r<i;r++){const i=this.curves[r];t.curves.push(i.toJSON())}return t},fromJSON:function(t){Curve.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let r=0,i=t.curves.length;r<i;r++){const i=t.curves[r];this.curves.push((new ia[i.type]).fromJSON(i))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let r=1,i=t.length;r<i;r++)this.lineTo(t[r].x,t[r].y);return this},moveTo:function(t,r){return this.currentPoint.set(t,r),this},lineTo:function(t,r){const i=new LineCurve(this.currentPoint.clone(),new Vector2(t,r));return this.curves.push(i),this.currentPoint.set(t,r),this},quadraticCurveTo:function(t,r,i,o){const a=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,r),new Vector2(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},bezierCurveTo:function(t,r,i,o,a,l){const h=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,r),new Vector2(i,o),new Vector2(a,l));return this.curves.push(h),this.currentPoint.set(a,l),this},splineThru:function(t){const r=new SplineCurve([this.currentPoint.clone()].concat(t));return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,r,i,o,a,l){const h=this.currentPoint.x,g=this.currentPoint.y;return this.absarc(t+h,r+g,i,o,a,l),this},absarc:function(t,r,i,o,a,l){return this.absellipse(t,r,i,i,o,a,l),this},ellipse:function(t,r,i,o,a,l,h,g){const y=this.currentPoint.x,_=this.currentPoint.y;return this.absellipse(t+y,r+_,i,o,a,l,h,g),this},absellipse:function(t,r,i,o,a,l,h,g){const y=new EllipseCurve(t,r,i,o,a,l,h,g);if(this.curves.length>0){const t=y.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(y);const _=y.getPoint(1);return this.currentPoint.copy(_),this},copy:function(t){return CurvePath.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=CurvePath.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return CurvePath.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(t){const r=[];for(let i=0,o=this.holes.length;i<o;i++)r[i]=this.holes[i].getPoints(t);return r},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Path.prototype.copy.call(this,t),this.holes=[];for(let r=0,i=t.holes.length;r<i;r++){const i=t.holes[r];this.holes.push(i.clone())}return this},toJSON:function(){const t=Path.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let r=0,i=this.holes.length;r<i;r++){const i=this.holes[r];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Path.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let r=0,i=t.holes.length;r<i;r++){const i=t.holes[r];this.holes.push((new Path).fromJSON(i))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const r=Object3D.prototype.toJSON.call(this,t);return r.object.color=this.color.getHex(),r.object.intensity=this.intensity,void 0!==this.groundColor&&(r.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(r.object.distance=this.distance),void 0!==this.angle&&(r.object.angle=this.angle),void 0!==this.decay&&(r.object.decay=this.decay),void 0!==this.penumbra&&(r.object.penumbra=this.penumbra),void 0!==this.shadow&&(r.object.shadow=this.shadow.toJSON()),r}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const r=this.camera,i=this.matrix,o=this._projScreenMatrix,a=this._lookTarget,l=this._lightPositionWorld;l.setFromMatrixPosition(t.matrixWorld),r.position.copy(l),a.setFromMatrixPosition(t.target.matrixWorld),r.lookAt(a),r.updateMatrixWorld(),o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(r.projectionMatrix),i.multiply(r.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(t){const r=this.camera,i=2*Qn.RAD2DEG*t.angle*this.focus,o=this.mapSize.width/this.mapSize.height,a=t.distance||r.far;i===r.fov&&o===r.aspect&&a===r.far||(r.fov=i,r.aspect=o,r.far=a,r.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,t)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(t,r){void 0===r&&(r=0);const i=this.camera,o=this.matrix,a=this._lightPositionWorld,l=this._lookTarget,h=this._projScreenMatrix;a.setFromMatrixPosition(t.matrixWorld),i.position.copy(a),l.copy(i.position),l.add(this._cubeDirections[r]),i.up.copy(this._cubeUps[r]),i.lookAt(l),i.updateMatrixWorld(),o.makeTranslation(-a.x,-a.y,-a.z),h.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(h)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(t,r){return Camera.prototype.copy.call(this,t,r),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,r,i,o,a,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=i,this.view.offsetY=o,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let a=i-t,l=i+t,h=o+r,g=o-r;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,r=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=t*this.view.offsetX,l=a+t*this.view.width,h-=r*this.view.offsetY,g=h-r*this.view.height}this.projectionMatrix.makeOrthographic(a,l,h,g,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const r=Object3D.prototype.toJSON.call(this,t);return r.object.zoom=this.zoom,r.object.left=this.left,r.object.right=this.right,r.object.top=this.top,r.object.bottom=this.bottom,r.object.near=this.near,r.object.far=this.far,null!==this.view&&(r.object.view=Object.assign({},this.view)),r}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(t){LightShadow.prototype.updateMatrices.call(this,t)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const r=Light.prototype.toJSON.call(this,t);return r.object.width=this.width,r.object.height=this.height,r}});class SphericalHarmonics3{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Vector3)}set(t){for(let r=0;r<9;r++)this.coefficients[r].copy(t[r]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,r){const i=t.x,o=t.y,a=t.z,l=this.coefficients;return r.copy(l[0]).multiplyScalar(.282095),r.addScaledVector(l[1],.488603*o),r.addScaledVector(l[2],.488603*a),r.addScaledVector(l[3],.488603*i),r.addScaledVector(l[4],i*o*1.092548),r.addScaledVector(l[5],o*a*1.092548),r.addScaledVector(l[6],.315392*(3*a*a-1)),r.addScaledVector(l[7],i*a*1.092548),r.addScaledVector(l[8],.546274*(i*i-o*o)),r}getIrradianceAt(t,r){const i=t.x,o=t.y,a=t.z,l=this.coefficients;return r.copy(l[0]).multiplyScalar(.886227),r.addScaledVector(l[1],1.023328*o),r.addScaledVector(l[2],1.023328*a),r.addScaledVector(l[3],1.023328*i),r.addScaledVector(l[4],.858086*i*o),r.addScaledVector(l[5],.858086*o*a),r.addScaledVector(l[6],.743125*a*a-.247708),r.addScaledVector(l[7],.858086*i*a),r.addScaledVector(l[8],.429043*(i*i-o*o)),r}add(t){for(let r=0;r<9;r++)this.coefficients[r].add(t.coefficients[r]);return this}addScaledSH(t,r){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],r);return this}scale(t){for(let r=0;r<9;r++)this.coefficients[r].multiplyScalar(t);return this}lerp(t,r){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],r);return this}equals(t){for(let r=0;r<9;r++)if(!this.coefficients[r].equals(t.coefficients[r]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,r=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].fromArray(t,r+3*o);return this}toArray(t=[],r=0){const i=this.coefficients;for(let o=0;o<9;o++)i[o].toArray(t,r+3*o);return t}static getBasisAt(t,r){const i=t.x,o=t.y,a=t.z;r[0]=.282095,r[1]=.488603*o,r[2]=.488603*a,r[3]=.488603*i,r[4]=1.092548*i*o,r[5]=1.092548*o*a,r[6]=.315392*(3*a*a-1),r[7]=1.092548*i*a,r[8]=.546274*(i*i-o*o)}}function LightProbe(t,r){Light.call(this,void 0,r),this.type="LightProbe",this.sh=void 0!==t?t:new SphericalHarmonics3}function MaterialLoader(t){Loader.call(this,t),this.textures={}}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const r=Light.prototype.toJSON.call(this,t);return r.object.sh=this.sh.toArray(),r}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,r,i,o){const a=this,l=new FileLoader(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(t,(function(i){try{r(a.parse(JSON.parse(i)))}catch(l){o?o(l):console.error(l),a.manager.itemError(t)}}),i,o)},parse:function(t){const r=this.textures;function getTexture(t){return void 0===r[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),r[t]}const i=new Ko[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new Color).setHex(t.sheen)),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const o in t.uniforms){const r=t.uniforms[o];switch(i.uniforms[o]={},r.type){case"t":i.uniforms[o].value=getTexture(r.value);break;case"c":i.uniforms[o].value=(new Color).setHex(r.value);break;case"v2":i.uniforms[o].value=(new Vector2).fromArray(r.value);break;case"v3":i.uniforms[o].value=(new Vector3).fromArray(r.value);break;case"v4":i.uniforms[o].value=(new Vector4).fromArray(r.value);break;case"m3":i.uniforms[o].value=(new Matrix3).fromArray(r.value);break;case"m4":i.uniforms[o].value=(new Matrix4).fromArray(r.value);break;default:i.uniforms[o].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const o in t.extensions)i.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=getTexture(t.map)),void 0!==t.matcap&&(i.matcap=getTexture(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=getTexture(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=getTexture(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=getTexture(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let r=t.normalScale;!1===Array.isArray(r)&&(r=[r,r]),i.normalScale=(new Vector2).fromArray(r)}return void 0!==t.displacementMap&&(i.displacementMap=getTexture(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=getTexture(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=getTexture(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=getTexture(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=getTexture(t.specularMap)),void 0!==t.envMap&&(i.envMap=getTexture(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=getTexture(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=getTexture(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=getTexture(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=getTexture(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=getTexture(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=getTexture(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.transmissionMap&&(i.transmissionMap=getTexture(t.transmissionMap)),i},setTextures:function(t){return this.textures=t,this}});const oa={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let r="";for(let o=0,a=t.length;o<a;o++)r+=String.fromCharCode(t[o]);try{return decodeURIComponent(escape(r))}catch(i){return r}},extractUrlBase:function(t){const r=t.lastIndexOf("/");return-1===r?"./":t.substr(0,r+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function InstancedBufferAttribute(t,r,i,o){"number"==typeof i&&(o=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,t,r,i),this.meshPerAttribute=o||1}function BufferGeometryLoader(t){Loader.call(this,t)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(t){return BufferGeometry.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=BufferGeometry.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(t){return BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=BufferAttribute.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,r,i,o){const a=this,l=new FileLoader(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(t,(function(i){try{r(a.parse(JSON.parse(i)))}catch(l){o?o(l):console.error(l),a.manager.itemError(t)}}),i,o)},parse:function(t){const r={},i={};function getInterleavedBuffer(t,o){if(void 0!==r[o])return r[o];const a=t.interleavedBuffers[o],l=function getArrayBuffer(t,r){if(void 0!==i[r])return i[r];const o=t.arrayBuffers[r],a=new Uint32Array(o).buffer;return i[r]=a,a}(t,a.buffer),h=new InterleavedBuffer(new aa[a.type](l),a.stride);return h.uuid=a.uuid,r[o]=h,h}const o=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,a=t.data.index;if(void 0!==a){const t=new aa[a.type](a.array);o.setIndex(new BufferAttribute(t,1))}const l=t.data.attributes;for(const _ in l){const r=l[_];let i;if(r.isInterleavedBufferAttribute){i=new InterleavedBufferAttribute(getInterleavedBuffer(t.data,r.data),r.itemSize,r.offset,r.normalized)}else{const t=new aa[r.type](r.array);i=new(r.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(t,r.itemSize,r.normalized)}void 0!==r.name&&(i.name=r.name),o.setAttribute(_,i)}const h=t.data.morphAttributes;if(h)for(const _ in h){const r=h[_],i=[];for(let o=0,a=r.length;o<a;o++){const a=r[o];let l;if(a.isInterleavedBufferAttribute){l=new InterleavedBufferAttribute(getInterleavedBuffer(t.data,a.data),a.itemSize,a.offset,a.normalized)}else{l=new BufferAttribute(new aa[a.type](a.array),a.itemSize,a.normalized)}void 0!==a.name&&(l.name=a.name),i.push(l)}o.morphAttributes[_]=i}t.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const g=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==g)for(let _=0,x=g.length;_!==x;++_){const t=g[_];o.addGroup(t.start,t.count,t.materialIndex)}const y=t.data.boundingSphere;if(void 0!==y){const t=new Vector3;void 0!==y.center&&t.fromArray(y.center),o.boundingSphere=new Sphere(t,y.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}});const aa={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};class ObjectLoader extends Loader{constructor(t){super(t)}load(t,r,i,o){const a=this,l=""===this.path?oa.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||l;const h=new FileLoader(this.manager);h.setPath(this.path),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(t,(function(i){let l=null;try{l=JSON.parse(i)}catch(g){return void 0!==o&&o(g),void console.error("THREE:ObjectLoader: Can't parse "+t+".",g.message)}const h=l.metadata;void 0!==h&&void 0!==h.type&&"geometry"!==h.type.toLowerCase()?a.parse(l,r):console.error("THREE.ObjectLoader: Can't load "+t)}),i,o)}parse(t,r){const i=this.parseShape(t.shapes),o=this.parseGeometries(t.geometries,i),a=this.parseImages(t.images,(function(){void 0!==r&&r(g)})),l=this.parseTextures(t.textures,a),h=this.parseMaterials(t.materials,l),g=this.parseObject(t.object,o,h);return t.animations&&(g.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==r&&r(g),g}parseShape(t){const r={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const o=(new Shape).fromJSON(t[i]);r[o.uuid]=o}return r}parseGeometries(t,r){const i={};let o;if(void 0!==t){const a=new BufferGeometryLoader;for(let l=0,h=t.length;l<h;l++){let h;const g=t[l];switch(g.type){case"PlaneGeometry":case"PlaneBufferGeometry":h=new Xo[g.type](g.width,g.height,g.widthSegments,g.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":h=new Xo[g.type](g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":h=new Xo[g.type](g.radius,g.segments,g.thetaStart,g.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":h=new Xo[g.type](g.radiusTop,g.radiusBottom,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":h=new Xo[g.type](g.radius,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":h=new Xo[g.type](g.radius,g.widthSegments,g.heightSegments,g.phiStart,g.phiLength,g.thetaStart,g.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":h=new Xo[g.type](g.radius,g.detail);break;case"RingGeometry":case"RingBufferGeometry":h=new Xo[g.type](g.innerRadius,g.outerRadius,g.thetaSegments,g.phiSegments,g.thetaStart,g.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":h=new Xo[g.type](g.radius,g.tube,g.radialSegments,g.tubularSegments,g.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":h=new Xo[g.type](g.radius,g.tube,g.tubularSegments,g.radialSegments,g.p,g.q);break;case"TubeGeometry":case"TubeBufferGeometry":h=new Xo[g.type]((new ia[g.path.type]).fromJSON(g.path),g.tubularSegments,g.radius,g.radialSegments,g.closed);break;case"LatheGeometry":case"LatheBufferGeometry":h=new Xo[g.type](g.points,g.segments,g.phiStart,g.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":h=new Xo[g.type](g.vertices,g.indices,g.radius,g.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":o=[];for(let i=0,a=g.shapes.length;i<a;i++){const t=r[g.shapes[i]];o.push(t)}h=new Xo[g.type](o,g.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":o=[];for(let i=0,a=g.shapes.length;i<a;i++){const t=r[g.shapes[i]];o.push(t)}const t=g.options.extrudePath;void 0!==t&&(g.options.extrudePath=(new ia[t.type]).fromJSON(t)),h=new Xo[g.type](o,g.options);break;case"BufferGeometry":case"InstancedBufferGeometry":h=a.parse(g);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+g.type+'"');continue}h.uuid=g.uuid,void 0!==g.name&&(h.name=g.name),!0===h.isBufferGeometry&&void 0!==g.userData&&(h.userData=g.userData),i[g.uuid]=h}}return i}parseMaterials(t,r){const i={},o={};if(void 0!==t){const a=new MaterialLoader;a.setTextures(r);for(let r=0,l=t.length;r<l;r++){const l=t[r];if("MultiMaterial"===l.type){const t=[];for(let r=0;r<l.materials.length;r++){const o=l.materials[r];void 0===i[o.uuid]&&(i[o.uuid]=a.parse(o)),t.push(i[o.uuid])}o[l.uuid]=t}else void 0===i[l.uuid]&&(i[l.uuid]=a.parse(l)),o[l.uuid]=i[l.uuid]}}return o}parseAnimations(t){const r=[];for(let i=0;i<t.length;i++){const o=t[i],a=AnimationClip.parse(o);void 0!==o.uuid&&(a.uuid=o.uuid),r.push(a)}return r}parseImages(t,r){const i=this,o={};let a;function loadImage(t){return i.manager.itemStart(t),a.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){const l=new LoadingManager(r);a=new ImageLoader(l),a.setCrossOrigin(this.crossOrigin);for(let r=0,a=t.length;r<a;r++){const a=t[r],l=a.url;if(Array.isArray(l)){o[a.uuid]=[];for(let t=0,r=l.length;t<r;t++){const r=l[t],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:i.resourcePath+r;o[a.uuid].push(loadImage(h))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a.url)?a.url:i.resourcePath+a.url;o[a.uuid]=loadImage(t)}}}return o}parseTextures(t,r){function parseConstant(t,r){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),r[t])}const i={};if(void 0!==t)for(let o=0,a=t.length;o<a;o++){const a=t[o];let l;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===r[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image),l=Array.isArray(r[a.image])?new CubeTexture(r[a.image]):new Texture(r[a.image]),l.needsUpdate=!0,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=parseConstant(a.mapping,sa)),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=parseConstant(a.wrap[0],ca),l.wrapT=parseConstant(a.wrap[1],ca)),void 0!==a.format&&(l.format=a.format),void 0!==a.type&&(l.type=a.type),void 0!==a.encoding&&(l.encoding=a.encoding),void 0!==a.minFilter&&(l.minFilter=parseConstant(a.minFilter,la)),void 0!==a.magFilter&&(l.magFilter=parseConstant(a.magFilter,la)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),i[a.uuid]=l}return i}parseObject(t,r,i){let o,a,l;function getGeometry(t){return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),r[t]}function getMaterial(t){if(void 0!==t){if(Array.isArray(t)){const r=[];for(let o=0,a=t.length;o<a;o++){const a=t[o];void 0===i[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),r.push(i[a])}return r}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":o=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(o.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":o=new DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new LightProbe).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":a=getGeometry(t.geometry),l=getMaterial(t.material),o=new Mesh(a,l);break;case"InstancedMesh":a=getGeometry(t.geometry),l=getMaterial(t.material);const r=t.count,i=t.instanceMatrix;o=new InstancedMesh(a,l,r),o.instanceMatrix=new BufferAttribute(new Float32Array(i.array),16);break;case"LOD":o=new LOD;break;case"Line":o=new Line(getGeometry(t.geometry),getMaterial(t.material),t.mode);break;case"LineLoop":o=new LineLoop(getGeometry(t.geometry),getMaterial(t.material));break;case"LineSegments":o=new LineSegments(getGeometry(t.geometry),getMaterial(t.material));break;case"PointCloud":case"Points":o=new Points(getGeometry(t.geometry),getMaterial(t.material));break;case"Sprite":o=new Sprite(getMaterial(t.material));break;case"Group":o=new Group;break;default:o=new Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(o.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)o.add(this.parseObject(a[t],r,i))}if("LOD"===t.type){void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate);const r=t.levels;for(let t=0;t<r.length;t++){const i=r[t],a=o.getObjectByProperty("uuid",i.object);void 0!==a&&o.addLevel(a,i.distance)}}return o}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const sa={UVMapping:ve,CubeReflectionMapping:ye,CubeRefractionMapping:be,EquirectangularReflectionMapping:_e,EquirectangularRefractionMapping:xe,CubeUVReflectionMapping:we,CubeUVRefractionMapping:Se},ca={RepeatWrapping:Me,ClampToEdgeWrapping:Ee,MirroredRepeatWrapping:Te},la={NearestFilter:Pe,NearestMipmapNearestFilter:Ce,NearestMipmapLinearFilter:Oe,LinearFilter:Ie,LinearMipmapNearestFilter:Re,LinearMipmapLinearFilter:Ne};function ImageBitmapLoader(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,t),this.options={premultiplyAlpha:"none"}}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(t){this.type="Font",this.data=t}function createPath(t,r,i,o,a){const l=a.glyphs[t]||a.glyphs["?"];if(!l)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+a.familyName+".");const h=new ShapePath;let g,y,_,x,w,S,M,T;if(l.o){const t=l._cachedOutline||(l._cachedOutline=l.o.split(" "));for(let a=0,l=t.length;a<l;){switch(t[a++]){case"m":g=t[a++]*r+i,y=t[a++]*r+o,h.moveTo(g,y);break;case"l":g=t[a++]*r+i,y=t[a++]*r+o,h.lineTo(g,y);break;case"q":_=t[a++]*r+i,x=t[a++]*r+o,w=t[a++]*r+i,S=t[a++]*r+o,h.quadraticCurveTo(w,S,_,x);break;case"b":_=t[a++]*r+i,x=t[a++]*r+o,w=t[a++]*r+i,S=t[a++]*r+o,M=t[a++]*r+i,T=t[a++]*r+o,h.bezierCurveTo(w,S,M,T,_,x)}}}return{offsetX:l.ha*r,path:h}}function FontLoader(t){Loader.call(this,t)}let ua;ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function setOptions(t){return this.options=t,this},load:function(t,r,i,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,l=Zo.get(t);if(void 0!==l)return a.manager.itemStart(t),setTimeout((function(){r&&r(l),a.manager.itemEnd(t)}),0),l;const h={};h.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,h).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,a.options)})).then((function(i){Zo.add(t,i),r&&r(i),a.manager.itemEnd(t)})).catch((function(r){o&&o(r),a.manager.itemError(t),a.manager.itemEnd(t)})),a.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(t,r){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,r),this},lineTo:function(t,r){return this.currentPath.lineTo(t,r),this},quadraticCurveTo:function(t,r,i,o){return this.currentPath.quadraticCurveTo(t,r,i,o),this},bezierCurveTo:function(t,r,i,o,a,l){return this.currentPath.bezierCurveTo(t,r,i,o,a,l),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,r){function toShapesNoHoles(t){const r=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],a=new Shape;a.curves=o.curves,r.push(a)}return r}function isPointInsidePolygon(t,r){const i=r.length;let o=!1;for(let a=i-1,l=0;l<i;a=l++){let i=r[a],h=r[l],g=h.x-i.x,y=h.y-i.y;if(Math.abs(y)>Number.EPSILON){if(y<0&&(i=r[l],g=-g,h=r[a],y=-y),t.y<i.y||t.y>h.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const r=y*(t.x-i.x)-g*(t.y-i.y);if(0===r)return!0;if(r<0)continue;o=!o}}else{if(t.y!==i.y)continue;if(h.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=h.x)return!0}}return o}const i=qo.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===r)return toShapesNoHoles(o);let a,l,h;const g=[];if(1===o.length)return l=o[0],h=new Shape,h.curves=l.curves,g.push(h),g;let y=!i(o[0].getPoints());y=t?!y:y;const _=[],x=[];let w,S,M=[],T=0;x[T]=void 0,M[T]=[];for(let P=0,C=o.length;P<C;P++)l=o[P],w=l.getPoints(),a=i(w),a=t?!a:a,a?(!y&&x[T]&&T++,x[T]={s:new Shape,p:w},x[T].s.curves=l.curves,y&&T++,M[T]=[]):M[T].push({h:l,p:w[0]});if(!x[0])return toShapesNoHoles(o);if(x.length>1){let t=!1;const r=[];for(let i=0,o=x.length;i<o;i++)_[i]=[];for(let i=0,o=x.length;i<o;i++){const o=M[i];for(let a=0;a<o.length;a++){const l=o[a];let h=!0;for(let o=0;o<x.length;o++)isPointInsidePolygon(l.p,x[o].p)&&(i!==o&&r.push({froms:i,tos:o,hole:a}),h?(h=!1,_[o].push(l)):t=!0);h&&_[i].push(l)}}r.length>0&&(t||(M=_))}for(let P=0,C=x.length;P<C;P++){h=x[P].s,g.push(h),S=M[P];for(let t=0,r=S.length;t<r;t++)h.holes.push(S[t].h)}return g}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(t,r){void 0===r&&(r=100);const i=[],o=function createPaths(t,r,i){const o=Array.from?Array.from(t):String(t).split(""),a=r/i.resolution,l=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*a,h=[];let g=0,y=0;for(let _=0;_<o.length;_++){const t=o[_];if("\n"===t)g=0,y-=l;else{const r=createPath(t,a,g,y,i);g+=r.offsetX,h.push(r.path)}}return h}(t,r,this.data);for(let a=0,l=o.length;a<l;a++)Array.prototype.push.apply(i,o[a].toShapes());return i}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(t,r,i,o){const a=this,l=new FileLoader(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(a.withCredentials),l.load(t,(function(t){let i;try{i=JSON.parse(t)}catch(l){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}const o=a.parse(i);r&&r(o)}),i,o)},parse:function(t){return new Font(t)}});const da={getContext:function(){return void 0===ua&&(ua=new(window.AudioContext||window.webkitAudioContext)),ua},setContext:function(t){ua=t}};function AudioLoader(t){Loader.call(this,t)}function HemisphereLightProbe(t,r,i){LightProbe.call(this,void 0,i);const o=(new Color).set(t),a=(new Color).set(r),l=new Vector3(o.r,o.g,o.b),h=new Vector3(a.r,a.g,a.b),g=Math.sqrt(Math.PI),y=g*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(h).multiplyScalar(g),this.sh.coefficients[1].copy(l).sub(h).multiplyScalar(y)}function AmbientLightProbe(t,r){LightProbe.call(this,void 0,r);const i=(new Color).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(t,r,i,o){const a=this,l=new FileLoader(a.manager);l.setResponseType("arraybuffer"),l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(t,(function(i){try{const t=i.slice(0);da.getContext().decodeAudioData(t,(function(t){r(t)}))}catch(l){o?o(l):console.error(l),a.manager.itemError(t)}}),i,o)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}});const ha=new Matrix4,pa=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(t){const r=this._cache;if(r.focus!==t.focus||r.fov!==t.fov||r.aspect!==t.aspect*this.aspect||r.near!==t.near||r.far!==t.far||r.zoom!==t.zoom||r.eyeSep!==this.eyeSep){r.focus=t.focus,r.fov=t.fov,r.aspect=t.aspect*this.aspect,r.near=t.near,r.far=t.far,r.zoom=t.zoom,r.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),o=r.eyeSep/2,a=o*r.near/r.focus,l=r.near*Math.tan(Qn.DEG2RAD*r.fov*.5)/r.zoom;let h,g;pa.elements[12]=-o,ha.elements[12]=o,h=-l*r.aspect+a,g=l*r.aspect+a,i.elements[0]=2*r.near/(g-h),i.elements[8]=(g+h)/(g-h),this.cameraL.projectionMatrix.copy(i),h=-l*r.aspect-a,g=l*r.aspect-a,i.elements[0]=2*r.near/(g-h),i.elements[8]=(g+h)/(g-h),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(pa),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(ha)}});class Clock{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=("undefined"==typeof performance?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}const fa=new Vector3,ma=new Quaternion,ga=new Vector3,va=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=da.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const r=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(fa,ma,ga),va.set(0,0,-1).applyQuaternion(ma),r.positionX){const t=this.context.currentTime+this.timeDelta;r.positionX.linearRampToValueAtTime(fa.x,t),r.positionY.linearRampToValueAtTime(fa.y,t),r.positionZ.linearRampToValueAtTime(fa.z,t),r.forwardX.linearRampToValueAtTime(va.x,t),r.forwardY.linearRampToValueAtTime(va.y,t),r.forwardZ.linearRampToValueAtTime(va.z,t),r.upX.linearRampToValueAtTime(i.x,t),r.upY.linearRampToValueAtTime(i.y,t),r.upZ.linearRampToValueAtTime(i.z,t)}else r.setPosition(fa.x,fa.y,fa.z),r.setOrientation(va.x,va.y,va.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const r=this.context.createBufferSource();return r.buffer=this.buffer,r.loop=this.loop,r.loopStart=this.loopStart,r.loopEnd=this.loopEnd,r.onended=this.onEnded.bind(this),r.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=r,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,r=this.filters.length;t<r;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,r=this.filters.length;t<r;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const ya=new Vector3,ba=new Quaternion,_a=new Vector3,xa=new Vector3;class PositionalAudio extends Audio{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,r,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=r,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ya,ba,_a),xa.set(0,0,1).applyQuaternion(ba);const r=this.panner;if(r.positionX){const t=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(ya.x,t),r.positionY.linearRampToValueAtTime(ya.y,t),r.positionZ.linearRampToValueAtTime(ya.z,t),r.orientationX.linearRampToValueAtTime(xa.x,t),r.orientationY.linearRampToValueAtTime(xa.y,t),r.orientationZ.linearRampToValueAtTime(xa.z,t)}else r.setPosition(ya.x,ya.y,ya.z),r.setOrientation(xa.x,xa.y,xa.z)}}class AudioAnalyser{constructor(t,r){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==r?r:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const r=this.getFrequencyData();for(let i=0;i<r.length;i++)t+=r[i];return t/r.length}}function PropertyMixer(t,r,i){let o,a,l;switch(this.binding=t,this.valueSize=i,r){case"quaternion":o=this._slerp,a=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":o=this._select,a=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:o=this._lerp,a=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=a,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(t,r){const i=this.buffer,o=this.valueSize,a=t*o+o;let l=this.cumulativeWeight;if(0===l){for(let t=0;t!==o;++t)i[a+t]=i[t];l=r}else{l+=r;const t=r/l;this._mixBufferRegion(i,a,0,t,o)}this.cumulativeWeight=l},accumulateAdditive:function(t){const r=this.buffer,i=this.valueSize,o=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(r,o,0,t,i),this.cumulativeWeightAdditive+=t},apply:function(t){const r=this.valueSize,i=this.buffer,o=t*r+r,a=this.cumulativeWeight,l=this.cumulativeWeightAdditive,h=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const t=r*this._origIndex;this._mixBufferRegion(i,o,t,1-a,r)}l>0&&this._mixBufferRegionAdditive(i,o,this._addIndex*r,1,r);for(let g=r,y=r+r;g!==y;++g)if(i[g]!==i[g+r]){h.setValue(i,o);break}},saveOriginalState:function(){const t=this.binding,r=this.buffer,i=this.valueSize,o=i*this._origIndex;t.getValue(r,o);for(let a=i,l=o;a!==l;++a)r[a]=r[o+a%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,r=t+this.valueSize;for(let i=t;i<r;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[r+i]=this.buffer[t+i]},_select:function(t,r,i,o,a){if(o>=.5)for(let l=0;l!==a;++l)t[r+l]=t[i+l]},_slerp:function(t,r,i,o){Quaternion.slerpFlat(t,r,t,r,t,i,o)},_slerpAdditive:function(t,r,i,o,a){const l=this._workIndex*a;Quaternion.multiplyQuaternionsFlat(t,l,t,r,t,i),Quaternion.slerpFlat(t,r,t,r,t,l,o)},_lerp:function(t,r,i,o,a){const l=1-o;for(let h=0;h!==a;++h){const a=r+h;t[a]=t[a]*l+t[i+h]*o}},_lerpAdditive:function(t,r,i,o,a){for(let l=0;l!==a;++l){const a=r+l;t[a]=t[a]+t[i+l]*o}}});const wa="\\[\\]\\.:\\/",Sa=new RegExp("[\\[\\]\\.:\\/]","g"),Ma="[^\\[\\]\\.:\\/]",Ea="[^"+wa.replace("\\.","")+"]",Ta=/((?:WC+[\/:])*)/.source.replace("WC",Ma),Pa=/(WCOD+)?/.source.replace("WCOD",Ea),Ca=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ma),Aa=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ma),Oa=new RegExp("^"+Ta+Pa+Ca+Aa+"$"),La=["material","materials","bones"];function Composite(t,r,i){const o=i||PropertyBinding.parseTrackName(r);this._targetGroup=t,this._bindings=t.subscribe_(r,o)}function PropertyBinding(t,r,i){this.path=r,this.parsedPath=i||PropertyBinding.parseTrackName(r),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function AnimationObjectGroup(){this.uuid=Qn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let i=0,o=arguments.length;i!==o;++i)t[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(Composite.prototype,{getValue:function(t,r){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];void 0!==o&&o.getValue(t,r)},setValue:function(t,r){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,a=i.length;o!==a;++o)i[o].setValue(t,r)},bind:function(){const t=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=t.length;r!==i;++r)t[r].bind()},unbind:function(){const t=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=t.length;r!==i;++r)t[r].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(t,r,i){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,r,i):new PropertyBinding(t,r,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Sa,"")},parseTrackName:function(t){const r=Oa.exec(t);if(!r)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},o=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){const t=i.nodeName.substring(o+1);-1!==La.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,o),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i},findNode:function(t,r){if(!r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(r);if(void 0!==i)return i}if(t.children){const searchNodeSubtree=function(t){for(let i=0;i<t.length;i++){const o=t[i];if(o.name===r||o.uuid===r)return o;const a=searchNodeSubtree(o.children);if(a)return a}return null},i=searchNodeSubtree(t.children);if(i)return i}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(t,r){t[r]=this.node[this.propertyName]},function getValue_array(t,r){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)t[r++]=i[o]},function getValue_arrayElement(t,r){t[r]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(t,r){this.resolvedProperty.toArray(t,r)}],SetterByBindingTypeAndVersioning:[[function setValue_direct(t,r){this.targetObject[this.propertyName]=t[r]},function setValue_direct_setNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_array(t,r){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[r++]},function setValue_array_setNeedsUpdate(t,r){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[r++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(t,r){const i=this.resolvedProperty;for(let o=0,a=i.length;o!==a;++o)i[o]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_arrayElement(t,r){this.resolvedProperty[this.propertyIndex]=t[r]},function setValue_arrayElement_setNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_fromArray(t,r){this.resolvedProperty.fromArray(t,r)},function setValue_fromArray_setNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(t,r){this.bind(),this.getValue(t,r)},setValue:function getValue_unbound(t,r){this.bind(),this.setValue(t,r)},bind:function(){let t=this.node;const r=this.parsedPath,i=r.objectName,o=r.propertyName;let a=r.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,r.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let o=r.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let r=0;r<t.length;r++)if(t[r].name===o){o=r;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}const l=t[o];if(void 0===l){const i=r.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+o+" but it wasn't found.",t)}let h=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?h=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(h=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}g=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(g=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(g=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=o;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][h]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,l=a.length;let h=void 0,g=t.length,y=this.nCachedObjects_;for(let _=0,x=arguments.length;_!==x;++_){const x=arguments[_],w=x.uuid;let S=r[w];if(void 0===S){S=g++,r[w]=S,t.push(x);for(let t=0,r=l;t!==r;++t)a[t].push(new PropertyBinding(x,i[t],o[t]))}else if(S<y){h=t[S];const g=--y,_=t[g];r[_.uuid]=S,t[S]=_,r[w]=g,t[g]=x;for(let t=0,r=l;t!==r;++t){const r=a[t],l=r[g];let h=r[S];r[S]=l,void 0===h&&(h=new PropertyBinding(x,i[t],o[t])),r[g]=h}}else t[S]!==h&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=y},remove:function(){const t=this._objects,r=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const h=arguments[l],g=h.uuid,y=r[g];if(void 0!==y&&y>=a){const l=a++,_=t[l];r[_.uuid]=y,t[y]=_,r[g]=l,t[l]=h;for(let t=0,r=o;t!==r;++t){const r=i[t],o=r[l],a=r[y];r[y]=o,r[l]=a}}}this.nCachedObjects_=a},uncache:function(){const t=this._objects,r=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_,l=t.length;for(let h=0,g=arguments.length;h!==g;++h){const g=arguments[h].uuid,y=r[g];if(void 0!==y)if(delete r[g],y<a){const h=--a,g=t[h],_=--l,x=t[_];r[g.uuid]=y,t[y]=g,r[x.uuid]=h,t[h]=x,t.pop();for(let t=0,r=o;t!==r;++t){const r=i[t],o=r[h],a=r[_];r[y]=o,r[h]=a,r.pop()}}else{const a=--l,h=t[a];a>0&&(r[h.uuid]=y),t[y]=h,t.pop();for(let t=0,r=o;t!==r;++t){const r=i[t];r[y]=r[a],r.pop()}}}this.nCachedObjects_=a},subscribe_:function(t,r){const i=this._bindingsIndicesByPath;let o=i[t];const a=this._bindings;if(void 0!==o)return a[o];const l=this._paths,h=this._parsedPaths,g=this._objects,y=g.length,_=this.nCachedObjects_,x=new Array(y);o=a.length,i[t]=o,l.push(t),h.push(r),a.push(x);for(let w=_,S=g.length;w!==S;++w){const i=g[w];x[w]=new PropertyBinding(i,t,r)}return x},unsubscribe_:function(t){const r=this._bindingsIndicesByPath,i=r[t];if(void 0!==i){const o=this._paths,a=this._parsedPaths,l=this._bindings,h=l.length-1,g=l[h];r[t[h]]=i,l[i]=g,l.pop(),a[i]=a[h],a.pop(),o[i]=o[h],o.pop()}}});class AnimationAction{constructor(t,r,i,o){this._mixer=t,this._clip=r,this._localRoot=i||null,this.blendMode=o||r.blendMode;const a=r.tracks,l=a.length,h=new Array(l),g={endingStart:tn,endingEnd:tn};for(let y=0;y!==l;++y){const t=a[y].createInterpolant(null);h[y]=t,t.settings=g}this._interpolantSettings=g,this._interpolants=h,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Yt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,r){return this.loop=t,this.repetitions=r,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,r,i){if(t.fadeOut(r),this.fadeIn(r),i){const i=this._clip.duration,o=t._clip.duration,a=o/i,l=i/o;t.warp(1,a,r),this.warp(l,1,r)}return this}crossFadeTo(t,r,i){return t.crossFadeFrom(this,r,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,r,i){const o=this._mixer,a=o.time,l=this.timeScale;let h=this._timeScaleInterpolant;null===h&&(h=o._lendControlInterpolant(),this._timeScaleInterpolant=h);const g=h.parameterPositions,y=h.sampleValues;return g[0]=a,g[1]=a+i,y[0]=t/l,y[1]=r/l,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,r,i,o){if(!this.enabled)return void this._updateWeight(t);const a=this._startTime;if(null!==a){const o=(t-a)*i;if(o<0||0===i)return;this._startTime=null,r=i*o}r*=this._updateTimeScale(t);const l=this._updateTime(r),h=this._updateWeight(t);if(h>0){const t=this._interpolants,r=this._propertyBindings;switch(this.blendMode){case sn:for(let i=0,o=t.length;i!==o;++i)t[i].evaluate(l),r[i].accumulateAdditive(h);break;case an:default:for(let i=0,a=t.length;i!==a;++i)t[i].evaluate(l),r[i].accumulate(o,h)}}}_updateWeight(t){let r=0;if(this.enabled){r=this.weight;const i=this._weightInterpolant;if(null!==i){const o=i.evaluate(t)[0];r*=o,t>i.parameterPositions[1]&&(this.stopFading(),0===o&&(this.enabled=!1))}}return this._effectiveWeight=r,r}_updateTimeScale(t){let r=0;if(!this.paused){r=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){r*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===r?this.paused=!0:this.timeScale=r)}}return this._effectiveTimeScale=r,r}_updateTime(t){const r=this._clip.duration,i=this.loop;let o=this.time+t,a=this._loopCount;const l=i===Zt;if(0===t)return-1===a?o:l&&1==(1&a)?r-o:o;if(i===Kt){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(o>=r)o=r;else{if(!(o<0)){this.time=o;break e}o=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===a&&(t>=0?(a=0,this._setEndings(!0,0===this.repetitions,l)):this._setEndings(0===this.repetitions,!0,l)),o>=r||o<0){const i=Math.floor(o/r);o-=r*i,a+=Math.abs(i);const h=this.repetitions-a;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o=t>0?r:0,this.time=o,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===h){const r=t<0;this._setEndings(r,!r,l)}else this._setEndings(!1,!1,l);this._loopCount=a,this.time=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=o;if(l&&1==(1&a))return r-o}return o}_setEndings(t,r,i){const o=this._interpolantSettings;i?(o.endingStart=nn,o.endingEnd=nn):(o.endingStart=t?this.zeroSlopeAtStart?nn:tn:rn,o.endingEnd=r?this.zeroSlopeAtEnd?nn:tn:rn)}_scheduleFading(t,r,i){const o=this._mixer,a=o.time;let l=this._weightInterpolant;null===l&&(l=o._lendControlInterpolant(),this._weightInterpolant=l);const h=l.parameterPositions,g=l.sampleValues;return h[0]=a,g[0]=r,h[1]=a+t,g[1]=i,this}}function AnimationMixer(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(t,r){const i=t._localRoot||this._root,o=t._clip.tracks,a=o.length,l=t._propertyBindings,h=t._interpolants,g=i.uuid,y=this._bindingsByRootAndName;let _=y[g];void 0===_&&(_={},y[g]=_);for(let x=0;x!==a;++x){const t=o[x],a=t.name;let y=_[a];if(void 0!==y)l[x]=y;else{if(y=l[x],void 0!==y){null===y._cacheIndex&&(++y.referenceCount,this._addInactiveBinding(y,g,a));continue}const o=r&&r._propertyBindings[x].binding.parsedPath;y=new PropertyMixer(PropertyBinding.create(i,a,o),t.ValueTypeName,t.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,g,a),l[x]=y}h[x].resultBuffer=y.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const r=(t._localRoot||this._root).uuid,i=t._clip.uuid,o=this._actionsByClip[i];this._bindAction(t,o&&o.knownActions[0]),this._addInactiveAction(t,i,r)}const r=t._propertyBindings;for(let t=0,i=r.length;t!==i;++t){const i=r[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const r=t._propertyBindings;for(let t=0,i=r.length;t!==i;++t){const i=r[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const r=t._cacheIndex;return null!==r&&r<this._nActiveActions},_addInactiveAction:function(t,r,i){const o=this._actions,a=this._actionsByClip;let l=a[r];if(void 0===l)l={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,a[r]=l;else{const r=l.knownActions;t._byClipCacheIndex=r.length,r.push(t)}t._cacheIndex=o.length,o.push(t),l.actionByRoot[i]=t},_removeInactiveAction:function(t){const r=this._actions,i=r[r.length-1],o=t._cacheIndex;i._cacheIndex=o,r[o]=i,r.pop(),t._cacheIndex=null;const a=t._clip.uuid,l=this._actionsByClip,h=l[a],g=h.knownActions,y=g[g.length-1],_=t._byClipCacheIndex;y._byClipCacheIndex=_,g[_]=y,g.pop(),t._byClipCacheIndex=null;delete h.actionByRoot[(t._localRoot||this._root).uuid],0===g.length&&delete l[a],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const r=t._propertyBindings;for(let i=0,o=r.length;i!==o;++i){const t=r[i];0==--t.referenceCount&&this._removeInactiveBinding(t)}},_lendAction:function(t){const r=this._actions,i=t._cacheIndex,o=this._nActiveActions++,a=r[o];t._cacheIndex=o,r[o]=t,a._cacheIndex=i,r[i]=a},_takeBackAction:function(t){const r=this._actions,i=t._cacheIndex,o=--this._nActiveActions,a=r[o];t._cacheIndex=o,r[o]=t,a._cacheIndex=i,r[i]=a},_addInactiveBinding:function(t,r,i){const o=this._bindingsByRootAndName,a=this._bindings;let l=o[r];void 0===l&&(l={},o[r]=l),l[i]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){const r=this._bindings,i=t.binding,o=i.rootNode.uuid,a=i.path,l=this._bindingsByRootAndName,h=l[o],g=r[r.length-1],y=t._cacheIndex;g._cacheIndex=y,r[y]=g,r.pop(),delete h[a],0===Object.keys(h).length&&delete l[o]},_lendBinding:function(t){const r=this._bindings,i=t._cacheIndex,o=this._nActiveBindings++,a=r[o];t._cacheIndex=o,r[o]=t,a._cacheIndex=i,r[i]=a},_takeBackBinding:function(t){const r=this._bindings,i=t._cacheIndex,o=--this._nActiveBindings,a=r[o];t._cacheIndex=o,r[o]=t,a._cacheIndex=i,r[i]=a},_lendControlInterpolant:function(){const t=this._controlInterpolants,r=this._nActiveControlInterpolants++;let i=t[r];return void 0===i&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=r,t[r]=i),i},_takeBackControlInterpolant:function(t){const r=this._controlInterpolants,i=t.__cacheIndex,o=--this._nActiveControlInterpolants,a=r[o];t.__cacheIndex=o,r[o]=t,a.__cacheIndex=i,r[i]=a},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,r,i){const o=r||this._root,a=o.uuid;let l="string"==typeof t?AnimationClip.findByName(o,t):t;const h=null!==l?l.uuid:t,g=this._actionsByClip[h];let y=null;if(void 0===i&&(i=null!==l?l.blendMode:an),void 0!==g){const t=g.actionByRoot[a];if(void 0!==t&&t.blendMode===i)return t;y=g.knownActions[0],null===l&&(l=y._clip)}if(null===l)return null;const _=new AnimationAction(this,l,r,i);return this._bindAction(_,y),this._addInactiveAction(_,h,a),_},existingAction:function(t,r){const i=r||this._root,o=i.uuid,a="string"==typeof t?AnimationClip.findByName(i,t):t,l=a?a.uuid:t,h=this._actionsByClip[l];return void 0!==h&&h.actionByRoot[o]||null},stopAllAction:function(){const t=this._actions;for(let r=this._nActiveActions-1;r>=0;--r)t[r].stop();return this},update:function(t){t*=this.timeScale;const r=this._actions,i=this._nActiveActions,o=this.time+=t,a=Math.sign(t),l=this._accuIndex^=1;for(let y=0;y!==i;++y){r[y]._update(o,t,a,l)}const h=this._bindings,g=this._nActiveBindings;for(let y=0;y!==g;++y)h[y].apply(l);return this},setTime:function(t){this.time=0;for(let r=0;r<this._actions.length;r++)this._actions[r].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const r=this._actions,i=t.uuid,o=this._actionsByClip,a=o[i];if(void 0!==a){const t=a.knownActions;for(let i=0,o=t.length;i!==o;++i){const o=t[i];this._deactivateAction(o);const a=o._cacheIndex,l=r[r.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,l._cacheIndex=a,r[a]=l,r.pop(),this._removeInactiveBindingsForAction(o)}delete o[i]}},uncacheRoot:function(t){const r=t.uuid,i=this._actionsByClip;for(const a in i){const t=i[a].actionByRoot[r];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const o=this._bindingsByRootAndName[r];if(void 0!==o)for(const a in o){const t=o[a];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(t,r){const i=this.existingAction(t,r);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Uniform{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}function InstancedInterleavedBuffer(t,r,i){InterleavedBuffer.call(this,t,r),this.meshPerAttribute=i||1}function GLBufferAttribute(t,r,i,o,a){this.buffer=t,this.type=r,this.itemSize=i,this.elementSize=o,this.count=a,this.version=0}function Raycaster(t,r,i,o){this.ray=new Ray(t,r),this.near=i||0,this.far=o||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(t,r){return t.distance-r.distance}function intersectObject(t,r,i,o){if(t.layers.test(r.layers)&&t.raycast(r,i),!0===o){const o=t.children;for(let t=0,a=o.length;t<a;t++)intersectObject(o[t],r,i,!0)}}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(t){return InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const r=InterleavedBuffer.prototype.clone.call(this,t);return r.meshPerAttribute=this.meshPerAttribute,r},toJSON:function(t){const r=InterleavedBuffer.prototype.toJSON.call(this,t);return r.isInstancedInterleavedBuffer=!0,r.meshPerAttribute=this.meshPerAttribute,r}}),Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,r){return this.type=t,this.elementSize=r,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Raycaster.prototype,{set:function(t,r){this.ray.set(t,r)},setFromCamera:function(t,r){r&&r.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(r.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(r).sub(this.ray.origin).normalize(),this.camera=r):r&&r.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(r.near+r.far)/(r.near-r.far)).unproject(r),this.ray.direction.set(0,0,-1).transformDirection(r.matrixWorld),this.camera=r):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,r,i){const o=i||[];return intersectObject(t,this,o,r),o.sort(ascSort),o},intersectObjects:function(t,r,i){const o=i||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(let a=0,l=t.length;a<l;a++)intersectObject(t[a],this,o,r);return o.sort(ascSort),o}});class Spherical{constructor(t=1,r=0,i=0){return this.radius=t,this.phi=r,this.theta=i,this}set(t,r,i){return this.radius=t,this.phi=r,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,r,i){return this.radius=Math.sqrt(t*t+r*r+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Qn.clamp(r/this.radius,-1,1))),this}}class Cylindrical{constructor(t,r,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==r?r:0,this.y=void 0!==i?i:0,this}set(t,r,i){return this.radius=t,this.theta=r,this.y=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,r,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=r,this}}const Ia=new Vector2;class Box2{constructor(t,r){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Vector2(1/0,1/0),this.max=void 0!==r?r:new Vector2(-1/0,-1/0)}set(t,r){return this.min.copy(t),this.max.copy(r),this}setFromPoints(t){this.makeEmpty();for(let r=0,i=t.length;r<i;r++)this.expandByPoint(t[r]);return this}setFromCenterAndSize(t,r){const i=Ia.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Vector2),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,r){return void 0===r&&(console.warn("THREE.Box2: .getParameter() target is now required"),r=new Vector2),r.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,r){return void 0===r&&(console.warn("THREE.Box2: .clampPoint() target is now required"),r=new Vector2),r.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ia.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ra=new Vector3,ja=new Vector3;class Line3{constructor(t,r){this.start=void 0!==t?t:new Vector3,this.end=void 0!==r?r:new Vector3}set(t,r){return this.start.copy(t),this.end.copy(r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Vector3),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Vector3),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,r){return void 0===r&&(console.warn("THREE.Line3: .at() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,r){Ra.subVectors(t,this.start),ja.subVectors(this.end,this.start);const i=ja.dot(ja);let o=ja.dot(Ra)/i;return r&&(o=Qn.clamp(o,0,1)),o}closestPointToPoint(t,r,i){const o=this.closestPointToPointParameter(t,r);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(o).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function ImmediateRenderObject(t){Object3D.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const Na=new Vector3;class SpotLightHelper extends Object3D{constructor(t,r){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const i=new BufferGeometry,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let l=0,h=1,g=32;l<g;l++,h++){const t=l/g*Math.PI*2,r=h/g*Math.PI*2;o.push(Math.cos(t),Math.sin(t),1,Math.cos(r),Math.sin(r),1)}i.setAttribute("position",new Float32BufferAttribute(o,3));const a=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),Na.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Na),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ka=new Vector3,Da=new Matrix4,Ba=new Matrix4;class SkeletonHelper extends LineSegments{constructor(t){const r=getBoneList(t),i=new BufferGeometry,o=[],a=[],l=new Color(0,0,1),h=new Color(0,1,0);for(let g=0;g<r.length;g++){const t=r[g];t.parent&&t.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),a.push(l.r,l.g,l.b),a.push(h.r,h.g,h.b))}i.setAttribute("position",new Float32BufferAttribute(o,3)),i.setAttribute("color",new Float32BufferAttribute(a,3));super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=r,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const r=this.bones,i=this.geometry,o=i.getAttribute("position");Ba.getInverse(this.root.matrixWorld);for(let a=0,l=0;a<r.length;a++){const t=r[a];t.parent&&t.parent.isBone&&(Da.multiplyMatrices(Ba,t.matrixWorld),ka.setFromMatrixPosition(Da),o.setXYZ(l,ka.x,ka.y,ka.z),Da.multiplyMatrices(Ba,t.parent.matrixWorld),ka.setFromMatrixPosition(Da),o.setXYZ(l+1,ka.x,ka.y,ka.z),l+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function getBoneList(t){const r=[];t&&t.isBone&&r.push(t);for(let i=0;i<t.children.length;i++)r.push.apply(r,getBoneList(t.children[i]));return r}class PointLightHelper extends Mesh{constructor(t,r,i){super(new SphereBufferGeometry(r,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Fa=new Vector3,Ga=new Color,Ha=new Color;class HemisphereLightHelper extends Object3D{constructor(t,r,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const o=new OctahedronBufferGeometry(r);o.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const a=o.getAttribute("position"),l=new Float32Array(3*a.count);o.setAttribute("color",new BufferAttribute(l,3)),this.add(new Mesh(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const r=t.geometry.getAttribute("color");Ga.copy(this.light.color),Ha.copy(this.light.groundColor);for(let t=0,i=r.count;t<i;t++){const o=t<i/2?Ga:Ha;r.setXYZ(t,o.r,o.g,o.b)}r.needsUpdate=!0}t.lookAt(Fa.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(t,r,i,o){t=t||10,r=r||10,i=new Color(void 0!==i?i:4473924),o=new Color(void 0!==o?o:8947848);const a=r/2,l=t/r,h=t/2,g=[],y=[];for(let x=0,w=0,S=-h;x<=r;x++,S+=l){g.push(-h,0,S,h,0,S),g.push(S,0,-h,S,0,h);const t=x===a?i:o;t.toArray(y,w),w+=3,t.toArray(y,w),w+=3,t.toArray(y,w),w+=3,t.toArray(y,w),w+=3}const _=new BufferGeometry;_.setAttribute("position",new Float32BufferAttribute(g,3)),_.setAttribute("color",new Float32BufferAttribute(y,3));super(_,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t,r,i,o,a,l){t=t||10,r=r||16,i=i||8,o=o||64,a=new Color(void 0!==a?a:4473924),l=new Color(void 0!==l?l:8947848);const h=[],g=[];for(let _=0;_<=r;_++){const i=_/r*(2*Math.PI),o=Math.sin(i)*t,y=Math.cos(i)*t;h.push(0,0,0),h.push(o,0,y);const x=1&_?a:l;g.push(x.r,x.g,x.b),g.push(x.r,x.g,x.b)}for(let _=0;_<=i;_++){const r=1&_?a:l,y=t-t/i*_;for(let t=0;t<o;t++){let i=t/o*(2*Math.PI),a=Math.sin(i)*y,l=Math.cos(i)*y;h.push(a,0,l),g.push(r.r,r.g,r.b),i=(t+1)/o*(2*Math.PI),a=Math.sin(i)*y,l=Math.cos(i)*y,h.push(a,0,l),g.push(r.r,r.g,r.b)}}const y=new BufferGeometry;y.setAttribute("position",new Float32BufferAttribute(h,3)),y.setAttribute("color",new Float32BufferAttribute(g,3));super(y,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Va=new Vector3,Ua=new Vector3,za=new Vector3;class DirectionalLightHelper extends Object3D{constructor(t,r,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===r&&(r=1);let o=new BufferGeometry;o.setAttribute("position",new Float32BufferAttribute([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));const a=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(o,a),this.add(this.lightPlane),o=new BufferGeometry,o.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(o,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Va.setFromMatrixPosition(this.light.matrixWorld),Ua.setFromMatrixPosition(this.light.target.matrixWorld),za.subVectors(Ua,Va),this.lightPlane.lookAt(Ua),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ua),this.targetLine.scale.z=za.length()}}const Wa=new Vector3,qa=new Camera;class CameraHelper extends LineSegments{constructor(t){const r=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],a=[],l={},h=new Color(16755200),g=new Color(16711680),y=new Color(43775),_=new Color(16777215),x=new Color(3355443);function addLine(t,r,i){addPoint(t,i),addPoint(r,i)}function addPoint(t,r){o.push(0,0,0),a.push(r.r,r.g,r.b),void 0===l[t]&&(l[t]=[]),l[t].push(o.length/3-1)}addLine("n1","n2",h),addLine("n2","n4",h),addLine("n4","n3",h),addLine("n3","n1",h),addLine("f1","f2",h),addLine("f2","f4",h),addLine("f4","f3",h),addLine("f3","f1",h),addLine("n1","f1",h),addLine("n2","f2",h),addLine("n3","f3",h),addLine("n4","f4",h),addLine("p","n1",g),addLine("p","n2",g),addLine("p","n3",g),addLine("p","n4",g),addLine("u1","u2",y),addLine("u2","u3",y),addLine("u3","u1",y),addLine("c","t",_),addLine("p","c",x),addLine("cn1","cn2",x),addLine("cn3","cn4",x),addLine("cf1","cf2",x),addLine("cf3","cf4",x),r.setAttribute("position",new Float32BufferAttribute(o,3)),r.setAttribute("color",new Float32BufferAttribute(a,3)),super(r,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update()}update(){const t=this.geometry,r=this.pointMap;qa.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",r,t,qa,0,0,-1),setPoint("t",r,t,qa,0,0,1),setPoint("n1",r,t,qa,-1,-1,-1),setPoint("n2",r,t,qa,1,-1,-1),setPoint("n3",r,t,qa,-1,1,-1),setPoint("n4",r,t,qa,1,1,-1),setPoint("f1",r,t,qa,-1,-1,1),setPoint("f2",r,t,qa,1,-1,1),setPoint("f3",r,t,qa,-1,1,1),setPoint("f4",r,t,qa,1,1,1),setPoint("u1",r,t,qa,.7,1.1,-1),setPoint("u2",r,t,qa,-.7,1.1,-1),setPoint("u3",r,t,qa,0,2,-1),setPoint("cf1",r,t,qa,-1,0,1),setPoint("cf2",r,t,qa,1,0,1),setPoint("cf3",r,t,qa,0,-1,1),setPoint("cf4",r,t,qa,0,1,1),setPoint("cn1",r,t,qa,-1,0,-1),setPoint("cn2",r,t,qa,1,0,-1),setPoint("cn3",r,t,qa,0,-1,-1),setPoint("cn4",r,t,qa,0,1,-1),t.getAttribute("position").needsUpdate=!0}}function setPoint(t,r,i,o,a,l,h){Wa.set(a,l,h).unproject(o);const g=r[t];if(void 0!==g){const t=i.getAttribute("position");for(let r=0,i=g.length;r<i;r++)t.setXYZ(g[r],Wa.x,Wa.y,Wa.z)}}const $a=new Box3;class BoxHelper extends LineSegments{constructor(t,r=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),a=new BufferGeometry;a.setIndex(new BufferAttribute(i,1)),a.setAttribute("position",new BufferAttribute(o,3)),super(a,new LineBasicMaterial({color:r,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&$a.setFromObject(this.object),$a.isEmpty())return;const r=$a.min,i=$a.max,o=this.geometry.attributes.position,a=o.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=r.x,a[4]=i.y,a[5]=i.z,a[6]=r.x,a[7]=r.y,a[8]=i.z,a[9]=i.x,a[10]=r.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=r.z,a[15]=r.x,a[16]=i.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=i.x,a[22]=r.y,a[23]=r.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this}}class Box3Helper extends LineSegments{constructor(t,r=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new BufferGeometry;o.setIndex(new BufferAttribute(i,1)),o.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(o,new LineBasicMaterial({color:r,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const r=this.box;r.isEmpty()||(r.getCenter(this.position),r.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}}class PlaneHelper extends Line{constructor(t,r,i){const o=void 0!==i?i:16776960,a=new BufferGeometry;a.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),a.computeBoundingSphere(),super(a,new LineBasicMaterial({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=void 0===r?1:r;const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),l.computeBoundingSphere(),this.add(new Mesh(l,new MeshBasicMaterial({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let r=-this.plane.constant;Math.abs(r)<1e-8&&(r=1e-8),this.scale.set(.5*this.size,.5*this.size,r),this.children[0].material.side=r<0?P:T,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}const Xa=new Vector3;let Ka,Ya;class ArrowHelper extends Object3D{constructor(t,r,i,o,a,l){super(),this.type="ArrowHelper",void 0===t&&(t=new Vector3(0,0,1)),void 0===r&&(r=new Vector3(0,0,0)),void 0===i&&(i=1),void 0===o&&(o=16776960),void 0===a&&(a=.2*i),void 0===l&&(l=.2*a),void 0===Ka&&(Ka=new BufferGeometry,Ka.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),Ya=new CylinderBufferGeometry(0,.5,1,5,1),Ya.translate(0,-.5,0)),this.position.copy(r),this.line=new Line(Ka,new LineBasicMaterial({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(Ya,new MeshBasicMaterial({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,a,l)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Xa.set(t.z,0,-t.x).normalize();const r=Math.acos(t.y);this.quaternion.setFromAxisAngle(Xa,r)}}setLength(t,r,i){void 0===r&&(r=.2*t),void 0===i&&(i=.2*r),this.line.scale.set(1,Math.max(1e-4,t-r),1),this.line.updateMatrix(),this.cone.scale.set(i,r,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class AxesHelper extends LineSegments{constructor(t=1){const r=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(r,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const Za=Math.pow(2,8),Qa=[.125,.215,.35,.446,.526,.582],Ja=5+Qa.length,es=20,ts={[dn]:0,[hn]:1,[fn]:2,[gn]:3,[vn]:4,[yn]:5,[pn]:6},ns=new OrthographicCamera,{_lodPlanes:rs,_sizeLods:os,_sigmas:as}=_createPlanes();let ss=null;const cs=(1+Math.sqrt(5))/2,ls=1/cs,us=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,cs,ls),new Vector3(0,cs,-ls),new Vector3(ls,0,cs),new Vector3(-ls,0,cs),new Vector3(cs,ls,0),new Vector3(-cs,ls,0)];class PMREMGenerator{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function _getBlurShader(t){const r=new Float32Array(t),i=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:ts[dn]},outputEncoding:{value:ts[dn]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:L,depthTest:!1,depthWrite:!1})}(es),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,r=0,i=.1,o=100){ss=this._renderer.getRenderTarget();const a=this._allocateTargets();return this._sceneToCubeUV(t,i,o,a),r>0&&this._blur(a,0,0,r),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<rs.length;t++)rs[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(ss),t.scissorTest=!1,_setViewport(t,0,0,t.width,t.height)}_fromTexture(t){ss=this._renderer.getRenderTarget();const r=this._allocateTargets(t);return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(t){const r={magFilter:Pe,minFilter:Pe,generateMipmaps:!1,type:De,format:et,encoding:_isLDR(t)?t.encoding:fn,depthBuffer:!1},i=_createRenderTarget(r);return i.depthBuffer=!t,this._pingPongRenderTarget=_createRenderTarget(r),i}_compileMaterial(t){const r=new Mesh(rs[0],t);this._renderer.compile(r,ns)}_sceneToCubeUV(t,r,i,o){const a=new PerspectiveCamera(90,1,r,i),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],g=this._renderer,y=g.outputEncoding,_=g.toneMapping,x=g.getClearColor(),w=g.getClearAlpha();g.toneMapping=de,g.outputEncoding=dn;let S=t.background;if(S&&S.isColor){S.convertSRGBToLinear();const r=Math.max(S.r,S.g,S.b),i=Math.min(Math.max(Math.ceil(Math.log2(r)),-128),127);S=S.multiplyScalar(Math.pow(2,-i));const o=(i+128)/255;g.setClearColor(S,o),t.background=null}for(let M=0;M<6;M++){const r=M%3;0==r?(a.up.set(0,l[M],0),a.lookAt(h[M],0,0)):1==r?(a.up.set(0,0,l[M]),a.lookAt(0,h[M],0)):(a.up.set(0,l[M],0),a.lookAt(0,0,h[M])),_setViewport(o,r*Za,M>2?Za:0,Za,Za),g.setRenderTarget(o),g.render(t,a)}g.toneMapping=_,g.outputEncoding=y,g.setClearColor(x,w)}_textureToCubeUV(t,r){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());const o=t.isCubeTexture?this._cubemapShader:this._equirectShader,a=new Mesh(rs[0],o),l=o.uniforms;l.envMap.value=t,t.isCubeTexture||l.texelSize.value.set(1/t.image.width,1/t.image.height),l.inputEncoding.value=ts[t.encoding],l.outputEncoding.value=ts[r.texture.encoding],_setViewport(r,0,0,3*Za,2*Za),i.setRenderTarget(r),i.render(a,ns)}_applyPMREM(t){const r=this._renderer,i=r.autoClear;r.autoClear=!1;for(let o=1;o<Ja;o++){const r=Math.sqrt(as[o]*as[o]-as[o-1]*as[o-1]),i=us[(o-1)%us.length];this._blur(t,o-1,o,r,i)}r.autoClear=i}_blur(t,r,i,o,a){const l=this._pingPongRenderTarget;this._halfBlur(t,l,r,i,o,"latitudinal",a),this._halfBlur(l,t,i,i,o,"longitudinal",a)}_halfBlur(t,r,i,o,a,l,h){const g=this._renderer,y=this._blurMaterial;"latitudinal"!==l&&"longitudinal"!==l&&console.error("blur direction must be either latitudinal or longitudinal!");const _=new Mesh(rs[o],y),x=y.uniforms,w=os[i]-1,S=isFinite(a)?Math.PI/(2*w):2*Math.PI/39,M=a/S,T=isFinite(a)?1+Math.floor(3*M):es;T>es&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${T} samples when the maximum is set to 20`);const P=[];let C=0;for(let O=0;O<es;++O){const t=O/M,r=Math.exp(-t*t/2);P.push(r),0==O?C+=r:O<T&&(C+=2*r)}for(let O=0;O<P.length;O++)P[O]=P[O]/C;x.envMap.value=t.texture,x.samples.value=T,x.weights.value=P,x.latitudinal.value="latitudinal"===l,h&&(x.poleAxis.value=h),x.dTheta.value=S,x.mipInt.value=8-i,x.inputEncoding.value=ts[t.texture.encoding],x.outputEncoding.value=ts[t.texture.encoding];const A=os[o];_setViewport(r,3*Math.max(0,Za-2*A),(0===o?0:2*Za)+2*A*(o>4?o-8+4:0),3*A,2*A),g.setRenderTarget(r),g.render(_,ns)}}function _isLDR(t){return void 0!==t&&t.type===De&&(t.encoding===dn||t.encoding===hn||t.encoding===pn)}function _createPlanes(){const t=[],r=[],i=[];let o=8;for(let a=0;a<Ja;a++){const l=Math.pow(2,o);r.push(l);let h=1/l;a>4?h=Qa[a-8+4-1]:0==a&&(h=0),i.push(h);const g=1/(l-1),y=-g/2,_=1+g/2,x=[y,y,_,y,_,_,y,y,_,_,y,_],w=6,S=6,M=3,T=2,P=1,C=new Float32Array(M*S*w),A=new Float32Array(T*S*w),O=new Float32Array(P*S*w);for(let t=0;t<w;t++){const r=t%3*2/3-1,i=t>2?0:-1,o=[r,i,0,r+2/3,i,0,r+2/3,i+1,0,r,i,0,r+2/3,i+1,0,r,i+1,0];C.set(o,M*S*t),A.set(x,T*S*t);const a=[t,t,t,t,t,t];O.set(a,P*S*t)}const L=new BufferGeometry;L.setAttribute("position",new BufferAttribute(C,M)),L.setAttribute("uv",new BufferAttribute(A,T)),L.setAttribute("faceIndex",new BufferAttribute(O,P)),t.push(L),o>4&&o--}return{_lodPlanes:t,_sizeLods:r,_sigmas:i}}function _createRenderTarget(t){const r=new WebGLRenderTarget(3*Za,3*Za,t);return r.texture.mapping=we,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _setViewport(t,r,i,o,a){t.viewport.set(r,i,o,a),t.scissor.set(r,i,o,a)}function _getEquirectShader(){return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:ts[dn]},outputEncoding:{value:ts[dn]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${_getEncodings()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:L,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ts[dn]},outputEncoding:{value:ts[dn]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${_getEncodings()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:L,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _getEncodings(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Face4(t,r,i,o,a,l,h){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(t,r,i,a,l,h)}const ds=0,hs=1,ps=0,fs=1,ms=2;function MeshFaceMaterial(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function MultiMaterial(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function PointCloud(t,r){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(t,r)}function Particle(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(t)}function ParticleSystem(t,r){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(t,r)}function PointCloudMaterial(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleBasicMaterial(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleSystemMaterial(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function Vertex(t,r,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(t,r,i)}function DynamicBufferAttribute(t,r){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(t,r).setUsage(Gn)}function Int8Attribute(t,r){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(t,r)}function Uint8Attribute(t,r){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(t,r)}function Uint8ClampedAttribute(t,r){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(t,r)}function Int16Attribute(t,r){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(t,r)}function Uint16Attribute(t,r){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(t,r)}function Int32Attribute(t,r){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(t,r)}function Uint32Attribute(t,r){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(t,r)}function Float32Attribute(t,r){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(t,r)}function Float64Attribute(t,r){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(t,r)}function ClosedSplineCurve3(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom",this.closed=!0}function SplineCurve3(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function Spline(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function AxisHelper(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(t)}function BoundingBoxHelper(t,r){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(t,r)}function EdgesHelper(t,r){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(t.geometry),new LineBasicMaterial({color:void 0!==r?r:16777215}))}function WireframeHelper(t,r){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(t.geometry),new LineBasicMaterial({color:void 0!==r?r:16777215}))}function XHRLoader(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(t)}function BinaryTextureLoader(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(t)}function WebGLRenderTargetCube(t,r,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(t,i)}Curve.create=function(t,r){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=r,t},Object.assign(CurvePath.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const r=this.getPoints(t);return this.createGeometry(r)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const r=this.getSpacedPoints(t);return this.createGeometry(r)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const r=new Geometry;for(let i=0,o=t.length;i<o;i++){const o=t[i];r.vertices.push(new Vector3(o.x,o.y,o.z||0))}return r}}),Object.assign(Path.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),oa.extractUrlBase(t)}}),Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Box2.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Box3.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Frustum.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Line3.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Qn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Qn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Qn.ceilPowerOfTwo(t)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(t,r){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,r)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,r){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,r)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,r,i,o,a,l){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,r,o,i,a,l)}}),Plane.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Quaternion.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,r)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Triangle,{barycoordFromPoint:function(t,r,i,o,a){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(t,r,i,o,a)},normal:function(t,r,i,o){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(t,r,i,o)}}),Object.assign(Shape.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,t)}}),Object.assign(Vector2.prototype,{fromAttribute:function(t,r,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,r,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,r){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(r,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,r,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,r,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(t,r,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,r,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Object3D.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,r){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(r,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),cn},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),PerspectiveCamera.prototype.setLens=function(t,r){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==r&&(this.filmGauge=r),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Gn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Gn)}}}),Object.assign(BufferAttribute.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Gn:Fn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,r){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),r&&r.isBufferAttribute||r&&r.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(r),this):this.setAttribute(t,r):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new BufferAttribute(arguments[1],arguments[2])))},addDrawCall:function(t,r,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,r)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Gn},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Gn:Fn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===A}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(t,r,i,o){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(r,i,o)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?hn:dn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Audio.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const r=this;return(new AudioLoader).load(t,(function(t){r.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,r){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,r)},CubeCamera.prototype.clear=function(t,r,i,o){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,r,i,o)};const gs={merge:function(t,r,i){let o;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),r.isMesh&&(r.matrixAutoUpdate&&r.updateMatrix(),o=r.matrix,r=r.geometry),t.merge(r,o,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}er.crossOrigin=void 0,er.loadTexture=function(t,r,i,o){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const a=new TextureLoader;a.setCrossOrigin(this.crossOrigin);const l=a.load(t,i,void 0,o);return r&&(l.mapping=r),l},er.loadTextureCube=function(t,r,i,o){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const a=new CubeTextureLoader;a.setCrossOrigin(this.crossOrigin);const l=a.load(t,i,void 0,o);return r&&(l.mapping=r),l},er.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},er.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const vs={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:o}}))},function(t,r,i){"use strict";i.d(r,"c",(function(){return setTestData})),i.d(r,"b",(function(){return o})),i.d(r,"a",(function(){return a}));var o,a,l=i(19),h=i.n(l);function setTestData(t,r){return!!t&&(Object.entries(r).forEach((function(r){var i=h()(r,2),o=i[0],a=i[1],l="".concat(o.charAt(0).toUpperCase()).concat(o.slice(1));void 0===a?delete t.dataset["test".concat(l)]:t.dataset["test".concat(l)]=a})),!0)}!function(t){t.Anchor="anchor",t.Blinking="blinking",t.Color="color",t.Dragging="dragging",t.Editable="editable",t.Element="element",t.EnPassant="enPassant",t.File="file",t.Figurine="figurine",t.Flipped="flipped",t.Inside="inside",t.Interval="interval",t.LeadingFigurine="leadingFigurine",t.Opacity="opacity",t.Outside="outside",t.Position="position",t.Rank="rank",t.Selected="selected",t.ShortString="shortstring",t.Square="square",t.Star="star",t.TextColor="textColor",t.TextValue="textValue",t.Times="times",t.TrailingFigurine="trailingFigurine",t.Type="type",t.WholeMoveNumber="wholeMoveNumber",t.X="x",t.Y="y"}(o||(o={})),function(t){t.Arrow="arrow",t.BlinkingSquare="blinking-square",t.Board="board",t.Coordinates="coordinates",t.CustomItem="custom-item",t.Effect="effect",t.FadeInOverlay="fade-in-overlay",t.GameResult="game-result",t.HalfMove="half-move",t.Highlight="highlight",t.Hint="hint",t.HoverSquare="hover-square",t.Move="move",t.Piece="piece",t.PotentialCapture="capture-hint",t.PromotionCloseButton="promotion-close-button",t.PromotionPiece="promotion-piece",t.PromotionWindow="promotion-window",t.Square="square",t.SiblingBoard="sibling-board"}(a||(a={}))},function(t,r,i){"use strict";var o;i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return l})),i.d(r,"c",(function(){return h})),i.d(r,"d",(function(){return g})),function(t){t.Mousedown="mousedown",t.MouseMove="mousemove",t.Mouseup="mouseup",t.PointerDown="pointerdown",t.PointerMove="pointermove",t.PointerUp="pointerup",t.Touchstart="touchstart",t.Touchmove="touchmove",t.Touchend="touchend"}(o||(o={}));var a=function getPointerEvents(){var t,r,i,a="onpointerdown"in window,l="ontouchstart"in window;a?(t=o.PointerDown,r=o.PointerMove,i=o.PointerUp):l?(t=o.Touchstart,r=o.Touchmove,i=o.Touchend):(t=o.Mousedown,r=o.MouseMove,i=o.Mouseup);return{Pointerdown:t,Pointermove:r,Pointerup:i}}(),l=a.Pointerdown,h=a.Pointermove,g=a.Pointerup},function(t,r,i){var o=i(86),a=i(87),l=i(73),h=i(88);t.exports=function _toConsumableArray(t){return o(t)||a(t)||l(t)||h()}},function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o;i(2);!function(t){!function(t){!function(t){t.Arcade="arcade",t.Default="default",t.Fast="fast",t.Natural="natural",t.None="none",t.Slow="slow"}(t.Types||(t.Types={})),function(t){t[t.Default=250]="Default",t[t.Fast=150]="Fast",t[t.Slow=500]="Slow"}(t.Speeds||(t.Speeds={}))}(t.Animation||(t.Animation={})),function(t){t.Selected="#ffff00",t.Blue="#52b0dc",t.Green="#acce59",t.Orange="#ffaa00",t.Red="#eb6150"}(t.HighlightedSquareColors||(t.HighlightedSquareColors={})),function(t){t.Analysis="analysis",t.Move="move",t.Selected="selected"}(t.HighlightedSquareTypes||(t.HighlightedSquareTypes={})),function(t){t.Blue="rgba(72, 193, 249, 0.8)",t.Green="rgba(159, 207, 63, 0.8)",t.Orange="rgba(255, 170, 0, 0.8)",t.Red="rgba(248, 85, 63, 0.8)"}(t.HighlightedArrowColors||(t.HighlightedArrowColors={})),function(t){t.Inside="inside",t.Off="off",t.Outside="outside"}(t.CoordinatesPositions||(t.CoordinatesPositions={})),function(t){t.Click="click",t.Drag="drag"}(t.MoveMethods||(t.MoveMethods={})),function(t){t.Figurine="figurine",t.Text="text"}(t.MoveListDisplayTypes||(t.MoveListDisplayTypes={})),function(t){t.HoverSquareOutline="hoverSquareOutline"}(t.BooleanOptions||(t.BooleanOptions={})),function(t){t.AnimationType="animationType",t.BoardStyle="boardStyle",t.Coordinates="coordinates",t.DarkMode="darkMode",t.HighlightLegalMoves="highlightLegalMoves",t.HighlightMoves="highlightMoves",t.MoveListDisplayType="moveListDisplayType",t.PieceStyle="pieceStyle",t.SoundTheme="soundTheme",t.PlaySounds="playSounds"}(t.SaveableOptions||(t.SaveableOptions={}))}(o||(o={}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return S}));var o=i(45),a=i.n(o),l=i(56),h=i.n(l),g=i(62),y=i.n(g),_=i(38),x=i.n(_),w=i(63);function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=x()(t);if(r){var a=x()(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return y()(this,i)}}var S=function(t){h()(ChessError,t);var r=_createSuper(ChessError);function ChessError(t){var i,o=t.code,l=t.message,h=t.data;return a()(this,ChessError),(i=r.call(this,l)).code=o,i.data=h,i.message=l,i.name="ChessError",i}return ChessError}(i.n(w)()(Error))},function(t,r,i){"use strict";var o;i.d(r,"a",(function(){return o})),function(t){t.BadData="Bad Data",t.BeforeStateHooksConflict="Before State hooks conflict",t.DOMDoesNotMatchJCE="DOM Does Not Match JCE",t.ElementAlreadyExists="Element Already Exists",t.ElementNotFound="Element Not Found",t.IllegalJCECall="Illegal JCE Call",t.IncorrectMode="Incorrect Mode",t.InvalidStateMachine="Invalid State Machine",t.MissingPluginDependency="Missing Plugin Dependency"}(o||(o={}))},function(t,r,i){"use strict";function easeLinear(t){return t}function easeOutQuadratic(t){return t*(2-t)}function easeInOutQuadratic(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function easeInOutCubic(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function easeInOutQuartic(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}i.d(r,"d",(function(){return easeLinear})),i.d(r,"e",(function(){return easeOutQuadratic})),i.d(r,"b",(function(){return easeInOutQuadratic})),i.d(r,"a",(function(){return easeInOutCubic})),i.d(r,"c",(function(){return easeInOutQuartic}))},function(t,r,i){"use strict";function createCollection(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t;function get(t){if(void 0===r[t])throw new Error("Requested object at key ".concat(t," is undefined."));return r[t]}function getCollection(){return r}function set(t,i){r[t]=i}function keys(){return Object.keys(r)}function isDefined(t){return void 0!==r[t]}function deleteItem(t){delete r[t]}return{deleteItem:deleteItem,get:get,getCollection:getCollection,isDefined:isDefined,keys:keys,set:set}}i.d(r,"a",(function(){return createCollection}))},function(t,r,i){"use strict";var o,a;i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a})),function(t){t.Pseudo3d="pseudo3d"}(o||(o={})),function(t){t.Arrows="arrows",t.BlinkingSquares="blinking-squares",t.CaptureHints="capture-hints",t.Coordinates="coordinates",t.Effects="effects",t.FadeSetup="fade-setup",t.HoverSquare="hover-square",t.MoveHints="move-hints",t.Pieces="pieces",t.PromotionWindow="promotion-window",t.Squares="squares"}(a||(a={}))},function(t,r,i){"use strict";function animatePiece(t,r){var i=r.piece,o=r.type,a=r.animation,l=r.onEnd,h=t.state,g=h.animator,y=h.pieceAnimations;y[i.id]&&!y[i.id].animation.ended&&g.end(y[i.id].animation),y[i.id]={animation:a,type:o},a.onEnd((function(t){null==l||l(t),y[i.id]&&y[i.id].animation===t&&delete y[i.id]}))}function endAllPiecesAnimation(t,r){var i=t.animator,o=t.pieceAnimations;Object.keys(o).forEach((function(t){var a=o[t];r&&r!==a.type||(i.end(a.animation),delete o[t])}))}function endPieceAnimation(t,r){var i=t.animator,o=t.pieceAnimations[r.id];o&&!o.animation.ended&&i.end(o.animation)}function isAnimating(t,r){var i=t.state,o=i.animator;if("Move"===r){var a=i.pieceAnimations,l=0;return Object.values(a).forEach((function(t){var r=t.animation,i=t.type;["Capture","Drop","Move","Restore"].includes(i)&&r&&!r.ended&&l++})),l>0}return o.playingAnimationsCount()>0}function isPieceAnimating(t,r){var i=r.piece,o=r.type,a=t.pieceAnimations;if(i){var l=a[i.id];return!(!l||l.animation.ended)&&(!o||o===l.type)}if(o){for(var h=Object.values(a),g=0;g<h.length;g++)if(h[g].type===o)return!0;return!1}return!1}i.d(r,"a",(function(){return animatePiece})),i.d(r,"b",(function(){return endAllPiecesAnimation})),i.d(r,"c",(function(){return endPieceAnimation})),i.d(r,"d",(function(){return isAnimating})),i.d(r,"e",(function(){return isPieceAnimating}))},function(t,r,i){"use strict";function getFileRankFromSan(t){return{file:t.toLowerCase().charCodeAt(0)-96,rank:Number(t.charAt(1))}}i.d(r,"a",(function(){return getFileRankFromSan}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return o.a})),i.d(r,"b",(function(){return positionToSquare})),i.d(r,"c",(function(){return positionToSquarePercentage})),i.d(r,"d",(function(){return setSVGAttributes})),i.d(r,"e",(function(){return squareToPiecePosition}));var o=i(34),a=i(24);function positionToSquare(t,r){var i=t.state,o=t.methods.positionToFileRank(i,r);return Object(a.a)(o)}function positionToSquarePercentage(t,r){var i=Math.floor(t.x),o=Math.floor(t.y),a=i-Math.floor(i/r)*r,l=o-Math.floor(o/r)*r;return{x:Math.floor(a/r*100),y:Math.floor(l/r*100)}}function setSVGAttributes(t,r){var i=document.createElement("div");i.innerHTML=t;var o=i.querySelector("svg");if(!o)return t;if(r.color&&(o.style.fill=r.color),r.opacity&&(o.style.opacity=String(r.opacity)),r.text){var a=o.querySelector("text");a&&(a.innerHTML=r.text.value,a.style.fontSize="0.5rem",a.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif',r.text.color&&(a.style.fill=r.text.color))}return o.outerHTML}var l=i(14);function squareToPiecePosition(t,r){var i=t.state,o=t.methods,a=Object(l.a)(r);return o.fileRankToPosition(i,a)}},function(t,r,i){"use strict";var o;i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return createWebGLRendererInstance})),function(t){t.PixelRatio=window.devicePixelRatio||1}(o||(o={}));var a=i(10);function updateAnimatedProperties(t){var r,i,o,l,h,g=t.animatedProps,y=t.animatedPropsKeyframes,_=t.frameInfo,x=t.isTargetHTMLElement,w=t.params,S=w.keyframes,M=w.target,T=_.elapsedPercentage,P=w.easing||a.d;S&&Object.keys(g).forEach((function(t){for(var a=1;a<y[t].length;a++)if(o=y[t][a-1],l=y[t][a],T>=o&&T<=l){r=S[o][t],i=S[l][t];break}h=P(h=(T-o)/(l-o)),g[t]=r+(i-r)*h,M&&!x&&(M[t]=g[t])}))}function createAnimation(t){var r=t.data,i=t.keyframes,o=t.repeat,a=t.target,l=t.onEnd,h=function getAnimatedProps(t){if(!t)return{};if(!t[0])throw new Error("The animation keyframes must contain values at `0` percentage.");return Object.assign({},t[0])}(i),g={animatedProps:h,animatedPropsKeyframes:function getAnimatedPropsKeyframes(t,r){if(!r)return{};var i=Object.keys(t),o={};return i.forEach((function(t){return o[t]=[]})),Object.keys(r).sort((function(t,r){return parseInt(t,10)-parseInt(r,10)})).forEach((function(t){i.forEach((function(i){void 0!==r[t][i]&&o[i].push(parseInt(t,10))}))})),o}(h,i),data:Object.assign({},r),endCallbacks:[],ended:!1,endTime:0,forcedEnd:!1,frameInfo:{deltaTime:0,elapsedInterval:0,elapsedPercentage:0},isTargetHTMLElement:a instanceof HTMLElement,onEnd:function onEnd(t){return g.endCallbacks.push(t)},params:t,repeatCount:o||1,started:!1,startTime:0};return l&&g.endCallbacks.push(l),g}function createBaseState(t,r){var i=r.options,o=r.boardThemes,a=r.pieceThemes;return{animatedOverPiece:null,animator:function createAnimator(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=[],i=0,o=0;return{end:end,endAll:endAll,play:play,playingAnimationsCount:function playingAnimationsCount(){return r.length},update:update};function animationLoop(a){var l=.001*(a-o);r.forEach((function(t){if(!(t.startTime>a)){var r=t.frameInfo;r.deltaTime=l,(t.started||onAnimationStart(t,a))&&(t.endTime&&(r.elapsedInterval=(a-t.startTime)/(t.endTime-t.startTime),r.elapsedInterval>1&&(r.elapsedInterval=1),r.elapsedPercentage=Math.round(100*r.elapsedInterval)),onAnimationUpdate(t),t.endTime&&t.endTime<=a&&onAnimationEnd(t))}})),o=a,r.length&&!t&&(i=requestAnimationFrame(animationLoop))}function end(t){t.ended||r.indexOf(t)<0||(t.frameInfo.elapsedInterval=1,t.frameInfo.elapsedPercentage=100,onAnimationUpdate(t),onAnimationEnd(t,!0))}function endAll(){[].concat(r).forEach(end)}function onAnimationEnd(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.params,o=i.duration,a=i.repeatDelay;if(t.repeatCount--,t.forcedEnd=r,!r&&t.repeatCount>0&&o&&o!==1/0)return t.startTime=t.endTime+(a||0),void(t.endTime=t.startTime+o);t.ended=!0,t.endCallbacks.forEach((function(r){return r(t)})),removeAnimation(t)}function onAnimationStart(t,r){var i=t.params,o=i.duration,a=i.delay,l=i.onStart;return t.startTime||(t.startTime=r+(a||0),o&&o!==1/0&&(t.endTime=t.startTime+o)),!(t.startTime>r||(t.started=!0,null==l||l(t),0))}function onAnimationUpdate(t){var r=t.params.onUpdate;updateAnimatedProperties(t),null==r||r(t)}function play(o){var a=createAnimation(o);return r.push(a),i||t||startAnimationLoop(),a}function removeAnimation(i){var o=r.indexOf(i);o>=0&&r.splice(o,1),r.length||t||stopAnimationLoop()}function startAnimationLoop(){o=performance.now(),i=requestAnimationFrame(animationLoop)}function stopAnimationLoop(){i&&cancelAnimationFrame(i),i=0}function update(t){animationLoop(t)}}(!0),attackedKing:null,arrows:{},assetsLoaded:!1,blinkingSquares:{},boardId:i.id||"webglBoard",boardStyle:i.boardStyle,boardThemes:o,containerEl:t,customItems:{},destroyed:!1,effects:{},fadeSetupAnimation:null,flipCoordinates:!1,highlightedSquares:{},hints:{},hoverSquare:null,isBoardFlipped:i.flipped,isPromotionWindowVisible:!1,options:i,pieceAnimations:{},pieces:{},pieceStyle:i.pieceStyle,pieceThemes:a,pointer:{boardPosition:{x:0,y:0},down:!1,downInsideBoard:!1,insideBoard:!1,previousBoardPosition:{x:0,y:0},previousViewPosition:{x:0,y:0},rightDown:!1,secondaryDown:!1,viewPosition:{x:0,y:0}},promotionWindowAnimation:null,selectedPiece:null,squareSize:0,viewEl:document.createElement("canvas"),viewSize:{width:300,height:300}}}var l=i(13),h=i(22),g=i(33),y=i(14),_=i(51),x=i(55);function add_arrows_addArrows(t,r){var i=t.state,o=t.methods,a=i.options;Object.values(r).forEach((function(t){var r=t.color,l=t.key,h=t.opacity;i.arrows[l]&&(o.removeArrow(i,i.arrows[l]),delete i.arrows[l]);var g=l.substring(0,2),w=l.substring(2,4),S=Object(y.a)(g),M=Object(y.a)(w),T=Math.abs(S.file-M.file),P=Math.abs(S.rank-M.rank),C=1===T&&2===P||2===T&&1===P,A=Object(_.a)(r,a.arrowColors),O={color:Object(x.a)(A),from:S,isKnight:C,to:M,opacity:h||Object(x.b)(A)},L={info:O,obj:o.createArrowObj(i,O)};o.addArrow(i,L),i.arrows[l]=L}))}var w=i(2),S=i(15);function addHighlightedSquares(t,r){var i=t.state,o=t.methods,a=t.animationMethods,l=i.highlightedSquares;r.keys().forEach((function(h){var g,y;l[h]&&(o.removeHighlightedSquare(i,l[h]),delete l[h]);var _=r.get(h),x=_.color,M=_.opacity,T=_.turn,P=_.type,C={color:x||w.a.HighlightedSquare.Defaults.Color,opacity:M,position:Object(S.e)(t,h),square:h,turn:T,type:P},A={info:C,obj:(null===(g=a.createHighlightedSquareObj)||void 0===g?void 0:g.call(a,i,C))||o.createHighlightedSquareObj(i,C)};o.addHighlightedSquare(i,A),null===(y=a.showHighlightedSquare)||void 0===y||y.call(a,i,A),l[h]=A}))}function blink_squares_blinkSquares(t,r){r.keys().forEach((function(i){!function blinkSquare(t,r){var i=r.blinkInfo,o=r.square,a=t.state,l=t.methods,h=t.animationMethods,g=a.blinkingSquares,y=i.interval,_=i.times;g[o]&&(l.removeHighlightedSquare(a,g[o]),delete g[o]);var x={color:i.color||w.a.HighlightedSquare.Defaults.Color,opacity:i.opacity,position:Object(S.e)(t,o),square:o},M={info:x,obj:l.createHighlightedSquareObj(a,x)};l.addHighlightedSquare(a,M),h.blinkSquare(a,{interval:y,square:M,times:_}).onEnd((function(){l.removeHighlightedSquare(a,M),delete g[o]})),g[o]=M,a.options.test&&(x.testBlinkInfo={interval:y,times:_})}(t,{blinkInfo:r.get(i),square:i})}))}function addHints(t,r){var i=r.context,o=r.squares,a=r.type,l=t.state,h=t.methods,g=t.animationMethods,y=l.hints;o.forEach((function(r){var o,_,x,w={color:"#000000",opacity:.1,position:Object(S.e)(t,r),square:r,turn:i.api.getTurn(),type:a},M={info:w,obj:"capture"===w.type?(null===(o=g.createCaptureHintObj)||void 0===o?void 0:o.call(g,l,w))||h.createCaptureHintObj(l,w):(null===(_=g.createMoveHintObj)||void 0===_?void 0:_.call(g,l,w))||h.createMoveHintObj(l,w)};h.addHint(l,M),null===(x=g.showHint)||void 0===x||x.call(g,l,M),y[r]=M}))}var M=i(0),T=i(17);function add_custom_items_addCustomItems(t,r){var i=t.state,o=t.methods,a=i.customItems;Object.keys(r).forEach((function(l){var h=r[l],g=h.color,y=h.image,_=h.opacity,x=h.text,w=h.type,M=l,T={color:g,image:y,opacity:_,position:Object(S.e)(t,M),square:M,text:x,type:w},P={info:T,obj:o.createCustomItemObj(i,T)};o.addCustomItem(i,P),a[M]=P}))}function remove_custom_items_removeCustomItems(t,r){var i=r.animated,o=void 0!==i&&i,a=r.squares,l=t.state,h=t.methods,g=t.animationMethods,y=l.customItems;a.forEach((function(t){var r=y[t];o&&g.hideCustomItem?g.hideCustomItem(l,r).onEnd((function(){h.removeCustomItem(l,r)})):h.removeCustomItem(l,r),delete y[t]}))}function add_effects_addEffects(t,r){var i=t.state,o=t.methods,a=i.effects;Object.keys(r).forEach((function(l){var h=r[l].type,g=l,y={position:Object(S.e)(t,g),square:g,type:h},_={info:y,obj:o.createEffectObj(i,y)};o.addEffect(i,_),a[g]=_}))}function remove_effects_removeEffects(t,r){var i=t.state,o=t.methods,a=i.effects;r.forEach((function(t){o.removeEffect(i,a[t]),delete a[t]}))}function createWebGLRendererInstance(t){var r=function init(t){var r,i=t.animationMethods,o=t.boardThemes,a=t.className,g=t.containerEl,y=t.options,_=t.methods,x=t.name,w=t.pieceThemes,M=t.testElement,T=_.createState(createBaseState(g,{boardThemes:o,options:y,pieceThemes:w})),I={animationMethods:i,className:a,eventListeners:{},frameRequestId:0,lastPieceId:0,methods:_,name:x,state:T};_.init(T),null===(r=i.init)||void 0===r||r.call(i,T),T.hoverSquare=i.createHoverSquareObj?i.createHoverSquareObj(T):_.createHoverSquareObj(T),function loadAssets(t){var r,i=t.state,o=t.methods,a=t.animationMethods;Promise.all([o.loadAssets(i),null===(r=a.loadAssets)||void 0===r?void 0:r.call(a,i)]).then((function(){i.destroyed||(i.assetsLoaded=!0,Object(h.p)(t),i.containerEl.appendChild(i.viewEl))}))}(I),function addEventListeners(t){var r=t.eventListeners,i=t.state,o=t.methods,a=i.containerEl;r.pointerDown=function(r){return function onPointerDown(t,r){var i,o=t.state,a=t.methods,h=o.animatedOverPiece,g=o.containerEl,y=o.pointer,_=Object(C.a)(r,g);y.viewPosition=a.normalizePointer(o,_),y.boardPosition=a.getBoardPosition(o,y.viewPosition),y.down=!0,y.secondaryDown=function isSecondaryButton(t){return!Object(L.a)(t)&&t.which>1}(r),y.rightDown=Object(O.a)(r),y.insideBoard=Object(A.a)(o,y.boardPosition),y.downInsideBoard=y.insideBoard,null===(i=a.onPointerDown)||void 0===i||i.call(a,o),h&&(Object(l.c)(o,h),o.animatedOverPiece=null);y.previousViewPosition=y.viewPosition,y.previousBoardPosition=y.boardPosition}(t,r)},r.pointerMove=function(r){return function onPointerMove(t,r){var i,o=t.state,a=t.methods,g=t.animationMethods,y=o.containerEl,_=o.pointer,x=Object(C.a)(r,y);_.viewPosition=a.normalizePointer(o,x),_.boardPosition=a.getBoardPosition(o,_.viewPosition),_.insideBoard=Object(S.a)(o,_.boardPosition),null===(i=a.onPointerMove)||void 0===i||i.call(a,o),_.previousViewPosition=_.viewPosition,_.previousBoardPosition=_.boardPosition,g.pieceOver&&function doPieceOverAnimation(t,r){var i=t.state,o=t.animationMethods,a=i.animatedOverPiece,g=i.selectedPiece,y=Object(h.f)(t,r.boardPosition);if(g&&g===y)return;a&&a!==y&&Object(l.e)(i,{piece:a,type:"Over"})&&(Object(l.c)(i,a),o.pieceOut&&Object(l.a)(t,{animation:o.pieceOut(i,a),type:"Out",piece:a}),i.animatedOverPiece=null);y&&!Object(l.e)(i,{piece:y})&&(i.animatedOverPiece=y,o.pieceOver&&Object(l.a)(t,{animation:o.pieceOver(i,{piece:y,pointer:r}),type:"Over",piece:y,onEnd:function onEnd(){return i.animatedOverPiece=null}}))}(t,_)}(t,r)},r.pointerUp=function(r){return function onPointerUp(t,r){var i,o=t.state,a=t.methods,l=o.containerEl,h=o.pointer,g=Object(C.a)(r,l);h.viewPosition=a.normalizePointer(o,g),h.boardPosition=a.getBoardPosition(o,h.viewPosition),h.down=!1,h.downInsideBoard=!1,h.secondaryDown=!1,h.rightDown=!1,h.insideBoard=Object(A.a)(o,h.boardPosition),null===(i=a.onPointerUp)||void 0===i||i.call(a,o),h.previousViewPosition=h.viewPosition,h.previousBoardPosition=h.boardPosition}(t,r)},a.addEventListener(P.b,r.pointerDown),document.addEventListener(P.c,r.pointerMove),document.addEventListener(P.d,r.pointerUp),o.onMouseDoubleClick&&(r.doubleClick=function(r){return function onMouseDoubleClick(t,r){var i,o=t.state,a=t.methods,l=o.containerEl,h=o.pointer,g=Object(C.a)(r,l);h.viewPosition=a.normalizePointer(o,g),h.boardPosition=a.getBoardPosition(o,h.viewPosition),h.insideBoard=Object(A.a)(o,h.boardPosition),null===(i=a.onMouseDoubleClick)||void 0===i||i.call(a,o),h.previousViewPosition=h.viewPosition,h.previousBoardPosition=h.boardPosition}(t,r)},a.addEventListener("dblclick",r.doubleClick));o.onMouseWheel&&(r.wheel=function(r){return function onMouseWheel(t,r){var i;r.preventDefault();var o=t.state,a=t.methods,l=o.containerEl,h=o.pointer,g=Object(C.a)(r,l);h.viewPosition=a.normalizePointer(o,g),h.boardPosition=a.getBoardPosition(o,h.viewPosition),h.insideBoard=Object(A.a)(o,h.boardPosition),null===(i=a.onMouseWheel)||void 0===i||i.call(a,o,r.deltaY),h.previousViewPosition=h.viewPosition,h.previousBoardPosition=h.boardPosition}(t,r)},a.addEventListener("wheel",r.wheel))}(I),g.classList.add(a),onAnimatedFrameReceived(performance.now()),y.test&&function setupTestData(t,r){Object(k.c)(t.containerEl,R()({},k.b.Element,r||k.a.Board)),r===k.a.SiblingBoard?addToWindow({webglSiblingBoardState:t}):addToWindow({webglBoardState:t})}(T,M);return I;function onAnimatedFrameReceived(t){I.frameRequestId=requestAnimationFrame(onAnimatedFrameReceived),function updateLoop(t,r){var i=t.state,o=t.methods;i.animator.update(r),o.render(i,r)}(I,t)}}(t);return{addAnalysisOverlay:function addAnalysisOverlay(){return Object(g.a)(r)},addArrows:function addArrows(t){return add_arrows_addArrows(r,t)},addCaptureHints:function addCaptureHints(t,i){addHints(r,{context:i,squares:t,type:"capture"})},addCustomItems:function addCustomItems(t){return add_custom_items_addCustomItems(r,t)},addEffects:function addEffects(t){return add_effects_addEffects(r,t)},addMoveHints:function addMoveHints(t,i){addHints(r,{context:i,squares:t,type:"move"})},addSquares:function addSquares(t){addHighlightedSquares(r,t)},animationComplete:function animationComplete(t){return t&&Promise.resolve()},blinkSquares:function blinkSquares(t){blink_squares_blinkSquares(r,t)},closePromotionWindow:function closePromotionWindow(){return function close_promotion_window_closePromotionWindow(t){var r=t.state,i=t.methods,o=t.animationMethods;r.promotionWindowAnimation&&(r.animator.end(r.promotionWindowAnimation),r.promotionWindowAnimation=null),o.hidePromotionWindow?(r.promotionWindowAnimation=o.hidePromotionWindow(r),r.promotionWindowAnimation.onEnd((function(){i.closePromotionWindow(r),r.promotionWindowAnimation=null}))):i.closePromotionWindow(r),r.isPromotionWindowVisible=!1}(r)},createRenderer:createWebGLRendererInstance,destroy:function destroy(){return function destroy_destroy(t){var r,i=t.className,o=t.frameRequestId,a=t.state,l=t.methods,h=a.animator,g=a.containerEl,y=a.viewEl;a.destroyed=!0,h.endAll(),o&&cancelAnimationFrame(o);l.destroy(a),function removeEventListeners(t){var r=t.eventListeners,i=t.state.containerEl;r.pointerDown&&i.removeEventListener(P.b,r.pointerDown);r.pointerMove&&document.removeEventListener(P.c,r.pointerMove);r.pointerUp&&document.removeEventListener(P.d,r.pointerUp);r.doubleClick&&i.removeEventListener("dblclick",r.doubleClick);r.wheel&&i.removeEventListener("wheel",r.wheel)}(t),null===(r=y.parentNode)||void 0===r||r.removeChild(y),g.classList.remove(i)}(r)},dragPiece:function dragPiece(t){return Object(h.c)(r,t)},dropPiece:function dropPiece(t){return Object(h.d)(r,t)},extendRenderer:function extendRenderer(){},fadeSetup:function fadeSetup(t){return Object(g.c)(r,t.options.fadeSetup)},flipBoard:function flipBoard(t){return Object(g.d)(r,t)},getCoordsFromSquare:function getCoordsFromSquare(t){return function get_coords_from_square_getCoordsFromSquare(t,r){var i=t.state,o=t.methods,a=Object(y.a)(r),l=o.fileRankToPosition(i,a);return o.getViewPosition(i,l)}(r,t)},getPieces:function getPieces(){return Object(h.i)(r)},getPointerPosition:function getPointerPosition(t){var i=t.event;return function get_pointer_position_getPointerPosition(t,r){var i=t.state,o=t.methods,a=i.containerEl,l=Object(C.a)(r,a),h=o.normalizePointer(i,l),g=o.getBoardPosition(i,h),y=o.positionToNearestSquare(i,g);return{coords:h,coordsInsideBoard:o.getViewPosition(i,y),coordsInsideSquare:Object(S.c)(g,i.squareSize),square:Object(S.b)(t,g),squareInsideBoard:Object(S.b)(t,y)}}(r,i)},getRendererOptions:function getRendererOptions(){return t},hideHoverSquare:function hideHoverSquare(){return function hide_hover_square_hideHoverSquare(t){var r=t.state,i=t.methods,o=t.animationMethods;o.hideHoverSquare?o.hideHoverSquare(r):i.hideHoverSquare(r)}(r)},illegalMove:function illegalMove(){},isAnimating:function isAnimating(t){return Object(l.d)(r,t)},loadPieces:function loadPieces(t){var i=t.pieces,o=t.reloadAll;Object(h.j)(r,{piecesInfo:i,reloadAll:o})},makeMove:function makeMove(t,i){Object(h.k)(r,{attackedKingSquare:i.api.isCheck()||void 0,move:t})},name:t.name,openPromotionWindow:function openPromotionWindow(t,i){!function open_promotion_window_openPromotionWindow(t,r){var i=r.promotionMove,o=r.context,a=t.state,l=t.methods,h=t.animationMethods;a.promotionWindowAnimation&&(a.animator.end(a.promotionWindowAnimation),a.promotionWindowAnimation=null),l.openPromotionWindow(a,i).then((function(t){a.isPromotionWindowVisible&&(t?o.run(Object(T.a)(M.a.BoardEvents.PromotionPiecePointerdown,{piece:t})):o.run(Object(T.a)(M.a.BoardEvents.PromotionAreaClosePointerdown)))})),h.showPromotionWindow&&(a.promotionWindowAnimation=h.showPromotionWindow(a),a.promotionWindowAnimation.onEnd((function(){return a.promotionWindowAnimation=null}))),a.isPromotionWindowVisible=!0}(r,{context:i,promotionMove:t})},removeAnalysisOverlay:function removeAnalysisOverlay(){return Object(g.g)(r)},removeArrows:function removeArrows(t){return function remove_arrows_removeArrows(t,r){var i=t.state,o=t.methods;r.forEach((function(t){o.removeArrow(i,i.arrows[t]),delete i.arrows[t]}))}(r,t)},removeCustomItems:function removeCustomItems(t){var i=t.animated,o=t.squares;remove_custom_items_removeCustomItems(r,{animated:i,squares:o})},removeEffects:function removeEffects(t){return remove_effects_removeEffects(r,t)},removeHints:function removeHints(t){return function remove_hints_removeHints(t,r){var i=t.state,o=t.methods,a=t.animationMethods,l=i.hints;r.forEach((function(t){var r=l[t];a.hideHint?a.hideHint(i,r).onEnd((function(){o.removeHint(i,r)})):o.removeHint(i,r),delete l[t]}))}(r,t)},removePiece:function removePiece(t){return Object(h.m)(r,{square:t})},removeSquares:function removeSquares(t){return function removeHighlightedSquares(t,r){var i=t.state,o=t.methods,a=t.animationMethods,l=i.highlightedSquares;r.forEach((function(t){var r=l[t];a.hideHighlightedSquare?a.hideHighlightedSquare(i,r).onEnd((function(){o.removeHighlightedSquare(i,r)})):o.removeHighlightedSquare(i,r),delete l[t]}))}(r,t)},resize:function resize(){return Object(g.h)(r)},setCoordinates:function setCoordinates(t){return Object(g.i)(r,t)},showHoverSquare:function showHoverSquare(t){return function show_hover_square_showHoverSquare(t,r){var i,o=t.state,a=t.methods,l=t.animationMethods,h=Object(S.e)(t,r);l.showHoverSquare?null===(i=l.showHoverSquare)||void 0===i||i.call(l,o,h):a.showHoverSquare(o,h)}(r,t)},undoMove:function undoMove(t,i){Object(h.o)(r,{attackedKingSquare:i.api.isCheck()||void 0,move:t})},updateArrows:function updateArrows(t){return add_arrows_addArrows(r,t)},updateBoardImage:function updateBoardImage(t){Object(g.b)(r,t.options.boardStyle)},updateCustomItems:function updateCustomItems(t){return function update_custom_items_updateCustomItems(t,r){remove_custom_items_removeCustomItems(t,{squares:Object.keys(r)}),add_custom_items_addCustomItems(t,r)}(r,t)},updateEffects:function updateEffects(t){return function update_effects_updateEffects(t,r){remove_effects_removeEffects(t,Object.keys(r)),add_effects_addEffects(t,r)}(r,t)},updatePieceBaseImage:function updatePieceBaseImage(t){Object(h.b)(r,t.options.pieceStyle)},updateSquares:function updateSquares(t){addHighlightedSquares(r,t)}}}var P=i(5),C=i(26),A=i(34);var O=i(28),L=i(67);var I=i(1),R=i.n(I),j=i(21),N=i.n(j);function addToWindow(t){return Object.assign(window,t,{JCE:N.a}),t}var k=i(4)},function(t,r,i){"use strict";function createCoreEvent(t,r){return{data:r||{},type:t}}i.d(r,"a",(function(){return createCoreEvent}))},function(t,r,i){"use strict";i.d(r,"b",(function(){return o})),i.d(r,"a",(function(){return a})),i.d(r,"c",(function(){return l})),i.d(r,"d",(function(){return h}));var o={HEAD_HEIGHT:4.5,HEAD_WIDTH:6.5,TAIL_PADDING:4.5,WIDTH:2.75},a=27.95084971874737,l=[.5,-2],h=[2,.5,-.5,-2]},function(t,r,i){var o=i(91),a=i(92),l=i(73),h=i(93);t.exports=function _slicedToArray(t,r){return o(t)||a(t,r)||l(t,r)||h()}},function(t,r,i){"use strict";i.d(r,"d",(function(){return l})),i.d(r,"a",(function(){return h})),i.d(r,"b",(function(){return g})),i.d(r,"c",(function(){return getTheme}));var o=i(19),a=i.n(o),l=["wp","wn","wb","wr","wq","wk","bp","bn","bb","br","bq","bk"],h={"8_bit":["#6a9b41","#f3f3f4","8_bit",".png","#ffff00"],bases:["#c26b38","#efcca1","bases",".jpg","#f5cc2a"],blackwhite:["#667188","#282f3f","translucent",".png","#5b91b3"],blue:["#4D6D92","#ECECD7","blue",".png","#00a5ff"],brown:["#B58863","#F0D9B5","brown",".png","#ffff00"],bubblegum:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],burled_wood:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],dark_wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],dash:["#6b3a27","#bd9257","dash",".jpg","#eca722"],default:["#779952","#edeed1","green",".png","#ffff00"],glass:["#282f3f","#667188","glass",".png","#5b91b3"],graffiti:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],green:["#779952","#edeed1","green",".png","#ffff00"],grey:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],icy_sea:["#7a9db2","#c5d5dc","icy_sea",".jpg","#5ed7f1"],light:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],lolz:["#909898","#e0e9e9","lolz",".jpg","#a3becd"],marble:["#706b66","#c7bdaa","marble",".jpg","#f0db86"],marbleblue:["#c2d7e2","#efefef","marbleblue",".jpg","#65daf7"],marblebrown:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],marblegreen:["#706b66","#c7bdaa","marblegreen",".jpg","#f0db86"],metal:["#6e6e6e","#c9c9c9","metal",".jpg","#a3becd"],natural:["#D08B18","#FCE4B2","tan",".png","#f0e464"],nature:["#8c976e","#c3d1a4","translucent",".png","#eef396"],neon:["#636363","#b9b9b9","neon",".png","#6d90a6"],newspaper:["#5a5956","#5a5956","newspaper",".jpg","#99976e"],orange:["#D08B18","#FCE4B2","orange",".png","#ffff00"],overlay:["#789ebd","#4878a0","overlay",".png","#0d9acf"],parchment:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],pink:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],purple:["#8877B7","#EFEFEF","purple",".png","#7dacc9"],red:["#BA5546","#F0D8BF","red",".png","#f8f893"],sand:["#b8a590","#e5d3c4","sand",".jpg","#e2bc87"],sky:["#c2d7e2","#efefef","sky",".png","#65daf7"],stone:["#666463","#c8c3bd","stone",".jpg","#36525f"],tan:["#D08B18","#FCE4B2","tan",".png","#f7d84a"],tournament:["#316549","#ebece8","tournament",".jpg","#a4c25b"],translucent:["#667188","#282f3f","translucent",".png","#5b91b3"],walnut:["#835f42","#c0a684","walnut",".jpg","#d1a52d"],winboard:["#316549","#ebece8","tournament",".jpg","#a4c25b"],wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],wooddark:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],woodlight:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],woodmid:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],woodolive:["#6e6e6e","#c9c9c9","woodolive",".jpg","#a3becd"]},g={"3d_staunton":{format:"png",isPseudo3d:!0,path:"3d_staunton"},"3dchesskid":{format:"png",isPseudo3d:!0,path:"3d_chesskid"},"3dplastic":{format:"png",isPseudo3d:!0,path:"3d_plastic"},"3dwood":{format:"png",isPseudo3d:!0,path:"3d_wood"},"8_bit":{format:"png",path:"8_bit"},alpha:{format:"png",path:"alpha"},bases:{format:"png",path:"bases"},blindfold:{format:"png",path:"blindfold"},book:{format:"png",path:"book"},bubblegum:{format:"png",path:"bubblegum"},cases:{format:"png",path:"cases"},classic:{format:"png",path:"classic"},club:{format:"png",path:"club"},condal:{format:"png",path:"condal"},dash:{format:"png",path:"dash"},game_room:{format:"png",path:"game_room"},glass:{format:"png",path:"glass"},gothic:{format:"png",path:"gothic"},graffiti:{format:"png",path:"graffiti"},icy_sea:{format:"png",path:"icy_sea"},light:{format:"png",path:"light"},lolz:{format:"png",path:"lolz"},marble:{format:"png",path:"marble"},maya:{format:"png",path:"maya"},metal:{format:"png",path:"metal"},modern2:{format:"png",path:"modern"},nature:{format:"png",path:"nature"},neo:{format:"png",path:"neo"},neo_wood:{format:"png",path:"neo_wood"},neon:{format:"png",path:"neon"},newspaper:{format:"png",path:"newspaper"},ocean:{format:"png",path:"ocean"},real3d:{format:"png",path:"neo"},sky:{format:"png",path:"sky"},space:{format:"png",path:"space"},tigers:{format:"png",path:"tigers"},tournament:{format:"png",path:"tournament"},vintage:{format:"png",path:"vintage"},wood:{format:"png",path:"wood"}};function getTheme(t){var r=h[t];if(!r)return null;var i=a()(r,5);return{darkSquareColor:i[0],lightSquareColor:i[1],path:i[2],extension:i[3],highlightColor:i[4]}}},function(t,r,i){!function(){"use strict";var r=function(){var t=[[2637767806,863464769],[720845184,95069639],[1155203408,610415943],[2618685246,1655139042],[1971536997,1218186377],[848342074,540017087],[263957791,1627660921],[3896152207,4076560586],[226391645,1484086288],[436746274,3467632685],[2516964848,3797861296],[3491888988,3510251221],[1086189917,1248276018],[18044180,1876255637],[1572111136,1190386149],[597658413,2146900428],[97624494,2243205793],[1738507407,1854916977],[1950989311,2149575947],[2098318769,3283594736],[2194108574,2015279052],[4079062812,2500884588],[856979699,2941369318],[1270058469,3877737539],[2858720366,3170717948],[2378012835,1387254795],[2278688587,2178388503],[435406673,3555273441],[3031118064,1655806655],[2063925420,1107589828],[3376753832,436852829],[615148625,1302492416],[1285502018,1963045959],[346460119,1016137793],[2803604355,1176288659],[55085973,2968618255],[1669016372,4287873088],[164740250,1037634196],[896886403,883023163],[1935551383,2764331555],[410153072,4055711755],[533441746,1505690343],[3541084098,3466290517],[3214426080,4267541060],[2675233103,1951705124],[1374411850,3115986997],[1552073989,3684348154],[4244110986,875606593],[844343081,3115990494],[2356462440,135999605],[3116133511,377238503],[2129956651,2197966368],[299173332,3276914047],[1701379241,745972291],[1306570996,254977976],[2530644806,214138461],[1122123979,1667800879],[1831591130,3801192033],[1116211970,920967505],[1594837592,2551651254],[972591349,2046373768],[2479207924,1935030411],[1675376029,2367888248],[3960916618,3935874422],[1398143232,3265801671],[133930885,1520005442],[1351827834,2829577566],[2076951437,2723839804],[435980918,2364847828],[1668970368,3738157273],[2185864314,3993911799],[2041407829,31969768],[346864372,2004703094],[4047877822,3437142421],[3669961416,538399484],[616810829,4190688246],[3144558884,4030272234],[216165387,2513010905],[2761740594,3216997572],[3919406634,4096014649],[669429112,2434161727],[2234904640,3111407601],[1421079802,1598085235],[1924213810,310373675],[4002762044,2067865415],[2592451728,2586110625],[1890340057,4031717877],[4189625662,2577429954],[2276713138,3049850801],[2741429688,3310307512],[2924122950,3426712818],[421576781,1193704381],[2277442246,3030264553],[153237420,595540057],[4278711886,4176286928],[2380848297,4030514510],[2618700582,1303682185],[3018992701,185284845],[957243316,1291916363],[1543415220,1898408169],[504378001,531073412],[2591337657,1692896435],[1333852064,903543556],[1661259930,188168388],[561112646,2197961224],[1536910315,2632972300],[1349168372,2307429186],[411152329,2745631190],[1694697476,1081411140],[3755185459,2631660711],[4019355068,4027326706],[2066937809,3761668332],[3120395808,3878773315],[94890149,2109283191],[3045629038,358812277],[1249184265,3465901047],[3477490924,2308583306],[4114113436,3875911716],[1014604031,1434513279],[3991324799,2222416029],[2040431088,1539915569],[2253613964,4081224332],[2547464012,1611168627],[2722521980,4281500978],[71289574,213969824],[2450408597,903689630],[1894451515,364024012],[1939968537,374938813],[1447259295,3785468557],[4021046128,1664847745],[3139524504,3562928047],[1173487682,4065269608],[2467266804,3907744866],[4284945151,3486998177],[2925674454,1953016432],[3710671816,1271453948],[2129465869,1422863833],[587093076,18243356],[3373793513,2411305257],[2156648078,1791034213],[3737413652,1534461430],[468575139,2935304962],[1129551363,3603256834],[2861996892,1763494778],[2826449619,2465197654],[1704209531,1014895022],[3738359347,3402630390],[569410928,4095796581],[3021312909,2108247612],[2444777957,2664129360],[282063667,3773661258],[682545472,3188439005],[3318488457,1917822038],[1447622272,4045023041],[757420137,4038580915],[2613420942,4146703316],[4012836163,150381244],[2938127093,3428591704],[1208226490,3086335530],[2935205706,1446903363],[430957978,3830532479],[1381578755,3757172800],[4109399782,1596778224],[288855589,1954372339],[3169178148,2256716053],[2644780093,3895892303],[107966643,1071681559],[1304747544,2607225372],[1359190711,1898207171],[3229237120,3273634996],[3027167685,3863637628],[3011615298,2883984519],[564135827,978463264],[770797430,362326607],[1983662611,1907583229],[4153656423,48268960],[3609759233,720080177],[3727911466,1270989899],[200708787,2366086947],[744508026,393422515],[1213261630,65757284],[3485747185,3845951003],[2958861301,1680248217],[2598470344,3163845864],[2767997908,4233451722],[3881113485,1492930166],[1773764017,2764062206],[4189435844,2898689174],[4234838742,1267095035],[2624081078,3302114327],[2395569449,390426320],[1728307101,690284926],[3309827454,1118258254],[2028172868,3888829086],[4271523049,909051386],[146617804,942892565],[2467685867,974297806],[2483428231,503635829],[3743260573,2018222096],[1002067894,2289153437],[3535252974,3738302271],[4154611160,1002664952],[3623154244,2349656961],[3646679180,3524329383],[862933752,4282853607],[2806008282,3272780913],[2734037942,3828874677],[1328176304,2137666995],[2278785213,2780788825],[381286368,1816476193],[2074232908,2316293454],[4087773386,3651330956],[967884669,3728964514],[4239349185,3213509668],[419231360,1463788948],[1275421624,2672384707],[1088456595,436245261],[2365565249,783696577],[1758083333,845223583],[2048846183,3530914274],[2635948261,124738415],[940630937,3069598626],[839474029,1253439921],[902477345,165479306],[2836079689,2681188273],[2007115168,2093139645],[1363041891,1282466609],[1130479818,1063857938],[3644959908,1260430427],[1385135238,46497915],[1386975934,3110156681],[2635987502,4233461619],[1915744629,4117939016],[487743653,285736599],[2049219159,3960249250],[69242857,3908563670],[1511066720,1488527520],[215590039,1703564952],[1459430344,4184955468],[676103291,2642967214],[83799035,3182827979],[1949179493,476101251],[2593534694,1493478716],[2283504289,995211746],[1349412676,3449243940],[2954378677,1878813305],[249149717,3329151870],[1578231917,1483986052],[4135085182,890874990],[461755528,3505523909],[3669622373,634949665],[219487622,2914465301],[2825233742,3703631897],[2479105382,2935590907],[2582097898,3187672881],[1221328648,1843341402],[2140891889,3958868911],[1482849818,345750049],[751922730,3178831411],[3546542069,4036458902],[216179596,877293293],[444615341,3117393729],[2424254530,494454238],[1344234989,3003337991],[929188581,2760877801],[2507911009,1879899982],[980166547,1311840394],[3566535507,1790747461],[143525013,2311336672],[4181962471,4273938872],[1815842366,862009811],[911175674,1179575598],[3591335374,3694215714],[1452686093,3393294272],[385158879,2447709103],[4011414929,1264623507],[1448477120,911094312],[3971299641,2289992053],[3133647265,2234591563],[3007628400,964409938],[1708345684,3673411261],[3031964479,2843021794],[3022128657,2480338599],[118850112,473449293],[2048127371,3202109429],[3158349745,382018770],[1505327237,3807570472],[2568424029,3272693060],[1866609495,3888556537],[844703982,1852802964],[3504617058,682636099],[1448882679,3733580327],[821387540,2215744532],[3631471417,311618895],[2077838877,2383929020],[3352949096,1688694420],[2491080787,3998672444],[3368630402,4182204255],[983299419,2837414346],[3651215291,1033373924],[265429091,3988955082],[3019003608,2896212153],[2955948456,3025235588],[903690197,2266253487],[3925215275,89402958],[3959093811,3609545561],[2455088053,223552128],[3115011301,2133669107],[1765081558,673805649],[3324795129,2111392191],[3443871631,432345706],[3152559950,3425427147],[3699649406,672784944],[3129545774,7668664],[2747044893,173040075],[3925243406,852328481],[164095314,3161868591],[2234471571,1302682825],[2164784335,105893718],[159995093,536831360],[599199451,425051327],[3274759746,1680930461],[1192619331,3903085578],[2832721114,3078660237],[91404660,4030521531],[3044880024,1578375623],[3906596030,754177855],[803516785,1894094672],[288455592,2030430096],[2143232492,2317305324],[388352703,3406060288],[2521731420,3588403719],[1043041227,4028028525],[3195290851,2468913324],[4166724431,3168683191],[1228226538,968516529],[500177583,3444787306],[533367442,4252082053],[4236023256,657816314],[413575568,3367198397],[3435884549,3334062733],[1004255532,1135705894],[2859513268,4170618274],[3914086821,1251487871],[3080761716,3489067886],[3571165255,699353261],[773372954,3648014952],[769693293,2939128604],[3116440923,507748478],[1687629160,3739431776],[2489486648,3502376324],[3686847158,2878383449],[3530767427,902211375],[2121652637,2493976397],[1827477891,930064171],[2549918411,4029725732],[2071415163,844118802],[2236083679,3088894868],[2040110303,4144562891],[3489536313,1133419300],[2190878435,2301466071],[2465915458,2448602097],[1675766804,2073834499],[3329799896,1613253148],[1483966600,1348836071],[159505618,2527621997],[2674227354,1695130688],[2683539437,1927873839],[3833196123,2570082188],[3891433165,759819981],[1455453349,2179602430],[1430583255,1957776111],[2067726741,4235143439],[303380021,2998980439],[2136024795,3126725799],[2054591852,1051702291],[1029141665,489794361],[2317027384,569642164],[2068461795,624418658],[2499875684,1830645251],[1302894490,4319401],[1002663431,2406815191],[1560941298,2060652753],[2141002286,515773223],[3661248027,475092913],[3705503008,2419919909],[914567990,3496539911],[3462935583,2039034761],[2878378006,2379243316],[1133857586,1390159333],[3023618742,2140726761],[282908558,944874642],[3686955701,1148723903],[2604456805,4163675010],[3061545110,377179268],[3218002352,76459088],[2836503392,916455101],[536836808,151306053],[2886925079,404221671],[2936593041,2011015485],[453815187,1852163908],[3042568989,82176306],[3279635891,4174836410],[3282689058,2360003049],[4088968807,1516570623],[2680453086,1322680794],[1731693966,3438253771],[1842894553,1294307894],[2736377365,2964642609],[121205621,521330014],[2324595870,3005710757],[3784465521,676493813],[1958759409,2030833406],[1306150933,1016370058],[2636541290,482366508],[1950415745,1695073534],[322077955,3746046623],[3602873262,3829181504],[1211684447,1861645455],[504701736,4080111082],[2407799203,1223857855],[1925743434,1498920209],[3617596327,845198428],[2498480299,3484773806],[2680229135,2560201696],[3731399221,1536412390],[2756509305,2924710846],[2635957500,3459716133],[1372762539,769635894],[802677945,3878474636],[1707760534,3075809808],[3714687192,2872792173],[1615679922,1606381794],[1940556374,1337437342],[445390489,731124040],[2864974375,64601760],[1984806574,2141516710],[513390958,1890172555],[744398315,1475299139],[982749166,852662657],[652663695,4260736510],[1184061125,82616221],[3363191899,147951756],[1064069880,1507328085],[2138882964,547595589],[2616926846,3186935246],[2298715513,3606862940],[2414381911,811477686],[2694745228,900437726],[4202576185,2201114451],[3602305260,3323446937],[3756663274,2658490339],[3061587876,2171079416],[3390977925,2850497765],[486312941,224925241],[3515712841,3510684394],[1322319486,2647200565],[3839619171,1148450258],[392296762,1154854654],[1401523788,957405781],[1934485528,527352730],[645968162,3131215255],[696971825,3361451947],[2038689491,1946699733],[1723966113,2785859721],[2652365974,1118037185],[3988018407,3134982149],[1354171594,3053634345],[1287854075,2631782435],[1723106141,2662328866],[563845090,1878819261],[639520332,171129501],[534957223,1696062352],[3612364282,2283204027],[3109494688,1304463816],[500957989,630925278],[3477030536,2149497258],[4109750364,281719363],[951472732,564407054],[922095147,2767874048],[3946156928,829677774],[2622281253,2086286851],[2936811901,850242186],[630086272,3340782667],[2340986210,1296336989],[4107355543,3865114709],[3560210278,3968418243],[3868847493,2967450637],[611513888,2083325060],[3265390517,3025776309],[2874106961,3424470508],[1668707698,2923258228],[2778598353,24320552],[292356118,3415510793],[754567370,86994591],[185141877,1621715171],[2884558258,3722473457],[1492107531,111281805],[3336927864,4225337056],[782994598,1021838039],[346133860,18281270],[2080909533,1649329040],[3612065399,3859901127],[2151962287,284556115],[3957975594,3745718727],[52533817,3998775856],[1232633839,397383972],[2716413964,3629253960],[1531307298,3836851439],[3030137657,2500401718],[3561556693,653345841],[313061910,2945718466],[2065276,3342140708],[410498334,1470588117],[2726640512,4051654894],[2570984935,758567696],[3008987264,3462702678],[623860175,228525243],[3527183895,1829844480],[467272850,3890501742],[568376656,650516927],[990477018,4035508558],[2366955227,817792110],[4183621538,989198068],[946958343,1639184195],[3395758993,3924097558],[1690887473,3220519765],[605184237,1255270525],[275515833,1926424610],[2142902612,283494960],[2021972412,1823828440],[105373677,3448326697],[1666662384,1042433908],[1338566998,261206307],[498685668,1344755577],[3101233780,3119109371],[2733370951,3808165089],[3656512268,3449289481],[4025308119,1607880299],[778896067,1612183167],[2846510368,3674754715],[3058428120,2991822529],[1892379383,3268787440],[2565895844,4154602030],[3213117192,98999135],[2495816991,116985075],[1040203361,1785041385],[3106252493,69316595],[1639829808,2087117568],[3213709576,3799911752],[604681594,2340981536],[4236730699,2938666503],[4009938384,1878897714],[2701667332,1725918218],[2182473079,1258184],[3550198211,2760750799],[657991062,875584532],[1640976276,3380476221],[460041378,2924352091],[1972323596,2287414795],[2510248061,1350206297],[2959337826,3762681165],[1625877874,3235902929],[2070189957,1429368735],[4245163299,1839731898],[2358312347,138364248],[275739390,2179122576],[2037777210,972544338],[2766930226,1984733259],[1933485829,4209310327],[3034118011,3286589799],[2653025529,62078937],[2641780289,2679545709],[3540781195,2787026415],[1569993599,3215949659],[441337890,3947723353],[1878946792,459505587],[3724105660,920173002],[1691411102,3934795955],[148741087,3647709027],[142506469,2776440083],[3811107376,3823285243],[472209891,252266174],[1913386482,1867329194],[2960608550,482740699],[1145005292,1513558421],[1091751784,1687823886],[3625186042,3086337482],[1712140887,940065262],[1504455800,1945702563],[3896940088,2003245591],[2478191531,4197739e3],[3233871270,250924495],[3404865229,1131917964],[1462204167,429621621],[1349259705,3641608989],[3627860584,2048468319],[1244251718,1513180369],[3979211282,371413143],[3043187861,4285699810],[581894202,3060983825],[1390895705,1811317301],[2599134010,3337406128],[2488233440,2436161462],[1816641224,2208816697],[1792034756,815866116],[2779893723,2695577703],[2084952115,2951772258],[1351806869,169269771],[2469979804,86740603],[1163545420,4264616949],[1795352113,2511146232],[1796715044,3134635815],[3521170642,1538900329],[3725363621,1455009392],[1342594643,1512127734],[2618386938,662157428],[2028859350,2494504685],[1841905045,648351336],[4002935891,4033319405],[850071259,1768358867],[979915719,3876018087],[830889197,1629549437],[1744763229,2455795856],[522919199,368499868],[3063822504,2522639205],[2861636095,407686388],[4097602344,1945259027],[4215946617,1251639506],[894485042,534122652],[924809191,1807237502],[1811585710,1589663609],[3439653887,1722232],[3810997538,105152714],[2677100683,4291805514],[77233985,102407776],[4239834691,2851274395],[148802076,2006440603],[2409138150,126301601],[3048474397,3217504870],[588133437,4221603123],[1139638106,263087485],[982032635,3165674595],[562514827,1294842959],[467575086,905357513],[1405117894,3370530088],[3813285157,242912619],[3601878331,1985076606],[1586505598,2092146221],[738488098,103663229],[2970334297,321718822],[1068097019,1742926233],[235518094,420804527],[283685722,4092504887],[2666392744,3799169331],[3569817788,1256762975],[2169728352,292617248],[2444571896,2239859206],[3967907832,1066404216],[420376911,2913277294],[3046293305,2956347747],[2311278792,2477686209],[2885955184,4172514290],[3030078181,2275536480],[4212469731,4280736393],[1046900335,1773022229],[995380926,1414273529],[3892683234,2429494358],[615726237,2127712535],[3880203074,2071130305],[176180504,3070850165],[1474506861,2283723599],[1256707747,1857412043],[764236850,359687368],[3521530334,511649419],[2318567964,3992868140],[128167623,2518992858],[2220129756,1042300052],[2567608573,1349636707],[441446694,384760969],[4143447316,829506048],[817912603,2738025500],[2368091832,357934982],[1187643061,1561463042],[3438021235,3030161697],[1318922279,895468690],[434876457,1130220303],[1180291767,1132759596],[2520707785,1798553137],[1962430872,2958700157],[1510954061,3534879512],[57831539,3269538993],[3354831405,3852135009],[891783098,2698494511],[2555636406,996018997],[2881342935,3982231648],[3473267445,2894952368],[1238029452,3958679326],[2051805420,559465638],[3655936674,1186951582],[330209165,167662935],[1929681327,2450868735],[1313566811,2458925988],[4283920930,3243182650],[1438004300,4185567150],[3093439067,89876832],[3401620219,3721579956],[3673745794,2682874719],[3053321309,825410712],[822915968,3681514755],[3900685126,561657358],[553823814,1857753416],[4166295066,983949325],[128359165,3426887194],[3300989119,3884968622],[4193552686,3647722552],[452189154,1569670618],[4122259632,3537825460],[2519387887,2821594244],[74333898,2940550377],[4032631446,2173999692],[2521268686,1934310532],[2620314688,2177785789],[1378755571,2455646622],[394133753,4231198609],[734399075,2800989170],[573292462,1634883078],[1214417373,3426576256],[2110224475,2399009920],[2331215665,3224086912],[531326186,698539511],[3839443603,583861850],[2644531398,2017784332],[616620850,3070237104],[590349237,2798642861],[3582377217,3317831670],[1582708616,1596570667],[2126148205,2358511947],[173450736,3219362418],[3616831144,1323437318],[2655785577,3131359031],[401600069,2967397952],[496349349,4244179910],[2479612086,2579650653],[1710903074,2049666425],[3589924952,690291925],[3266682943,1900485231],[1496318498,3025542656],[3459221058,3389461212],[2091479615,3140389256],[663040899,1207089672],[3323704225,1105530508],[353318429,2879253542],[2674540957,941987316],[1688550857,620657353],[338551967,4286217277],[204689992,2239736295],[178008789,3940832005],[3871613304,3300636974],[1911672356,2429684487],[4055679954,1974461722],[3878217928,1009991796],[2533095482,310920740],[2174833823,3596041637],[1604814460,2939543881],[1452830254,4092397851],[2441027029,4169690209],[3524103304,3372213855]],r=[[836181454,1689436944],[2776523577,3710710688],[4049974663,3750330768],[519497435,2979405513]],i=[[1892447193,197291556],[3793382197,3742120663],[3838936,2994760034],[479846099,1018728609],[3476112862,182272649],[3504620154,1427438450],[2009473484,2679350403],[1738755500,1129731339]],o=[4174784170,2938602761],a={p:0,P:1,n:2,N:3,b:4,B:5,r:6,R:7,q:8,Q:9,k:10,K:11},l=[];l[5]=1,l[6]=0,l[9]=3,l[10]=2,l[17]=5,l[18]=4,l[33]=7,l[34]=6,l[65]=9,l[66]=8,l[129]=11,l[130]=10;var h,g=[2,5,10,20,40,80,160,64],y=["","0000000","000000","00000","0000","000","00","0",""];function to32BitHex(t){var r=t.toString(16);return y[r.length]+r}function to64BitHex(t){return to32BitHex(t[0])+to32BitHex(t[1])}function hash(l,h){var y,_,x,w,S,M,T,P,C,A,O,L,I=l.split(" "),R=I[0].split("/"),j="w"===I[1],N=0,k=Number(j),D=k?3:4;for(x=7;x>=0;x-=1)for(w=0,T=(S=R[x]).length,M=0;M<T;M+=1)P=S[M],(O=a[P])>=0&&(y=(y^(C=t[64*O+8*(7-x)+w])[0])>>>0,_=(_^C[1])>>>0,O===k&&x===D&&(N|=1<<w)),w+=Number(P)||1;return"-"!==I[2]&&((A=I[2]).indexOf("K")>-1&&(y=(y^(C=r[0])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("Q")>-1&&(y=(y^(C=r[2])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("k")>-1&&(y=(y^(C=r[1])[0])>>>0,_=(_^C[1])>>>0),A.indexOf("q")>-1&&(y=(y^(C=r[3])[0])>>>0,_=(_^C[1])>>>0)),I[3]&&"-"!==I[3]&&(L=I[3].charCodeAt(0)-97,g[L]&N&&(y=(y^(C=i[L])[0])>>>0,_=(_^C[1])>>>0)),j&&(y=(y^o[0])>>>0,_=(_^o[1])>>>0),h&&"hex"===h?to64BitHex([y,_]):[y,_]}function wrap(t){var r,i,o,a,l={};function parseBook(t,r){var o,a,l,h,g,y,_=i.getUint16(t+8),x=i.getUint16(t+10);return a=_>>9&7,h=_>>3&7,g=7&_,y=_>>12&7,4===(l=_>>6&7)&&r&&a===h&&"-"!==r&&(7===g&&(0===a&&r.indexOf("K")>-1||7===a&&r.indexOf("k")>-1)?g-=1:0===g&&(0===a&&r.indexOf("Q")>-1||7===a&&r.indexOf("q")>-1)&&(g+=2)),o=String.fromCharCode(l+97)+(a+1)+String.fromCharCode(g+97)+(h+1),y&&(o+="nbrq"[y-1]),{move:o,weight:x}}function query(t){return"string"==typeof t&&(t={fen:t}),r(t)}if(l={query:query,pick:function pick(t){var r,i,o,a,l,h=0;if(function sortMoves(t){t.sort((function sorter(t,r){return r.weight-t.weight}))}(r=(t=t||{}).moves||query(t)),o=r.length){if(t.type&&1!==o&&"best"!==t.type){if("random"===t.type){for(a=Math.floor(Math.random()*r.sum)+1,l=0;l<o-1&&!(a<=(h+=r[l].weight));l+=1);return r[l].move}return"randomDisregardWeight"===t.type?r[Math.floor(Math.random()*o)].move:"worst"===t.type?r[o-1].move:((i=parseInt(t.type)||1)<0&&(i=o+i+1),i<1?i=1:i>o&&(i=o),r[i-1].move)}return r[0].move}}},t.getUint32)r=function bufferBookFind(t){var r,o,a,l,h,g=i.length||i.byteLength||0,y=t.offset||0,_=t.fen,x=t.chess960,w=t.checkAll,S=[],M=0;for(t.hash?"string"==typeof(r=t.hash)&&(r=function hex64ToDec(t){return[parseInt(t.substr(0,8),16),parseInt(t.substr(8),16)]}(r)):r=hash(_),!x&&_&&(h=_.split(" ")[2]),y=0;y<g;y+=16)if(i.getUint32(y)===r[0]&&i.getUint32(y+4)===r[1])a=parseBook(y,h),S[S.length]=a,M+=a.weight,o=!0;else if(o&&!w)break;if(S.sum=M,t.relative)for(l=S.length-1;l>=0;l-=1)S[l].relative=Math.round(S[l].weight/M*1e4);return S},i=t,l.buffer=i;else for(a in r=function jsonBookFind(t){var r,i,a,h,g,y,_=0,x=t.fen;if(l.useFen)a=x.replace(/ \d+ \d+$/,""),(r=o[a])||(h=a.replace(/[a-h][1-8]$/,"-"))!==a&&(r=o[h]);else if(t.hash||(t.hash=hash(x,"hex")),r=o[t.hash]){if(r[0]&&r[0].n&&(r=r[0]),r.n&&!r.b)return[];if(r.b)r=function decompressMoves(t){var r,i=[],o=t.b.length;for(r=0;r<o;++r)i.push({move:t.b[r],weight:t.w[r]});return i}(r);else if(!t.chess960&&x)for(y=x.split(" ")[2],i=r.length-1;i>=0;i-=1)(g=r[i].move.match(/e([18])([ah])\1/))&&("h"===g[2]&&("1"===g[1]&&y.indexOf("K")>-1||"8"===g[1]&&y.indexOf("k")>-1)?r[i]={move:"e"+g[1]+"g"+g[1],weight:r[i].weight}:"a"===g[2]&&("1"===g[1]&&y.indexOf("Q")>-1||"8"===g[1]&&y.indexOf("q")>-1)&&(r[i]={move:"e"+g[1]+"c"+g[1],weight:r[i].weight}))}if(r)for(i=r.length-1;i>=0;i-=1)_+=Number(r[i].weight);else r=[];return r.sum=_,r},o=t,l.json=o,o){l.useFen=a.indexOf(" ")>-1;break}return l}function getBook(t,r){!function ajaxLoad(t,r){var i=new XMLHttpRequest,o=t.toLowerCase().indexOf(".json")>-1;function onload(){var t;if(i.status>=200&&i.status<300||304===i.status||0===i.status||1223===i.status)if(o)try{r(null,JSON.parse(i.response))}catch(a){r(a)}else t=new DataView(i.response),r(null,t);else r(new Error("Error code: "+i.status))}i.open("GET",t,!0),o||(i.responseType="arraybuffer"),i.onload=onload,i.onerror=onload,i.send()}(t,(function onload(t,i){var o;if(i&&(o=wrap(i)),r)return r(t,o);if(t)throw t;return o}))}return{hash:hash,loadBook:(h={},function loadBook(t,r){h[t]?h[t].book?setTimeout((function(){r(null,h[t].book)}),0):h[t].cbs.push(r):(h[t]={cbs:[r]},getBook(t,(function onload(r,i){var o=h[t].cbs;r?delete h[t]:(h[t].book=i,h[t].cbs=void 0),o.forEach((function(t){setTimeout((function(){t(r,i)}),0)}))})))}),to64BitHex:to64BitHex,zobristPiece:t,zobristCastle:r,zobristEnPassant:i,zobristTurn:o,zobristPieceValue:a,zobristPieceValueNumbers:l}}(),i=function init(){var t,i,o,a,l={Chess:0,Chess960:1,Crazyhouse:2,"3-check":3,"King of the Hill":4,Bughouse:5,chess960:1,Fischerandom:1,fischerandom:1,crazyhouse:2,"three-check":3,threecheck:3,"3check":3,kingofthehill:4,koth:4,bughouse:5},h=["Chess","Chess960","Crazyhouse","3-check","King of the Hill","Bughouse"],g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=0,x=0,w=0,S=-1,M=32,T=128,P=252,C=255,A=512,O=112,L=14,I=21,R=127,j="pnbrqkPNBRQK",N="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",k=[];k[5]=[-16,-17,-15],k[6]=[16,17,15],k[8]=[-18,-33,-31,-14,18,33,31,14],k[16]=[-17,-15,17,15],k[32]=[-16,1,16,-1],k[64]=[-17,-16,-15,1,17,16,15,-1],k[128]=[-17,-16,-15,1,17,16,15,-1];var D={P:5,p:6,N:9,n:10,B:17,b:18,R:33,r:34,Q:65,q:66,K:129,k:130},B={P:4,p:4,N:8,n:8,B:16,b:16,R:32,r:32,Q:64,q:64,K:128,k:128},G={5:"P",6:"p",9:"N",10:"n",17:"B",18:"b",33:"R",34:"r",65:"Q",66:"q",129:"K",130:"k"},H={9:"N",10:"N",17:"B",18:"B",33:"R",34:"R",65:"Q",66:"Q",129:"K",130:"K"},V=[80,0,0,0,0,0,0,96,0,0,0,0,0,0,80,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,96,96,96,96,96,96,224,0,224,96,96,96,96,96,96,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,80,0,0,0,0,0,0,96,0,0,0,0,0,0,80],U=[336,80,80,0,0,0,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,360,508,252,0,252,508,360,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,0,0,0,80,80,336],z=[336,80,80,0,0,0,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,360,508,252,0,252,508,488,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,96,0,0,80,80,336],W=[336,80,80,0,0,96,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,488,508,252,0,252,508,360,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,0,0,0,80,80,336],q=[336,80,80,0,0,96,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,488,508,252,0,252,508,488,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,96,0,0,80,80,336],$=[336,80,80,112,112,112,96,352,96,96,112,112,112,80,336,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,352,352,480,480,488,508,252,0,252,508,488,480,480,480,352,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,336,80,80,112,112,112,96,352,96,96,112,112,112,80,336],X=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,33,16,31,15,0,0,0,0,0,0,0,0,0,0,0,18,17,16,15,14,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,-14,-15,-16,-17,-18,0,0,0,0,0,0,0,0,0,0,0,-15,-31,-16,-33,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],K=[0,5,8,11,14],Y=[31,7,7,7,63],Z={P:0,p:0,N:5,n:5,B:8,b:8,R:11,r:11,Q:14,q:14},Q=[4,8,16,M,64],J=["","N","B","R","Q"],ee={CAPTURE:1,BIG_PAWN:2,EP_CAPTURE:4,ANY_CAPTURE:5,PROMOTION:8,KSIDE_CASTLE:16,QSIDE_CASTLE:32,KQSIDE_CASTLE:48,DROP:64,DROP_OR_PROMOTE:72},te=[0,6,1],ne={K:119,Q:112,k:7,q:0,A:112,B:113,C:114,D:115,E:116,F:117,G:118,H:119,a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},re=["Event","Site","Date","Round","White","Black","Result"],ie=["Event","Site","Date","Round","White","Black","Result","Variant","SetUp","FEN","WhiteA","WhiteB","BlackA","BlackB"];function rank(t){return t>>4}function file(t){return 7&t}function algebraic(t){return String.fromCharCode(file(t)+97)+(8-rank(t))}function swapColor(t){return 3-t}function hashNum(t,r){t[0]=(t[0]^r[0])>>>0,t[1]=(t[1]^r[1])>>>0}function completeFen(t){var r,i;return(r=[""," w - - 0 1"," - - 0 1"," - 0 1"," 0 1"," 1"][(i=(t=t.trim()).split(" ")).length])&&t?t+=r:"0"===i[5]&&(i[5]=1,t=i.join(" ")),t}function createVariantZobristNumbers(){r.zobristCheck=[[441249556,340005552],[1040760204,311043682],[1621584863,1749286446],[1006868636,1625552915],[1953853171,24921145],[161251506,1935545265]]}function validateFen(t,r){var i,o,a,h,g,y,_,x,w,S,M,T,P,C,A,O,L,I,R,N,k=/^(?:[A-H]{1,2}[a-h]{0,2}|[A-H]{0,2}[a-h]{1,2}|KQ?k?q?|Qk?q?|kq?|q|-)$/,D=1*r===l.Crazyhouse||l[r]===l.Crazyhouse||1*r===l.Bughouse||l[r]===l.Bughouse,B=0,G=0,H=!0,V="",U={0:0,7:0},z={0:0,7:0},W={0:"k",7:"K"},q={0:"r",7:"R"},$=1*r===l.Chess960||l[r]===l.Chess960;if(!t)return 1;if((1*r===l.Bughouse||l[r]===l.Bughouse)&&2===(g=t.split(" | ")).length)return 0===(y=validateFen(g[0],r))&&(y=validateFen(g[1],r)),y;if(g=t.split(/\s+/),(1*r===l["3-check"]||l[r]===l["3-check"])&&7===g.length&&(h=g.pop(),!/^\+[0-3]\+[0-3]$/.test(h)||"+3+3"===h))return 14;if(6!==g.length)return 1;if(/\D|.{7,}|^0|^$/.test(g[5]))return 2;if(/\D|.{7,}|^0.|^$/.test(g[4]))return 3;if(!/^(?:-|[abcdefgh][36])$/.test(g[3]))return 4;if(S=g[2],$){if(!k.test(S))return 12}else if(!/^(?:KQ?k?q?|Qk?q?|kq?|q|-)$/.test(S)){if(void 0!==r||!k.test(S))return 5;$=!0}if("w"!==g[1]&&"b"!==g[1])return 6;if(D&&(g[0]=g[0].replace(/~(?=.*\/)/g,"")),o=g[0].split("/"),D&&9===o.length&&(h=o.pop(),!/^[pnbrq]{0,63}$/i.test(h)))return 13;if(8!==o.length)return 7;if("3"===g[3][1]&&"w"===g[1]||"6"===g[3][1]&&"b"===g[1])return 11;for("-"!==g[3]&&(_=4===(G="3"===g[3][1]?4:3)?5:2,B=g[3].charCodeAt(0)-97,H=!1,V=4===G?"P":"p"),i=0;i<o.length;++i){for(I=0,R=!1,N=0;N<o[i].length;N++)if(+(a=o[i][N])==+a){if(R)return 8;I+=1*a,R=!0}else{if(-1===j.indexOf(a))return 9;if(H||G!==i||B!==I||V!==a||(H=!0),_===i&&B===I)return 11;i%7==0&&(a===W[i]?z[i]=1<<I:a===q[i]&&(U[i]|=1<<I)),++I,R=!1}if(8!==I)return 10}if(!H)return 11;if("-"!==S)if($)for(T={0:0,1:0,2:252,4:248,8:240,16:224,32:192,64:128,128:0},M={0:0,1:0,2:1,4:3,8:7,16:15,32:31,64:63,128:0},L={0:[0,0],7:[0,0]},i=S.length-1;i>=0;--i){if(A=S.charCodeAt(i),O&&O>A&&O-A<8)return 15;if(75===A?P=U[C=7]&T[z[C]]:81===A?P=U[C=7]&M[z[C]]:107===A?P=U[C=0]&T[z[C]]:113===A?P=U[C=0]&M[z[C]]:(P=1<<A-((C=A>=97?0:7)?65:97),O=A),!P||0!=(P&P-1))return 15;if(z[C]<2||z[C]>64||(P&U[C])!==P)return 15;if(++L[C][1*(z[C]<P)]>1)return 15}else{if((x=(S.indexOf("K")>-1?128:0)|(S.indexOf("Q")>-1?1:0))&&(16!==z[7]||(x&U[7])!==x))return 15;if((w=(S.indexOf("k")>-1?128:0)|(S.indexOf("q")>-1?1:0))&&(16!==z[0]||(w&U[0])!==w))return 15}return 0}function handToString(t,r){var i,o,a="",l=0,h=r?6:0;if(t)for(;l<5;){for(i=t>>K[l]&Y[l],o=0;o<i;++o)a+=j[l+h];++l}return a}function hashEP(t,i,o,a){t[o+1]!==a&&t[o-1]!==a||hashNum(i,r.zobristEnPassant[file(o)])}function addPawnMove(t,r,o,a){var l;(0===i||2&t[o+8])&&(rank(o)%7==0?(l=a|ee.PROMOTION|r<<7|o<<L,y[x++]=8388608|l,y[x++]=6291456|l,y[x++]=4194304|l,y[x++]=2097152|l):y[x++]=a|r<<7|o<<L)}function kingOfTheHillWin(t){switch(t){case 67:case 68:case 51:case 52:return!0}return!1}function canCastle960(t,r,i,o){var a,l,h,g=r+(i-r%8),y=i>r%8?1:-1;for(h=r+y;h!==g;h+=y)if(t[h])return!1;if(l=(a=1===o?1===y?118:114:1===y?6:2)-y,t[a+8]||t[a]&&a!==r&&a!==g||t[l]&&l!==r&&l!==g)return!1;if(a!==r)for(h=r+(y=a>r?1:-1);h!==a;h+=y)if(h!==g&&t[h]||t[h+8])return!1;return!0}var oe=function(){function createLine(t,r,i,o,a,h,g){var y,_,x,w,S,M,T,P,C,A,O,L=[],I="",R=!0,j=r[i],N=j.length,k="";if(j.commands)for(w in j.commands)(!h||h.indexOf(w)>-1)&&(k+="[%"+w+" "+j.commands[w]+"]");for(j.initComment&&!g&&(k=(k+" "+j.initComment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),k&&L.push("{"+k+"}"),_=0;_<N;++_){if(M=1===(y=j[_]).color,I="",k="",o!==l.Bughouse?(R&&!M?I=t+"...":M&&(I=t+"."),a&&(M||R)&&(I+=" ")):(L.bughouseOrder||(L.bughouseOrder=[]),L.bughouseOrder.push(y.bughouseOrder),_||(L.blackCountOffset=2===j[0].color?1:0)),I+=y.san,y.annotation&&(I+=y.annotation),y.additionalAnnotation&&(I+=" "+y.additionalAnnotation.join(" ")),R=!1,void 0===y.time||y.commands||(y.commands={clk:(C=y.time,A=void 0,O=void 0,A=Math.floor(C%36e3/600),O=Math.floor(C%36e3%600)/10,Math.floor(C/36e3)+":"+(A<10?"0":"")+A+":"+(O<10?"0":"")+O)}),y.commands)for(w in y.commands)(!h||h.indexOf(w)>-1)&&(k+="[%"+w+" "+y.commands[w]+"]");if(y.comment&&!g&&(k=(k+" "+y.comment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),k&&(I+=" {"+k+"}",R=!0),L.push(I),y.lines)for(T=y.lines.length,x=0;x<T;++x)r[P=y.lines[x]].length&&((S=createLine(t,r,P,o,a,h,g))[0]="("+S[0],S[S.length-1]+=")",L=L.concat(S),R=!0);M||t++}return L}function createHeader(t,r){return"["+t+' "'+String(r).replace(/(\"|\\)/g,"\\$1")+'"]'}return function generatePgn(t,r,i,o,a,h){var g,y,_="string"==typeof t.newline?t.newline:"\n",x=void 0===t.spaceAfterPeriods||t.spaceAfterPeriods,w="";for(g in w+=createHeader("Event",r.Event)+_,w+=createHeader("Site",r.Site)+_,w+=createHeader("Date",r.Date)+_,w+=createHeader("Round",r.Round)+_,a===l.Bughouse?(w+=createHeader("WhiteA",r.WhiteA||"?")+_,w+=createHeader("BlackA",r.BlackA||"?")+_,w+=createHeader("WhiteB",r.WhiteB||"?")+_,w+=createHeader("BlackB",r.BlackB||"?")+_):(w+=createHeader("White",r.White)+_,w+=createHeader("Black",r.Black)+_),w+=createHeader("Result",r.Result)+_,a&&(w+=createHeader("Variant",r.Variant)+_),r.FEN&&r.FEN!==N&&(w+=createHeader("SetUp","1")+_,w+=createHeader("FEN",r.FEN)+_),r)-1===ie.indexOf(g)&&(w+=createHeader(g,r[g])+_);if(w+=_,y=createLine(o,i,0,a,x,t.hideCommands?[]:t.restrictCommands,t.hideComments),a===l.Bughouse){if(h.isDependent)return y;y=function makeBugHousePgn(t,r,i){var o=r,a=t.siblingGame.pgn(),l=0,h=0,g=[];for(r.bughouseOrder=r.bughouseOrder||[],a.bughouseOrder=a.bughouseOrder||[];r.bughouseOrder.length||a.bughouseOrder.length;)!r.bughouseOrder.length||a.bughouseOrder.length&&r.bughouseOrder[0]>a.bughouseOrder[0]?(a.bughouseOrder.shift(),g.push("B")):(r.bughouseOrder.shift(),g.push("A"));return r=[],g.forEach((function(g){var y,_,x,w="";"A"===g?(y=o,_=++l,x=t.startingMoveNumber()):(y=a,_=++h,x=t.siblingGame.startingMoveNumber()),w=String(Math.floor((_+1)/2)+x-1),(y.blackCountOffset+_)%2?w+=g:w+=g.toLowerCase(),w+="."+(i?" ":"")+y.shift(),r.push(w)})),r}(h,y,x)}return y.push(r.Result),w+function wordWrap(t,r,i){return r<1?t:(r="number"==typeof r?r:80,t.replace(new RegExp("(.{1,"+r+"})(?: |$|\r?\n)","g"),"$1"+i).slice(0,-i.length))}(y.join(" "),t.maxWidth,_)}}(),ae=function(){var t="!?‼⁇⁉⁈□∇Δ∞⩲⩱±∓⨀⟳→↑⇆∆⌓⇔⇗⟫⟪✕⊥⊕○⇄↻⊙~",r=/\[%(\S+)\s([^\]]+)\]/,i=/^(?:[+=~\/\-\u2212]+|T?N|RR|D)$/;function extractCommands(t){for(var i,o=t.commands||{};i=r.exec(t.value);)t.value=t.value.replace(i[0],"").trim(),o[i[1]]=i[2],t.commands=o}function isSplitGame(t,r,i,o){for(var a;++r<i;)if((a=t[r].trim())&&"%"!==a[0])return"["===a[0]&&(!o||/^\[\S+\s+".*"\]$/.test(a))}return function tokenize(r,o){var a,l,h,g,y,_,x,w="tags",S=[],M={type:w,value:""},T=0,P=[],C=!0;o=o||{},g=(a=r.split(/\r?\n/)).length;e:for(l=0;l<g;++l)if("%"!==(h=a[l].trim())[0])if(h){if(_=(h=" "+h+" ").length,y=0,C)for(;y<_;++y)if(x=h[y],"tags"===w){if("["===x)M={type:w="tagName",value:""};else if(x.trim()){M={type:w="san",value:""},C=!1;break}}else if("tagName"===w)M.value&&""===x.trim()?(S.push(M),w="tagValueStart"):" "!==x&&(M.value+=x);else if("tagValueStart"===w){if('"'===x||"“"===x)M={type:w="tagValue",value:""};else if(x.trim()){S.push({type:"tagValue",value:h.slice(y,-1).match(/(.*?)"?\]?$/)[1]}),M={type:w="tags",value:""};continue e}}else if("tagValue"===w)if('"'===x||"”"===x)if(S.push(M),"]"===h[y+1])M={type:w="tags",value:""},++y;else{if("]"===h.slice(-2,-1)){M.value+=h.substr(y).match(/(.*?)"?\s*\] $/)[1],M={type:w="tags",value:""};continue e}w="tagEnd"}else"\\"===x&&y+2<_&&(x=h[++y]),y>0&&(M.value+=x);else{if("]"!==x){if(!x.trim())continue;--y}M={type:w="tags",value:""}}for(;y<_;++y)if(x=h[y],"san"===w)if(t.indexOf(x)>-1)"!"===x||"?"===x||t.indexOf(x)<6&&(x=["!!","??","!?","?!"][t.indexOf(x)-2])?(M.value&&S.push(M),M={type:"a",value:x},"!"!==h[y+1]&&"?"!==h[y+1]||(M.value+=h[++y]),S.push(M),M={type:"san",value:""}):("∞"===x&&"=/"===M.value?(M.type="aa",M.value+=x):(M.value&&(i.test(M.value)&&("--"!==M.value||o.rejectNullMoves)&&(M.type="aa"),S.push(M)),M={type:"aa",value:x},"↑"===x&&"↑"===h[y+1]&&(M.value="↻",++y)),S.push(M),M={type:"san",value:""});else if(" "===x||"\t"===x||"\r"===x||"{"===x||"("===x||")"===x){if(M.value){if("$"===M.value[0])M.type="nag";else if("*"===M.value||"1-0"===M.value||"0-1"===M.value||"1/2-1/2"===M.value||"½-½"===M.value){if(!(T||y+1<_)){if(M.type="result","½-½"===M.value&&(M.value="1/2-1/2"),S.push(M),P.push(S),l+1===g||l+2===g&&!a[l+1])return P;C=!0,M={type:w="tags",value:""},S=[];break}M.type="*"===M.value?"cont":"comment"}i.test(M.value)&&("--"!==M.value||o.rejectNullMoves)&&(M.type="aa"),S.push(M),M={type:w,value:""}}if(" "===x||"\t"===x||"\r"===x)w="san";else if("{"===x)w="comment",S.length&&"comment"===S[S.length-1].type&&((M=S.pop()).value+=" ");else if("("===x)w="san",S.push({type:"variationStart",value:++T});else{if(T<1){if(!o.commentErrors)return!1}else S.push({type:"variationEnd",value:T--});w="san"}M.type=w}else if("."===x||!M.value&&+x==+x&&"-"!==h[y+1]&&"/"!==h[y+1]){if(+x==+x)switch(M.number||(M.number=""),M.number+=x,h[y+1]){case"A":case"a":case"B":case"b":M.number+=h[++y],S.push({type:"number",value:M.number}),delete M.number}}else M.value+=x;else 0===y&&(M.value=M.value.trim()),"}"!==x?("\\"===x&&y+2<_&&(x=h[++y]),M.value+=x):(M.value=M.value.trim(),M.value.indexOf("[")>-1&&extractCommands(M),S.push(M),M={type:w="san",value:""})}else S.length&&("tags"===w?(w="san",C=!1):"tagValueStart"!==w&&isSplitGame(a,l,g,T||"comment"===w)&&("comment"===w&&S.push(M),"tagValue"!==S[S.length-1].type&&(P.push(S),S=[]),w="tags",C=!0,T=0));return M.value&&S.push(M),!S.length&&P.length||P.push(S),P}}();function Chess(ie,se){var ce,le,ue=0,de=!0,he=[],pe=1,fe=[],me=S,ge=0,ve=1,ye=1,be=[],_e=[be],xe=0;be.id=xe;var we={},Se=[],Me=!1,Ee=!1,Te=makeMoveChess;function hashPosition(){var t,i,o,a=1===pe?[4174784170,2938602761]:[0,0];for(o=0;o<120;++o)136&o&&(o+=8),(t=le[o])&&hashNum(a,r.zobristPiece[64*r.zobristPieceValueNumbers[t&C]+8*(7-rank(o))+file(o)]);if(Ee)for(i=1;i<3;++i)fe[i]&&(0!=(fe[i]&fe[i]-1)?(hashNum(a,r.zobristCastle[i-1]),hashNum(a,r.zobristCastle[i+1])):fe[i]>1<<file(he[i])?hashNum(a,r.zobristCastle[i-1]):hashNum(a,r.zobristCastle[i+1]));else{for(i=1;i<3;++i)fe[i]&&(fe[i]&ee.KSIDE_CASTLE&&hashNum(a,r.zobristCastle[i-1]),fe[i]&ee.QSIDE_CASTLE&&hashNum(a,r.zobristCastle[i+1]));Me?function hashHand(t,i){var o,a,l,h,g,y,_,x=0;for(o=1;o<3;++o){if(a=i[o])for(l=0;l<5;){for(g=x+63*l,h=a>>K[l]&Y[l],y=0;y<h;++y)hashNum(t,[31*(_=r.zobristPiece[g++])[0]>>>0,17*_[1]>>>0]);++l}x=315}}(a,ce._hand):ue===l["3-check"]&&function hash3Check(t,i){i[1]&&hashNum(t,r.zobristCheck[i[1]-1]),i[2]&&hashNum(t,r.zobristCheck[i[2]+2])}(a,Se)}return me!==S&&hashEP(le,a,me+(1===pe?16:-16),4|pe),a}function getCurrentHash(){var t;return be.length?t=be[be.length-1].hash:(be.hash||(be.hash=hashPosition()),t=be.hash),[t[0],t[1]]}function setVariant(t,r){ue!==(ue=t?l[t]||1*t||l[String(t).replace(/ /g,"").toLowerCase()]||l.Chess:0)&&(ue===l.Bughouse?(Me=!0,ce.isDependent||(ce.siblingGame=Chess(),ce.siblingGame.hashing(de),ce.siblingGame.isDependent=!0,ce.siblingGame.siblingGame=ce,ce.siblingGame.header({Variant:"Bughouse"})),createVariantZobristNumbers(),Te=makeMoveVariant):(delete ce.siblingGame,Me=ue===l.Crazyhouse,Ee=ue===l.Chess960,ue?(createVariantZobristNumbers(),Te=makeMoveVariant):Te=makeMoveChess),r||updateSetup(generateFen()))}function disambiguate960Rook(t,r){for(var i,o,a=t>7?1:2;!(136&t);){if((i=le[t])&a)if(i&M){if(o)return;o=t%8+(1===a?65:97)}else if(i&T)return o;t+=r}}function clear(t,r,i){le=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pe=1,he[1]=S,he[2]=S,fe[1]=0,fe[2]=0,ce._hand[1]=0,ce._hand[2]=0,Se[1]=0,Se[2]=0,me=S,ge=0,ve=1,r||(_e=[be=[]],xe=0,be.id=xe,we={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},t?setHeader(["Variant",t]):setVariant(!1,i),i||updateSetup(generateFen()))}function reset(){clear(0,!1,!0),be.hash=[1178310168,378666140],le=[34,10,18,66,130,18,10,34,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,33,9,17,65,129,17,9,33,0,0,0,0,0,0,0,0],ye=1,he[1]=116,he[2]=4,fe[1]=48,fe[2]=48}function load(t,r,i,o){var a,y,_,x,w,P,C,O,L,I,R,j,N=0;if(o?(j=(a=t.split(" "))[3],R=a[2]):(j=(a=t.trim().split(/\s+/))[3]||"-",R=a[2]||"-"),void 0===r?(31&R.charCodeAt(0))<9&&setVariant(l.Chess960,!0):setVariant(r,!0),y=a[0],!o&&!(y=function fixFenPieces(t,r){var i,o,a=t.length,h=0,g=0,y=r&&(r===l.Crazyhouse||r===l.Bughouse);for(i=0;i<a;++i)if(+(o=t[i])!=+o)if("/"===o){if(8!==g&&(t=t.substr(0,i)+(8-g)+t.substr(i),++i,++a),g=0,++h>7){if(!y&&i<a-1||!/^[pnbrq]{0,63}$/i.test(t.substr(i+1)))return!1;break}}else if(D[o]){if(++g>8)return!1}else{if("~"!==o)return!1;y&&i&&/[nbrq]/i.test(t[i-1])||(t=t.substr(0,i)+t.substr(i+1),--i,--a)}else(g+=1*o)>8&&(t=t.substr(0,i)+(o-(g-8))+t.substr(i+1),g=8);return t}(y,ue)))return!1;if(x=y.length,clear(h[ue],i,!0),Me){if(ue===l.Bughouse&&!ce.isDependent&&(P=t.split(" | "),!ce.siblingGame.load(1===P.length?t:P[1],r,i,o)))return reset(),!1;for(w=0;w<x;++w)if(+(C=y[w])!=+C)if("/"===C){if(N>111){for(++w;w<x;++w)C=y[w],ce._hand[C<"a"?1:2]+=1<<Z[C]>>>0;break}N+=8}else le[N]=D[C],"~"===y[w+1]&&(++w,le[N]|=A),le[N]&T&&(he[3&le[N]]=N),++N;else N+=1*C}else for(w=0;w<x;++w)+(C=y[w])!=+C?"/"===C?N+=8:(le[N]=D[C],le[N]&T&&(he[3&le[N]]=N),++N):N+=1*C;if(pe="b"===a[1]?2:1,"-"!==R)if(Ee){for(L={1:[0,0],2:[0,0]},w=R.length-1;w>=0;--w)75===(_=R.charCodeAt(w))?_=disambiguate960Rook(119,-1):81===_?_=disambiguate960Rook(112,1):107===_?_=disambiguate960Rook(7,-1):113===_&&(_=disambiguate960Rook(0,1)),O=_<97?1:2,I=ne[String.fromCharCode(_)],(o||le[I]===(M|O))&&(_>=97?he[O]>=1&&he[O]<=6&&(fe[O]|=1<<I):he[O]>=113&&he[O]<=118&&(fe[O]|=1<<I-112),++L[O][1*(he[O]<I)]);(L[1][0]>1||L[1][1]>1)&&(fe[1]=0),(L[2][0]>1||L[2][1]>1)&&(fe[2]=0)}else{if(!o)for(w=R.length-1;w>=0;--w)O=R.charCodeAt(w)<97?1:2,le[ne[R[w]]]===(M|O)&&he[O]===(1===O?116:4)||(R=R.substr(0,w)+R.substr(w+1));for(w=R.length-1;w>=0;--w)switch(R[w]){case"K":fe[1]|=ee.KSIDE_CASTLE;break;case"Q":fe[1]|=ee.QSIDE_CASTLE;break;case"k":fe[2]|=ee.KSIDE_CASTLE;break;case"q":fe[2]|=ee.QSIDE_CASTLE}}return!o&&(2!==j.length||1===pe&&"6"!==j[1]||2===pe&&"3"!==j[1]||le[j.charCodeAt(0)-97+16*(8-("3"===j[1]?4:5))]!==(4|swapColor(pe))||le[g[j]])&&(j="-"),me="-"===j?S:g[j],ge=1*a[4]||0,ve=1*a[5]||1,ue===l["3-check"]&&(a[6]&&"+3+3"!==a[6]&&(P=a[6].match(/^\+([0-3])\+([0-3])$/)),P=P||[0,0,0],Se[1]=1*P[1],Se[2]=1*P[2]),i||(ye=ve,updateSetup(generateFen())),!0}function generateFen(){return ue?function generateVariantFen(){var t,r,i,o=0,a="",h="";for(t=0;t<120;++t)136&t&&(o&&(a+=o),a+="/",o=0,t+=8),(i=le[t])?(o&&(a+=o,o=0),a+=G[i&C],Me&&i&A&&(a+="~")):++o;if(o&&(a+=o),Me&&(a+="/"+handToString(ce._hand[1],!0)+handToString(ce._hand[2])),Ee){for(r=fe[2],t=0;r;)1&r&&(h=String.fromCharCode(t+97)+h),r>>=1,++t;for(r=fe[1],t=0;r;)1&r&&(h=String.fromCharCode(t+65)+h),r>>=1,++t}else fe[1]&ee.KSIDE_CASTLE&&(h+="K"),fe[1]&ee.QSIDE_CASTLE&&(h+="Q"),fe[2]&ee.KSIDE_CASTLE&&(h+="k"),fe[2]&ee.QSIDE_CASTLE&&(h+="q");return a+=" "+(1===pe?"w":"b")+" "+(h||"-")+" "+(me===S?"-":algebraic(me))+" "+ge+" "+ve,ue===l["3-check"]?a+=" +"+Se[1]+"+"+Se[2]:ue!==l.Bughouse||ce.isDependent||(a+=" | "+ce.siblingGame.fen()),a}():function generateStandardFen(){var t,r,i=0,o="",a="";for(t=0;t<120;++t)136&t&&(i&&(o+=i),o+="/",i=0,t+=8),(r=le[t])?(i&&(o+=i,i=0),o+=G[r&C]):++i;return i&&(o+=i),fe[1]&ee.KSIDE_CASTLE&&(a+="K"),fe[1]&ee.QSIDE_CASTLE&&(a+="Q"),fe[2]&ee.KSIDE_CASTLE&&(a+="k"),fe[2]&ee.QSIDE_CASTLE&&(a+="q"),o+" "+(1===pe?"w":"b")+" "+(a||"-")+" "+(me===S?"-":algebraic(me))+" "+ge+" "+ve}()}function setHeader(t){var r,i,o;for(r=0;r<t.length;r+=2)i=t[r],o=t[r+1],i&&("Variant"===i&&(setVariant(o),o=ue?h[ue]:void 0),"Result"===i&&"*"!==o&&"1-0"!==o&&"0-1"!==o&&"1/2-1/2"!==o&&(o="*"),void 0!==o?we[i]=String(o):re.indexOf(i)>-1?we[i]="Date"===i?"????.??.??":"?":delete we[i]);return we}function updateSetup(t){be.length>0||xe||(t!==N?(we.SetUp="1",we.FEN=t,be.hash=null):(delete we.SetUp,delete we.FEN,be.hash=[1178310168,378666140]))}function get(t){var r=le[g[t]];return r?{type:G[r&P|2],color:3&r,promoted:0!=(r&A)}:null}function calculateLegalMoveInfo(r,l){var h,g,y,_,x,w,M,T,C,A,L,I,R,j=pe,N=le;if(t=[],i=0,o=0,a=0,N[8]=N[9]=N[10]=N[11]=N[12]=N[13]=N[14]=N[15]=N[24]=N[25]=N[26]=N[27]=N[28]=N[29]=N[30]=N[31]=N[40]=N[41]=N[42]=N[43]=N[44]=N[45]=N[46]=N[47]=N[56]=N[57]=N[58]=N[59]=N[60]=N[61]=N[62]=N[63]=N[72]=N[73]=N[74]=N[75]=N[76]=N[77]=N[78]=N[79]=N[88]=N[89]=N[90]=N[91]=N[92]=N[93]=N[94]=N[95]=N[104]=N[105]=N[106]=N[107]=N[108]=N[109]=N[110]=N[111]=N[120]=N[121]=N[122]=N[123]=N[124]=N[125]=N[126]=N[127]=0,l!==S){for(I=function chooseKingThreats(t,r){return Ee&&fe[t]?$:fe[t]&ee.KSIDE_CASTLE&&!le[r+1]&&!le[r+2]?fe[t]&ee.QSIDE_CASTLE&&!le[r-1]&&!le[r-2]&&!le[r-3]?(a=ee.KQSIDE_CASTLE,q):(a=ee.KSIDE_CASTLE,z):fe[t]&ee.QSIDE_CASTLE&&!le[r-1]&&!le[r-2]&&!le[r-3]?(a=ee.QSIDE_CASTLE,W):U}(j,l),h=0;h<120;++h)if(136&h&&(h+=8),_=le[h])if(_&j)(!r||(0|_)&r)&&t.push(h);else if(0!=((R=I[h-l+119])&_))if(4&_)for(C=k[_],g=1;g<3;++g)136&(M=h+C[g])||(N[M+8]|=1,M===l&&(++i,N[h+8]|=2));else{T=(C=k[_&P]).length,L=_&O;e:for(g=0;g<T;++g)if(A=C[g],!(l>(M=h)&&A<0&&l-M>16||l<M&&A>0&&M-l>16))for(;0==(136&(M+=A));){if(N[M+8]|=1,x=le[M]){if(x&j)if(M===l){for(y=M-A;y!==h;y-=A)N[y+8]|=2;N[h+8]|=2,++i,L&&0==(136&(M+=A))&&(N[M+8]|=1)}else if(L&&256&R){for(w=M;(w+=A)!==l;)if(136&w||le[w])continue e;N[M+8]|=4+(Math.abs(A)<<3),++o}break}if(!L)break}}i>1&&(t=[l])}else t=function getPieces(t,r){var i,o,a=[];for(i=0;i<120;++i)136&i&&(i+=8),(o=t[i])&&(o&r)===r&&a.push(i);return a}(le,j|r)}function validateEnPassant(t,r){var o,a,l,h=r+16*(1===pe?1:-1);return(1!==i||0!=(2&le[r+8])||0!=(2&le[h+8]))&&(o=le[t],le[r]=o,le[t]=0,a=le[h],le[h]=0,l=inCheck(),le[t]=o,le[r]=0,le[h]=a,!l)}function addCastlingMoves(t){var r,i,o;if(Ee){if(fe[t])for(i=(r=he[t])%8,o=0;o<8;++o)fe[t]&1<<o&&canCastle960(le,r,o,t)&&(y[x++]=(o>i?ee.KSIDE_CASTLE:ee.QSIDE_CASTLE)+(r<<7)+(r+(o-i)<<L),++o)}else a&ee.KSIDE_CASTLE&&(i=(r=he[t])+2,0===le[r+9]&&0===le[r+10]&&(y[x++]=ee.KSIDE_CASTLE+(r<<7)+(i<<L))),a&ee.QSIDE_CASTLE&&(i=(r=he[t])-2,0===le[r+7]&&0===le[r+6]&&(y[x++]=ee.QSIDE_CASTLE+(r<<7)+(i<<L)))}function generateMoves(r,a){var l,h,g,S,M,T,C,A,R,j,N=pe,D=swapColor(N),B=he[N];for(calculateLegalMoveInfo(r,B),w=t.length,x=_,R=0;R<w;++R)if(l=t[R],S=le[l],!(i&&o&&4&le[l+8]))if(4&S)for(T=k[S],0!==o&&0!=(4&le[l+8])&&le[l+8]>>3!=16||(M=l+T[0],0===le[M]&&(addPawnMove(le,l,M,0),te[N]===rank(l)&&(M+=T[0],le[M]||addPawnMove(le,l,M,ee.BIG_PAWN)))),h=1;h<3;++h)136&(M=l+(C=T[h]))||o&&4&le[l+8]&&le[l+8]>>3!==Math.abs(C)||(le[M]&D?addPawnMove(le,l,M,ee.CAPTURE):M===me&&validateEnPassant(l,M)&&(y[x++]=ee.EP_CAPTURE|l<<7|M<<L));else{if(o&&4&le[l+8]){if(8&S)continue;if(!(V[l-he[N]+119]&S))continue;T=[C=le[l+8]>>3,-C]}else T=k[S&P];if(j=l<<7,l===B){for(h=0;h<8;++h)0==(136&(M=l+(C=T[h])))&&(le[M]?le[M]&D&&0==(1&le[M+8])&&(y[x++]=ee.CAPTURE|j|M<<L):0==(1&le[M+8])&&(y[x++]=j|M<<L));0===i&&addCastlingMoves(N)}else for(g=T.length,A=S&O,h=0;h<g;++h)for(C=T[h],M=l;!(136&(M+=C));){if(le[M]){le[M]&D&&(0===i||2&le[M+8])&&(y[x++]=ee.CAPTURE|j|M<<L);break}if((0===i||2&le[M+8])&&(y[x++]=j|M<<L),!A)break}}return ue&&(Me?function drop(t,r,o){var a,l,h,g,_;if(!t)for(r&&(r>>=26),g=0;g<5;++g)if((!r||(0|r)==1<<g)&&ce._hand[o]&Y[g]<<K[g]){for(0===g?(a=16,l=103,h=ee.DROP):(a=0,l=119,h=ee.DROP|g<<I),_=a;_<=l;++_)136&_&&(_+=8),le[_]||(0===i||1===i&&2&le[_+8])&&(y[x++]=h|_<<L);if(r)return}}(a,r,N):!Ee&&isVariantWin()&&(x=_)),x}function inCheckAfterMove(t,r,i,o){var a,h,g,y,_,x,w,P;if(ue===l["King of the Hill"]&&t&T&&kingOfTheHillWin(i))return!0;if(o&ee.KQSIDE_CASTLE&&(i=1===pe?o&ee.KSIDE_CASTLE?117:115:o&ee.KSIDE_CASTLE?5:3,t=M,P=!0),(a=he[swapColor(pe)])===S)return!1;if(0==(t&T)&&V[i-a+119]&t)for(_=t&O,y=i+(g=X[i-a+119]);0==(136&y);){if(y===a){if(4&t){if(1==(3&t)?a-i<0:a-i>0)return!0;break}return!0}if(y!==r&&le[y]||!_)break;y+=g}if(!P){if((h=V[r-a+119])&O&&(g=X[r-a+119])!==X[i-a+119])for(y=a-g;0==(136&y);){if(y!==r&&(x=le[y])){if(x&pe&&h&x&&x&O)return!0;break}y-=g}if(o&ee.EP_CAPTURE&&(h=V[(w=i+16*(1===pe?1:-1))-a+119])&O)for(y=a-(g=X[w-a+119]);0==(136&y);){if(y!==r&&y!==w){if(y===i)break;if(x=le[y]){if(x&pe&&h&x&&x&O)return!0;break}}y-=g}}return!1}function moveToSan(t,r){var i,o,a,l,h,g,S="";return t&ee.KQSIDE_CASTLE?S=t&ee.KSIDE_CASTLE?"O-O":"O-O-O":t&ee.DROP?((i=t>>I)&&(S+=J[i]),S+="@"+algebraic(a=t>>L&R)):(a=t>>L&R,4&(l=le[o=t>>7&R])?(t&ee.ANY_CAPTURE&&(S+=String.fromCharCode(file(o)+97)+"x"),S+=algebraic(a),t&ee.PROMOTION&&(S+="="+J[i=t>>I])):(S+=H[l&C],w>1&&(S+=function getDisambiguator(t,r,i){var o,a,l,h,g,_;if(x<2)return"";for(t&=P,_=0;_<x;++_)if(i===(o=y[_])>>L&&(l=o>>7&R)!==r&&le[l]&t){if(a=!0,rank(r)===rank(l)){if(h)return algebraic(r);g=!0}if(file(r)===file(l)){if(g)return algebraic(r);h=!0}}if(a)return h?String(8-rank(r)):String.fromCharCode(file(r)+97);return""}(l,o,a)),t&ee.ANY_CAPTURE&&(S+="x"),S+=algebraic(a))),r||(t&ee.KQSIDE_CASTLE?(o=t>>7&R,a=t>>L&R):t&ee.DROP_OR_PROMOTE&&(l=Q[i]+pe),inCheckAfterMove(l,o,a,t)&&(Te(t,o,a,i),h=_,_=x,g=w,ue&&isVariantWin()||generateMoves()===_?S+="#":S+="+",x=_,_=h,w=g,reverseMove(be.pop()))),S}function attacked(t,r){var i,o,a,l,h=k[8],g=8|t;for(i=0;i<8;++i)if(0==(136&(a=r+h[i]))&&((o=le[a])&g)===g)return!0;for(h=k[128],i=0;i<8;++i)for(a=r+(l=h[i]);0==(136&a);){if(o=le[a]){if(o&t&&V[r-a+119]&o){if(!(4&o))return!0;if(1===t?r-a<0:r-a>0)return!0}break}a+=l}return!1}function kingAttacked(t){return he[t]!==S&&attacked(swapColor(t),he[t])}function inCheck(){return kingAttacked(pe)}function inCheckmate(){return inCheck()&&(y[0]=0)===generateMoves()&&!y[0]}function inStalemate(){var t=!inCheck()&&(y[0]=0)===generateMoves()&&!y[0];return t&&ue===l.Bughouse&&!ce.isDependent&&(t=ce.siblingGame.inStalemate()),t}function insufficientMaterial(t){var r,i,o=0,a=0,l=0;for(i=0;i<120;++i)if(136&i&&(i+=8),r=le[i]){if(t&&0==(r&t))continue;if(100&r)return!1;if(8&r){if(a||o++)return!1}else if(16&r){if(o)return!1;if(++a,(rank(i)+i)%2&&++l,l&&a!==l)return!1}}return!0}function inThreefoldRepetition(){if(ge<8)return!1;for(var t,r=getCurrentHash(),i=!1,o=ge,a=!1,l=be,h=l.length-1;;){if((h-=2)<0){if(l.id){h=l.atMoveNode+h+2,l=_e[l.parentId];continue}if(-2===h)return!1;t=l.hash,a=!0}else t=l[h].hash,l[h].halfMoves>o||o<2?a=!0:o=l[h].halfMoves;if(t[0]===r[0]&&t[1]===r[1]){if(i)return!0;i=!0}if(a)return!1}}function modifyHand(t){var i,o,a,h,g,y,_,x,w,S=t.move;if(ue===l.Crazyhouse||S&ee.DROP?(o=ce._hand,g=t.hash,w=t.color):(o=ce.siblingGame._hand,t.handSibling=!0,de&&((y=ce.siblingGame._history()).length?g=y[y.length-1].hash:(y.hash||(y.hash=ce.siblingGame._hashPosition()),g=y.hash)),w=swapColor(t.color)),t.captured){switch((t.captured&A?4:t.captured&P)&P){case 4:_=0;break;case 8:_=1;break;case 16:_=2;break;case M:_=3;break;default:_=4}i=1<<K[_],de&&(h=o[w]>>K[_]&Y[_],x=r.zobristPiece[h+63*_+(1===w?0:315)])}else i=-1<<K[a=S>>I],de&&(h=o[w]>>K[a]&Y[a],x=r.zobristPiece[h-1+63*a+(1===w?0:315)]);o[w]+=i,t.handChange=i,de&&hashNum(g,[31*x[0]>>>0,17*x[1]>>>0])}function makeMoveChess(t,i,o,a){var l,h,g,y,_,x,w,P,O=pe,L=swapColor(O),I={move:t,epSquare:me,halfMoves:ge,castlingW:fe[1],castlingB:fe[2],color:O},R=1===O;de&&(y=getCurrentHash(),I.hash=y,hashNum(y,r.zobristTurn),me!==S&&hashEP(le,y,me+(R?16:-16),4|O)),0==(t&ee.KQSIDE_CASTLE)?Me&&t&ee.DROP?(le[o]=Q[a]|O,de&&hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[le[o]]+8*(7-rank(o))+file(o)]),modifyHand(I),w=0):(w=le[i],(P=le[o])&&(I.captured=P,de&&hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[le[o]&C]+8*(7-rank(o))+file(o)]),P&M&&fe[L]&&(Ee?rank(o)===(R?0:7)&&(g=1<<file(o),fe[L]&g&&(fe[L]^=g,de&&(g>1<<file(he[O])?hashNum(y,r.zobristCastle[L-1]):hashNum(y,r.zobristCastle[L+1])))):o===(R?7:119)?fe[L]&ee.KSIDE_CASTLE&&(fe[L]^=ee.KSIDE_CASTLE,de&&hashNum(y,r.zobristCastle[L-1])):o===(R?0:112)&&fe[L]&ee.QSIDE_CASTLE&&(fe[L]^=ee.QSIDE_CASTLE,de&&hashNum(y,r.zobristCastle[L+1])))),le[o]=t&ee.PROMOTION?Q[a]|O|A:le[i],le[i]=0,de&&(hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[w&C]+8*(7-rank(i))+file(i)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[le[o]&C]+8*(7-rank(o))+file(o)]))):w=T,t&ee.EP_CAPTURE?(R?(x=o+16,_=6):(x=o-16,_=8),I.captured=4|L,le[x]=0,de&&hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[4|L]+8*(_-rank(o))+file(o)])):w&T?(Ee?(t&ee.KQSIDE_CASTLE&&(le[o]=0,le[i]=0,t&ee.KSIDE_CASTLE?R?(l=118,h=117):(l=6,h=5):R?(l=114,h=115):(l=2,h=3),le[l]=O|T,le[h]=O|M,de&&(hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[T|O]+8*(7-rank(i))+file(i)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[M|O]+8*(7-rank(o))+file(o)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[T|O]+8*(7-rank(l))+file(l)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[M|O]+8*(7-rank(h))+file(h)]))),de&&(0!=(fe[O]&fe[O]-1)?(hashNum(y,r.zobristCastle[O-1]),hashNum(y,r.zobristCastle[O+1])):fe[O]>1<<file(he[O])?hashNum(y,r.zobristCastle[O-1]):hashNum(y,r.zobristCastle[O+1])),he[O]=l||o):(t&ee.KQSIDE_CASTLE&&(le[o]=le[i],le[i]=0,t&ee.KSIDE_CASTLE?(l=o-1,h=o+1):(l=o+1,h=o-2),le[l]=le[h],le[h]=0,de&&(hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[T|O]+8*(7-rank(i))+file(i)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[M|O]+8*(7-rank(h))+file(h)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[T|O]+8*(7-rank(o))+file(o)]),hashNum(y,r.zobristPiece[64*r.zobristPieceValueNumbers[M|O]+8*(7-rank(l))+file(l)]))),de&&(fe[O]&ee.KSIDE_CASTLE&&hashNum(y,r.zobristCastle[O-1]),fe[O]&ee.QSIDE_CASTLE&&hashNum(y,r.zobristCastle[O+1])),he[O]=o),fe[O]=0):w&M&&fe[O]&&(Ee?rank(i)===(R?7:0)&&(g=1<<file(i),fe[O]&g&&(fe[O]^=g,de&&(g>1<<file(he[O])?hashNum(y,r.zobristCastle[O-1]):hashNum(y,r.zobristCastle[O+1])))):i===(R?119:7)?fe[O]&ee.KSIDE_CASTLE&&(fe[O]^=ee.KSIDE_CASTLE,de&&hashNum(y,r.zobristCastle[O-1])):i===(R?112:0)&&fe[O]&ee.QSIDE_CASTLE&&(fe[O]^=ee.QSIDE_CASTLE,de&&hashNum(y,r.zobristCastle[O+1]))),t&ee.BIG_PAWN?(me=R?o+16:o-16,de&&hashEP(le,y,o,4|L)):me=S,4&w||t&ee.ANY_CAPTURE?ge=0:ge++,pe=L,be.push(I)}function makeMoveVariant(t,i,o,a){var h,g=pe;makeMoveChess(t,i,o,a),h=be[be.length-1],Me?(ge=h.halfMoves+1,h.captured&&modifyHand(h),ue===l.Bughouse&&(h.bughouseOrder=ce.moveCount()-1+ce.siblingGame.moveCount())):ue===l["3-check"]&&kingAttacked(pe)&&(h.checked=!0,de&&Se[g]&&hashNum(h.hash,r.zobristCheck[Se[g]+(1===g?-1:2)]),++Se[g],de&&hashNum(h.hash,r.zobristCheck[Se[g]+(1===g?-1:2)]))}function reverseMove(t){var r,i,o=pe,a=swapColor(o),h=t.move,g=h>>L&R,y=h>>7&R;if(pe=a,fe[2]=t.castlingB,fe[1]=t.castlingW,me=t.epSquare,ge=t.halfMoves,ue){if(Ee&&h&ee.KQSIDE_CASTLE)return h&ee.KSIDE_CASTLE?1===a?(i=118,r=117):(i=6,r=5):1===a?(i=114,r=115):(i=2,r=3),le[i]=0,le[r]=0,le[y]=a|T,le[g]=a|M,void(he[a]=y);if(t.handChange&&(ue!==l.Crazyhouse&&t.handSibling?ce.siblingGame._hand[swapColor(a)]-=t.handChange:ce._hand[a]-=t.handChange),h&ee.DROP)return void(le[g]=0);t.checked&&--Se[a]}h&ee.PROMOTION?(le[y]=4|a,le[g]=h&ee.CAPTURE?t.captured:0):(le[y]=le[g],h&ee.KQSIDE_CASTLE?(le[g]=0,h&ee.KSIDE_CASTLE?(r=g+1,i=g-1):(r=g-2,i=g+1),le[r]=a|M,le[i]=0,he[a]=y):(g===he[a]&&(he[a]=y),h&ee.CAPTURE?le[g]=t.captured:(le[g]=0,h&ee.EP_CAPTURE&&(le[g-(1===a?-16:16)]=4|o))))}function beautifyMove(t,r,i){var o,a,l=t>>L&R,h={color:pe,to:algebraic(l),flags:t&R};return Me&&0!=(t&ee.DROP)?(a=t>>I,h.drop=a,h.piece=Q[a]+pe):(o=t>>7&R,h.from=algebraic(o),h.piece=le[o],t&ee.PROMOTION&&(a=t>>I,h.promotion=Q[a]+pe),t&ee.CAPTURE?h.captured=le[l]:t&ee.EP_CAPTURE&&(h.captured=4|swapColor(pe))),h.san=r||moveToSan(t,i),h}function isVariantWin(){return ue===l["3-check"]?3===Se[swapColor(pe)]:ue===l["King of the Hill"]?kingOfTheHillWin(he[swapColor(pe)]):void 0}function isBughouseWin(){if(ue===l.Bughouse)return ce.siblingGame.inCheckmate()}function createVariation(){var t=[],r=generateFen(),i=be.length-1,o=be[i];return!!o&&(t.parentId=xe,t.id=_e.length,be.curFen=r,o.lines||(o.lines=[]),o.lines.push(t.id),o.move?reverseMove(o):(me=o.epSquare,--ge,pe=swapColor(pe)),2===pe&&--ve,t.atMoveNode=i,t.hash=i?be[i-1].hash:be.hash,xe=t.id,_e.push(t),be=t,!0)}function selectLine(t){var r=generateFen();be.curFen=r,be=_e[t],xe=t,load(be.curFen,ue,!0,!0)}return ce={WHITE:1,BLACK:2,PAWN:4,KNIGHT:8,BISHOP:16,ROOK:M,QUEEN:64,KING:T,FLAGS:ee,load:load,reset:reset,moves:function(t){var r,i,o,a=[],l=moveToSan;for(t&&(t.verbose&&(l=beautifyMove),t.type&&(i=t.type|t.type<<24),o=t.noDrop),generateMoves(i,o),r=0;r<x;++r)a.push(l(y[r]));return a},inCheck:inCheck,inCheckmate:inCheckmate,inStalemate:inStalemate,isBughouseWin:isBughouseWin,in50MoveRule:function(){return ge>=100},inDraw:function(){return ge>=100||inStalemate()||insufficientMaterial()||inThreefoldRepetition()||Boolean(function isBughouseDraw(){if(ue===l.Bughouse)return ce.siblingGame.in50MoveRule()||ce.siblingGame.inThreefoldRepetition()}())},insufficientMaterial:insufficientMaterial,inThreefoldRepetition:inThreefoldRepetition,isVariantWin:isVariantWin,gameOver:function(){return ce.inDraw()||inCheckmate()||Boolean(isVariantWin())||Boolean(isBughouseWin())},isPositionValid:function(t){var r,i,o,a=0;if(!1!==(t=t||{}).pawns)for(r=0;r<=119;){if(4&(o=le[r]))return!1;8==++r&&(r=112)}if(!1!==t.kings){for(r=0;r<=119;++r)if(136&r&&(r+=8),(o=le[r])&T){if(++a>2)return!1;if(i&&i&o)return!1;i=3&o}if(2!==a)return!1}return!1===t.check||!1===t.kings&&he[swapColor(pe)]===S||!kingAttacked(swapColor(pe))},validateFen:validateFen,fen:generateFen,pgn:function(t){return(t=t||{}).useResultHeader||xe||(isVariantWin()||inCheckmate()?we.Result=2===pe?"1-0":"0-1":ce.inStalemate()?we.Result="1/2-1/2":isBughouseWin()&&(we.Result=1===ce.siblingGame.turn()?"1-0":"0-1")),oe(t,we,_e,ye,ue,ce)},loadPgn:function(t,r,i){var o,a,l,h,g,y,_,x,w,S={},M=0;if("number"!=typeof r&&(i=i||r,r=0),i=i||{},"string"==typeof t&&(i.singleGame&&(t=t.replace(/(?:\r?\n\s*){2,}/g,"\n")),t=ce.tokenizePgn(t,i)),r<0&&(r=t.length+r),!(h=t[r]))return!1;for(reset(),a=h.length,o=0;o<a&&"tagName"===(l=h[o]).type;++o){if(!h[o+1]||"tagValue"!==h[o+1].type)return!1;++o,"FEN"===l.value?_=completeFen(h[o].value):S[l.value]=h[o].value}if(i.variant&&(S.Variant=i.variant),S.Variant&&!_&&(_=N),_||"1"===S.SetUp)if("0"===S.SetUp)S.FEN=_;else if(!_||!load(_,S.Variant))return!1;for(ce.header(S),y=(g=ce)._history();o<a;++o)if("san"===(l=h[o]).type&&0===M){if(!g.move(l.value)&&("Z0"!==l.value&&"<>"!==l.value||i.rejectNullMoves||!g.move("--")))if(i.commentErrors)y.length?y[y.length-1].comment=((y[y.length-1].comment||"")+" "+l.value).trim():y.initComment=((y.initComment||"")+" "+l.value).trim();else{if(!i.skipBadLines||!(0!==xe||be.length&&i.allowBadMainLine))return reset(),!1;M=1}}else if("result"===l.type&&"*"===we.Result)setHeader(["Result",l.value]);else if("a"===l.type&&0===M&&y[y.length-1])y[y.length-1].annotation=l.value;else if("nag"!==l.type&&"aa"!==l.type||0!==M||!y[y.length-1])if("comment"===l.type&&0===M)y.length?(l.value&&(y[y.length-1].comment=l.value),l.commands&&(y[y.length-1].commands=l.commands,l.commands.clk&&(y[y.length-1].time=(x=l.commands.clk,w=void 0,10*(3600*(w=x.split(":"))[0]+60*w[1]+1*w[2]))))):(y.initComment=String(l.value),l.commands&&(y.commands=l.commands));else if("variationStart"===l.type){if(M>0)++M;else if(!createVariation())return reset(),!1;y=g._history()}else if("variationEnd"===l.type)M>0&&--M,0===M&&(selectLine(y.parentId),y=g._history());else if("number"===l.type){if(!(g=/b/i.test(l.value.slice(-1))?ce.siblingGame:ce))return!1;y=g._history()}else"cont"===l.type&&xe&&!y.length&&g.move(g._lines()[y.parentId][y.atMoveNode].san);else y[y.length-1].additionalAnnotation||(y[y.length-1].additionalAnnotation=[]),-1===y[y.length-1].additionalAnnotation.indexOf(l.value)&&y[y.length-1].additionalAnnotation.push(l.value);return!0},header:function(t){return Array.isArray(t)?setHeader(t):"object"==typeof t?(Object.keys(t).forEach((function(r){setHeader([r,t[r]])})),we):we},turn:function(t){return 1!==t&&2!==t||(pe=t),pe},move:function playMove(t){var i,o,a,l,h,_,w,M,C,O,N,k,D;if("string"==typeof t){switch(t[l=t.length-1]){case"+":case"#":t=t.substr(0,l)}for(C=j.indexOf(t[0])>6?B[t[0]]:"O"===t[0]?T:4,Me&&(-1===t.indexOf("@")?O=!0:(O=!1,C<<=24)),generateMoves(C,O),l=0;l<x;++l)if(t===(_=moveToSan(y[l],!0))){o=y[l];break}if(!o){if("--"===t)return function makeNullMove(){var t,i={color:pe,san:"--",epSquare:me},o={color:pe,san:"--"};return de&&(t=getCurrentHash(),i.hash=t,hashNum(t,r.zobristTurn),me!==S&&hashEP(le,t,me+(1===pe?16:-16),4|pe)),me=S,ge++,1===(pe=swapColor(pe))&&++ve,be.push(i),o}();if(t=Chess.fixSanMove(t,le,pe))try{return playMove(t)}catch(G){}return null}w=o>>7&R,M=o>>L&R,a=o>>I}else{if(t.drop){switch(t.drop){case"p":a=0;break;case"n":a=1;break;case"b":a=2;break;case"r":a=3;break;case"q":a=4;break;default:return null}C=1<<26+a}else{if(t.promotion)switch(t.promotion){case"q":a=4;break;case"n":a=1;break;case"r":a=3;break;case"b":a=2;break;default:return null}w=g[t.from],O=!0,C=le[w]&P}for(M=g[t.to],i=((a?a<<I:0)|M<<L)>>7|w,generateMoves(C,O),l=0;l<x;++l)if(y[l]>>7===i){o=y[l];break}if(!o)return(t=Chess.fixObjMove(t,le,pe))?playMove(t):null}return D=o&ee.DROP_OR_PROMOTE?Q[a]+pe:le[w],h=beautifyMove(o,_,!0),N=inCheckAfterMove(D,w,M,o),Te(o,w,M,a),N&&(ue&&isVariantWin()||0===generateMoves()?h.san+="#":h.san+="+"),(k=be[be.length-1]).san=h.san,h.piece&A&&(k.promoted=!0),1===pe&&++ve,h},undo:function(t){var r=be.pop();return r?(1===pe&&--ve,r.move?(reverseMove(r),!!t||beautifyMove(r.move,r.san)):(me=r.epSquare,--ge,pe=swapColor(pe),!!t||{san:"--",color:r.color})):null},clear:function(t){clear(t)},put:function(t,r,i){var o,a=g[r],l=!1,h=le[a],y=3&h,_=t.color;if(isNaN(a)||!t.type||!_||-1===j.indexOf(t.type))return!1;if(le[a]=B[t.type]|_|(t.promoted?A:0),le[a]&T&&(he[_]=a),h&&le[he[y]]&&le[he[y]]!==(T|y)){for(o=0;o<120;++o)136&o&&(o+=8),le[o]===(T|y)&&(he[y]=o,l=!0);l||(he[y]=S)}return i||load(generateFen(),ue,!0,!1),!0},get:get,remove:function(t,r){var i,o=le[g[t]],a=get(t),l=3&o;if(le[g[t]]=0,o&T)for(he[l]=S,fe[l]=0,i=0;i<120;++i)if(136&i&&(i+=8),le[i]===(T|l)){he[o.color]=i;break}return r||load(generateFen(),ue,!0,!1),a},history:function(t,r){for(var i,o=[],a=be,l=a.length;;){if(-1==--l){if(a.id&&!r){l=a.atMoveNode,a=_e[a.parentId];continue}break}t?((i=beautifyMove(a[l].move,a[l].san)).color=a[l].color,!l&&a.initComment&&(i.firstComment=a.initComment),void 0!==a[l].comment&&(i.comment=a[l].comment),void 0!==a[l].time&&(i.time=a[l].time),void 0!==a[l].annotation&&(i.annotation=a[l].annotation),void 0!==a[l].additionalAnnotation&&(i.additionalAnnotation=a[l].additionalAnnotation),void 0!==a[l].commands&&(i.commands=a[l].commands),void 0!==a[l].captured&&(i.captured=a[l].captured),void 0!==a[l].promoted&&(i.promoted=a[l].promoted),void 0!==a[l].lines&&(i.lines=a[l].lines),void 0!==a[l].bughouseOrder&&(i.bughouseOrder=a[l].bughouseOrder),j.indexOf(a[l].san[0])>6?i.piece=B[a[l].san[0]]:"O"===a[l].san[0]?i.piece=T:i.piece=4,i.piece|=i.color,o.unshift(i)):o.unshift(a[l].san)}return o},hashes:function(){for(var t=[],r=be,i=r.length;;){if(-1==--i){if(r.id){i=r.atMoveNode,r=_e[r.parentId];continue}r.hash||getCurrentHash(),t.unshift(r.hash);break}t.unshift(r[i].hash)}return t},moveCount:function(){return be.length},startingMoveNumber:function(){return ye},completeFen:completeFen,createVariation:createVariation,selectLine:selectLine,hash:function(){var t=getCurrentHash();return ue!==l.Bughouse||ce.isDependent?t:[t,ce.siblingGame.hash()]},hashing:function(t){de=t,ue!==l.Bughouse||ce.isDependent||ce.siblingGame.hashing(de)},hand:function(){if(Me)return handToString(ce._hand[1],!0)+handToString(ce._hand[2])},checks:function(){if(ue===l["3-check"])return[Se[1],Se[2]]},threats:function(){var t,r,a,l,h,g,w,M=pe,T=swapColor(M),C=[],A=[],O=[],j=[],N=[],k=me;if(calculateLegalMoveInfo(0,he[M]),i||o)for(t=0;t<120;++t)136&t&&(t+=8),2&le[t+8]&&le[t]?O.push(algebraic(t)):4&le[t+8]&&C.push(algebraic(t));for(pe=T,me=S,generateMoves(),t=x;t--;){if(h=(r=y[t])>>L&R,g=r>>7&R,r&ee.DROP_OR_PROMOTE){if(l=Q[w=r>>I]|T,r&ee.PROMOTION&&w%3!=1)continue}else l=le[g],w=0;if(inCheckAfterMove(l,g,h,r)&&(Te(r,g,h,w),_=t,(ue&&isVariantWin()||generateMoves()===t)&&A.push((r&ee.DROP?G[l].toLowerCase()+"@":algebraic(g))+algebraic(h)),reverseMove(be.pop()),r&ee.CAPTURE)){for(a=0,t=x;t>_;)if((y[--t]>>L&R)===h){a=1,t=_;break}if(!a){j.push(algebraic(g)+algebraic(h));continue}}r&ee.CAPTURE&&1!==w&&(a=124&le[h])&&(attacked(M,h)?a>(l=le[g]&P)&&a-l!=8&&N.push(algebraic(g)+algebraic(h)):j.push(algebraic(g)+algebraic(h)))}return _=0,pe=M,me=k,{pins:C,checkers:O,mates:A,undefended:j,underdefended:N}},tokenizePgn:ae,_hand:[],_history:function(t){return t&&(xe=(be=t).id),be},_lines:function(){return _e},_hashPosition:hashPosition,_board:function(){return le}},ie&&load(ie,se)||reset(),ce}return Chess.fixSanMove=function(t,r,i){var o,a,l;if(/0|[?!+#]$|[18][QNRB]$|^P/i.test(t))return t.replace(/[?!+#]+$/,"").replace(/0/g,"O").replace(/([18])([QNRB])$/i,"$1=$2").replace(/^P+/i,"");if(a=t.indexOf("=")>0?-4:-2,"number"==typeof(o=g[t.substr(a,2)])){if(r[o]&swapColor(i)||/^[a-h]x?[a-h][36]$/.test(t)){if(-1===t.indexOf("x"))return t.slice(0,a)+"x"+t.substr(a)}else if(t.indexOf("x")>-1)return t.replace(/x/g,"");if(l=t.match(/^([KQNRB]?)([a-h][1-8]?|[1-8])x?([a-h][1-8])=?(.?)$/))return r[g[l[2]]]?{from:l[2],to:l[3],promotion:l[4].toLowerCase()}:l[1]+l[3]+l[4]}},Chess.fixObjMove=function(t,r,i){if(r[g[t.from]]===(T|i)&&t.to&&t.from[1]===t.to[1]){if(t.from<t.to)return"O-O";if(t.from>t.to)return"O-O-O"}},Chess.variants=h,Chess}(),o=function(){var t,o=i(),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",l=252,h={4:"p",5:"P",6:"p",8:"n",9:"N",10:"n",16:"b",17:"B",18:"b",32:"r",33:"R",34:"r",64:"q",65:"Q",66:"q",128:"k",129:"K",130:"k"},g=512,y="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!?{~}(^)[_]@#$,./&-*++=",_="qnrbkp";function decodeTCN(t){var r,i,o,a,l=t.length,h=[];for(r=0;r<l;r+=2)a={},i=y.indexOf(t[r]),(o=y.indexOf(t[r+1]))>63&&(a.promotion=_[Math.floor((o-64)/3)],o=i+(i<16?-8:8)+(o-1)%3-1),i>75?a.drop=_[i-79]:a.from=y[i%8]+(Math.floor(i/8)+1),a.to=y[o%8]+(Math.floor(o/8)+1),h.push(a);return h}function uciToObj(t){var r,i,o=t.split(" "),a=o.length,l=[];if(t)for(r=0;r<a;++r)4===(i=o[r]).length?"@"===i[1]?l.push({drop:i[0].toLowerCase(),to:i.substr(2,2)}):l.push({from:i.substr(0,2),to:i.substr(2,2)}):l.push({from:i.substr(0,2),to:i.substr(2,2),promotion:i[4]});return l}function isSameMove(t,r){return t.san===r.san||t.from==r.from&&t.to==r.to&&t.promotion==r.promotion&&t.drop==r.drop}function getPremoves(t,r,o){var a,l,h,g,y,_,x,w,S,M,T=[],P=1,C=8,A=1,O=8,L={verbose:!0};for(S=3-(M=t.turn()),(g=i("/",r)).turn(S),o&&(P=C=+o[1],A=O=o.charCodeAt(0)-96),a=P;a<=C;++a)for(l=A;l<=O;++l)y=String.fromCharCode(l+96)+a,(h=t.get(y))&&h.color===S&&(g.put(h,y,!0),"p"===h.type?(_=String.fromCharCode(l-1+96)+(a+(1===S?1:-1)),x=String.fromCharCode(l+1+96)+(a+(1===S?1:-1)),g.put({type:"n",color:M},_,!0),g.put({type:"n",color:M},x,!0)):"k"===h.type&&"-"!==(w=t.fen().split(" ")[2])&&g.load(g.fen().replace(/^(\S+\s\S\s)(\S+)/,"$1"+w),r,!0,!0),T=T.concat(g.moves(L)),g.remove(y,!0),"p"===h.type&&(g.remove(_,!0),g.remove(x,!0)));return r&&t.hand()&&(g._hand[S]=18721,T=T.concat(g.moves({verbose:!0}).filter((function(t){return!o||t.to===o})))),T.forEach((function(t){normalizeMoveObj(t)})),T}function makePremove(t,r){var a,l,h,g,y,_=t.header().Variant,x=getPremoves(t,_,r.from),w=3-t.turn();for(a=x.length-1;a>=0;--a)if(isSameMove(l=x[a],r)){h=!0;break}return h?(l.drop?t.put({type:l.drop,color:w},l.to):(g=t.remove(l.from,!0),l.flags===o.FLAGS.KSIDE_CASTLE?(y=t.remove("Chess960"===_?l.to:"h"+l.from[1],!0),t.put(g,"g"+l.from[1],!0),t.put(y,"f"+l.from[1])):l.flags===o.FLAGS.QSIDE_CASTLE?(y=t.remove("Chess960"===_?l.to:"a"+l.from[1],!0),t.put(g,"c"+l.from[1],!0),t.put(y,"d"+l.from[1])):(l.promotion&&(g.type=l.promotion,g.promoted=!0),y=t.get(l.to),t.put(g,l.to,"k"!==g.type&&"r"!==g.type&&(!y||y.color!==w||"r"!==y.type)))),l):r.from&&(r=i.fixObjMove(r,t._board(),w))?makePremove(t,{san:r,from:r.from}):void 0}function getPieces(t,r){var i,o,a,_=r?{}:[],x=t._board();if(r)for(i=112;i>=0;++i)136&i&&(i-=24),(o=x[i])&&(_[a=y[7&i]+(8-(i>>4))]={type:h[o&l],color:3&o,promoted:0!=(o&g),square:a});else for(i=112;i>=0;++i)136&i&&(i-=24),(o=x[i])&&_.push({type:h[o&l],color:3&o,promoted:0!=(o&g),rank:8-(i>>4),file:1+(7&i)});return _}function makeMoves(t,r,i,o){var a,l,h,g,y,_,x,w,S,M;for(i=i||{},"string"==typeof r&&(r=r.trim().split(" ")),h=r.length,a=0;a<h;a+=1){if(y="b"===r[a].board||"B"===r[a].board?t.siblingGame:t,_="string"==typeof r[a]?uciToObj(r[a])[0]:r[a].san?r[a].san:r[a],!y.move(_)){if(!i.autoPromote){if(i.skipBadLines)break;return!1}if(!0===i.autoPromote?_.promotion="q":_.promotion=i.autoPromote,!y.move(_)){if(i.skipBadLines)break;return!1}}if(w=(x=y._history())[x.length-1],o&&(S=parseInt(o[a],10)),("number"!=typeof S||isNaN(S))&&(S=parseInt(r[a].time,10)),"number"!=typeof S||isNaN(S)||(w.time=S,S=void 0),r[a].firstComment&&(x.initComment=r[a].firstComment),r[a].comment&&(w.comment=r[a].comment),r[a].annotation&&(w.annotation=r[a].annotation),r[a].additionalAnnotation&&(w.additionalAnnotation=r[a].additionalAnnotation),r[a].commands&&(w.commands=r[a].commands),r[a].lines)for(g=r[a].lines.length,l=0;l<g;++l){if(M=t._history().id,t.createVariation(),!makeMoves(t,r[a].lines[l],i)&&!i.skipBadLines)return!1;t.selectLine(M)}}return!0}function extendChess(t){var r,l,h,g,y=-1,_=0;function swapMoveAttributes(t,r){var i={moveTime:t.moveTime,firstComment:t.firstComment,comment:t.comment,annotation:t.annotation,additionalAnnotation:t.additionalAnnotation,commands:t.commands};Object.keys(i).forEach((function(o){t[o]=r[o],r[o]=i[o]}))}t.extended||(t.extended=!0,r={header:t.header,load:t.load,loadPgn:t.loadPgn,createVariation:t.createVariation,undo:t.undo,pgn:t.pgn},t._move=t.move,t.undo=function(){return t.siblingGame?t.deleteBughouseMove(t.curBughouseMove()):t.deletePosition(y,_)},t.getMove=function(i){return i&&("string"==typeof i||i.to&&(i.from||i.drop))&&t._move(i)&&normalizeMoveObj(r.undo())||null},t.premove={queue:g=[],move:function(r){var o;return!(o=makePremove(h=h||i(t.fen(),t.header().Variant),r))||_||y!==t._history().length-1?(g.length||(h=void 0),null):(g.push(o),o)},consume:function(){var r,o,a,l=g.shift();if(l){if(r=t.move(l)){if(h=void 0,o=g.length)for(h=i(t.fen(),t.header().Variant),a=0;a<o;++a)makePremove(h,g[a]);return r}t.premove.cancel()}},moves:function(r){return!_&&y===t._history().length-1&&getPremoves(h||t,t.header().Variant,r)},getPieces:function(r){return getPieces(h||t,r)},fen:function(){return(h||t).fen()},cancel:function(){g.length=0,h=void 0}},t.getPieces=function(r){return getPieces(t,r)},t.material=function(){var r,i,o,a=t.getPieces(),l={imbalance:0,white:{p:8,n:2,b:2,r:2,q:1,count:0},black:{p:8,n:2,b:2,r:2,q:1,count:0}},h={p:1,n:3,b:3,r:5,q:9,k:0};for(r=a.length-1;r>=0;--r)1===a[r].color?(i=l.white,o=l.black):(i=l.black,o=l.white),o[a[r].type]&&--o[a[r].type],i.count+=h[a[r].type];return l.imbalance=l.white.count-l.black.count,l},t.origHistory=t.history,t.history=function(r,i){var o,a,l,h=[],g=t._history(),y=g.length,_=t._lines();for("boolean"==typeof r&&(r={verbose:r}),r=r||{},i&&(r.noParentLines=i),r.toCurrent&&(y=t.ids().move+1);;){if(-1==--y){if(g.id&&!r.noParentLines){y=g.atMoveNode,g=_[g.parentId];continue}break}if(r.verbose){for(a in o={},g[y])if(g[y][a]&&"object"==typeof g[y][a])for(l in o[a]=g[y][a].constructor===Array?[]:{},g[y][a])o[a][l]=g[y][a][l];else o[a]=g[y][a];h.unshift(o)}else h.unshift(g[y].san)}return h},t._getPos=function(i,o){var l,h,g;return"number"!=typeof i&&(i=y),"number"!=typeof o&&(o=_),l=(h=t._lines())[o],i>=0?l[i]:l.id?l.atMoveNode?h[l.parentId][l.atMoveNode-1]:t._getPos(l.atMoveNode-1,l.parentId):(g={fen:r.header().FEN||a,hash:l.hash,initial:!0,ids:{move:-1,line:0}},t.siblingGame&&(g.bughouseOrder=-1),g)},t.move=function(r,i){var o,a,l,h,g=t._history();if(r&&("string"==typeof r||r.to&&(r.from||r.drop))){if(_===g.id&&y<g.length-1||i){if(t.moveForward(i,r))return!0;y<g.length-1&&(t.selectPosition(y+1),t.createVariation(),g=t._history())}t.siblingGame&&(l=t.isDependent?t.siblingGame.fen():t.fen()),(o=t._move(r))&&(normalizeMoveObj(o),_=g.id,a=g[y=g.length-1],h=t._getPos(y-1),t.siblingGame?(a.fen=t.isDependent?t.siblingGame.fen():t.fen(),a.beforeFen=l,a.siblingIds=t.siblingGame.ids()):(a.fen=t.fen(),a.beforeFen=h.fen),h.initial?(a.moveNumber=0,a.previous=null):(a.moveNumber=h.moveNumber+1,a.previous=h.ids),_&&0===y&&t._lines()[g.parentId][g.atMoveNode].move===a.move&&(a.isContinuation=!0),a.flags=o.flags,a.to=o.to,a.from=o.from,a.drop=o.drop,a.capturedStr=o.captured,a.promotion=o.promotion,a.piece=o.piece,o.promoted&&(a.promoted=!0),o.capturedPromotedPawn&&(a.capturedPromotedPawn=!0),a.ids={move:y,line:_})}return o},t.moveDetails=function(r){return(r=r||t._history()[y])&&(r.lines=r.lines||null,r.flags===o.FLAGS.KSIDE_CASTLE?(r.rookFrom="Chess960"===t.header().Variant?r.to:"h"+r.to[1],r.rookTo="f"+r.to[1],r.kingTo="g"+r.to[1]):r.flags===o.FLAGS.QSIDE_CASTLE?(r.rookFrom="Chess960"===t.header().Variant?r.to:"a"+r.to[1],r.rookTo="d"+r.to[1],r.kingTo="c"+r.to[1]):r.flags===o.FLAGS.EP_CAPTURE&&(r.epCapture=r.to[0]+r.from[1])),r},t.header=t.headers=function(i){var o=r.header(i);return t.siblingGame&&extendChess(t.siblingGame),o},t.load=function(i,o,a,l){var h=r.load(i,o,a,l);return t.siblingGame&&extendChess(t.siblingGame),h&&!a&&(y=-1,_=0),h},t.removeEmptyLines=function(){var r,i,o=t._lines();for(r=o.length-1;r>0;--r)o[r].length||(o[r]=void 0,i=!0);i&&t.reorderLines()},t.loadPgn=function(i,o,a){var l=r.loadPgn(i,o,a),h=t._history();return t.removeEmptyLines(),y=h.length-1,(_=h.id)&&t.selectLine(0),l},t.ids=function(){return{move:y,line:_}},t.selectLine=function(r){t.selectPosition(null,r)},t.curBughouseMove=function(){return Math.max(t._getPos().bughouseOrder,t.siblingGame._getPos().bughouseOrder)},t.deleteBughouseMove=function(r){var i,o,a,l=t.curBughouseMove(),h=!1,g=t;if(r>=0)for(l>=r&&t.selectBughouseMove(r-1);;){for(o=(i=g._history()).length,a=0;a<o;++a)if(i[a].bughouseOrder>=r){i.length=a,h=!0;break}if(g===t.siblingGame)break;g=t.siblingGame}return h},t.selectBughouseMove=function(r){var i,o,a=t.isDependent?t.siblingGame:t,l=a;if(-1===r)return l.selectPosition(-1,0,!0),l.siblingGame.selectPosition(-1,0,!0),a.load(a.header().FEN,"Bughouse",!0,!0);for(;;){for(o=(i=l._history()).length-1;o>=0;--o)if(i[o].bughouseOrder===r)return l.selectPosition(i[o].ids.move,0,!0),l.siblingGame.selectPosition(i[o].siblingIds.move,0,!0),a.load(i[o].fen,"Bughouse",!0,!0);if(l===a.siblingGame)return!1;l=a.siblingGame}},t.moveBackward=function(){var r;if(t.siblingGame)return t.selectBughouseMove(t.curBughouseMove()-1);if(y<=1)if(0===_){if(-1===y)return!1;t.selectPosition(y-1)}else(r=t._getPos(y-1,_)).isContinuation&&(r=t._getPos(r.ids.move-1,r.ids.line),r=t._getPos(r.ids.move+1,r.ids.line)),t.selectPosition(r.ids.move,r.ids.line);else t.selectPosition(y-1);return!0},t.moveForward=function(r,o){var a,l,h,g,x,w,S=t._lines();if(t.siblingGame)return t.selectBughouseMove(t.curBughouseMove()+1);if("string"==typeof o&&(o={san:o}),!(a=S[_][y+1])||o&&!isSameMove(o,a)){if(o&&a&&a.lines)for(x=a.lines.length,g=0;g<x;++g)if((h=S[a.lines[g]][0])&&isSameMove(o,h)){a=h,w=!0;break}if(!w&&r&&(l=S[_][y])&&l.lines)for(x=l.lines.length,g=0;g<x;++g)if((h=S[l.lines[g]][0])&&h.isContinuation&&(h=S[l.lines[g]][1])&&(!o||isSameMove(o,h))){a=h,w=!0;break}if(!w){try{if(o&&o.san&&(o=i.fixSanMove(o.san,t._board(),t.turn()))||o&&o.to&&o.from&&Math.abs(o.to.charCodeAt(0)-o.from.charCodeAt(0))>1&&(o=i.fixObjMove(o,t._board(),t.turn())))return t.moveForward(r,o)}catch(M){}return!1}}return t.selectPosition(a.ids.move,a.ids.line)},t.moveVariation=function(r,i){var o,a,l,h=t._lines(),g=h[r];if(g&&g.id)for(a=(o=h[g.parentId][g.atMoveNode].lines).length-1;a>=0;--a)if(o[a]===r&&o[l=a-(i?1:-1)])return o[a]=o[l],o[l]=r,t.reorderLines(),!0;return!1},t.promoteVariation=function(r,i){for(var o,a,l,h,g,x,w=t._lines(),S=w[r];S&&S[0]&&S.id&&(-1!==i||S.parentId);){for(o=w[l=S.parentId],h=S.atMoveNode,S[0].lines=o[h].lines.concat(S[0].lines||[]),o[h].lines=void 0,x=o.length-h,a=o.splice(h,x),g=0;g<x;++g)a[g].ids.line=r,a[g].ids.move=g;for(a.id=r,a.parentId=l,a.atMoveNode=h,a.hash=S.hash,0===h?(a.initComment=o.initComment,o.initComment=S.initComment):S.initComment&&(o[h-1].comment=((o[h-1].comment||"")+" "+S.initComment).trim()),w[r]=a,x=S.length,g=0;g<x;++g)S[g].ids.line=l,S[g].ids.move=g+h,o.push(S[g]);for(a[0].isContinuation=!!S[0].isContinuation,o[h].isContinuation=!h&&"number"==typeof o.parentId&&w[o.parentId][o.atMoveNode].move===o[0].move,x=o[h].lines.length,g=0;g<x;++g)w[o[h].lines[g]].atMoveNode=h,w[o[h].lines[g]][0]&&(w[o[h].lines[g]][0].isContinuation=w[o[h].lines[g]][0].move===o[h].move);if(_===r?(_=l,y+=h):_===l&&y>=h&&(_=r,y-=h),1===i)break;S=w[r=l]}return void 0!==o&&(t._history(w[_]),t.reorderLines(),!y&&w[_][0].isContinuation&&t.selectPosition(w[_].atMoveNode,w[_].parentId),!0)},t.reorderLines=function(r,i){var o,a,h,g,y,x,w,S,M,T,P=t._lines();for(r?M=i.length-1:(r=0,i=[P[0]],M=0,l=!1),h=(o=P[r]).length,a=0;a<h;++a)if((g=o[a]).ids.line=M,g.lines)for(y=g.lines.length,x=0;x<y;++x)(S=P[w=g.lines[x]])?(S.atMoveNode=a,T=i.length,g.lines[x]=T,S.parentId=M,l||w!==_||(l=!0,_=T),i.push(S),t.reorderLines(w,i)):(1===g.lines.length?delete g.lines:g.lines.splice(x,1),--x,--y);r||t.saveLines(i,!0)},t.createVariation=function(){var i,o,a,l=t._history(),h=t._lines();return y===l.length-1?(i=r.createVariation(),l=t._history(),y=l.length-1,_=l.id,i):-1!==y&&(o=[],a=l[y],o.parentId=l.id,o.id=h.length,a.lines||(a.lines=[]),a.lines.push(o.id),o.hash=t._getPos(y-1).hash,o.atMoveNode=y,h.push(o),t.selectPosition(-1,o.id))},t.selectLineEnd=function(r){return t.siblingGame?t.selectBughouseMove(t._history().length+t.siblingGame._history().length-1):("number"!=typeof r&&(r=_),(r!==_||y<t._history().length-1)&&t.selectPosition(null,r,!0))},t.selectLineStart=function(){var r,i;return t.siblingGame?t.selectBughouseMove(-1):_?(y>1||1===y&&!t._getPos(0).isContinuation?r=t._history():(i=t._getPos(-1),r=t._lines()[i.ids.line]),t.selectPosition(r.id?r[1]&&r[0].isContinuation?1:0:-1,r.id)):-1!==y&&t.selectPosition(-1,0)},t.selectPosition=function(i,o,a){var l=t._lines(),h=t._history();if("number"==typeof o&&(o!==_||a)){if(o<0||o>=l.length)return!1;if(h=l[o],"number"!=typeof i)i=h.length-1;else if(i<-1||i>=h.length)return!1;_=o,t._history(h),a=!0}if("number"==typeof i&&(i!==y||a)){if(i<-1||i>=h.length)return!1;r.load(t._getPos(i).fen,r.header().Variant,!0,!0),y=i}return!0},t.resetToMainLine=function(){var r=t._lines();t.selectLineEnd(0),r.length>1&&(r.length=1,t.reorderLines())},t.updateNode=function(r,i,o){var a,l,h=t._lines();for(l in i="number"==typeof i?i:_,a=h[o="number"==typeof o?o:_][i]||h[o],r)a[l]=r[l]},t.updateLineComment=function(r,i){t.updateNode({initComment:r},-1,i)},t.saveLines=function(r,i){var o,a,l,h=t._lines(),g=r.length;for(r!==h&&(h.length=0),a=0;a<g;++a){if(o=r[a],a&&"number"!=typeof o.parentId)return!1;r!==h&&h.push(o),o.id=a}return t._history(t._history()),i||(l=t.ids(),t.selectPosition(-1,0,!0),t.selectPosition(l.move,l.line)),!0},t.deletePosition=function(r,i){var o,a=t._lines();return!(!a[i]||!(a[i][r]||-1===r&&0!==i))&&(i&&(0===r||1===r&&a[i][0].isContinuation)&&(r=-1),(_>0&&i!==_?!1!==(o=function descendsFromMove(t,r,i){for(var o,a=t[r];"number"==typeof(o=a.parentId);){if(o===i)return a.atMoveNode;a=t[o]}return!1}(a,_,i))&&o>=r:i===_&&r<=y)&&(r>1?t.selectPosition(r-1,i):(t.selectPosition((a[i][0].isContinuation||1===r)&&a[i][1]?1:0,i),t.moveBackward())),r>0?a[i].length=r:i?a[i]=null:a[0].length=0,t.reorderLines(),t.ids())},t.mark=function(r,i){var o=y<0?t._lines()[_]:t._lines()[_][y],a=r.type,l=1;r.color&&("arrow"===a?t.mark({key:r.color+r.key,type:"cal"},i):"square"===a&&t.mark({key:r.color+r.key,type:"csl"},i)),"cal"!==a&&"csl"!==a&&(a="c_"+a,l=0),o.commands&&o.commands[a]&&(o.commands[a]=o.commands[a].split(",").filter((function rm(t){return t.slice(l).split(";")[0]!==r.key.slice(l)})).join(","),o.commands[a]||delete o.commands[a]),i||(o.commands||(o.commands={}),o.commands[a]=(o.commands[a]?o.commands[a]+",":"")+r.key+(r.data?";"+r.data.join(";"):""))},t.markings=function(){var r,i,o,a,l,h,g,x,w={},S=y<0?t._lines()[_]:t._lines()[_][y],M={cal:"arrow",csl:"square"};for(i in S.commands){if(o=S.commands[i],M[i])i=M[i],a=0;else{if("c_"!==i.substr(0,2))continue;i=i.slice(2),a=1}for(w[i]=w[i]||{},h=(l=o.split(",")).length,r=0;r<h;++r)a?(x=(g=l[r].split(";")).shift(),w[i][x]=w[i][x]||{type:i,key:x},w[i][x].data=g):(x=l[r].slice(1),w[i][x]=w[i][x]||{type:i,key:x},w[i][x].color=l[r][0])}return w},t.clearMarkings=function(){var r,i=y<0?t._lines()[_]:t._lines()[_][y];for(r in i.commands)/^c[sa]l$|^c_/.test(r)&&delete i.commands[r]},t.pgn=function(i){var o,a=t.ids();return t.selectLineEnd(0),o=r.pgn(i),t.selectPosition(a.move,a.line),o},t.loadMoves=function(r,i){var o,a,l,h,g;if(i=i||{},"string"==typeof r&&(r=decodeTCN(r)),r){for(i.atCurrent||t.selectPosition(-1,0),l=_,a=r.length,o=0;o<a;++o){if(!((h=t.move(r[o],!0))||(r[o].promotion=!0===i.autoPromote?"q":i.autoPromote,h=t.move(r[o],!0))))return!1;_!==l&&"merge"!==i.method&&(t.promoteVariation(_,1),"promote"!==i.method&&(t._history()[y].lines=void 0,t.reorderLines()),l=_)}if("promote"===i.method){if(a){for(t._history()[y+1]&&(h=t._history()[y],t.createVariation(),t.move(h),swapMoveAttributes(t._history()[0],h),t.promoteVariation(_,1)),o=(g=t._lines()).length-1;o>=0;--o)1===g[o].length&&g[o][0].isContinuation&&(swapMoveAttributes(g[o][0],g[g[o].parentId][g[o].atMoveNode]),g[o].length=0);t.removeEmptyLines()}}else"merge"!==i.method&&t.deletePosition(y+1,_)}return!0})}function createGame(t){var r,o;if((t=t||{}).game)return t.game;if(r=i(),t.analysis&&extendChess(r),t.disableHashing&&r.hashing(!1),t.pgn){if(!(r.loadPgn(t.pgn,t.index,t.options)||"detect"===t.variant&&i.variants.some((function(i){return t.options=t.options||{},t.options.variant=i,r.loadPgn(t.pgn,t.index,t.options)}))))return!1}else{if(t.headers&&(t.variant=t.headers.Variant||t.variant,t.fen||(t.fen=t.headers.FEN)),"detect"===t.variant&&t.fen&&(t.fen.indexOf("|")>-1?t.variant="Bughouse":9===t.fen.split("/").length?t.variant="Crazyhouse":t.fen.indexOf("+")>-1?t.variant="3-check":t.variant=void 0),(t.fen||t.variant)&&!r.load(t.fen||a,t.variant))return!1;t.headers&&"object"==typeof t.headers&&!Array.isArray(t.headers)&&r.header(t.headers)}if(t.tcn)if("object"==typeof t.tcn){if(!function playBughouseTCN(t,r,i){var o,a,l,h=[decodeTCN(r[0]),decodeTCN(r[1])],g=[0,0],y=[0,0],_=h[0].length+h[1].length,x=Math.max(0|i[0][0],0|i[0][1],0|i[1][0],0|i[1][1]),w=[0,0],S=[0,0];for(o=[[x+=600-x%600,x],[x,x]];_--;){if(S[0]=w[0]+o[0][y[0]]-i[0][g[0]]||0,S[1]=w[1]+o[1][y[1]]-i[1][g[1]]||0,h[a=S[0]<=S[1]?0:1][g[a]]||(a^=1),(!(l=a?t.siblingGame:t).move(h[a][g[a]])||_&&l.inCheckmate()&&l.undo(!0))&&!(l=(a^=1)?t.siblingGame:t).move(h[a][g[a]]))return!1;l._history()[g[a]].time=i[a][g[a]],o[a][y[a]]=i[a][g[a]],w[a]=S[a],y[a]^=1,++g[a]}return!0}(r,t.tcn,t.timestamps||[[],[]]))return!1}else o=decodeTCN(t.tcn);else o=t.moves;return!(o&&!makeMoves(r,o,t,t.timestamps))&&r}function normalizeMoveObj(t){return t&&(t.piece&g&&(t.promoted=!0),t.piece=h[t.piece&l],t.captured&&(t.captured&g&&(t.capturedPromotedPawn=!0),t.captured=h[255&t.captured]),t.promotion&&(t.promotion=h[t.promotion&l]),void 0!==t.drop&&(t.drop="pnbrq"[t.drop])),t}function normalizeHistory(t){var r,i,o,a,l,h,g,y=t.history(!0,!0);if(t.siblingGame){for(r=t.siblingGame.history(!0,!0),o=y.length+r.length,i=[],a=0;a<o;++a)!y.length||r.length&&r[0].bughouseOrder<y[0].bughouseOrder?(l=r.shift()).board="b":(l=y.shift()).board="a",i.push(l);y=i}for(o=y.length,a=0;a<o;++a)if((h=y[a]).fen||normalizeMoveObj(h),h.lines)for(g=h.lines.length-1;g>=0;--g)t.selectLine(h.lines[g]),h.lines[g]=normalizeHistory(t).moves;return{moves:y}}function getLegalMoves(t,r){var i,a,l,h;if("string"==typeof t){if(!(a=o).load(t,r))return null}else a=createGame(t);for(h=(i=a.moves({verbose:!0})).length,l=0;l<h;++l)normalizeMoveObj(i[l]);return i}function jce(t,r){return(loadEngine=loadEngine||function loadEngine(t,r){})(t,r)}return jce.gameFingerprints=function gameFingerprints(t){var i,o,l,h,g,y,_,x,w,S=createGame(t),M=[""],T=[];if(!S)return!1;for(w=(x=S.header()).Variant||"",y=S.hashes(),i="function"==typeof S.origHistory?S.origHistory(!0):S.history(!0),g=y.length,o=[y[0][0],y[0][1]],T.push(r.to64BitHex(o)+w),y[0]=r.to64BitHex(y[0]),l=1;l<g;++l)o[0]=(o[0]^y[l][0]*(l+58465))>>>0,o[1]=(o[1]^y[l][1]*(l+984))>>>0,y[l]=r.to64BitHex(y[l]),T.push(r.to64BitHex(o)+w),normalizeMoveObj(i[h=l-1]),_=(i[h].from?i[h].from:i[h].drop.toUpperCase()+"@")+i[h].to+(i[h].promotion||""),h&&(_=M[h]+" "+_),M.push(_);return{startingFen:x.FEN||a,hashes:y,fingerprints:T,moves:M,variant:x.Variant}},jce.getFenFromMoves=function getFenFromMoves(t,r,i){return o.reset(),o.load(t,i),!(r&&!makeMoves(o,r))&&o.fen()},jce.getLegalMoves=getLegalMoves,jce.getPositionInfo=function getPositionInfo(t,r,i){var a,l,h={gameOver:!1,check:!1,checkmate:!1,draw:!1,stalemate:!1,threefold:!1,insufficient:!1};if(Array.isArray(r)||(i=r,r=null),"boolean"==typeof i?(a=i,i={}):a=(i=i||{}).variant,"string"==typeof t){if(0!==(l=o).validateFen(t,a)||!l.load(t,a))return!1}else l=createGame(t);return!(r&&!makeMoves(l,r))&&(i.getLegalMoves&&(h.legalMoves=getLegalMoves({game:l})),l.inCheck()?(h.check=!0,h.checkmate=l.inCheckmate()):h.stalemate=l.inStalemate(),h.threefold=l.inThreefoldRepetition(),h.insufficient=l.insufficientMaterial(i.color),h.fiftyMoveRule=l.in50MoveRule(),h.draw=h.stalemate||h.threefold||h.insufficient||h.fiftyMoveRule||l.inDraw(),i.skipValidation||(h.isValid=l.isPositionValid(i)),a&&(h.variantWin=l.isVariantWin(),void 0===h.variantWin&&(h.variantWin=l.isBughouseWin())),h.gameOver=h.checkmate||h.draw||Boolean(h.variantWin),h)},jce.isFenValid=function isFenValid(t,r){return 0===o.validateFen(t,r)},jce.encodeTCN=function encodeTCN(t){var r,i,o,a,l="";for(Array.isArray(t)||(t=[t]),i=t.length,r=0;r<i;r+=1)o=t[r].drop?79+_.indexOf(t[r].drop):y.indexOf(t[r].from[0])+8*(t[r].from[1]-1),a=y.indexOf(t[r].to[0])+8*(t[r].to[1]-1),t[r].promotion&&(a=3*_.indexOf(t[r].promotion)+64+(a<o?9+a-o:a-o-7)),l+=y[o]+y[a];return l},jce.decodeTCN=decodeTCN,jce.uciToObj=uciToObj,jce.generatePgn=function generatePgn(t){var r;return(t=t||{}).disableHashing=!0,!!(r=createGame(t))&&r.pgn(t)},jce.pgnToFen=function pgnToFen(t,r){var i,a,l=[];if(o.reset(),!o.loadPgn(t))return!1;if(i=o.moveCount(),"number"==typeof r){for(r<0&&(r=i+r+1),a=i-1;a>=r&&a>=0;a-=1)o.undo();return o.fen()}for(a=0;a<=i;a+=1)l.unshift(o.fen()),o.undo();return l},jce.pgnToJson=function pgnToJson(t,r,i){var a,l=[],h=o;return"number"!=typeof r&&(i=r,r=void 0),a=h.tokenizePgn(t,i),r<0&&(r=a.length+r),!!a&&(i&&i.includeFen&&(h=createGame({analysis:!0})),a.forEach((function(t,o){var a,g;o===r||void 0===r?h.loadPgn([t],0,i)?(g=normalizeHistory(h),a=h.header(),l.push({headers:a,moves:g.moves})):l.push(!1):l.push(void 0)})),"number"==typeof r?l[r]:l)},jce.sanToObj=function sanToObj(t,r,i){return o.reset(),!!o.load(r,i)&&normalizeMoveObj(o.move(t))},jce.completeFen=o.completeFen,jce.shortenFen=function shortenFen(t,r){return o.completeFen(t).split(" ").slice(0,r||4).join(" ")},jce.createGame=createGame,jce.getPositionDetails=function getPositionDetails(t,r){var i,o,a,l;if((t=t||{}).disableHashing=!0,!(i=createGame(t)))return null;if(r){if(!(a=i.move(r)))return null;i.extended||normalizeMoveObj(a)}return l=i.fen(),t.skipValidation||i.isPositionValid(t)?(o=l.split(" "),{fen:l,pieces:getPieces(i),sideToMove:i.turn(),castling:o[2],epSquare:"-"===o[3]?null:o[3],halfMoves:+o[4],moveNumber:+o[5],move:a,hand:i.hand(),checks:i.checks()}):null},jce.predict=function predict(t,r){var i=Math.min(Math.max(.20773843*Math.atan(2.49085889*t/100-2.47841945*r/100)+.02262979*t/100-.02256839*r/100+.52239679,0),1),o=Math.min(Math.max(-.20720905*Math.atan(2.49626837*t/100-2.48220286*r/100)+-.02352551*t/100+.02172627*r/100+.49443923,0),1),a=Math.min(Math.max(Math.exp(.037043456*t/100+.178106427*r/100-8.069742932)+.004823544*Math.exp(-1.364136591*Math.pow(t/100-r/100,2))+-.001625539,0),1),l=i+o+a;return{w:i/l,b:o/l,d:a/l}},jce.normalizeMoveObj=normalizeMoveObj,jce.FLAGS=o.FLAGS,jce.loadECO=function loadECO(t,i){r.loadBook(t,(function onload(t,o){if(!o||!o.json)return i(t||new Error("Invalid book"));i(t,(function queryECO(t){var i,a,l,h,g,y,_,x,w;if(t.hash)a="string"==typeof t.hash?[r.hex64ToDec(t.hash)]:[t.hash],h=1;else{if(!(i=createGame(t)))return!1;h=(a=i.hashes()).length}for(l=0;l<h;++l)if(g=o.json[r.to64BitHex(a[l])]){if(g.constructor===Array)if(y&&-1===g[0].m.indexOf(y.m)){for(x=g.length-1;x>=0;--x)if(!x||-1!==g[x].m.indexOf(y.m)){(w=g[x]).e=g[0].e,w.s=g[0].s,w.mate=g[0].mate,w.v=g[0].v,w.h=g[0].h,w.n=w.n||g[0].n,w.u=w.u||g[0].u,w.c=w.c||g[0].c;break}}else w=g[0];else w=g;(w.n||t.allowNameless)&&(y=w)}else t.mustEndInBook&&(y=void 0);if(y)return _={name:y.n},y.m&&(_.moves=y.m),void 0!==y.d&&(_.sdiff=y.d/100),y.c&&(_.code=y.c,_.url=y.u||y.n.replace(/[\u00e1-\u00e5]/g,"a").replace(/[\u0107\u010d]/g,"c").replace(/[\u00e9\u00e8\u0117\u0113]/g,"e").replace(/[\u00f3\u00f6\u00f8]/g,"o").replace(/[\u016f\u00fc]/g,"u").replace(/['+,]/g,"").replace(/[^a-z0-9.]+/gi,"-").replace(/(with-\d|St)\.+-?/,"$1-")),y.e?(_.eval=y.e,_.depth=y.h,_.score=y.e[0].cp/100,void 0!==y.e[0].mate&&(_.mate=y.e[0].mate)):(_.score=y.s/100,void 0!==y.mate&&(_.mate=y.mate)),y.v&&(_.bad=!0),_}),o.json)}))},jce}();t.exports=o}()},function(t,r,i){"use strict";i.d(r,"a",(function(){return addPiece})),i.d(r,"b",(function(){return changePiecesStyle})),i.d(r,"c",(function(){return dragPiece})),i.d(r,"d",(function(){return dropPiece})),i.d(r,"e",(function(){return findPieceFromFileRank})),i.d(r,"f",(function(){return findPieceFromPosition})),i.d(r,"g",(function(){return findPieceFromSquare})),i.d(r,"h",(function(){return generatePieceId})),i.d(r,"i",(function(){return getPieces})),i.d(r,"j",(function(){return loadPieces})),i.d(r,"k",(function(){return makeMove})),i.d(r,"l",(function(){return movePieces})),i.d(r,"m",(function(){return removePiece})),i.d(r,"n",(function(){return swapPiece})),i.d(r,"o",(function(){return undoMove})),i.d(r,"p",(function(){return updatePiecesVisuals}));var o=i(15);function addPiece(t,r){var i=t.state,a=t.methods,l={id:generatePieceId(t),info:r,obj:a.createPieceObj(i,r)},h=Object(o.e)(t,r.square);return i.assetsLoaded&&a.updatePieceVisuals(i,l),a.setPiecePosition(l,h),a.addPiece(i,l),i.pieces[r.square]=l,l}function changePiecesStyle(t,r){var i=t.state,o=t.methods;i.pieceStyle!==r&&(i.pieceStyle=r,o.updatePiecesStyle(i).then((function(){i.assetsLoaded&&updatePiecesVisuals(t)})))}var a=i(13);function dragPiece(t,r){var i,l=t.state,h=t.methods,g=t.animationMethods,y=null;if(r.toSquare?y=Object(o.e)(t,r.toSquare):r.coords&&(y=h.getBoardPosition(l,r.coords)),y){var _=findPieceFromSquare(l,r.square);_&&(Object(a.e)(l,{piece:_,type:"Drag"})||Object(a.c)(l,_),h.setPiecePosition(_,y),!l.selectedPiece&&g.dragPiece&&Object(a.a)(t,{animation:g.dragPiece(l,_),type:"Drag",piece:_}),l.selectedPiece=_,null===(i=h.onPieceDrag)||void 0===i||i.call(h,l,_))}}function dropPiece(t,r){var i,l=t.state,h=t.methods,g=t.animationMethods,y=l.selectedPiece;if(y){Object(a.c)(l,y);var _=Object(o.e)(t,r);g.dropPiece&&r===y.info.square&&Object(a.a)(t,{animation:g.dropPiece(l,{piece:y,to:_}),type:"Drop",piece:y,onEnd:function onEnd(r){!r.forcedEnd&&g.attackKing&&l.attackedKing&&!Object(a.e)(l,{piece:l.attackedKing,type:"KingAttack"})&&Object(a.a)(t,{animation:g.attackKing(l,l.attackedKing),type:"KingAttack",piece:l.attackedKing})}}),h.setPiecePosition(y,_),null===(i=h.onPieceDrop)||void 0===i||i.call(h,l,y),l.selectedPiece=null}}var l=i(24);function findPieceFromFileRank(t,r){var i=Object(l.a)(r);return i?findPieceFromSquare(t,i):null}function findPieceFromPosition(t,r){var i=t.state;return findPieceFromFileRank(i,t.methods.positionToFileRank(i,r))}function findPieceFromSquare(t,r){return Object.values(t.pieces).find((function(t){return t.info.square===r}))||null}function generatePieceId(t){return++t.lastPieceId}function getPieces(t){var r=t.state;return Object.keys(r.pieces).reduce((function(t,i){return t[i]={color:r.pieces[i].info.color,type:r.pieces[i].info.type},t}),{})}function loadPieces(t,r){var i,o=r.piecesInfo,l=r.reloadAll,h=t.state,g=t.methods;Object(a.b)(h),l?Object.values(h.pieces).forEach((function(r){removePiece(t,{square:r.info.square})})):Object.values(h.pieces).forEach((function(r){var i=r.info,a=i.square,l=o.isDefined(a)?o.get(a):null;l&&i.type===l.type&&i.color===l.color||removePiece(t,{square:a})})),o.keys().filter((function(t){return!h.pieces[t]})).forEach((function(r){var i=o.get(r);addPiece(t,i)})),null===(i=g.onPiecesLoaded)||void 0===i||i.call(g,h)}function makeMove(t,r){var i=r.move,o=r.attackedKingSquare,l=t.state,h=l.pieces;(Object(a.b)(l),i.drop)?addPiece(t,{color:i.color,square:i.kingTo||i.to,type:i.drop}):(l.attackedKing=o?h[o]:null,i.EPCapturedSquare?removePiece(t,{captured:!0,square:i.EPCapturedSquare}):i.captured&&removePiece(t,{captured:!0,square:i.to}),movePieces(t,[i,i.rookMove].filter(Boolean)),i.promotion&&swapPiece(t,{piece:h[i.to],type:i.promotion}))}var h=i(64),g=i(47);function movePieces(t,r){var i=t.state,l=t.methods,y=t.animationMethods,_=i.attackedKing,x=i.pieces,w=i.pointer,S=Object(g.a)(r[0]),M=Object(h.a)(r[0]),T={};r.forEach((function(r){var h,g=r.kingTo||r.to,P=x[r.from],C=Object(o.e)(t,r.from),A=Object(o.e)(t,g),O=null,L="Move";r.userGeneratedDrop&&y.dropPiece?(l.setPiecePosition(P,w.boardPosition),O=y.dropPiece(i,{capturing:M,piece:P,to:A}),L="Drop"):!r.userGeneratedDrop&&r.animate&&r.from!==g&&(O=y.movePiece(i,{capturing:M,castling:S,from:C,piece:P,to:A})),O?Object(a.a)(t,{animation:O,type:L,piece:P,onEnd:function onEnd(o){var h,g=o.forcedEnd;null===(h=l.onPieceMoved)||void 0===h||h.call(l,i,P),!g&&y.attackKing&&r.san&&_&&!Object(a.e)(i,{piece:_,type:"KingAttack"})&&Object(a.a)(t,{animation:y.attackKing(i,_),type:"KingAttack",piece:_})}}):(l.setPiecePosition(P,A),null===(h=l.onPieceMoved)||void 0===h||h.call(l,i,P)),!_&&Object(a.e)(i,{type:"KingAttack"})&&Object(a.b)(i,"KingAttack"),r.from!==g&&(P.info.square=g,T[r.from]=P)})),Object.keys(T).forEach((function(t){var r=T[t],i=x[t];x[r.info.square]=r,r.info.type===i.info.type&&r.info.color===i.info.color&&delete x[t]}))}function removePiece(t,r){var i=r.captured,o=r.square,l=t.state,h=t.methods,g=t.animationMethods,y=l.pieces,_=l.pieces[o];if(_){if(Object(a.c)(l,_),i&&g.capturePiece){var x=Object(a.e)(l,{type:"Drop"});Object(a.a)(t,{animation:g.capturePiece(l,{fromDrop:x,piece:_}),type:"Capture",piece:_,onEnd:function onEnd(){return h.removePiece(l,_)}})}else h.removePiece(l,_);delete y[o],l.selectedPiece===_&&(l.selectedPiece=null)}}function swapPiece(t,r){var i=r.piece,o=r.type,a=t.state,l=t.methods;o&&(i.info.type=o),l.updatePieceVisuals(a,i)}var y=i(2),_=i(66);function undoMove(t,r){var i=r.move,o=r.attackedKingSquare,l=t.state,h=t.animationMethods,g=l.pieces,x=Object(_.a)(i),w=x.movedPieces,S=x.restoredPiece,M=x.promotedSquare;if(Object(a.b)(l),i.drop)removePiece(t,{square:i.to});else{if(l.attackedKing=o?g[o]:null,movePieces(t,w),S){var T=addPiece(t,S);h.restorePiece&&Object(a.a)(t,{animation:h.restorePiece(l,T),type:"Restore",piece:T})}if(M)swapPiece(t,{piece:g[M],type:y.a.Piece.Types.Pawn})}}function updatePiecesVisuals(t){var r,i=t.state,o=t.methods;Object.values(i.pieces).forEach((function(t){o.updatePieceVisuals(i,t)})),null===(r=o.onPiecesVisualsChanged)||void 0===r||r.call(o,i)}},function(t,r,i){t.exports=i(95)},function(t,r,i){"use strict";function getSanFromFileRank(t){return!t||!t.file||!t.rank||t.file>8||t.rank>8||t.file<1||t.rank<1?null:"".concat(String.fromCharCode(96+t.file)).concat(t.rank.toString())}i.d(r,"a",(function(){return getSanFromFileRank}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getColorAsLetter}));var o=i(2);function getColorAsLetter(t){return t===o.a.ColorsAsNumbers.Black?o.a.ColorsAsLetters.Black:o.a.ColorsAsLetters.White}},function(t,r,i){"use strict";i.d(r,"a",(function(){return getBoardXYFromEvent}));var o=i(68);function getBoardXYFromEvent(t,r){var i=r.getBoundingClientRect(),a=Object(o.a)(t),l=a.x,h=a.y;return{boardRect:i,x:l-i.left,y:h-i.top}}},function(t,r,i){"use strict";i.d(r,"a",(function(){return getWebglAssetUrl}));var o=i(39);function getWebglAssetUrl(t){return window[o.a.webglAssetPaths]&&window[o.a.webglAssetPaths][t]?window[o.a.webglAssetPaths][t]:"".concat(o.a.webglDataUrl,"/").concat(t)}},function(t,r,i){"use strict";i.d(r,"a",(function(){return isRightButton}));var o=i(67);function isRightButton(t){return!Object(o.a)(t)&&3===t.which}},function(t,r,i){"use strict";function limitNumberWithinRange(t,r){return Math.min(Math.max(t,r.min),r.max)}i.d(r,"a",(function(){return limitNumberWithinRange}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getOppositeColor}));var o=i(2);function getOppositeColor(t){return t===o.a.ColorsAsNumbers.Black?o.a.ColorsAsNumbers.White:o.a.ColorsAsNumbers.Black}},function(t,r,i){"use strict";i.d(r,"a",(function(){return getColorAsWord}));var o=i(2);function getColorAsWord(t){return t===o.a.ColorsAsNumbers.Black?o.a.ColorsAsWords.Black:o.a.ColorsAsWords.White}},function(t,r,i){"use strict";i.d(r,"a",(function(){return setPositionBySquare}));var o=i(14);function setPositionBySquare(t){var r=t.square,i=t.el,a=Object(o.a)(r);a&&(i.className=function removeClassNamesStartingWith(t,r){return t.split(" ").filter((function(t){return!t.startsWith(r)})).join(" ").trim()}(i.className,"square-"),i.classList.add("square-".concat(a.file).concat(a.rank)),i.style.transform="")}},function(t,r,i){"use strict";function addAnalysisOverlay(t){var r=t.state;t.methods.addAnalysisOverlay(r)}function changeBoardStyle(t,r){var i=t.state,o=t.methods,a=i.options,l=a.coordinates,h=a.flipped;i.boardStyle!==r&&(i.boardStyle=r,o.updateBoardStyle(i),o.updateBoardCoordinates(i,{colorUpdate:!0,flipped:h,position:l}))}function fadeSetup(t,r){var i=t.state,o=t.methods,a=i.animator;i.fadeSetupAnimation&&a.end(i.fadeSetupAnimation),0!==r&&(i.fadeSetupAnimation=o.fadeInAllPieces(i,r),i.fadeSetupAnimation.onEnd((function(){return i.fadeSetupAnimation=null})))}function flipBoard(t,r){var i=t.state,o=t.methods;i.isBoardFlipped!==r&&(i.isBoardFlipped=r,o.flipBoard(i,r))}function getDarkSquareColor(t){var r;return(null===(r=t.boardThemes[t.boardStyle])||void 0===r?void 0:r[0])||"#000000"}function getLightSquareColor(t){var r;return(null===(r=t.boardThemes[t.boardStyle])||void 0===r?void 0:r[1])||"#ffffff"}function setBoardCoordinates(t,r){var i=r.position,o=r.flipped,a=t.state;t.methods.updateBoardCoordinates(a,{flipped:o,position:i})}function removeAnalysisOverlay(t){var r=t.state;t.methods.removeAnalysisOverlay(r)}function resize(t){var r=t.state,i=t.methods,o=r.containerEl.getBoundingClientRect(),a=o.width,l=o.height;r.viewSize.width=a||300,r.viewSize.height=l||300,i.updateViewSize(r,r.viewSize)}i.d(r,"a",(function(){return addAnalysisOverlay})),i.d(r,"b",(function(){return changeBoardStyle})),i.d(r,"c",(function(){return fadeSetup})),i.d(r,"d",(function(){return flipBoard})),i.d(r,"e",(function(){return getDarkSquareColor})),i.d(r,"f",(function(){return getLightSquareColor})),i.d(r,"i",(function(){return setBoardCoordinates})),i.d(r,"g",(function(){return removeAnalysisOverlay})),i.d(r,"h",(function(){return resize}))},function(t,r,i){"use strict";function isPositionInsideBoard(t,r){var i=t.squareSize;return r.x>=0&&r.x<=8*i&&r.y>=0&&r.y<=8*i}i.d(r,"a",(function(){return isPositionInsideBoard}))},function(t,r,i){"use strict";function calculateArrowLength(t){var r=t.from,i=t.to;return Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2))}i.d(r,"a",(function(){return calculateArrowLength}))},function(t,r){function asyncGeneratorStep(t,r,i,o,a,l,h){try{var g=t[l](h),y=g.value}catch(_){return void i(_)}g.done?r(y):Promise.resolve(y).then(o,a)}t.exports=function _asyncToGenerator(t){return function(){var r=this,i=arguments;return new Promise((function(o,a){var l=t.apply(r,i);function _next(t){asyncGeneratorStep(l,o,a,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(l,o,a,_next,_throw,"throw",t)}_next(void 0)}))}}},function(t,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function defineProperties(t,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,r,i){return r&&defineProperties(t.prototype,r),i&&defineProperties(t,i),t}}();function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var a=function(){function MiniSignalBinding(t,r,i){void 0===r&&(r=!1),_classCallCheck(this,MiniSignalBinding),this._fn=t,this._once=r,this._thisArg=i,this._next=this._prev=this._owner=null}return o(MiniSignalBinding,[{key:"detach",value:function detach(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),MiniSignalBinding}();function _addMiniSignalBinding(t,r){return t._head?(t._tail._next=r,r._prev=t._tail,t._tail=r):(t._head=r,t._tail=r),r._owner=t,r}var l=function(){function MiniSignal(){_classCallCheck(this,MiniSignal),this._head=this._tail=void 0}return o(MiniSignal,[{key:"handlers",value:function handlers(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],r=this._head;if(t)return!!r;for(var i=[];r;)i.push(r),r=r._next;return i}},{key:"has",value:function has(t){if(!(t instanceof a))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function dispatch(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function add(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return _addMiniSignalBinding(this,new a(t,!1,r))}},{key:"once",value:function once(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return _addMiniSignalBinding(this,new a(t,!0,r))}},{key:"detach",value:function detach(t){if(!(t instanceof a))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this||(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null),this}},{key:"detachAll",value:function detachAll(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),MiniSignal}();l.MiniSignalBinding=a,r.default=l,t.exports=r.default},function(t,r){function _getPrototypeOf(r){return t.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(r)}t.exports=_getPrototypeOf},function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o={enPassant:"https://www.chess.com/article/view/how-to-capture-en-passant",soundsDefault:"https://www.chess.com/bundles/web/sounds",soundsTheme:"https://images.chesscomfiles.com/chess-themes/sounds/",webglAssetPaths:"__CHESSCOM_WEBGL_ASSET_PATHS__",webglDataUrl:"https://betacssjs.chesscomfiles.com/bundles/web/images/webgl_data",webglDataUrlDev:"static/webgl_data"}},function(t,r,i){"use strict";function makeSvgIcon(t){var r=t.className,i=void 0===r?"":r,o=t.path,a=void 0===o?"":o,l=t.size,h=void 0===l?"24":l,g=t.viewBox,y=void 0===g?"0 0 18 19":g;return'\n    <svg xmlns="http://www.w3.org/2000/svg" class="'.concat(i,'" width="').concat(h,'" height="').concat(h,'" viewBox="').concat(y,'">\n      ').concat(a,"\n    </svg>\n  ")}i.d(r,"a",(function(){return makeSvgIcon}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getPieceBaseURL}));var o=i(65);function getPieceBaseURL(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150;return"".concat(Object(o.a)(),"/chess-themes/pieces/").concat(t,"/").concat(r)}},function(t,r,i){"use strict";i.d(r,"a",(function(){return J}));var o,a=i(1),l=i.n(a),h=i(2);!function(t){!function(t){t.Background="icon-background",t.Component="icon-component",t.ComponentShadow="icon-component-shadow",t.Shadow="icon-shadow"}(t.ClassNames||(t.ClassNames={}))}(o||(o={}));var g,y='<g id="alternative">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96af8b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g>\n      <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n        <path d="M14.57,4.71l-4.42.2a.2.2,0,0,0-.11,0A.16.16,0,0,0,10,5a.21.21,0,0,0,0,.11.31.31,0,0,0,0,.1l1.4,1.4L8.92,9.13,6.5,6.71,8,5.24a.19.19,0,0,0,0-.1A.14.14,0,0,0,8,5,.15.15,0,0,0,8,4.94a.21.21,0,0,0-.11,0L3.42,4.71l-.08,0-.06,0a.18.18,0,0,0,0,.07.19.19,0,0,0,0,.08l.19,4.42a.15.15,0,0,0,0,.11.18.18,0,0,0,.08.07.25.25,0,0,0,.12,0,.18.18,0,0,0,.09-.06L5.21,8l2.55,2.56v4.49a.29.29,0,0,0,0,.09l0,.07.08,0,.09,0H9.85l.09,0a.18.18,0,0,0,.07,0l.05-.07a.29.29,0,0,0,0-.09V10.57l2.63-2.63,1.55,1.54a.16.16,0,0,0,.09,0,.17.17,0,0,0,.12,0,.18.18,0,0,0,.08-.07.13.13,0,0,0,0-.1l.19-4.43a.19.19,0,0,0,0-.08.18.18,0,0,0,0-.07l-.07,0Z"></path>\n      </g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M14.57,4.21l-4.42.2a.2.2,0,0,0-.11,0,.16.16,0,0,0-.07.09.21.21,0,0,0,0,.11.31.31,0,0,0,0,.1l1.4,1.4L8.92,8.63,6.5,6.21,8,4.74a.19.19,0,0,0,0-.1.14.14,0,0,0,0-.11A.15.15,0,0,0,8,4.44a.21.21,0,0,0-.11,0L3.42,4.21l-.08,0-.06,0a.18.18,0,0,0,0,.07.19.19,0,0,0,0,.08l.19,4.42a.15.15,0,0,0,0,.11A.18.18,0,0,0,3.53,9a.25.25,0,0,0,.12,0A.18.18,0,0,0,3.74,9L5.21,7.51l2.55,2.56v4.49a.29.29,0,0,0,0,.09l0,.07.08,0,.09,0H9.85l.09,0a.18.18,0,0,0,.07,0l.05-.07a.29.29,0,0,0,0-.09V10.07l2.63-2.63L14.26,9a.16.16,0,0,0,.09,0,.17.17,0,0,0,.12,0A.18.18,0,0,0,14.55,9a.13.13,0,0,0,0-.1l.19-4.43a.19.19,0,0,0,0-.08.18.18,0,0,0,0-.07l-.07,0Z"></path>\n    </g>\n  </g>'),_='<g id="best">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#96bc4b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2" d="M9,3.43a.5.5,0,0,0-.27.08.46.46,0,0,0-.17.22L7.24,7.17l-3.68.19a.52.52,0,0,0-.26.1.53.53,0,0,0-.16.23.45.45,0,0,0,0,.28.44.44,0,0,0,.15.23l2.86,2.32-1,3.56a.45.45,0,0,0,0,.28.46.46,0,0,0,.17.22.41.41,0,0,0,.26.09.43.43,0,0,0,.27-.08l3.09-2,3.09,2a.46.46,0,0,0,.53,0,.46.46,0,0,0,.17-.22.53.53,0,0,0,0-.28l-1-3.56L14.71,8.2A.44.44,0,0,0,14.86,8a.45.45,0,0,0,0-.28.53.53,0,0,0-.16-.23.52.52,0,0,0-.26-.1l-3.68-.2L9.44,3.73a.46.46,0,0,0-.17-.22A.5.5,0,0,0,9,3.43Z"></path>\n    <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M9,2.93A.5.5,0,0,0,8.73,3a.46.46,0,0,0-.17.22L7.24,6.67l-3.68.19A.52.52,0,0,0,3.3,7a.53.53,0,0,0-.16.23.45.45,0,0,0,0,.28.44.44,0,0,0,.15.23L6.15,10l-1,3.56a.45.45,0,0,0,0,.28.46.46,0,0,0,.17.22.41.41,0,0,0,.26.09.43.43,0,0,0,.27-.08l3.09-2,3.09,2a.46.46,0,0,0,.53,0,.46.46,0,0,0,.17-.22.53.53,0,0,0,0-.28l-1-3.56L14.71,7.7a.44.44,0,0,0,.15-.23.45.45,0,0,0,0-.28A.53.53,0,0,0,14.7,7a.52.52,0,0,0-.26-.1l-3.68-.2L9.44,3.23A.46.46,0,0,0,9.27,3,.5.5,0,0,0,9,2.93Z"></path>\n  </g>'),x='<g id="blunder">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ca3431" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M14.74,5.45A2.58,2.58,0,0,0,14,4.54,3.76,3.76,0,0,0,12.89,4a4.07,4.07,0,0,0-1.2-.19A3.92,3.92,0,0,0,10.51,4a5.87,5.87,0,0,0-.9.37,3,3,0,0,0-.32.2,3.46,3.46,0,0,1,.42.63,3.29,3.29,0,0,1,.36,1.47.31.31,0,0,0,.19-.06l.11-.08a2.9,2.9,0,0,1,.29-.19,3.89,3.89,0,0,1,.41-.17,1.55,1.55,0,0,1,.48-.07,1.1,1.1,0,0,1,.72.24.72.72,0,0,1,.23.26.8.8,0,0,1,.07.34,1,1,0,0,1-.25.67,7.71,7.71,0,0,1-.65.63,6.2,6.2,0,0,0-.48.43,2.93,2.93,0,0,0-.45.54,2.55,2.55,0,0,0-.33.66,2.62,2.62,0,0,0-.13.83V11a.24.24,0,0,0,0,.12.35.35,0,0,0,.17.17l.12,0h1.71l.12,0a.23.23,0,0,0,.1-.07.21.21,0,0,0,.06-.1.27.27,0,0,0,0-.12V10.8a1,1,0,0,1,.26-.7q.27-.28.66-.63A5.79,5.79,0,0,0,14.05,9a4.51,4.51,0,0,0,.48-.6,2.56,2.56,0,0,0,.36-.72,2.81,2.81,0,0,0,.14-1A2.66,2.66,0,0,0,14.74,5.45Z"></path>\n      <path d="M12.38,12.65H10.5l-.12,0a.34.34,0,0,0-.18.29v1.82a.36.36,0,0,0,.08.23.23.23,0,0,0,.1.07l.12,0h1.88a.24.24,0,0,0,.12,0,.26.26,0,0,0,.11-.07.36.36,0,0,0,.07-.1.28.28,0,0,0,0-.13V13a.27.27,0,0,0,0-.12.61.61,0,0,0-.07-.1A.32.32,0,0,0,12.38,12.65Z"></path>\n      <path d="M6.79,12.65H4.91l-.12,0a.34.34,0,0,0-.18.29v1.82a.36.36,0,0,0,.08.23.23.23,0,0,0,.1.07l.12,0H6.79a.24.24,0,0,0,.12,0A.26.26,0,0,0,7,15a.36.36,0,0,0,.07-.1.28.28,0,0,0,0-.13V13a.27.27,0,0,0,0-.12.61.61,0,0,0-.07-.1A.32.32,0,0,0,6.79,12.65Z"></path>\n      <path d="M8.39,4.54A3.76,3.76,0,0,0,7.3,4a4.07,4.07,0,0,0-1.2-.19A3.92,3.92,0,0,0,4.92,4a5.87,5.87,0,0,0-.9.37,3.37,3.37,0,0,0-.55.38l-.21.19a.32.32,0,0,0,0,.41l1,1.2a.26.26,0,0,0,.2.12.48.48,0,0,0,.24-.06l.11-.08a2.9,2.9,0,0,1,.29-.19l.4-.17A1.66,1.66,0,0,1,6,6.06a1.1,1.1,0,0,1,.72.24.72.72,0,0,1,.23.26A.77.77,0,0,1,7,6.9a1,1,0,0,1-.26.67,7.6,7.6,0,0,1-.64.63,6.28,6.28,0,0,0-.49.43,2.93,2.93,0,0,0-.45.54,2.72,2.72,0,0,0-.33.66,2.62,2.62,0,0,0-.13.83V11a.43.43,0,0,0,0,.12.39.39,0,0,0,.08.1.18.18,0,0,0,.1.07.21.21,0,0,0,.12,0H6.72l.12,0a.23.23,0,0,0,.1-.07.36.36,0,0,0,.07-.1A.5.5,0,0,0,7,11V10.8a1,1,0,0,1,.27-.7A8,8,0,0,1,8,9.47c.18-.15.35-.31.52-.48A7,7,0,0,0,9,8.39a3.23,3.23,0,0,0,.36-.72,3.07,3.07,0,0,0,.13-1,2.66,2.66,0,0,0-.29-1.27A2.58,2.58,0,0,0,8.39,4.54Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M14.74,5A2.58,2.58,0,0,0,14,4a3.76,3.76,0,0,0-1.09-.56,4.07,4.07,0,0,0-1.2-.19,3.92,3.92,0,0,0-1.18.17,5.87,5.87,0,0,0-.9.37,3,3,0,0,0-.32.2,3.46,3.46,0,0,1,.42.63,3.29,3.29,0,0,1,.36,1.47.31.31,0,0,0,.19-.06L10.37,6a2.9,2.9,0,0,1,.29-.19,3.89,3.89,0,0,1,.41-.17,1.55,1.55,0,0,1,.48-.07,1.1,1.1,0,0,1,.72.24.72.72,0,0,1,.23.26.8.8,0,0,1,.07.34,1,1,0,0,1-.25.67,7.71,7.71,0,0,1-.65.63,6.2,6.2,0,0,0-.48.43,2.93,2.93,0,0,0-.45.54,2.55,2.55,0,0,0-.33.66,2.62,2.62,0,0,0-.13.83v.35a.24.24,0,0,0,0,.12.35.35,0,0,0,.17.17l.12,0h1.71l.12,0a.23.23,0,0,0,.1-.07.21.21,0,0,0,.06-.1.27.27,0,0,0,0-.12V10.3a1,1,0,0,1,.26-.7q.27-.28.66-.63a5.79,5.79,0,0,0,.51-.48,4.51,4.51,0,0,0,.48-.6,2.56,2.56,0,0,0,.36-.72,2.81,2.81,0,0,0,.14-1A2.66,2.66,0,0,0,14.74,5Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M12.38,12.15H10.5l-.12,0a.34.34,0,0,0-.18.29v1.82a.36.36,0,0,0,.08.23.23.23,0,0,0,.1.07l.12,0h1.88a.24.24,0,0,0,.12,0,.26.26,0,0,0,.11-.07.36.36,0,0,0,.07-.1.28.28,0,0,0,0-.13V12.46a.27.27,0,0,0,0-.12.61.61,0,0,0-.07-.1A.32.32,0,0,0,12.38,12.15Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M6.79,12.15H4.91l-.12,0a.34.34,0,0,0-.18.29v1.82a.36.36,0,0,0,.08.23.23.23,0,0,0,.1.07l.12,0H6.79a.24.24,0,0,0,.12,0A.26.26,0,0,0,7,14.51a.36.36,0,0,0,.07-.1.28.28,0,0,0,0-.13V12.46a.27.27,0,0,0,0-.12.61.61,0,0,0-.07-.1A.32.32,0,0,0,6.79,12.15Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M8.39,4A3.76,3.76,0,0,0,7.3,3.48a4.07,4.07,0,0,0-1.2-.19,3.92,3.92,0,0,0-1.18.17,5.87,5.87,0,0,0-.9.37,3.37,3.37,0,0,0-.55.38l-.21.19a.32.32,0,0,0,0,.41l1,1.2a.26.26,0,0,0,.2.12.48.48,0,0,0,.24-.06L4.78,6a2.9,2.9,0,0,1,.29-.19l.4-.17A1.66,1.66,0,0,1,6,5.56a1.1,1.1,0,0,1,.72.24.72.72,0,0,1,.23.26A.77.77,0,0,1,7,6.4a1,1,0,0,1-.26.67,7.6,7.6,0,0,1-.64.63,6.28,6.28,0,0,0-.49.43,2.93,2.93,0,0,0-.45.54,2.72,2.72,0,0,0-.33.66,2.62,2.62,0,0,0-.13.83v.35a.43.43,0,0,0,0,.12.39.39,0,0,0,.08.1.18.18,0,0,0,.1.07.21.21,0,0,0,.12,0H6.72l.12,0a.23.23,0,0,0,.1-.07.36.36,0,0,0,.07-.1.5.5,0,0,0,0-.12V10.3a1,1,0,0,1,.27-.7A8,8,0,0,1,8,9c.18-.15.35-.31.52-.48A7,7,0,0,0,9,7.89a3.23,3.23,0,0,0,.36-.72,3.07,3.07,0,0,0,.13-1A2.66,2.66,0,0,0,9.15,5,2.58,2.58,0,0,0,8.39,4Z"></path>\n    </g>\n  </g>'),w='<g id="book">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#a88865" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.3" isolation="isolate" d="M8.45,5.9c-1-.75-2.51-1.09-4.83-1.09H2.54v8.71H3.62a8.16,8.16,0,0,1,4.83,1.17Z"></path>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.3" isolation="isolate" d="M9.54,14.69a8.14,8.14,0,0,1,4.84-1.17h1.08V4.81H14.38c-2.31,0-3.81.34-4.84,1.09Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M8.45,5.4c-1-.75-2.51-1.09-4.83-1.09H3V13h.58a8.09,8.09,0,0,1,4.83,1.17Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M9.54,14.19A8.14,8.14,0,0,1,14.38,13H15V4.31h-.58c-2.31,0-3.81.34-4.84,1.09Z"></path>\n    </g>\n  </g>'),S='<g id="Brilliant">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#1bada6" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M12.57,14.6a.51.51,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0h-2l-.13,0L10,14.84A.41.41,0,0,1,10,14.6V12.7a.32.32,0,0,1,.09-.23.39.39,0,0,1,.1-.08l.13,0h2a.31.31,0,0,1,.24.1.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13Zm-.12-3.93a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H10.35a.31.31,0,0,1-.34-.31L9.86,3.9A.36.36,0,0,1,10,3.66a.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0H12.3a.32.32,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n      <path d="M8.07,14.6a.51.51,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0h-2l-.13,0-.11-.08a.41.41,0,0,1-.08-.24V12.7a.27.27,0,0,1,0-.13.36.36,0,0,1,.07-.1.39.39,0,0,1,.1-.08l.13,0h2a.31.31,0,0,1,.24.1.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13ZM8,10.67a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H5.85a.31.31,0,0,1-.34-.31L5.36,3.9a.36.36,0,0,1,.09-.24.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0H7.8a.35.35,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M12.57,14.1a.51.51,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0h-2l-.13,0L10,14.34A.41.41,0,0,1,10,14.1V12.2A.32.32,0,0,1,10,12a.39.39,0,0,1,.1-.08l.13,0h2a.31.31,0,0,1,.24.1.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13Zm-.12-3.93a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H10.35a.31.31,0,0,1-.34-.31L9.86,3.4A.36.36,0,0,1,10,3.16a.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0H12.3a.32.32,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M8.07,14.1a.51.51,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0h-2l-.13,0-.11-.08a.41.41,0,0,1-.08-.24V12.2a.27.27,0,0,1,0-.13.36.36,0,0,1,.07-.1.39.39,0,0,1,.1-.08l.13,0h2A.31.31,0,0,1,8,12a.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13ZM8,10.17a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H5.85a.31.31,0,0,1-.34-.31L5.36,3.4a.36.36,0,0,1,.09-.24.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0H7.8a.35.35,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n    </g>\n  </g>'),M='<g id="checkmate_black">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#312e2b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <path d="M11.44,8.41h1.74l.1-1.55H11.54l.18-2.78H10.17L10,6.86H8.31l.18-2.78H6.94L6.76,6.86H5l-.1,1.55H6.66l-.11,1.68H4.82l-.1,1.55H6.46l-.18,2.78H7.83L8,11.64H9.69l-.18,2.78h1.55l.18-2.78H13l.1-1.55H11.34ZM8.11,10.09l.1-1.68H9.89l-.1,1.68Z"></path>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#fff" d="M11.44,7.91h1.74l.1-1.55H11.54l.18-2.78H10.17L10,6.36H8.31l.18-2.78H6.94L6.76,6.36H5l-.1,1.55H6.66L6.55,9.59H4.82l-.1,1.55H6.46l-.18,2.78H7.83L8,11.14H9.69l-.18,2.78h1.55l.18-2.78H13l.1-1.55H11.34ZM8.11,9.59l.1-1.68H9.89l-.1,1.68Z"></path>\n  </g>'),T='<g id="checkmate_white">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <circle class="').concat(o.ClassNames.Background,'" fill="#f8f8f8" cx="9" cy="9" r="8.5"></circle>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#e8e8e8" d="M9,1A8,8,0,1,1,1,9,8,8,0,0,1,9,1M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <path d="M11.44,8.11h1.74l.1-1.55H11.54l.18-2.78H10.17L10,6.56H8.31l.18-2.78H6.94L6.76,6.56H5l-.1,1.55H6.66L6.55,9.79H4.82l-.1,1.55H6.46l-.18,2.78H7.83L8,11.34H9.69l-.18,2.78h1.55l.18-2.78H13l.1-1.55H11.34ZM8.11,9.79l.1-1.68H9.89l-.1,1.68Z"></path>\n  </g>'),P='<g id="correct">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96bc4b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2" d="M15.11,6.81,9.45,12.47,7.79,14.13a.39.39,0,0,1-.28.11.39.39,0,0,1-.27-.11L2.89,9.78a.39.39,0,0,1-.11-.28.39.39,0,0,1,.11-.27L4.28,7.85a.34.34,0,0,1,.12-.09l.15,0a.37.37,0,0,1,.15,0,.38.38,0,0,1,.13.09l2.69,2.68,5.65-5.65a.38.38,0,0,1,.13-.09.37.37,0,0,1,.15,0,.4.4,0,0,1,.15,0,.34.34,0,0,1,.12.09l1.39,1.38a.41.41,0,0,1,.08.13.33.33,0,0,1,0,.15.4.4,0,0,1,0,.15A.5.5,0,0,1,15.11,6.81Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M15.11,6.31,9.45,12,7.79,13.63a.39.39,0,0,1-.28.11.39.39,0,0,1-.27-.11L2.89,9.28A.39.39,0,0,1,2.78,9a.39.39,0,0,1,.11-.27L4.28,7.35a.34.34,0,0,1,.12-.09l.15,0a.37.37,0,0,1,.15,0,.38.38,0,0,1,.13.09L7.52,10l5.65-5.65a.38.38,0,0,1,.13-.09.37.37,0,0,1,.15,0,.4.4,0,0,1,.15,0,.34.34,0,0,1,.12.09l1.39,1.38a.41.41,0,0,1,.08.13.33.33,0,0,1,0,.15.4.4,0,0,1,0,.15A.5.5,0,0,1,15.11,6.31Z"></path>\n    </g>\n  </g>'),C='<g id="critical">\n    <g class="'.concat(o.ClassNames.Shadow,'" opacity="0.3">\n      <path d="M17.68,5.2,11.06,16.67a2.37,2.37,0,0,1-4.11,0L.32,5.2A2.38,2.38,0,0,1,2.38,1.64H15.62A2.38,2.38,0,0,1,17.68,5.2Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ad5b8c" d="M17.68,4.7,11.06,16.17a2.37,2.37,0,0,1-4.11,0L.32,4.7A2.38,2.38,0,0,1,2.38,1.14H15.62A2.38,2.38,0,0,1,17.68,4.7Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M8.67,3.22,5.9,9.92V10a.14.14,0,0,0,0,.06l0,0,0,0H8.4a.1.1,0,0,1,.09,0,.09.09,0,0,1,0,.08l0,5c0,.11.17.17.21.07L12.1,8V7.92a.14.14,0,0,0,0-.06.09.09,0,0,0-.05,0l-.06,0H9.32a.11.11,0,0,1-.08,0,.12.12,0,0,1,0-.09l-.32-4.4C8.87,3.18,8.71,3.12,8.67,3.22Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M8.67,2.72,5.9,9.42v.05a.14.14,0,0,0,0,.06l0,0,0,0H8.4a.1.1,0,0,1,.09,0,.09.09,0,0,1,0,.08l0,5c0,.11.17.17.21.07l3.4-7.24V7.42a.14.14,0,0,0,0-.06.09.09,0,0,0-.05,0l-.06,0H9.32a.11.11,0,0,1-.08,0,.12.12,0,0,1,0-.09l-.32-4.4C8.87,2.68,8.71,2.62,8.67,2.72Z"></path>\n  </g>'),A='<g id="draw_black">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#312e2b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <path d="M2.92,7V5.84c.81,0,1.75-.28,1.8-1.22H6.14v5.5H4.34V7Zm8.87-2.39L7,13.88H5l4.8-9.26ZM9.85,13.88c-.08-1.54,1.38-2.19,2.57-2.89.33-.17.78-.4.78-.78a.66.66,0,0,0-.68-.7c-.69,0-.94.58-.92,1.16H10a2.17,2.17,0,0,1,.64-1.79,2.74,2.74,0,0,1,1.91-.62C14.1,8.26,15,8.78,15,10c0,1.82-2.66,2.18-2.66,2.5h2.73v1.38Z"></path>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#fff" d="M2.92,6.51V5.34c.81,0,1.75-.28,1.8-1.22H6.14v5.5H4.34V6.51Zm8.87-2.39L7,13.38H5l4.8-9.26ZM9.85,13.38c-.08-1.54,1.38-2.19,2.57-2.89.33-.17.78-.4.78-.78a.66.66,0,0,0-.68-.7c-.69,0-.94.58-.92,1.16H10a2.17,2.17,0,0,1,.64-1.79,2.74,2.74,0,0,1,1.91-.62C14.1,7.76,15,8.28,15,9.5c0,1.82-2.66,2.18-2.66,2.5h2.73v1.38Z"></path>\n  </g>'),O='<g id="draw_white">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <circle class="').concat(o.ClassNames.Background,'" fill="#f8f8f8" cx="9" cy="9" r="8.5"></circle>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#e8e8e8" d="M9,1A8,8,0,1,1,1,9,8,8,0,0,1,9,1M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <path d="M2.92,6.61V5.44c.81,0,1.75-.28,1.8-1.22H6.14v5.5H4.34V6.61Zm8.87-2.39L7,13.48H5l4.8-9.26ZM9.85,13.48c-.08-1.54,1.38-2.19,2.57-2.89.33-.17.78-.4.78-.78a.66.66,0,0,0-.68-.7c-.69,0-.94.58-.92,1.16H10a2.17,2.17,0,0,1,.64-1.79,2.74,2.74,0,0,1,1.91-.62C14.1,7.86,15,8.38,15,9.6c0,1.82-2.66,2.18-2.66,2.5h2.73v1.38Z"></path>\n  </g>'),L='<g id="excellent">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96bc4b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M13.79,11.34c0-.2.4-.53.4-.94S14,9.72,14,9.58a2.06,2.06,0,0,0,.18-.83,1,1,0,0,0-.3-.69,1.13,1.13,0,0,0-.55-.2,10.29,10.29,0,0,1-2.07,0c-.37-.23,0-1.18.18-1.7S11.9,4,10.62,3.7c-.69-.17-.66.37-.78.9-.05.21-.09.43-.13.57A5,5,0,0,1,7.05,8.23a1.57,1.57,0,0,1-.42.18v4.94A7.23,7.23,0,0,1,8,13.53c.52.12.91.25,1.44.33A11.11,11.11,0,0,0,11,14a6.65,6.65,0,0,0,1.18,0,1.09,1.09,0,0,0,1-.59.66.66,0,0,0,.06-.2,1.63,1.63,0,0,1,.07-.3c.13-.28.37-.3.5-.68S13.74,11.53,13.79,11.34Z"></path>\n      <path d="M5.49,8.09H4.31a.5.5,0,0,0-.5.5v4.56a.5.5,0,0,0,.5.5H5.49a.5.5,0,0,0,.5-.5V8.59A.5.5,0,0,0,5.49,8.09Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M13.79,10.84c0-.2.4-.53.4-.94S14,9.22,14,9.08a2.06,2.06,0,0,0,.18-.83,1,1,0,0,0-.3-.69,1.13,1.13,0,0,0-.55-.2,10.29,10.29,0,0,1-2.07,0c-.37-.23,0-1.18.18-1.7s.51-2.12-.77-2.43c-.69-.17-.66.37-.78.9-.05.21-.09.43-.13.57A5,5,0,0,1,7.05,7.73a1.57,1.57,0,0,1-.42.18v4.94A7.23,7.23,0,0,1,8,13c.52.12.91.25,1.44.33a11.11,11.11,0,0,0,1.62.16,6.65,6.65,0,0,0,1.18,0,1.09,1.09,0,0,0,1-.59.66.66,0,0,0,.06-.2,1.63,1.63,0,0,1,.07-.3c.13-.28.37-.3.5-.68S13.74,11,13.79,10.84Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M5.49,7.59H4.31a.5.5,0,0,0-.5.5v4.56a.5.5,0,0,0,.5.5H5.49a.5.5,0,0,0,.5-.5V8.09A.5.5,0,0,0,5.49,7.59Z"></path>\n    </g>\n  </g>'),I='<g id="fast_win">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96af8b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M4.85,4.7,9.67,9.19a.18.18,0,0,1,.05.07.21.21,0,0,1,0,.18l-.05.07L4.85,14a.24.24,0,0,1-.11.06.3.3,0,0,1-.13,0A.23.23,0,0,1,4.52,14a.28.28,0,0,1,0-.12v-9a.28.28,0,0,1,0-.12.23.23,0,0,1,.09-.08.3.3,0,0,1,.13,0A.24.24,0,0,1,4.85,4.7Z"></path>\n      <path d="M10,4.7l4.82,4.49a.18.18,0,0,1,.05.07.21.21,0,0,1,0,.18l-.05.07L10,14a.24.24,0,0,1-.11.06.27.27,0,0,1-.13,0A.18.18,0,0,1,9.7,14a.19.19,0,0,1,0-.12v-9a.19.19,0,0,1,0-.12.18.18,0,0,1,.09-.08.27.27,0,0,1,.13,0A.24.24,0,0,1,10,4.7Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M4.85,4.2,9.67,8.69a.18.18,0,0,1,.05.07.21.21,0,0,1,0,.18L9.67,9,4.85,13.5a.24.24,0,0,1-.11.06.3.3,0,0,1-.13,0,.23.23,0,0,1-.09-.08.28.28,0,0,1,0-.12v-9a.28.28,0,0,1,0-.12.23.23,0,0,1,.09-.08.3.3,0,0,1,.13,0A.24.24,0,0,1,4.85,4.2Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M10,4.2l4.82,4.49a.18.18,0,0,1,.05.07.21.21,0,0,1,0,.18L14.85,9,10,13.5a.24.24,0,0,1-.11.06.27.27,0,0,1-.13,0,.18.18,0,0,1-.09-.08.19.19,0,0,1,0-.12v-9a.19.19,0,0,1,0-.12.18.18,0,0,1,.09-.08.27.27,0,0,1,.13,0A.24.24,0,0,1,10,4.2Z"></path>\n    </g>\n  </g>'),R='<g id="free_piece">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ec6250" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M9.76,9.66h3.89v4.19a.68.68,0,0,1-.68.68H9.76Z"></path>\n      <path d="M4.35,9.66H8.24v4.87H5a.58.58,0,0,1-.26-.06.6.6,0,0,1-.36-.36.58.58,0,0,1,0-.26V9.66Z"></path>\n      <path d="M13.39,7H10.13l2-1a.78.78,0,0,0,.29-.25.78.78,0,0,0,.13-.36A.82.82,0,0,0,12.53,5a.87.87,0,0,0-.23-.31l-1.15-1a.76.76,0,0,0-.34-.16.74.74,0,0,0-.39,0,.94.94,0,0,0-.33.2.84.84,0,0,0-.19.33L9.08,7H9l-.83-2.9A.73.73,0,0,0,8,3.81a.79.79,0,0,0-.33-.2.7.7,0,0,0-.38,0,.75.75,0,0,0-.35.16l-1.14,1A.87.87,0,0,0,5.54,5a.71.71,0,0,0,0,.38.78.78,0,0,0,.13.36A.71.71,0,0,0,5.91,6l2,1H4.61a.46.46,0,0,0-.49.44v.87a.47.47,0,0,0,.49.45h8.78a.47.47,0,0,0,.49-.45V7.48A.47.47,0,0,0,13.39,7Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M9.76,14H13a.71.71,0,0,0,.48-.19.72.72,0,0,0,.2-.48V9.16H9.76Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M4.36,13.35a.58.58,0,0,0,0,.26.6.6,0,0,0,.36.36A.58.58,0,0,0,5,14H8.24V9.16H4.36Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M13.39,6.54H10.13l2-1a.78.78,0,0,0,.29-.25.78.78,0,0,0,.13-.36.82.82,0,0,0-.05-.38.87.87,0,0,0-.23-.31l-1.15-1a.76.76,0,0,0-.34-.16.74.74,0,0,0-.39,0,.94.94,0,0,0-.33.2.84.84,0,0,0-.19.33l-.82,2.9H9l-.83-2.9A.73.73,0,0,0,8,3.31a.79.79,0,0,0-.33-.2.7.7,0,0,0-.38,0,.75.75,0,0,0-.35.16l-1.14,1a.87.87,0,0,0-.23.31.71.71,0,0,0,0,.38.78.78,0,0,0,.13.36.71.71,0,0,0,.29.25l2,1H4.61A.46.46,0,0,0,4.12,7v.87a.47.47,0,0,0,.49.45h8.78a.47.47,0,0,0,.49-.45V7A.47.47,0,0,0,13.39,6.54Z"></path>\n    </g>\n  </g>'),j='<path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n<path class="').concat(o.ClassNames.Background,'" fill="#7979a1" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n<g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.1">\n    <polygon points="11.29 11.34 11.29 8.56 7.79 11.3 7.79 11.34 5.39 11.34 9.54 16.5 13.73 11.34 11.29 11.34"></polygon>\n    <polygon points="7.83 7.51 7.83 10.32 11.33 7.58 11.33 7.5 13.73 7.5 9.58 2.35 5.39 7.51 7.83 7.51"></polygon>\n  </g>\n<g>\n    <polygon class="').concat(o.ClassNames.Component,'" fill="#fff" points="10.9 10.92 10.9 8.13 7.4 10.87 7.4 10.92 5 10.92 9.15 16.07 13.34 10.92 10.9 10.92"></polygon>\n    <polygon class="').concat(o.ClassNames.Component,'" fill="#fff" points="7.44 7.08 7.44 9.9 10.94 7.16 10.94 7.08 13.34 7.08 9.19 1.93 5 7.08 7.44 7.08"></polygon>\n  </g>'),N='<g id="great_find">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#1bada6" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g>\n      <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n        <path d="M10.32,14.6a.27.27,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0H8l-.13,0-.11-.08a.41.41,0,0,1-.08-.24V12.7a.27.27,0,0,1,0-.13.36.36,0,0,1,.07-.1.39.39,0,0,1,.1-.08l.13,0h2a.31.31,0,0,1,.24.1.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13Zm-.12-3.93a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H8.1a.31.31,0,0,1-.34-.31L7.61,3.9a.36.36,0,0,1,.09-.24.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0h2.11a.32.32,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n      </g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M10.32,14.1a.27.27,0,0,1,0,.13.44.44,0,0,1-.08.11l-.11.08-.13,0H8l-.13,0-.11-.08a.41.41,0,0,1-.08-.24V12.2a.27.27,0,0,1,0-.13.36.36,0,0,1,.07-.1.39.39,0,0,1,.1-.08l.13,0h2a.31.31,0,0,1,.24.1.39.39,0,0,1,.08.1.51.51,0,0,1,0,.13Zm-.12-3.93a.17.17,0,0,1,0,.12.41.41,0,0,1-.07.11.4.4,0,0,1-.23.08H8.1a.31.31,0,0,1-.34-.31L7.61,3.4a.36.36,0,0,1,.09-.24.23.23,0,0,1,.11-.08.27.27,0,0,1,.13,0h2.11a.32.32,0,0,1,.25.1.36.36,0,0,1,.09.24Z"></path>\n    </g>\n  </g>'),k='<g id="forced">\n    <g id="fast_win">\n      <g>\n        <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n        <path class="').concat(o.ClassNames.Background,'" fill="#96af8b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n      </g>\n    </g>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M14.39,9.07,9,4.31a.31.31,0,0,0-.3,0,.32.32,0,0,0-.13.1.29.29,0,0,0,0,.16V7.42H3.9a.58.58,0,0,0-.19,0,.5.5,0,0,0-.17.11.91.91,0,0,0-.11.16.63.63,0,0,0,0,.19v3.41a.58.58,0,0,0,0,.19.64.64,0,0,0,.11.16.39.39,0,0,0,.17.11.41.41,0,0,0,.19,0H8.5v2.74a.26.26,0,0,0,.16.26.3.3,0,0,0,.16,0A.34.34,0,0,0,9,14.79L14.39,10a.69.69,0,0,0,.16-.22.7.7,0,0,0,0-.52A.69.69,0,0,0,14.39,9.07Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M14.39,8.57,9,3.81a.31.31,0,0,0-.3,0,.32.32,0,0,0-.13.1A.29.29,0,0,0,8.5,4V6.92H3.9a.58.58,0,0,0-.19,0,.5.5,0,0,0-.17.11.91.91,0,0,0-.11.16.63.63,0,0,0,0,.19v3.41a.58.58,0,0,0,0,.19.64.64,0,0,0,.11.16.39.39,0,0,0,.17.11.41.41,0,0,0,.19,0H8.5v2.74a.26.26,0,0,0,.16.26.3.3,0,0,0,.16,0A.34.34,0,0,0,9,14.29l5.42-4.76a.69.69,0,0,0,.16-.22.7.7,0,0,0,0-.52A.69.69,0,0,0,14.39,8.57Z"></path>\n  </g>'),D='<g id="good">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96af8b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2" d="M15.11,6.81,9.45,12.47,7.79,14.13a.39.39,0,0,1-.28.11.39.39,0,0,1-.27-.11L2.89,9.78a.39.39,0,0,1-.11-.28.39.39,0,0,1,.11-.27L4.28,7.85a.34.34,0,0,1,.12-.09l.15,0a.37.37,0,0,1,.15,0,.38.38,0,0,1,.13.09l2.69,2.68,5.65-5.65a.38.38,0,0,1,.13-.09.37.37,0,0,1,.15,0,.4.4,0,0,1,.15,0,.34.34,0,0,1,.12.09l1.39,1.38a.41.41,0,0,1,.08.13.33.33,0,0,1,0,.15.4.4,0,0,1,0,.15A.5.5,0,0,1,15.11,6.81Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M15.11,6.31,9.45,12,7.79,13.63a.39.39,0,0,1-.28.11.39.39,0,0,1-.27-.11L2.89,9.28A.39.39,0,0,1,2.78,9a.39.39,0,0,1,.11-.27L4.28,7.35a.34.34,0,0,1,.12-.09l.15,0a.37.37,0,0,1,.15,0,.38.38,0,0,1,.13.09L7.52,10l5.65-5.65a.38.38,0,0,1,.13-.09.37.37,0,0,1,.15,0,.4.4,0,0,1,.15,0,.34.34,0,0,1,.12.09l1.39,1.38a.41.41,0,0,1,.08.13.33.33,0,0,1,0,.15.4.4,0,0,1,0,.15A.5.5,0,0,1,15.11,6.31Z"></path>\n    </g>\n  </g>'),B='<g id="inaccuracy">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#f7c045" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M13.66,14.8a.28.28,0,0,1,0,.13.23.23,0,0,1-.08.11.28.28,0,0,1-.11.08l-.12,0h-2l-.13,0a.27.27,0,0,1-.1-.08A.36.36,0,0,1,11,14.8V12.9a.59.59,0,0,1,0-.13.36.36,0,0,1,.07-.1l.1-.08.13,0h2a.33.33,0,0,1,.23.1.39.39,0,0,1,.08.1.28.28,0,0,1,0,.13Zm-.12-3.93a.31.31,0,0,1,0,.13.3.3,0,0,1-.07.1.3.3,0,0,1-.23.08H11.43a.31.31,0,0,1-.34-.31L10.94,4.1A.5.5,0,0,1,11,3.86l.11-.08.13,0h2.11a.35.35,0,0,1,.26.1.41.41,0,0,1,.08.24Z"></path>\n      <path d="M7.65,14.82a.27.27,0,0,1,0,.12.26.26,0,0,1-.07.11l-.1.07-.13,0H5.43a.25.25,0,0,1-.12,0,.27.27,0,0,1-.1-.08.31.31,0,0,1-.09-.22V13a.36.36,0,0,1,.09-.23l.1-.07.12,0H7.32a.32.32,0,0,1,.23.09.3.3,0,0,1,.07.1.28.28,0,0,1,0,.13Zm2.2-7.17a3.1,3.1,0,0,1-.36.73A5.58,5.58,0,0,1,9,9a4.85,4.85,0,0,1-.52.49,8,8,0,0,0-.65.63,1,1,0,0,0-.27.7V11a.21.21,0,0,1,0,.12.17.17,0,0,1-.06.1.23.23,0,0,1-.1.07l-.12,0H5.53a.21.21,0,0,1-.12,0,.18.18,0,0,1-.1-.07.2.2,0,0,1-.08-.1.37.37,0,0,1,0-.12v-.35a2.68,2.68,0,0,1,.13-.84,2.91,2.91,0,0,1,.33-.66,3.38,3.38,0,0,1,.45-.55c.16-.15.33-.29.49-.42a7.84,7.84,0,0,0,.65-.64,1,1,0,0,0,.25-.67.77.77,0,0,0-.07-.34.67.67,0,0,0-.23-.27A1.16,1.16,0,0,0,6.49,6,1.61,1.61,0,0,0,6,6.11a3,3,0,0,0-.41.18,1.75,1.75,0,0,0-.29.18l-.11.09A.5.5,0,0,1,5,6.62a.31.31,0,0,1-.21-.13l-1-1.21a.3.3,0,0,1,0-.4A1.36,1.36,0,0,1,4,4.68a3.07,3.07,0,0,1,.56-.38,5.49,5.49,0,0,1,.9-.37,3.69,3.69,0,0,1,1.19-.17,3.92,3.92,0,0,1,2.3.75,2.85,2.85,0,0,1,.77.92A2.82,2.82,0,0,1,10,6.71,3,3,0,0,1,9.85,7.65Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M13.66,14.3a.28.28,0,0,1,0,.13.23.23,0,0,1-.08.11.28.28,0,0,1-.11.08l-.12,0h-2l-.13,0a.27.27,0,0,1-.1-.08A.36.36,0,0,1,11,14.3V12.4a.59.59,0,0,1,0-.13.36.36,0,0,1,.07-.1l.1-.08.13,0h2a.33.33,0,0,1,.23.1.39.39,0,0,1,.08.1.28.28,0,0,1,0,.13Zm-.12-3.93a.31.31,0,0,1,0,.13.3.3,0,0,1-.07.1.3.3,0,0,1-.23.08H11.43a.31.31,0,0,1-.34-.31L10.94,3.6A.5.5,0,0,1,11,3.36l.11-.08.13,0h2.11a.35.35,0,0,1,.26.1.41.41,0,0,1,.08.24Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M7.65,14.32a.27.27,0,0,1,0,.12.26.26,0,0,1-.07.11l-.1.07-.13,0H5.43a.25.25,0,0,1-.12,0,.27.27,0,0,1-.1-.08.31.31,0,0,1-.09-.22V12.49a.36.36,0,0,1,.09-.23l.1-.07.12,0H7.32a.32.32,0,0,1,.23.09.3.3,0,0,1,.07.1.28.28,0,0,1,0,.13Zm2.2-7.17a3.1,3.1,0,0,1-.36.73,5.58,5.58,0,0,1-.49.6A4.85,4.85,0,0,1,8.48,9a8,8,0,0,0-.65.63,1,1,0,0,0-.27.7v.22a.21.21,0,0,1,0,.12.17.17,0,0,1-.06.1.23.23,0,0,1-.1.07l-.12,0H5.53a.21.21,0,0,1-.12,0,.18.18,0,0,1-.1-.07.2.2,0,0,1-.08-.1.37.37,0,0,1,0-.12v-.35a2.68,2.68,0,0,1,.13-.84,2.91,2.91,0,0,1,.33-.66,3.38,3.38,0,0,1,.45-.55c.16-.15.33-.29.49-.42a7.84,7.84,0,0,0,.65-.64,1,1,0,0,0,.25-.67.77.77,0,0,0-.07-.34.67.67,0,0,0-.23-.27,1.16,1.16,0,0,0-.72-.24A1.61,1.61,0,0,0,6,5.61a3,3,0,0,0-.41.18A1.75,1.75,0,0,0,5.3,6l-.11.09A.5.5,0,0,1,5,6.12.31.31,0,0,1,4.74,6l-1-1.21a.3.3,0,0,1,0-.4A1.36,1.36,0,0,1,4,4.18a3.07,3.07,0,0,1,.56-.38,5.49,5.49,0,0,1,.9-.37,3.69,3.69,0,0,1,1.19-.17A3.92,3.92,0,0,1,8.93,4a2.85,2.85,0,0,1,.77.92A2.82,2.82,0,0,1,10,6.21,3,3,0,0,1,9.85,7.15Z"></path>\n    </g>\n  </g>'),G='<g id="incorrect">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ca3431" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M14,12.51a.57.57,0,0,1,.08.13.39.39,0,0,1,0,.3.5.5,0,0,1-.08.12l-1.38,1.38a.5.5,0,0,1-.12.08l-.15,0-.15,0a.57.57,0,0,1-.13-.08L9,11.37,5.94,14.44a.57.57,0,0,1-.13.08l-.15,0-.15,0a.36.36,0,0,1-.12-.08L4,13.06a.39.39,0,0,1-.11-.27A.41.41,0,0,1,4,12.51L7.07,9.45,4,6.39a.43.43,0,0,1-.11-.28A.39.39,0,0,1,4,5.84L5.39,4.46a.39.39,0,0,1,.27-.11.43.43,0,0,1,.28.11L9,7.52l3.06-3.06a.41.41,0,0,1,.28-.11.39.39,0,0,1,.27.11L14,5.84a.36.36,0,0,1,.08.12.39.39,0,0,1,0,.3.57.57,0,0,1-.08.13L10.92,9.45Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Component,'" fill="#f1f2f2" d="M14,12a.57.57,0,0,1,.08.13.39.39,0,0,1,0,.3.5.5,0,0,1-.08.12l-1.38,1.38a.5.5,0,0,1-.12.08l-.15,0-.15,0a.57.57,0,0,1-.13-.08L9,10.87,5.94,13.94a.57.57,0,0,1-.13.08l-.15,0-.15,0a.36.36,0,0,1-.12-.08L4,12.56a.39.39,0,0,1-.11-.27A.41.41,0,0,1,4,12L7.07,9,4,5.89a.43.43,0,0,1-.11-.28A.39.39,0,0,1,4,5.34L5.39,4a.39.39,0,0,1,.27-.11A.43.43,0,0,1,5.94,4L9,7,12.06,4a.41.41,0,0,1,.28-.11.39.39,0,0,1,.27.11L14,5.34a.36.36,0,0,1,.08.12.39.39,0,0,1,0,.3.57.57,0,0,1-.08.13L10.92,9Z"></path>\n  </g>'),H='<g id="mate">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ec6250" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g>\n      <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n        <path d="M11.44,8.61h1.74l.1-1.55H11.54l.18-2.78H10.17L10,7.06H8.31l.18-2.78H6.94L6.76,7.06H5l-.1,1.55H6.66l-.11,1.68H4.82l-.1,1.55H6.46l-.18,2.78H7.83L8,11.84H9.69l-.18,2.78h1.55l.18-2.78H13l.1-1.55H11.34ZM8.11,10.29l.1-1.68H9.89l-.1,1.68Z"></path>\n      </g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M11.44,8.11h1.74l.1-1.55H11.54l.18-2.78H10.17L10,6.56H8.31l.18-2.78H6.94L6.76,6.56H5l-.1,1.55H6.66L6.55,9.79H4.82l-.1,1.55H6.46l-.18,2.78H7.83L8,11.34H9.69l-.18,2.78h1.55l.18-2.78H13l.1-1.55H11.34ZM8.11,9.79l.1-1.68H9.89l-.1,1.68Z"></path>\n    </g>\n  </g>'),V='<g id="missed_win">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#dbac16" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g>\n      <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n        <rect x="2.74" y="8.1" width="12.51" height="3.11" rx="0.36"></rect>\n      </g>\n      <rect class="').concat(o.ClassNames.Component,'" fill="#fff" x="2.74" y="7.6" width="12.51" height="3.11" rx="0.36"></rect>\n    </g>\n  </g>'),U='<g id="mistake">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#e58f2a" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g>\n      <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n        <path d="M9.92,15a.27.27,0,0,1,0,.12.41.41,0,0,1-.07.11.32.32,0,0,1-.23.09H7.7a.25.25,0,0,1-.12,0,.27.27,0,0,1-.1-.08A.31.31,0,0,1,7.39,15V13.19A.32.32,0,0,1,7.48,13l.1-.07.12,0H9.59a.32.32,0,0,1,.23.09.61.61,0,0,1,.07.1.28.28,0,0,1,0,.13Zm2.2-7.17a3.1,3.1,0,0,1-.36.73,5.58,5.58,0,0,1-.49.6,6,6,0,0,1-.52.49,8,8,0,0,0-.65.63,1,1,0,0,0-.27.7v.22a.24.24,0,0,1,0,.12.17.17,0,0,1-.06.1.3.3,0,0,1-.1.07l-.12,0H7.79l-.12,0a.3.3,0,0,1-.1-.07.26.26,0,0,1-.07-.1.37.37,0,0,1,0-.12v-.35A2.42,2.42,0,0,1,7.61,10a2.55,2.55,0,0,1,.33-.66,3.38,3.38,0,0,1,.45-.55c.16-.15.33-.29.49-.42a7.73,7.73,0,0,0,.64-.64,1,1,0,0,0,.26-.67.77.77,0,0,0-.07-.34.75.75,0,0,0-.23-.27,1.16,1.16,0,0,0-.72-.24,1.61,1.61,0,0,0-.49.07,3,3,0,0,0-.41.18,1.41,1.41,0,0,0-.29.18l-.11.09a.5.5,0,0,1-.24.06A.31.31,0,0,1,7,6.69L6,5.48a.29.29,0,0,1,0-.4,1.36,1.36,0,0,1,.21-.2,3.07,3.07,0,0,1,.56-.38,5.38,5.38,0,0,1,.89-.37A3.75,3.75,0,0,1,8.9,4a4.07,4.07,0,0,1,1.2.19,4,4,0,0,1,1.09.56,2.76,2.76,0,0,1,.78.92,2.82,2.82,0,0,1,.28,1.28A3,3,0,0,1,12.12,7.85Z"></path>\n      </g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M9.92,14.52a.27.27,0,0,1,0,.12.41.41,0,0,1-.07.11.32.32,0,0,1-.23.09H7.7a.25.25,0,0,1-.12,0,.27.27,0,0,1-.1-.08.31.31,0,0,1-.09-.22V12.69a.32.32,0,0,1,.09-.23l.1-.07.12,0H9.59a.32.32,0,0,1,.23.09.61.61,0,0,1,.07.1.28.28,0,0,1,0,.13Zm2.2-7.17a3.1,3.1,0,0,1-.36.73,5.58,5.58,0,0,1-.49.6,6,6,0,0,1-.52.49,8,8,0,0,0-.65.63,1,1,0,0,0-.27.7v.22a.24.24,0,0,1,0,.12.17.17,0,0,1-.06.1.3.3,0,0,1-.1.07l-.12,0H7.79l-.12,0a.3.3,0,0,1-.1-.07.26.26,0,0,1-.07-.1.37.37,0,0,1,0-.12v-.35a2.42,2.42,0,0,1,.13-.84,2.55,2.55,0,0,1,.33-.66,3.38,3.38,0,0,1,.45-.55c.16-.15.33-.29.49-.42a7.73,7.73,0,0,0,.64-.64,1,1,0,0,0,.26-.67.77.77,0,0,0-.07-.34A.75.75,0,0,0,9.48,6a1.16,1.16,0,0,0-.72-.24,1.61,1.61,0,0,0-.49.07A3,3,0,0,0,7.86,6a1.41,1.41,0,0,0-.29.18l-.11.09a.5.5,0,0,1-.24.06A.31.31,0,0,1,7,6.19L6,5a.29.29,0,0,1,0-.4,1.36,1.36,0,0,1,.21-.2A3.07,3.07,0,0,1,6.81,4a5.38,5.38,0,0,1,.89-.37,3.75,3.75,0,0,1,1.2-.17,4.07,4.07,0,0,1,1.2.19,4,4,0,0,1,1.09.56,2.76,2.76,0,0,1,.78.92,2.82,2.82,0,0,1,.28,1.28A3,3,0,0,1,12.12,7.35Z"></path>\n    </g>\n  </g>'),z='<g id="resign_black">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#312e2b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g>\n      <path d="M4.94,6.34H4.89a.63.63,0,0,0-.44.77l2.16,8.09a.63.63,0,0,0,.77.45l0,0a.62.62,0,0,0,.44-.76L5.7,6.78A.62.62,0,0,0,4.94,6.34Z"></path>\n      <path d="M12.33,4.48c-2,2.29-3.83-.41-6,1.52a.54.54,0,0,0-.15.25.48.48,0,0,0,0,.29c.22.89.87,3.3,1.12,4.15a.15.15,0,0,0,.26.07c1.92-2.65,4,.27,6.11-1.69a.46.46,0,0,0,.12-.44c-.21-.78-.8-3-1.1-4.05C12.62,4.44,12.42,4.36,12.33,4.48Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#fff" d="M4.94,5.74H4.89a.63.63,0,0,0-.44.77l2.16,8.09a.63.63,0,0,0,.77.45l0,0a.62.62,0,0,0,.44-.76L5.7,6.18A.62.62,0,0,0,4.94,5.74Z"></path>\n      <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#fff" d="M12.33,3.88c-2,2.29-3.83-.41-6,1.52a.54.54,0,0,0-.15.25.48.48,0,0,0,0,.29c.22.89.87,3.3,1.12,4.15a.15.15,0,0,0,.26.07c1.92-2.65,4,.27,6.11-1.69A.46.46,0,0,0,13.76,8c-.21-.78-.8-3-1.1-4C12.62,3.84,12.42,3.76,12.33,3.88Z"></path>\n    </g>\n  </g>'),W='<g>\n    <g id="resign_white">\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <circle class="').concat(o.ClassNames.Background,'" fill="#f8f8f8" cx="9" cy="9" r="8.5"></circle>\n      <g>\n        <path d="M4.94,5.74H4.89a.63.63,0,0,0-.44.77l2.16,8.09a.63.63,0,0,0,.77.45l0,0a.62.62,0,0,0,.44-.76L5.7,6.18A.62.62,0,0,0,4.94,5.74Z"></path>\n        <path d="M12.33,3.88c-2,2.29-3.83-.41-6,1.52a.54.54,0,0,0-.15.25.48.48,0,0,0,0,.29c.22.89.87,3.3,1.12,4.15a.15.15,0,0,0,.26.07c1.92-2.65,4,.27,6.11-1.69A.46.46,0,0,0,13.76,8c-.21-.78-.8-3-1.1-4C12.62,3.84,12.42,3.76,12.33,3.88Z"></path>\n      </g>\n    </g>\n    <path class="').concat(o.ClassNames.ComponentShadow,'" fill="#e8e8e8" d="M9,1A8,8,0,1,1,1,9,8,8,0,0,1,9,1M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n  </g>'),q='<g id="sharp">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ad5b8c" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M13.37,11.74,9.25,2.81a.22.22,0,0,0-.1-.11.27.27,0,0,0-.28,0,.18.18,0,0,0-.1.11L4.63,11.74a.26.26,0,0,0,0,.15.25.25,0,0,0,.08.14l2.67,2.29.07.09a.3.3,0,0,1,0,.1v1.08a.25.25,0,0,0,.08.18.24.24,0,0,0,.18.07h2.57a.26.26,0,0,0,.18-.07.25.25,0,0,0,.08-.18V14.51a.16.16,0,0,1,0-.1.47.47,0,0,1,.06-.09L13.31,12a.25.25,0,0,0,.08-.14A.26.26,0,0,0,13.37,11.74ZM9,5v8.73a.24.24,0,0,1-.38.17L5.91,11.76a.3.3,0,0,1-.09-.13.22.22,0,0,1,0-.16L8.84,5a.08.08,0,0,1,0,0h.06A.09.09,0,0,1,9,5S9,5,9,5Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M13.37,11.24,9.25,2.31a.22.22,0,0,0-.1-.11.26.26,0,0,0-.28,0,.18.18,0,0,0-.1.11L4.63,11.24a.26.26,0,0,0,0,.15.25.25,0,0,0,.08.14l2.67,2.29.07.09a.3.3,0,0,1,0,.1v1.08a.25.25,0,0,0,.08.18.24.24,0,0,0,.18.07h2.57a.26.26,0,0,0,.18-.07.25.25,0,0,0,.08-.18V14a.16.16,0,0,1,0-.1.47.47,0,0,1,.06-.09l2.67-2.29a.25.25,0,0,0,.08-.14A.26.26,0,0,0,13.37,11.24ZM9,4.51v8.73a.24.24,0,0,1-.38.17L5.91,11.26a.3.3,0,0,1-.09-.13.22.22,0,0,1,0-.16l3-6.49a.08.08,0,0,1,0,0h.06a.09.09,0,0,1,.05,0S9,4.49,9,4.51Z"></path>\n  </g>'),$='<g id="take_back">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#96af8b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M3.67,10.38a.25.25,0,0,1,.24-.31L5,9.93a.49.49,0,0,1,.2.05.26.26,0,0,1,.1.2,3.77,3.77,0,0,0,1.26,2.34,3.87,3.87,0,0,0,2.52.94,3.53,3.53,0,0,0,1.47-.31,3.72,3.72,0,0,0,1.22-.81,4.13,4.13,0,0,0,.82-1.2,3.74,3.74,0,0,0,0-3A3.94,3.94,0,0,0,11.77,7a3.72,3.72,0,0,0-1.22-.81,3.53,3.53,0,0,0-1.47-.31,3.43,3.43,0,0,0-1.23.22,3.07,3.07,0,0,0-1.09.6L7.85,7.75c.16.14.22.29.16.38s-.18.16-.4.16H4.45a.33.33,0,0,1-.19,0,1,1,0,0,1-.17-.1A.57.57,0,0,1,4,8a.46.46,0,0,1,0-.21V4.6a.4.4,0,0,1,.16-.38c.11,0,.26,0,.42.17L5.6,5.49a5.93,5.93,0,0,1,1.63-1,5.42,5.42,0,0,1,4,.11A5.17,5.17,0,0,1,12.93,5.8a5.48,5.48,0,0,1,1.16,1.73,5.17,5.17,0,0,1,.44,2.12,5,5,0,0,1-.44,2.12,5.54,5.54,0,0,1-2.88,2.91,5.77,5.77,0,0,1-2.13.42,5.39,5.39,0,0,1-1.94-.37,5.36,5.36,0,0,1-2.85-2.48A5.43,5.43,0,0,1,3.67,10.38Z"></path>\n    </g>\n    <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M3.67,9.88a.25.25,0,0,1,.24-.31L5,9.43a.49.49,0,0,1,.2.05.26.26,0,0,1,.1.2A3.77,3.77,0,0,0,6.56,12,3.87,3.87,0,0,0,9.08,13a3.53,3.53,0,0,0,1.47-.31,3.72,3.72,0,0,0,1.22-.81,4.13,4.13,0,0,0,.82-1.2,3.74,3.74,0,0,0,0-3,3.94,3.94,0,0,0-.82-1.2,3.72,3.72,0,0,0-1.22-.81,3.53,3.53,0,0,0-1.47-.31,3.43,3.43,0,0,0-1.23.22,3.07,3.07,0,0,0-1.09.6L7.85,7.25c.16.14.22.29.16.38s-.18.16-.4.16H4.45a.33.33,0,0,1-.19,0,1,1,0,0,1-.17-.1A.57.57,0,0,1,4,7.47a.46.46,0,0,1,0-.21V4.1a.4.4,0,0,1,.16-.38c.11-.05.26,0,.42.17L5.6,5A5.93,5.93,0,0,1,7.23,4a5.42,5.42,0,0,1,4,.11A5.17,5.17,0,0,1,12.93,5.3,5.48,5.48,0,0,1,14.09,7a5.17,5.17,0,0,1,.44,2.12,5,5,0,0,1-.44,2.12,5.54,5.54,0,0,1-2.88,2.91,5.77,5.77,0,0,1-2.13.42,5.39,5.39,0,0,1-1.94-.37,5.63,5.63,0,0,1-1.65-1,5.59,5.59,0,0,1-1.2-1.5A5.43,5.43,0,0,1,3.67,9.88Z"></path>\n  </g>'),X='<g id="threat">\n    <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n    <path class="').concat(o.ClassNames.Background,'" fill="#ec6250" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path d="M15.12,9.65a6.14,6.14,0,0,1-3.78,5.65,6.19,6.19,0,0,1-3.53.35A6.15,6.15,0,0,1,3,10.84,6.11,6.11,0,0,1,9,3.53a6.15,6.15,0,0,1,6.12,6.12ZM5,9.65a4,4,0,0,0,.67,2.22,4.09,4.09,0,0,0,1.79,1.47,4,4,0,0,0,5.22-5.22A4,4,0,0,0,5,9.65Z"></path>\n      <path d="M6.75,9.65a2.24,2.24,0,0,0,.38,1.25,2.27,2.27,0,0,0,1,.83,2.22,2.22,0,0,0,1.3.12,2.22,2.22,0,0,0,1.76-1.76,2.22,2.22,0,0,0-.13-1.3,2.25,2.25,0,0,0-4.32.86Z"></path>\n    </g>\n    <g>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M15.12,9.15a6.14,6.14,0,0,1-3.78,5.65,6.19,6.19,0,0,1-3.53.35A6.15,6.15,0,0,1,3,10.34,6.11,6.11,0,0,1,9,3a6.15,6.15,0,0,1,6.12,6.12ZM5,9.15a4,4,0,0,0,.67,2.22,4.09,4.09,0,0,0,1.79,1.47,4,4,0,0,0,5.22-5.22A4,4,0,0,0,5,9.15Z"></path>\n      <path class="').concat(o.ClassNames.Component,'" fill="#fff" d="M6.75,9.15a2.24,2.24,0,0,0,.38,1.25,2.27,2.27,0,0,0,1,.83,2.22,2.22,0,0,0,1.3.12A2.22,2.22,0,0,0,11.2,9.59a2.22,2.22,0,0,0-.13-1.3,2.25,2.25,0,0,0-4.32.86Z"></path>\n    </g>\n  </g>'),K='<path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n<path class="').concat(o.ClassNames.Background,'" fill="#312e2b" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n<path d="M8.57,7.26,8.11,10l.89.86L9.89,10,9.45,7.26ZM9,12.86A3.35,3.35,0,1,1,12.36,9.5,3.34,3.34,0,0,1,9,12.86Zm.7-8.29V4.12h.82V2.79h-3V4.12H8.3v.45a5,5,0,1,0,1.4,0Z"></path>\n<path class="').concat(o.ClassNames.ComponentShadow,'" fill="#fff" d="M8.57,6.76,8.11,9.48l.89.86.89-.86L9.45,6.76ZM9,12.36A3.35,3.35,0,1,1,12.36,9,3.34,3.34,0,0,1,9,12.36Zm.7-8.29V3.62h.82V2.29h-3V3.62H8.3v.45a5,5,0,1,0,1.4,0Z"></path>'),Y='<path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n<circle class="').concat(o.ClassNames.Background,'" fill="#f8f8f8" cx="9" cy="9" r="8.5"></circle>\n<path class="').concat(o.ClassNames.ComponentShadow,'" fill="#e8e8e8" d="M9,1A8,8,0,1,1,1,9,8,8,0,0,1,9,1M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n<path d="M8.57,6.76,8.11,9.48l.89.86.89-.86L9.45,6.76ZM9,12.36A3.35,3.35,0,1,1,12.36,9,3.34,3.34,0,0,1,9,12.36Zm.7-8.29V3.62h.82V2.29h-3V3.62H8.3v.45a5,5,0,1,0,1.4,0Z"></path>'),Z='\n  <path\n    class="'.concat(o.ClassNames.Shadow,'"\n    d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"\n    opacity=".3"></path>\n  <path\n    class="').concat(o.ClassNames.Background,'"\n    d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"\n    fill="#8a8886"></path>\n  <path\n    d="M3.59,10.23a.25.25,0,0,1,.24-.31l1.08-.15a.49.49,0,0,1,.2.06.25.25,0,0,1,.11.2,3.58,3.58,0,0,0,.42,1.28,3.68,3.68,0,0,0,.84,1.06,3.76,3.76,0,0,0,1.16.69A3.9,3.9,0,0,0,9,13.31,3.58,3.58,0,0,0,10.47,13a3.94,3.94,0,0,0,1.22-.81A4.09,4.09,0,0,0,12.5,11a3.74,3.74,0,0,0,0-3,4.09,4.09,0,0,0-.81-1.2A3.94,3.94,0,0,0,10.47,6,3.65,3.65,0,0,0,9,5.69a3.61,3.61,0,0,0-1.23.21,3.23,3.23,0,0,0-1.09.6L7.77,7.59c.16.15.21.29.16.38s-.18.17-.4.17H4.37a.36.36,0,0,1-.2,0A.76.76,0,0,1,4,8a.52.52,0,0,1-.17-.38V4.45c0-.2.06-.33.17-.38s.25,0,.41.16L5.51,5.34a5.83,5.83,0,0,1,1.64-1A5.19,5.19,0,0,1,9,4.05a5.3,5.3,0,0,1,2.12.44,5,5,0,0,1,1.73,1.16A5.59,5.59,0,0,1,14,7.38a5.23,5.23,0,0,1,.44,2.12A5.16,5.16,0,0,1,14,11.62a5.59,5.59,0,0,1-1.16,1.73,5.32,5.32,0,0,1-1.73,1.18A5.64,5.64,0,0,1,9,15a5.23,5.23,0,0,1-1.94-.37A5.27,5.27,0,0,1,4.21,12.1,5.1,5.1,0,0,1,3.59,10.23Z"\n    class="').concat(o.ClassNames.ComponentShadow,'"\n    opacity=".3"></path>\n  <path\n    d="M3.59,9.73a.25.25,0,0,1,.24-.31l1.08-.15a.49.49,0,0,1,.2.06.25.25,0,0,1,.11.2,3.58,3.58,0,0,0,.42,1.28,3.68,3.68,0,0,0,.84,1.06,3.76,3.76,0,0,0,1.16.69A3.9,3.9,0,0,0,9,12.81a3.58,3.58,0,0,0,1.47-.31,3.94,3.94,0,0,0,1.22-.81,4.09,4.09,0,0,0,.81-1.2,3.74,3.74,0,0,0,0-3,4.09,4.09,0,0,0-.81-1.2,3.94,3.94,0,0,0-1.22-.81A3.65,3.65,0,0,0,9,5.19a3.61,3.61,0,0,0-1.23.21A3.23,3.23,0,0,0,6.68,6L7.77,7.09c.16.15.21.29.16.38s-.18.17-.4.17H4.37a.36.36,0,0,1-.2,0A.76.76,0,0,1,4,7.49a.52.52,0,0,1-.17-.38V4c0-.2.06-.33.17-.38s.25,0,.41.16L5.51,4.84a5.83,5.83,0,0,1,1.64-1A5.19,5.19,0,0,1,9,3.55,5.3,5.3,0,0,1,11.12,4a5,5,0,0,1,1.73,1.16A5.59,5.59,0,0,1,14,6.88,5.23,5.23,0,0,1,14.45,9,5.16,5.16,0,0,1,14,11.12a5.59,5.59,0,0,1-1.16,1.73A5.32,5.32,0,0,1,11.12,14,5.64,5.64,0,0,1,9,14.45a5.23,5.23,0,0,1-1.94-.37A5.27,5.27,0,0,1,4.21,11.6,5.1,5.1,0,0,1,3.59,9.73Z"\n    class="').concat(o.ClassNames.Component,'"\n    fill="#ffffff"></path>\n'),Q='<g id="winner">\n    <g>\n      <path class="'.concat(o.ClassNames.Shadow,'" opacity="0.3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"></path>\n      <path class="').concat(o.ClassNames.Background,'" fill="#dbac16" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"></path>\n    </g>\n    <g class="').concat(o.ClassNames.ComponentShadow,'" opacity="0.2">\n      <path class="cls-4" d="M4.35,12.66,2.86,7.72a.37.37,0,0,1,0-.21A.35.35,0,0,1,3,7.34a.31.31,0,0,1,.2-.07.3.3,0,0,1,.21.05L6.27,9.15l.14,0h.14a.31.31,0,0,0,.13-.06A.48.48,0,0,0,6.77,9L8.69,5.54a.4.4,0,0,1,.13-.13.37.37,0,0,1,.18,0,.36.36,0,0,1,.31.18L11.22,9a.52.52,0,0,0,.1.11.31.31,0,0,0,.13.06h.14l.13,0,2.89-1.83a.3.3,0,0,1,.21-.05.31.31,0,0,1,.2.07.35.35,0,0,1,.12.17.37.37,0,0,1,0,.21l-1.49,4.94a.34.34,0,0,1-.13.18.31.31,0,0,1-.21.07H4.69a.31.31,0,0,1-.21-.07A.34.34,0,0,1,4.35,12.66Z"></path>\n    </g>\n    <path class="').concat(void 0,'" fill-rule="evenodd" d="M4.35,12.06,2.86,7.12a.37.37,0,0,1,0-.21A.35.35,0,0,1,3,6.74a.31.31,0,0,1,.2-.07.3.3,0,0,1,.21,0L6.27,8.55l.14,0h.14a.31.31,0,0,0,.13-.06.48.48,0,0,0,.09-.11L8.69,4.94a.4.4,0,0,1,.13-.13.37.37,0,0,1,.18,0,.36.36,0,0,1,.31.18l1.91,3.48a.52.52,0,0,0,.1.11.31.31,0,0,0,.13.06h.14l.13,0,2.89-1.83a.3.3,0,0,1,.21,0,.31.31,0,0,1,.2.07.35.35,0,0,1,.12.17.38.38,0,0,1,0,.21l-1.49,4.94a.34.34,0,0,1-.13.18.31.31,0,0,1-.21.07H4.69a.31.31,0,0,1-.21-.07A.34.34,0,0,1,4.35,12.06Z"></path>\n  </g>'),J=(g={},l()(g,h.a.Node.Marking.Effect.Types.Alternative,y),l()(g,h.a.Node.Marking.Effect.Types.BestMove,_),l()(g,h.a.Node.Marking.Effect.Types.Blunder,x),l()(g,h.a.Node.Marking.Effect.Types.Book,w),l()(g,h.a.Node.Marking.Effect.Types.Brilliant,S),l()(g,h.a.Node.Marking.Effect.Types.CheckmateBlack,M),l()(g,h.a.Node.Marking.Effect.Types.CheckmateWhite,T),l()(g,h.a.Node.Marking.Effect.Types.Correct,P),l()(g,h.a.Node.Marking.Effect.Types.Critical,C),l()(g,h.a.Node.Marking.Effect.Types.DrawBlack,A),l()(g,h.a.Node.Marking.Effect.Types.DrawWhite,O),l()(g,h.a.Node.Marking.Effect.Types.Excellent,L),l()(g,h.a.Node.Marking.Effect.Types.FastWin,I),l()(g,h.a.Node.Marking.Effect.Types.Forced,k),l()(g,h.a.Node.Marking.Effect.Types.FreePiece,R),l()(g,h.a.Node.Marking.Effect.Types.Gamechanger,j),l()(g,h.a.Node.Marking.Effect.Types.Good,D),l()(g,h.a.Node.Marking.Effect.Types.GreatFind,N),l()(g,h.a.Node.Marking.Effect.Types.Inaccuracy,B),l()(g,h.a.Node.Marking.Effect.Types.Incorrect,G),l()(g,h.a.Node.Marking.Effect.Types.Mate,H),l()(g,h.a.Node.Marking.Effect.Types.MissedWin,V),l()(g,h.a.Node.Marking.Effect.Types.Mistake,U),l()(g,h.a.Node.Marking.Effect.Types.ResignBlack,z),l()(g,h.a.Node.Marking.Effect.Types.ResignWhite,W),l()(g,h.a.Node.Marking.Effect.Types.Sharp,q),l()(g,h.a.Node.Marking.Effect.Types.Takeback,$),l()(g,h.a.Node.Marking.Effect.Types.Threat,X),l()(g,h.a.Node.Marking.Effect.Types.TimeoutBlack,K),l()(g,h.a.Node.Marking.Effect.Types.TimeoutWhite,Y),l()(g,h.a.Node.Marking.Effect.Types.Undo,Z),l()(g,h.a.Node.Marking.Effect.Types.Winner,Q),g)},function(t,r,i){"use strict";i.d(r,"a",(function(){return getDefaultOptions}));var o=i(7);function getDefaultOptions(){return{allowMarkings:!0,analysisHighlightColors:{alt:o.a.HighlightedSquareColors.Blue,ctrl:o.a.HighlightedSquareColors.Orange,default:o.a.HighlightedSquareColors.Red,shift:o.a.HighlightedSquareColors.Green},analysisHighlightOpacity:.8,animationType:o.a.Animation.Types.Default,arrowColors:{alt:o.a.HighlightedArrowColors.Blue,ctrl:o.a.HighlightedArrowColors.Red,default:o.a.HighlightedArrowColors.Orange,shift:o.a.HighlightedArrowColors.Green},aspectRatio:1,autoClaimDraw:!0,autoPromote:!1,autoResize:!0,boardStyle:"green",captureKeyStrokes:!0,checkBlinkingSquareColor:"#ff0000",coordinates:o.a.CoordinatesPositions.Inside,darkMode:!1,diagramStyle:!0,enabled:!0,fadeSetup:0,flipped:!1,highlightColor:void 0,highlightLegalMoves:!0,highlightMoves:!0,highlightOpacity:.5,hoverSquareOutline:!0,id:(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",[0,0,0,0,0,0,0,0,0,0].reduce((function(r){return r+t.charAt(Math.floor(Math.random()*t.length))}),"")),moveListContextMenuEnabled:!0,moveListDisplayType:o.a.MoveListDisplayTypes.Text,moveMethod:o.a.MoveMethods.Drag,overlayInAnalysisMode:!1,pieceStyle:"neo",playSounds:!0,premoveDelay:200,premoveHighlightColor:"#f42a32",premoveHighlightOpacity:.5,rounded:!0,soundTheme:"default",threatSquareColor:"#ff0000",threatSquareOpacity:.8};var t}},function(t,r){function _typeof(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=_typeof=function _typeof(t){return typeof t}:t.exports=_typeof=function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(r)}t.exports=_typeof},function(t,r){t.exports=function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}},function(t,r,i){"use strict";i.d(r,"a",(function(){return getBoardURL}));var o=i(65);function getBoardURL(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150;return"".concat(Object(o.a)(),"/chess-themes/boards/").concat(t,"/").concat(r,".png")}},function(t,r,i){"use strict";i.d(r,"a",(function(){return isCastle}));var o=i(2);function isCastle(t){return t.flags===o.a.Move.Flags.AnyCastle||t.flags===o.a.Move.Flags.KingsideCastle||t.flags===o.a.Move.Flags.QueensideCastle}},function(t,r,i){"use strict";function calculateArrowSlope(t){var r=t.from,i=t.to,o=(r.y-i.y)/(r.x-i.x);return Number(o.toFixed(1))}i.d(r,"a",(function(){return calculateArrowSlope}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return calculateArrowRotation}));var o=i(35);function calculateArrowRotation(t){var r=t.from,i=t.to,a=Object(o.a)({from:r,to:i}),l=r.x,h=r.y+a,g=r.x-l,y=r.y-h,_=r.x-i.x,x=r.y-i.y,w=Math.acos((g*_+y*x)/Math.pow(a,2)),S=Math.floor(w*(180/Math.PI)*100)/100;return r.x<i.x?360-S:S}},function(t,r,i){"use strict";function getKnightArrowRotation(t){var r=t.from,i=t.slope,o=t.to;switch(i){case 2:return r.x>o.x?180:0;case-2:return r.x>o.x?0:180;case.5:case-.5:return r.x>o.x?90:270;default:return 0}}i.d(r,"a",(function(){return getKnightArrowRotation}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getArrowColor}));var o=i(2);function getArrowColor(t,r){var i,a;return null!==(a=null!==(i=t&&r[o.a.Node.Marking.JCEColorsMap[t]])&&void 0!==i?i:t)&&void 0!==a?a:r.default}},function(t,r,i){"use strict";i.d(r,"a",(function(){return getColorAsNumber}));var o=i(2);function getColorAsNumber(t){return t===o.a.ColorsAsLetters.Black||t===o.a.ColorsAsWords.Black?o.a.ColorsAsNumbers.Black:o.a.ColorsAsNumbers.White}},function(t,r,i){"use strict";i.r(r),i.d(r,"Image",(function(){return o})),i.d(r,"Star",(function(){return a})),i.d(r,"TextBox",(function(){return l}));var o='\n<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <image x="7.5" y="7.5" width="25" height="25" />\n</svg>\n',a='\n  <svg xmlns="http://www.w3.org/2000/svg" style="fill: #ffa704" viewBox="0 0 40 40">\n    <path\n      d="M23.12,17.84H16.4a1.11,1.11,0,0,1-1.06-1.43L18.7,5.21a1.11,1.11,0,0,1,2.13,0l3.36,11.2A1.11,1.11,0,0,1,23.12,17.84Z" />\n    <path\n      d="M27.21,34.11,4.35,16.88a1.11,1.11,0,0,1,.67-2l17.89,0a1.11,1.11,0,0,1,1.06.8l5,17.19A1.11,1.11,0,0,1,27.21,34.11Z" />\n    <path\n      d="M35.17,16.88,12.31,34.11a1.11,1.11,0,0,1-1.74-1.2l5-17.19a1.11,1.11,0,0,1,1.06-.8l17.89,0A1.11,1.11,0,0,1,35.17,16.88Z" />\n  </svg>\n',l='\n<svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect x="5" y="12.5" width="30" height="15" rx="3" fill="inherit" />\n  <text fill="#676767" font-size="0.8rem" x="20.5" y="20.5" dominant-baseline="middle" text-anchor="middle"></text>\n</svg>\n'},function(t,r){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(o){"object"==typeof window&&(i=window)}t.exports=i},function(t,r,i){"use strict";i.d(r,"a",(function(){return rgbToHex})),i.d(r,"b",(function(){return rgbaToOpacity}));var o=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*((\d|\.)+))?\)$/;function rgbToHex(t){if(-1===t.search("rgb"))return t;var r=t.match(o);return"#".concat(hexValue(r[1])).concat(hexValue(r[2])).concat(hexValue(r[3]))}function rgbaToOpacity(t){return-1===t.search("rgba")?1:parseFloat(t.match(o)[4])}function hexValue(t){return"0".concat(parseInt(t,10).toString(16)).slice(-2)}},function(t,r,i){var o=i(69);t.exports=function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&o(t,r)}},function(t,r,i){"use strict";function createExternallyResolvablePromise(){var t,r;return{promise:new Promise((function(i,o){t=i,r=o})),reject:r,resolve:t}}i.d(r,"a",(function(){return createExternallyResolvablePromise}))},function(t,r){function _defineProperties(t,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}t.exports=function _createClass(t,r,i){return r&&_defineProperties(t.prototype,r),i&&_defineProperties(t,i),t}},function(t,r,i){"use strict";i.r(r),i.d(r,"createRenderer",(function(){return createWebGLRenderer3D})),i.d(r,"createWebGLRenderer3D",(function(){return createWebGLRenderer3D}));var o={};i.r(o),i.d(o,"blinkSquare",(function(){return blinkSquare})),i.d(o,"changeCameraDistance",(function(){return changeCameraDistance})),i.d(o,"hideCustomItem",(function(){return hideCustomItem})),i.d(o,"hideHighlightedSquare",(function(){return hideHighlightedSquare})),i.d(o,"hideHint",(function(){return hideHint})),i.d(o,"movePiece",(function(){return movePiece})),i.d(o,"rotateCamera",(function(){return rotate_camera_rotateCamera})),i.d(o,"showHighlightedSquare",(function(){return showHighlightedSquare})),i.d(o,"showHint",(function(){return showHint}));i(106);var a,l=i(10);function blinkSquare(t,r){var i=r.square,o=r.interval,a=r.times;return t.animator.play({duration:o,easing:l.c,keyframes:{0:{opacity:0},50:{opacity:1},100:{opacity:0}},repeat:a,target:i.obj.material})}function changeCameraDistance(t,r){return new Promise((function(i){t.animator.play({duration:a.Camera.Distance.Duration,keyframes:{0:{distance:t.distance},100:{distance:r}},easing:l.b,onUpdate:function onUpdate(r){t.distance=r.animatedProps.distance},onEnd:function onEnd(){return i()}})}))}function hideCustomItem(t,r){return t.animator.play({data:{itemObj:r.obj},duration:a.CustomItem.Duration,keyframes:{0:{opacity:r.obj.material.opacity,scale:1},100:{opacity:0,scale:2}},onUpdate:onHideCustomItemUpdate})}function onHideCustomItemUpdate(t){var r=t.animatedProps,i=t.data.itemObj,o=r.opacity,a=r.scale;i.scale.x=a,i.scale.y=a,i.scale.z=a,i.material.opacity=o}function hideHighlightedSquare(t,r){return t.animator.play({duration:a.HighlightedSquare.Duration,easing:l.e,keyframes:{0:{opacity:r.obj.material.opacity},100:{opacity:0}},target:r.obj.material})}function hideHint(t,r){return t.animator.play({duration:a.Hint.Duration,easing:l.e,keyframes:{0:{x:1,y:1},100:{x:1e-4,y:1e-4}},target:r.obj.scale})}function movePiece(t,r){var i=r.piece,o=r.from,h=r.to;return t.animator.play({duration:a.PieceMove.Duration,easing:l.e,keyframes:{0:{x:o.x,z:o.y},100:{x:h.x,z:h.y}},target:i.obj.position})}!function(t){!function(t){!function(t){t[t.Duration=700]="Duration"}(t.Rotation||(t.Rotation={})),function(t){t[t.Duration=700]="Duration"}(t.Distance||(t.Distance={}))}(t.Camera||(t.Camera={})),function(t){t.Duration=250}(t.PieceMove||(t.PieceMove={})),function(t){t.Duration=250}(t.CustomItem||(t.CustomItem={})),function(t){t.Duration=150}(t.HighlightedSquare||(t.HighlightedSquare={})),function(t){t.Duration=80}(t.Hint||(t.Hint={}))}(a||(a={}));var h=i(3);function createCameraState(t){var r=function getCameraSettings(){var t=localStorage.getItem("cameraSettings");return(t?JSON.parse(t):null)||{distance:140,horizontalPanning:0,panAngle:0,target:{x:40,y:0,z:40},tiltAngle:100,verticalPanning:-12}}();return{animations:{panning:null,rotation:null},animator:t.animator,camera:new h.PerspectiveCamera(35,1,1,2e3),distance:r.distance,horizontalPanning:r.horizontalPanning,isPanning:!1,isRotating:!1,panAngle:r.panAngle,panAngleFlipped:0,target:new h.Vector3(r.target.x,0,r.target.z),tiltAngle:r.tiltAngle,verticalPanning:r.verticalPanning}}function panCameraHorizontally(t,r){var i=function calculatePanOffset(t){var r=t.cameraPosition,i=t.cameraTarget,o=t.panDistance,a=i.clone().sub(r).clone().cross(h.Object3D.DefaultUp).normalize().clone().multiplyScalar(o);return new h.Vector3(a.x,0,a.z)}({cameraPosition:t.camera.position,cameraTarget:t.target,panDistance:r});t.camera.position.add(i),t.target.add(i),t.horizontalPanning=r}function panCamera(t){var r=t.state,i=t.panH,o=t.panV;panCameraHorizontally(r,i),function panCameraVertically(t,r){t.target.y+=r,t.camera.lookAt(t.target),t.verticalPanning=r}(r,o)}function rotateCamera(t){var r=t.state,i=t.panAngle,o=t.tiltAngle,a=t.animation;return a?a.rotateCamera({panAngle:i,state:r,tiltAngle:o}):new Promise((function(t){var a=Math.min(180,Math.max(0,o)),l=function calculatePositionForCameraRotation(t){var r=t.distance,i=t.target,o=t.panAngle,a=t.tiltAngle,l=r*Math.sin(o*Math.PI/360)*Math.cos(a*Math.PI/360)+i.x,g=r*Math.sin(a*Math.PI/360),y=r*Math.cos(o*Math.PI/360)*Math.cos(a*Math.PI/360)+i.z;return new h.Vector3(l,g,y)}({distance:r.distance,panAngle:i,target:r.target,tiltAngle:a});r.camera.position.copy(l),r.camera.lookAt(r.target),r.panAngle=i,r.tiltAngle=a,t()}))}function saveCameraSettings(t){var r=t.state,i=t.isFlipped,o=t.useDefault,a={distance:r.distance,horizontalPanning:r.horizontalPanning,panAngle:i?r.panAngle-360:r.panAngle,target:{x:r.target.x,y:r.target.y,z:r.target.z},tiltAngle:r.tiltAngle,verticalPanning:r.verticalPanning};o&&(a={distance:140,horizontalPanning:0,panAngle:0,target:{x:r.target.x,y:0,z:r.target.z},tiltAngle:100,verticalPanning:-12}),localStorage.setItem("cameraSettings",JSON.stringify(a))}function rotate_camera_rotateCamera(t){var r=t.state,i=t.panAngle,o=t.tiltAngle;return new Promise((function(t){r.animations.rotation&&(r.animations.rotation.stop(),r.animations.rotation=null),r.animations.rotation=r.animator.play({duration:a.Camera.Rotation.Duration,easing:l.b,keyframes:{0:{pan:r.panAngle,tilt:r.tiltAngle},100:{pan:i,tilt:o}},onUpdate:function onUpdate(t){var i=t.animatedProps;rotateCamera({state:r,panAngle:i.pan,tiltAngle:i.tilt})},onEnd:function onEnd(){r.animations.rotation=null,t()}})}))}function showHighlightedSquare(t,r){return t.animator.play({duration:a.HighlightedSquare.Duration,easing:l.e,keyframes:{0:{opacity:0},100:{opacity:r.obj.material.opacity}},target:r.obj.material})}function showHint(t,r){return t.animator.play({duration:a.Hint.Duration,easing:l.e,keyframes:{0:{x:1e-4,y:1e-4},100:{x:1,y:1}},target:r.obj.scale})}var g=i(16);function createState(t){return Object.assign(Object.assign({},t),{analysisOverlay:null,animation:o,boardModel:null,boardNotationPlane:null,cameraState:createCameraState(t),captureHintGeom:new h.RingGeometry(4.1,5,25,1),customItemGeom:new h.PlaneBufferGeometry(10,10,1,1),groundModel:null,highlightedSquareGeom:new h.PlaneBufferGeometry(10,10,1,1),isBoardFlipping:!1,isPromotionWindowInitialized:!1,lights:{},materials:{},moveHintGeom:new h.CircleGeometry(1.6,16),overlappedPiece:null,piecesGeom:{},pieceStyle:"staunton_executive",promotionHandler:function promotionHandler(){},renderer:new h.WebGLRenderer({alpha:!0,antialias:!0,canvas:t.viewEl}),scene:new h.Scene,shadowMaterials:{},squareSize:10})}function destroy(t){var r,i,o=t.containerEl,a=t.renderer;removeSceneObjects(t.scene),function disposeCachedObjects(t){var r=t.boardModel,i=t.boardNotationPlane,o=t.groundModel,a=t.hoverSquare,l=t.piecesGeom,h=t.highlightedSquareGeom,g=t.moveHintGeom,y=t.captureHintGeom,_=t.customItemGeom;r&&(r.geometry.dispose(),disposeMaterial(r.material));i&&(i.geometry.dispose(),disposeMaterial(i.material));o&&(o.geometry.dispose(),disposeMaterial(o.material));a&&(a.geometry.dispose(),disposeMaterial(a.material));Object.keys(l).forEach((function(t){return l[t].dispose()})),h.dispose(),g.dispose(),y.dispose(),_.dispose()}(t),function disposeCachedMaterials(t){var r=t.materials,i=t.shadowMaterials;Object.keys(r).forEach((function(t){return disposeMaterial(r[t])})),Object.keys(i).forEach((function(t){return disposeMaterial(i[t])}))}(t),a.dispose();var l=o.querySelector(".".concat("promotion-window-3d")),h=o.querySelector(".".concat("statistics-panel"));null===(r=null==l?void 0:l.parentNode)||void 0===r||r.removeChild(l),null===(i=null==h?void 0:h.parentNode)||void 0===i||i.removeChild(h)}function removeSceneObjects(t){for(;t.children.length>0;)removeSceneObjects(t.children[0]),t.remove(t.children[0]);t instanceof h.Mesh&&(t.geometry&&t.geometry.dispose(),t.material&&disposeMaterial(t.material))}function disposeMaterial(t){t instanceof Array?t.forEach((function(t){return disposeMaterial(t)})):(Object.keys(t).forEach((function(r){t[r]&&"function"==typeof t[r].dispose&&t[r].dispose()})),t.dispose())}function fileRankToPosition(t,r){var i=t.squareSize;return{x:i*(r.file-1)+.5*i,y:i*(8-r.rank)+.5*i}}function getBoardPosition(t,r){var i=t.cameraState,o=t.viewEl,a=i.camera,l=new h.Vector3(r.x/o.width*2-1,-r.y/o.height*2+1,1);l.unproject(a);var g=a.position,y=l.y/(l.y-g.y);return{x:l.x+(g.x-l.x)*y,y:l.z+(g.z-l.z)*y}}function getViewPosition(t,r){var i=t.cameraState,o=t.viewEl,a=i.camera,l=new h.Vector3(r.x,0,r.y),g=o.width/2,y=o.height/2;return l.project(a),l.x=l.x*g+g,l.y=-l.y*y+y,{x:l.x,y:l.y}}function create_material_createMaterial(t){var r=t.type,i=t.options,o=t.texture,a=t.textureFlip,l=new(0,h[r]);return i&&Object.assign(l,i),o&&(l.map=o,l.map.flipY=a||!1),l}i(26);function getPieceFromMousePoint(t,r){var i=function worldToSanSquare(t){var r=Math.ceil(t.x/10),i=Math.ceil((80-t.z)/10);return Object(y.a)({file:r,rank:i})}(t);return i?function getPieceFromSanSquare(t,r){return Object.values(r).find((function(r){return r.info.square===t}))||null}(i,r):null}function rotateAroundAxis(t){var r=t.axis,i=t.degrees,o=t.object,a=i*Math.PI/180;o.rotateOnAxis(r,a)}i(14);function textureFromSVG(t){var r=document.createElement("img");r.src="data:image/svg+xml;utf8,".concat(encodeURIComponent(t)),r.width=256,r.height=256;var i=new h.Texture(r);return i.needsUpdate=!0,i}var y=i(24);function addAnalysisOverlay(t){var r=t.scene,i=t.squareSize;if(!t.analysisOverlay){var o=new h.Mesh(new h.PlaneBufferGeometry(88,88,1,1),new h.MeshBasicMaterial({color:16777215,opacity:.2,transparent:!0,depthWrite:!1}));o.position.set(4*i,0,4*i),o.renderOrder=1,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:o}),r.add(o),t.analysisOverlay=o}}var _=i(7);function addEffect(t,r){t.scene.add(r.obj)}var x=i(42),w=i(40);function createEffectObj(t,r){var i=t.squareSize,o=r.position,a=r.type,l=Object(w.a)({path:x.a[a],size:"100%",viewBox:"0 0 19 19"}),g=new h.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:textureFromSVG(l)}),y=.4*i,_=new h.PlaneBufferGeometry(y,y,1,1),S=new h.Mesh(_,g);return S.renderOrder=9,updateEffectPlacement(t,{effectObj:S,position:o}),rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:S}),S}function removeEffect(t,r){t.scene.remove(r.obj)}function updateEffectPlacement(t,r){var i=r.effectObj,o=r.position,a=t.squareSize,l=t.isBoardFlipped,h=.44*a*(l?-1:1);i.position.set(o.x+h,.005,o.y-h),i.scale.x=l?-1:1,i.scale.y=l?-1:1}function flipBoard(t,r){var i=t.isBoardFlipped?360:-360;t.cameraState.panAngleFlipped=t.isBoardFlipping?t.cameraState.panAngleFlipped+i:t.cameraState.panAngle+i,t.isBoardFlipped=r,t.isBoardFlipping=!0,rotateCamera({animation:t.animation,panAngle:t.cameraState.panAngleFlipped,state:t.cameraState,tiltAngle:t.cameraState.tiltAngle}).then((function(){t.isBoardFlipping=!1})),Object.values(t.effects).forEach((function(r){updateEffectPlacement(t,{effectObj:r.obj,position:r.info.position})}))}function removeAnalysisOverlay(t){var r=t.scene;t.analysisOverlay&&r.remove(t.analysisOverlay),t.analysisOverlay=null}function updateBoardCoordinates(t,r){var i=r.position;t.boardNotationPlane&&(t.boardNotationPlane.visible=i!==_.a.CoordinatesPositions.Off)}var S=i(27);function updateBoardStyle(t){return new Promise((function(r){var i=t.boardThemes,o=t.boardStyle,a=new h.TextureLoader,l=i[o][2],g=Object(S.a)("three-d/board/textures/board_".concat(l,".jpg")),y=Object(S.a)("three-d/board/textures/board_".concat(l,"_notation.png"));a.load(g,(function(i){i.flipY=!0,t.materials.board.map=i,a.load(y,(function(i){t.materials.boardNotation.map=i,r()}))}))}))}var M=i(1),T=i.n(M),P=i(2),C=i(31);function getPromotionWindowBaseId(t){return"".concat(t,"_promotionWindow3D")}function getPromotionWindowCloseButtonId(t){return"".concat(getPromotionWindowBaseId(t),"_closeButton")}function getPromotionWindowPiecesContainerId(t,r){return"".concat(getPromotionWindowBaseId(t),"_").concat(Object(C.a)(r))}var A=i(4);function _createForOfIteratorHelper(t,r){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){i&&(t=i);var o=0,a=function F(){};return{s:a,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,h=!0,g=!1;return{s:function s(){i=t[Symbol.iterator]()},n:function n(){var t=i.next();return h=t.done,t},e:function e(t){g=!0,l=t},f:function f(){try{h||null==i.return||i.return()}finally{if(g)throw l}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var i=0,o=new Array(r);i<r;i++)o[i]=t[i];return o}function createPromotionWindow(t){if(t.promotionWindowEl=document.createElement("div"),t.promotionWindowEl.className="promotion-window-3d",t.promotionWindowEl.innerHTML=function getPromotionWindowHtml(t){return"\n    ".concat(getPromotionPiecesContainerHtml(t,P.a.ColorsAsNumbers.White),"\n    ").concat(getPromotionPiecesContainerHtml(t,P.a.ColorsAsNumbers.Black),'\n    <i\n      id="').concat(getPromotionWindowCloseButtonId(t.boardId),'"\n      class="close-button icon-font-chess x"></i>\n  ')}(t),t.options.test){Object(A.c)(t.promotionWindowEl,T()({},A.b.Element,A.a.PromotionWindow)),Object(A.c)(t.promotionWindowEl.getElementsByClassName("close-button")[0],T()({},A.b.Element,A.a.PromotionCloseButton));var r,i=_createForOfIteratorHelper(t.promotionWindowEl.getElementsByClassName("promotion-piece"));try{for(i.s();!(r=i.n()).done;){var o,a=r.value;Object(A.c)(a,(o={},T()(o,A.b.Element,A.a.PromotionPiece),T()(o,A.b.Type,a.getAttribute("data-pieceType")),o))}}catch(l){i.e(l)}finally{i.f()}}t.containerEl.appendChild(t.promotionWindowEl)}function getPromotionPiecesContainerHtml(t,r){var i="".concat(getPromotionWindowPiecesContainerId(t.boardId,r)),o='<div id="'.concat(i,'" style="display: none;">');return[{name:"queen",type:"q"},{name:"knight",type:"n"},{name:"rook",type:"r"},{name:"bishop",type:"b"}].forEach((function(i){o+=function getPromotionPieceHtml(t){var r=t.color,i=t.piece,o=t.pieceStyle,a=Object(C.a)(r),l=Object(S.a)("three-d/pieces/".concat(o,"/").concat(i.name,"_promotion_").concat(a,".jpg"));return'<img class="promotion-piece" data-pieceType="'.concat(i.type,'" src="').concat(l,'" />')}({color:r,piece:i,pieceStyle:t.pieceStyle})})),o+="</div>"}function init(t){t.renderer.setPixelRatio(g.a.PixelRatio),t.scene.add(t.cameraState.camera),function initCamera(t){var r=t.state;t.isFlipped&&(r.panAngle+=360),rotateCamera({panAngle:r.panAngle,state:r,tiltAngle:r.tiltAngle}),panCamera({panH:r.horizontalPanning,panV:r.verticalPanning,state:r})}({isFlipped:t.isBoardFlipped,state:t.cameraState}),function createLights(t){t.lights.topLight=new h.PointLight,t.lights.topLight.intensity=.65,t.lights.topLight.position.set(40,150,40),t.lights.whiteSideLight=new h.DirectionalLight,t.lights.whiteSideLight.intensity=.45,t.lights.whiteSideLight.position.set(40,100,240),t.lights.whiteSideLight.target.position.set(40,0,40),t.lights.blackSideLight=new h.DirectionalLight,t.lights.blackSideLight.intensity=.45,t.lights.blackSideLight.position.set(40,100,-160),t.lights.blackSideLight.target.position.set(40,0,40),t.lights.movingLight=new h.PointLight(16379337),t.lights.movingLight.position.set(0,10,0),t.lights.movingLight.intensity=.25,t.lights.movingLight.distance=500,t.scene.add(t.lights.topLight),t.scene.add(t.lights.whiteSideLight),t.scene.add(t.lights.blackSideLight),t.scene.add(t.lights.movingLight)}(t),function createBoardNotationPlane(t){var r=new h.PlaneBufferGeometry(88,88,1,1);t.boardNotationPlane=new h.Mesh(r),t.boardNotationPlane.position.set(40,0,40),t.boardNotationPlane.renderOrder=2,t.options.coordinates===_.a.CoordinatesPositions.Off&&(t.boardNotationPlane.visible=!1),rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:t.boardNotationPlane}),t.scene.add(t.boardNotationPlane)}(t),function createGroundPlane(t){t.groundModel=new h.Mesh(new h.PlaneBufferGeometry(110,110,1,1)),t.groundModel.position.set(40,-2,40),rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:t.groundModel}),t.scene.add(t.groundModel)}(t),createPromotionWindow(t)}function normalizePointer(t,r){return r.x*=g.a.PixelRatio,r.y*=g.a.PixelRatio,r}function positionToFileRank(t,r){var i=t.squareSize;return{file:Math.ceil(r.x/i),rank:Math.ceil((8*i-r.y)/i)}}var O,L,I=i(29);function positionToNearestSquare(t,r){var i=.01,o=8*t.squareSize;return{x:Object(I.a)(r.x,{min:i,max:o-i}),y:Object(I.a)(r.y,{min:i,max:o-i})}}function render(t){t.lights.movingLight.position.x=t.cameraState.camera.position.x,t.lights.movingLight.position.z=t.cameraState.camera.position.z,t.renderer.render(t.scene,t.cameraState.camera)}function updateViewSize(t,r){var i=r.height,o=r.width,a=t.cameraState,l=t.renderer;a.camera.aspect=o/i,a.camera.updateProjectionMatrix(),l.setSize(o,i)}function createMaterials(t,r){Object.assign(t.materials,function createBoardMaterials(t){return{board:create_material_createMaterial({texture:t.board,textureFlip:!0,type:L.Type.Lambert}),boardNotation:create_material_createMaterial({options:{transparent:!0,depthWrite:!1},texture:t.boardNotation,textureFlip:!0,type:L.Type.Lambert}),squareOver:create_material_createMaterial({options:{color:new h.Color(16777215)},type:L.Type.Lambert}),squareSelected:create_material_createMaterial({options:{color:new h.Color(1534597),opacity:.6,transparent:!0},type:L.Type.Lambert})}}(r)),Object.assign(t.materials,function createPieceMaterials(t){return{blackPiece:create_material_createMaterial({options:{shininess:50},texture:t.pieceBlack,type:L.Type.Phong}),blackPieceCaptured:create_material_createMaterial({options:{transparent:!0},texture:t.pieceBlack,type:L.Type.Phong}),blackPieceOverlapped:create_material_createMaterial({options:{opacity:.5,transparent:!0},texture:t.pieceBlack,type:L.Type.Phong}),whitePiece:create_material_createMaterial({options:{shininess:50},texture:t.pieceWhite,type:L.Type.Phong}),whitePieceCaptured:create_material_createMaterial({options:{transparent:!0},texture:t.pieceWhite,type:L.Type.Phong}),whitePieceOverlapped:create_material_createMaterial({options:{opacity:.5,transparent:!0},texture:t.pieceWhite,type:L.Type.Phong})}}(r)),Object.assign(t.shadowMaterials,function createShadowMaterials(t){return{bishop:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.bishopShadow,type:L.Type.Basic}),ground:create_material_createMaterial({options:{transparent:!0},texture:t.boardShadow,type:L.Type.Basic}),king:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.kingShadow,type:L.Type.Basic}),knight:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.knightShadow,type:L.Type.Basic}),pawn:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.pawnShadow,type:L.Type.Basic}),queen:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.queenShadow,type:L.Type.Basic}),rook:create_material_createMaterial({options:{depthWrite:!1,transparent:!0},texture:t.rookShadow,type:L.Type.Basic})}}(r))}!function(t){t[t.Board=0]="Board",t[t.Piece=1]="Piece"}(O||(O={})),function(t){!function(t){t.Basic="MeshBasicMaterial",t.Lambert="MeshLambertMaterial",t.Phong="MeshPhongMaterial"}(t.Type||(t.Type={}))}(L||(L={}));var R=function(){function LegacyJSONLoader(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),h.Loader.call(this,t),this.withCredentials=!1}return LegacyJSONLoader.prototype=Object.assign(Object.create(h.Loader.prototype),{constructor:LegacyJSONLoader,load:function load(t,r,i,o){var a=this,l=""===this.path?h.LoaderUtils.extractUrlBase(t):this.path,g=new h.FileLoader(this.manager);g.setPath(this.path),g.setWithCredentials(this.withCredentials),g.load(t,(function(i){var o=JSON.parse(i),h=o.metadata;if(void 0!==h){var g=h.type;if(void 0!==g&&"object"===g.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.")}var y=a.parse(o,l);r(y.geometry,y.materials)}),i,o)},parse:function(){var t={NoBlending:h.NoBlending,NormalBlending:h.NormalBlending,AdditiveBlending:h.AdditiveBlending,SubtractiveBlending:h.SubtractiveBlending,MultiplyBlending:h.MultiplyBlending,CustomBlending:h.CustomBlending},r=new h.Color,i=new h.TextureLoader,o=new h.MaterialLoader;function createMaterial(i,a,l,g){var y={},_={uuid:h.Math.generateUUID(),type:"MeshLambertMaterial"};for(var x in i){var w=i[x];switch(x){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":_.name=w;break;case"blending":_.blending=t[w];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.LegacyJSONLoader.createMaterial:",x,"is no longer supported.");break;case"colorDiffuse":_.color=r.fromArray(w).getHex();break;case"colorSpecular":_.specular=r.fromArray(w).getHex();break;case"colorEmissive":_.emissive=r.fromArray(w).getHex();break;case"specularCoef":_.shininess=w;break;case"shading":"basic"===w.toLowerCase()&&(_.type="MeshBasicMaterial"),"phong"===w.toLowerCase()&&(_.type="MeshPhongMaterial"),"standard"===w.toLowerCase()&&(_.type="MeshStandardMaterial");break;case"mapDiffuse":_.map=loadTexture(w,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy,y,a,l,g);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":_.emissiveMap=loadTexture(w,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy,y,a,l,g);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":_.lightMap=loadTexture(w,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy,y,a,l,g);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":_.aoMap=loadTexture(w,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy,y,a,l,g);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":_.bumpMap=loadTexture(w,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy,y,a,l,g);break;case"mapBumpScale":_.bumpScale=w;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":_.normalMap=loadTexture(w,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy,y,a,l,g);break;case"mapNormalFactor":_.normalScale=w;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":_.specularMap=loadTexture(w,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy,y,a,l,g);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":_.metalnessMap=loadTexture(w,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy,y,a,l,g);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":_.roughnessMap=loadTexture(w,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy,y,a,l,g);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":_.alphaMap=loadTexture(w,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy,y,a,l,g);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":_.side=h.BackSide;break;case"doubleSided":_.side=h.DoubleSide;break;case"transparency":console.warn("THREE.LegacyJSONLoader.createMaterial: transparency has been renamed to opacity"),_.opacity=w;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":_[x]=w;break;case"vertexColors":!0===w&&(_.vertexColors=h.VertexColors),"face"===w&&(_.vertexColors=h.FaceColors);break;default:console.error("THREE.LegacyJSONLoader.createMaterial: Unsupported",x,w)}}return"MeshBasicMaterial"===_.type&&delete _.emissive,"MeshPhongMaterial"!==_.type&&delete _.specular,_.opacity<1&&(_.transparent=!0),o.setTextures(y),o.parse(_)}function loadTexture(t,r,o,a,l,g,y,_,x){var w,S=y+t,M=x.getHandler(S);null!==M?w=M.load(S):(i.setCrossOrigin(_),w=i.load(S)),void 0!==r&&(w.repeat.fromArray(r),1!==r[0]&&(w.wrapS=h.RepeatWrapping),1!==r[1]&&(w.wrapT=h.RepeatWrapping)),void 0!==o&&w.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(w.wrapS=h.RepeatWrapping),"mirror"===a[0]&&(w.wrapS=h.MirroredRepeatWrapping),"repeat"===a[1]&&(w.wrapT=h.RepeatWrapping),"mirror"===a[1]&&(w.wrapT=h.MirroredRepeatWrapping)),void 0!==l&&(w.anisotropy=l);var T=h.Math.generateUUID();return g[T]=w,T}return function parse(t,r){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var i=new h.Geometry;return function parseModel(t,r){function isBitSet(t,r){return t&1<<r}var i,o,a,l,g,y,_,x,w,S,M,T,P,C,A,O,L,I,R,j,N,k,D,B,G,H,V,U=t.faces,z=t.vertices,W=t.normals,q=t.colors,$=t.scale,X=0;if(void 0!==t.uvs){for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&X++;for(i=0;i<X;i++)r.faceVertexUvs[i]=[]}for(l=0,g=z.length;l<g;)(I=new h.Vector3).x=z[l++]*$,I.y=z[l++]*$,I.z=z[l++]*$,r.vertices.push(I);for(l=0,g=U.length;l<g;)if(M=isBitSet(S=U[l++],0),T=isBitSet(S,1),P=isBitSet(S,3),C=isBitSet(S,4),A=isBitSet(S,5),O=isBitSet(S,6),L=isBitSet(S,7),M){if((j=new h.Face3).a=U[l],j.b=U[l+1],j.c=U[l+3],(N=new h.Face3).a=U[l+1],N.b=U[l+2],N.c=U[l+3],l+=4,T&&(w=U[l++],j.materialIndex=w,N.materialIndex=w),a=r.faces.length,P)for(i=0;i<X;i++)for(B=t.uvs[i],r.faceVertexUvs[i][a]=[],r.faceVertexUvs[i][a+1]=[],o=0;o<4;o++)H=B[2*(x=U[l++])],V=B[2*x+1],G=new h.Vector2(H,V),2!==o&&r.faceVertexUvs[i][a].push(G),0!==o&&r.faceVertexUvs[i][a+1].push(G);if(C&&(_=3*U[l++],j.normal.set(W[_++],W[_++],W[_]),N.normal.copy(j.normal)),A)for(i=0;i<4;i++)_=3*U[l++],D=new h.Vector3(W[_++],W[_++],W[_]),2!==i&&j.vertexNormals.push(D),0!==i&&N.vertexNormals.push(D);if(O&&(k=q[y=U[l++]],j.color.setHex(k),N.color.setHex(k)),L)for(i=0;i<4;i++)k=q[y=U[l++]],2!==i&&j.vertexColors.push(new h.Color(k)),0!==i&&N.vertexColors.push(new h.Color(k));r.faces.push(j),r.faces.push(N)}else{if((R=new h.Face3).a=U[l++],R.b=U[l++],R.c=U[l++],T&&(w=U[l++],R.materialIndex=w),a=r.faces.length,P)for(i=0;i<X;i++)for(B=t.uvs[i],r.faceVertexUvs[i][a]=[],o=0;o<3;o++)H=B[2*(x=U[l++])],V=B[2*x+1],G=new h.Vector2(H,V),r.faceVertexUvs[i][a].push(G);if(C&&(_=3*U[l++],R.normal.set(W[_++],W[_++],W[_])),A)for(i=0;i<3;i++)_=3*U[l++],D=new h.Vector3(W[_++],W[_++],W[_]),R.vertexNormals.push(D);if(O&&(y=U[l++],R.color.setHex(q[y])),L)for(i=0;i<3;i++)y=U[l++],R.vertexColors.push(new h.Color(q[y]));r.faces.push(R)}}(t,i),function parseSkin(t,r){var i=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var o=0,a=t.skinWeights.length;o<a;o+=i){var l=t.skinWeights[o],g=i>1?t.skinWeights[o+1]:0,y=i>2?t.skinWeights[o+2]:0,_=i>3?t.skinWeights[o+3]:0;r.skinWeights.push(new h.Vector4(l,g,y,_))}if(t.skinIndices)for(o=0,a=t.skinIndices.length;o<a;o+=i){var x=t.skinIndices[o],w=i>1?t.skinIndices[o+1]:0,S=i>2?t.skinIndices[o+2]:0,M=i>3?t.skinIndices[o+3]:0;r.skinIndices.push(new h.Vector4(x,w,S,M))}r.bones=t.bones,r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}(t,i),function parseMorphing(t,r){var i=t.scale;if(void 0!==t.morphTargets)for(var o=0,a=t.morphTargets.length;o<a;o++){r.morphTargets[o]={},r.morphTargets[o].name=t.morphTargets[o].name,r.morphTargets[o].vertices=[];for(var l=r.morphTargets[o].vertices,g=t.morphTargets[o].vertices,y=0,_=g.length;y<_;y+=3){var x=new h.Vector3;x.x=g[y]*i,x.y=g[y+1]*i,x.z=g[y+2]*i,l.push(x)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var w=r.faces,S=t.morphColors[0].colors;for(o=0,a=w.length;o<a;o++)w[o].color.fromArray(S,3*o)}}(t,i),function parseAnimations(t,r){var i=[],o=[];void 0!==t.animation&&o.push(t.animation),void 0!==t.animations&&(t.animations.length?o=o.concat(t.animations):o.push(t.animations));for(var a=0;a<o.length;a++){var l=h.AnimationClip.parseAnimation(o[a],r.bones);l&&i.push(l)}if(r.morphTargets){var g=h.AnimationClip.CreateClipsFromMorphTargetSequences(r.morphTargets,10);i=i.concat(g)}i.length>0&&(r.animations=i)}(t,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:i}:{geometry:i,materials:function initMaterials(t,r,i,o){for(var a=[],l=0;l<t.length;++l)a[l]=createMaterial(t[l],r,i,o);return a}(t.materials,this.resourcePath||r,this.crossOrigin,this.manager)}}}()}),LegacyJSONLoader}();function loadObjects(t){return new Promise((function(r){var i=0,o=function getObjectsToLoad(t){return[{name:"board",type:O.Board,url:"board/board.json"},{name:"king",type:O.Piece,url:"pieces/".concat(t,"/king.json")},{name:"queen",type:O.Piece,url:"pieces/".concat(t,"/queen.json")},{name:"rook",type:O.Piece,url:"pieces/".concat(t,"/rook.json")},{name:"bishop",type:O.Piece,url:"pieces/".concat(t,"/bishop.json")},{name:"knight",type:O.Piece,url:"pieces/".concat(t,"/knight.json")},{name:"pawn",type:O.Piece,url:"pieces/".concat(t,"/pawn.json")}]}(t.pieceStyle);o.forEach((function(a){var l=new R,g=Object(S.a)("three-d/".concat(a.url));l.load(g,(function(l){t.destroyed||(i+=1,a.type===O.Board?(t.boardModel=new h.Mesh(l,t.materials.board),t.boardModel.position.x=40,t.boardModel.position.z=40,t.lights.whiteSideLight.target=t.boardModel,t.lights.blackSideLight.target=t.boardModel,t.scene.add(t.boardModel)):a.type===O.Piece&&(t.piecesGeom[a.name]=l),i===o.length&&r())}))}))}))}function loadAssets(t){return new Promise((function(r){(function loadTextures(t){var r=t.boardThemes,i=t.boardStyle,o={},a=function getTexturesToLoad(t,r){return[{name:"board",url:"board/textures/board_".concat(t,".jpg")},{name:"boardNotation",url:"board/textures/board_".concat(t,"_notation.png")},{name:"pieceWhite",url:"pieces/".concat(r,"/textures/piece_white.jpg")},{name:"pieceBlack",url:"pieces/".concat(r,"/textures/piece_black.jpg")},{name:"boardShadow",url:"board/textures/board_shadow.png"},{name:"kingShadow",url:"pieces/".concat(r,"/textures/king_shadow.png")},{name:"queenShadow",url:"pieces/".concat(r,"/textures/queen_shadow.png")},{name:"rookShadow",url:"pieces/".concat(r,"/textures/rook_shadow.png")},{name:"bishopShadow",url:"pieces/".concat(r,"/textures/bishop_shadow.png")},{name:"knightShadow",url:"pieces/".concat(r,"/textures/knight_shadow.png")},{name:"pawnShadow",url:"pieces/".concat(r,"/textures/pawn_shadow.png")}]}(r[i][2],t.pieceStyle),l=new h.TextureLoader,g=[];return a.forEach((function(t){g.push(new Promise((function(r){o[t.name]=l.load(Object(S.a)("three-d/".concat(t.url)),r)})))})),new Promise((function(t){return Promise.all(g).then((function(){t(o)}))}))})(t).then((function(i){t.destroyed||(createMaterials(t,i),t.boardNotationPlane.material=t.materials.boardNotation,t.groundModel.material=t.shadowMaterials.ground,t.hoverSquare.material=t.materials.squareOver,loadObjects(t).then((function(){r()})))}))}))}function addPiece(t,r){t.scene.add(r.obj)}function createPieceObj(){var t=new h.Object3D,r=new h.Mesh,i=function createPieceShadow(){var t=new h.Mesh(new h.PlaneBufferGeometry(10,10,1,1));return rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:t}),t.renderOrder=7,t}();return t.add(r),t.add(i),t}function fadeInAllPieces(t,r){var i=t.animator,o=t.materials,a=t.shadowMaterials,l=o.whitePiece.transparent,h=o.blackPiece.transparent;return o.whitePiece.transparent=!0,o.blackPiece.transparent=!0,i.play({duration:r,keyframes:{0:{whitePieceOpacity:0,blackPieceOpacity:0,bishopShadowOpacity:0,kingShadowOpacity:0,knightShadowOpacity:0,pawnShadowOpacity:0,queenShadowOpacity:0,rookShadowOpacity:0},100:{whitePieceOpacity:o.whitePiece.opacity,blackPieceOpacity:o.blackPiece.opacity,bishopShadowOpacity:a.bishop.opacity,kingShadowOpacity:a.king.opacity,knightShadowOpacity:a.knight.opacity,pawnShadowOpacity:a.pawn.opacity,queenShadowOpacity:a.queen.opacity,rookShadowOpacity:a.rook.opacity}},onUpdate:function onUpdate(t){var r=t.animatedProps;o.whitePiece.opacity=r.whitePieceOpacity,o.blackPiece.opacity=r.blackPieceOpacity,a.bishop.opacity=r.bishopShadowOpacity,a.king.opacity=r.kingShadowOpacity,a.knight.opacity=r.knightShadowOpacity,a.pawn.opacity=r.pawnShadowOpacity,a.queen.opacity=r.queenShadowOpacity,a.rook.opacity=r.rookShadowOpacity},onEnd:function onEnd(){o.whitePiece.transparent=l,o.blackPiece.transparent=h}})}var j=i(22);function findPieceFromPosition(t,r){var i=positionToFileRank(t,r);return Object(j.e)(t,i)}function fadePiece(t){var r=t.materials,i=t.piece,o=t.shouldFade,a=i.obj.children[0];i.obj.children[1].visible=!o,o?i.info.color===P.a.ColorsAsNumbers.White?a.material=r.whitePieceOverlapped:a.material=r.blackPieceOverlapped:a.material===r.whitePieceOverlapped?a.material=r.whitePiece:a.material===r.blackPieceOverlapped&&(a.material=r.blackPiece)}function onPieceDrag(t,r){r.obj.children.length&&(r.obj.children[0].position.y=1),function fadeOverlappedPiece(t,r){t.overlappedPiece&&fadePiece({materials:t.materials,piece:t.overlappedPiece,shouldFade:!1});t.overlappedPiece=getPieceFromMousePoint(r.obj.position,t.pieces),t.overlappedPiece&&t.selectedPiece&&t.overlappedPiece.obj!==t.selectedPiece.obj&&fadePiece({materials:t.materials,piece:t.overlappedPiece,shouldFade:!0})}(t,r)}function onPieceDrop(t,r){r.obj.children.length&&(r.obj.children[0].position.y=0),function resetOverlappedPieceFade(t){if(!t.overlappedPiece)return;fadePiece({materials:t.materials,piece:t.overlappedPiece,shouldFade:!1}),t.overlappedPiece=null}(t)}function removePiece(t,r){t.scene.remove(r.obj)}function setPiecePosition(t,r){t.obj.position.x=r.x,t.obj.position.z=r.y,t.obj.position.y=.01}function updatePiecesStyle(t){return t.pieceStyle="staunton_executive",new Promise((function(t){return t()}))}function updatePieceVisuals(t,r){var i=t.piecesGeom,o=t.materials,a=t.shadowMaterials,l=r.obj.children[0],g=r.obj.children[1];l.geometry=i[P.a.Piece.Names[r.info.type]],l.material=r.info.color===P.a.ColorsAsNumbers.White?o.whitePiece:o.blackPiece,g.material=a[P.a.Piece.Names[r.info.type]],r.info.type===P.a.Piece.Types.Knight?l.rotation.y=h.MathUtils.degToRad(r.info.color===P.a.ColorsAsNumbers.Black?90:-90):l.rotation.y=0}function addArrow(t,r){t.scene.add(r.obj)}var N=i(18),k=i(35),D=i(49),B=i(48),G=i(50);function createArrowObj(t,r){var i=r.color,o=r.opacity,a=r.isKnight,l=fileRankToPosition(t,r.from),g=fileRankToPosition(t,r.to),y=Object(k.a)({from:l,to:g}),_=Object(B.a)({from:l,to:g}),x=N.c.includes(_)?-1:1,w=a?Object(G.a)({from:l,slope:_,to:g}):Object(D.a)({from:l,to:g}),S=function getShape(t,r){var i=10,o=8*i,a=o*N.b.WIDTH*.01*.5,l=o*N.b.HEAD_HEIGHT*.01,g=o*N.b.HEAD_WIDTH*.01*.5,y=o*N.b.TAIL_PADDING*.01,_=new h.Shape;r?_.moveTo(-a,-y).lineTo(a,-y).lineTo(a,a-2*i).lineTo(i-l,a-2*i).lineTo(i-l,g-2*i).lineTo(i,2*-i).lineTo(i-l,-(2*i+g)).lineTo(i-l,-(2*i+a)).lineTo(-a,-(2*i+a)):_.moveTo(a,-y).lineTo(-a,-y).lineTo(-a,-t+l).lineTo(-g,-t+l).lineTo(0,-t).lineTo(g,-t+l).lineTo(a,-t+l);return _}(y,a),M=new h.ShapeGeometry(S),T=new h.Mesh(M,new h.MeshLambertMaterial({color:new h.Color(i),depthTest:!1,depthWrite:!1,opacity:o,transparent:!0}));return T.position.x=l.x,T.position.y=.005,T.position.z=l.y,T.scale.x*=x,T.renderOrder=8,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:T}),rotateAroundAxis({axis:new h.Vector3(0,0,1),degrees:-w,object:T}),T}function removeArrow(t,r){t.scene.remove(r.obj),r.obj.geometry.dispose()}function addHighlightedSquare(t,r){t.scene.add(r.obj)}function createHighlightedSquareObj(t,r){var i=t.highlightedSquareGeom,o=r.color,a=r.opacity,l=r.position,g=new h.MeshBasicMaterial({color:o,opacity:a});g.transparent=!0,g.depthWrite=!1;var y=new h.Mesh(i,g);return rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:y}),y.renderOrder=4,y.position.set(l.x,.005,l.y),y}function createHoverSquareObj(t){var r=new h.Shape,i=new h.Path,o=4.5;r.moveTo(-5,-5),r.lineTo(5,-5),r.lineTo(5,5),r.lineTo(-5,5),r.lineTo(-5,-5),i.moveTo(-4.5,-4.5),i.lineTo(o,-4.5),i.lineTo(o,o),i.lineTo(-4.5,o),i.lineTo(-4.5,-4.5),r.holes.push(i);var a=new h.Mesh(new h.ShapeGeometry(r));return a.position.set(10,-.2,10),a.renderOrder=3,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:a}),t.scene.add(a),a}function hideHoverSquare(t){var r=t.hoverSquare;r&&(r.position.x=10,r.position.y=-.2,r.position.z=10)}function removeHighlightedSquare(t,r){t.scene.remove(r.obj)}function showHoverSquare(t,r){var i=t.hoverSquare;i&&(i.position.x=r.x,i.position.y=.005,i.position.z=r.y)}function addHint(t,r){t.scene.add(r.obj)}function createCaptureHintObj(t,r){var i=t.captureHintGeom,o=r.color,a=r.opacity,l=r.position,g=new h.MeshBasicMaterial({color:o,opacity:a});g.transparent=!0,g.depthWrite=!1;var y=new h.Mesh(i,g);return y.renderOrder=5,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:y}),y.position.set(l.x,.005,l.y),y}function createMoveHintObj(t,r){var i=t.moveHintGeom,o=r.color,a=r.opacity,l=r.position,g=new h.MeshBasicMaterial({color:o,opacity:a});g.transparent=!0,g.depthWrite=!1;var y=new h.Mesh(i,g);return y.renderOrder=5,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:y}),y.position.set(l.x,.005,l.y),y}function removeHint(t,r){t.scene.remove(r.obj)}var H=i(8),V=i(9);function closePromotionWindow(t){if(!t.promotionWindowEl)throw new H.a({code:V.a.ElementNotFound,message:"Promotion window does not exist."});t.promotionWindowEl.style.display="none"}var U=i(5);function openPromotionWindow(t,r){if(!t.promotionWindowEl)throw new H.a({code:V.a.ElementNotFound,message:"Promotion window does not exist."});t.isPromotionWindowInitialized||function initPromotionWindow(t){var r=document.getElementById("".concat(getPromotionWindowCloseButtonId(t.boardId)));if(!t.promotionWindowEl)throw new H.a({code:V.a.ElementNotFound,message:"Promotion window does not exist."});if(!r)throw new H.a({code:V.a.ElementNotFound,message:"Promotion window close button does not exist."});t.promotionWindowEl.addEventListener(U.b,(function(r){r.preventDefault(),r.stopPropagation();var i=r.target.getAttribute("data-pieceType");return i&&t.promotionHandler(i),!1})),r.addEventListener(U.b,(function(r){return r.preventDefault(),r.stopPropagation(),t.promotionHandler(),!1})),t.isPromotionWindowInitialized=!0}(t);var i=document.getElementById("".concat(getPromotionWindowPiecesContainerId(t.boardId,P.a.ColorsAsNumbers.White))),o=document.getElementById("".concat(getPromotionWindowPiecesContainerId(t.boardId,P.a.ColorsAsNumbers.Black)));if(!i)throw new H.a({code:V.a.ElementNotFound,message:"White pieces container for promotion window does not exist."});if(!o)throw new H.a({code:V.a.ElementNotFound,message:"Black pieces container for promotion window does not exist."});return r.color===P.a.ColorsAsNumbers.White?(o.style.display="none",i.style.display="block"):(o.style.display="block",i.style.display="none"),t.promotionWindowEl.style.display="block",new Promise((function(r){return t.promotionHandler=r}))}function onMouseDoubleClick(t){var r=t.animation,i=t.cameraState,o=t.isPromotionWindowVisible,a=t.options,l=t.pointer;!a.enabled||o||l.insideBoard||function resetCamera(t){var r=t.state,i=t.isFlipped,o=t.animation;r.horizontalPanning=0,r.verticalPanning=-12,r.target.x=40,r.target.z=40,r.target.y=-12,rotateCamera(i?{animation:o,panAngle:360,state:r,tiltAngle:100}:{animation:o,panAngle:0,state:r,tiltAngle:100}),o?o.changeCameraDistance(r,140):r.distance=140,saveCameraSettings({isFlipped:i,state:r,useDefault:!0})}({animation:r,isFlipped:a.flipped,state:i})}function onMouseWheel(t,r){var i=t.cameraState,o=t.isPromotionWindowVisible,a=t.options;if(!o){if(r>0){if(i.distance>500)return;i.distance+=5}else{if(i.distance<50)return;i.distance-=5}rotateCamera({panAngle:i.panAngle,state:i,tiltAngle:i.tiltAngle}),saveCameraSettings({isFlipped:a.flipped,state:i})}}function onPointerDown(t){var r=t.containerEl,i=t.isPromotionWindowVisible,o=t.pointer;i||findPieceFromPosition(t,o.boardPosition)&&r.classList.add("piece-dragging")}function onPointerMove(t){var r=t.containerEl,i=t.isPromotionWindowVisible,o=t.pointer,a=t.selectedPiece;i||(!function doCameraManipulation(t){var r=t.pointer;if(!r.down||r.downInsideBoard)return;r.rightDown?function doCameraRotation(t){var r=t.cameraState,i=t.pointer,o=i.viewPosition,a=i.previousViewPosition,l=r.panAngle-.6*(o.x-a.x),h=r.tiltAngle+.6*(o.y-a.y);rotateCamera({panAngle:l,state:r,tiltAngle:h}),r.isRotating=!0}(t):r.secondaryDown&&function doCameraPan(t){var r=t.cameraState,i=t.pointer,o=i.viewPosition,a=i.previousViewPosition,l=.1*(o.x-a.x)*-1,h=.1*(o.y-a.y);panCamera({panH:l,panV:h,state:r}),r.isPanning=!0}(t)}(t),!a&&findPieceFromPosition(t,o.boardPosition)?r.classList.add("piece-hover"):a||r.classList.remove("piece-hover"))}function onPointerUp(t){var r=t.cameraState,i=t.containerEl,o=t.isPromotionWindowVisible,a=t.options;a.enabled&&!o&&((r.isRotating||r.isPanning)&&(r.isRotating=!1,r.isPanning=!1,saveCameraSettings({isFlipped:a.flipped,state:r})),i.classList.remove("piece-dragging"))}var z=i(20);function addCustomItem(t,r){t.scene.add(r.obj)}var W=i(53),q=i(15);function createCustomItemObj(t,r){var i,o=t.customItemGeom,a=r.position,l=r.type,g=r.image,y=r.opacity,_=1;if(g)i=(new h.TextureLoader).load(g.url),g.percentOfSquare&&(_=.01*g.percentOfSquare);else{var x=Object(q.d)(W[l],r);if(i=textureFromSVG(x),t.options.test){var w=document.createElement("div");w.innerHTML=x,r.testSVG=w.querySelector("svg")}}var S=new h.MeshBasicMaterial({opacity:g&&y?y:.8,depthWrite:!1,depthTest:l!==P.a.Node.Marking.CustomItem.Types.TextBox,transparent:!0,map:i}),M=new h.Mesh(o,S);return M.scale.x*=_,M.scale.y*=_,M.position.set(a.x,.005,a.y),M.renderOrder=6,rotateAroundAxis({axis:new h.Vector3(1,0,0),degrees:-90,object:M}),M}function removeCustomItem(t,r){t.scene.remove(r.obj)}function createWebGLRenderer3D(t){var r=t.el,i=t.options,a=t.boardStyles,l=void 0===a?z.a:a,h=t.pieceStyles,y=void 0===h?z.b:h,_=t.testElement,x={animationMethods:o,boardThemes:l,pieceThemes:y,className:"board-webgl-3d",containerEl:r,methods:{addAnalysisOverlay:addAnalysisOverlay,addArrow:addArrow,addCustomItem:addCustomItem,addEffect:addEffect,addHighlightedSquare:addHighlightedSquare,addHint:addHint,addPiece:addPiece,closePromotionWindow:closePromotionWindow,createArrowObj:createArrowObj,createCaptureHintObj:createCaptureHintObj,createCustomItemObj:createCustomItemObj,createEffectObj:createEffectObj,createHighlightedSquareObj:createHighlightedSquareObj,createHoverSquareObj:createHoverSquareObj,createMoveHintObj:createMoveHintObj,createPieceObj:createPieceObj,createState:createState,destroy:destroy,fadeInAllPieces:fadeInAllPieces,fileRankToPosition:fileRankToPosition,flipBoard:flipBoard,getBoardPosition:getBoardPosition,getViewPosition:getViewPosition,hideHoverSquare:hideHoverSquare,init:init,loadAssets:loadAssets,normalizePointer:normalizePointer,onMouseDoubleClick:onMouseDoubleClick,onMouseWheel:onMouseWheel,onPieceDrag:onPieceDrag,onPieceDrop:onPieceDrop,onPointerDown:onPointerDown,onPointerMove:onPointerMove,onPointerUp:onPointerUp,openPromotionWindow:openPromotionWindow,positionToFileRank:positionToFileRank,positionToNearestSquare:positionToNearestSquare,removeAnalysisOverlay:removeAnalysisOverlay,removeArrow:removeArrow,removeCustomItem:removeCustomItem,removeEffect:removeEffect,removeHighlightedSquare:removeHighlightedSquare,removeHint:removeHint,removePiece:removePiece,render:render,setPiecePosition:setPiecePosition,showHoverSquare:showHoverSquare,updateBoardCoordinates:updateBoardCoordinates,updateBoardStyle:updateBoardStyle,updatePiecesStyle:updatePiecesStyle,updatePieceVisuals:updatePieceVisuals,updateViewSize:updateViewSize},name:"webgl-3d",options:i,testElement:_};return Object(g.b)(x)}},function(t,r,i){"use strict";i.r(r),i.d(r,"createRenderer",(function(){return createDefaultRenderer}));i(102);var o=i(43);i(103);i(104);var a=i(12),l=i(35),h=i(48),g={a1:{x:6.25,y:93.75},a2:{x:6.25,y:81.25},a3:{x:6.25,y:68.75},a4:{x:6.25,y:56.25},a5:{x:6.25,y:43.75},a6:{x:6.25,y:31.25},a7:{x:6.25,y:18.75},a8:{x:6.25,y:6.25},b1:{x:18.75,y:93.75},b2:{x:18.75,y:81.25},b3:{x:18.75,y:68.75},b4:{x:18.75,y:56.25},b5:{x:18.75,y:43.75},b6:{x:18.75,y:31.25},b7:{x:18.75,y:18.75},b8:{x:18.75,y:6.25},c1:{x:31.25,y:93.75},c2:{x:31.25,y:81.25},c3:{x:31.25,y:68.75},c4:{x:31.25,y:56.25},c5:{x:31.25,y:43.75},c6:{x:31.25,y:31.25},c7:{x:31.25,y:18.75},c8:{x:31.25,y:6.25},d1:{x:43.75,y:93.75},d2:{x:43.75,y:81.25},d3:{x:43.75,y:68.75},d4:{x:43.75,y:56.25},d5:{x:43.75,y:43.75},d6:{x:43.75,y:31.25},d7:{x:43.75,y:18.75},d8:{x:43.75,y:6.25},e1:{x:56.25,y:93.75},e2:{x:56.25,y:81.25},e3:{x:56.25,y:68.75},e4:{x:56.25,y:56.25},e5:{x:56.25,y:43.75},e6:{x:56.25,y:31.25},e7:{x:56.25,y:18.75},e8:{x:56.25,y:6.25},f1:{x:68.75,y:93.75},f2:{x:68.75,y:81.25},f3:{x:68.75,y:68.75},f4:{x:68.75,y:56.25},f5:{x:68.75,y:43.75},f6:{x:68.75,y:31.25},f7:{x:68.75,y:18.75},f8:{x:68.75,y:6.25},g1:{x:81.25,y:93.75},g2:{x:81.25,y:81.25},g3:{x:81.25,y:68.75},g4:{x:81.25,y:56.25},g5:{x:81.25,y:43.75},g6:{x:81.25,y:31.25},g7:{x:81.25,y:18.75},g8:{x:81.25,y:6.25},h1:{x:93.75,y:93.75},h2:{x:93.75,y:81.25},h3:{x:93.75,y:68.75},h4:{x:93.75,y:56.25},h5:{x:93.75,y:43.75},h6:{x:93.75,y:31.25},h7:{x:93.75,y:18.75},h8:{x:93.75,y:6.25}},y=i(18),_=i(49),x=y.b.WIDTH/2,w=y.b.HEAD_HEIGHT,S=y.b.TAIL_PADDING,M=y.b.HEAD_WIDTH/2;function createStraightArrow(t){var r=t.from,i=t.polygon,o=t.to,a=Object(_.a)({from:r,to:o});return i.setAttribute("transform","rotate(".concat(a," ").concat(r.x," ").concat(r.y,")")),i.setAttribute("points",function getStraightArrowPoints(t){var r=t.from,i=t.to,o=Object(l.a)({from:r,to:i});return"\n    ".concat(r.x-x," ").concat(r.y+S,",\n    ").concat(r.x-x," ").concat(r.y+o-w,",\n    ").concat(r.x-M," ").concat(r.y+o-w,",\n    ").concat(r.x," ").concat(r.y+o,",\n    ").concat(r.x+M," ").concat(r.y+o-w,",\n    ").concat(r.x+x," ").concat(r.y+o-w,",\n    ").concat(r.x+x," ").concat(r.y+S,"\n  ").trim()}({from:r,to:o})),i}var T=y.b.WIDTH/2,P=y.b.HEAD_HEIGHT,C=y.b.TAIL_PADDING,A=y.b.HEAD_WIDTH/2;var O=i(50);function createKnightArrow(t){var r=t.from,i=t.polygon,o=t.slope,a=t.to,l="rotate(".concat(Object(O.a)({from:r,slope:o,to:a})," ").concat(r.x," ").concat(r.y,")");return y.c.includes(o)&&(l+=" scale(-1, 1) translate(-".concat(2*r.x,", 0)")),i.setAttribute("transform",l),i.setAttribute("points",function getKnightArrowPoints(t){var r=t.from;return"\n    ".concat(r.x-T," ").concat(r.y+C,",\n    ").concat(r.x-T," ").concat(r.y+25+T,",\n    ").concat(r.x+12.5-P," ").concat(r.y+25+T,",\n    ").concat(r.x+12.5-P," ").concat(r.y+25+A,",\n    ").concat(r.x+12.5," ").concat(r.y+25,",\n    ").concat(r.x+12.5-P," ").concat(r.y+25-A,",\n    ").concat(r.x+12.5-P," ").concat(r.y+25-T,",\n    ").concat(r.x+T," ").concat(r.y+25-T,",\n    ").concat(r.x+T," ").concat(r.y+C,"\n  ").trim()}({from:r})),i}var L=i(51);function createArrowsMethods(t){var r=t.board,i=(t.el,t.options),o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("viewBox","0 0 100 100"),o.classList.add("arrows"),r.addToDom({el:o,type:a.b.Arrows});var _={};return{addArrows:function addArrows(t,r){Object.keys(t).forEach((function(i){var a=function createArrow(t,r){if(t.key){var i=t.key.substring(0,2),o=t.key.substring(2,4),a=document.createElementNS("http://www.w3.org/2000/svg","polygon");a.setAttribute("id","arrow-".concat(i).concat(o)),a.setAttribute("data-arrow","".concat(i).concat(o)),a.setAttribute("class","arrow");var _=r.options.arrowColors,x=t.color,w=t.opacity;a.style.fill=Object(L.a)(x,_),w&&(a.style.opacity=String(w));var S=g[i],M=g[o];if(S&&M){var T=Object(l.a)({from:S,to:M}),P=Object(h.a)({from:S,to:M});return y.d.includes(P)&&T===y.a?createKnightArrow({from:S,polygon:a,slope:P,to:M}):createStraightArrow({from:S,polygon:a,to:M})}}}(t[i],r);a&&(o.appendChild(a),_[i]=a)}))},removeArrows:function removeArrows(t){t.forEach((function(t){_[t]&&(o.removeChild(_[t]),delete _[t])}))},updateArrows:function updateArrows(t){var r=i.arrowColors;Object.keys(t).forEach((function(i){var o=t[i],a=o.color,l=o.opacity;_[i].style.fill=Object(L.a)(a,r),l&&(_[i].style.opacity=String(l))}))}}}var I=i(20),R=i(46),j=i(41);function createStyleDOM(t){var r=t.boardStyles,i=t.options,o=t.pieceStyles;return updateStyles(i),{destroy:function destroy(){var t=document.getElementById(getStyleId());if(!t||!t.parentNode)return;t.parentNode.removeChild(t)},getStyleEl:getStyleEl,updateStyles:updateStyles};function getStyleEl(){return document.getElementById(getStyleId())}function getStyleId(){return"board-styles-".concat(i.id)}function updateStyles(t){var i=getStyleId(),a=getStyleEl();if(!a){(a=document.createElement("style")).type="text/css",a.id=i;var l=document.head;l&&l.appendChild(a)}a.innerHTML=function getStyleInnerHTML(t){var i=t.boardStyle,a=t.id,l=t.pieceStyle,h=o[l],g=h.path,y=h.format,_=h.isPseudo3d,x=Object(j.a)(g),w=r[i],S=_?"::after":"",M=I.d.reduce((function(t,r){return"".concat(t,"#board-").concat(a," .piece.").concat(r).concat(S,", #board-").concat(a," .promotion-piece.").concat(r).concat(S," { background-image: url('").concat(x,"/").concat(r,".").concat(y,"'); }")}),"");return"\n      #board-".concat(a,", .fade-in-overlay { background-image: url('").concat(Object(R.a)(w[2]),"'); }\n      .coordinate-light { fill: ").concat(w[0],"; } .coordinate-dark { fill: ").concat(w[1],"; } .highlight { background-color: ").concat(w[4],"; }\n      ").concat(M,"\n    ")}(t)}}var N=i(1),k=i.n(N),D=(i(74),i(4)),B=i(57);var G=i(7),H=i(6),V=i.n(H);function getTextNodes(t,r){var i=function getTextChar(t){var r=["8","7","6","5","4","3","2","1","a","b","c","d","e","f","g","h"];return t?[].concat(V()(r.slice(0,8).reverse()),V()(r.slice(-8).reverse())):r}(r);return function getCoordinates(t){return t===G.a.CoordinatesPositions.Outside?[{color:"grey",fontSize:3.1,x:2,y:3.5},{color:"grey",fontSize:3.1,x:2,y:16},{color:"grey",fontSize:3.1,x:2,y:28.5},{color:"grey",fontSize:3.1,x:2,y:41},{color:"grey",fontSize:3.1,x:2,y:53.5},{color:"grey",fontSize:3.1,x:2,y:66},{color:"grey",fontSize:3.1,x:2,y:78.5},{color:"grey",fontSize:3.1,x:2,y:91},{color:"grey",fontSize:3.1,x:10.35,y:99.25},{color:"grey",fontSize:3.1,x:22.85,y:99.25},{color:"grey",fontSize:3.1,x:35.35,y:99.25},{color:"grey",fontSize:3.1,x:47.85,y:99.25},{color:"grey",fontSize:3.1,x:60.35,y:99.25},{color:"grey",fontSize:3.1,x:72.85,y:99.25},{color:"grey",fontSize:3.1,x:85.35,y:99.25},{color:"grey",fontSize:3.1,x:97.85,y:99.25}]:[{color:"light",fontSize:2.8,x:.75,y:3.5},{color:"dark",fontSize:2.8,x:.75,y:15.75},{color:"light",fontSize:2.8,x:.75,y:28.25},{color:"dark",fontSize:2.8,x:.75,y:40.75},{color:"light",fontSize:2.8,x:.75,y:53.25},{color:"dark",fontSize:2.8,x:.75,y:65.75},{color:"light",fontSize:2.8,x:.75,y:78.25},{color:"dark",fontSize:2.8,x:.75,y:90.75},{color:"dark",fontSize:2.8,x:10,y:99},{color:"light",fontSize:2.8,x:22.5,y:99},{color:"dark",fontSize:2.8,x:35,y:99},{color:"light",fontSize:2.8,x:47.5,y:99},{color:"dark",fontSize:2.8,x:60,y:99},{color:"light",fontSize:2.8,x:72.5,y:99},{color:"dark",fontSize:2.8,x:85,y:99},{color:"light",fontSize:2.8,x:97.5,y:99}]}(t).map((function(t,r){return Object.assign(Object.assign({},t),{text:i[r]})})).map((function(t){return'<text \n          x="'.concat(t.x,'" \n          y="').concat(t.y,'" \n          ').concat(t.fontSize?'font-size="'.concat(t.fontSize,'"'):"",' \n          class="coordinate-').concat(t.color,'">').concat(t.text,"</text>")})).join("")}function createCoordinatesMethods(t){var r=t.board,i=t.options;return{setCoordinates:function setCoordinates(t){var o=t.flipped,l=t.position;if(removeCoordinates(),l===G.a.CoordinatesPositions.Off)return;!function addCoordinates(t,o){var l,h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("viewBox","0 0 100 100"),h.classList.add("coordinates"),t===G.a.CoordinatesPositions.Outside&&h.classList.add("outside");i.test&&Object(D.c)(h,(l={},k()(l,D.b.Element,D.a.Coordinates),k()(l,D.b.Flipped,o.toString()),k()(l,D.b.Position,t),l));h.innerHTML=getTextNodes(t,o),r.addToDom({el:h,type:a.b.Coordinates})}(l,o)}};function removeCoordinates(){var t=r.el.querySelector(".coordinates");t&&t.parentNode.removeChild(t)}}i(105);function createFadeSetupMethods(t){var r,i=t.board;return{fadeSetup:function fadeSetup(t){var o=t.options;if(0===o.fadeSetup)return void(r&&function removeFadeInOverlay(){r&&r.remove();r=void 0}());r||function createFadeInOverlay(t){(r=document.createElement("div")).classList.add("fade-in-overlay"),i.addToDom({el:r,type:a.b.FadeSetup}),r.addEventListener("animationend",removeAnimation),t.test&&Object(D.c)(r,k()({},D.b.Element,D.a.FadeInOverlay))}(o);r&&(r.style.animationDuration="".concat(o.fadeSetup/1e3,"s"),r.classList.add("animate"))}};function removeAnimation(){r&&(r.style.animationDuration="",r.classList.remove("animate"))}}var U=i(32);var z,W=i(2),q=i(8),$=i(9);!function(t){t[t.Slide=0]="Slide",t[t.FadeOut=1]="FadeOut"}(z||(z={}));var X=i(19),K=i.n(X);function generateFadeOutSteps(t){var r=t.animation,i=t.numSteps;return Array(i).fill(void 0).map((function(t,o,a){var l,h=2.86-2.86*((o+1)/i);return h=h>1?1:h,o===a.length-1&&r.callback&&(l=r.callback),{callback:l,el:r.el,style:{opacity:h.toString()}}}))}var Y=i(14);function getCoordsFromSquare(t,r){var i=Object(Y.a)(t),o=r?{file:9-i.file,rank:9-i.rank}:i;return{x:100*o.file-100,y:100*(8-o.rank)}}function generateSlideSteps(t){var r=t.animation,i=t.isFlipped,o=void 0!==i&&i,a=t.numSteps,l=r.el,h=r.from,g=r.to;if(!h||!g)return[];var y=getCoordsFromSquare(h,o),_=getCoordsFromSquare(g,o);if(!y||!_)return[];var x=(_.x-y.x)/a,w=(_.y-y.y)/a;return Array(a).fill(void 0).map((function(t,r){var i=r===a-1,o=i?_:{x:y.x+x*(r+1),y:y.y+w*(r+1)};return{el:l,style:{transform:i?"":"translate(".concat(o.x,"%, ").concat(o.y,"%)"),zIndex:i?"":"10"}}}))}function createAnimations(t){var r,i,o=[],a=(r={},k()(r,z.FadeOut,generateFadeOutSteps),k()(r,z.Slide,generateSlideSteps),r);return{add:function add(t,r){var i=r.animationType,l=r.flipped,h=Math.max(Math.floor(function getDuration(t){switch(t){case G.a.Animation.Types.Slow:return G.a.Animation.Speeds.Slow;case G.a.Animation.Types.Fast:return G.a.Animation.Speeds.Fast;case G.a.Animation.Types.None:return 0;default:return G.a.Animation.Speeds.Default}}(i)/16),1);t.map((function(t){return a[t.type]({animation:t,isFlipped:l||!1,numSteps:h})})).forEach((function(t){if(t.length>o.length){var r=Array(t.length-o.length).fill([]);o.unshift.apply(o,V()(r))}t.forEach((function(t,r,i){var a=i.length-r;o[o.length-a]=[].concat(V()(o[o.length-a]),[t])}))}))},flush:function flush(){if(0===o.length)return void(i=!0);o.splice(0,o.length-1),run()},run:run};function run(){i=o.length<2;var r=o.shift();r&&(t.isAnimating()||t.setAnimatingStatus(!0),r.forEach((function(t){Object.entries(t.style).forEach((function(r){var i=K()(r,2),o=i[0],a=i[1];t.el.style[o]=a})),t.callback&&t.callback()})),0===o.length&&t.setAnimatingStatus(!1),i||requestAnimationFrame((function(){run()})))}}var Z=i(25);function createPiece(t,r){var i,o=Object.assign({},t),a=document.createElement("div");return a.classList.add("piece"),setDetails(t.color,t.type),setPositionBySquare(t.square),r&&Object(D.c)(a,k()({},D.b.Element,D.a.Piece)),{el:a,getDetails:function getDetails(){return o},setDetails:setDetails,setDraggingState:function setDraggingState(t){if(t)return a.classList.add("dragging"),void(r&&Object(D.c)(a,k()({},D.b.Dragging,"true")));r&&Object(D.c)(a,k()({},D.b.Dragging,void 0));a.classList.remove("dragging")},setPositionByCoords:function setPositionByCoords(t){if(!t)return;a.style.transform="translate(".concat(t.x,"%, ").concat(t.y,"%)")},setPositionBySquare:setPositionBySquare};function setDetails(t,l){var h;(a.classList.remove(i),i=function generateShortString(t,r){return"".concat(Object(Z.a)(t)).concat(r)}(t,l),a.classList.add(i),o.type=l,o.color=t,r)&&Object(D.c)(a,(h={},k()(h,D.b.Type,l),k()(h,D.b.Color,Object(Z.a)(t)),k()(h,D.b.ShortString,t===W.a.ColorsAsNumbers.Black?l:l.toUpperCase()),h))}function setPositionBySquare(t,i){if(r){var o,l=Object(Y.a)(t);if(!l)return;if(l&&!i)Object(D.c)(a,(o={},k()(o,D.b.File,l.file.toString()),k()(o,D.b.Rank,l.rank.toString()),k()(o,D.b.Square,t),o))}Object(U.a)({el:a,square:t})}}var Q=i(11);var J=i(66),ee=i(47);function createPieceMovementMethods(t){var r=function create_pieces_createPieces(t){var r,i=t.board,o=t.options,l=createAnimations(i),h=Object(Q.a)();return{animations:l,create:function create(t){var r=createPiece(t,o.test);return h.set(t.square,r),i.addToDom({el:r.el,type:a.b.Pieces}),r},get:get,getDraggingSquare:getDraggingSquare,move:function move(t,r){var i=Array.isArray(t)?t:[t],o=i.filter(Boolean).map((function(t){return t.kingTo||t.to})),a=i.filter(Boolean).map((function(t){return get(t.from)})),g=[];i.forEach((function(t,r){if(!t)throw new q.a({code:$.a.ElementNotFound,message:"Move object does not exist."});var i=t.kingTo||t.to;a[r].setPositionBySquare(i),t.animate&&g.push({el:a[r].el,from:t.from,to:i,type:z.Slide}),h.set(i,a[r]),o.includes(t.from)||h.deleteItem(t.from),t.promotion&&h.get(i).setDetails(t.color,t.promotion)})),g.length&&l.add(g,r)},remove:function remove(t){var i=t.animate,o=t.options,a=t.squares,g=[];a.forEach((function(t){if(h.isDefined(t)){var r=get(t).el,o=r.parentNode;if(i)g.push({callback:removeElement,el:get(t).el,type:z.FadeOut});else{if(!o)return;removeElement()}h.deleteItem(t)}function removeElement(){if(!r)throw new q.a({code:$.a.ElementNotFound,data:{square:t},message:"Piece does not exist. Cannot remove."});r.parentNode&&r.parentNode.removeChild(r)}})),g.length&&l.add(g,o),r&&!h.isDefined(r)&&(r=void 0)},setDraggingState:setDraggingState,setPositionByCoords:function setPositionByCoords(t,r){var i=get(t),o=getDraggingSquare();o&&setDraggingState(o,!1),i.setPositionByCoords(r)},setPositionBySquare:function setPositionBySquare(t,r){var i=get(t);r!==t&&(h.set(r,h.get(t)),h.deleteItem(t)),i.setPositionBySquare(r)},suspendOverSquare:function suspendOverSquare(t,r){get(t).setPositionBySquare(r,!0)}};function get(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return h;if(!h.isDefined(t)&&r)throw new q.a({code:$.a.ElementNotFound,data:{square:t},message:"Piece does not exist."});return h.isDefined(t)?h.get(t):void 0}function getDraggingSquare(){return r}function setDraggingState(t,i){get(t).setDraggingState(i),r=i?t:void 0}}({board:t.board,options:t.options});return{dragPiece:function dragPiece(t){if(!t)return;!document.body.classList.contains("hide-overflow")&&window.innerHeight>=document.body.scrollHeight&&document.body.classList.add("hide-overflow");t.toSquare?r.suspendOverSquare(t.square,t.toSquare):t.coords&&r.setPositionByCoords(t.square,t.coords);r.setDraggingState(t.square,!0)},dropPiece:function dropPiece(){var t=r.getDraggingSquare();if(document.body.classList.remove("hide-overflow"),!t)return;r.setPositionBySquare(t,t),r.setDraggingState(t,!1)},illegalMove:function illegalMove(){},loadPieces:function loadPieces(t,i){var o=t.pieces;r.animations.flush();var a=o.keys(),l=r.get().keys().filter((function(t){return!a.includes(t)}));r.remove({options:i.options,squares:l}),o.keys().forEach((function(t){var i=o.get(t),a=r.get(t,!1);if(a){var l=a.getDetails(),h=l.type,g=l.color;h===i.type&&g===i.color||a.setDetails(i.color,i.type)}else r.create(i)})),r.animations.run()},makeMove:function makeMove(t,i){if(r.animations.flush(),t.drop)return void r.create({color:t.color,square:t.kingTo||t.to,type:t.piece});t.EPCapturedSquare?r.remove({animate:t.animate,options:i.options,squares:[t.EPCapturedSquare]}):r.get(t.to,!1)&&!Object(ee.a)(t)&&r.remove({animate:t.animate,options:i.options,squares:[t.to]});var o=[t,t.rookMove].filter(Boolean);r.move(o,i.options),r.animations.run()},removePiece:removePiece,undoMove:function undoMove(t,i){if(r.animations.flush(),t.drop)return void removePiece(t.to,i);var o=Object(J.a)(t),a=o.movedPieces,l=o.restoredPiece,h=o.promotedSquare;r.move(a,i.options),l&&r.create(l);if(h){var g=r.get(h),y=g.getDetails().color;g.setDetails(y,W.a.Piece.Types.Pawn)}r.animations.run()}};function removePiece(t,i){r.remove({options:i.options,squares:[t]})}}var te=i(0),ne=i(5),re=i(17),ie=i(28);function createPromotionWindowMethods(t){var r,i,o=t.board,l=t.options,h={b:void 0,n:void 0,q:void 0,r:void 0};return{closePromotionWindow:function closePromotionWindow(){if(!r)throw new q.a({code:$.a.ElementNotFound,message:"Promotion window does not exist."});r.style.display="none"},openPromotionWindow:function openPromotionWindow(t,g){var y,_=g.options.flipped,x=g.run,w=function getPromotionWindowDetails(t){var r,i=t.flipped,o=t.promotionMove;r=i?o.color===W.a.ColorsAsNumbers.White?"bottom":"top":o.color===W.a.ColorsAsNumbers.White?"top":"bottom";var a=o.color,l=(i?"hgfedcba":"abcdefgh").indexOf(o.to.slice(0,1))+1;return{color:a,file:l,position:r}}({flipped:_,promotionMove:t}),S=w.color,M=w.file,T=w.position;r||function createPromotionWindow(){(r=document.createElement("div")).classList.add("promotion-window"),l.test&&Object(D.c)(r,k()({},D.b.Element,D.a.PromotionWindow));o.addToDom({el:r,type:a.b.PromotionWindow})}();i||function createCloseButton(t){(i=document.createElement("i")).className="close-button icon-font-chess x",l.test&&Object(D.c)(i,k()({},D.b.Element,D.a.PromotionCloseButton));r.appendChild(i),i.addEventListener(ne.b,(function(r){r.stopPropagation(),t(Object(re.a)(te.a.BoardEvents.PromotionAreaClosePointerdown))}))}(x);h.q||function createPieces(t){Object.keys(h).forEach((function(i){var o,a=document.createElement("div");(a.addEventListener(ne.b,(function(r){r.stopPropagation(),Object(ie.a)(r)?t(Object(re.a)(te.a.UserEvents.PointerdownRight)):t(Object(re.a)(te.a.BoardEvents.PromotionPiecePointerdown,{piece:i}))})),a.classList.add("promotion-piece"),h[i]=a,l.test)&&Object(D.c)(h[i],(o={},k()(o,D.b.Element,D.a.PromotionPiece),k()(o,D.b.Type,i),o));r.appendChild(a)}))}(x);setPieceOrder(T),setPromotionWindowFile(M),setPieceColors(S),l.test&&Object(D.c)(r,(y={},k()(y,D.b.Color,Object(Z.a)(S)),k()(y,D.b.File,M.toString()),k()(y,D.b.Position,T),y));!function showPromotionWindow(){r.style.display=""}()}};function setPieceColors(t){Object.keys(h).forEach((function(r){h[r].className="promotion-piece ".concat(Object(Z.a)(t)).concat(r),l.test&&Object(D.c)(h[r],k()({},D.b.Color,Object(Z.a)(t)))}))}function setPieceOrder(t){"top"===t?r.classList.add("top"):r.classList.remove("top")}function setPromotionWindowFile(t){r.style.transform="translateX(".concat(100*(t-1),"%")}}function createSquaresMethods(t){var r=t.board,i=t.options,o=Object(Q.a)(),l=i.test;return{addSquares:function addSquares(t){t.keys().forEach((function(i){var l=t.get(i);if(!o.isDefined(i)&&l){var h=createHighlightFromSquare(i,l);o.set(i,h),r.addToDom({el:h,type:a.b.Squares})}}))},blinkSquares:function blinkSquares(t){t.keys().forEach((function(i){var o,h=t.get(i),g=createHighlightFromSquare(i,h);(r.addToDom({el:g,type:a.b.BlinkingSquares}),l)&&Object(D.c)(g,(o={},k()(o,D.b.Element,D.a.BlinkingSquare),k()(o,D.b.Square,h.square),k()(o,D.b.Color,h.color),k()(o,D.b.Interval,h.interval),k()(o,D.b.Opacity,h.opacity),k()(o,D.b.Times,h.times),k()(o,D.b.Type,D.b.Blinking),o));!function blinkSquare(t){var r=t.el,i=t.interval,o=t.opacity,a=t.times,l=0,h=!0,g=setInterval((function(){if((l+=1)!==2*a)h?(r.style.opacity="0",h=!1):(r.style.opacity=o.toString(),h=!0);else if(clearInterval(g),r){var t=r.parentNode;t&&t.removeChild(r)}}),i/2)}({el:g,interval:h.interval,opacity:h.opacity,times:h.times})}))},removeSquares:function removeSquares(t){t.forEach(removeHighlight)},updateSquares:function updateSquares(t){t.keys().forEach((function(r){updateHighlightElementStyles(o.get(r),t.get(r))}))}};function createHighlightFromSquare(t,r){var i=document.createElement("div");return Object(D.c)(i,k()({},D.b.Element,D.a.Highlight)),i.classList.add("highlight"),updateHighlightElementStyles(i,r),Object(U.a)({el:i,square:t}),i}function removeHighlight(t){if(o.isDefined(t)){var r=o.get(t),i=r.parentNode;i&&i.removeChild(r),o.deleteItem(t)}}function updateHighlightElementStyles(t,r){if(!t)throw new q.a({code:$.a.ElementNotFound,data:{square:r},message:"Highlight does not exist."});var i=r.color||"",o=String(r.opacity);t.style.backgroundColor!==i&&(t.style.backgroundColor=i),t.style.opacity!==o&&(t.style.opacity=o)}}var oe=i(24);var ae=i(68);function getPointerPosition(t){var r=t.el,i=t.event,o=t.flipped,a=r.getBoundingClientRect(),l=Object(ae.a)(i),h=l.x,g=l.y,y=a.width/8,_={x:Math.round((h-a.left)%y),y:Math.round((g-a.top)%y)},x=Math.ceil((h-a.left)/y),w=Math.ceil((a.bottom-g)/y),S=o?9-x:x,M=o?9-w:w,T=Object(oe.a)({file:S,rank:M}),P={x:(h-a.left-y/2)/a.width*800,y:(g-a.top-y/2)/a.height*800};return{coords:P,coordsInsideBoard:function getCoordsInsideBoard(t){var r=Math.max(t.x,-50);r=Math.min(r,750);var i=Math.max(t.y,-50);return{x:r,y:i=Math.min(i,750)}}(P),coordsInsideSquare:_,square:T,squareInsideBoard:function getSquareInsideBoard(t,r){var i=Math.max(t,1);i=Math.min(i,8);var o=Math.max(r,1);return o=Math.min(o,8),Object(oe.a)({file:i,rank:o})}(S,M)}}var se=i(52);function createDefaultRenderer(t){var r=t.el,i=t.options,l=void 0===i?Object(o.a)():i,h=t.boardStyles,g=void 0===h?I.a:h,y=t.pieceStyles,_=void 0===y?I.b:y,x=t.testElement,w=function createBoard(t){var r,i,o=t.el,l=t.options,h=t.testElement,g=void 0===h?D.a.Board:h,y=(r={},k()(r,a.b.Coordinates,document.createComment("/Coordinates")),k()(r,a.b.Squares,document.createComment("/Squares")),k()(r,a.b.BlinkingSquares,document.createComment("/Blinking Squares")),k()(r,a.b.Effects,document.createComment("/Effects")),k()(r,a.b.HoverSquare,document.createComment("/Hover Square")),k()(r,a.b.Pieces,document.createComment("/Pieces")),k()(r,a.b.MoveHints,document.createComment("/MoveHints")),k()(r,a.b.CaptureHints,document.createComment("/Capture Hints")),k()(r,a.b.Arrows,document.createComment("/Arrows")),k()(r,a.b.PromotionWindow,document.createComment("/Promotion Window")),k()(r,a.b.FadeSetup,document.createComment("/Fade Setup")),r);Object.values(y).forEach((function(t){return o.appendChild(t)}));var _=Object(B.a)();return null===(i=_.resolve)||void 0===i||i.call(_,!0),l.test&&Object(D.c)(o,k()({},D.b.Element,g)),{addToDom:function addToDom(t){var r=t.type,i=t.el,a=t.insertAfter;void 0!==a&&a?o.insertBefore(i,y[r].nextSibling):o.insertBefore(i,y[r])},animationComplete:function animationComplete(t){return["All","Move"].includes(t)?_.promise:Promise.resolve(!0)},el:o,flipBoard:function flipBoard(t){t?o.classList.add("flipped"):o.classList.remove("flipped")},isAnimating:function isAnimating(){return Boolean(o.dataset.testAnimating)},isFlipped:function isFlipped(){return l.flipped},setAnimatingStatus:function setAnimatingStatus(t){var r;t?(o.dataset.testAnimating="true",_=Object(B.a)()):(delete o.dataset.testAnimating,null===(r=_.resolve)||void 0===r||r.call(_,!0))}}}({el:r,options:l,testElement:x}),S={board:w,el:r,options:l},M=function createAssetsMethods(t){var r=t.boardStyles,i=t.el,o=t.options,l=t.pieceStyles,h=createStyleDOM({boardStyles:r,options:o,pieceStyles:l});return{destroy:function destroy(){h.destroy()},updateBoardImage:function updateBoardImage(t){h.updateStyles(t.options)},updatePieceBaseImage:function updatePieceBaseImage(t){l[t.options.pieceStyle].isPseudo3d?i.classList.add(a.a.Pseudo3d):i.classList.remove(a.a.Pseudo3d),h.updateStyles(t.options)}}}(Object.assign(Object.assign({},S),{boardStyles:g,pieceStyles:_})),T=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function createAnalysisOverlayMethods(t){var r=t.board.el.classList;return{addAnalysisOverlay:function addAnalysisOverlay(){r.add("analysis-overlay")},removeAnalysisOverlay:function removeAnalysisOverlay(){r.remove("analysis-overlay")}}}(S)),createArrowsMethods(S)),M),createCoordinatesMethods(S)),function createCustomItemsMethods(t){return t.board,t.el,t.options,{addCustomItems:function addCustomItems(t){},removeCustomItems:function removeCustomItems(t){},updateCustomItems:function updateCustomItems(t){}}}(S)),createFadeSetupMethods(S)),function createHoverSquareMethods(t){var r,i=t.board,o=t.options.test;return{hideHoverSquare:function hideHoverSquare(){r&&(r.style.display="none")},showHoverSquare:function showHoverSquare(t){r||((r=document.createElement("div")).classList.add("hover-square"),o&&Object(D.c)(r,k()({},D.b.Element,D.a.HoverSquare)),updateHoverSquareBorder(),i.addToDom({el:r,type:a.b.HoverSquare})),r.style.display="",Object(U.a)({el:r,square:t})},updateHoverSquareBorder:updateHoverSquareBorder};function updateHoverSquareBorder(){r&&(r.style.borderWidth="".concat(function getBorderWidth(t){return.125*t.clientWidth*.05}(i.el),"px"))}}(S)),function createMoveHintsMethods(t){var r=t.board,i={};return{addCaptureHints:function addCaptureHints(t){t.forEach((function(t){i[t]&&removeHint(t),i[t]=createHintFromSquare(t,{isPotentialCapture:!0}),r.addToDom({el:i[t],type:a.b.CaptureHints}),i[t].style.borderWidth="".concat(.1*i[t].clientWidth,"px")}))},addMoveHints:function addMoveHints(t){t.forEach((function(t){i[t]||(i[t]=createHintFromSquare(t),r.addToDom({el:i[t],type:a.b.MoveHints}))}))},removeHints:function removeHints(t){t.forEach(removeHint)}};function createHintFromSquare(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement("div");return Object(D.c)(i,k()({},D.b.Element,r.isPotentialCapture?D.a.PotentialCapture:D.a.Hint)),i.classList.add(r.isPotentialCapture?"capture-hint":"hint"),Object(U.a)({el:i,square:t}),i}function removeHint(t){i[t]&&(i[t].parentNode.removeChild(i[t]),delete i[t])}}(S)),createSquaresMethods(S)),createPromotionWindowMethods(S)),createPieceMovementMethods(S)),{animationComplete:w.animationComplete,createRenderer:createDefaultRenderer,destroy:function destroy(){M.destroy(),r.innerHTML=""},extendRenderer:function extendRenderer(t){Object.assign(T,t(S))},flipBoard:w.flipBoard,getCoordsFromSquare:getCoordsFromSquare,getPieces:function getPieces(){return function formatPiecesAsObject(t){var r={};return t.forEach((function(t){var i=t.className.split(" "),o=i.find((function(t){return t.startsWith("square-")})),a=i.find((function(t){return t.startsWith("w")||t.startsWith("b")}));if(o&&a){var l=K()(a,2),h=l[0],g=l[1],y=parseInt(o[o.length-2],10),_=parseInt(o[o.length-1],10),x=Object(oe.a)({file:y,rank:_});x&&(r[x]={color:Object(se.a)(h),type:g})}})),r}(Array.from(r.querySelectorAll(".piece")))},getPointerPosition:getPointerPosition,getRendererOptions:function getRendererOptions(){return{boardStyles:g,el:r,options:l,pieceStyles:_}},isAnimating:w.isAnimating,name:"default",resize:function resize(){T.updateHoverSquareBorder()}});return T}},function(t,r,i){"use strict";var o=i(112),a=i(114);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=urlParse,r.resolve=function urlResolve(t,r){return urlParse(t,!1,!0).resolve(r)},r.resolveObject=function urlResolveObject(t,r){return t?urlParse(t,!1,!0).resolveObject(r):r},r.format=function urlFormat(t){a.isString(t)&&(t=urlParse(t));return t instanceof Url?t.format():Url.prototype.format.call(t)},r.Url=Url;var l=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,g=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,y=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),_=["'"].concat(y),x=["%","/","?",";","#"].concat(_),w=["/","?","#"],S=/^[+a-z0-9A-Z_-]{0,63}$/,M=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,T={javascript:!0,"javascript:":!0},P={javascript:!0,"javascript:":!0},C={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=i(115);function urlParse(t,r,i){if(t&&a.isObject(t)&&t instanceof Url)return t;var o=new Url;return o.parse(t,r,i),o}Url.prototype.parse=function(t,r,i){if(!a.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var h=t.indexOf("?"),y=-1!==h&&h<t.indexOf("#")?"?":"#",O=t.split(y);O[0]=O[0].replace(/\\/g,"/");var L=t=O.join(y);if(L=L.trim(),!i&&1===t.split("#").length){var I=g.exec(L);if(I)return this.path=L,this.href=L,this.pathname=I[1],I[2]?(this.search=I[2],this.query=r?A.parse(this.search.substr(1)):this.search.substr(1)):r&&(this.search="",this.query={}),this}var R=l.exec(L);if(R){var j=(R=R[0]).toLowerCase();this.protocol=j,L=L.substr(R.length)}if(i||R||L.match(/^\/\/[^@\/]+@[^@\/]+/)){var N="//"===L.substr(0,2);!N||R&&P[R]||(L=L.substr(2),this.slashes=!0)}if(!P[R]&&(N||R&&!C[R])){for(var k,D,B=-1,G=0;G<w.length;G++){-1!==(H=L.indexOf(w[G]))&&(-1===B||H<B)&&(B=H)}-1!==(D=-1===B?L.lastIndexOf("@"):L.lastIndexOf("@",B))&&(k=L.slice(0,D),L=L.slice(D+1),this.auth=decodeURIComponent(k)),B=-1;for(G=0;G<x.length;G++){var H;-1!==(H=L.indexOf(x[G]))&&(-1===B||H<B)&&(B=H)}-1===B&&(B=L.length),this.host=L.slice(0,B),L=L.slice(B),this.parseHost(),this.hostname=this.hostname||"";var V="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!V)for(var U=this.hostname.split(/\./),z=(G=0,U.length);G<z;G++){var W=U[G];if(W&&!W.match(S)){for(var q="",$=0,X=W.length;$<X;$++)W.charCodeAt($)>127?q+="x":q+=W[$];if(!q.match(S)){var K=U.slice(0,G),Y=U.slice(G+1),Z=W.match(M);Z&&(K.push(Z[1]),Y.unshift(Z[2])),Y.length&&(L="/"+Y.join(".")+L),this.hostname=K.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),V||(this.hostname=o.toASCII(this.hostname));var Q=this.port?":"+this.port:"",J=this.hostname||"";this.host=J+Q,this.href+=this.host,V&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==L[0]&&(L="/"+L))}if(!T[j])for(G=0,z=_.length;G<z;G++){var ee=_[G];if(-1!==L.indexOf(ee)){var te=encodeURIComponent(ee);te===ee&&(te=escape(ee)),L=L.split(ee).join(te)}}var ne=L.indexOf("#");-1!==ne&&(this.hash=L.substr(ne),L=L.slice(0,ne));var re=L.indexOf("?");if(-1!==re?(this.search=L.substr(re),this.query=L.substr(re+1),r&&(this.query=A.parse(this.query)),L=L.slice(0,re)):r&&(this.search="",this.query={}),L&&(this.pathname=L),C[j]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){Q=this.pathname||"";var ie=this.search||"";this.path=Q+ie}return this.href=this.format(),this},Url.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var r=this.protocol||"",i=this.pathname||"",o=this.hash||"",l=!1,h="";this.host?l=t+this.host:this.hostname&&(l=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(l+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(h=A.stringify(this.query));var g=this.search||h&&"?"+h||"";return r&&":"!==r.substr(-1)&&(r+=":"),this.slashes||(!r||C[r])&&!1!==l?(l="//"+(l||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):l||(l=""),o&&"#"!==o.charAt(0)&&(o="#"+o),g&&"?"!==g.charAt(0)&&(g="?"+g),r+l+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(g=g.replace("#","%23"))+o},Url.prototype.resolve=function(t){return this.resolveObject(urlParse(t,!1,!0)).format()},Url.prototype.resolveObject=function(t){if(a.isString(t)){var r=new Url;r.parse(t,!1,!0),t=r}for(var i=new Url,o=Object.keys(this),l=0;l<o.length;l++){var h=o[l];i[h]=this[h]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var g=Object.keys(t),y=0;y<g.length;y++){var _=g[y];"protocol"!==_&&(i[_]=t[_])}return C[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!C[t.protocol]){for(var x=Object.keys(t),w=0;w<x.length;w++){var S=x[w];i[S]=t[S]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||P[t.protocol])i.pathname=t.pathname;else{for(var M=(t.pathname||"").split("/");M.length&&!(t.host=M.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==M[0]&&M.unshift(""),M.length<2&&M.unshift(""),i.pathname=M.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var T=i.pathname||"",A=i.search||"";i.path=T+A}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var O=i.pathname&&"/"===i.pathname.charAt(0),L=t.host||t.pathname&&"/"===t.pathname.charAt(0),I=L||O||i.host&&t.pathname,R=I,j=i.pathname&&i.pathname.split("/")||[],N=(M=t.pathname&&t.pathname.split("/")||[],i.protocol&&!C[i.protocol]);if(N&&(i.hostname="",i.port=null,i.host&&(""===j[0]?j[0]=i.host:j.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===M[0]?M[0]=t.host:M.unshift(t.host)),t.host=null),I=I&&(""===M[0]||""===j[0])),L)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,j=M;else if(M.length)j||(j=[]),j.pop(),j=j.concat(M),i.search=t.search,i.query=t.query;else if(!a.isNullOrUndefined(t.search)){if(N)i.hostname=i.host=j.shift(),(H=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=H.shift(),i.host=i.hostname=H.shift());return i.search=t.search,i.query=t.query,a.isNull(i.pathname)&&a.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!j.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var k=j.slice(-1)[0],D=(i.host||t.host||j.length>1)&&("."===k||".."===k)||""===k,B=0,G=j.length;G>=0;G--)"."===(k=j[G])?j.splice(G,1):".."===k?(j.splice(G,1),B++):B&&(j.splice(G,1),B--);if(!I&&!R)for(;B--;B)j.unshift("..");!I||""===j[0]||j[0]&&"/"===j[0].charAt(0)||j.unshift(""),D&&"/"!==j.join("/").substr(-1)&&j.push("");var H,V=""===j[0]||j[0]&&"/"===j[0].charAt(0);N&&(i.hostname=i.host=V?"":j.length?j.shift():"",(H=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=H.shift(),i.host=i.hostname=H.shift()));return(I=I||i.host&&j.length)&&!V&&j.unshift(""),j.length?i.pathname=j.join("/"):(i.pathname=null,i.path=null),a.isNull(i.pathname)&&a.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},Url.prototype.parseHost=function(){var t=this.host,r=h.exec(t);r&&(":"!==(r=r[0])&&(this.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(this.hostname=t)}},function(t,r,i){var o=i(44),a=i(82);t.exports=function _possibleConstructorReturn(t,r){return!r||"object"!==o(r)&&"function"!=typeof r?a(t):r}},function(t,r,i){var o=i(38),a=i(69),l=i(83),h=i(84);function _wrapNativeSuper(r){var i="function"==typeof Map?new Map:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!l(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,Wrapper)}function Wrapper(){return h(t,arguments,o(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),a(Wrapper,t)},_wrapNativeSuper(r)}t.exports=_wrapNativeSuper},function(t,r,i){"use strict";i.d(r,"a",(function(){return isCapture}));var o=i(2);function isCapture(t){return t.flags===o.a.Move.Flags.AnyCapture||t.flags===o.a.Move.Flags.Capture||t.flags===o.a.Move.Flags.EPCapture}},function(t,r,i){"use strict";function getAssetBasePath(){return"https://images.chesscomfiles.com"}i.d(r,"a",(function(){return getAssetBasePath}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getUndoMoveDetails}));var o=i(30);function getUndoMoveDetails(t){var r=[{animate:t.animate,from:t.kingTo||t.to,to:t.from}];t.rookMove&&r.push(Object.assign(Object.assign({},t.rookMove),{from:t.rookMove.to,to:t.rookMove.from}));var i=t.captured&&t.capturedStr?{color:Object(o.a)(t.color),promoted:t.capturedPromotedPawn,square:t.EPCapturedSquare||t.to,type:t.capturedStr.toLowerCase()}:void 0;return{movedPieces:r,promotedSquare:t.promotion?t.from:void 0,restoredPiece:i}}},function(t,r,i){"use strict";function isTouchEvent(t){return void 0!==t.touches}i.d(r,"a",(function(){return isTouchEvent}))},function(t,r,i){"use strict";i.d(r,"a",(function(){return getXYFromEvent}));var o=i(5),a=-1,l=-1;function getXYFromEvent(t){var r=t.clientX,i=t.clientY,h=t.pointer,g=t.type,y=t.touches;return(g===o.a.Touchmove||g===o.a.Touchstart)&&y.length>0&&(a=y[0].clientX,l=y[0].clientY),g===o.a.Touchend?{x:a,y:l}:h?{x:h.x,y:h.y}:y&&y.length>0?{x:y[0].clientX,y:y[0].clientY}:{x:null!=r?r:-1,y:null!=i?i:-1}}},function(t,r){function _setPrototypeOf(r,i){return t.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(r,i)}t.exports=_setPrototypeOf},function(t,r,i){},function(t,r,i){"use strict";t.exports=function parseURI(t,r){r=r||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},o=i.parser[r.strictMode?"strict":"loose"].exec(t),a={},l=14;l--;)a[i.key[l]]=o[l]||"";return a[i.q.name]={},a[i.key[12]].replace(i.q.parser,(function(t,r,o){r&&(a[i.q.name][r]=o)})),a}},function(t,r){t.exports=function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var i=0,o=new Array(r);i<r;i++)o[i]=t[i];return o}},function(t,r,i){var o=i(72);t.exports=function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return o(t,r);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,r):void 0}}},function(t,r,i){},function(t,r,i){"use strict";var o=Object.prototype.hasOwnProperty,a="~";function Events(){}function EE(t,r,i){this.fn=t,this.context=r,this.once=i||!1}function addListener(t,r,i,o,l){if("function"!=typeof i)throw new TypeError("The listener must be a function");var h=new EE(i,o||t,l),g=a?a+r:r;return t._events[g]?t._events[g].fn?t._events[g]=[t._events[g],h]:t._events[g].push(h):(t._events[g]=h,t._eventsCount++),t}function clearEvent(t,r){0==--t._eventsCount?t._events=new Events:delete t._events[r]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(a=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)o.call(t,r)&&i.push(a?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},EventEmitter.prototype.listeners=function listeners(t){var r=a?a+t:t,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var o=0,l=i.length,h=new Array(l);o<l;o++)h[o]=i[o].fn;return h},EventEmitter.prototype.listenerCount=function listenerCount(t){var r=a?a+t:t,i=this._events[r];return i?i.fn?1:i.length:0},EventEmitter.prototype.emit=function emit(t,r,i,o,l,h){var g=a?a+t:t;if(!this._events[g])return!1;var y,_,x=this._events[g],w=arguments.length;if(x.fn){switch(x.once&&this.removeListener(t,x.fn,void 0,!0),w){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,r),!0;case 3:return x.fn.call(x.context,r,i),!0;case 4:return x.fn.call(x.context,r,i,o),!0;case 5:return x.fn.call(x.context,r,i,o,l),!0;case 6:return x.fn.call(x.context,r,i,o,l,h),!0}for(_=1,y=new Array(w-1);_<w;_++)y[_-1]=arguments[_];x.fn.apply(x.context,y)}else{var S,M=x.length;for(_=0;_<M;_++)switch(x[_].once&&this.removeListener(t,x[_].fn,void 0,!0),w){case 1:x[_].fn.call(x[_].context);break;case 2:x[_].fn.call(x[_].context,r);break;case 3:x[_].fn.call(x[_].context,r,i);break;case 4:x[_].fn.call(x[_].context,r,i,o);break;default:if(!y)for(S=1,y=new Array(w-1);S<w;S++)y[S-1]=arguments[S];x[_].fn.apply(x[_].context,y)}}return!0},EventEmitter.prototype.on=function on(t,r,i){return addListener(this,t,r,i,!1)},EventEmitter.prototype.once=function once(t,r,i){return addListener(this,t,r,i,!0)},EventEmitter.prototype.removeListener=function removeListener(t,r,i,o){var l=a?a+t:t;if(!this._events[l])return this;if(!r)return clearEvent(this,l),this;var h=this._events[l];if(h.fn)h.fn!==r||o&&!h.once||i&&h.context!==i||clearEvent(this,l);else{for(var g=0,y=[],_=h.length;g<_;g++)(h[g].fn!==r||o&&!h[g].once||i&&h[g].context!==i)&&y.push(h[g]);y.length?this._events[l]=1===y.length?y[0]:y:clearEvent(this,l)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var r;return t?(r=a?a+t:t,this._events[r]&&clearEvent(this,r)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=a,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter},function(t,r,i){"use strict";function earcut(t,r,i){i=i||2;var o,a,l,h,g,y,_,x=r&&r.length,w=x?r[0]*i:t.length,S=linkedList(t,0,w,i,!0),M=[];if(!S||S.next===S.prev)return M;if(x&&(S=function eliminateHoles(t,r,i,o){var a,l,h,g=[];for(a=0,l=r.length;a<l;a++)(h=linkedList(t,r[a]*o,a<l-1?r[a+1]*o:t.length,o,!1))===h.next&&(h.steiner=!0),g.push(getLeftmost(h));for(g.sort(compareX),a=0;a<g.length;a++)eliminateHole(g[a],i),i=filterPoints(i,i.next);return i}(t,r,S,i)),t.length>80*i){o=l=t[0],a=h=t[1];for(var T=i;T<w;T+=i)(g=t[T])<o&&(o=g),(y=t[T+1])<a&&(a=y),g>l&&(l=g),y>h&&(h=y);_=0!==(_=Math.max(l-o,h-a))?1/_:0}return earcutLinked(S,M,i,o,a,_),M}function linkedList(t,r,i,o,a){var l,h;if(a===signedArea(t,r,i,o)>0)for(l=r;l<i;l+=o)h=insertNode(l,t[l],t[l+1],h);else for(l=i-o;l>=r;l-=o)h=insertNode(l,t[l],t[l+1],h);return h&&equals(h,h.next)&&(removeNode(h),h=h.next),h}function filterPoints(t,r){if(!t)return t;r||(r=t);var i,o=t;do{if(i=!1,o.steiner||!equals(o,o.next)&&0!==area(o.prev,o,o.next))o=o.next;else{if(removeNode(o),(o=r=o.prev)===o.next)break;i=!0}}while(i||o!==r);return r}function earcutLinked(t,r,i,o,a,l,h){if(t){!h&&l&&function indexCurve(t,r,i,o){var a=t;do{null===a.z&&(a.z=zOrder(a.x,a.y,r,i,o)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(t){var r,i,o,a,l,h,g,y,_=1;do{for(i=t,t=null,l=null,h=0;i;){for(h++,o=i,g=0,r=0;r<_&&(g++,o=o.nextZ);r++);for(y=_;g>0||y>0&&o;)0!==g&&(0===y||!o||i.z<=o.z)?(a=i,i=i.nextZ,g--):(a=o,o=o.nextZ,y--),l?l.nextZ=a:t=a,a.prevZ=l,l=a;i=o}l.nextZ=null,_*=2}while(h>1);return t}(a)}(t,o,a,l);for(var g,y,_=t;t.prev!==t.next;)if(g=t.prev,y=t.next,l?isEarHashed(t,o,a,l):isEar(t))r.push(g.i/i),r.push(t.i/i),r.push(y.i/i),removeNode(t),t=y.next,_=y.next;else if((t=y)===_){h?1===h?earcutLinked(t=cureLocalIntersections(filterPoints(t),r,i),r,i,o,a,l,2):2===h&&splitEarcut(t,r,i,o,a,l):earcutLinked(filterPoints(t),r,i,o,a,l,1);break}}}function isEar(t){var r=t.prev,i=t,o=t.next;if(area(r,i,o)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(pointInTriangle(r.x,r.y,i.x,i.y,o.x,o.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(t,r,i,o){var a=t.prev,l=t,h=t.next;if(area(a,l,h)>=0)return!1;for(var g=a.x<l.x?a.x<h.x?a.x:h.x:l.x<h.x?l.x:h.x,y=a.y<l.y?a.y<h.y?a.y:h.y:l.y<h.y?l.y:h.y,_=a.x>l.x?a.x>h.x?a.x:h.x:l.x>h.x?l.x:h.x,x=a.y>l.y?a.y>h.y?a.y:h.y:l.y>h.y?l.y:h.y,w=zOrder(g,y,r,i,o),S=zOrder(_,x,r,i,o),M=t.prevZ,T=t.nextZ;M&&M.z>=w&&T&&T.z<=S;){if(M!==t.prev&&M!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;if(M=M.prevZ,T!==t.prev&&T!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&area(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;M&&M.z>=w;){if(M!==t.prev&&M!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;T&&T.z<=S;){if(T!==t.prev&&T!==t.next&&pointInTriangle(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&area(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function cureLocalIntersections(t,r,i){var o=t;do{var a=o.prev,l=o.next.next;!equals(a,l)&&intersects(a,o,o.next,l)&&locallyInside(a,l)&&locallyInside(l,a)&&(r.push(a.i/i),r.push(o.i/i),r.push(l.i/i),removeNode(o),removeNode(o.next),o=t=l),o=o.next}while(o!==t);return filterPoints(o)}function splitEarcut(t,r,i,o,a,l){var h=t;do{for(var g=h.next.next;g!==h.prev;){if(h.i!==g.i&&isValidDiagonal(h,g)){var y=splitPolygon(h,g);return h=filterPoints(h,h.next),y=filterPoints(y,y.next),earcutLinked(h,r,i,o,a,l),void earcutLinked(y,r,i,o,a,l)}g=g.next}h=h.next}while(h!==t)}function compareX(t,r){return t.x-r.x}function eliminateHole(t,r){if(r=function findHoleBridge(t,r){var i,o=r,a=t.x,l=t.y,h=-1/0;do{if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){var g=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(g<=a&&g>h){if(h=g,g===a){if(l===o.y)return o;if(l===o.next.y)return o.next}i=o.x<o.next.x?o:o.next}}o=o.next}while(o!==r);if(!i)return null;if(a===h)return i;var y,_=i,x=i.x,w=i.y,S=1/0;o=i;do{a>=o.x&&o.x>=x&&a!==o.x&&pointInTriangle(l<w?a:h,l,x,w,l<w?h:a,l,o.x,o.y)&&(y=Math.abs(l-o.y)/(a-o.x),locallyInside(o,t)&&(y<S||y===S&&(o.x>i.x||o.x===i.x&&sectorContainsSector(i,o)))&&(i=o,S=y)),o=o.next}while(o!==_);return i}(t,r)){var i=splitPolygon(r,t);filterPoints(r,r.next),filterPoints(i,i.next)}}function sectorContainsSector(t,r){return area(t.prev,t,r.prev)<0&&area(r.next,t,t.next)<0}function zOrder(t,r,i,o,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)*a)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function getLeftmost(t){var r=t,i=t;do{(r.x<i.x||r.x===i.x&&r.y<i.y)&&(i=r),r=r.next}while(r!==t);return i}function pointInTriangle(t,r,i,o,a,l,h,g){return(a-h)*(r-g)-(t-h)*(l-g)>=0&&(t-h)*(o-g)-(i-h)*(r-g)>=0&&(i-h)*(l-g)-(a-h)*(o-g)>=0}function isValidDiagonal(t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!function intersectsPolygon(t,r){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==r.i&&i.next.i!==r.i&&intersects(i,i.next,t,r))return!0;i=i.next}while(i!==t);return!1}(t,r)&&(locallyInside(t,r)&&locallyInside(r,t)&&function middleInside(t,r){var i=t,o=!1,a=(t.x+r.x)/2,l=(t.y+r.y)/2;do{i.y>l!=i.next.y>l&&i.next.y!==i.y&&a<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next}while(i!==t);return o}(t,r)&&(area(t.prev,t,r.prev)||area(t,r.prev,r))||equals(t,r)&&area(t.prev,t,t.next)>0&&area(r.prev,r,r.next)>0)}function area(t,r,i){return(r.y-t.y)*(i.x-r.x)-(r.x-t.x)*(i.y-r.y)}function equals(t,r){return t.x===r.x&&t.y===r.y}function intersects(t,r,i,o){var a=sign(area(t,r,i)),l=sign(area(t,r,o)),h=sign(area(i,o,t)),g=sign(area(i,o,r));return a!==l&&h!==g||(!(0!==a||!onSegment(t,i,r))||(!(0!==l||!onSegment(t,o,r))||(!(0!==h||!onSegment(i,t,o))||!(0!==g||!onSegment(i,r,o)))))}function onSegment(t,r,i){return r.x<=Math.max(t.x,i.x)&&r.x>=Math.min(t.x,i.x)&&r.y<=Math.max(t.y,i.y)&&r.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function locallyInside(t,r){return area(t.prev,t,t.next)<0?area(t,r,t.next)>=0&&area(t,t.prev,r)>=0:area(t,r,t.prev)<0||area(t,t.next,r)<0}function splitPolygon(t,r){var i=new Node(t.i,t.x,t.y),o=new Node(r.i,r.x,r.y),a=t.next,l=r.prev;return t.next=r,r.prev=t,i.next=a,a.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function insertNode(t,r,i,o){var a=new Node(t,r,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,r,i){this.i=t,this.x=r,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,r,i,o){for(var a=0,l=r,h=i-o;l<i;l+=o)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}t.exports=earcut,t.exports.default=earcut,earcut.deviation=function(t,r,i,o){var a=r&&r.length,l=a?r[0]*i:t.length,h=Math.abs(signedArea(t,0,l,i));if(a)for(var g=0,y=r.length;g<y;g++){var _=r[g]*i,x=g<y-1?r[g+1]*i:t.length;h-=Math.abs(signedArea(t,_,x,i))}var w=0;for(g=0;g<o.length;g+=3){var S=o[g]*i,M=o[g+1]*i,T=o[g+2]*i;w+=Math.abs((t[S]-t[T])*(t[M+1]-t[S+1])-(t[S]-t[M])*(t[T+1]-t[S+1]))}return 0===h&&0===w?0:Math.abs((w-h)/h)},earcut.flatten=function(t){for(var r=t[0][0].length,i={vertices:[],holes:[],dimensions:r},o=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var h=0;h<r;h++)i.vertices.push(t[a][l][h]);a>0&&(o+=t[a-1].length,i.holes.push(o))}return i}},function(t,r,i){"use strict";i.r(r),i.d(r,"createRenderer",(function(){return createWebGLRenderer2D})),i.d(r,"createWebGLRenderer2D",(function(){return createWebGLRenderer2D}));var o={};i.r(o),i.d(o,"isMobile",(function(){return k})),i.d(o,"EventEmitter",(function(){return ee.a})),i.d(o,"earcut",(function(){return ne.a})),i.d(o,"url",(function(){return ie.a})),i.d(o,"BaseTextureCache",(function(){return pe})),i.d(o,"CanvasRenderTarget",(function(){return fe})),i.d(o,"DATA_URI",(function(){return ge})),i.d(o,"ProgramCache",(function(){return de})),i.d(o,"TextureCache",(function(){return he})),i.d(o,"clearTextureCache",(function(){return clearTextureCache})),i.d(o,"correctBlendMode",(function(){return correctBlendMode})),i.d(o,"createIndicesForQuads",(function(){return createIndicesForQuads})),i.d(o,"decomposeDataUri",(function(){return decomposeDataUri})),i.d(o,"deprecation",(function(){return deprecation})),i.d(o,"destroyTextureCache",(function(){return destroyTextureCache})),i.d(o,"determineCrossOrigin",(function(){return determineCrossOrigin})),i.d(o,"getBufferType",(function(){return getBufferType})),i.d(o,"getResolutionOfUrl",(function(){return getResolutionOfUrl})),i.d(o,"hex2rgb",(function(){return hex2rgb})),i.d(o,"hex2string",(function(){return hex2string})),i.d(o,"interleaveTypedArrays",(function(){return interleaveTypedArrays})),i.d(o,"isPow2",(function(){return isPow2})),i.d(o,"isWebGLSupported",(function(){return isWebGLSupported})),i.d(o,"log2",(function(){return log2})),i.d(o,"nextPow2",(function(){return nextPow2})),i.d(o,"premultiplyBlendMode",(function(){return se})),i.d(o,"premultiplyRgba",(function(){return premultiplyRgba})),i.d(o,"premultiplyTint",(function(){return premultiplyTint})),i.d(o,"premultiplyTintToRgba",(function(){return premultiplyTintToRgba})),i.d(o,"removeItems",(function(){return removeItems})),i.d(o,"rgb2hex",(function(){return rgb2hex})),i.d(o,"sayHello",(function(){return sayHello})),i.d(o,"sign",(function(){return sign})),i.d(o,"skipHello",(function(){return skipHello})),i.d(o,"string2hex",(function(){return string2hex})),i.d(o,"trimCanvas",(function(){return trimCanvas})),i.d(o,"uid",(function(){return uid}));var a={};i.r(a),i.d(a,"AccessibilityManager",(function(){return Ue})),i.d(a,"accessibleTarget",(function(){return He}));var l={};i.r(l),i.d(l,"InteractionData",(function(){return $e})),i.d(l,"InteractionEvent",(function(){return Ke})),i.d(l,"InteractionManager",(function(){return tt})),i.d(l,"InteractionTrackingData",(function(){return Ye})),i.d(l,"interactiveTarget",(function(){return Je}));var h={};i.r(h),i.d(h,"accessibility",(function(){return a})),i.d(h,"interaction",(function(){return l})),i.d(h,"utils",(function(){return o})),i.d(h,"Application",(function(){return nr})),i.d(h,"AbstractBatchRenderer",(function(){return Xn})),i.d(h,"AbstractRenderer",(function(){return Fn})),i.d(h,"Attribute",(function(){return Ct})),i.d(h,"BaseRenderTexture",(function(){return wt})),i.d(h,"BaseTexture",(function(){return ut})),i.d(h,"BatchDrawCall",(function(){return zn})),i.d(h,"BatchGeometry",(function(){return Yn})),i.d(h,"BatchPluginFactory",(function(){return Jn})),i.d(h,"BatchRenderer",(function(){return tr})),i.d(h,"BatchShaderGenerator",(function(){return Kn})),i.d(h,"BatchTextureArray",(function(){return Wn})),i.d(h,"Buffer",(function(){return Ot})),i.d(h,"CubeTexture",(function(){return Un})),i.d(h,"Filter",(function(){return vn})),i.d(h,"Framebuffer",(function(){return _t})),i.d(h,"GLProgram",(function(){return An})),i.d(h,"GLTexture",(function(){return Nn})),i.d(h,"Geometry",(function(){return Nt})),i.d(h,"MaskData",(function(){return Yt})),i.d(h,"ObjectRenderer",(function(){return Vt})),i.d(h,"Program",(function(){return dn})),i.d(h,"Quad",(function(){return kt})),i.d(h,"QuadUv",(function(){return Dt})),i.d(h,"RenderTexture",(function(){return Tt})),i.d(h,"RenderTexturePool",(function(){return Pt})),i.d(h,"Renderer",(function(){return Gn})),i.d(h,"Shader",(function(){return pn})),i.d(h,"SpriteMaskFilter",(function(){return xn})),i.d(h,"State",(function(){return mn})),i.d(h,"System",(function(){return yt})),i.d(h,"Texture",(function(){return Et})),i.d(h,"TextureMatrix",(function(){return bn})),i.d(h,"TextureUvs",(function(){return St})),i.d(h,"UniformGroup",(function(){return Ft})),i.d(h,"ViewableBuffer",(function(){return qn})),i.d(h,"autoDetectRenderer",(function(){return autoDetectRenderer})),i.d(h,"checkMaxIfStatementsInShader",(function(){return checkMaxIfStatementsInShader})),i.d(h,"defaultFilterVertex",(function(){return Vn})),i.d(h,"defaultVertex",(function(){return Hn})),i.d(h,"resources",(function(){return vt})),i.d(h,"systems",(function(){return Dn})),i.d(h,"Extract",(function(){return ar})),i.d(h,"AppLoaderPlugin",(function(){return xr})),i.d(h,"Loader",(function(){return _r})),i.d(h,"LoaderResource",(function(){return wr})),i.d(h,"TextureLoader",(function(){return br})),i.d(h,"ParticleContainer",(function(){return Sr})),i.d(h,"ParticleRenderer",(function(){return Er})),i.d(h,"BasePrepare",(function(){return ci})),i.d(h,"CountLimiter",(function(){return si})),i.d(h,"Prepare",(function(){return li})),i.d(h,"TimeLimiter",(function(){return ui})),i.d(h,"Spritesheet",(function(){return di})),i.d(h,"SpritesheetLoader",(function(){return pi})),i.d(h,"TilingSprite",(function(){return mi})),i.d(h,"TilingSpriteRenderer",(function(){return yi})),i.d(h,"BitmapFontLoader",(function(){return _i})),i.d(h,"BitmapText",(function(){return bi})),i.d(h,"Ticker",(function(){return We})),i.d(h,"TickerPlugin",(function(){return qe})),i.d(h,"UPDATE_PRIORITY",(function(){return Ve})),i.d(h,"ALPHA_MODES",(function(){return X})),i.d(h,"BLEND_MODES",(function(){return G})),i.d(h,"DRAW_MODES",(function(){return H})),i.d(h,"ENV",(function(){return D})),i.d(h,"FORMATS",(function(){return V})),i.d(h,"GC_MODES",(function(){return K})),i.d(h,"MASK_TYPES",(function(){return Z})),i.d(h,"MIPMAP_MODES",(function(){return $})),i.d(h,"PRECISION",(function(){return Y})),i.d(h,"RENDERER_TYPE",(function(){return B})),i.d(h,"SCALE_MODES",(function(){return W})),i.d(h,"TARGETS",(function(){return U})),i.d(h,"TYPES",(function(){return z})),i.d(h,"WRAP_MODES",(function(){return q})),i.d(h,"Bounds",(function(){return Be})),i.d(h,"Container",(function(){return Ge})),i.d(h,"DisplayObject",(function(){return Fe})),i.d(h,"FillStyle",(function(){return Pr})),i.d(h,"GRAPHICS_CURVES",(function(){return Tr})),i.d(h,"Graphics",(function(){return Xr})),i.d(h,"GraphicsData",(function(){return Hr})),i.d(h,"GraphicsGeometry",(function(){return zr})),i.d(h,"LineStyle",(function(){return Wr})),i.d(h,"graphicsUtils",(function(){return Gr})),i.d(h,"Circle",(function(){return je})),i.d(h,"DEG_TO_RAD",(function(){return we})),i.d(h,"Ellipse",(function(){return Ne})),i.d(h,"Matrix",(function(){return Se})),i.d(h,"ObservablePoint",(function(){return be})),i.d(h,"PI_2",(function(){return _e})),i.d(h,"Point",(function(){return ye})),i.d(h,"Polygon",(function(){return ke})),i.d(h,"RAD_TO_DEG",(function(){return xe})),i.d(h,"Rectangle",(function(){return Re})),i.d(h,"RoundedRectangle",(function(){return De})),i.d(h,"SHAPES",(function(){return ve})),i.d(h,"Transform",(function(){return Ie})),i.d(h,"groupD8",(function(){return Le})),i.d(h,"Mesh",(function(){return Ni})),i.d(h,"MeshBatchUvs",(function(){return Ii})),i.d(h,"MeshGeometry",(function(){return Di})),i.d(h,"MeshMaterial",(function(){return ki})),i.d(h,"NineSlicePlane",(function(){return Ui})),i.d(h,"PlaneGeometry",(function(){return Bi})),i.d(h,"RopeGeometry",(function(){return Fi})),i.d(h,"SimpleMesh",(function(){return Vi})),i.d(h,"SimplePlane",(function(){return Hi})),i.d(h,"SimpleRope",(function(){return Gi})),i.d(h,"Runner",(function(){return nt})),i.d(h,"Sprite",(function(){return Zr})),i.d(h,"AnimatedSprite",(function(){return zi})),i.d(h,"TEXT_GRADIENT",(function(){return Qr})),i.d(h,"Text",(function(){return ai})),i.d(h,"TextMetrics",(function(){return ri})),i.d(h,"TextStyle",(function(){return ti})),i.d(h,"isMobile",(function(){return k})),i.d(h,"settings",(function(){return Q})),i.d(h,"VERSION",(function(){return qi})),i.d(h,"filters",(function(){return $i})),i.d(h,"useDeprecated",(function(){return useDeprecated}));var g={};i.r(g),i.d(g,"blinkSquare",(function(){return blinkSquare})),i.d(g,"createCaptureHintObj",(function(){return create_capture_hint_obj_createCaptureHintObj})),i.d(g,"createHighlightedSquareObj",(function(){return create_highlighted_square_obj_createHighlightedSquareObj})),i.d(g,"createHoverSquareObj",(function(){return createHoverSquareObj})),i.d(g,"createMoveHintObj",(function(){return create_move_hint_obj_createMoveHintObj})),i.d(g,"dragPiece",(function(){return dragPiece})),i.d(g,"dropPiece",(function(){return dropPiece})),i.d(g,"hideCustomItem",(function(){return hideCustomItem})),i.d(g,"hideHighlightedSquare",(function(){return hideHighlightedSquare})),i.d(g,"hideHint",(function(){return hideHint})),i.d(g,"loadAssets",(function(){return loadAssets})),i.d(g,"movePiece",(function(){return movePiece})),i.d(g,"showHighlightedSquare",(function(){return showHighlightedSquare})),i.d(g,"showHoverSquare",(function(){return show_hover_square_showHoverSquare})),i.d(g,"showHint",(function(){return showHint}));var y={};i.r(y),i.d(y,"attackKing",(function(){return attackKing})),i.d(y,"blinkSquare",(function(){return blink_square_blinkSquare})),i.d(y,"capturePiece",(function(){return capturePiece})),i.d(y,"dragPiece",(function(){return drag_piece_dragPiece})),i.d(y,"dropPiece",(function(){return drop_piece_dropPiece})),i.d(y,"hideCustomItem",(function(){return hide_custom_item_hideCustomItem})),i.d(y,"hideHighlightedSquare",(function(){return hide_highlighted_square_hideHighlightedSquare})),i.d(y,"hideHint",(function(){return hide_move_hint_hideHint})),i.d(y,"hidePromotionWindow",(function(){return hidePromotionWindow})),i.d(y,"loadAssets",(function(){return load_assets_loadAssets})),i.d(y,"movePiece",(function(){return move_piece_movePiece})),i.d(y,"pieceOut",(function(){return pieceOut})),i.d(y,"pieceOver",(function(){return pieceOver})),i.d(y,"restorePiece",(function(){return restorePiece})),i.d(y,"showHighlightedSquare",(function(){return show_highlighted_square_showHighlightedSquare})),i.d(y,"showHint",(function(){return show_move_hint_showHint})),i.d(y,"showPromotionWindow",(function(){return showPromotionWindow}));i(107);var _=i(10);function blinkSquare(t,r){var i=r.square,o=r.interval,a=r.times;return t.animator.play({duration:o,easing:_.c,keyframes:{0:{alpha:0},50:{alpha:1},100:{alpha:0}},repeat:a,target:i.obj})}i(108);const x=/iPhone/i,w=/iPod/i,S=/iPad/i,M=/\bAndroid(?:.+)Mobile\b/i,T=/Android/i,P=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,C=/Silk/i,A=/Windows Phone/i,O=/\bWindows(?:.+)ARM\b/i,L=/BlackBerry/i,I=/BB10/i,R=/Opera Mini/i,j=/\b(CriOS|Chrome)(?:.+)Mobile/i,N=/Mobile(?:.+)Firefox\b/i;function match(t,r){return t.test(r)}var k=function isMobile(t){let r=(t=t||("undefined"!=typeof navigator?navigator.userAgent:"")).split("[FBAN");void 0!==r[1]&&(t=r[0]),r=t.split("Twitter"),void 0!==r[1]&&(t=r[0]);const i={apple:{phone:match(x,t)&&!match(A,t),ipod:match(w,t),tablet:!match(x,t)&&match(S,t)&&!match(A,t),device:(match(x,t)||match(w,t)||match(S,t))&&!match(A,t)},amazon:{phone:match(P,t),tablet:!match(P,t)&&match(C,t),device:match(P,t)||match(C,t)},android:{phone:!match(A,t)&&match(P,t)||!match(A,t)&&match(M,t),tablet:!match(A,t)&&!match(P,t)&&!match(M,t)&&(match(C,t)||match(T,t)),device:!match(A,t)&&(match(P,t)||match(C,t)||match(M,t)||match(T,t))||match(/\bokhttp\b/i,t)},windows:{phone:match(A,t),tablet:match(O,t),device:match(A,t)||match(O,t)},other:{blackberry:match(L,t),blackberry10:match(I,t),opera:match(R,t),firefox:match(N,t),chrome:match(j,t),device:match(L,t)||match(I,t)||match(R,t)||match(N,t)||match(j,t)},any:!1,phone:!1,tablet:!1};return i.any=i.apple.device||i.android.device||i.windows.device||i.other.device,i.phone=i.apple.phone||i.android.phone||i.windows.phone,i.tablet=i.apple.tablet||i.android.tablet||i.windows.tablet,i}();var D,B,G,H,V,U,z,W,q,$,X,K,Y,Z,Q={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function maxRecommendedTextures(t){var r=!0;if(k.tablet||k.phone){if(r=!1,k.apple.device){var i=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(i)parseInt(i[1],10)>=11&&(r=!0)}if(k.android.device){var o=navigator.userAgent.match(/Android\s([0-9.]*)/);if(o)parseInt(o[1],10)>=7&&(r=!0)}}return r?t:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:k.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:function canUploadSameBuffer(){return!k.apple.device}(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},J=i(75),ee=i.n(J),te=i(76),ne=i.n(te),re=i(61),ie=i.n(re);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(D||(D={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(B||(B={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(G||(G={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(H||(H={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(V||(V={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(U||(U={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(z||(z={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(W||(W={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(q||(q={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}($||($={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(X||(X={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(K||(K={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(Y||(Y={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(Z||(Z={})),Q.RETINA_PREFIX=/@([0-9\.]+)x/,Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var oe,ae=!1;function skipHello(){ae=!0}function sayHello(t){var r;if(!ae){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["\n %c %c %c PixiJS 5.2.1 - ✰ "+t+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(r=window.console).log.apply(r,i)}else window.console&&window.console.log("PixiJS 5.2.1 - "+t+" - http://www.pixijs.com/");ae=!0}}function isWebGLSupported(){return void 0===oe&&(oe=function supported(){var t={stencil:!0,failIfMajorPerformanceCaveat:Q.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var r=document.createElement("canvas"),i=r.getContext("webgl",t)||r.getContext("experimental-webgl",t),o=!(!i||!i.getContextAttributes().stencil);if(i){var a=i.getExtension("WEBGL_lose_context");a&&a.loseContext()}return i=null,o}catch(l){return!1}}()),oe}function hex2rgb(t,r){return(r=r||[])[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,r}function hex2string(t){var r=t.toString(16);return"#"+(r="000000".substr(0,6-r.length)+r)}function string2hex(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}function rgb2hex(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}var se=function mapPremultipliedBlendModes(){for(var t=[],r=[],i=0;i<32;i++)t[i]=i,r[i]=i;t[G.NORMAL_NPM]=G.NORMAL,t[G.ADD_NPM]=G.ADD,t[G.SCREEN_NPM]=G.SCREEN,r[G.NORMAL]=G.NORMAL_NPM,r[G.ADD]=G.ADD_NPM,r[G.SCREEN]=G.SCREEN_NPM;var o=[];return o.push(r),o.push(t),o}();function correctBlendMode(t,r){return se[r?1:0][t]}function premultiplyRgba(t,r,i,o){return i=i||new Float32Array(4),o||void 0===o?(i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=r,i}function premultiplyTint(t,r){if(1===r)return(255*r<<24)+t;if(0===r)return 0;var i=t>>16&255,o=t>>8&255,a=255&t;return(255*r<<24)+((i=i*r+.5|0)<<16)+((o=o*r+.5|0)<<8)+(a=a*r+.5|0)}function premultiplyTintToRgba(t,r,i,o){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,(o||void 0===o)&&(i[0]*=r,i[1]*=r,i[2]*=r),i[3]=r,i}function createIndicesForQuads(t,r){void 0===r&&(r=null);var i=6*t;if((r=r||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+r.length+" and expected "+i);for(var o=0,a=0;o<i;o+=6,a+=4)r[o+0]=a+0,r[o+1]=a+1,r[o+2]=a+2,r[o+3]=a+0,r[o+4]=a+2,r[o+5]=a+3;return r}function getBufferType(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}var ce={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function interleaveTypedArrays(t,r){for(var i=0,o=0,a={},l=0;l<t.length;l++)o+=r[l],i+=t[l].length;var h=new ArrayBuffer(4*i),g=null,y=0;for(l=0;l<t.length;l++){var _=r[l],x=t[l],w=getBufferType(x);a[w]||(a[w]=new ce[w](h)),g=a[w];for(var S=0;S<x.length;S++){g[(S/_|0)*o+y+S%_]=x[S]}y+=_}return new Float32Array(h)}function nextPow2(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function isPow2(t){return!(t&t-1||!t)}function log2(t){var r=(t>65535?1:0)<<4,i=((t>>>=r)>255?1:0)<<3;return r|=i,r|=i=((t>>>=i)>15?1:0)<<2,(r|=i=((t>>>=i)>3?1:0)<<1)|(t>>>=i)>>1}function removeItems(t,r,i){var o,a=t.length;if(!(r>=a||0===i)){var l=a-(i=r+i>a?a-r:i);for(o=r;o<l;++o)t[o]=t[o+i];t.length=l}}function sign(t){return 0===t?0:t<0?-1:1}var le=0;function uid(){return++le}var ue={};function deprecation(t,r,i){if(void 0===i&&(i=3),!ue[r]){var o=(new Error).stack;void 0===o?console.warn("PixiJS Deprecation Warning: ",r+"\nDeprecated since v"+t):(o=o.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",r+"\nDeprecated since v"+t),console.warn(o),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",r+"\nDeprecated since v"+t),console.warn(o))),ue[r]=!0}}var de={},he=Object.create(null),pe=Object.create(null);function destroyTextureCache(){var t;for(t in he)he[t].destroy();for(t in pe)pe[t].destroy()}function clearTextureCache(){var t;for(t in he)delete he[t];for(t in pe)delete pe[t]}var fe=function(){function CanvasRenderTarget(t,r,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||Q.RESOLUTION,this.resize(t,r)}return CanvasRenderTarget.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget.prototype.resize=function(t,r){this.canvas.width=t*this.resolution,this.canvas.height=r*this.resolution},CanvasRenderTarget.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(CanvasRenderTarget.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(CanvasRenderTarget.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!0,configurable:!0}),CanvasRenderTarget}();function trimCanvas(t){var r,i,o,a=t.width,l=t.height,h=t.getContext("2d"),g=h.getImageData(0,0,a,l).data,y=g.length,_={top:null,left:null,right:null,bottom:null},x=null;for(r=0;r<y;r+=4)0!==g[r+3]&&(i=r/4%a,o=~~(r/4/a),null===_.top&&(_.top=o),(null===_.left||i<_.left)&&(_.left=i),(null===_.right||_.right<i)&&(_.right=i+1),(null===_.bottom||_.bottom<o)&&(_.bottom=o));return null!==_.top&&(a=_.right-_.left,l=_.bottom-_.top+1,x=h.getImageData(_.left,_.top,a,l)),{height:l,width:a,data:x}}var me,ge=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function decomposeDataUri(t){var r=ge.exec(t);if(r)return{mediaType:r[1]?r[1].toLowerCase():void 0,subType:r[2]?r[2].toLowerCase():void 0,charset:r[3]?r[3].toLowerCase():void 0,encoding:r[4]?r[4].toLowerCase():void 0,data:r[5]}}function determineCrossOrigin(t,r){if(void 0===r&&(r=window.location),0===t.indexOf("data:"))return"";r=r||window.location,me||(me=document.createElement("a")),me.href=t;var i=Object(re.parse)(me.href),o=!i.port&&""===r.port||i.port===r.port;return i.hostname===r.hostname&&o&&i.protocol===r.protocol?"":"anonymous"}function getResolutionOfUrl(t,r){var i=Q.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):void 0!==r?r:1}var ve,ye=function(){function Point(t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.x=t,this.y=r}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},Point.prototype.copyTo=function(t){return t.set(this.x,this.y),t},Point.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Point.prototype.set=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=t),this.x=t,this.y=r,this},Point}(),be=function(){function ObservablePoint(t,r,i,o){void 0===i&&(i=0),void 0===o&&(o=0),this._x=i,this._y=o,this.cb=t,this.scope=r}return ObservablePoint.prototype.clone=function(t,r){return void 0===t&&(t=this.cb),void 0===r&&(r=this.scope),new ObservablePoint(t,r,this._x,this._y)},ObservablePoint.prototype.set=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=t),this._x===t&&this._y===r||(this._x=t,this._y=r,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyTo=function(t){return t.set(this._x,this._y),t},ObservablePoint.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(ObservablePoint.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(ObservablePoint.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),ObservablePoint}(),_e=2*Math.PI,xe=180/Math.PI,we=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(ve||(ve={}));var Se=function(){function Matrix(t,r,i,o,a,l){void 0===t&&(t=1),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),this.array=null,this.a=t,this.b=r,this.c=i,this.d=o,this.tx=a,this.ty=l}return Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},Matrix.prototype.set=function(t,r,i,o,a,l){return this.a=t,this.b=r,this.c=i,this.d=o,this.tx=a,this.ty=l,this},Matrix.prototype.toArray=function(t,r){this.array||(this.array=new Float32Array(9));var i=r||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},Matrix.prototype.apply=function(t,r){r=r||new ye;var i=t.x,o=t.y;return r.x=this.a*i+this.c*o+this.tx,r.y=this.b*i+this.d*o+this.ty,r},Matrix.prototype.applyInverse=function(t,r){r=r||new ye;var i=1/(this.a*this.d+this.c*-this.b),o=t.x,a=t.y;return r.x=this.d*i*o+-this.c*i*a+(this.ty*this.c-this.tx*this.d)*i,r.y=this.a*i*a+-this.b*i*o+(-this.ty*this.a+this.tx*this.b)*i,r},Matrix.prototype.translate=function(t,r){return this.tx+=t,this.ty+=r,this},Matrix.prototype.scale=function(t,r){return this.a*=t,this.d*=r,this.c*=t,this.b*=r,this.tx*=t,this.ty*=r,this},Matrix.prototype.rotate=function(t){var r=Math.cos(t),i=Math.sin(t),o=this.a,a=this.c,l=this.tx;return this.a=o*r-this.b*i,this.b=o*i+this.b*r,this.c=a*r-this.d*i,this.d=a*i+this.d*r,this.tx=l*r-this.ty*i,this.ty=l*i+this.ty*r,this},Matrix.prototype.append=function(t){var r=this.a,i=this.b,o=this.c,a=this.d;return this.a=t.a*r+t.b*o,this.b=t.a*i+t.b*a,this.c=t.c*r+t.d*o,this.d=t.c*i+t.d*a,this.tx=t.tx*r+t.ty*o+this.tx,this.ty=t.tx*i+t.ty*a+this.ty,this},Matrix.prototype.setTransform=function(t,r,i,o,a,l,h,g,y){return this.a=Math.cos(h+y)*a,this.b=Math.sin(h+y)*a,this.c=-Math.sin(h-g)*l,this.d=Math.cos(h-g)*l,this.tx=t-(i*this.a+o*this.c),this.ty=r-(i*this.b+o*this.d),this},Matrix.prototype.prepend=function(t){var r=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,o=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=o*t.a+this.d*t.c,this.d=o*t.b+this.d*t.d}return this.tx=r*t.a+this.ty*t.c+t.tx,this.ty=r*t.b+this.ty*t.d+t.ty,this},Matrix.prototype.decompose=function(t){var r=this.a,i=this.b,o=this.c,a=this.d,l=-Math.atan2(-o,a),h=Math.atan2(i,r),g=Math.abs(l+h);return g<1e-5||Math.abs(_e-g)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=l,t.skew.y=h),t.scale.x=Math.sqrt(r*r+i*i),t.scale.y=Math.sqrt(o*o+a*a),t.position.x=this.tx,t.position.y=this.ty,t},Matrix.prototype.invert=function(){var t=this.a,r=this.b,i=this.c,o=this.d,a=this.tx,l=t*o-r*i;return this.a=o/l,this.b=-r/l,this.c=-i/l,this.d=t/l,this.tx=(i*this.ty-o*a)/l,this.ty=-(t*this.ty-r*a)/l,this},Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix.prototype.clone=function(){var t=new Matrix;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Matrix.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Matrix.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(Matrix,"IDENTITY",{get:function(){return new Matrix},enumerable:!0,configurable:!0}),Object.defineProperty(Matrix,"TEMP_MATRIX",{get:function(){return new Matrix},enumerable:!0,configurable:!0}),Matrix}(),Me=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ee=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Te=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Pe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ce=[],Ae=[],Oe=Math.sign;!function init(){for(var t=0;t<16;t++){var r=[];Ce.push(r);for(var i=0;i<16;i++)for(var o=Oe(Me[t]*Me[i]+Te[t]*Ee[i]),a=Oe(Ee[t]*Me[i]+Pe[t]*Ee[i]),l=Oe(Me[t]*Te[i]+Te[t]*Pe[i]),h=Oe(Ee[t]*Te[i]+Pe[t]*Pe[i]),g=0;g<16;g++)if(Me[g]===o&&Ee[g]===a&&Te[g]===l&&Pe[g]===h){r.push(g);break}}for(t=0;t<16;t++){var y=new Se;y.set(Me[t],Ee[t],Te[t],Pe[t],0,0),Ae.push(y)}}();var Le={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Me[t]},uY:function(t){return Ee[t]},vX:function(t){return Te[t]},vY:function(t){return Pe[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,r){return Ce[t][r]},sub:function(t,r){return Ce[t][Le.inv(r)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,r){return 2*Math.abs(t)<=Math.abs(r)?r>=0?Le.S:Le.N:2*Math.abs(r)<=Math.abs(t)?t>0?Le.E:Le.W:r>0?t>0?Le.SE:Le.SW:t>0?Le.NE:Le.NW},matrixAppendRotationInv:function(t,r,i,o){void 0===i&&(i=0),void 0===o&&(o=0);var a=Ae[Le.inv(r)];a.tx=i,a.ty=o,t.append(a)}},Ie=function(){function Transform(){this.worldTransform=new Se,this.localTransform=new Se,this.position=new be(this.onChange,this,0,0),this.scale=new be(this.onChange,this,1,1),this.pivot=new be(this.onChange,this,0,0),this.skew=new be(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return Transform.prototype.onChange=function(){this._localID++},Transform.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},Transform.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},Transform.prototype.updateTransform=function(t){var r=this.localTransform;if(this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,o=this.worldTransform;o.a=r.a*i.a+r.b*i.c,o.b=r.a*i.b+r.b*i.d,o.c=r.c*i.a+r.d*i.c,o.d=r.c*i.b+r.d*i.d,o.tx=r.tx*i.a+r.ty*i.c+i.tx,o.ty=r.tx*i.b+r.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},Transform.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!0,configurable:!0}),Transform.IDENTITY=new Transform,Transform}(),Re=function(){function Rectangle(t,r,i,o){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=Number(t),this.y=Number(r),this.width=Number(i),this.height=Number(o),this.type=ve.RECT}return Object.defineProperty(Rectangle.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(Rectangle.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(Rectangle.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(Rectangle,"EMPTY",{get:function(){return new Rectangle(0,0,0,0)},enumerable:!0,configurable:!0}),Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},Rectangle.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},Rectangle.prototype.contains=function(t,r){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&r>=this.y&&r<this.y+this.height)},Rectangle.prototype.pad=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=t),this.x-=t,this.y-=r,this.width+=2*t,this.height+=2*r,this},Rectangle.prototype.fit=function(t){var r=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),o=Math.max(this.y,t.y),a=Math.min(this.y+this.height,t.y+t.height);return this.x=r,this.width=Math.max(i-r,0),this.y=o,this.height=Math.max(a-o,0),this},Rectangle.prototype.ceil=function(t,r){void 0===t&&(t=1),void 0===r&&(r=.001);var i=Math.ceil((this.x+this.width-r)*t)/t,o=Math.ceil((this.y+this.height-r)*t)/t;return this.x=Math.floor((this.x+r)*t)/t,this.y=Math.floor((this.y+r)*t)/t,this.width=i-this.x,this.height=o-this.y,this},Rectangle.prototype.enlarge=function(t){var r=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),o=Math.min(this.y,t.y),a=Math.max(this.y+this.height,t.y+t.height);return this.x=r,this.width=i-r,this.y=o,this.height=a-o,this},Rectangle}(),je=function(){function Circle(t,r,i){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=t,this.y=r,this.radius=i,this.type=ve.CIRC}return Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius)},Circle.prototype.contains=function(t,r){if(this.radius<=0)return!1;var i=this.radius*this.radius,o=this.x-t,a=this.y-r;return(o*=o)+(a*=a)<=i},Circle.prototype.getBounds=function(){return new Re(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},Circle}(),Ne=function(){function Ellipse(t,r,i,o){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),this.x=t,this.y=r,this.width=i,this.height=o,this.type=ve.ELIP}return Ellipse.prototype.clone=function(){return new Ellipse(this.x,this.y,this.width,this.height)},Ellipse.prototype.contains=function(t,r){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,o=(r-this.y)/this.height;return(i*=i)+(o*=o)<=1},Ellipse.prototype.getBounds=function(){return new Re(this.x-this.width,this.y-this.height,this.width,this.height)},Ellipse}(),ke=function(){function Polygon(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];if(Array.isArray(r[0])&&(r=r[0]),r[0]instanceof ye){for(var o=[],a=0,l=(r=r).length;a<l;a++)o.push(r[a].x,r[a].y);r=o}this.points=r,this.type=ve.POLY,this.closeStroke=!0}return Polygon.prototype.clone=function(){var t=new Polygon(this.points.slice());return t.closeStroke=this.closeStroke,t},Polygon.prototype.contains=function(t,r){for(var i=!1,o=this.points.length/2,a=0,l=o-1;a<o;l=a++){var h=this.points[2*a],g=this.points[2*a+1],y=this.points[2*l],_=this.points[2*l+1];g>r!=_>r&&t<(r-g)/(_-g)*(y-h)+h&&(i=!i)}return i},Polygon}(),De=function(){function RoundedRectangle(t,r,i,o,a){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=20),this.x=t,this.y=r,this.width=i,this.height=o,this.radius=a,this.type=ve.RREC}return RoundedRectangle.prototype.clone=function(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},RoundedRectangle.prototype.contains=function(t,r){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){if(r>=this.y+this.radius&&r<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var i=t-(this.x+this.radius),o=r-(this.y+this.radius),a=this.radius*this.radius;if(i*i+o*o<=a)return!0;if((i=t-(this.x+this.width-this.radius))*i+o*o<=a)return!0;if(i*i+(o=r-(this.y+this.height-this.radius))*o<=a)return!0;if((i=t-(this.x+this.radius))*i+o*o<=a)return!0}return!1},RoundedRectangle}();Q.SORTABLE_CHILDREN=!1;var Be=function Bounds(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};Be.prototype.isEmpty=function isEmpty(){return this.minX>this.maxX||this.minY>this.maxY},Be.prototype.clear=function clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},Be.prototype.getRectangle=function getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Re.EMPTY:((t=t||new Re(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},Be.prototype.addPoint=function addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},Be.prototype.addQuad=function addQuad(t){var r=this.minX,i=this.minY,o=this.maxX,a=this.maxY,l=t[0],h=t[1];r=l<r?l:r,i=h<i?h:i,o=l>o?l:o,a=h>a?h:a,r=(l=t[2])<r?l:r,i=(h=t[3])<i?h:i,o=l>o?l:o,a=h>a?h:a,r=(l=t[4])<r?l:r,i=(h=t[5])<i?h:i,o=l>o?l:o,a=h>a?h:a,r=(l=t[6])<r?l:r,i=(h=t[7])<i?h:i,o=l>o?l:o,a=h>a?h:a,this.minX=r,this.minY=i,this.maxX=o,this.maxY=a},Be.prototype.addFrame=function addFrame(t,r,i,o,a){this.addFrameMatrix(t.worldTransform,r,i,o,a)},Be.prototype.addFrameMatrix=function addFrameMatrix(t,r,i,o,a){var l=t.a,h=t.b,g=t.c,y=t.d,_=t.tx,x=t.ty,w=this.minX,S=this.minY,M=this.maxX,T=this.maxY,P=l*r+g*i+_,C=h*r+y*i+x;w=P<w?P:w,S=C<S?C:S,M=P>M?P:M,T=C>T?C:T,w=(P=l*o+g*i+_)<w?P:w,S=(C=h*o+y*i+x)<S?C:S,M=P>M?P:M,T=C>T?C:T,w=(P=l*r+g*a+_)<w?P:w,S=(C=h*r+y*a+x)<S?C:S,M=P>M?P:M,T=C>T?C:T,w=(P=l*o+g*a+_)<w?P:w,S=(C=h*o+y*a+x)<S?C:S,M=P>M?P:M,T=C>T?C:T,this.minX=w,this.minY=S,this.maxX=M,this.maxY=T},Be.prototype.addVertexData=function addVertexData(t,r,i){for(var o=this.minX,a=this.minY,l=this.maxX,h=this.maxY,g=r;g<i;g+=2){var y=t[g],_=t[g+1];o=y<o?y:o,a=_<a?_:a,l=y>l?y:l,h=_>h?_:h}this.minX=o,this.minY=a,this.maxX=l,this.maxY=h},Be.prototype.addVertices=function addVertices(t,r,i,o){this.addVerticesMatrix(t.worldTransform,r,i,o)},Be.prototype.addVerticesMatrix=function addVerticesMatrix(t,r,i,o,a,l){var h=t.a,g=t.b,y=t.c,_=t.d,x=t.tx,w=t.ty;a=a||0,l=l||0;for(var S=this.minX,M=this.minY,T=this.maxX,P=this.maxY,C=i;C<o;C+=2){var A=r[C],O=r[C+1],L=h*A+y*O+x,I=_*O+g*A+w;S=Math.min(S,L-a),T=Math.max(T,L+a),M=Math.min(M,I-l),P=Math.max(P,I+l)}this.minX=S,this.minY=M,this.maxX=T,this.maxY=P},Be.prototype.addBounds=function addBounds(t){var r=this.minX,i=this.minY,o=this.maxX,a=this.maxY;this.minX=t.minX<r?t.minX:r,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>o?t.maxX:o,this.maxY=t.maxY>a?t.maxY:a},Be.prototype.addBoundsMask=function addBoundsMask(t,r){var i=t.minX>r.minX?t.minX:r.minX,o=t.minY>r.minY?t.minY:r.minY,a=t.maxX<r.maxX?t.maxX:r.maxX,l=t.maxY<r.maxY?t.maxY:r.maxY;if(i<=a&&o<=l){var h=this.minX,g=this.minY,y=this.maxX,_=this.maxY;this.minX=i<h?i:h,this.minY=o<g?o:g,this.maxX=a>y?a:y,this.maxY=l>_?l:_}},Be.prototype.addBoundsMatrix=function addBoundsMatrix(t,r){this.addFrameMatrix(r,t.minX,t.minY,t.maxX,t.maxY)},Be.prototype.addBoundsArea=function addBoundsArea(t,r){var i=t.minX>r.x?t.minX:r.x,o=t.minY>r.y?t.minY:r.y,a=t.maxX<r.x+r.width?t.maxX:r.x+r.width,l=t.maxY<r.y+r.height?t.maxY:r.y+r.height;if(i<=a&&o<=l){var h=this.minX,g=this.minY,y=this.maxX,_=this.maxY;this.minX=i<h?i:h,this.minY=o<g?o:g,this.maxX=a>y?a:y,this.maxY=l>_?l:_}},Be.prototype.pad=function pad(t,r){t=t||0,r=r||(0!==r?t:0),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=r,this.maxY+=r)},Be.prototype.addFramePad=function addFramePad(t,r,i,o,a,l){t-=a,r-=l,i+=a,o+=l,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<r?this.minY:r,this.maxY=this.maxY>o?this.maxY:o};var Fe=function(t){function DisplayObject(){t.call(this),this.tempDisplayObjectParent=null,this.transform=new Ie,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Be,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}t&&(DisplayObject.__proto__=t),DisplayObject.prototype=Object.create(t&&t.prototype),DisplayObject.prototype.constructor=DisplayObject;var r={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return DisplayObject.mixin=function mixin(t){for(var r=Object.keys(t),i=0;i<r.length;++i){var o=r[i];Object.defineProperty(DisplayObject.prototype,o,Object.getOwnPropertyDescriptor(t,o))}},r._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new DisplayObject),this.tempDisplayObjectParent},DisplayObject.prototype.updateTransform=function updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},DisplayObject.prototype.calculateBounds=function calculateBounds(){},DisplayObject.prototype._recursivePostUpdateTransform=function _recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},DisplayObject.prototype.getBounds=function getBounds(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&(this.calculateBounds(),this._lastBoundsID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new Re),r=this._boundsRect),this._bounds.getRectangle(r)},DisplayObject.prototype.getLocalBounds=function getLocalBounds(t){var r=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new Re),t=this._localBoundsRect);var o=this.getBounds(!1,t);return this.parent=i,this.transform=r,o},DisplayObject.prototype.toGlobal=function toGlobal(t,r,i){return void 0===i&&(i=!1),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)},DisplayObject.prototype.toLocal=function toLocal(t,r,i,o){return r&&(t=r.toGlobal(t,i,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)},DisplayObject.prototype.render=function render(t){},DisplayObject.prototype.setParent=function setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},DisplayObject.prototype.setTransform=function setTransform(t,r,i,o,a,l,h,g,y){return void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===g&&(g=0),void 0===y&&(y=0),this.position.x=t,this.position.y=r,this.scale.x=i||1,this.scale.y=o||1,this.rotation=a,this.skew.x=l,this.skew.y=h,this.pivot.x=g,this.pivot.y=y,this},DisplayObject.prototype.destroy=function destroy(){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},r.x.get=function(){return this.position.x},r.x.set=function(t){this.transform.position.x=t},r.y.get=function(){return this.position.y},r.y.set=function(t){this.transform.position.y=t},r.worldTransform.get=function(){return this.transform.worldTransform},r.localTransform.get=function(){return this.transform.localTransform},r.position.get=function(){return this.transform.position},r.position.set=function(t){this.transform.position.copyFrom(t)},r.scale.get=function(){return this.transform.scale},r.scale.set=function(t){this.transform.scale.copyFrom(t)},r.pivot.get=function(){return this.transform.pivot},r.pivot.set=function(t){this.transform.pivot.copyFrom(t)},r.skew.get=function(){return this.transform.skew},r.skew.set=function(t){this.transform.skew.copyFrom(t)},r.rotation.get=function(){return this.transform.rotation},r.rotation.set=function(t){this.transform.rotation=t},r.angle.get=function(){return this.transform.rotation*xe},r.angle.set=function(t){this.transform.rotation=t*we},r.zIndex.get=function(){return this._zIndex},r.zIndex.set=function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},r.worldVisible.get=function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},r.mask.get=function(){return this._mask},r.mask.set=function(t){if(this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!0,r.isMask=!1}if(this._mask=t,this._mask){var i=this._mask.maskObject||this._mask;i.renderable=!1,i.isMask=!0}},Object.defineProperties(DisplayObject.prototype,r),DisplayObject}(ee.a);function sortChildren(t,r){return t.zIndex===r.zIndex?t._lastSortedIndex-r._lastSortedIndex:t.zIndex-r.zIndex}Fe.prototype.displayObjectUpdateTransform=Fe.prototype.updateTransform;var Ge=function(t){function Container(){t.call(this),this.children=[],this.sortableChildren=Q.SORTABLE_CHILDREN,this.sortDirty=!1}t&&(Container.__proto__=t),Container.prototype=Object.create(t&&t.prototype),Container.prototype.constructor=Container;var r={width:{configurable:!0},height:{configurable:!0}};return Container.prototype.onChildrenChange=function onChildrenChange(){},Container.prototype.addChild=function addChild(t){var r=arguments,i=arguments.length;if(i>1)for(var o=0;o<i;o++)this.addChild(r[o]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this);return t},Container.prototype.addChildAt=function addChildAt(t,r){if(r<0||r>this.children.length)throw new Error(t+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(r,0,t),this._boundsID++,this.onChildrenChange(r),t.emit("added",this),this.emit("childAdded",t,this,r),t},Container.prototype.swapChildren=function swapChildren(t,r){if(t!==r){var i=this.getChildIndex(t),o=this.getChildIndex(r);this.children[i]=r,this.children[o]=t,this.onChildrenChange(i<o?i:o)}},Container.prototype.getChildIndex=function getChildIndex(t){var r=this.children.indexOf(t);if(-1===r)throw new Error("The supplied DisplayObject must be a child of the caller");return r},Container.prototype.setChildIndex=function setChildIndex(t,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(t);removeItems(this.children,i,1),this.children.splice(r,0,t),this.onChildrenChange(r)},Container.prototype.getChildAt=function getChildAt(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},Container.prototype.removeChild=function removeChild(t){var r=arguments,i=arguments.length;if(i>1)for(var o=0;o<i;o++)this.removeChild(r[o]);else{var a=this.children.indexOf(t);if(-1===a)return null;t.parent=null,t.transform._parentID=-1,removeItems(this.children,a,1),this._boundsID++,this.onChildrenChange(a),t.emit("removed",this),this.emit("childRemoved",t,this,a)}return t},Container.prototype.removeChildAt=function removeChildAt(t){var r=this.getChildAt(t);return r.parent=null,r.transform._parentID=-1,removeItems(this.children,t,1),this._boundsID++,this.onChildrenChange(t),r.emit("removed",this),this.emit("childRemoved",r,this,t),r},Container.prototype.removeChildren=function removeChildren(t,r){void 0===t&&(t=0);var i,o=t,a="number"==typeof r?r:this.children.length,l=a-o;if(l>0&&l<=a){i=this.children.splice(o,l);for(var h=0;h<i.length;++h)i[h].parent=null,i[h].transform&&(i[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var g=0;g<i.length;++g)i[g].emit("removed",this),this.emit("childRemoved",i[g],this,g);return i}if(0===l&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},Container.prototype.sortChildren=function sortChildren$1(){for(var t=!1,r=0,i=this.children.length;r<i;++r){var o=this.children[r];o._lastSortedIndex=r,t||0===o.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},Container.prototype.updateTransform=function updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,r=this.children.length;t<r;++t){var i=this.children[t];i.visible&&i.updateTransform()}},Container.prototype.calculateBounds=function calculateBounds(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var r=this.children[t];if(r.visible&&r.renderable)if(r.calculateBounds(),r._mask){var i=r._mask.maskObject||r._mask;i.calculateBounds(),this._bounds.addBoundsMask(r._bounds,i._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._lastBoundsID=this._boundsID},Container.prototype._calculateBounds=function _calculateBounds(){},Container.prototype.render=function render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var r=0,i=this.children.length;r<i;++r)this.children[r].render(t)}},Container.prototype.renderAdvanced=function renderAdvanced(t){t.batch.flush();var r=this.filters,i=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var o=0;o<r.length;o++)r[o].enabled&&this._enabledFilters.push(r[o]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}i&&t.mask.push(this,this._mask),this._render(t);for(var a=0,l=this.children.length;a<l;a++)this.children[a].render(t);t.batch.flush(),i&&t.mask.pop(this,this._mask),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},Container.prototype._render=function _render(t){},Container.prototype.destroy=function destroy(r){t.prototype.destroy.call(this),this.sortDirty=!1;var i="boolean"==typeof r?r:r&&r.children,o=this.removeChildren(0,this.children.length);if(i)for(var a=0;a<o.length;++a)o[a].destroy(r)},r.width.get=function(){return this.scale.x*this.getLocalBounds().width},r.width.set=function(t){var r=this.getLocalBounds().width;this.scale.x=0!==r?t/r:1,this._width=t},r.height.get=function(){return this.scale.y*this.getLocalBounds().height},r.height.set=function(t){var r=this.getLocalBounds().height;this.scale.y=0!==r?t/r:1,this._height=t},Object.defineProperties(Container.prototype,r),Container}(Fe);Ge.prototype.containerUpdateTransform=Ge.prototype.updateTransform;var He={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0};Fe.mixin(He);var Ve,Ue=function AccessibilityManager(t){this._hookDiv=null,(k.tablet||k.phone)&&this.createTouchHook();var r=document.createElement("div");r.style.width="100px",r.style.height="100px",r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.zIndex=2,this.div=r,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,window.addEventListener("keydown",this._onKeyDown,!1)};Ue.prototype.createTouchHook=function createTouchHook(){var t=this,r=document.createElement("button");r.style.width="1px",r.style.height="1px",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.style.zIndex=2,r.style.backgroundColor="#FF0000",r.title="HOOK DIV",r.addEventListener("focus",(function(){t.isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(r),this._hookDiv=r},Ue.prototype.destroyTouchHook=function destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},Ue.prototype.activate=function activate(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},Ue.prototype.deactivate=function deactivate(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},Ue.prototype.updateAccessibleObjects=function updateAccessibleObjects(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var r=t.children,i=0;i<r.length;i++)this.updateAccessibleObjects(r[i])}},Ue.prototype.update=function update(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),r=t.width/this.renderer.width,i=t.height/this.renderer.height,o=this.div;o.style.left=t.left+"px",o.style.top=t.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var a=0;a<this.children.length;a++){var l=this.children[a];if(l.renderId!==this.renderId)l._accessibleActive=!1,removeItems(this.children,a,1),this.div.removeChild(l._accessibleDiv),this.pool.push(l._accessibleDiv),l._accessibleDiv=null,a--,0===this.children.length&&this.deactivate();else{o=l._accessibleDiv;var h=l.hitArea,g=l.worldTransform;l.hitArea?(o.style.left=(g.tx+h.x*g.a)*r+"px",o.style.top=(g.ty+h.y*g.d)*i+"px",o.style.width=h.width*g.a*r+"px",o.style.height=h.height*g.d*i+"px"):(h=l.getBounds(),this.capHitArea(h),o.style.left=h.x*r+"px",o.style.top=h.y*i+"px",o.style.width=h.width*r+"px",o.style.height=h.height*i+"px",o.title!==l.accessibleTitle&&null!==l.accessibleTitle&&(o.title=l.accessibleTitle),o.getAttribute("aria-label")!==l.accessibleHint&&null!==l.accessibleHint&&o.setAttribute("aria-label",l.accessibleHint)),l.accessibleTitle===o.title&&l.tabIndex===o.tabIndex||(o.title=l.accessibleTitle,o.tabIndex=l.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},Ue.prototype.updateDebugHTML=function updateDebugHTML(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},Ue.prototype.capHitArea=function capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},Ue.prototype.addChild=function addChild(t){var r=this.pool.pop();r||((r=document.createElement("button")).style.width="100px",r.style.height="100px",r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=2,r.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=t.accessiblePointerEvents,r.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?r.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(r.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&r.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(r),t._accessibleActive=!0,t._accessibleDiv=r,r.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},Ue.prototype._onClick=function _onClick(t){var r=this.renderer.plugins.interaction;r.dispatchEvent(t.target.displayObject,"click",r.eventData),r.dispatchEvent(t.target.displayObject,"pointertap",r.eventData),r.dispatchEvent(t.target.displayObject,"tap",r.eventData)},Ue.prototype._onFocus=function _onFocus(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","assertive");var r=this.renderer.plugins.interaction;r.dispatchEvent(t.target.displayObject,"mouseover",r.eventData)},Ue.prototype._onFocusOut=function _onFocusOut(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","polite");var r=this.renderer.plugins.interaction;r.dispatchEvent(t.target.displayObject,"mouseout",r.eventData)},Ue.prototype._onKeyDown=function _onKeyDown(t){9===t.keyCode&&this.activate()},Ue.prototype._onMouseMove=function _onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()},Ue.prototype.destroy=function destroy(){this.destroyTouchHook(),this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},Q.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(Ve||(Ve={}));var ze=function(){function TickerListener(t,r,i,o){void 0===r&&(r=null),void 0===i&&(i=0),void 0===o&&(o=!1),this.fn=t,this.context=r,this.priority=i,this.once=o,this.next=null,this.previous=null,this._destroyed=!1}return TickerListener.prototype.match=function(t,r){return void 0===r&&(r=null),this.fn===t&&this.context===r},TickerListener.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var r=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),r},TickerListener.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},TickerListener.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var r=this.next;return this.next=t?null:r,this.previous=null,r},TickerListener}(),We=function(){function Ticker(){var t=this;this._head=new ze(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/Q.TARGET_FPMS,this.elapsedMS=1/Q.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(r){t._requestId=null,t.started&&(t.update(r),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return Ticker.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},Ticker.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker.prototype.add=function(t,r,i){return void 0===i&&(i=Ve.NORMAL),this._addListener(new ze(t,r,i))},Ticker.prototype.addOnce=function(t,r,i){return void 0===i&&(i=Ve.NORMAL),this._addListener(new ze(t,r,i,!0))},Ticker.prototype._addListener=function(t){var r=this._head.next,i=this._head;if(r){for(;r;){if(t.priority>r.priority){t.connect(i);break}i=r,r=r.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},Ticker.prototype.remove=function(t,r){for(var i=this._head.next;i;)i=i.match(t,r)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(Ticker.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,r=this._head;r=r.next;)t++;return t},enumerable:!0,configurable:!0}),Ticker.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},Ticker.prototype.update=function(t){var r;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((r=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){var i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*Q.TARGET_FPMS;for(var o=this._head,a=o.next;a;)a=a.emit(this.deltaTime);o.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(Ticker.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!0,configurable:!0}),Object.defineProperty(Ticker.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var r=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,r)/1e3,Q.TARGET_FPMS);this._maxElapsedMS=1/i},enumerable:!0,configurable:!0}),Object.defineProperty(Ticker.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var r=Math.max(this.minFPS,t);this._minElapsedMS=1/(r/1e3)}},enumerable:!0,configurable:!0}),Object.defineProperty(Ticker,"shared",{get:function(){if(!Ticker._shared){var t=Ticker._shared=new Ticker;t.autoStart=!0,t._protected=!0}return Ticker._shared},enumerable:!0,configurable:!0}),Object.defineProperty(Ticker,"system",{get:function(){if(!Ticker._system){var t=Ticker._system=new Ticker;t.autoStart=!0,t._protected=!0}return Ticker._system},enumerable:!0,configurable:!0}),Ticker}(),qe=function(){function TickerPlugin(){}return TickerPlugin.init=function(t){var r=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Ve.LOW)},get:function(){return this._ticker}}),this.stop=function(){r._ticker.stop()},this.start=function(){r._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?We.shared:new We,t.autoStart&&this.start()},TickerPlugin.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},TickerPlugin}(),$e=function InteractionData(){this.global=new ye,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},Xe={pointerId:{configurable:!0}};Xe.pointerId.get=function(){return this.identifier},$e.prototype.getLocalPosition=function getLocalPosition(t,r,i){return t.worldTransform.applyInverse(i||this.global,r)},$e.prototype.copyEvent=function copyEvent(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},$e.prototype.reset=function reset(){this.isPrimary=!1},Object.defineProperties($e.prototype,Xe);var Ke=function InteractionEvent(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};Ke.prototype.stopPropagation=function stopPropagation(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},Ke.prototype.reset=function reset(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var Ye=function InteractionTrackingData(t){this._pointerId=t,this._flags=InteractionTrackingData.FLAGS.NONE},Ze={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};Ye.prototype._doSet=function _doSet(t,r){this._flags=r?this._flags|t:this._flags&~t},Ze.pointerId.get=function(){return this._pointerId},Ze.flags.get=function(){return this._flags},Ze.flags.set=function(t){this._flags=t},Ze.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},Ze.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},Ze.over.set=function(t){this._doSet(this.constructor.FLAGS.OVER,t)},Ze.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},Ze.rightDown.set=function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)},Ze.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},Ze.leftDown.set=function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)},Object.defineProperties(Ye.prototype,Ze),Ye.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var Qe=function TreeSearch(){this._tempPoint=new ye};Qe.prototype.recursiveFindHit=function recursiveFindHit(t,r,i,o,a){if(!r||!r.visible)return!1;var l=t.data.global,h=!1,g=a=r.interactive||a,y=!0;if(r.hitArea?(o&&(r.worldTransform.applyInverse(l,this._tempPoint),r.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?h=!0:(o=!1,y=!1)),g=!1):r._mask&&o&&(r._mask.containsPoint&&r._mask.containsPoint(l)||(o=!1)),y&&r.interactiveChildren&&r.children)for(var _=r.children,x=_.length-1;x>=0;x--){var w=_[x],S=this.recursiveFindHit(t,w,i,o,g);if(S){if(!w.parent)continue;g=!1,S&&(t.target&&(o=!1),h=!0)}}return a&&(o&&!t.target&&!r.hitArea&&r.containsPoint&&r.containsPoint(l)&&(h=!0),r.interactive&&(h&&!t.target&&(t.target=r),i&&i(t,r,!!h))),h},Qe.prototype.findHit=function findHit(t,r,i,o){this.recursiveFindHit(t,r,i,o,!1)};var Je={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Fe.mixin(Je);var et={target:null,data:{global:null}},tt=function(t){function InteractionManager(r,i){t.call(this),i=i||{},this.renderer=r,this.autoPreventDefault=void 0===i.autoPreventDefault||i.autoPreventDefault,this.interactionFrequency=i.interactionFrequency||10,this.mouse=new $e,this.mouse.identifier=1,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[1]=this.mouse,this.interactionDataPool=[],this.eventData=new Ke,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.tickerAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this.resolution=1,this.delayedEvents=[],this.search=new Qe,this._useSystemTicker=void 0===i.useSystemTicker||i.useSystemTicker,this.setTargetElement(this.renderer.view,this.renderer.resolution)}t&&(InteractionManager.__proto__=t),InteractionManager.prototype=Object.create(t&&t.prototype),InteractionManager.prototype.constructor=InteractionManager;var r={useSystemTicker:{configurable:!0}};return r.useSystemTicker.get=function(){return this._useSystemTicker},r.useSystemTicker.set=function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},InteractionManager.prototype.hitTest=function hitTest(t,r){return et.target=null,et.data.global=t,r||(r=this.renderer._lastObjectRendered),this.processInteractive(et,r,null,!0),et.target},InteractionManager.prototype.setTargetElement=function setTargetElement(t,r){void 0===r&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=r,this.addEvents(),this.addTickerListener()},InteractionManager.prototype.addTickerListener=function addTickerListener(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(We.system.add(this.tickerUpdate,this,Ve.INTERACTION),this.tickerAdded=!0)},InteractionManager.prototype.removeTickerListener=function removeTickerListener(){this.tickerAdded&&(We.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},InteractionManager.prototype.addEvents=function addEvents(){!this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},InteractionManager.prototype.removeEvents=function removeEvents(){this.eventsAdded&&this.interactionDOMElement&&(window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},InteractionManager.prototype.tickerUpdate=function tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},InteractionManager.prototype.update=function update(){if(this.interactionDOMElement)if(this.didMove)this.didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&"touch"!==r.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(i,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},InteractionManager.prototype.setCursorMode=function setCursorMode(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var r=this.cursorStyles[t];if(r)switch(typeof r){case"string":this.interactionDOMElement.style.cursor=r;break;case"function":r(t);break;case"object":Object.assign(this.interactionDOMElement.style,r)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},InteractionManager.prototype.dispatchEvent=function dispatchEvent(t,r,i){i.stopPropagationHint&&t!==i.stopsPropagatingAt||(i.currentTarget=t,i.type=r,t.emit(r,i),t[r]&&t[r](i))},InteractionManager.prototype.delayDispatchEvent=function delayDispatchEvent(t,r,i){this.delayedEvents.push({displayObject:t,eventString:r,eventData:i})},InteractionManager.prototype.mapPositionToPoint=function mapPositionToPoint(t,r,i){var o;o=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var a=1/this.resolution;t.x=(r-o.left)*(this.interactionDOMElement.width/o.width)*a,t.y=(i-o.top)*(this.interactionDOMElement.height/o.height)*a},InteractionManager.prototype.processInteractive=function processInteractive(t,r,i,o){var a=this.search.findHit(t,r,i,o),l=this.delayedEvents;if(!l.length)return a;t.stopPropagationHint=!1;var h=l.length;this.delayedEvents=[];for(var g=0;g<h;g++){var y=l[g],_=y.displayObject,x=y.eventString,w=y.eventData;w.stopsPropagatingAt===_&&(w.stopPropagationHint=!0),this.dispatchEvent(_,x,w)}return a},InteractionManager.prototype.onPointerDown=function onPointerDown(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var r=this.normalizeToPointerData(t);if(this.autoPreventDefault&&r[0].isNormalized)(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var i=r.length,o=0;o<i;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(h.data.originalEvent=t,this.processInteractive(h,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",h),"touch"===a.pointerType)this.emit("touchstart",h);else if("mouse"===a.pointerType||"pen"===a.pointerType){var g=2===a.button;this.emit(g?"rightdown":"mousedown",this.eventData)}}}},InteractionManager.prototype.processPointerDown=function processPointerDown(t,r,i){var o=t.data,a=t.data.identifier;if(i)if(r.trackedPointers[a]||(r.trackedPointers[a]=new Ye(a)),this.dispatchEvent(r,"pointerdown",t),"touch"===o.pointerType)this.dispatchEvent(r,"touchstart",t);else if("mouse"===o.pointerType||"pen"===o.pointerType){var l=2===o.button;l?r.trackedPointers[a].rightDown=!0:r.trackedPointers[a].leftDown=!0,this.dispatchEvent(r,l?"rightdown":"mousedown",t)}},InteractionManager.prototype.onPointerComplete=function onPointerComplete(t,r,i){for(var o=this.normalizeToPointerData(t),a=o.length,l=t.target!==this.interactionDOMElement?"outside":"",h=0;h<a;h++){var g=o[h],y=this.getInteractionDataForPointerId(g),_=this.configureInteractionEventForDOMEvent(this.eventData,g,y);if(_.data.originalEvent=t,this.processInteractive(_,this.renderer._lastObjectRendered,i,r||!l),this.emit(r?"pointercancel":"pointerup"+l,_),"mouse"===g.pointerType||"pen"===g.pointerType){var x=2===g.button;this.emit(x?"rightup"+l:"mouseup"+l,_)}else"touch"===g.pointerType&&(this.emit(r?"touchcancel":"touchend"+l,_),this.releaseInteractionDataForPointerId(g.pointerId,y))}},InteractionManager.prototype.onPointerCancel=function onPointerCancel(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},InteractionManager.prototype.processPointerCancel=function processPointerCancel(t,r){var i=t.data,o=t.data.identifier;void 0!==r.trackedPointers[o]&&(delete r.trackedPointers[o],this.dispatchEvent(r,"pointercancel",t),"touch"===i.pointerType&&this.dispatchEvent(r,"touchcancel",t))},InteractionManager.prototype.onPointerUp=function onPointerUp(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},InteractionManager.prototype.processPointerUp=function processPointerUp(t,r,i){var o=t.data,a=t.data.identifier,l=r.trackedPointers[a],h="touch"===o.pointerType,g="mouse"===o.pointerType||"pen"===o.pointerType,y=!1;if(g){var _=2===o.button,x=Ye.FLAGS,w=_?x.RIGHT_DOWN:x.LEFT_DOWN,S=void 0!==l&&l.flags&w;i?(this.dispatchEvent(r,_?"rightup":"mouseup",t),S&&(this.dispatchEvent(r,_?"rightclick":"click",t),y=!0)):S&&this.dispatchEvent(r,_?"rightupoutside":"mouseupoutside",t),l&&(_?l.rightDown=!1:l.leftDown=!1)}i?(this.dispatchEvent(r,"pointerup",t),h&&this.dispatchEvent(r,"touchend",t),l&&(g&&!y||this.dispatchEvent(r,"pointertap",t),h&&(this.dispatchEvent(r,"tap",t),l.over=!1))):l&&(this.dispatchEvent(r,"pointerupoutside",t),h&&this.dispatchEvent(r,"touchendoutside",t)),l&&l.none&&delete r.trackedPointers[a]},InteractionManager.prototype.onPointerMove=function onPointerMove(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var r=this.normalizeToPointerData(t);"mouse"!==r[0].pointerType&&"pen"!==r[0].pointerType||(this.didMove=!0,this.cursor=null);for(var i=r.length,o=0;o<i;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,l);h.data.originalEvent=t,this.processInteractive(h,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",h),"touch"===a.pointerType&&this.emit("touchmove",h),"mouse"!==a.pointerType&&"pen"!==a.pointerType||this.emit("mousemove",h)}"mouse"===r[0].pointerType&&this.setCursorMode(this.cursor)}},InteractionManager.prototype.processPointerMove=function processPointerMove(t,r,i){var o=t.data,a="touch"===o.pointerType,l="mouse"===o.pointerType||"pen"===o.pointerType;l&&this.processPointerOverOut(t,r,i),this.moveWhenInside&&!i||(this.dispatchEvent(r,"pointermove",t),a&&this.dispatchEvent(r,"touchmove",t),l&&this.dispatchEvent(r,"mousemove",t))},InteractionManager.prototype.onPointerOut=function onPointerOut(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var r=this.normalizeToPointerData(t)[0];"mouse"===r.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(r),o=this.configureInteractionEventForDOMEvent(this.eventData,r,i);o.data.originalEvent=r,this.processInteractive(o,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),"mouse"===r.pointerType||"pen"===r.pointerType?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(i.identifier)}},InteractionManager.prototype.processPointerOverOut=function processPointerOverOut(t,r,i){var o=t.data,a=t.data.identifier,l="mouse"===o.pointerType||"pen"===o.pointerType,h=r.trackedPointers[a];i&&!h&&(h=r.trackedPointers[a]=new Ye(a)),void 0!==h&&(i&&this.mouseOverRenderer?(h.over||(h.over=!0,this.delayDispatchEvent(r,"pointerover",t),l&&this.delayDispatchEvent(r,"mouseover",t)),l&&null===this.cursor&&(this.cursor=r.cursor)):h.over&&(h.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),l&&this.dispatchEvent(r,"mouseout",t),h.none&&delete r.trackedPointers[a]))},InteractionManager.prototype.onPointerOver=function onPointerOver(t){var r=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(r),o=this.configureInteractionEventForDOMEvent(this.eventData,r,i);o.data.originalEvent=r,"mouse"===r.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.emit("mouseover",o)},InteractionManager.prototype.getInteractionDataForPointerId=function getInteractionDataForPointerId(t){var r,i=t.pointerId;return 1===i||"mouse"===t.pointerType?r=this.mouse:this.activeInteractionData[i]?r=this.activeInteractionData[i]:((r=this.interactionDataPool.pop()||new $e).identifier=i,this.activeInteractionData[i]=r),r.copyEvent(t),r},InteractionManager.prototype.releaseInteractionDataForPointerId=function releaseInteractionDataForPointerId(t){var r=this.activeInteractionData[t];r&&(delete this.activeInteractionData[t],r.reset(),this.interactionDataPool.push(r))},InteractionManager.prototype.configureInteractionEventForDOMEvent=function configureInteractionEventForDOMEvent(t,r,i){return t.data=i,this.mapPositionToPoint(i.global,r.clientX,r.clientY),"touch"===r.pointerType&&(r.globalX=i.global.x,r.globalY=i.global.y),i.originalEvent=r,t.reset(),t},InteractionManager.prototype.normalizeToPointerData=function normalizeToPointerData(t){var r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,o=t.changedTouches.length;i<o;i++){var a=t.changedTouches[i];void 0===a.button&&(a.button=t.touches.length?1:0),void 0===a.buttons&&(a.buttons=t.touches.length?1:0),void 0===a.isPrimary&&(a.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===a.width&&(a.width=a.radiusX||1),void 0===a.height&&(a.height=a.radiusY||1),void 0===a.tiltX&&(a.tiltX=0),void 0===a.tiltY&&(a.tiltY=0),void 0===a.pointerType&&(a.pointerType="touch"),void 0===a.pointerId&&(a.pointerId=a.identifier||0),void 0===a.pressure&&(a.pressure=a.force||.5),void 0===a.twist&&(a.twist=0),void 0===a.tangentialPressure&&(a.tangentialPressure=0),void 0===a.layerX&&(a.layerX=a.offsetX=a.clientX),void 0===a.layerY&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,r.push(a)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent||(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=1),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0),r.push(t);return r},InteractionManager.prototype.destroy=function destroy(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},Object.defineProperties(InteractionManager.prototype,r),InteractionManager}(ee.a),nt=function(){function Runner(t){this.items=[],this._name=t,this._aliasCount=0}return Runner.prototype.emit=function(t,r,i,o,a,l,h,g){if(arguments.length>8)throw new Error("max arguments reached");var y=this,_=y.name,x=y.items;this._aliasCount++;for(var w=0,S=x.length;w<S;w++)x[w][_](t,r,i,o,a,l,h,g);return x===this.items&&this._aliasCount--,this},Runner.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},Runner.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},Runner.prototype.remove=function(t){var r=this.items.indexOf(t);return-1!==r&&(this.ensureNonAliasedItems(),this.items.splice(r,1)),this},Runner.prototype.contains=function(t){return-1!==this.items.indexOf(t)},Runner.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Runner.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Runner.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(Runner.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Runner}();Object.defineProperties(nt.prototype,{dispatch:{value:nt.prototype.emit},run:{value:nt.prototype.emit}});var rt=function Resource(t,r){void 0===t&&(t=0),void 0===r&&(r=0),this._width=t,this._height=r,this.destroyed=!1,this.internal=!1,this.onResize=new nt("setRealSize",2),this.onUpdate=new nt("update"),this.onError=new nt("onError",1)},it={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};rt.prototype.bind=function bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.run(this._width,this._height)},rt.prototype.unbind=function unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},rt.prototype.resize=function resize(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.onResize.run(t,r))},it.valid.get=function(){return!!this._width&&!!this._height},rt.prototype.update=function update(){this.destroyed||this.onUpdate.run()},rt.prototype.load=function load(){return Promise.resolve()},it.width.get=function(){return this._width},it.height.get=function(){return this._height},rt.prototype.upload=function upload(t,r,i){return!1},rt.prototype.style=function style(t,r,i){return!1},rt.prototype.dispose=function dispose(){},rt.prototype.destroy=function destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Object.defineProperties(rt.prototype,it);var ot=function(t){function BaseImageResource(r){var i=r.naturalWidth||r.videoWidth||r.width,o=r.naturalHeight||r.videoHeight||r.height;t.call(this,i,o),this.source=r,this.noSubImage=!1}return t&&(BaseImageResource.__proto__=t),BaseImageResource.prototype=Object.create(t&&t.prototype),BaseImageResource.prototype.constructor=BaseImageResource,BaseImageResource.crossOrigin=function crossOrigin(t,r,i){void 0===i&&0!==r.indexOf("data:")?t.crossOrigin=determineCrossOrigin(r):!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous")},BaseImageResource.prototype.upload=function upload(t,r,i,o){var a=t.gl,l=r.realWidth,h=r.realHeight;return o=o||this.source,a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===X.UNPACK),this.noSubImage||r.target!==a.TEXTURE_2D||i.width!==l||i.height!==h?(i.width=l,i.height=h,a.texImage2D(r.target,0,r.format,r.format,r.type,o)):a.texSubImage2D(a.TEXTURE_2D,0,0,0,r.format,r.type,o),!0},BaseImageResource.prototype.update=function update(){if(!this.destroyed){var r=this.source.naturalWidth||this.source.videoWidth||this.source.width,i=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.resize(r,i),t.prototype.update.call(this)}},BaseImageResource.prototype.dispose=function dispose(){this.source=null},BaseImageResource}(rt),at=function(t){function ImageResource(r,i){if(i=i||{},!(r instanceof HTMLImageElement)){var o=new Image;t.crossOrigin(o,r,i.crossorigin),o.src=r,r=o}t.call(this,r),!r.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=r.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==i.createBitmap?i.createBitmap:Q.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.alphaMode="number"==typeof i.alphaMode?i.alphaMode:null,void 0!==i.premultiplyAlpha&&(this.premultiplyAlpha=i.premultiplyAlpha),this.bitmap=null,this._load=null,!1!==i.autoLoad&&this.load()}return t&&(ImageResource.__proto__=t),ImageResource.prototype=Object.create(t&&t.prototype),ImageResource.prototype.constructor=ImageResource,ImageResource.prototype.load=function load(t){var r=this;return void 0!==t&&(this.createBitmap=t),this._load||(this._load=new Promise((function(t){r.url=r.source.src;var i=r.source,completed=function(){r.destroyed||(i.onload=null,i.onerror=null,r.resize(i.width,i.height),r._load=null,r.createBitmap?t(r.process()):t(r))};i.complete&&i.src?completed():(i.onload=completed,i.onerror=function(t){return r.onError.run(t)})}))),this._load},ImageResource.prototype.process=function process(){var t=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha===X.UNPACK?"premultiply":"none"}).then((function(r){return t.destroyed?Promise.reject():(t.bitmap=r,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},ImageResource.prototype.upload=function upload(r,i,o){if("number"==typeof this.alphaMode&&(i.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,r,i,o);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,r,i,o,this.bitmap),!this.preserveBitmap){var a=!0;for(var l in i._glTextures){var h=i._glTextures[l];if(h!==o&&h.dirtyId!==i.dirtyId){a=!1;break}}a&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},ImageResource.prototype.dispose=function dispose(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},ImageResource}(ot),st=[];function autoDetectResource(t,r){if(!t)return null;var i="";if("string"==typeof t){var o=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);o&&(i=o[1].toLowerCase())}for(var a=st.length-1;a>=0;--a){var l=st[a];if(l.test&&l.test(t,i))return new l(t,r)}return new at(t,r)}var ct=function(t){function BufferResource(r,i){var o=i||{},a=o.width,l=o.height;if(!a||!l)throw new Error("BufferResource width or height invalid");t.call(this,a,l),this.data=r}return t&&(BufferResource.__proto__=t),BufferResource.prototype=Object.create(t&&t.prototype),BufferResource.prototype.constructor=BufferResource,BufferResource.prototype.upload=function upload(t,r,i){var o=t.gl;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===X.UNPACK),i.width===r.width&&i.height===r.height?o.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(i.width=r.width,i.height=r.height,o.texImage2D(r.target,0,i.internalFormat,r.width,r.height,0,r.format,i.type,this.data)),!0},BufferResource.prototype.dispose=function dispose(){this.data=null},BufferResource.test=function test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},BufferResource}(rt),lt={scaleMode:W.NEAREST,format:V.RGBA,alphaMode:X.NPM},ut=function(t){function BaseTexture(r,i){void 0===r&&(r=null),void 0===i&&(i=null),t.call(this);var o=(i=i||{}).alphaMode,a=i.mipmap,l=i.anisotropicLevel,h=i.scaleMode,g=i.width,y=i.height,_=i.wrapMode,x=i.format,w=i.type,S=i.target,M=i.resolution,T=i.resourceOptions;!r||r instanceof rt||((r=autoDetectResource(r,T)).internal=!0),this.width=g||0,this.height=y||0,this.resolution=M||Q.RESOLUTION,this.mipmap=void 0!==a?a:Q.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==l?l:Q.ANISOTROPIC_LEVEL,this.wrapMode=_||Q.WRAP_MODE,this.scaleMode=void 0!==h?h:Q.SCALE_MODE,this.format=x||V.RGBA,this.type=w||z.UNSIGNED_BYTE,this.target=S||U.TEXTURE_2D,this.alphaMode=void 0!==o?o:X.UNPACK,void 0!==i.premultiplyAlpha&&(this.premultiplyAlpha=i.premultiplyAlpha),this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=g>0&&y>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.setResource(r)}t&&(BaseTexture.__proto__=t),BaseTexture.prototype=Object.create(t&&t.prototype),BaseTexture.prototype.constructor=BaseTexture;var r={realWidth:{configurable:!0},realHeight:{configurable:!0}};return r.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)},r.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)},BaseTexture.prototype.setStyle=function setStyle(t,r){var i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==r&&r!==this.mipmap&&(this.mipmap=r,i=!0),i&&this.dirtyStyleId++,this},BaseTexture.prototype.setSize=function setSize(t,r,i){return this.resolution=i||this.resolution,this.width=t,this.height=r,this._refreshPOT(),this.update(),this},BaseTexture.prototype.setRealSize=function setRealSize(t,r,i){return this.resolution=i||this.resolution,this.width=t/this.resolution,this.height=r/this.resolution,this._refreshPOT(),this.update(),this},BaseTexture.prototype._refreshPOT=function _refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},BaseTexture.prototype.setResolution=function setResolution(t){var r=this.resolution;return r===t||(this.resolution=t,this.valid&&(this.width=this.width*r/t,this.height=this.height*r/t,this.emit("update",this)),this._refreshPOT()),this},BaseTexture.prototype.setResource=function setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},BaseTexture.prototype.update=function update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},BaseTexture.prototype.onError=function onError(t){this.emit("error",this,t)},BaseTexture.prototype.destroy=function destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete pe[this.cacheId],delete he[this.cacheId],this.cacheId=null),this.dispose(),BaseTexture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},BaseTexture.prototype.dispose=function dispose(){this.emit("dispose",this)},BaseTexture.from=function from(t,r,i){void 0===i&&(i=Q.STRICT_TEXTURE_CACHE);var o="string"==typeof t,a=null;o?a=t:(t._pixiId||(t._pixiId="pixiid_"+uid()),a=t._pixiId);var l=pe[a];if(o&&i&&!l)throw new Error('The cacheId "'+a+'" does not exist in BaseTextureCache.');return l||((l=new BaseTexture(t,r)).cacheId=a,BaseTexture.addToCache(l,a)),l},BaseTexture.fromBuffer=function fromBuffer(t,r,i,o){t=t||new Float32Array(r*i*4);var a=new ct(t,{width:r,height:i}),l=t instanceof Float32Array?z.FLOAT:z.UNSIGNED_BYTE;return new BaseTexture(a,Object.assign(lt,o||{width:r,height:i,type:l}))},BaseTexture.addToCache=function addToCache(t,r){r&&(-1===t.textureCacheIds.indexOf(r)&&t.textureCacheIds.push(r),pe[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),pe[r]=t)},BaseTexture.removeFromCache=function removeFromCache(t){if("string"==typeof t){var r=pe[t];if(r){var i=r.textureCacheIds.indexOf(t);return i>-1&&r.textureCacheIds.splice(i,1),delete pe[t],r}}else if(t&&t.textureCacheIds){for(var o=0;o<t.textureCacheIds.length;++o)delete pe[t.textureCacheIds[o]];return t.textureCacheIds.length=0,t}return null},Object.defineProperties(BaseTexture.prototype,r),BaseTexture}(ee.a);ut._globalBatch=0;var dt=function(t){function ArrayResource(r,i){var o;i=i||{};var a=r;Array.isArray(r)&&(o=r,a=r.length),t.call(this,i.width,i.height),this.items=[],this.itemDirtyIds=[];for(var l=0;l<a;l++){var h=new ut;this.items.push(h),this.itemDirtyIds.push(-1)}if(this.length=a,this._load=null,o)for(var g=0;g<a;g++)this.addResourceAt(autoDetectResource(o[g],i),g)}return t&&(ArrayResource.__proto__=t),ArrayResource.prototype=Object.create(t&&t.prototype),ArrayResource.prototype.constructor=ArrayResource,ArrayResource.prototype.dispose=function dispose(){for(var t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},ArrayResource.prototype.addResourceAt=function addResourceAt(t,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this},ArrayResource.prototype.bind=function bind(r){t.prototype.bind.call(this,r),r.target=U.TEXTURE_2D_ARRAY;for(var i=0;i<this.length;i++)this.items[i].on("update",r.update,r)},ArrayResource.prototype.unbind=function unbind(r){t.prototype.unbind.call(this,r);for(var i=0;i<this.length;i++)this.items[i].off("update",r.update,r)},ArrayResource.prototype.load=function load(){var t=this;if(this._load)return this._load;var r=this.items.map((function(t){return t.resource})),i=r.map((function(t){return t.load()}));return this._load=Promise.all(i).then((function(){var i=r[0],o=i.width,a=i.height;return t.resize(o,a),Promise.resolve(t)})),this._load},ArrayResource.prototype.upload=function upload(t,r,i){var o=this,a=o.length,l=o.itemDirtyIds,h=o.items,g=t.gl;i.dirtyId<0&&g.texImage3D(g.TEXTURE_2D_ARRAY,0,r.format,this._width,this._height,a,0,r.format,r.type,null);for(var y=0;y<a;y++){var _=h[y];l[y]<_.dirtyId&&(l[y]=_.dirtyId,_.valid&&g.texSubImage3D(g.TEXTURE_2D_ARRAY,0,0,0,y,_.resource.width,_.resource.height,1,r.format,r.type,_.resource.source))}return!0},ArrayResource}(rt),ht=function(t){function CanvasResource(){t.apply(this,arguments)}return t&&(CanvasResource.__proto__=t),CanvasResource.prototype=Object.create(t&&t.prototype),CanvasResource.prototype.constructor=CanvasResource,CanvasResource.test=function test(t){var r=window.OffscreenCanvas;return!!(r&&t instanceof r)||t instanceof HTMLCanvasElement},CanvasResource}(ot),pt=function(t){function CubeResource(r,i){if(i=i||{},t.call(this,r,i),this.length!==CubeResource.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var o=0;o<CubeResource.SIDES;o++)this.items[o].target=U.TEXTURE_CUBE_MAP_POSITIVE_X+o;!1!==i.autoLoad&&this.load()}return t&&(CubeResource.__proto__=t),CubeResource.prototype=Object.create(t&&t.prototype),CubeResource.prototype.constructor=CubeResource,CubeResource.prototype.bind=function bind(r){t.prototype.bind.call(this,r),r.target=U.TEXTURE_CUBE_MAP},CubeResource.prototype.upload=function upload(t,r,i){for(var o=this.itemDirtyIds,a=0;a<CubeResource.SIDES;a++){var l=this.items[a];o[a]<l.dirtyId&&(o[a]=l.dirtyId,l.valid&&l.resource.upload(t,l,i))}return!0},CubeResource}(dt);pt.SIDES=6;var ft=function(t){function SVGResource(r,i){i=i||{},t.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=r,this.scale=i.scale||1,this._overrideWidth=i.width,this._overrideHeight=i.height,this._resolve=null,this._crossorigin=i.crossorigin,this._load=null,!1!==i.autoLoad&&this.load()}return t&&(SVGResource.__proto__=t),SVGResource.prototype=Object.create(t&&t.prototype),SVGResource.prototype.constructor=SVGResource,SVGResource.prototype.load=function load(){var t=this;return this._load||(this._load=new Promise((function(r){if(t._resolve=function(){t.resize(t.source.width,t.source.height),r(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}))),this._load},SVGResource.prototype._loadSvg=function _loadSvg(){var r=this,i=new Image;t.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=function(t){i.onerror=null,r.onError.run(t)},i.onload=function(){var t=i.width,o=i.height;if(!t||!o)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var a=t*r.scale,l=o*r.scale;(r._overrideWidth||r._overrideHeight)&&(a=r._overrideWidth||r._overrideHeight/o*t,l=r._overrideHeight||r._overrideWidth/t*o),a=Math.round(a),l=Math.round(l);var h=r.source;h.width=a,h.height=l,h._pixiId="canvas_"+uid(),h.getContext("2d").drawImage(i,0,0,t,o,0,0,a,l),r._resolve(),r._resolve=null}},SVGResource.getSize=function getSize(t){var r=SVGResource.SVG_SIZE.exec(t),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i},SVGResource.prototype.dispose=function dispose(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},SVGResource.test=function test(t,r){return"svg"===r||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},SVGResource}(ot);ft.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var mt=function(t){function VideoResource(r,i){if(i=i||{},!(r instanceof HTMLVideoElement)){var o=document.createElement("video");o.setAttribute("preload","auto"),o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline",""),"string"==typeof r&&(r=[r]),t.crossOrigin(o,r[0].src||r[0],i.crossorigin);for(var a=0;a<r.length;++a){var l=document.createElement("source"),h=r[a],g=h.src,y=h.mime,_=(g=g||r[a]).split("?").shift().toLowerCase(),x=_.substr(_.lastIndexOf(".")+1);y=y||"video/"+x,l.src=g,l.type=y,o.appendChild(l)}r=o}t.call(this,r),this.noSubImage=!0,this._autoUpdate=!0,this._isAutoUpdating=!1,this._updateFPS=i.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==i.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==i.autoLoad&&this.load()}t&&(VideoResource.__proto__=t),VideoResource.prototype=Object.create(t&&t.prototype),VideoResource.prototype.constructor=VideoResource;var r={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return VideoResource.prototype.update=function update(r){if(void 0===r&&(r=0),!this.destroyed){var i=We.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-i),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this,r),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},VideoResource.prototype.load=function load(){var t=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise((function(i){t.valid?i(t):(t._resolve=i,r.load())})),this._load},VideoResource.prototype._onError=function _onError(){this.source.removeEventListener("error",this._onError,!0),this.onError.run(event)},VideoResource.prototype._isSourcePlaying=function _isSourcePlaying(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},VideoResource.prototype._isSourceReady=function _isSourceReady(){return 3===this.source.readyState||4===this.source.readyState},VideoResource.prototype._onPlayStart=function _onPlayStart(){this.valid||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(We.shared.add(this.update,this),this._isAutoUpdating=!0)},VideoResource.prototype._onPlayStop=function _onPlayStop(){this._isAutoUpdating&&(We.shared.remove(this.update,this),this._isAutoUpdating=!1)},VideoResource.prototype._onCanPlay=function _onCanPlay(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(t.videoWidth,t.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},VideoResource.prototype.dispose=function dispose(){this._isAutoUpdating&&We.shared.remove(this.update,this),this.source&&(this.source.removeEventListener("error",this._onError,!0),this.source.pause(),this.source.src="",this.source.load()),t.prototype.dispose.call(this)},r.autoUpdate.get=function(){return this._autoUpdate},r.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(We.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(We.shared.add(this.update,this),this._isAutoUpdating=!0))},r.updateFPS.get=function(){return this._updateFPS},r.updateFPS.set=function(t){t!==this._updateFPS&&(this._updateFPS=t)},VideoResource.test=function test(t,r){return t instanceof HTMLVideoElement||VideoResource.TYPES.indexOf(r)>-1},Object.defineProperties(VideoResource.prototype,r),VideoResource}(ot);mt.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];var gt=function(t){function ImageBitmapResource(){t.apply(this,arguments)}return t&&(ImageBitmapResource.__proto__=t),ImageBitmapResource.prototype=Object.create(t&&t.prototype),ImageBitmapResource.prototype.constructor=ImageBitmapResource,ImageBitmapResource.test=function test(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},ImageBitmapResource}(ot);st.push(at,gt,ht,mt,ft,ct,pt,dt);var vt={INSTALLED:st,autoDetectResource:autoDetectResource,ArrayResource:dt,BufferResource:ct,CanvasResource:ht,CubeResource:pt,ImageResource:at,ImageBitmapResource:gt,SVGResource:ft,VideoResource:mt,Resource:rt,BaseImageResource:ot},yt=function System(t){this.renderer=t};yt.prototype.destroy=function destroy(){this.renderer=null};var bt=function(t){function DepthResource(){t.apply(this,arguments)}return t&&(DepthResource.__proto__=t),DepthResource.prototype=Object.create(t&&t.prototype),DepthResource.prototype.constructor=DepthResource,DepthResource.prototype.upload=function upload(t,r,i){var o=t.gl;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===X.UNPACK),i.width===r.width&&i.height===r.height?o.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(i.width=r.width,i.height=r.height,o.texImage2D(r.target,0,o.DEPTH_COMPONENT16,r.width,r.height,0,r.format,r.type,this.data)),!0},DepthResource}(ct),_t=function Framebuffer(t,r){this.width=Math.ceil(t||100),this.height=Math.ceil(r||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new nt("disposeFramebuffer",2)},xt={colorTexture:{configurable:!0}};xt.colorTexture.get=function(){return this.colorTextures[0]},_t.prototype.addColorTexture=function addColorTexture(t,r){return void 0===t&&(t=0),this.colorTextures[t]=r||new ut(null,{scaleMode:0,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},_t.prototype.addDepthTexture=function addDepthTexture(t){return this.depthTexture=t||new ut(new bt(null,{width:this.width,height:this.height}),{scaleMode:0,resolution:1,width:this.width,height:this.height,mipmap:!1,format:V.DEPTH_COMPONENT,type:z.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},_t.prototype.enableDepth=function enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},_t.prototype.enableStencil=function enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},_t.prototype.resize=function resize(t,r){if(t=Math.ceil(t),r=Math.ceil(r),t!==this.width||r!==this.height){this.width=t,this.height=r,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var o=this.colorTextures[i],a=o.resolution;o.setSize(t/a,r/a)}if(this.depthTexture){var l=this.depthTexture.resolution;this.depthTexture.setSize(t/l,r/l)}}},_t.prototype.dispose=function dispose(){this.disposeRunner.run(this,!1)},Object.defineProperties(_t.prototype,xt);var wt=function(t){function BaseRenderTexture(r){if("number"==typeof r){var i=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];r={width:i,height:o,scaleMode:a,resolution:l}}t.call(this,null,r);var h=r||{},g=h.width,y=h.height;this.mipmap=!1,this.width=Math.ceil(g)||100,this.height=Math.ceil(y)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new _t(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this),this.maskStack=[],this.filterStack=[{}]}return t&&(BaseRenderTexture.__proto__=t),BaseRenderTexture.prototype=Object.create(t&&t.prototype),BaseRenderTexture.prototype.constructor=BaseRenderTexture,BaseRenderTexture.prototype.resize=function resize(t,r){t=Math.ceil(t),r=Math.ceil(r),this.framebuffer.resize(t*this.resolution,r*this.resolution)},BaseRenderTexture.prototype.dispose=function dispose(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},BaseRenderTexture.prototype.destroy=function destroy(){t.prototype.destroy.call(this,!0),this.framebuffer=null},BaseRenderTexture}(ut),St=function TextureUvs(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};St.prototype.set=function set(t,r,i){var o=r.width,a=r.height;if(i){var l=t.width/2/o,h=t.height/2/a,g=t.x/o+l,y=t.y/a+h;i=Le.add(i,Le.NW),this.x0=g+l*Le.uX(i),this.y0=y+h*Le.uY(i),i=Le.add(i,2),this.x1=g+l*Le.uX(i),this.y1=y+h*Le.uY(i),i=Le.add(i,2),this.x2=g+l*Le.uX(i),this.y2=y+h*Le.uY(i),i=Le.add(i,2),this.x3=g+l*Le.uX(i),this.y3=y+h*Le.uY(i)}else this.x0=t.x/o,this.y0=t.y/a,this.x1=(t.x+t.width)/o,this.y1=t.y/a,this.x2=(t.x+t.width)/o,this.y2=(t.y+t.height)/a,this.x3=t.x/o,this.y3=(t.y+t.height)/a;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var Mt=new St,Et=function(t){function Texture(r,i,o,a,l,h){if(t.call(this),this.noFrame=!1,i||(this.noFrame=!0,i=new Re(0,0,1,1)),r instanceof Texture&&(r=r.baseTexture),this.baseTexture=r,this._frame=i,this.trim=a,this.valid=!1,this.requiresUpdate=!1,this._uvs=Mt,this.uvMatrix=null,this.orig=o||i,this._rotate=Number(l||0),!0===l)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=h?new ye(h.x,h.y):new ye(0,0),this._updateID=0,this.textureCacheIds=[],r.valid?this.noFrame?r.valid&&this.onBaseTextureUpdated(r):this.frame=i:r.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&r.on("update",this.onBaseTextureUpdated,this)}t&&(Texture.__proto__=t),Texture.prototype=Object.create(t&&t.prototype),Texture.prototype.constructor=Texture;var r={resolution:{configurable:!0},frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return Texture.prototype.update=function update(){this.baseTexture.resource&&this.baseTexture.resource.update()},Texture.prototype.onBaseTextureUpdated=function onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Texture.prototype.destroy=function destroy(t){if(this.baseTexture){if(t){var r=this.baseTexture.resource;r&&he[r.url]&&Texture.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null},Texture.prototype.clone=function clone(){return new Texture(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},Texture.prototype.updateUvs=function updateUvs(){this._uvs===Mt&&(this._uvs=new St),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture.from=function from(t,r,i){void 0===r&&(r={}),void 0===i&&(i=Q.STRICT_TEXTURE_CACHE);var o="string"==typeof t,a=null;o?a=t:(t._pixiId||(t._pixiId="pixiid_"+uid()),a=t._pixiId);var l=he[a];if(o&&i&&!l)throw new Error('The cacheId "'+a+'" does not exist in TextureCache.');return l||(r.resolution||(r.resolution=getResolutionOfUrl(t)),(l=new Texture(new ut(t,r))).baseTexture.cacheId=a,ut.addToCache(l.baseTexture,a),Texture.addToCache(l,a)),l},Texture.fromBuffer=function fromBuffer(t,r,i,o){return new Texture(ut.fromBuffer(t,r,i,o))},Texture.fromLoader=function fromLoader(t,r,i){var o=new at(t);o.url=r;var a=new Texture(new ut(o,{scaleMode:Q.SCALE_MODE,resolution:getResolutionOfUrl(r)}));return i||(i=r),ut.addToCache(a.baseTexture,i),Texture.addToCache(a,i),i!==r&&(ut.addToCache(a.baseTexture,r),Texture.addToCache(a,r)),a},Texture.addToCache=function addToCache(t,r){r&&(-1===t.textureCacheIds.indexOf(r)&&t.textureCacheIds.push(r),he[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),he[r]=t)},Texture.removeFromCache=function removeFromCache(t){if("string"==typeof t){var r=he[t];if(r){var i=r.textureCacheIds.indexOf(t);return i>-1&&r.textureCacheIds.splice(i,1),delete he[t],r}}else if(t&&t.textureCacheIds){for(var o=0;o<t.textureCacheIds.length;++o)he[t.textureCacheIds[o]]===t&&delete he[t.textureCacheIds[o]];return t.textureCacheIds.length=0,t}return null},r.resolution.get=function(){return this.baseTexture.resolution},r.frame.get=function(){return this._frame},r.frame.set=function(t){this._frame=t,this.noFrame=!1;var r=t.x,i=t.y,o=t.width,a=t.height,l=r+o>this.baseTexture.width,h=i+a>this.baseTexture.height;if(l||h){var g=l&&h?"and":"or",y="X: "+r+" + "+o+" = "+(r+o)+" > "+this.baseTexture.width,_="Y: "+i+" + "+a+" = "+(i+a)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+y+" "+g+" "+_)}this.valid=o&&a&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},r.rotate.get=function(){return this._rotate},r.rotate.set=function(t){this._rotate=t,this.valid&&this.updateUvs()},r.width.get=function(){return this.orig.width},r.height.get=function(){return this.orig.height},Object.defineProperties(Texture.prototype,r),Texture}(ee.a);function removeAllHandlers(t){t.destroy=function _emptyDestroy(){},t.on=function _emptyOn(){},t.once=function _emptyOnce(){},t.emit=function _emptyEmit(){}}Et.EMPTY=new Et(new ut),removeAllHandlers(Et.EMPTY),removeAllHandlers(Et.EMPTY.baseTexture),Et.WHITE=function createWhiteTexture(){var t=document.createElement("canvas");t.width=16,t.height=16;var r=t.getContext("2d");return r.fillStyle="white",r.fillRect(0,0,16,16),new Et(new ut(new ht(t)))}(),removeAllHandlers(Et.WHITE),removeAllHandlers(Et.WHITE.baseTexture);var Tt=function(t){function RenderTexture(r,i){var o=null;if(!(r instanceof wt)){var a=arguments[1],l=arguments[2],h=arguments[3],g=arguments[4];console.warn("Please use RenderTexture.create("+a+", "+l+") instead of the ctor directly."),o=arguments[0],i=null,r=new wt({width:a,height:l,scaleMode:h,resolution:g})}t.call(this,r,i),this.legacyRenderer=o,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return t&&(RenderTexture.__proto__=t),RenderTexture.prototype=Object.create(t&&t.prototype),RenderTexture.prototype.constructor=RenderTexture,RenderTexture.prototype.resize=function resize(t,r,i){void 0===i&&(i=!0),t=Math.ceil(t),r=Math.ceil(r),this.valid=t>0&&r>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=r,i&&this.baseTexture.resize(t,r),this.updateUvs()},RenderTexture.prototype.setResolution=function setResolution(t){var r=this.baseTexture;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))},RenderTexture.create=function create(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new RenderTexture(new wt(t))},RenderTexture}(Et),Pt=function RenderTexturePool(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Pt.prototype.createTexture=function createTexture(t,r){var i=new wt(Object.assign({width:t,height:r,resolution:1},this.textureOptions));return new Tt(i)},Pt.prototype.getOptimalTexture=function getOptimalTexture(t,r,i){void 0===i&&(i=1);var o=Pt.SCREEN_KEY;t*=i,r*=i,this.enableFullScreen&&t===this._pixelsWidth&&r===this._pixelsHeight||(o=(65535&(t=nextPow2(t)))<<16|65535&(r=nextPow2(r))),this.texturePool[o]||(this.texturePool[o]=[]);var a=this.texturePool[o].pop();return a||(a=this.createTexture(t,r)),a.filterPoolKey=o,a.setResolution(i),a},Pt.prototype.getFilterTexture=function getFilterTexture(t,r){var i=this.getOptimalTexture(t.width,t.height,r||t.resolution);return i.filterFrame=t.filterFrame,i},Pt.prototype.returnTexture=function returnTexture(t){var r=t.filterPoolKey;t.filterFrame=null,this.texturePool[r].push(t)},Pt.prototype.returnFilterTexture=function returnFilterTexture(t){this.returnTexture(t)},Pt.prototype.clear=function clear(t){if(t=!1!==t)for(var r in this.texturePool){var i=this.texturePool[r];if(i)for(var o=0;o<i.length;o++)i[o].destroy(!0)}this.texturePool={}},Pt.prototype.setScreenSize=function setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){var r=Pt.SCREEN_KEY,i=this.texturePool[r];if(this.enableFullScreen=t.width>0&&t.height>0,i)for(var o=0;o<i.length;o++)i[o].destroy(!0);this.texturePool[r]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Pt.SCREEN_KEY="screen";var Ct=function Attribute(t,r,i,o,a,l,h){void 0===i&&(i=!1),void 0===o&&(o=5126),this.buffer=t,this.size=r,this.normalized=i,this.type=o,this.stride=a,this.start=l,this.instance=h};Ct.prototype.destroy=function destroy(){this.buffer=null},Ct.from=function from(t,r,i,o,a){return new Ct(t,r,i,o,a)};var At=0,Ot=function Buffer(t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=r,this.id=At++,this.disposeRunner=new nt("disposeBuffer",2)};function core_es_getBufferType(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Ot.prototype.update=function update(t){this.data=t||this.data,this._updateID++},Ot.prototype.dispose=function dispose(){this.disposeRunner.run(this,!1)},Ot.prototype.destroy=function destroy(){this.dispose(),this.data=null},Ot.from=function from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ot(t)};var Lt={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};var It={5126:4,5123:2,5121:1},Rt=0,jt={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Nt=function Geometry(t,r){void 0===t&&(t=[]),void 0===r&&(r={}),this.buffers=t,this.indexBuffer=null,this.attributes=r,this.glVertexArrayObjects={},this.id=Rt++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new nt("disposeGeometry",2),this.refCount=0};Nt.prototype.addAttribute=function addAttribute(t,r,i,o,a,l,h,g){if(void 0===o&&(o=!1),void 0===g&&(g=!1),!r)throw new Error("You must pass a buffer when creating an attribute");r.data||(r instanceof Array&&(r=new Float32Array(r)),r=new Ot(r));var y=t.split("|");if(y.length>1){for(var _=0;_<y.length;_++)this.addAttribute(y[_],r,i,o,a);return this}var x=this.buffers.indexOf(r);return-1===x&&(this.buffers.push(r),x=this.buffers.length-1),this.attributes[t]=new Ct(x,i,o,a,l,h,g),this.instanced=this.instanced||g,this},Nt.prototype.getAttribute=function getAttribute(t){return this.attributes[t]},Nt.prototype.getBuffer=function getBuffer(t){return this.buffers[this.getAttribute(t).buffer]},Nt.prototype.addIndex=function addIndex(t){return t.data||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ot(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},Nt.prototype.getIndex=function getIndex(){return this.indexBuffer},Nt.prototype.interleave=function interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,r=[],i=[],o=new Ot;for(t in this.attributes){var a=this.attributes[t],l=this.buffers[a.buffer];r.push(l.data),i.push(a.size*It[a.type]/4),a.buffer=0}for(o.data=function core_es_interleaveTypedArrays(t,r){for(var i=0,o=0,a={},l=0;l<t.length;l++)o+=r[l],i+=t[l].length;for(var h=new ArrayBuffer(4*i),g=null,y=0,_=0;_<t.length;_++){var x=r[_],w=t[_],S=core_es_getBufferType(w);a[S]||(a[S]=new Lt[S](h)),g=a[S];for(var M=0;M<w.length;M++)g[(M/x|0)*o+y+M%x]=w[M];y+=x}return new Float32Array(h)}(r,i),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[o],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Nt.prototype.getSize=function getSize(){for(var t in this.attributes){var r=this.attributes[t];return this.buffers[r.buffer].data.length/(r.stride/4||r.size)}return 0},Nt.prototype.dispose=function dispose(){this.disposeRunner.run(this,!1)},Nt.prototype.destroy=function destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Nt.prototype.clone=function clone(){for(var t=new Nt,r=0;r<this.buffers.length;r++)t.buffers[r]=new Ot(this.buffers[r].data.slice());for(var i in this.attributes){var o=this.attributes[i];t.attributes[i]=new Ct(o.buffer,o.size,o.normalized,o.type,o.stride,o.start,o.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},Nt.merge=function merge(t){for(var r,i=new Nt,o=[],a=[],l=[],h=0;h<t.length;h++){r=t[h];for(var g=0;g<r.buffers.length;g++)a[g]=a[g]||0,a[g]+=r.buffers[g].data.length,l[g]=0}for(var y=0;y<r.buffers.length;y++)o[y]=new(jt[core_es_getBufferType(r.buffers[y].data)])(a[y]),i.buffers[y]=new Ot(o[y]);for(var _=0;_<t.length;_++){r=t[_];for(var x=0;x<r.buffers.length;x++)o[x].set(r.buffers[x].data,l[x]),l[x]+=r.buffers[x].data.length}if(i.attributes=r.attributes,r.indexBuffer){i.indexBuffer=i.buffers[r.buffers.indexOf(r.indexBuffer)],i.indexBuffer.index=!0;for(var w=0,S=0,M=0,T=0,P=0;P<r.buffers.length;P++)if(r.buffers[P]!==r.indexBuffer){T=P;break}for(var C in r.attributes){var A=r.attributes[C];(0|A.buffer)===T&&(S+=A.size*It[A.type]/4)}for(var O=0;O<t.length;O++){for(var L=t[O].indexBuffer.data,I=0;I<L.length;I++)i.indexBuffer.data[I+M]+=w;w+=r.buffers[T].data.length/S,M+=L.length}}return i};var kt=function(t){function Quad(){t.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return t&&(Quad.__proto__=t),Quad.prototype=Object.create(t&&t.prototype),Quad.prototype.constructor=Quad,Quad}(Nt),Dt=function(t){function QuadUv(){t.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ot(this.vertices),this.uvBuffer=new Ot(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return t&&(QuadUv.__proto__=t),QuadUv.prototype=Object.create(t&&t.prototype),QuadUv.prototype.constructor=QuadUv,QuadUv.prototype.map=function map(t,r){var i=0,o=0;return this.uvs[0]=i,this.uvs[1]=o,this.uvs[2]=i+r.width/t.width,this.uvs[3]=o,this.uvs[4]=i+r.width/t.width,this.uvs[5]=o+r.height/t.height,this.uvs[6]=i,this.uvs[7]=o+r.height/t.height,i=r.x,o=r.y,this.vertices[0]=i,this.vertices[1]=o,this.vertices[2]=i+r.width,this.vertices[3]=o,this.vertices[4]=i+r.width,this.vertices[5]=o+r.height,this.vertices[6]=i,this.vertices[7]=o+r.height,this.invalidate(),this},QuadUv.prototype.invalidate=function invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},QuadUv}(Nt),Bt=0,Ft=function UniformGroup(t,r){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Bt++,this.static=!!r};Ft.prototype.update=function update(){this.dirtyId++},Ft.prototype.add=function add(t,r,i){this.uniforms[t]=new Ft(r,i)},Ft.from=function from(t,r){return new Ft(t,r)};var Gt=function FilterState(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Re,this.destinationFrame=new Re,this.filters=[]};Gt.prototype.clear=function clear(){this.target=null,this.filters=null,this.renderTexture=null};var Ht=function(t){function FilterSystem(r){t.call(this,r),this.defaultFilterStack=[{}],this.texturePool=new Pt,this.texturePool.setScreenSize(r.view),this.statePool=[],this.quad=new kt,this.quadUv=new Dt,this.tempRect=new Re,this.activeState={},this.globalUniforms=new Ft({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this._pixelsWidth=r.view.width,this._pixelsHeight=r.view.height}return t&&(FilterSystem.__proto__=t),FilterSystem.prototype=Object.create(t&&t.prototype),FilterSystem.prototype.constructor=FilterSystem,FilterSystem.prototype.push=function push(t,r){for(var i=this.renderer,o=this.defaultFilterStack,a=this.statePool.pop()||new Gt,l=r[0].resolution,h=r[0].padding,g=r[0].autoFit,y=r[0].legacy,_=1;_<r.length;_++){var x=r[_];l=Math.min(l,x.resolution),h=Math.max(h,x.padding),g=g||x.autoFit,y=y||x.legacy}1===o.length&&(this.defaultFilterStack[0].renderTexture=i.renderTexture.current),o.push(a),a.resolution=l,a.legacy=y,a.target=t,a.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),a.sourceFrame.pad(h),g&&a.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),a.sourceFrame.ceil(l),a.renderTexture=this.getOptimalFilterTexture(a.sourceFrame.width,a.sourceFrame.height,l),a.filters=r,a.destinationFrame.width=a.renderTexture.width,a.destinationFrame.height=a.renderTexture.height,a.renderTexture.filterFrame=a.sourceFrame,i.renderTexture.bind(a.renderTexture,a.sourceFrame),i.renderTexture.clear()},FilterSystem.prototype.pop=function pop(){var t=this.defaultFilterStack,r=t.pop(),i=r.filters;this.activeState=r;var o=this.globalUniforms.uniforms;o.outputFrame=r.sourceFrame,o.resolution=r.resolution;var a=o.inputSize,l=o.inputPixel,h=o.inputClamp;if(a[0]=r.destinationFrame.width,a[1]=r.destinationFrame.height,a[2]=1/a[0],a[3]=1/a[1],l[0]=a[0]*r.resolution,l[1]=a[1]*r.resolution,l[2]=1/l[0],l[3]=1/l[1],h[0]=.5*l[2],h[1]=.5*l[3],h[2]=r.sourceFrame.width*a[2]-.5*l[2],h[3]=r.sourceFrame.height*a[3]-.5*l[3],r.legacy){var g=o.filterArea;g[0]=r.destinationFrame.width,g[1]=r.destinationFrame.height,g[2]=r.sourceFrame.x,g[3]=r.sourceFrame.y,o.filterClamp=o.inputClamp}this.globalUniforms.update();var y=t[t.length-1];if(1===i.length)i[0].apply(this,r.renderTexture,y.renderTexture,!1,r),this.returnFilterTexture(r.renderTexture);else{var _=r.renderTexture,x=this.getOptimalFilterTexture(_.width,_.height,r.resolution);x.filterFrame=_.filterFrame;var w=0;for(w=0;w<i.length-1;++w){i[w].apply(this,_,x,!0,r);var S=_;_=x,x=S}i[w].apply(this,_,y.renderTexture,!1,r),this.returnFilterTexture(_),this.returnFilterTexture(x)}r.clear(),this.statePool.push(r)},FilterSystem.prototype.applyFilter=function applyFilter(t,r,i,o){var a=this.renderer;a.renderTexture.bind(i,i?i.filterFrame:null),o&&a.renderTexture.clear(),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,a.state.set(t.state),a.shader.bind(t),t.legacy?(this.quadUv.map(r._frame,r.filterFrame),a.geometry.bind(this.quadUv),a.geometry.draw(H.TRIANGLES)):(a.geometry.bind(this.quad),a.geometry.draw(H.TRIANGLE_STRIP))},FilterSystem.prototype.calculateSpriteMatrix=function calculateSpriteMatrix(t,r){var i=this.activeState,o=i.sourceFrame,a=i.destinationFrame,l=r._texture.orig,h=t.set(a.width,0,0,a.height,o.x,o.y),g=r.worldTransform.copyTo(Se.TEMP_MATRIX);return g.invert(),h.prepend(g),h.scale(1/l.width,1/l.height),h.translate(r.anchor.x,r.anchor.y),h},FilterSystem.prototype.destroy=function destroy(){this.texturePool.clear(!1)},FilterSystem.prototype.getOptimalFilterTexture=function getOptimalFilterTexture(t,r,i){return void 0===i&&(i=1),this.texturePool.getOptimalTexture(t,r,i)},FilterSystem.prototype.getFilterTexture=function getFilterTexture(t,r){if("number"==typeof t){var i=t;t=r,r=i}t=t||this.activeState.renderTexture;var o=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution);return o.filterFrame=t.filterFrame,o},FilterSystem.prototype.returnFilterTexture=function returnFilterTexture(t){this.texturePool.returnTexture(t)},FilterSystem.prototype.emptyPool=function emptyPool(){this.texturePool.clear(!0)},FilterSystem.prototype.resize=function resize(){this.texturePool.setScreenSize(this.renderer.view)},FilterSystem}(yt),Vt=function ObjectRenderer(t){this.renderer=t};Vt.prototype.flush=function flush(){},Vt.prototype.destroy=function destroy(){this.renderer=null},Vt.prototype.start=function start(){},Vt.prototype.stop=function stop(){this.flush()},Vt.prototype.render=function render(t){};var Ut=function(t){function BatchSystem(r){t.call(this,r),this.emptyRenderer=new Vt(r),this.currentRenderer=this.emptyRenderer}return t&&(BatchSystem.__proto__=t),BatchSystem.prototype=Object.create(t&&t.prototype),BatchSystem.prototype.constructor=BatchSystem,BatchSystem.prototype.setObjectRenderer=function setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},BatchSystem.prototype.flush=function flush(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.reset=function reset(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.copyBoundTextures=function copyBoundTextures(t,r){for(var i=this.renderer.texture.boundTextures,o=r-1;o>=0;--o)t[o]=i[o]||null,t[o]&&(t[o]._batchLocation=o)},BatchSystem.prototype.boundArray=function boundArray(t,r,i,o){for(var a=t.elements,l=t.ids,h=t.count,g=0,y=0;y<h;y++){var _=a[y],x=_._batchLocation;if(x>=0&&x<o&&r[x]===_)l[y]=x;else for(;g<o;){var w=r[g];if(!w||w._batchEnabled!==i||w._batchLocation!==g){l[y]=g,_._batchLocation=g,r[g]=_;break}g++}}},BatchSystem}(yt);Q.PREFER_ENV=k.any?D.WEBGL:D.WEBGL2,Q.STRICT_TEXTURE_CACHE=!1;var zt=0,Wt=function(t){function ContextSystem(r){t.call(this,r),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),r.view.addEventListener("webglcontextlost",this.handleContextLost,!1),r.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}t&&(ContextSystem.__proto__=t),ContextSystem.prototype=Object.create(t&&t.prototype),ContextSystem.prototype.constructor=ContextSystem;var r={isLost:{configurable:!0}};return r.isLost.get=function(){return!this.gl||this.gl.isContextLost()},ContextSystem.prototype.contextChange=function contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=zt++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},ContextSystem.prototype.initFromContext=function initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=zt++,this.renderer.runners.contextChange.run(t)},ContextSystem.prototype.initFromOptions=function initFromOptions(t){var r=this.createContext(this.renderer.view,t);this.initFromContext(r)},ContextSystem.prototype.createContext=function createContext(t,r){var i;if(Q.PREFER_ENV>=D.WEBGL2&&(i=t.getContext("webgl2",r)),i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),i},ContextSystem.prototype.getExtensions=function getExtensions(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBKIT_WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},ContextSystem.prototype.handleContextLost=function handleContextLost(t){t.preventDefault()},ContextSystem.prototype.handleContextRestored=function handleContextRestored(){this.renderer.runners.contextChange.run(this.gl)},ContextSystem.prototype.destroy=function destroy(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},ContextSystem.prototype.postrender=function postrender(){this.renderer.renderingToScreen&&this.gl.flush()},ContextSystem.prototype.validateContext=function validateContext(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(ContextSystem.prototype,r),ContextSystem}(yt),qt=function(t){function FramebufferSystem(r){t.call(this,r),this.managedFramebuffers=[],this.unknownFramebuffer=new _t(10,10)}t&&(FramebufferSystem.__proto__=t),FramebufferSystem.prototype=Object.create(t&&t.prototype),FramebufferSystem.prototype.constructor=FramebufferSystem;var r={size:{configurable:!0}};return FramebufferSystem.prototype.contextChange=function contextChange(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Re,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var r=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Q.PREFER_ENV===D.WEBGL_LEGACY&&(r=null,i=null),r?t.drawBuffers=function(t){return r.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),i||(this.writeDepthTexture=!1)}},FramebufferSystem.prototype.bind=function bind(t,r){var i=this.gl;if(t){var o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer)),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var a=0;a<t.colorTextures.length;a++)t.colorTextures[a].texturePart?this.renderer.texture.unbind(t.colorTextures[a].texture):this.renderer.texture.unbind(t.colorTextures[a]);t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},FramebufferSystem.prototype.setViewport=function setViewport(t,r,i,o){var a=this.viewport;a.width===i&&a.height===o&&a.x===t&&a.y===r||(a.x=t,a.y=r,a.width=i,a.height=o,this.gl.viewport(t,r,i,o))},r.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},FramebufferSystem.prototype.clear=function clear(t,r,i,o){var a=this.gl;a.clearColor(t,r,i,o),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},FramebufferSystem.prototype.initFramebuffer=function initFramebuffer(t){var r={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r},FramebufferSystem.prototype.resizeFramebuffer=function resizeFramebuffer(t){var r=this.gl,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));for(var o=t.colorTextures,a=0;a<o.length;a++)this.renderer.texture.bind(o[a],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},FramebufferSystem.prototype.updateFramebuffer=function updateFramebuffer(t){var r=this.gl,i=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures.length;r.drawBuffers||(o=Math.min(o,1));for(var a=[],l=0;l<o;l++){var h=t.colorTextures[l];h.texturePart?(this.renderer.texture.bind(h.texture,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,r.TEXTURE_CUBE_MAP_NEGATIVE_X+h.side,h.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,0)),a.push(r.COLOR_ATTACHMENT0+l)}if((a.length>1&&r.drawBuffers(a),t.depthTexture)&&this.writeDepthTexture){var g=t.depthTexture;this.renderer.texture.bind(g,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,g._glTextures[this.CONTEXT_UID].texture,0)}i.stencil||!t.stencil&&!t.depth||(i.stencil=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),t.depthTexture||r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,i.stencil))},FramebufferSystem.prototype.disposeFramebuffer=function disposeFramebuffer(t,r){var i=t.glFramebuffers[this.CONTEXT_UID],o=this.gl;if(i){delete t.glFramebuffers[this.CONTEXT_UID];var a=this.managedFramebuffers.indexOf(t);a>=0&&this.managedFramebuffers.splice(a,1),t.disposeRunner.remove(this),r||(o.deleteFramebuffer(i.framebuffer),i.stencil&&o.deleteRenderbuffer(i.stencil))}},FramebufferSystem.prototype.disposeAll=function disposeAll(t){var r=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<r.length;i++)this.disposeFramebuffer(r[i],t)},FramebufferSystem.prototype.forceStencil=function forceStencil(){var t=this.current;if(t){var r=t.glFramebuffers[this.CONTEXT_UID];if(r&&!r.stencil){t.enableStencil();var i=t.width,o=t.height,a=this.gl,l=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,l),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,i,o),r.stencil=l,a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,l)}}},FramebufferSystem.prototype.reset=function reset(){this.current=this.unknownFramebuffer,this.viewport=new Re},Object.defineProperties(FramebufferSystem.prototype,r),FramebufferSystem}(yt),$t=function GLBuffer(t){this.buffer=t,this.updateID=-1,this.byteLength=-1,this.refCount=0},Xt={5126:4,5123:2,5121:1},Kt=function(t){function GeometrySystem(r){t.call(this,r),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return t&&(GeometrySystem.__proto__=t),GeometrySystem.prototype=Object.create(t&&t.prototype),GeometrySystem.prototype.constructor=GeometrySystem,GeometrySystem.prototype.contextChange=function contextChange(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!t.createVertexArray){var i=this.renderer.context.extensions.vertexArrayObject;Q.PREFER_ENV===D.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(t){return i.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return i.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){},t.bindVertexArray=function(){},t.deleteVertexArray=function(){})}if(!t.vertexAttribDivisor){var o=t.getExtension("ANGLE_instanced_arrays");o?(t.vertexAttribDivisor=function(t,r){return o.vertexAttribDivisorANGLE(t,r)},t.drawElementsInstanced=function(t,r,i,a,l){return o.drawElementsInstancedANGLE(t,r,i,a,l)},t.drawArraysInstanced=function(t,r,i,a){return o.drawArraysInstancedANGLE(t,r,i,a)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===r.webGLVersion||!!r.extensions.uint32ElementIndex},GeometrySystem.prototype.bind=function bind(t,r){r=r||this.renderer.shader.shader;var i=this.gl,o=t.glVertexArrayObjects[this.CONTEXT_UID];o||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=o={});var a=o[r.program.id]||this.initGeometryVao(t,r.program);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,r.program)),this.updateBuffers()},GeometrySystem.prototype.reset=function reset(){this.unbind()},GeometrySystem.prototype.updateBuffers=function updateBuffers(){for(var t=this._activeGeometry,r=this.gl,i=0;i<t.buffers.length;i++){var o=t.buffers[i],a=o._glBuffers[this.CONTEXT_UID];if(o._updateID!==a.updateID){a.updateID=o._updateID;var l=o.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER;if(r.bindBuffer(l,a.buffer),this._boundBuffer=a,a.byteLength>=o.data.byteLength)r.bufferSubData(l,0,o.data);else{var h=o.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;a.byteLength=o.data.byteLength,r.bufferData(l,o.data,h)}}}},GeometrySystem.prototype.checkCompatibility=function checkCompatibility(t,r){var i=t.attributes,o=r.attributeData;for(var a in o)if(!i[a])throw new Error('shader and geometry incompatible, geometry missing the "'+a+'" attribute')},GeometrySystem.prototype.getSignature=function getSignature(t,r){var i=t.attributes,o=r.attributeData,a=["g",t.id];for(var l in i)o[l]&&a.push(l);return a.join("-")},GeometrySystem.prototype.initGeometryVao=function initGeometryVao(t,r){this.checkCompatibility(t,r);var i=this.gl,o=this.CONTEXT_UID,a=this.getSignature(t,r),l=t.glVertexArrayObjects[this.CONTEXT_UID],h=l[a];if(h)return l[r.id]=h,h;var g=t.buffers,y=t.attributes,_={},x={};for(var w in g)_[w]=0,x[w]=0;for(var S in y)!y[S].size&&r.attributeData[S]?y[S].size=r.attributeData[S].size:y[S].size||console.warn("PIXI Geometry attribute '"+S+"' size cannot be determined (likely the bound shader does not have the attribute)"),_[y[S].buffer]+=y[S].size*Xt[y[S].type];for(var M in y){var T=y[M],P=T.size;void 0===T.stride&&(_[T.buffer]===P*Xt[T.type]?T.stride=0:T.stride=_[T.buffer]),void 0===T.start&&(T.start=x[T.buffer],x[T.buffer]+=P*Xt[T.type])}h=i.createVertexArray(),i.bindVertexArray(h);for(var C=0;C<g.length;C++){var A=g[C];A._glBuffers[o]||(A._glBuffers[o]=new $t(i.createBuffer()),this.managedBuffers[A.id]=A,A.disposeRunner.add(this)),A._glBuffers[o].refCount++}return this.activateVao(t,r),this._activeVao=h,l[r.id]=h,l[a]=h,h},GeometrySystem.prototype.disposeBuffer=function disposeBuffer(t,r){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var i=t._glBuffers[this.CONTEXT_UID],o=this.gl;t.disposeRunner.remove(this),i&&(r||o.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}},GeometrySystem.prototype.disposeGeometry=function disposeGeometry(t,r){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var i=t.glVertexArrayObjects[this.CONTEXT_UID],o=this.gl,a=t.buffers;if(t.disposeRunner.remove(this),i){for(var l=0;l<a.length;l++){var h=a[l]._glBuffers[this.CONTEXT_UID];h.refCount--,0!==h.refCount||r||this.disposeBuffer(a[l],r)}if(!r)for(var g in i)if("g"===g[0]){var y=i[g];this._activeVao===y&&this.unbind(),o.deleteVertexArray(y)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},GeometrySystem.prototype.disposeAll=function disposeAll(t){for(var r=Object.keys(this.managedGeometries),i=0;i<r.length;i++)this.disposeGeometry(this.managedGeometries[r[i]],t);r=Object.keys(this.managedBuffers);for(var o=0;o<r.length;o++)this.disposeBuffer(this.managedBuffers[r[o]],t)},GeometrySystem.prototype.activateVao=function activateVao(t,r){var i=this.gl,o=this.CONTEXT_UID,a=t.buffers,l=t.attributes;t.indexBuffer&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[o].buffer);var h=null;for(var g in l){var y=l[g],_=a[y.buffer]._glBuffers[o];if(r.attributeData[g]){h!==_&&(i.bindBuffer(i.ARRAY_BUFFER,_.buffer),h=_);var x=r.attributeData[g].location;if(i.enableVertexAttribArray(x),i.vertexAttribPointer(x,y.size,y.type||i.FLOAT,y.normalized,y.stride,y.start),y.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(x,1)}}}},GeometrySystem.prototype.draw=function draw(t,r,i,o){var a=this.gl,l=this._activeGeometry;if(l.indexBuffer){var h=l.indexBuffer.data.BYTES_PER_ELEMENT,g=2===h?a.UNSIGNED_SHORT:a.UNSIGNED_INT;2===h||4===h&&this.canUseUInt32ElementIndex?l.instanced?a.drawElementsInstanced(t,r||l.indexBuffer.data.length,g,(i||0)*h,o||1):a.drawElements(t,r||l.indexBuffer.data.length,g,(i||0)*h):console.warn("unsupported index buffer type: uint32")}else l.instanced?a.drawArraysInstanced(t,i,r||l.getSize(),o||1):a.drawArrays(t,i,r||l.getSize());return this},GeometrySystem.prototype.unbind=function unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},GeometrySystem}(yt),Yt=function MaskData(t){this.type=Z.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null};function compileProgram(t,r,i,o){var a=compileShader(t,t.VERTEX_SHADER,r),l=compileShader(t,t.FRAGMENT_SHADER,i),h=t.createProgram();if(t.attachShader(h,a),t.attachShader(h,l),o)for(var g in o)t.bindAttribLocation(h,o[g],g);return t.linkProgram(h),t.getProgramParameter(h,t.LINK_STATUS)||(t.getShaderParameter(a,t.COMPILE_STATUS)||(console.warn(r),console.error(t.getShaderInfoLog(a))),t.getShaderParameter(l,t.COMPILE_STATUS)||(console.warn(i),console.error(t.getShaderInfoLog(l))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(h,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(h)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(h)),t.deleteProgram(h),h=null),t.deleteShader(a),t.deleteShader(l),h}function compileShader(t,r,i){var o=t.createShader(r);return t.shaderSource(o,i),t.compileShader(o),o}function core_es_defaultValue(t,r){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*r);case"vec3":return new Float32Array(3*r);case"vec4":return new Float32Array(4*r);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*r);case"ivec3":return new Int32Array(3*r);case"ivec4":return new Int32Array(4*r);case"bool":return!1;case"bvec2":return booleanArray(2*r);case"bvec3":return booleanArray(3*r);case"bvec4":return booleanArray(4*r);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function booleanArray(t){for(var r=new Array(t),i=0;i<r.length;i++)r[i]=!1;return r}Yt.prototype.reset=function reset(){this.pooled&&(this.maskObject=null,this.type=Z.NONE,this.autoDetect=!0),this._target=null},Yt.prototype.copyCountersOrReset=function copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)};var Zt,Qt={},Jt=Qt;function getTestContext(){if(Jt===Qt||Jt&&Jt.isContextLost()){var t,r=document.createElement("canvas");Q.PREFER_ENV>=D.WEBGL2&&(t=r.getContext("webgl2",{})),t||((t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}))?t.getExtension("WEBGL_draw_buffers"):t=null),Jt=t}return Jt}function setPrecision(t,r,i){if("precision"!==t.substring(0,9)){var o=r;return r===Y.HIGH&&i!==Y.HIGH&&(o=Y.MEDIUM),"precision "+o+" float;\n"+t}return i!==Y.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var en={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(t){return en[t]}var tn=null,nn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(t,r){if(!tn){var i=Object.keys(nn);tn={};for(var o=0;o<i.length;++o){var a=i[o];tn[t[a]]=nn[a]}}return tn[r]}var rn={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},an={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var sn,cn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function checkMaxIfStatementsInShader(t,r){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=r.createShader(r.FRAGMENT_SHADER);;){var o=cn.replace(/%forloop%/gi,generateIfTestSrc(t));if(r.shaderSource(i,o),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS))break;t=t/2|0}return t}function generateIfTestSrc(t){for(var r="",i=0;i<t;++i)i>0&&(r+="\nelse "),i<t-1&&(r+="if(test == "+i+".0){}");return r}var ln=0,un={},dn=function Program(t,r,i){void 0===i&&(i="pixi-shader"),this.id=ln++,this.vertexSrc=t||Program.defaultVertexSrc,this.fragmentSrc=r||Program.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),un[i]?(un[i]++,i+="-"+un[i]):un[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,Q.PRECISION_VERTEX,Y.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,Q.PRECISION_FRAGMENT,function getMaxFragmentPrecision(){if(!Zt){Zt=Y.MEDIUM;var t=getTestContext();if(t&&t.getShaderPrecisionFormat){var r=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);Zt=r.precision?Y.HIGH:Y.MEDIUM}}return Zt}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},hn={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};dn.prototype.extractData=function extractData(t,r){var i=getTestContext();if(i){var o=compileProgram(i,t,r);this.attributeData=this.getAttributeData(o,i),this.uniformData=this.getUniformData(o,i),i.deleteProgram(o)}else this.uniformData={},this.attributeData={}},dn.prototype.getAttributeData=function getAttributeData(t,r){for(var i={},o=[],a=r.getProgramParameter(t,r.ACTIVE_ATTRIBUTES),l=0;l<a;l++){var h=r.getActiveAttrib(t,l),g=mapType(r,h.type),y={type:g,name:h.name,size:mapSize(g),location:0};i[h.name]=y,o.push(y)}o.sort((function(t,r){return t.name>r.name?1:-1}));for(var _=0;_<o.length;_++)o[_].location=_;return i},dn.prototype.getUniformData=function getUniformData(t,r){for(var i={},o=r.getProgramParameter(t,r.ACTIVE_UNIFORMS),a=0;a<o;a++){var l=r.getActiveUniform(t,a),h=l.name.replace(/\[.*?\]/,""),g=l.name.match(/\[.*?\]/,""),y=mapType(r,l.type);i[h]={type:y,size:l.size,isArray:g,value:core_es_defaultValue(y,l.size)}}return i},hn.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},hn.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},dn.from=function from(t,r,i){var o=t+r,a=de[o];return a||(de[o]=a=new dn(t,r,i)),a},Object.defineProperties(dn,hn);var pn=function Shader(t,r){for(var i in this.program=t,this.uniformGroup=r?r instanceof Ft?r:new Ft(r):new Ft({}),t.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))},fn={uniforms:{configurable:!0}};pn.prototype.checkUniformExists=function checkUniformExists(t,r){if(r.uniforms[t])return!0;for(var i in r.uniforms){var o=r.uniforms[i];if(o.group&&this.checkUniformExists(t,o))return!0}return!1},pn.prototype.destroy=function destroy(){this.uniformGroup=null},fn.uniforms.get=function(){return this.uniformGroup.uniforms},pn.from=function from(t,r,i){var o=dn.from(t,r);return new pn(o,i)},Object.defineProperties(pn.prototype,fn);var mn=function State(){this.data=0,this.blendMode=G.NORMAL,this.polygonOffset=0,this.blend=!0},gn={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};gn.blend.get=function(){return!!(1&this.data)},gn.blend.set=function(t){!!(1&this.data)!==t&&(this.data^=1)},gn.offsets.get=function(){return!!(2&this.data)},gn.offsets.set=function(t){!!(2&this.data)!==t&&(this.data^=2)},gn.culling.get=function(){return!!(4&this.data)},gn.culling.set=function(t){!!(4&this.data)!==t&&(this.data^=4)},gn.depthTest.get=function(){return!!(8&this.data)},gn.depthTest.set=function(t){!!(8&this.data)!==t&&(this.data^=8)},gn.clockwiseFrontFace.get=function(){return!!(16&this.data)},gn.clockwiseFrontFace.set=function(t){!!(16&this.data)!==t&&(this.data^=16)},gn.blendMode.get=function(){return this._blendMode},gn.blendMode.set=function(t){this.blend=t!==G.NONE,this._blendMode=t},gn.polygonOffset.get=function(){return this._polygonOffset},gn.polygonOffset.set=function(t){this.offsets=!!t,this._polygonOffset=t},mn.for2d=function for2d(){var t=new mn;return t.depthTest=!1,t.blend=!0,t},Object.defineProperties(mn.prototype,gn);var vn=function(t){function Filter(r,i,o){var a=dn.from(r||Filter.defaultVertexSrc,i||Filter.defaultFragmentSrc);t.call(this,a,o),this.padding=0,this.resolution=Q.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new mn}t&&(Filter.__proto__=t),Filter.prototype=Object.create(t&&t.prototype),Filter.prototype.constructor=Filter;var r={blendMode:{configurable:!0}},i={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return Filter.prototype.apply=function apply(t,r,i,o,a){t.applyFilter(this,r,i,o,a)},r.blendMode.get=function(){return this.state.blendMode},r.blendMode.set=function(t){this.state.blendMode=t},i.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},i.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(Filter.prototype,r),Object.defineProperties(Filter,i),Filter}(pn);vn.SOURCE_KEY_MAP={};var yn=new Se,bn=function TextureMatrix(t,r){this._texture=t,this.mapCoord=new Se,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===r?.5:r,this.isSimple=!1},_n={texture:{configurable:!0}};_n.texture.get=function(){return this._texture},_n.texture.set=function(t){this._texture=t,this._updateID=-1},bn.prototype.multiplyUvs=function multiplyUvs(t,r){void 0===r&&(r=t);for(var i=this.mapCoord,o=0;o<t.length;o+=2){var a=t[o],l=t[o+1];r[o]=a*i.a+l*i.c+i.tx,r[o+1]=a*i.b+l*i.d+i.ty}return r},bn.prototype.update=function update(t){var r=this._texture;if(!r||!r.valid)return!1;if(!t&&this._updateID===r._updateID)return!1;this._updateID=r._updateID;var i=r._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);var o=r.orig,a=r.trim;a&&(yn.set(o.width/a.width,0,0,o.height/a.height,-a.x/a.width,-a.y/a.height),this.mapCoord.append(yn));var l=r.baseTexture,h=this.uClampFrame,g=this.clampMargin/l.resolution,y=this.clampOffset;return h[0]=(r._frame.x+g+y)/l.width,h[1]=(r._frame.y+g+y)/l.height,h[2]=(r._frame.x+r._frame.width-g+y)/l.width,h[3]=(r._frame.y+r._frame.height-g+y)/l.height,this.uClampOffset[0]=y/l.realWidth,this.uClampOffset[1]=y/l.realHeight,this.isSimple=r._frame.width===l.width&&r._frame.height===l.height&&0===r.rotate,!0},Object.defineProperties(bn.prototype,_n);var xn=function(t){function SpriteMaskFilter(r){var i=new Se;t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n"),r.renderable=!1,this.maskSprite=r,this.maskMatrix=i}return t&&(SpriteMaskFilter.__proto__=t),SpriteMaskFilter.prototype=Object.create(t&&t.prototype),SpriteMaskFilter.prototype.constructor=SpriteMaskFilter,SpriteMaskFilter.prototype.apply=function apply(t,r,i,o){var a=this.maskSprite,l=this.maskSprite.texture;l.valid&&(l.transform||(l.transform=new bn(l,0)),l.transform.update(),this.uniforms.npmAlpha=l.baseTexture.alphaMode?0:1,this.uniforms.mask=l,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,a).prepend(l.transform.mapCoord),this.uniforms.alpha=a.worldAlpha,this.uniforms.maskClamp=l.transform.uClampFrame,t.applyFilter(this,r,i,o))},SpriteMaskFilter}(vn),wn=function(t){function MaskSystem(r){t.call(this,r),this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t&&(MaskSystem.__proto__=t),MaskSystem.prototype=Object.create(t&&t.prototype),MaskSystem.prototype.constructor=MaskSystem,MaskSystem.prototype.setMaskStack=function setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},MaskSystem.prototype.push=function push(t,r){if(!r.isMaskData){var i=this.maskDataPool.pop()||new Yt;i.pooled=!0,i.maskObject=r,r=i}switch(r.autoDetect&&this.detect(r),r.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),r._target=t,r.type){case Z.SCISSOR:this.maskStack.push(r),this.renderer.scissor.push(r);break;case Z.STENCIL:this.maskStack.push(r),this.renderer.stencil.push(r);break;case Z.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r),this.maskStack.push(r)}},MaskSystem.prototype.pop=function pop(t){var r=this.maskStack.pop();if(r&&r._target===t){switch(r.type){case Z.SCISSOR:this.renderer.scissor.pop();break;case Z.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case Z.SPRITE:this.popSpriteMask()}r.reset(),r.pooled&&this.maskDataPool.push(r)}},MaskSystem.prototype.detect=function detect(t){var r=t.maskObject;if(r.isSprite)t.type=Z.SPRITE;else if(t.type=Z.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var i=r.worldTransform,o=Math.atan2(i.b,i.a),a=Math.atan2(i.d,i.c);o=Math.round(o*(180/Math.PI)*100),a=((a=Math.round(a*(180/Math.PI)*100)-o)%18e3+18e3)%18e3,0===(o=(o%9e3+9e3)%9e3)&&9e3===a&&(t.type=Z.SCISSOR)}},MaskSystem.prototype.pushSpriteMask=function pushSpriteMask(t){var r=t.maskObject,i=t._target,o=this.alphaMaskPool[this.alphaMaskIndex];o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new xn(r)]),o[0].resolution=this.renderer.resolution,o[0].maskSprite=r;var a=i.filterArea;i.filterArea=r.getBounds(!0),this.renderer.filter.push(i,o),i.filterArea=a,this.alphaMaskIndex++},MaskSystem.prototype.popSpriteMask=function popSpriteMask(){this.renderer.filter.pop(),this.alphaMaskIndex--},MaskSystem}(yt),Sn=function(t){function AbstractMaskSystem(r){t.call(this,r),this.maskStack=[],this.glConst=0}return t&&(AbstractMaskSystem.__proto__=t),AbstractMaskSystem.prototype=Object.create(t&&t.prototype),AbstractMaskSystem.prototype.constructor=AbstractMaskSystem,AbstractMaskSystem.prototype.getStackLength=function getStackLength(){return this.maskStack.length},AbstractMaskSystem.prototype.setMaskStack=function setMaskStack(t){var r=this.renderer.gl,i=this.getStackLength();this.maskStack=t;var o=this.getStackLength();o!==i&&(0===o?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))},AbstractMaskSystem.prototype._useCurrent=function _useCurrent(){},AbstractMaskSystem.prototype.destroy=function destroy(){t.prototype.destroy.call(this,this),this.maskStack=null},AbstractMaskSystem}(yt),Mn=function(t){function ScissorSystem(r){t.call(this,r),this.glConst=WebGLRenderingContext.SCISSOR_TEST}return t&&(ScissorSystem.__proto__=t),ScissorSystem.prototype=Object.create(t&&t.prototype),ScissorSystem.prototype.constructor=ScissorSystem,ScissorSystem.prototype.getStackLength=function getStackLength(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},ScissorSystem.prototype.push=function push(t){var r=t.maskObject;r.renderable=!0;var i=t._scissorRect,o=r.getBounds(!0),a=this.renderer.gl;r.renderable=!1,i?o.fit(i):a.enable(a.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=o,this._useCurrent()},ScissorSystem.prototype.pop=function pop(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},ScissorSystem.prototype._useCurrent=function _useCurrent(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,r=this.renderer.renderTexture.current,i=this.renderer.projection,o=i.transform,a=i.sourceFrame,l=i.destinationFrame,h=r?r.resolution:this.renderer.resolution,g=(t.x-a.x)*h+l.x,y=(t.y-a.y)*h+l.y,_=t.width*h,x=t.height*h;o&&(g+=o.tx*h,y+=o.ty*h),r||(y=this.renderer.height-x-y),this.renderer.gl.scissor(g,y,_,x)},ScissorSystem}(Sn),En=function(t){function StencilSystem(r){t.call(this,r),this.glConst=WebGLRenderingContext.STENCIL_TEST}return t&&(StencilSystem.__proto__=t),StencilSystem.prototype=Object.create(t&&t.prototype),StencilSystem.prototype.constructor=StencilSystem,StencilSystem.prototype.getStackLength=function getStackLength(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},StencilSystem.prototype.push=function push(t){var r=t.maskObject,i=this.renderer.gl,o=t._stencilCounter;0===o&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),t._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,o,this._getBitwiseMask()),i.stencilOp(i.KEEP,i.KEEP,i.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,this._useCurrent()},StencilSystem.prototype.pop=function pop(t){var r=this.renderer.gl;0===this.getStackLength()?(r.disable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),r.clearStencil(0)):(r.colorMask(!1,!1,!1,!1),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},StencilSystem.prototype._useCurrent=function _useCurrent(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},StencilSystem.prototype._getBitwiseMask=function _getBitwiseMask(){return(1<<this.getStackLength())-1},StencilSystem}(Sn),Tn=function(t){function ProjectionSystem(r){t.call(this,r),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Se,this.transform=null}return t&&(ProjectionSystem.__proto__=t),ProjectionSystem.prototype=Object.create(t&&t.prototype),ProjectionSystem.prototype.constructor=ProjectionSystem,ProjectionSystem.prototype.update=function update(t,r,i,o){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,o),this.transform&&this.projectionMatrix.append(this.transform);var a=this.renderer;a.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,a.globalUniforms.update(),a.shader.shader&&a.shader.syncUniformGroup(a.shader.shader.uniforms.globals)},ProjectionSystem.prototype.calculateProjection=function calculateProjection(t,r,i,o){var a=this.projectionMatrix;o?(a.a=1/t.width*2*i,a.d=-1/t.height*2*i,a.tx=-1-r.x*a.a,a.ty=1-r.y*a.d):(a.a=1/t.width*2*i,a.d=1/t.height*2*i,a.tx=-1-r.x*a.a,a.ty=-1-r.y*a.d)},ProjectionSystem.prototype.setTransform=function setTransform(){},ProjectionSystem}(yt),Pn=new Re,Cn=function(t){function RenderTextureSystem(r){t.call(this,r),this.clearColor=r._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Re,this.destinationFrame=new Re}return t&&(RenderTextureSystem.__proto__=t),RenderTextureSystem.prototype=Object.create(t&&t.prototype),RenderTextureSystem.prototype.constructor=RenderTextureSystem,RenderTextureSystem.prototype.bind=function bind(t,r,i){void 0===t&&(t=null),this.current=t;var o,a=this.renderer;if(t){var l=t.baseTexture;o=l.resolution,i||(Pn.width=l.realWidth,Pn.height=l.realHeight,i=Pn),r||(r=i),this.renderer.framebuffer.bind(l.framebuffer,i),this.renderer.projection.update(i,r,o,!1),this.renderer.mask.setMaskStack(l.maskStack)}else o=this.renderer.resolution,i||(Pn.width=a.width,Pn.height=a.height,i=Pn),r||(r=i),a.framebuffer.bind(null,i),this.renderer.projection.update(i,r,o,!0),this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(r),this.destinationFrame.x=i.x/o,this.destinationFrame.y=i.y/o,this.destinationFrame.width=i.width/o,this.destinationFrame.height=i.height/o,r===i&&this.sourceFrame.copyFrom(this.destinationFrame)},RenderTextureSystem.prototype.clear=function clear(t){t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3])},RenderTextureSystem.prototype.resize=function resize(){this.bind(null)},RenderTextureSystem.prototype.reset=function reset(){this.bind(null)},RenderTextureSystem}(yt),An=function GLProgram(t,r){this.program=t,this.uniformData=r,this.uniformGroups={}};An.prototype.destroy=function destroy(){this.uniformData=null,this.uniformGroups=null,this.program=null};var On=0,Ln={textureCount:0},In=function(t){function ShaderSystem(r){t.call(this,r),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=On++}return t&&(ShaderSystem.__proto__=t),ShaderSystem.prototype=Object.create(t&&t.prototype),ShaderSystem.prototype.constructor=ShaderSystem,ShaderSystem.prototype.systemCheck=function systemCheck(){if(!function unsafeEvalSupported(){if("boolean"==typeof sn)return sn;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");sn=!0===t({a:"b"},"a","b")}catch(r){sn=!1}return sn}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},ShaderSystem.prototype.contextChange=function contextChange(t){this.gl=t,this.reset()},ShaderSystem.prototype.bind=function bind(t,r){t.uniforms.globals=this.renderer.globalUniforms;var i=t.program,o=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(o.program)),r||(Ln.textureCount=0,this.syncUniformGroup(t.uniformGroup,Ln)),o},ShaderSystem.prototype.setUniforms=function setUniforms(t){var r=this.shader.program,i=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(i.uniformData,t,this.renderer)},ShaderSystem.prototype.syncUniformGroup=function syncUniformGroup(t,r){var i=this.getglProgram();t.static&&t.dirtyId===i.uniformGroups[t.id]||(i.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,r))},ShaderSystem.prototype.syncUniforms=function syncUniforms(t,r,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(r.uniformData,t.uniforms,this.renderer,i)},ShaderSystem.prototype.createSyncGroups=function createSyncGroups(t){var r=this.getSignature(t,this.shader.program.uniformData);return this.cache[r]||(this.cache[r]=function generateUniformsSync(t,r){var i="var v = null;\n    var cv = null\n    var t = 0;\n    var gl = renderer.gl\n    ";for(var o in t.uniforms){var a=r[o];a?"float"===a.type&&1===a.size?i+="\n            if(uv."+o+" !== ud."+o+".value)\n            {\n                ud."+o+".value = uv."+o+"\n                gl.uniform1f(ud."+o+".location, uv."+o+")\n            }\n":"sampler2D"!==a.type&&"samplerCube"!==a.type&&"sampler2DArray"!==a.type||1!==a.size||a.isArray?"mat3"===a.type&&1===a.size?void 0!==t.uniforms[o].a?i+="\n                gl.uniformMatrix3fv(ud."+o+".location, false, uv."+o+".toArray(true));\n                \n":i+="\n                gl.uniformMatrix3fv(ud."+o+".location, false, uv."+o+");\n                \n":"vec2"===a.type&&1===a.size?void 0!==t.uniforms[o].x?i+="\n                cv = ud."+o+".value;\n                v = uv."+o+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+o+".location, v.x, v.y);\n                }\n":i+="\n                cv = ud."+o+".value;\n                v = uv."+o+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+o+".location, v[0], v[1]);\n                }\n                \n":"vec4"===a.type&&1===a.size?void 0!==t.uniforms[o].width?i+="\n                cv = ud."+o+".value;\n                v = uv."+o+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+o+".location, v.x, v.y, v.width, v.height)\n                }\n":i+="\n                cv = ud."+o+".value;\n                v = uv."+o+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+o+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":i+="\n            cv = ud."+o+".value;\n            v = uv."+o+";\n            "+(1===a.size?rn:an)[a.type].replace("location","ud."+o+".location")+";\n":i+="\n\n            t = syncData.textureCount++;\n\n            renderer.texture.bind(uv."+o+", t);\n            \n            if(ud."+o+".value !== t)\n            {\n                ud."+o+".value = t;\n                gl.uniform1i(ud."+o+".location, t);\n; // eslint-disable-line max-len\n            }\n":t.uniforms[o].group&&(i+="\n                    renderer.shader.syncUniformGroup(uv."+o+", syncData);\n                ")}return new Function("ud","uv","renderer","syncData",i)}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]},ShaderSystem.prototype.getSignature=function getSignature(t,r){var i=t.uniforms,o=[];for(var a in i)o.push(a),r[a]&&o.push(r[a].type);return o.join("-")},ShaderSystem.prototype.getglProgram=function getglProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},ShaderSystem.prototype.generateShader=function generateShader(t){var r=this.gl,i=t.program,o={};for(var a in i.attributeData)o[a]=i.attributeData[a].location;var l=compileProgram(r,i.vertexSrc,i.fragmentSrc,o),h={};for(var g in i.uniformData){var y=i.uniformData[g];h[g]={location:r.getUniformLocation(l,g),value:core_es_defaultValue(y.type,y.size)}}var _=new An(l,h);return i.glPrograms[this.renderer.CONTEXT_UID]=_,_},ShaderSystem.prototype.reset=function reset(){this.program=null,this.shader=null},ShaderSystem.prototype.destroy=function destroy(){this.destroyed=!0},ShaderSystem}(yt);var Rn=function(t){function StateSystem(r){t.call(this,r),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=G.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.checks=[],this.defaultState=new mn,this.defaultState.blend=!0,this.defaultState.depth=!0}return t&&(StateSystem.__proto__=t),StateSystem.prototype=Object.create(t&&t.prototype),StateSystem.prototype.constructor=StateSystem,StateSystem.prototype.contextChange=function contextChange(t){this.gl=t,this.blendModes=function mapWebGLBlendModesToPixi(t,r){return void 0===r&&(r=[]),r[G.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.ADD]=[t.ONE,t.ONE],r[G.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.NONE]=[0,0],r[G.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],r[G.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],r[G.SRC_IN]=[t.DST_ALPHA,t.ZERO],r[G.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],r[G.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],r[G.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],r[G.DST_IN]=[t.ZERO,t.SRC_ALPHA],r[G.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],r[G.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],r[G.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],r[G.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],r}(t),this.set(this.defaultState),this.reset()},StateSystem.prototype.set=function set(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var r=this.stateId^t.data,i=0;r;)1&r&&this.map[i].call(this,!!(t.data&1<<i)),r>>=1,i++;this.stateId=t.data}for(var o=0;o<this.checks.length;o++)this.checks[o](this,t)},StateSystem.prototype.forceState=function forceState(t){t=t||this.defaultState;for(var r=0;r<this.map.length;r++)this.map[r].call(this,!!(t.data&1<<r));for(var i=0;i<this.checks.length;i++)this.checks[i](this,t);this.stateId=t.data},StateSystem.prototype.setBlend=function setBlend(t){this.updateCheck(StateSystem.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},StateSystem.prototype.setOffset=function setOffset(t){this.updateCheck(StateSystem.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},StateSystem.prototype.setDepthTest=function setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},StateSystem.prototype.setCullFace=function setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},StateSystem.prototype.setFrontFace=function setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},StateSystem.prototype.setBlendMode=function setBlendMode(t){if(t!==this.blendMode){this.blendMode=t;var r=this.blendModes[t],i=this.gl;2===r.length?i.blendFunc(r[0],r[1]):i.blendFuncSeparate(r[0],r[1],r[2],r[3]),6===r.length?(this._blendEq=!0,i.blendEquationSeparate(r[4],r[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}},StateSystem.prototype.setPolygonOffset=function setPolygonOffset(t,r){this.gl.polygonOffset(t,r)},StateSystem.prototype.reset=function reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},StateSystem.prototype.updateCheck=function updateCheck(t,r){var i=this.checks.indexOf(t);r&&-1===i?this.checks.push(t):r||-1===i||this.checks.splice(i,1)},StateSystem.checkBlendMode=function checkBlendMode(t,r){t.setBlendMode(r.blendMode)},StateSystem.checkPolygonOffset=function checkPolygonOffset(t,r){t.setPolygonOffset(r.polygonOffset,0)},StateSystem}(yt),jn=function(t){function TextureGCSystem(r){t.call(this,r),this.count=0,this.checkCount=0,this.maxIdle=Q.GC_MAX_IDLE,this.checkCountMax=Q.GC_MAX_CHECK_COUNT,this.mode=Q.GC_MODE}return t&&(TextureGCSystem.__proto__=t),TextureGCSystem.prototype=Object.create(t&&t.prototype),TextureGCSystem.prototype.constructor=TextureGCSystem,TextureGCSystem.prototype.postrender=function postrender(){this.renderer.renderingToScreen&&(this.count++,this.mode!==K.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},TextureGCSystem.prototype.run=function run(){for(var t=this.renderer.texture,r=t.managedTextures,i=!1,o=0;o<r.length;o++){var a=r[o];!a.framebuffer&&this.count-a.touched>this.maxIdle&&(t.destroyTexture(a,!0),r[o]=null,i=!0)}if(i){for(var l=0,h=0;h<r.length;h++)null!==r[h]&&(r[l++]=r[h]);r.length=l}},TextureGCSystem.prototype.unload=function unload(t){var r=this.renderer.textureSystem;t._texture&&t._texture._glRenderTargets&&r.destroyTexture(t._texture);for(var i=t.children.length-1;i>=0;i--)this.unload(t.children[i])},TextureGCSystem}(yt),Nn=function GLTexture(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},kn=function(t){function TextureSystem(r){t.call(this,r),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ut}return t&&(TextureSystem.__proto__=t),TextureSystem.prototype=Object.create(t&&t.prototype),TextureSystem.prototype.constructor=TextureSystem,TextureSystem.prototype.contextChange=function contextChange(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(var i=0;i<r;i++)this.boundTextures[i]=null;this.emptyTextures={};var o=new Nn(t.createTexture());t.bindTexture(t.TEXTURE_2D,o.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=o,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Nn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var a=0;a<6;a++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var l=0;l<this.boundTextures.length;l++)this.bind(null,l)},TextureSystem.prototype.bind=function bind(t,r){void 0===r&&(r=0);var i=this.gl;if(t){if((t=t.baseTexture||t).valid){t.touched=this.renderer.textureGC.count;var o=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(t.target,o.texture)),o.dirtyId!==t.dirtyId&&(this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),this.updateTexture(t)),this.boundTextures[r]=t}}else this.currentLocation!==r&&(this.currentLocation=r,i.activeTexture(i.TEXTURE0+r)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[r]=null},TextureSystem.prototype.reset=function reset(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},TextureSystem.prototype.unbind=function unbind(t){var r=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<i.length;o++)i[o]===this.unknownTexture&&this.bind(null,o)}for(var a=0;a<i.length;a++)i[a]===t&&(this.currentLocation!==a&&(r.activeTexture(r.TEXTURE0+a),this.currentLocation=a),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[t.target].texture),i[a]=null)},TextureSystem.prototype.initTexture=function initTexture(t){var r=new Nn(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r},TextureSystem.prototype.initTextureType=function initTextureType(t,r){if(r.internalFormat=t.format,r.type=t.type,2===this.webGLVersion){var i=this.renderer.gl;t.type===i.FLOAT&&t.format===i.RGBA&&(r.internalFormat=i.RGBA32F),t.type===z.HALF_FLOAT&&(r.type=i.HALF_FLOAT),r.type===i.HALF_FLOAT&&t.format===i.RGBA&&(r.internalFormat=i.RGBA16F)}},TextureSystem.prototype.updateTexture=function updateTexture(t){var r=t._glTextures[this.CONTEXT_UID];if(r){var i=this.renderer;if(this.initTextureType(t,r),t.resource&&t.resource.upload(i,t,r));else{var o=t.realWidth,a=t.realHeight,l=i.gl;(r.width!==o||r.height!==a||r.dirtyId<0)&&(r.width=o,r.height=a,l.texImage2D(t.target,0,r.internalFormat,o,a,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}},TextureSystem.prototype.destroyTexture=function destroyTexture(t,r){var i=this.gl;if((t=t.baseTexture||t)._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){var o=this.managedTextures.indexOf(t);-1!==o&&removeItems(this.managedTextures,o,1)}},TextureSystem.prototype.updateTextureStyle=function updateTextureStyle(t){var r=t._glTextures[this.CONTEXT_UID];r&&(t.mipmap!==$.POW2&&2===this.webGLVersion||t.isPowerOfTwo?r.mipmap=t.mipmap>=1:r.mipmap=0,2===this.webGLVersion||t.isPowerOfTwo?r.wrapMode=t.wrapMode:r.wrapMode=q.CLAMP,t.resource&&t.resource.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)},TextureSystem.prototype.setStyle=function setStyle(t,r){var i=this.gl;if(r.mipmap&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,r.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);var o=this.renderer.context.extensions.anisotropicFiltering;if(o&&t.anisotropicLevel>0&&t.scaleMode===W.LINEAR){var a=Math.min(t.anisotropicLevel,i.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,o.TEXTURE_MAX_ANISOTROPY_EXT,a)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode?i.LINEAR:i.NEAREST)},TextureSystem}(yt),Dn={FilterSystem:Ht,BatchSystem:Ut,ContextSystem:Wt,FramebufferSystem:qt,GeometrySystem:Kt,MaskSystem:wn,ScissorSystem:Mn,StencilSystem:En,ProjectionSystem:Tn,RenderTextureSystem:Cn,ShaderSystem:In,StateSystem:Rn,TextureGCSystem:jn,TextureSystem:kn},Bn=new Se,Fn=function(t){function AbstractRenderer(r,i){t.call(this),(i=Object.assign({},Q.RENDER_OPTIONS,i)).roundPixels&&(Q.ROUND_PIXELS=i.roundPixels,deprecation("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=i,this.type=B.UNKNOWN,this.screen=new Re(0,0,i.width,i.height),this.view=i.view||document.createElement("canvas"),this.resolution=i.resolution||Q.RESOLUTION,this.transparent=i.transparent,this.autoDensity=i.autoDensity||i.autoResize||!1,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=i.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new Ge,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}t&&(AbstractRenderer.__proto__=t),AbstractRenderer.prototype=Object.create(t&&t.prototype),AbstractRenderer.prototype.constructor=AbstractRenderer;var r={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return AbstractRenderer.prototype.initPlugins=function initPlugins(t){for(var r in t)this.plugins[r]=new t[r](this)},r.width.get=function(){return this.view.width},r.height.get=function(){return this.view.height},AbstractRenderer.prototype.resize=function resize(t,r){this.screen.width=t,this.screen.height=r,this.view.width=t*this.resolution,this.view.height=r*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=r+"px")},AbstractRenderer.prototype.generateTexture=function generateTexture(t,r,i,o){0===(o=o||t.getLocalBounds()).width&&(o.width=1),0===o.height&&(o.height=1);var a=Tt.create(0|o.width,0|o.height,r,i);return Bn.tx=-o.x,Bn.ty=-o.y,this.render(t,a,!1,Bn,!!t.parent),a},AbstractRenderer.prototype.destroy=function destroy(t){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=B.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},r.backgroundColor.get=function(){return this._backgroundColor},r.backgroundColor.set=function(t){this._backgroundColor=t,this._backgroundColorString=hex2string(t),hex2rgb(t,this._backgroundColorRgba)},Object.defineProperties(AbstractRenderer.prototype,r),AbstractRenderer}(ee.a),Gn=function(t){function Renderer(r){void 0===r&&(r={}),t.call(this,"WebGL",r),r=this.options,this.type=B.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new nt("destroy"),contextChange:new nt("contextChange",1),reset:new nt("reset"),update:new nt("update"),postrender:new nt("postrender"),prerender:new nt("prerender"),resize:new nt("resize",2)},this.globalUniforms=new Ft({projectionMatrix:new Se},!0),this.addSystem(wn,"mask").addSystem(Wt,"context").addSystem(Rn,"state").addSystem(In,"shader").addSystem(kn,"texture").addSystem(Kt,"geometry").addSystem(qt,"framebuffer").addSystem(Mn,"scissor").addSystem(En,"stencil").addSystem(Tn,"projection").addSystem(jn,"textureGC").addSystem(Ht,"filter").addSystem(Cn,"renderTexture").addSystem(Ut,"batch"),this.initPlugins(Renderer.__plugins),r.context?this.context.initFromContext(r.context):this.context.initFromOptions({alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,sayHello(2===this.context.webGLVersion?"WebGL 2":"WebGL 1"),this.resize(this.options.width,this.options.height)}return t&&(Renderer.__proto__=t),Renderer.prototype=Object.create(t&&t.prototype),Renderer.prototype.constructor=Renderer,Renderer.create=function create(t){if(isWebGLSupported())return new Renderer(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Renderer.prototype.addSystem=function addSystem(t,r){r||(r=t.name);var i=new t(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');for(var o in this[r]=i,this.runners)this.runners[o].add(i);return this},Renderer.prototype.render=function render(t,r,i,o,a){if(this.renderingToScreen=!r,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=o,!this.context.isLost){if(r||(this._lastObjectRendered=t),!a){var l=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=l}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},Renderer.prototype.resize=function resize(r,i){t.prototype.resize.call(this,r,i),this.runners.resize.run(r,i)},Renderer.prototype.reset=function reset(){return this.runners.reset.run(),this},Renderer.prototype.clear=function clear(){this.framebuffer.bind(),this.framebuffer.clear()},Renderer.prototype.destroy=function destroy(r){for(var i in this.runners.destroy.run(),this.runners)this.runners[i].destroy();t.prototype.destroy.call(this,r),this.gl=null},Renderer.registerPlugin=function registerPlugin(t,r){Renderer.__plugins=Renderer.__plugins||{},Renderer.__plugins[t]=r},Renderer}(Fn);function autoDetectRenderer(t){return Gn.create(t)}var Hn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Vn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Un=function(t){function CubeTexture(){t.apply(this,arguments)}return t&&(CubeTexture.__proto__=t),CubeTexture.prototype=Object.create(t&&t.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.from=function from(t,r){return new CubeTexture(new pt(t,r))},CubeTexture}(ut),zn=function BatchDrawCall(){this.texArray=null,this.blend=0,this.type=H.TRIANGLES,this.start=0,this.size=0,this.data=null},Wn=function BatchTextureArray(){this.elements=[],this.ids=[],this.count=0};Wn.prototype.clear=function clear(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0};var qn=function ViewableBuffer(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},$n={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};$n.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},$n.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},$n.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},$n.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},$n.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},qn.prototype.view=function view(t){return this[t+"View"]},qn.prototype.destroy=function destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},qn.sizeOf=function sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Object.defineProperties(qn.prototype,$n);var Xn=function(t){function AbstractBatchRenderer(r){t.call(this,r),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=mn.for2d(),this.size=4*Q.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),r.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}return t&&(AbstractBatchRenderer.__proto__=t),AbstractBatchRenderer.prototype=Object.create(t&&t.prototype),AbstractBatchRenderer.prototype.constructor=AbstractBatchRenderer,AbstractBatchRenderer.prototype.contextChange=function contextChange(){var t=this.renderer.gl;Q.PREFER_ENV===D.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Q.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},AbstractBatchRenderer.prototype.initFlushBuffers=function initFlushBuffers(){for(var t=AbstractBatchRenderer._drawCallPool,r=AbstractBatchRenderer._textureArrayPool,i=this.size/4,o=Math.floor(i/this.MAX_TEXTURES)+1;t.length<i;)t.push(new zn);for(;r.length<o;)r.push(new Wn);for(var a=0;a<this.MAX_TEXTURES;a++)this._tempBoundTextures[a]=null},AbstractBatchRenderer.prototype.onPrerender=function onPrerender(){this._flushId=0},AbstractBatchRenderer.prototype.render=function render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},AbstractBatchRenderer.prototype.buildTexturesAndDrawCalls=function buildTexturesAndDrawCalls(){var t=this._bufferedTextures,r=this.MAX_TEXTURES,i=AbstractBatchRenderer._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,l=this.renderer.textureGC.count,h=++ut._globalBatch,g=0,y=i[0],_=0;o.copyBoundTextures(a,r);for(var x=0;x<this._bufferSize;++x){var w=t[x];t[x]=null,w._batchEnabled!==h&&(y.count>=r&&(o.boundArray(y,a,h,r),this.buildDrawCalls(y,_,x),_=x,y=i[++g],++h),w._batchEnabled=h,w.touched=l,y.elements[y.count++]=w)}y.count>0&&(o.boundArray(y,a,h,r),this.buildDrawCalls(y,_,this._bufferSize),++g,++h);for(var S=0;S<a.length;S++)a[S]=null;ut._globalBatch=h},AbstractBatchRenderer.prototype.buildDrawCalls=function buildDrawCalls(t,r,i){var o=this,a=o._bufferedElements,l=o._attributeBuffer,h=o._indexBuffer,g=o.vertexSize,y=AbstractBatchRenderer._drawCallPool,_=this._dcIndex,x=this._aIndex,w=this._iIndex,S=y[_];S.start=this._iIndex,S.texArray=t;for(var M=r;M<i;++M){var T=a[M],P=T._texture.baseTexture,C=se[P.alphaMode?1:0][T.blendMode];a[M]=null,r<M&&S.blend!==C&&(S.size=w-S.start,r=M,(S=y[++_]).texArray=t,S.start=w),this.packInterleavedGeometry(T,l,h,x,w),x+=T.vertexData.length/2*g,w+=T.indices.length,S.blend=C}r<i&&(S.size=w-S.start,++_),this._dcIndex=_,this._aIndex=x,this._iIndex=w},AbstractBatchRenderer.prototype.bindAndClearTexArray=function bindAndClearTexArray(t){for(var r=this.renderer.texture,i=0;i<t.count;i++)r.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0},AbstractBatchRenderer.prototype.updateGeometry=function updateGeometry(){var t=this,r=t._packedGeometries,i=t._attributeBuffer,o=t._indexBuffer;Q.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(i.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(i.rawBinaryData),r[this._flushId]._indexBuffer.update(o),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},AbstractBatchRenderer.prototype.drawBatches=function drawBatches(){for(var t=this._dcIndex,r=this.renderer,i=r.gl,o=r.state,a=AbstractBatchRenderer._drawCallPool,l=null,h=0;h<t;h++){var g=a[h],y=g.texArray,_=g.type,x=g.size,w=g.start,S=g.blend;l!==y&&(l=y,this.bindAndClearTexArray(y)),this.state.blendMode=S,o.set(this.state),i.drawElements(_,x,i.UNSIGNED_SHORT,2*w)}},AbstractBatchRenderer.prototype.flush=function flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},AbstractBatchRenderer.prototype.start=function start(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),Q.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},AbstractBatchRenderer.prototype.stop=function stop(){this.flush()},AbstractBatchRenderer.prototype.destroy=function destroy(){for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]&&this._packedGeometries[r].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},AbstractBatchRenderer.prototype.getAttributeBuffer=function getAttributeBuffer(t){var r=nextPow2(Math.ceil(t/8)),i=log2(r),o=8*r;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);var a=this._aBuffers[o];return a||(this._aBuffers[o]=a=new qn(o*this.vertexSize*4)),a},AbstractBatchRenderer.prototype.getIndexBuffer=function getIndexBuffer(t){var r=nextPow2(Math.ceil(t/12)),i=log2(r),o=12*r;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);var a=this._iBuffers[i];return a||(this._iBuffers[i]=a=new Uint16Array(o)),a},AbstractBatchRenderer.prototype.packInterleavedGeometry=function packInterleavedGeometry(t,r,i,o,a){for(var l=r.uint32View,h=r.float32View,g=o/this.vertexSize,y=t.uvs,_=t.indices,x=t.vertexData,w=t._texture.baseTexture._batchLocation,S=Math.min(t.worldAlpha,1),M=S<1&&t._texture.baseTexture.alphaMode?premultiplyTint(t._tintRGB,S):t._tintRGB+(255*S<<24),T=0;T<x.length;T+=2)h[o++]=x[T],h[o++]=x[T+1],h[o++]=y[T],h[o++]=y[T+1],l[o++]=M,h[o++]=w;for(var P=0;P<_.length;P++)i[a++]=g+_[P]},AbstractBatchRenderer}(Vt);Xn._drawCallPool=[],Xn._textureArrayPool=[];var Kn=function BatchShaderGenerator(t,r){if(this.vertexSrc=t,this.fragTemplate=r,this.programCache={},this.defaultGroupCache={},r.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(r.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};Kn.prototype.generateShader=function generateShader(t){if(!this.programCache[t]){for(var r=new Int32Array(t),i=0;i<t;i++)r[i]=i;this.defaultGroupCache[t]=Ft.from({uSamplers:r},!0);var o=this.fragTemplate;o=(o=o.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new dn(this.vertexSrc,o)}var a={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:this.defaultGroupCache[t]};return new pn(this.programCache[t],a)},Kn.prototype.generateSampleSrc=function generateSampleSrc(t){var r="";r+="\n",r+="\n";for(var i=0;i<t;i++)i>0&&(r+="\nelse "),i<t-1&&(r+="if(vTextureId < "+i+".5)"),r+="\n{",r+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",r+="\n}";return r+="\n",r+="\n"};var Yn=function(t){function BatchGeometry(r){void 0===r&&(r=!1),t.call(this),this._buffer=new Ot(null,r,!1),this._indexBuffer=new Ot(null,r,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,z.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,z.FLOAT).addAttribute("aColor",this._buffer,4,!0,z.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,z.FLOAT).addIndex(this._indexBuffer)}return t&&(BatchGeometry.__proto__=t),BatchGeometry.prototype=Object.create(t&&t.prototype),BatchGeometry.prototype.constructor=BatchGeometry,BatchGeometry}(Nt),Zn="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Qn="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Jn=function BatchPluginFactory(){},er={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};Jn.create=function create(t){var r=Object.assign({vertex:Zn,fragment:Qn,geometryClass:Yn,vertexSize:6},t),i=r.vertex,o=r.fragment,a=r.vertexSize,l=r.geometryClass;return function(t){function BatchPlugin(r){t.call(this,r),this.shaderGenerator=new Kn(i,o),this.geometryClass=l,this.vertexSize=a}return t&&(BatchPlugin.__proto__=t),BatchPlugin.prototype=Object.create(t&&t.prototype),BatchPlugin.prototype.constructor=BatchPlugin,BatchPlugin}(Xn)},er.defaultVertexSrc.get=function(){return Zn},er.defaultFragmentTemplate.get=function(){return Qn},Object.defineProperties(Jn,er);var tr=Jn.create(),nr=function Application(t){var r=this;t=Object.assign({forceCanvas:!1},t),this.renderer=autoDetectRenderer(t),this.stage=new Ge,Application._plugins.forEach((function(i){i.init.call(r,t)}))},rr={view:{configurable:!0},screen:{configurable:!0}};nr.registerPlugin=function registerPlugin(t){nr._plugins.push(t)},nr.prototype.render=function render(){this.renderer.render(this.stage)},rr.view.get=function(){return this.renderer.view},rr.screen.get=function(){return this.renderer.screen},nr.prototype.destroy=function destroy(t,r){var i=this,o=nr._plugins.slice(0);o.reverse(),o.forEach((function(t){t.destroy.call(i)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},Object.defineProperties(nr.prototype,rr),nr._plugins=[];var ir=function ResizePlugin(){};ir.init=function init(t){var r=this;Object.defineProperty(this,"resizeTo",{set:function set(t){window.removeEventListener("resize",this.resize),this._resizeTo=t,t&&(window.addEventListener("resize",this.resize),this.resize())},get:function get(){return this._resizeTo}}),this.resize=function(){r._resizeTo&&(r._resizeTo===window?r.renderer.resize(window.innerWidth,window.innerHeight):r.renderer.resize(r._resizeTo.clientWidth,r._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=t.resizeTo||null},ir.destroy=function destroy(){this.resizeTo=null,this.resize=null},nr.registerPlugin(ir);var or=new Re,ar=function Extract(t){this.renderer=t,t.extract=this};ar.prototype.image=function image(t,r,i){var image=new Image;return image.src=this.base64(t,r,i),image},ar.prototype.base64=function base64(t,r,i){return this.canvas(t).toDataURL(r,i)},ar.prototype.canvas=function canvas(t){var r,i,o,a=this.renderer,l=!1,h=!1;t&&(t instanceof Tt?o=t:(o=this.renderer.generateTexture(t),h=!0)),o?(r=o.baseTexture.resolution,i=o.frame,l=!1,a.renderTexture.bind(o)):(r=this.renderer.resolution,l=!0,(i=or).width=this.renderer.width,i.height=this.renderer.height,a.renderTexture.bind(null));var g=Math.floor(i.width*r+1e-4),y=Math.floor(i.height*r+1e-4),_=new fe(g,y,1),x=new Uint8Array(4*g*y),w=a.gl;w.readPixels(i.x*r,i.y*r,g,y,w.RGBA,w.UNSIGNED_BYTE,x);var S=_.context.getImageData(0,0,g,y);return ar.arrayPostDivide(x,S.data),_.context.putImageData(S,0,0),l&&(_.context.scale(1,-1),_.context.drawImage(_.canvas,0,-y)),h&&o.destroy(!0),_.canvas},ar.prototype.pixels=function pixels(t){var r,i,o,a=this.renderer,l=!1;t&&(t instanceof Tt?o=t:(o=this.renderer.generateTexture(t),l=!0)),o?(r=o.baseTexture.resolution,i=o.frame,a.renderTexture.bind(o)):(r=a.resolution,(i=or).width=a.width,i.height=a.height,a.renderTexture.bind(null));var h=i.width*r,g=i.height*r,y=new Uint8Array(4*h*g),_=a.gl;return _.readPixels(i.x*r,i.y*r,h,g,_.RGBA,_.UNSIGNED_BYTE,y),l&&o.destroy(!0),ar.arrayPostDivide(y,y),y},ar.prototype.destroy=function destroy(){this.renderer.extract=null,this.renderer=null},ar.arrayPostDivide=function arrayPostDivide(t,r){for(var i=0;i<t.length;i+=4){var o=r[i+3]=t[i+3];0!==o?(r[i]=Math.round(Math.min(255*t[i]/o,255)),r[i+1]=Math.round(Math.min(255*t[i+1]/o,255)),r[i+2]=Math.round(Math.min(255*t[i+2]/o,255))):(r[i]=t[i],r[i+1]=t[i+1],r[i+2]=t[i+2])}};var sr=i(71),cr=i.n(sr),lr=i(37),ur=i.n(lr);function _noop(){}function eachSeries(t,r,i,o){var a=0,l=t.length;!function next(h){h||a===l?i&&i(h):o?setTimeout((function(){r(t[a++],next)}),1):r(t[a++],next)}()}function onlyOnce(t){return function onceWrapper(){if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,arguments)}}function resource_loader_esm_queue(t,r){if(null==r)r=1;else if(0===r)throw new Error("Concurrency must not be zero");var i=0,o={_tasks:[],concurrency:r,saturated:_noop,unsaturated:_noop,buffer:r/4,empty:_noop,drain:_noop,error:_noop,started:!1,paused:!1,push:function push(t,r){_insert(t,!1,r)},kill:function kill(){i=0,o.drain=_noop,o.started=!1,o._tasks=[]},unshift:function unshift(t,r){_insert(t,!0,r)},process:function process(){for(;!o.paused&&i<o.concurrency&&o._tasks.length;){var r=o._tasks.shift();0===o._tasks.length&&o.empty(),(i+=1)===o.concurrency&&o.saturated(),t(r.data,onlyOnce(_next(r)))}},length:function length(){return o._tasks.length},running:function running(){return i},idle:function idle(){return o._tasks.length+i===0},pause:function pause(){!0!==o.paused&&(o.paused=!0)},resume:function resume(){if(!1!==o.paused){o.paused=!1;for(var t=1;t<=o.concurrency;t++)o.process()}}};function _insert(t,r,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");if(o.started=!0,null==t&&o.idle())setTimeout((function(){return o.drain()}),1);else{var a={data:t,callback:"function"==typeof i?i:_noop};r?o._tasks.unshift(a):o._tasks.push(a),setTimeout((function(){return o.process()}),1)}}function _next(t){return function next(){i-=1,t.callback.apply(t,arguments),null!=arguments[0]&&o.error(arguments[0],t.data),i<=o.concurrency-o.buffer&&o.unsaturated(),o.idle()&&o.drain(),o.process()}}return o}var dr={};function _defineProperties(t,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,i){return r&&_defineProperties(t.prototype,r),i&&_defineProperties(t,i),t}var hr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),pr=null;function _noop$1(){}var fr=function(){function Resource(t,r,i){if("string"!=typeof t||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(Resource.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=t,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=Resource.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop$1,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new ur.a,this.onProgress=new ur.a,this.onComplete=new ur.a,this.onAfterMiddleware=new ur.a}Resource.setExtensionLoadType=function setExtensionLoadType(t,r){setExtMap(Resource._loadTypeMap,t,r)},Resource.setExtensionXhrType=function setExtensionXhrType(t,r){setExtMap(Resource._xhrTypeMap,t,r)};var t=Resource.prototype;return t.complete=function complete(){this._clearEvents(),this._finish()},t.abort=function abort(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=Resource.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.load=function load(t){var r=this;if(!this.isLoading)if(this.isComplete)t&&setTimeout((function(){return t(r)}),1);else switch(t&&this.onComplete.once(t),this._setFlag(Resource.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case Resource.LOAD_TYPE.IMAGE:this.type=Resource.TYPE.IMAGE,this._loadElement("image");break;case Resource.LOAD_TYPE.AUDIO:this.type=Resource.TYPE.AUDIO,this._loadSourceElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this.type=Resource.TYPE.VIDEO,this._loadSourceElement("video");break;case Resource.LOAD_TYPE.XHR:default:hr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t._hasFlag=function _hasFlag(t){return 0!=(this._flags&t)},t._setFlag=function _setFlag(t,r){this._flags=r?this._flags|t:this._flags&~t},t._clearEvents=function _clearEvents(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t._finish=function _finish(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(Resource.STATUS_FLAGS.COMPLETE,!0),this._setFlag(Resource.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t._loadElement=function _loadElement(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t._loadSourceElement=function _loadSourceElement(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var r=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(r)?r[i]:r));else{var o=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(o)?o[0]:o))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},t._loadXhr=function _loadXhr(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=Resource.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},t._loadXdr=function _loadXdr(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},t._createSource=function _createSource(t,r,i){i||(i=t+"/"+this._getExtension(r));var o=document.createElement("source");return o.src=r,o.type=i,o},t._onError=function _onError(t){this.abort("Failed to load element using: "+t.target.nodeName)},t._onProgress=function _onProgress(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},t._onTimeout=function _onTimeout(){this.abort("Load timed out.")},t._xhrOnError=function _xhrOnError(){var t=this.xhr;this.abort(reqType(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},t._xhrOnTimeout=function _xhrOnTimeout(){var t=this.xhr;this.abort(reqType(t)+" Request timed out.")},t._xhrOnAbort=function _xhrOnAbort(){var t=this.xhr;this.abort(reqType(t)+" Request was aborted by the user.")},t._xhrOnLoad=function _xhrOnLoad(){var t=this.xhr,r="",i=void 0===t.status?200:t.status;if(""!==t.responseType&&"text"!==t.responseType&&void 0!==t.responseType||(r=t.responseText),0===i&&(r.length>0||t.responseType===Resource.XHR_RESPONSE_TYPE.BUFFER)?i=200:1223===i&&(i=204),2===(i/100|0)){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=Resource.TYPE.TEXT;else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=Resource.TYPE.JSON}catch(l){return void this.abort("Error trying to parse loaded json: "+l)}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var o=new DOMParser;this.data=o.parseFromString(r,"text/xml")}else{var a=document.createElement("div");a.innerHTML=r,this.data=a}this.type=Resource.TYPE.XML}catch(l){return void this.abort("Error trying to parse loaded xml: "+l)}else this.data=t.response||r;this.complete()}else this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL)},t._determineCrossOrigin=function _determineCrossOrigin(t,r){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";r=r||window.location,pr||(pr=document.createElement("a")),pr.href=t;var i=!(t=cr()(pr.href,{strictMode:!0})).port&&""===r.port||t.port===r.port,o=t.protocol?t.protocol+":":"";return t.host===r.hostname&&i&&o===r.protocol?"":"anonymous"},t._determineXhrType=function _determineXhrType(){return Resource._xhrTypeMap[this.extension]||Resource.XHR_RESPONSE_TYPE.TEXT},t._determineLoadType=function _determineLoadType(){return Resource._loadTypeMap[this.extension]||Resource.LOAD_TYPE.XHR},t._getExtension=function _getExtension(){var t=this.url,r="";if(this.isDataUrl){var i=t.indexOf("/");r=t.substring(i+1,t.indexOf(";",i))}else{var o=t.indexOf("?"),a=t.indexOf("#"),l=Math.min(o>-1?o:t.length,a>-1?a:t.length);r=(t=t.substring(0,l)).substring(t.lastIndexOf(".")+1)}return r.toLowerCase()},t._getMimeFromXhrType=function _getMimeFromXhrType(t){switch(t){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},_createClass(Resource,[{key:"isDataUrl",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function get(){return this._hasFlag(Resource.STATUS_FLAGS.LOADING)}}]),Resource}();function setExtMap(t,r,i){r&&0===r.indexOf(".")&&(r=r.substring(1)),r&&(t[r]=i)}function reqType(t){return t.toString().replace("object ","")}fr.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},fr.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},fr.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},fr.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},fr._loadTypeMap={gif:fr.LOAD_TYPE.IMAGE,png:fr.LOAD_TYPE.IMAGE,bmp:fr.LOAD_TYPE.IMAGE,jpg:fr.LOAD_TYPE.IMAGE,jpeg:fr.LOAD_TYPE.IMAGE,tif:fr.LOAD_TYPE.IMAGE,tiff:fr.LOAD_TYPE.IMAGE,webp:fr.LOAD_TYPE.IMAGE,tga:fr.LOAD_TYPE.IMAGE,svg:fr.LOAD_TYPE.IMAGE,"svg+xml":fr.LOAD_TYPE.IMAGE,mp3:fr.LOAD_TYPE.AUDIO,ogg:fr.LOAD_TYPE.AUDIO,wav:fr.LOAD_TYPE.AUDIO,mp4:fr.LOAD_TYPE.VIDEO,webm:fr.LOAD_TYPE.VIDEO},fr._xhrTypeMap={xhtml:fr.XHR_RESPONSE_TYPE.DOCUMENT,html:fr.XHR_RESPONSE_TYPE.DOCUMENT,htm:fr.XHR_RESPONSE_TYPE.DOCUMENT,xml:fr.XHR_RESPONSE_TYPE.DOCUMENT,tmx:fr.XHR_RESPONSE_TYPE.DOCUMENT,svg:fr.XHR_RESPONSE_TYPE.DOCUMENT,tsx:fr.XHR_RESPONSE_TYPE.DOCUMENT,gif:fr.XHR_RESPONSE_TYPE.BLOB,png:fr.XHR_RESPONSE_TYPE.BLOB,bmp:fr.XHR_RESPONSE_TYPE.BLOB,jpg:fr.XHR_RESPONSE_TYPE.BLOB,jpeg:fr.XHR_RESPONSE_TYPE.BLOB,tif:fr.XHR_RESPONSE_TYPE.BLOB,tiff:fr.XHR_RESPONSE_TYPE.BLOB,webp:fr.XHR_RESPONSE_TYPE.BLOB,tga:fr.XHR_RESPONSE_TYPE.BLOB,json:fr.XHR_RESPONSE_TYPE.JSON,text:fr.XHR_RESPONSE_TYPE.TEXT,txt:fr.XHR_RESPONSE_TYPE.TEXT,ttf:fr.XHR_RESPONSE_TYPE.BUFFER,otf:fr.XHR_RESPONSE_TYPE.BUFFER},fr.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var mr=window.URL||window.webkitURL;var gr={caching:function caching(t,r){var i=this;dr[t.url]?(t.data=dr[t.url],t.complete()):t.onComplete.once((function(){return dr[i.url]=i.data})),r()},parsing:function parsing(t,r){if(t.data){if(t.xhr&&t.xhrType===fr.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=mr.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=i,t.type=fr.TYPE.IMAGE,void(t.data.onload=function(){mr.revokeObjectURL(i),t.data.onload=null,r()})}}else{var o=t.xhr.getResponseHeader("content-type");if(o&&0===o.indexOf("image"))return t.data=new Image,t.data.src="data:"+o+";base64,"+function encodeBinary(t){for(var r="",i=0;i<t.length;){for(var o=[0,0,0],a=[0,0,0,0],l=0;l<o.length;++l)i<t.length?o[l]=255&t.charCodeAt(i++):o[l]=0;switch(a[0]=o[0]>>2,a[1]=(3&o[0])<<4|o[1]>>4,a[2]=(15&o[1])<<2|o[2]>>6,a[3]=63&o[2],i-(t.length-1)){case 2:a[3]=64,a[2]=64;break;case 1:a[3]=64}for(var h=0;h<a.length;++h)r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a[h])}return r}(t.xhr.responseText),t.type=fr.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,r()})}r()}else r()}},vr=/(#[\w-]+)?$/,yr=function(){function Loader(t,r){var i=this;void 0===t&&(t=""),void 0===r&&(r=10),this.baseUrl=t,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,r){return i._loadResource(t,r)},this._queue=resource_loader_esm_queue(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new ur.a,this.onError=new ur.a,this.onLoad=new ur.a,this.onStart=new ur.a,this.onComplete=new ur.a;for(var o=0;o<Loader._defaultBeforeMiddleware.length;++o)this.pre(Loader._defaultBeforeMiddleware[o]);for(var a=0;a<Loader._defaultAfterMiddleware.length;++a)this.use(Loader._defaultAfterMiddleware[a])}var t=Loader.prototype;return t.add=function add(t,r,i,o){if(Array.isArray(t)){for(var a=0;a<t.length;++a)this.add(t[a]);return this}if("object"==typeof t&&(o=r||t.callback||t.onComplete,i=t,r=t.url,t=t.name||t.key||t.url),"string"!=typeof r&&(o=i,i=r,r=t),"string"!=typeof r)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(o=i,i=null),this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(r=this._prepareUrl(r),this.resources[t]=new fr(t,r,i),"function"==typeof o&&this.resources[t].onAfterMiddleware.once(o),this.loading){for(var l=i.parentResource,h=[],g=0;g<l.children.length;++g)l.children[g].isComplete||h.push(l.children[g]);var y=l.progressChunk*(h.length+1)/(h.length+2);l.children.push(this.resources[t]),l.progressChunk=y;for(var _=0;_<h.length;++_)h[_].progressChunk=y;this.resources[t].progressChunk=y}return this._queue.push(this.resources[t]),this},t.pre=function pre(t){return this._beforeMiddleware.push(t),this},t.use=function use(t){return this._afterMiddleware.push(t),this},t.reset=function reset(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var r=this.resources[t];r._onLoadBinding&&r._onLoadBinding.detach(),r.isLoading&&r.abort()}return this.resources={},this},t.load=function load(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var r=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=r;this._onStart(),this._queue.resume()}return this},t._prepareUrl=function _prepareUrl(t){var r,i=cr()(t,{strictMode:!0});if(r=i.protocol||!i.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var o=vr.exec(r)[0];-1!==(r=r.substr(0,r.length-o.length)).indexOf("?")?r+="&"+this.defaultQueryString:r+="?"+this.defaultQueryString,r+=o}return r},t._loadResource=function _loadResource(t,r){var i=this;t._dequeue=r,eachSeries(this._beforeMiddleware,(function(r,o){r.call(i,t,(function(){o(t.isComplete?{}:null)}))}),(function(){t.isComplete?i._onLoad(t):(t._onLoadBinding=t.onComplete.once(i._onLoad,i),t.load())}),!0)},t._onStart=function _onStart(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t._onComplete=function _onComplete(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t._onLoad=function _onLoad(t){var r=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),eachSeries(this._afterMiddleware,(function(i,o){i.call(r,t,o)}),(function(){t.onAfterMiddleware.dispatch(t),r.progress=Math.min(100,r.progress+t.progressChunk),r.onProgress.dispatch(r,t),t.error?r.onError.dispatch(t.error,r,t):r.onLoad.dispatch(r,t),r._resourcesParsing.splice(r._resourcesParsing.indexOf(t),1),r._queue.idle()&&0===r._resourcesParsing.length&&r._onComplete()}),!0)},_createClass(Loader,[{key:"concurrency",get:function get(){return this._queue.concurrency},set:function set(t){this._queue.concurrency=t}}]),Loader}();yr._defaultBeforeMiddleware=[],yr._defaultAfterMiddleware=[],yr.pre=function LoaderPreStatic(t){return yr._defaultBeforeMiddleware.push(t),yr},yr.use=function LoaderUseStatic(t){return yr._defaultAfterMiddleware.push(t),yr};var br=function TextureLoader(){};br.use=function use(t,r){t.data&&t.type===fr.TYPE.IMAGE&&(t.texture=Et.fromLoader(t.data,t.url,t.name)),r()};var _r=function(t){function Loader(r,i){var o=this;t.call(this,r,i),ee.a.call(this);for(var a=0;a<Loader._plugins.length;++a){var l=Loader._plugins[a],h=l.pre,g=l.use;h&&this.pre(h),g&&this.use(g)}this.onStart.add((function(t){return o.emit("start",t)})),this.onProgress.add((function(t,r){return o.emit("progress",t,r)})),this.onError.add((function(t,r,i){return o.emit("error",t,r,i)})),this.onLoad.add((function(t,r){return o.emit("load",t,r)})),this.onComplete.add((function(t,r){return o.emit("complete",t,r)})),this._protected=!1}t&&(Loader.__proto__=t),Loader.prototype=Object.create(t&&t.prototype),Loader.prototype.constructor=Loader;var r={shared:{configurable:!0}};return Loader.prototype.destroy=function destroy(){this._protected||(this.removeAllListeners(),this.reset())},r.shared.get=function(){var t=Loader._shared;return t||((t=new Loader)._protected=!0,Loader._shared=t),t},Object.defineProperties(Loader,r),Loader}(yr);Object.assign(_r.prototype,ee.a.prototype),_r._plugins=[],_r.registerPlugin=function registerPlugin(t){return _r._plugins.push(t),t.add&&t.add(),_r},_r.registerPlugin({use:gr.parsing}),_r.registerPlugin(br);var xr=function AppLoaderPlugin(){};xr.init=function init(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?_r.shared:new _r},xr.destroy=function destroy(){this.loader&&(this.loader.destroy(),this.loader=null)};var wr=fr,Sr=function(t){function ParticleContainer(r,i,o,a){void 0===r&&(r=1500),void 0===o&&(o=16384),void 0===a&&(a=!1),t.call(this);o>16384&&(o=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=r,this._batchSize=o,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=G.NORMAL,this.autoResize=a,this.roundPixels=!0,this.baseTexture=null,this.setProperties(i),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}t&&(ParticleContainer.__proto__=t),ParticleContainer.prototype=Object.create(t&&t.prototype),ParticleContainer.prototype.constructor=ParticleContainer;var r={tint:{configurable:!0}};return ParticleContainer.prototype.setProperties=function setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},ParticleContainer.prototype.updateTransform=function updateTransform(){this.displayObjectUpdateTransform()},r.tint.get=function(){return this._tint},r.tint.set=function(t){this._tint=t,hex2rgb(t,this.tintRgb)},ParticleContainer.prototype.render=function render(t){var r=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return r.onChildrenChange(0)}))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},ParticleContainer.prototype.onChildrenChange=function onChildrenChange(t){for(var r=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},ParticleContainer.prototype.dispose=function dispose(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},ParticleContainer.prototype.destroy=function destroy(r){t.prototype.destroy.call(this,r),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},Object.defineProperties(ParticleContainer.prototype,r),ParticleContainer}(Ge),Mr=function ParticleBuffer(t,r,i){this.geometry=new Nt,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var o=0;o<t.length;++o){var a=t[o];a={attributeName:a.attributeName,size:a.size,uploadFunction:a.uploadFunction,type:a.type||z.FLOAT,offset:a.offset},r[o]?this.dynamicProperties.push(a):this.staticProperties.push(a)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};Mr.prototype.initBuffers=function initBuffers(){var t=this.geometry,r=0;this.indexBuffer=new Ot(createIndicesForQuads(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){var o=this.dynamicProperties[i];o.offset=r,r+=o.size,this.dynamicStride+=o.size}var a=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(a),this.dynamicDataUint32=new Uint32Array(a),this.dynamicBuffer=new Ot(this.dynamicData,!1,!1);var l=0;this.staticStride=0;for(var h=0;h<this.staticProperties.length;++h){var g=this.staticProperties[h];g.offset=l,l+=g.size,this.staticStride+=g.size}var y=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(y),this.staticDataUint32=new Uint32Array(y),this.staticBuffer=new Ot(this.staticData,!0,!1);for(var _=0;_<this.dynamicProperties.length;++_){var x=this.dynamicProperties[_];t.addAttribute(x.attributeName,this.dynamicBuffer,0,x.type===z.UNSIGNED_BYTE,x.type,4*this.dynamicStride,4*x.offset)}for(var w=0;w<this.staticProperties.length;++w){var S=this.staticProperties[w];t.addAttribute(S.attributeName,this.staticBuffer,0,S.type===z.UNSIGNED_BYTE,S.type,4*this.staticStride,4*S.offset)}},Mr.prototype.uploadDynamic=function uploadDynamic(t,r,i){for(var o=0;o<this.dynamicProperties.length;o++){var a=this.dynamicProperties[o];a.uploadFunction(t,r,i,a.type===z.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,a.offset)}this.dynamicBuffer._updateID++},Mr.prototype.uploadStatic=function uploadStatic(t,r,i){for(var o=0;o<this.staticProperties.length;o++){var a=this.staticProperties[o];a.uploadFunction(t,r,i,a.type===z.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,a.offset)}this.staticBuffer._updateID++},Mr.prototype.destroy=function destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var Er=function(t){function ParticleRenderer(r){t.call(this,r),this.shader=null,this.properties=null,this.tempMatrix=new Se,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:z.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=pn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=mn.for2d()}return t&&(ParticleRenderer.__proto__=t),ParticleRenderer.prototype=Object.create(t&&t.prototype),ParticleRenderer.prototype.constructor=ParticleRenderer,ParticleRenderer.prototype.render=function render(t){var r=t.children,i=t._maxSize,o=t._batchSize,a=this.renderer,l=r.length;if(0!==l){l>i&&!t.autoResize&&(l=i);var h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));var g=r[0]._texture.baseTexture;this.state.blendMode=correctBlendMode(t.blendMode,g.alphaMode),a.state.set(this.state);var y=a.gl,_=t.worldTransform.copyTo(this.tempMatrix);_.prepend(a.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=_.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,g.alphaMode),this.shader.uniforms.uSampler=g,this.renderer.shader.bind(this.shader);for(var x=!1,w=0,S=0;w<l;w+=o,S+=1){var M=l-w;M>o&&(M=o),S>=h.length&&h.push(this._generateOneMoreBuffer(t));var T=h[S];T.uploadDynamic(r,w,M);var P=t._bufferUpdateIDs[S]||0;(x=x||T._updateID<P)&&(T._updateID=t._updateID,T.uploadStatic(r,w,M)),a.geometry.bind(T.geometry),y.drawElements(y.TRIANGLES,6*M,y.UNSIGNED_SHORT,0)}}},ParticleRenderer.prototype.generateBuffers=function generateBuffers(t){for(var r=[],i=t._maxSize,o=t._batchSize,a=t._properties,l=0;l<i;l+=o)r.push(new Mr(this.properties,a,o));return r},ParticleRenderer.prototype._generateOneMoreBuffer=function _generateOneMoreBuffer(t){var r=t._batchSize,i=t._properties;return new Mr(this.properties,i,r)},ParticleRenderer.prototype.uploadVertices=function uploadVertices(t,r,i,o,a,l){for(var h=0,g=0,y=0,_=0,x=0;x<i;++x){var w=t[r+x],S=w._texture,M=w.scale.x,T=w.scale.y,P=S.trim,C=S.orig;P?(h=(g=P.x-w.anchor.x*C.width)+P.width,y=(_=P.y-w.anchor.y*C.height)+P.height):(h=C.width*(1-w.anchor.x),g=C.width*-w.anchor.x,y=C.height*(1-w.anchor.y),_=C.height*-w.anchor.y),o[l]=g*M,o[l+1]=_*T,o[l+a]=h*M,o[l+a+1]=_*T,o[l+2*a]=h*M,o[l+2*a+1]=y*T,o[l+3*a]=g*M,o[l+3*a+1]=y*T,l+=4*a}},ParticleRenderer.prototype.uploadPosition=function uploadPosition(t,r,i,o,a,l){for(var h=0;h<i;h++){var g=t[r+h].position;o[l]=g.x,o[l+1]=g.y,o[l+a]=g.x,o[l+a+1]=g.y,o[l+2*a]=g.x,o[l+2*a+1]=g.y,o[l+3*a]=g.x,o[l+3*a+1]=g.y,l+=4*a}},ParticleRenderer.prototype.uploadRotation=function uploadRotation(t,r,i,o,a,l){for(var h=0;h<i;h++){var g=t[r+h].rotation;o[l]=g,o[l+a]=g,o[l+2*a]=g,o[l+3*a]=g,l+=4*a}},ParticleRenderer.prototype.uploadUvs=function uploadUvs(t,r,i,o,a,l){for(var h=0;h<i;++h){var g=t[r+h]._texture._uvs;g?(o[l]=g.x0,o[l+1]=g.y0,o[l+a]=g.x1,o[l+a+1]=g.y1,o[l+2*a]=g.x2,o[l+2*a+1]=g.y2,o[l+3*a]=g.x3,o[l+3*a+1]=g.y3,l+=4*a):(o[l]=0,o[l+1]=0,o[l+a]=0,o[l+a+1]=0,o[l+2*a]=0,o[l+2*a+1]=0,o[l+3*a]=0,o[l+3*a+1]=0,l+=4*a)}},ParticleRenderer.prototype.uploadTint=function uploadTint(t,r,i,o,a,l){for(var h=0;h<i;++h){var g=t[r+h],y=g._texture.baseTexture.alphaMode>0,_=g.alpha,x=_<1&&y?premultiplyTint(g._tintRGB,_):g._tintRGB+(255*_<<24);o[l]=x,o[l+a]=x,o[l+2*a]=x,o[l+3*a]=x,l+=4*a}},ParticleRenderer.prototype.destroy=function destroy(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},ParticleRenderer}(Vt),Tr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function _segmentsCount(t,r){if(void 0===r&&(r=20),!this.adaptive||!t||Number.isNaN(t))return r;var i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},Pr=function FillStyle(){this.reset()};Pr.prototype.clone=function clone(){var t=new Pr;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},Pr.prototype.reset=function reset(){this.color=16777215,this.alpha=1,this.texture=Et.WHITE,this.matrix=null,this.visible=!1},Pr.prototype.destroy=function destroy(){this.texture=null,this.matrix=null};var Cr={build:function build(t){t.points=t.shape.points.slice()},triangulate:function triangulate(t,r){var i=t.points,o=t.holes,a=r.points,l=r.indices;if(i.length>=6){for(var h=[],g=0;g<o.length;g++){var y=o[g];h.push(i.length/2),i=i.concat(y.points)}var _=ne()(i,h,2);if(!_)return;for(var x=a.length/2,w=0;w<_.length;w+=3)l.push(_[w]+x),l.push(_[w+1]+x),l.push(_[w+2]+x);for(var S=0;S<i.length;S++)a.push(i[S])}}},Ar={build:function build(t){var r,i,o=t.shape,a=t.points,l=o.x,h=o.y;if(a.length=0,t.type===ve.CIRC?(r=o.radius,i=o.radius):(r=o.width,i=o.height),0!==r&&0!==i){var g=Math.floor(30*Math.sqrt(o.radius))||Math.floor(15*Math.sqrt(o.width+o.height));g/=2.3;for(var y=2*Math.PI/g,_=0;_<g-.5;_++)a.push(l+Math.sin(-y*_)*r,h+Math.cos(-y*_)*i);a.push(a[0],a[1])}},triangulate:function triangulate(t,r){var i=t.points,o=r.points,a=r.indices,l=o.length/2,h=l;o.push(t.shape.x,t.shape.y);for(var g=0;g<i.length;g+=2)o.push(i[g],i[g+1]),a.push(l++,h,l)}},Or={build:function build(t){var r=t.shape,i=r.x,o=r.y,a=r.width,l=r.height,h=t.points;h.length=0,h.push(i,o,i+a,o,i+a,o+l,i,o+l)},triangulate:function triangulate(t,r){var i=t.points,o=r.points,a=o.length/2;o.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),r.indices.push(a,a+1,a+2,a+1,a+2,a+3)}},Lr={build:function build(t){var r=t.shape,i=t.points,o=r.x,a=r.y,l=r.width,h=r.height,g=r.radius;i.length=0,quadraticBezierCurve(o,a+g,o,a,o+g,a,i),quadraticBezierCurve(o+l-g,a,o+l,a,o+l,a+g,i),quadraticBezierCurve(o+l,a+h-g,o+l,a+h,o+l-g,a+h,i),quadraticBezierCurve(o+g,a+h,o,a+h,o,a+h-g,i)},triangulate:function triangulate(t,r){for(var i=t.points,o=r.points,a=r.indices,l=o.length/2,h=ne()(i,null,2),g=0,y=h.length;g<y;g+=3)a.push(h[g]+l),a.push(h[g+1]+l),a.push(h[g+2]+l);for(var _=0,x=i.length;_<x;_++)o.push(i[_],i[++_])}};function getPt(t,r,i){return t+(r-t)*i}function quadraticBezierCurve(t,r,i,o,a,l,h){void 0===h&&(h=[]);for(var g=h,y=0,_=0,x=0,w=0,S=0,M=0,T=0,P=0;T<=20;++T)y=getPt(t,i,P=T/20),_=getPt(r,o,P),x=getPt(i,a,P),w=getPt(o,l,P),S=getPt(y,x,P),M=getPt(_,w,P),g.push(S,M);return g}function buildLine(t,r){t.lineStyle.native?function buildNativeLine(t,r){var i=0,o=t.shape,a=t.points||o.points,l=o.type!==ve.POLY||o.closeStroke;if(0===a.length)return;var h=r.points,g=r.indices,y=a.length/2,_=h.length/2,x=_;for(h.push(a[0],a[1]),i=1;i<y;i++)h.push(a[2*i],a[2*i+1]),g.push(x,x+1),x++;l&&g.push(x,_)}(t,r):function buildNonNativeLine(t,r){var i=t.shape,o=t.points||i.points.slice(),a=r.closePointEps;if(0===o.length)return;var l=t.lineStyle,h=new ye(o[0],o[1]),g=new ye(o[o.length-2],o[o.length-1]),y=i.type!==ve.POLY||i.closeStroke,_=Math.abs(h.x-g.x)<a&&Math.abs(h.y-g.y)<a;if(y){o=o.slice(),_&&(o.pop(),o.pop(),g.set(o[o.length-2],o[o.length-1]));var x=g.x+.5*(h.x-g.x),w=g.y+.5*(h.y-g.y);o.unshift(x,w),o.push(x,w)}var S=r.points,M=o.length/2,T=o.length,P=S.length/2,C=l.width/2,A=o[0],O=o[1],L=o[2],I=o[3],R=0,j=0,N=-(O-I),k=A-L,D=0,B=0,G=0,H=0,V=Math.sqrt(N*N+k*k);N/=V,k/=V,N*=C,k*=C;var U=l.alignment,z=2*(1-U),W=2*U;S.push(A-N*z,O-k*z),S.push(A+N*W,O+k*W);for(var q=1;q<M-1;++q){A=o[2*(q-1)],O=o[2*(q-1)+1],L=o[2*q],I=o[2*q+1],R=o[2*(q+1)],j=o[2*(q+1)+1],N=-(O-I),k=A-L,N/=V=Math.sqrt(N*N+k*k),k/=V,N*=C,k*=C,D=-(I-j),B=L-R,D/=V=Math.sqrt(D*D+B*B),B/=V;var $=-k+O-(-k+I),X=-N+L-(-N+A),K=(-N+A)*(-k+I)-(-N+L)*(-k+O),Y=-(B*=C)+j-(-B+I),Z=-(D*=C)+L-(-D+R),Q=(-D+R)*(-B+I)-(-D+L)*(-B+j),J=$*Z-Y*X;if(Math.abs(J)<.1)J+=10.1,S.push(L-N*z,I-k*z),S.push(L+N*W,I+k*W);else{var ee=(X*Q-Z*K)/J,te=(Y*K-$*Q)/J;(ee-L)*(ee-L)+(te-I)*(te-I)>196*C*C?(G=N-D,H=k-B,G/=V=Math.sqrt(G*G+H*H),H/=V,G*=C,H*=C,S.push(L-G*z,I-H*z),S.push(L+G*W,I+H*W),S.push(L-G*W*z,I-H*z),T++):(S.push(L+(ee-L)*z,I+(te-I)*z),S.push(L-(ee-L)*W,I-(te-I)*W))}}A=o[2*(M-2)],O=o[2*(M-2)+1],L=o[2*(M-1)],I=o[2*(M-1)+1],N=-(O-I),k=A-L,V=Math.sqrt(N*N+k*k),N/=V,k/=V,N*=C,k*=C,S.push(L-N*z,I-k*z),S.push(L+N*W,I+k*W);for(var ne=r.indices,re=0;re<T-2;++re)ne.push(P,P+1,P+2),P++}(t,r)}var Ir=function(t){function Star(r,i,o,a,l,h){l=l||a/2;for(var g=-1*Math.PI/2+h,y=2*o,_=_e/y,x=[],w=0;w<y;w++){var S=w%2?l:a,M=w*_+g;x.push(r+S*Math.cos(M),i+S*Math.sin(M))}t.call(this,x)}return t&&(Star.__proto__=t),Star.prototype=Object.create(t&&t.prototype),Star.prototype.constructor=Star,Star}(ke),Rr=function ArcUtils(){};Rr.curveTo=function curveTo(t,r,i,o,a,l){var h=l[l.length-2],g=l[l.length-1]-r,y=h-t,_=o-r,x=i-t,w=Math.abs(g*x-y*_);if(w<1e-8||0===a)return l[l.length-2]===t&&l[l.length-1]===r||l.push(t,r),null;var S=g*g+y*y,M=_*_+x*x,T=g*_+y*x,P=a*Math.sqrt(S)/w,C=a*Math.sqrt(M)/w,A=P*T/S,O=C*T/M,L=P*x+C*y,I=P*_+C*g,R=y*(C+A),j=g*(C+A),N=x*(P+O),k=_*(P+O);return{cx:L+t,cy:I+r,radius:a,startAngle:Math.atan2(j-I,R-L),endAngle:Math.atan2(k-I,N-L),anticlockwise:y*_>x*g}},Rr.arc=function arc(t,r,i,o,a,l,h,g,y){for(var _=h-l,x=Tr._segmentsCount(Math.abs(_)*a,40*Math.ceil(Math.abs(_)/_e)),w=_/(2*x),S=2*w,M=Math.cos(w),T=Math.sin(w),P=x-1,C=P%1/P,A=0;A<=P;++A){var O=w+l+S*(A+C*A),L=Math.cos(O),I=-Math.sin(O);y.push((M*L+T*I)*a+i,(M*-I+T*L)*a+o)}};var jr=function BezierUtils(){};jr.curveLength=function curveLength(t,r,i,o,a,l,h,g){for(var y=0,_=0,x=0,w=0,S=0,M=0,T=0,P=0,C=0,A=0,O=0,L=t,I=r,R=1;R<=10;++R)A=L-(P=(T=(M=(S=1-(_=R/10))*S)*S)*t+3*M*_*i+3*S*(x=_*_)*a+(w=x*_)*h),O=I-(C=T*r+3*M*_*o+3*S*x*l+w*g),L=P,I=C,y+=Math.sqrt(A*A+O*O);return y},jr.curveTo=function curveTo(t,r,i,o,a,l,h){var g=h[h.length-2],y=h[h.length-1];h.length-=2;var _=Tr._segmentsCount(jr.curveLength(g,y,t,r,i,o,a,l)),x=0,w=0,S=0,M=0,T=0;h.push(g,y);for(var P=1,C=0;P<=_;++P)S=(w=(x=1-(C=P/_))*x)*x,T=(M=C*C)*C,h.push(S*g+3*w*C*t+3*x*M*i+T*a,S*y+3*w*C*r+3*x*M*o+T*l)};var Nr=function QuadraticUtils(){};Nr.curveLength=function curveLength(t,r,i,o,a,l){var h=t-2*i+a,g=r-2*o+l,y=2*i-2*t,_=2*o-2*r,x=4*(h*h+g*g),w=4*(h*y+g*_),S=y*y+_*_,M=2*Math.sqrt(x+w+S),T=Math.sqrt(x),P=2*x*T,C=2*Math.sqrt(S),A=w/T;return(P*M+T*w*(M-C)+(4*S*x-w*w)*Math.log((2*T+A+M)/(A+C)))/(4*P)},Nr.curveTo=function curveTo(t,r,i,o,a){for(var l=a[a.length-2],h=a[a.length-1],g=Tr._segmentsCount(Nr.curveLength(l,h,t,r,i,o)),y=0,_=0,x=1;x<=g;++x){var w=x/g;y=l+(t-l)*w,_=h+(r-h)*w,a.push(y+(t+(i-t)*w-y)*w,_+(r+(o-r)*w-_)*w)}};var kr=function BatchPart(){this.reset()};kr.prototype.begin=function begin(t,r,i){this.reset(),this.style=t,this.start=r,this.attribStart=i},kr.prototype.end=function end(t,r){this.attribSize=r-this.attribStart,this.size=t-this.start},kr.prototype.reset=function reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0};var Dr={};Dr[ve.POLY]=Cr,Dr[ve.CIRC]=Ar,Dr[ve.ELIP]=Ar,Dr[ve.RECT]=Or,Dr[ve.RREC]=Lr;var Br=[],Fr=[],Gr={buildPoly:Cr,buildCircle:Ar,buildRectangle:Or,buildRoundedRectangle:Lr,FILL_COMMANDS:Dr,BATCH_POOL:Br,DRAW_CALL_POOL:Fr,buildLine:buildLine,buildComplexPoly:function buildComplexPoly(t,r){var i=t.points.slice();if(!(i.length<6)){var o=r.indices;r.points=i,r.alpha=t.fillAlpha,r.color=hex2rgb(t.fillColor);for(var a=1/0,l=-1/0,h=1/0,g=-1/0,y=0,_=0,x=0;x<i.length;x+=2)a=(y=i[x])<a?y:a,l=y>l?y:l,h=(_=i[x+1])<h?_:h,g=_>g?_:g;i.push(a,h,l,h,l,g,a,g);for(var w=i.length/2,S=0;S<w;S++)o.push(S)}},bezierCurveTo:function bezierCurveTo(t,r,i,o,a,l,h,g,y,_){void 0===_&&(_=[]);var x=0,w=0,S=0,M=0,T=0;_.push(t,r);for(var P=1,C=0;P<=y;++P)S=(w=(x=1-(C=P/y))*x)*x,T=(M=C*C)*C,_.push(S*t+3*w*C*i+3*x*M*a+T*h,S*r+3*w*C*o+3*x*M*l+T*g);return _},Star:Ir,ArcUtils:Rr,BezierUtils:jr,QuadraticUtils:Nr,BatchPart:kr},Hr=function GraphicsData(t,r,i,o){void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),this.shape=t,this.lineStyle=i,this.fillStyle=r,this.matrix=o,this.type=t.type,this.points=[],this.holes=[]};Hr.prototype.clone=function clone(){return new Hr(this.shape,this.fillStyle,this.lineStyle,this.matrix)},Hr.prototype.destroy=function destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var Vr=new ye,Ur=new Be,zr=function(t){function GraphicsGeometry(){t.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new Be,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null,this.closePointEps=1e-4}t&&(GraphicsGeometry.__proto__=t),GraphicsGeometry.prototype=Object.create(t&&t.prototype),GraphicsGeometry.prototype.constructor=GraphicsGeometry;var r={bounds:{configurable:!0}};return r.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},GraphicsGeometry.prototype.invalidate=function invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,Fr.push(this.drawCalls[t]);this.drawCalls.length=0;for(var r=0;r<this.batches.length;r++){var i=this.batches[r];i.reset(),Br.push(i)}this.batches.length=0},GraphicsGeometry.prototype.clear=function clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},GraphicsGeometry.prototype.drawShape=function drawShape(t,r,i,o){var a=new Hr(t,r,i,o);return this.graphicsData.push(a),this.dirty++,this},GraphicsGeometry.prototype.drawHole=function drawHole(t,r){if(!this.graphicsData.length)return null;var i=new Hr(t,null,null,r),o=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=o.lineStyle,o.holes.push(i),this.dirty++,this},GraphicsGeometry.prototype.destroy=function destroy(r){t.prototype.destroy.call(this,r);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},GraphicsGeometry.prototype.containsPoint=function containsPoint(t){for(var r=this.graphicsData,i=0;i<r.length;++i){var o=r[i];if(o.fillStyle.visible&&(o.shape&&(o.matrix?o.matrix.applyInverse(t,Vr):Vr.copyFrom(t),o.shape.contains(Vr.x,Vr.y)))){var a=!1;if(o.holes)for(var l=0;l<o.holes.length;l++){if(o.holes[l].shape.contains(Vr.x,Vr.y)){a=!0;break}}if(!a)return!0}}return!1},GraphicsGeometry.prototype.updateBatches=function updateBatches(){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,r=this.graphicsData,i=null,o=null;this.batches.length>0&&(o=(i=this.batches[this.batches.length-1]).style);for(var a=this.shapeIndex;a<r.length;a++){this.shapeIndex++;var l=r[a],h=l.fillStyle,g=l.lineStyle;Dr[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix);for(var y=0;y<2;y++){var _=0===y?h:g;if(_.visible){var x=_.texture.baseTexture,w=this.indices.length,S=this.points.length/2;x.wrapMode=q.REPEAT,0===y?this.processFill(l):this.processLine(l);var M=this.points.length/2-S;0!==M&&(i&&!this._compareStyles(o,_)&&(i.end(w,S),i=null),i||((i=Br.pop()||new kr).begin(_,w,S),this.batches.push(i),o=_),this.addUvs(this.points,t,_.texture,S,M,_.matrix))}}}if(i){var T=this.indices.length,P=this.points.length/2;i.end(T,P)}0!==this.batches.length?(this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()):this.batchable=!0}}else this.batchable=!0},GraphicsGeometry.prototype._compareStyles=function _compareStyles(t,r){return!(!t||!r)&&(t.texture.baseTexture===r.texture.baseTexture&&(t.color+t.alpha===r.color+r.alpha&&!!t.native==!!r.native))},GraphicsGeometry.prototype.validateBatching=function validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,r=this.graphicsData.length;t<r;t++){var i=this.graphicsData[t],o=i.fillStyle,a=i.lineStyle;if(o&&!o.texture.baseTexture.valid)return!1;if(a&&!a.texture.baseTexture.valid)return!1}return!0},GraphicsGeometry.prototype.packBatches=function packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,r=0,i=t.length;r<i;r++)for(var o=t[r],a=0;a<o.size;a++){var l=o.start+a;this.indicesUint16[l]=this.indicesUint16[l]-o.attribStart}},GraphicsGeometry.prototype.isBatchable=function isBatchable(){for(var t=this.batches,r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<2*GraphicsGeometry.BATCHABLE_SIZE},GraphicsGeometry.prototype.buildDrawCalls=function buildDrawCalls(){for(var t=++ut._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].textures.length=0,Fr.push(this.drawCalls[r]);this.drawCalls.length=0;var i=this.colors,o=this.textureIds,a=Fr.pop();a||((a=new zn).textures=new Wn),a.textures.count=0,a.start=0,a.size=0,a.type=H.TRIANGLES;var l=0,h=null,g=0,y=!1,_=H.TRIANGLES,x=0;this.drawCalls.push(a);for(var w=0;w<this.batches.length;w++){var S=this.batches[w],M=S.style,T=M.texture.baseTexture;y!==!!M.native&&(_=(y=!!M.native)?H.LINES:H.TRIANGLES,h=null,l=8,t++),h!==T&&(h=T,T._batchEnabled!==t&&(8===l&&(t++,l=0,a.size>0&&((a=Fr.pop())||((a=new zn).textures=new Wn),this.drawCalls.push(a)),a.start=x,a.size=0,a.textures.count=0,a.type=_),T.touched=1,T._batchEnabled=t,T._batchLocation=l,T.wrapMode=10497,a.textures.elements[a.textures.count++]=T,l++)),a.size+=S.size,x+=S.size,g=T._batchLocation,this.addColors(i,M.color,M.alpha,S.attribSize),this.addTextureIds(o,g,S.attribSize)}ut._globalBatch=t,this.packAttributes()},GraphicsGeometry.prototype.packAttributes=function packAttributes(){for(var t=this.points,r=this.uvs,i=this.colors,o=this.textureIds,a=new ArrayBuffer(3*t.length*4),l=new Float32Array(a),h=new Uint32Array(a),g=0,y=0;y<t.length/2;y++)l[g++]=t[2*y],l[g++]=t[2*y+1],l[g++]=r[2*y],l[g++]=r[2*y+1],h[g++]=i[y],l[g++]=o[y];this._buffer.update(a),this._indexBuffer.update(this.indicesUint16)},GraphicsGeometry.prototype.processFill=function processFill(t){t.holes.length?(this.processHoles(t.holes),Cr.triangulate(t,this)):Dr[t.type].triangulate(t,this)},GraphicsGeometry.prototype.processLine=function processLine(t){buildLine(t,this);for(var r=0;r<t.holes.length;r++)buildLine(t.holes[r],this)},GraphicsGeometry.prototype.processHoles=function processHoles(t){for(var r=0;r<t.length;r++){var i=t[r];Dr[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},GraphicsGeometry.prototype.calculateBounds=function calculateBounds(){var t=this._bounds,r=Ur,i=Se.IDENTITY;this._bounds.clear(),r.clear();for(var o=0;o<this.graphicsData.length;o++){var a=this.graphicsData[o],l=a.shape,h=a.type,g=a.lineStyle,y=a.matrix||Se.IDENTITY,_=0;if(g&&g.visible){var x=g.alignment;_=g.width,h===ve.POLY?_*=.5+Math.abs(.5-x):_*=Math.max(0,x)}i!==y&&(r.isEmpty()||(t.addBoundsMatrix(r,i),r.clear()),i=y),h===ve.RECT||h===ve.RREC?r.addFramePad(l.x,l.y,l.x+l.width,l.y+l.height,_,_):h===ve.CIRC?r.addFramePad(l.x,l.y,l.x,l.y,l.radius+_,l.radius+_):h===ve.ELIP?r.addFramePad(l.x,l.y,l.x,l.y,l.width+_,l.height+_):t.addVerticesMatrix(i,l.points,0,l.points.length,_,_)}r.isEmpty()||t.addBoundsMatrix(r,i),t.pad(this.boundsPadding,this.boundsPadding)},GraphicsGeometry.prototype.transformPoints=function transformPoints(t,r){for(var i=0;i<t.length/2;i++){var o=t[2*i],a=t[2*i+1];t[2*i]=r.a*o+r.c*a+r.tx,t[2*i+1]=r.b*o+r.d*a+r.ty}},GraphicsGeometry.prototype.addColors=function addColors(t,r,i,o){for(var a=premultiplyTint((r>>16)+(65280&r)+((255&r)<<16),i);o-- >0;)t.push(a)},GraphicsGeometry.prototype.addTextureIds=function addTextureIds(t,r,i){for(;i-- >0;)t.push(r)},GraphicsGeometry.prototype.addUvs=function addUvs(t,r,i,o,a,l){for(var h=0,g=r.length,y=i.frame;h<a;){var _=t[2*(o+h)],x=t[2*(o+h)+1];if(l){var w=l.a*_+l.c*x+l.tx;x=l.b*_+l.d*x+l.ty,_=w}h++,r.push(_/y.width,x/y.height)}var S=i.baseTexture;(y.width<S.width||y.height<S.height)&&this.adjustUvs(r,i,g,a)},GraphicsGeometry.prototype.adjustUvs=function adjustUvs(t,r,i,o){for(var a=r.baseTexture,l=1e-6,h=i+2*o,g=r.frame,y=g.width/a.width,_=g.height/a.height,x=g.x/g.width,w=g.y/g.height,S=Math.floor(t[i]+l),M=Math.floor(t[i+1]+l),T=i+2;T<h;T+=2)S=Math.min(S,Math.floor(t[T]+l)),M=Math.min(M,Math.floor(t[T+1]+l));x-=S,w-=M;for(var P=i;P<h;P+=2)t[P]=(t[P]+x)*y,t[P+1]=(t[P+1]+w)*_},Object.defineProperties(GraphicsGeometry.prototype,r),GraphicsGeometry}(Yn);zr.BATCHABLE_SIZE=100;var Wr=function(t){function LineStyle(){t.apply(this,arguments)}return t&&(LineStyle.__proto__=t),LineStyle.prototype=Object.create(t&&t.prototype),LineStyle.prototype.constructor=LineStyle,LineStyle.prototype.clone=function clone(){var t=new LineStyle;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t},LineStyle.prototype.reset=function reset(){t.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},LineStyle}(Pr),qr=new Float32Array(3),$r={},Xr=function(t){function Graphics(r){void 0===r&&(r=null),t.call(this),this.geometry=r||new zr,this.geometry.refCount++,this.shader=null,this.state=mn.for2d(),this._fillStyle=new Pr,this._lineStyle=new Wr,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=G.NORMAL}t&&(Graphics.__proto__=t),Graphics.prototype=Object.create(t&&t.prototype),Graphics.prototype.constructor=Graphics;var r={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return Graphics.prototype.clone=function clone(){return this.finishPoly(),new Graphics(this.geometry)},r.blendMode.set=function(t){this.state.blendMode=t},r.blendMode.get=function(){return this.state.blendMode},r.tint.get=function(){return this._tint},r.tint.set=function(t){this._tint=t},r.fill.get=function(){return this._fillStyle},r.line.get=function(){return this._lineStyle},Graphics.prototype.lineStyle=function lineStyle(t){if("number"==typeof t){var r=arguments;t={width:r[0]||0,color:r[1]||0,alpha:void 0!==r[2]?r[2]:1,alignment:void 0!==r[3]?r[3]:.5,native:!!r[4]}}return this.lineTextureStyle(t)},Graphics.prototype.lineTextureStyle=function lineTextureStyle(t){if("number"==typeof t){deprecation("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],l=arguments[4],h=arguments[5],g=arguments[6];t={width:r,texture:i,color:o,alpha:a,matrix:l,alignment:h,native:g},Object.keys(t).forEach((function(r){return void 0===t[r]&&delete t[r]}))}t=Object.assign({width:0,texture:Et.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1},t),this.currentPath&&this.startPoly();var y=t.width>0&&t.alpha>0;return y?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:y},t)):this._lineStyle.reset(),this},Graphics.prototype.startPoly=function startPoly(){if(this.currentPath){var t=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new ke,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[r-2],t[r-1]))}else this.currentPath=new ke,this.currentPath.closeStroke=!1},Graphics.prototype.finishPoly=function finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},Graphics.prototype.moveTo=function moveTo(t,r){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=r,this},Graphics.prototype.lineTo=function lineTo(t,r){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,o=i[i.length-2],a=i[i.length-1];return o===t&&a===r||i.push(t,r),this},Graphics.prototype._initCurve=function _initCurve(t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,r]):this.moveTo(t,r)},Graphics.prototype.quadraticCurveTo=function quadraticCurveTo(t,r,i,o){this._initCurve();var a=this.currentPath.points;return 0===a.length&&this.moveTo(0,0),Nr.curveTo(t,r,i,o,a),this},Graphics.prototype.bezierCurveTo=function bezierCurveTo(t,r,i,o,a,l){return this._initCurve(),jr.curveTo(t,r,i,o,a,l,this.currentPath.points),this},Graphics.prototype.arcTo=function arcTo(t,r,i,o,a){this._initCurve(t,r);var l=this.currentPath.points,h=Rr.curveTo(t,r,i,o,a,l);if(h){var g=h.cx,y=h.cy,_=h.radius,x=h.startAngle,w=h.endAngle,S=h.anticlockwise;this.arc(g,y,_,x,w,S)}return this},Graphics.prototype.arc=function arc(t,r,i,o,a,l){if(void 0===l&&(l=!1),o===a)return this;if(!l&&a<=o?a+=_e:l&&o<=a&&(o+=_e),0===a-o)return this;var h=t+Math.cos(o)*i,g=r+Math.sin(o)*i,y=this.geometry.closePointEps,_=this.currentPath?this.currentPath.points:null;if(_){var x=Math.abs(_[_.length-2]-h),w=Math.abs(_[_.length-1]-g);x<y&&w<y||_.push(h,g)}else this.moveTo(h,g),_=this.currentPath.points;return Rr.arc(h,g,t,r,i,o,a,l,_),this},Graphics.prototype.beginFill=function beginFill(t,r){return void 0===t&&(t=0),void 0===r&&(r=1),this.beginTextureFill({texture:Et.WHITE,color:t,alpha:r})},Graphics.prototype.beginTextureFill=function beginTextureFill(t){if(t instanceof Et){deprecation("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3];t={texture:r,color:i,alpha:o,matrix:a},Object.keys(t).forEach((function(r){return void 0===t[r]&&delete t[r]}))}t=Object.assign({texture:Et.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var l=t.alpha>0;return l?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:l},t)):this._fillStyle.reset(),this},Graphics.prototype.endFill=function endFill(){return this.finishPoly(),this._fillStyle.reset(),this},Graphics.prototype.drawRect=function drawRect(t,r,i,o){return this.drawShape(new Re(t,r,i,o))},Graphics.prototype.drawRoundedRect=function drawRoundedRect(t,r,i,o,a){return this.drawShape(new De(t,r,i,o,a))},Graphics.prototype.drawCircle=function drawCircle(t,r,i){return this.drawShape(new je(t,r,i))},Graphics.prototype.drawEllipse=function drawEllipse(t,r,i,o){return this.drawShape(new Ne(t,r,i,o))},Graphics.prototype.drawPolygon=function drawPolygon(t){var r=arguments,i=t,o=!0;if(i.points&&(o=i.closeStroke,i=i.points),!Array.isArray(i)){i=new Array(arguments.length);for(var a=0;a<i.length;++a)i[a]=r[a]}var l=new ke(i);return l.closeStroke=o,this.drawShape(l),this},Graphics.prototype.drawShape=function drawShape(t){return this._holeMode?this.geometry.drawHole(t,this._matrix):this.geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},Graphics.prototype.drawStar=function drawStar(t,r,i,o,a,l){return void 0===l&&(l=0),this.drawPolygon(new Ir(t,r,i,o,a,l))},Graphics.prototype.clear=function clear(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},Graphics.prototype.isFastRect=function isFastRect(){return 1===this.geometry.graphicsData.length&&this.geometry.graphicsData[0].shape.type===ve.RECT&&!this.geometry.graphicsData[0].lineWidth},Graphics.prototype._render=function _render(t){this.finishPoly();var r=this.geometry;r.updateBatches(),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},Graphics.prototype._populateBatches=function _populateBatches(){var t=this.geometry,r=this.blendMode;this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.vertexData=new Float32Array(t.points);for(var i=0,o=t.batches.length;i<o;i++){var a=t.batches[i],l=a.style.color,h=new Float32Array(this.vertexData.buffer,4*a.attribStart*2,2*a.attribSize),g=new Float32Array(t.uvsFloat32.buffer,4*a.attribStart*2,2*a.attribSize),y={vertexData:h,blendMode:r,indices:new Uint16Array(t.indicesUint16.buffer,2*a.start,a.size),uvs:g,_batchRGB:hex2rgb(l),_tintRGB:l,_texture:a.style.texture,alpha:a.style.alpha,worldAlpha:1};this.batches[i]=y}},Graphics.prototype._renderBatched=function _renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,i=this.batches.length;r<i;r++){var o=this.batches[r];o.worldAlpha=this.worldAlpha*o.alpha,t.plugins[this.pluginName].render(o)}}},Graphics.prototype._renderDirect=function _renderDirect(t){var r=this._resolveDirectShader(t),i=this.geometry,o=this.tint,a=this.worldAlpha,l=r.uniforms,h=i.drawCalls;l.translationMatrix=this.transform.worldTransform,l.tint[0]=(o>>16&255)/255*a,l.tint[1]=(o>>8&255)/255*a,l.tint[2]=(255&o)/255*a,l.tint[3]=a,t.shader.bind(r),t.geometry.bind(i,r),t.state.set(this.state);for(var g=0,y=h.length;g<y;g++)this._renderDrawCallDirect(t,i.drawCalls[g])},Graphics.prototype._renderDrawCallDirect=function _renderDrawCallDirect(t,r){for(var i=r.textures,o=r.type,a=r.size,l=r.start,h=i.count,g=0;g<h;g++)t.texture.bind(i.elements[g],g);t.geometry.draw(o,a,l)},Graphics.prototype._resolveDirectShader=function _resolveDirectShader(t){var r=this.shader,i=this.pluginName;if(!r){if(!$r[i]){for(var o=new Int32Array(16),a=0;a<16;a++)o[a]=a;var l={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:Ft.from({uSamplers:o},!0)},h=t.plugins[i]._shader.program;$r[i]=new pn(h,l)}r=$r[i]}return r},Graphics.prototype._calculateBounds=function _calculateBounds(){this.finishPoly();var t=this.geometry;if(t.graphicsData.length){var r=t.bounds,i=r.minX,o=r.minY,a=r.maxX,l=r.maxY;this._bounds.addFrame(this.transform,i,o,a,l)}},Graphics.prototype.containsPoint=function containsPoint(t){return this.worldTransform.applyInverse(t,Graphics._TEMP_POINT),this.geometry.containsPoint(Graphics._TEMP_POINT)},Graphics.prototype.calculateTints=function calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=hex2rgb(this.tint,qr),r=0;r<this.batches.length;r++){var i=this.batches[r],o=i._batchRGB,a=(t[0]*o[0]*255<<16)+(t[1]*o[1]*255<<8)+(0|t[2]*o[2]*255);i._tintRGB=(a>>16)+(65280&a)+((255&a)<<16)}}},Graphics.prototype.calculateVertices=function calculateVertices(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var t=this.transform.worldTransform,r=t.a,i=t.b,o=t.c,a=t.d,l=t.tx,h=t.ty,g=this.geometry.points,y=this.vertexData,_=0,x=0;x<g.length;x+=2){var w=g[x],S=g[x+1];y[_++]=r*w+o*S+l,y[_++]=a*S+i*w+h}}},Graphics.prototype.closePath=function closePath(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},Graphics.prototype.setMatrix=function setMatrix(t){return this._matrix=t,this},Graphics.prototype.beginHole=function beginHole(){return this.finishPoly(),this._holeMode=!0,this},Graphics.prototype.endHole=function endHole(){return this.finishPoly(),this._holeMode=!1,this},Graphics.prototype.destroy=function destroy(r){t.prototype.destroy.call(this,r),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,r)},Object.defineProperties(Graphics.prototype,r),Graphics}(Ge);Xr._TEMP_POINT=new ye;var Kr=new ye,Yr=new Uint16Array([0,1,2,0,2,3]),Zr=function(t){function Sprite(r){t.call(this),this._anchor=new be(this._onAnchorUpdate,this,r?r.defaultAnchor.x:0,r?r.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=G.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=r||Et.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Yr,this.size=4,this.start=0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Q.ROUND_PIXELS}t&&(Sprite.__proto__=t),Sprite.prototype=Object.create(t&&t.prototype),Sprite.prototype.constructor=Sprite;var r={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return Sprite.prototype._onTextureUpdate=function _onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)},Sprite.prototype._onAnchorUpdate=function _onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1},Sprite.prototype.calculateVertices=function calculateVertices(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var r=this.transform.worldTransform,i=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,g=r.ty,y=this.vertexData,_=t.trim,x=t.orig,w=this._anchor,S=0,M=0,T=0,P=0;if(_?(S=(M=_.x-w._x*x.width)+_.width,T=(P=_.y-w._y*x.height)+_.height):(S=(M=-w._x*x.width)+x.width,T=(P=-w._y*x.height)+x.height),y[0]=i*M+a*P+h,y[1]=l*P+o*M+g,y[2]=i*S+a*P+h,y[3]=l*P+o*S+g,y[4]=i*S+a*T+h,y[5]=l*T+o*S+g,y[6]=i*M+a*T+h,y[7]=l*T+o*M+g,this._roundPixels)for(var C=Q.RESOLUTION,A=0;A<y.length;++A)y[A]=Math.round((y[A]*C|0)/C)}},Sprite.prototype.calculateTrimmedVertices=function calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,r=this.vertexTrimmedData,i=t.orig,o=this._anchor,a=this.transform.worldTransform,l=a.a,h=a.b,g=a.c,y=a.d,_=a.tx,x=a.ty,w=-o._x*i.width,S=w+i.width,M=-o._y*i.height,T=M+i.height;r[0]=l*w+g*M+_,r[1]=y*M+h*w+x,r[2]=l*S+g*M+_,r[3]=y*M+h*S+x,r[4]=l*S+g*T+_,r[5]=y*T+h*S+x,r[6]=l*w+g*T+_,r[7]=y*T+h*w+x},Sprite.prototype._render=function _render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},Sprite.prototype._calculateBounds=function _calculateBounds(){var t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},Sprite.prototype.getLocalBounds=function getLocalBounds(r){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),r||(this._localBoundsRect||(this._localBoundsRect=new Re),r=this._localBoundsRect),this._bounds.getRectangle(r)):t.prototype.getLocalBounds.call(this,r)},Sprite.prototype.containsPoint=function containsPoint(t){this.worldTransform.applyInverse(t,Kr);var r=this._texture.orig.width,i=this._texture.orig.height,o=-r*this.anchor.x,a=0;return Kr.x>=o&&Kr.x<o+r&&(a=-i*this.anchor.y,Kr.y>=a&&Kr.y<a+i)},Sprite.prototype.destroy=function destroy(r){if(t.prototype.destroy.call(this,r),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof r?r:r&&r.texture){var i="boolean"==typeof r?r:r&&r.baseTexture;this._texture.destroy(!!i)}this._texture=null,this.shader=null},Sprite.from=function from(t,r){return new Sprite(t instanceof Et?t:Et.from(t,r))},r.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},r.roundPixels.get=function(){return this._roundPixels},r.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},r.width.set=function(t){var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},r.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},r.height.set=function(t){var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},r.anchor.get=function(){return this._anchor},r.anchor.set=function(t){this._anchor.copyFrom(t)},r.tint.get=function(){return this._tint},r.tint.set=function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},r.texture.get=function(){return this._texture},r.texture.set=function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Et.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},Object.defineProperties(Sprite.prototype,r),Sprite}(Ge),Qr={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},Jr={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Qr.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},ei=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ti=function TextStyle(t){this.styleID=0,this.reset(),deepCopyProperties(this,t,t)},ni={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function getSingleColor(t){return"number"==typeof t?hex2string(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function getColor(t){if(Array.isArray(t)){for(var r=0;r<t.length;++r)t[r]=getSingleColor(t[r]);return t}return getSingleColor(t)}function deepCopyProperties(t,r,i){for(var o in i)Array.isArray(r[o])?t[o]=r[o].slice():t[o]=r[o]}ti.prototype.clone=function clone(){var t={};return deepCopyProperties(t,this,Jr),new ti(t)},ti.prototype.reset=function reset(){deepCopyProperties(this,Jr,Jr)},ni.align.get=function(){return this._align},ni.align.set=function(t){this._align!==t&&(this._align=t,this.styleID++)},ni.breakWords.get=function(){return this._breakWords},ni.breakWords.set=function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},ni.dropShadow.get=function(){return this._dropShadow},ni.dropShadow.set=function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},ni.dropShadowAlpha.get=function(){return this._dropShadowAlpha},ni.dropShadowAlpha.set=function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},ni.dropShadowAngle.get=function(){return this._dropShadowAngle},ni.dropShadowAngle.set=function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},ni.dropShadowBlur.get=function(){return this._dropShadowBlur},ni.dropShadowBlur.set=function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},ni.dropShadowColor.get=function(){return this._dropShadowColor},ni.dropShadowColor.set=function(t){var r=getColor(t);this._dropShadowColor!==r&&(this._dropShadowColor=r,this.styleID++)},ni.dropShadowDistance.get=function(){return this._dropShadowDistance},ni.dropShadowDistance.set=function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},ni.fill.get=function(){return this._fill},ni.fill.set=function(t){var r=getColor(t);this._fill!==r&&(this._fill=r,this.styleID++)},ni.fillGradientType.get=function(){return this._fillGradientType},ni.fillGradientType.set=function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},ni.fillGradientStops.get=function(){return this._fillGradientStops},ni.fillGradientStops.set=function(t){(function areArraysEqual(t,r){if(!Array.isArray(t)||!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},ni.fontFamily.get=function(){return this._fontFamily},ni.fontFamily.set=function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},ni.fontSize.get=function(){return this._fontSize},ni.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},ni.fontStyle.get=function(){return this._fontStyle},ni.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},ni.fontVariant.get=function(){return this._fontVariant},ni.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},ni.fontWeight.get=function(){return this._fontWeight},ni.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},ni.letterSpacing.get=function(){return this._letterSpacing},ni.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},ni.lineHeight.get=function(){return this._lineHeight},ni.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},ni.leading.get=function(){return this._leading},ni.leading.set=function(t){this._leading!==t&&(this._leading=t,this.styleID++)},ni.lineJoin.get=function(){return this._lineJoin},ni.lineJoin.set=function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},ni.miterLimit.get=function(){return this._miterLimit},ni.miterLimit.set=function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},ni.padding.get=function(){return this._padding},ni.padding.set=function(t){this._padding!==t&&(this._padding=t,this.styleID++)},ni.stroke.get=function(){return this._stroke},ni.stroke.set=function(t){var r=getColor(t);this._stroke!==r&&(this._stroke=r,this.styleID++)},ni.strokeThickness.get=function(){return this._strokeThickness},ni.strokeThickness.set=function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},ni.textBaseline.get=function(){return this._textBaseline},ni.textBaseline.set=function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},ni.trim.get=function(){return this._trim},ni.trim.set=function(t){this._trim!==t&&(this._trim=t,this.styleID++)},ni.whiteSpace.get=function(){return this._whiteSpace},ni.whiteSpace.set=function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},ni.wordWrap.get=function(){return this._wordWrap},ni.wordWrap.set=function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},ni.wordWrapWidth.get=function(){return this._wordWrapWidth},ni.wordWrapWidth.set=function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},ti.prototype.toFontString=function toFontString(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,r=this.fontFamily;Array.isArray(this.fontFamily)||(r=this.fontFamily.split(","));for(var i=r.length-1;i>=0;i--){var o=r[i].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&ei.indexOf(o)<0&&(o='"'+o+'"'),r[i]=o}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+r.join(",")},Object.defineProperties(ti.prototype,ni);var ri=function TextMetrics(t,r,i,o,a,l,h,g,y){this.text=t,this.style=r,this.width=i,this.height=o,this.lines=a,this.lineWidths=l,this.lineHeight=h,this.maxLineWidth=g,this.fontProperties=y};ri.measureText=function measureText(t,r,i,o){void 0===o&&(o=ri._canvas),i=null==i?r.wordWrap:i;var a=r.toFontString(),l=ri.measureFont(a);0===l.fontSize&&(l.fontSize=r.fontSize,l.ascent=r.fontSize);var h=o.getContext("2d");h.font=a;for(var g=(i?ri.wordWrap(t,r,o):t).split(/(?:\r\n|\r|\n)/),y=new Array(g.length),_=0,x=0;x<g.length;x++){var w=h.measureText(g[x]).width+(g[x].length-1)*r.letterSpacing;y[x]=w,_=Math.max(_,w)}var S=_+r.strokeThickness;r.dropShadow&&(S+=r.dropShadowDistance);var M=r.lineHeight||l.fontSize+r.strokeThickness,T=Math.max(M,l.fontSize+r.strokeThickness)+(g.length-1)*(M+r.leading);return r.dropShadow&&(T+=r.dropShadowDistance),new ri(t,r,S,T,g,y,M+r.leading,_,l)},ri.wordWrap=function wordWrap(t,r,i){void 0===i&&(i=ri._canvas);for(var o=i.getContext("2d"),a=0,l="",h="",g={},y=r.letterSpacing,_=r.whiteSpace,x=ri.collapseSpaces(_),w=ri.collapseNewlines(_),S=!x,M=r.wordWrapWidth+y,T=ri.tokenize(t),P=0;P<T.length;P++){var C=T[P];if(ri.isNewline(C)){if(!w){h+=ri.addLine(l),S=!x,l="",a=0;continue}C=" "}if(x){var A=ri.isBreakingSpace(C),O=ri.isBreakingSpace(l[l.length-1]);if(A&&O)continue}var L=ri.getFromCache(C,y,g,o);if(L>M)if(""!==l&&(h+=ri.addLine(l),l="",a=0),ri.canBreakWords(C,r.breakWords))for(var I=ri.wordWrapSplit(C),R=0;R<I.length;R++){for(var j=I[R],N=1;I[R+N];){var k=I[R+N],D=j[j.length-1];if(ri.canBreakChars(D,k,C,R,r.breakWords))break;j+=k,N++}R+=j.length-1;var B=ri.getFromCache(j,y,g,o);B+a>M&&(h+=ri.addLine(l),S=!1,l="",a=0),l+=j,a+=B}else{l.length>0&&(h+=ri.addLine(l),l="",a=0);var G=P===T.length-1;h+=ri.addLine(C,!G),S=!1,l="",a=0}else L+a>M&&(S=!1,h+=ri.addLine(l),l="",a=0),(l.length>0||!ri.isBreakingSpace(C)||S)&&(l+=C,a+=L)}return h+=ri.addLine(l,!1)},ri.addLine=function addLine(t,r){return void 0===r&&(r=!0),t=ri.trimRight(t),t=r?t+"\n":t},ri.getFromCache=function getFromCache(t,r,i,o){var a=i[t];if(void 0===a){var l=t.length*r;a=o.measureText(t).width+l,i[t]=a}return a},ri.collapseSpaces=function collapseSpaces(t){return"normal"===t||"pre-line"===t},ri.collapseNewlines=function collapseNewlines(t){return"normal"===t},ri.trimRight=function trimRight(t){if("string"!=typeof t)return"";for(var r=t.length-1;r>=0;r--){var i=t[r];if(!ri.isBreakingSpace(i))break;t=t.slice(0,-1)}return t},ri.isNewline=function isNewline(t){return"string"==typeof t&&ri._newlines.indexOf(t.charCodeAt(0))>=0},ri.isBreakingSpace=function isBreakingSpace(t){return"string"==typeof t&&ri._breakingSpaces.indexOf(t.charCodeAt(0))>=0},ri.tokenize=function tokenize(t){var r=[],i="";if("string"!=typeof t)return r;for(var o=0;o<t.length;o++){var a=t[o];ri.isBreakingSpace(a)||ri.isNewline(a)?(""!==i&&(r.push(i),i=""),r.push(a)):i+=a}return""!==i&&r.push(i),r},ri.canBreakWords=function canBreakWords(t,r){return r},ri.canBreakChars=function canBreakChars(t,r,i,o,a){return!0},ri.wordWrapSplit=function wordWrapSplit(t){return t.split("")},ri.measureFont=function measureFont(t){if(ri._fonts[t])return ri._fonts[t];var r={},i=ri._canvas,o=ri._context;o.font=t;var a=ri.METRICS_STRING+ri.BASELINE_SYMBOL,l=Math.ceil(o.measureText(a).width),h=Math.ceil(o.measureText(ri.BASELINE_SYMBOL).width),g=2*h;h=h*ri.BASELINE_MULTIPLIER|0,i.width=l,i.height=g,o.fillStyle="#f00",o.fillRect(0,0,l,g),o.font=t,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(a,0,h);var y=o.getImageData(0,0,l,g).data,_=y.length,x=4*l,w=0,S=0,M=!1;for(w=0;w<h;++w){for(var T=0;T<x;T+=4)if(255!==y[S+T]){M=!0;break}if(M)break;S+=x}for(r.ascent=h-w,S=_-x,M=!1,w=g;w>h;--w){for(var P=0;P<x;P+=4)if(255!==y[S+P]){M=!0;break}if(M)break;S-=x}return r.descent=w-h,r.fontSize=r.ascent+r.descent,ri._fonts[t]=r,r},ri.clearMetrics=function clearMetrics(t){void 0===t&&(t=""),t?delete ri._fonts[t]:ri._fonts={}};var ii=function(){try{var t=new OffscreenCanvas(0,0),r=t.getContext("2d");return r&&r.measureText?t:document.createElement("canvas")}catch(i){return document.createElement("canvas")}}();ii.width=ii.height=10,ri._canvas=ii,ri._context=ii.getContext("2d"),ri._fonts={},ri.METRICS_STRING="|ÉqÅ",ri.BASELINE_SYMBOL="M",ri.BASELINE_MULTIPLIER=1.4,ri._newlines=[10,13],ri._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var oi={texture:!0,children:!1,baseTexture:!0},ai=function(t){function Text(r,i,o){(o=o||document.createElement("canvas")).width=3,o.height=3;var a=Et.from(o);a.orig=new Re,a.trim=new Re,t.call(this,a),this.canvas=o,this.context=this.canvas.getContext("2d"),this._resolution=Q.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=r,this.style=i,this.localStyleID=-1}t&&(Text.__proto__=t),Text.prototype=Object.create(t&&t.prototype),Text.prototype.constructor=Text;var r={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return Text.prototype.updateText=function updateText(t){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),this.dirty||!t){this._font=this._style.toFontString();var i,o,a=this.context,l=ri.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),h=l.width,g=l.height,y=l.lines,_=l.lineHeight,x=l.lineWidths,w=l.maxLineWidth,S=l.fontProperties;this.canvas.width=Math.ceil((Math.max(1,h)+2*r.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,g)+2*r.padding)*this._resolution),a.scale(this._resolution,this._resolution),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.font=this._font,a.lineWidth=r.strokeThickness,a.textBaseline=r.textBaseline,a.lineJoin=r.lineJoin,a.miterLimit=r.miterLimit;for(var M=r.dropShadow?2:1,T=0;T<M;++T){var P=r.dropShadow&&0===T,C=P?2*g:0,A=C*this.resolution;if(P){a.fillStyle="black",a.strokeStyle="black";var O=r.dropShadowColor,L=hex2rgb("number"==typeof O?O:string2hex(O));a.shadowColor="rgba("+255*L[0]+","+255*L[1]+","+255*L[2]+","+r.dropShadowAlpha+")",a.shadowBlur=r.dropShadowBlur,a.shadowOffsetX=Math.cos(r.dropShadowAngle)*r.dropShadowDistance,a.shadowOffsetY=Math.sin(r.dropShadowAngle)*r.dropShadowDistance+A}else a.fillStyle=this._generateFillStyle(r,y),a.strokeStyle=r.stroke,a.shadowColor=0,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0;for(var I=0;I<y.length;I++)i=r.strokeThickness/2,o=r.strokeThickness/2+I*_+S.ascent,"right"===r.align?i+=w-x[I]:"center"===r.align&&(i+=(w-x[I])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(y[I],i+r.padding,o+r.padding-C,!0),r.fill&&this.drawLetterSpacing(y[I],i+r.padding,o+r.padding-C)}this.updateTexture()}},Text.prototype.drawLetterSpacing=function drawLetterSpacing(t,r,i,o){void 0===o&&(o=!1);var a=this._style.letterSpacing;if(0!==a)for(var l=r,h=Array.from?Array.from(t):t.split(""),g=this.context.measureText(t).width,y=0,_=0;_<h.length;++_){var x=h[_];o?this.context.strokeText(x,l,i):this.context.fillText(x,l,i),l+=g-(y=this.context.measureText(t.substring(_+1)).width)+a,g=y}else o?this.context.strokeText(t,r,i):this.context.fillText(t,r,i)},Text.prototype.updateTexture=function updateTexture(){var t=this.canvas;if(this._style.trim){var r=trimCanvas(t);r.data&&(t.width=r.width,t.height=r.height,this.context.putImageData(r.data,0,0))}var i=this._texture,o=this._style,a=o.trim?0:o.padding,l=i.baseTexture;i.trim.width=i._frame.width=Math.ceil(t.width/this._resolution),i.trim.height=i._frame.height=Math.ceil(t.height/this._resolution),i.trim.x=-a,i.trim.y=-a,i.orig.width=i._frame.width-2*a,i.orig.height=i._frame.height-2*a,this._onTextureUpdate(),l.setRealSize(t.width,t.height,this._resolution),this.dirty=!1},Text.prototype._render=function _render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,r)},Text.prototype.getLocalBounds=function getLocalBounds(r){return this.updateText(!0),t.prototype.getLocalBounds.call(this,r)},Text.prototype._calculateBounds=function _calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},Text.prototype._onStyleChange=function _onStyleChange(){this.dirty=!0},Text.prototype._generateFillStyle=function _generateFillStyle(t,r){if(!Array.isArray(t.fill))return t.fill;if(1===t.fill.length)return t.fill[0];var i,o,a,l,h=t.dropShadow?t.dropShadowDistance:0,g=Math.ceil(this.canvas.width/this._resolution)-h,y=Math.ceil(this.canvas.height/this._resolution)-h,_=t.fill.slice(),x=t.fillGradientStops.slice();if(!x.length)for(var w=_.length+1,S=1;S<w;++S)x.push(S/w);if(_.unshift(t.fill[0]),x.unshift(0),_.push(t.fill[t.fill.length-1]),x.push(1),t.fillGradientType===Qr.LINEAR_VERTICAL){i=this.context.createLinearGradient(g/2,0,g/2,y),o=(_.length+1)*r.length,a=0;for(var M=0;M<r.length;M++){a+=1;for(var T=0;T<_.length;T++)l="number"==typeof x[T]?x[T]/r.length+M/r.length:a/o,i.addColorStop(l,_[T]),a++}}else{i=this.context.createLinearGradient(0,y/2,g,y/2),o=_.length+1,a=1;for(var P=0;P<_.length;P++)l="number"==typeof x[P]?x[P]:a/o,i.addColorStop(l,_[P]),a++}return i},Text.prototype.destroy=function destroy(r){"boolean"==typeof r&&(r={children:r}),r=Object.assign({},oi,r),t.prototype.destroy.call(this,r),this.context=null,this.canvas=null,this._style=null},r.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},r.width.set=function(t){this.updateText(!0);var r=sign(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},r.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},r.height.set=function(t){this.updateText(!0);var r=sign(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},r.style.get=function(){return this._style},r.style.set=function(t){t=t||{},this._style=t instanceof ti?t:new ti(t),this.localStyleID=-1,this.dirty=!0},r.text.get=function(){return this._text},r.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},r.resolution.get=function(){return this._resolution},r.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(Text.prototype,r),Text}(Zr);Q.UPLOADS_PER_FRAME=4;var si=function CountLimiter(t){this.maxItemsPerFrame=t,this.itemsLeft=0};si.prototype.beginFrame=function beginFrame(){this.itemsLeft=this.maxItemsPerFrame},si.prototype.allowedToUpload=function allowedToUpload(){return this.itemsLeft-- >0};var ci=function BasePrepare(t){var r=this;this.limiter=new si(Q.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){r.queue&&r.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)};function findMultipleBaseTextures(t,r){var i=!1;if(t&&t._textures&&t._textures.length)for(var o=0;o<t._textures.length;o++)if(t._textures[o]instanceof Et){var a=t._textures[o].baseTexture;-1===r.indexOf(a)&&(r.push(a),i=!0)}return i}function findBaseTexture(t,r){if(t.baseTexture instanceof ut){var i=t.baseTexture;return-1===r.indexOf(i)&&r.push(i),!0}return!1}function findTexture(t,r){if(t._texture&&t._texture instanceof Et){var i=t._texture.baseTexture;return-1===r.indexOf(i)&&r.push(i),!0}return!1}function drawText(t,r){return r instanceof ai&&(r.updateText(!0),!0)}function calculateTextStyle(t,r){if(r instanceof ti){var i=r.toFontString();return ri.measureFont(i),!0}return!1}function findText(t,r){if(t instanceof ai){-1===r.indexOf(t.style)&&r.push(t.style),-1===r.indexOf(t)&&r.push(t);var i=t._texture.baseTexture;return-1===r.indexOf(i)&&r.push(i),!0}return!1}function findTextStyle(t,r){return t instanceof ti&&(-1===r.indexOf(t)&&r.push(t),!0)}ci.prototype.upload=function upload(t,r){"function"==typeof t&&(r=t,t=null),t&&this.add(t),this.queue.length?(r&&this.completes.push(r),this.ticking||(this.ticking=!0,We.system.addOnce(this.tick,this,Ve.UTILITY))):r&&r()},ci.prototype.tick=function tick(){setTimeout(this.delayedTick,0)},ci.prototype.prepareItems=function prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],r=!1;if(t&&!t._destroyed)for(var i=0,o=this.uploadHooks.length;i<o;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),r=!0;break}r||this.queue.shift()}if(this.queue.length)We.system.addOnce(this.tick,this,Ve.UTILITY);else{this.ticking=!1;var a=this.completes.slice(0);this.completes.length=0;for(var l=0,h=a.length;l<h;l++)a[l]()}},ci.prototype.registerFindHook=function registerFindHook(t){return t&&this.addHooks.push(t),this},ci.prototype.registerUploadHook=function registerUploadHook(t){return t&&this.uploadHooks.push(t),this},ci.prototype.add=function add(t){for(var r=0,i=this.addHooks.length;r<i&&!this.addHooks[r](t,this.queue);r++);if(t instanceof Ge)for(var o=t.children.length-1;o>=0;o--)this.add(t.children[o]);return this},ci.prototype.destroy=function destroy(){this.ticking&&We.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var li=function(t){function Prepare(r){t.call(this,r),this.uploadHookHelper=this.renderer,this.registerFindHook(findGraphics),this.registerUploadHook(uploadBaseTextures),this.registerUploadHook(uploadGraphics)}return t&&(Prepare.__proto__=t),Prepare.prototype=Object.create(t&&t.prototype),Prepare.prototype.constructor=Prepare,Prepare}(ci);function uploadBaseTextures(t,r){return r instanceof ut&&(r._glTextures[t.CONTEXT_UID]||t.texture.bind(r),!0)}function uploadGraphics(t,r){if(!(r instanceof Xr))return!1;var i=r.geometry;r.finishPoly(),i.updateBatches();for(var o=i.batches,a=0;a<o.length;a++){var l=o[a].style.texture;l&&uploadBaseTextures(t,l.baseTexture)}return i.batchable||t.geometry.bind(i,r._resolveDirectShader()),!0}function findGraphics(t,r){return t instanceof Xr&&(r.push(t),!0)}var ui=function TimeLimiter(t){this.maxMilliseconds=t,this.frameStart=0};ui.prototype.beginFrame=function beginFrame(){this.frameStart=Date.now()},ui.prototype.allowedToUpload=function allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds};var di=function Spritesheet(t,r,i){void 0===i&&(i=null),this.baseTexture=t,this.textures={},this.animations={},this.data=r,this.resolution=this._updateResolution(i||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},hi={BATCH_SIZE:{configurable:!0}};hi.BATCH_SIZE.get=function(){return 1e3},di.prototype._updateResolution=function _updateResolution(t){var r=this.data.meta.scale,i=getResolutionOfUrl(t,null);return null===i&&(i=void 0!==r?parseFloat(r):1),1!==i&&this.baseTexture.setResolution(i),i},di.prototype.parse=function parse(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=di.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},di.prototype._processFrames=function _processFrames(t){for(var r=t,i=di.BATCH_SIZE;r-t<i&&r<this._frameKeys.length;){var o=this._frameKeys[r],a=this._frames[o],l=a.frame;if(l){var h=null,g=null,y=!1!==a.trimmed&&a.sourceSize?a.sourceSize:a.frame,_=new Re(0,0,Math.floor(y.w)/this.resolution,Math.floor(y.h)/this.resolution);h=a.rotated?new Re(Math.floor(l.x)/this.resolution,Math.floor(l.y)/this.resolution,Math.floor(l.h)/this.resolution,Math.floor(l.w)/this.resolution):new Re(Math.floor(l.x)/this.resolution,Math.floor(l.y)/this.resolution,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution),!1!==a.trimmed&&a.spriteSourceSize&&(g=new Re(Math.floor(a.spriteSourceSize.x)/this.resolution,Math.floor(a.spriteSourceSize.y)/this.resolution,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution)),this.textures[o]=new Et(this.baseTexture,h,_,g,a.rotated?2:0,a.anchor),Et.addToCache(this.textures[o],o)}r++}},di.prototype._processAnimations=function _processAnimations(){var t=this.data.animations||{};for(var r in t){this.animations[r]=[];for(var i=0;i<t[r].length;i++){var o=t[r][i];this.animations[r].push(this.textures[o])}}},di.prototype._parseComplete=function _parseComplete(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},di.prototype._nextBatch=function _nextBatch(){var t=this;this._processFrames(this._batchIndex*di.BATCH_SIZE),this._batchIndex++,setTimeout((function(){t._batchIndex*di.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())}),0)},di.prototype.destroy=function destroy(t){for(var r in void 0===t&&(t=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(di,hi);var pi=function SpritesheetLoader(){};pi.use=function use(t,r){var i=t.name+"_image";if(t.data&&t.type===wr.TYPE.JSON&&t.data.frames&&!this.resources[i]){var o={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},a=pi.getResourcePath(t,this.baseUrl);this.add(i,a,o,(function onImageLoad(i){if(i.error)r(i.error);else{var o=new di(i.texture.baseTexture,t.data,t.url);o.parse((function(){t.spritesheet=o,t.textures=o.textures,r()}))}}))}else r()},pi.getResourcePath=function getResourcePath(t,r){return t.isDataUrl?t.data.meta.image:ie.a.resolve(t.url.replace(r,""),t.data.meta.image)};var fi=new ye,mi=function(t){function TilingSprite(r,i,o){void 0===i&&(i=100),void 0===o&&(o=100),t.call(this,r),this.tileTransform=new Ie,this._width=i,this._height=o,this._canvasPattern=null,this.uvMatrix=r.uvMatrix||new bn(r),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}t&&(TilingSprite.__proto__=t),TilingSprite.prototype=Object.create(t&&t.prototype),TilingSprite.prototype.constructor=TilingSprite;var r={clampMargin:{configurable:!0},tileScale:{configurable:!0},tilePosition:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return r.clampMargin.get=function(){return this.uvMatrix.clampMargin},r.clampMargin.set=function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},r.tileScale.get=function(){return this.tileTransform.scale},r.tileScale.set=function(t){this.tileTransform.scale.copyFrom(t)},r.tilePosition.get=function(){return this.tileTransform.position},r.tilePosition.set=function(t){this.tileTransform.position.copyFrom(t)},TilingSprite.prototype._onTextureUpdate=function _onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},TilingSprite.prototype._render=function _render(t){var r=this._texture;r&&r.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},TilingSprite.prototype._calculateBounds=function _calculateBounds(){var t=this._width*-this._anchor._x,r=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),o=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,r,i,o)},TilingSprite.prototype.getLocalBounds=function getLocalBounds(r){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),r||(this._localBoundsRect||(this._localBoundsRect=new Re),r=this._localBoundsRect),this._bounds.getRectangle(r)):t.prototype.getLocalBounds.call(this,r)},TilingSprite.prototype.containsPoint=function containsPoint(t){this.worldTransform.applyInverse(t,fi);var r=this._width,i=this._height,o=-r*this.anchor._x;if(fi.x>=o&&fi.x<o+r){var a=-i*this.anchor._y;if(fi.y>=a&&fi.y<a+i)return!0}return!1},TilingSprite.prototype.destroy=function destroy(r){t.prototype.destroy.call(this,r),this.tileTransform=null,this.uvMatrix=null},TilingSprite.from=function from(t,r,i){return new TilingSprite(Et.from(t),r,i)},TilingSprite.fromFrame=function fromFrame(t,r,i){var o=he[t];if(!o)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new TilingSprite(o,r,i)},TilingSprite.fromImage=function fromImage(t,r,i,o){return o&&"object"!=typeof o&&(o={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),new TilingSprite(Et.from(t,o),r,i)},r.width.get=function(){return this._width},r.width.set=function(t){this._width=t},r.height.get=function(){return this._height},r.height.set=function(t){this._height=t},Object.defineProperties(TilingSprite.prototype,r),TilingSprite}(Zr),gi="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",vi=new Se,yi=function(t){function TilingSpriteRenderer(r){t.call(this,r);var i={globals:this.renderer.globalUniforms};this.shader=pn.from(gi,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",i),this.simpleShader=pn.from(gi,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",i),this.quad=new Dt,this.state=mn.for2d()}return t&&(TilingSpriteRenderer.__proto__=t),TilingSpriteRenderer.prototype=Object.create(t&&t.prototype),TilingSpriteRenderer.prototype.constructor=TilingSpriteRenderer,TilingSpriteRenderer.prototype.render=function render(t){var r=this.renderer,i=this.quad,o=i.vertices;o[0]=o[6]=t._width*-t.anchor.x,o[1]=o[3]=t._height*-t.anchor.y,o[2]=o[4]=t._width*(1-t.anchor.x),o[5]=o[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((o=i.uvs)[0]=o[6]=-t.anchor.x,o[1]=o[3]=-t.anchor.y,o[2]=o[4]=1-t.anchor.x,o[5]=o[7]=1-t.anchor.y),i.invalidate();var a=t._texture,l=a.baseTexture,h=t.tileTransform.localTransform,g=t.uvMatrix,y=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;y&&(l._glTextures[r.CONTEXT_UID]?y=l.wrapMode!==q.CLAMP:l.wrapMode===q.CLAMP&&(l.wrapMode=q.REPEAT));var _=y?this.simpleShader:this.shader,x=a.width,w=a.height,S=t._width,M=t._height;vi.set(h.a*x/S,h.b*x/M,h.c*w/S,h.d*w/M,h.tx/S,h.ty/M),vi.invert(),y?vi.prepend(g.mapCoord):(_.uniforms.uMapCoord=g.mapCoord.toArray(!0),_.uniforms.uClampFrame=g.uClampFrame,_.uniforms.uClampOffset=g.uClampOffset),_.uniforms.uTransform=vi.toArray(!0),_.uniforms.uColor=premultiplyTintToRgba(t.tint,t.worldAlpha,_.uniforms.uColor,l.alphaMode),_.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),_.uniforms.uSampler=a,r.shader.bind(_),r.geometry.bind(i),this.state.blendMode=correctBlendMode(t.blendMode,l.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},TilingSpriteRenderer}(Vt),bi=function(t){function BitmapText(r,i){var o=this;void 0===i&&(i={}),t.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==i.tint?i.tint:16777215,align:i.align||"left",name:null,size:0},this.font=i.font,this._text=r,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new be((function(){o.dirty=!0}),this,0,0),this.dirty=!1,this.roundPixels=Q.ROUND_PIXELS,this.updateText()}t&&(BitmapText.__proto__=t),BitmapText.prototype=Object.create(t&&t.prototype),BitmapText.prototype.constructor=BitmapText;var r={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return BitmapText.prototype.updateText=function updateText(){for(var t=BitmapText.fonts[this._font.name],r=this._font.size/t.size,i=new ye,o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",h=l.length,g=this._maxWidth*t.size/this._font.size,y=null,_=0,x=0,w=0,S=-1,M=0,T=0,P=0,C=0;C<h;C++){var A=l.charCodeAt(C),O=l.charAt(C);if(/(?:\s)/.test(O)&&(S=C,M=_),"\r"!==O&&"\n"!==O){var L=t.chars[A];L&&(y&&L.kerning[y]&&(i.x+=L.kerning[y]),o.push({texture:L.texture,line:w,charCode:A,position:new ye(i.x+L.xOffset+this._letterSpacing/2,i.y+L.yOffset)}),i.x+=L.xAdvance+this._letterSpacing,_=i.x,P=Math.max(P,L.yOffset+L.texture.height),y=A,-1!==S&&g>0&&i.x>g&&(removeItems(o,1+S-++T,1+C-S),C=S,S=-1,a.push(M),x=Math.max(x,M),w++,i.x=0,i.y+=t.lineHeight,y=null))}else a.push(_),x=Math.max(x,_),++w,++T,i.x=0,i.y+=t.lineHeight,y=null}var I=l.charAt(l.length-1);"\r"!==I&&"\n"!==I&&(/(?:\s)/.test(I)&&(_=M),a.push(_),x=Math.max(x,_));for(var R=[],j=0;j<=w;j++){var N=0;"right"===this._font.align?N=x-a[j]:"center"===this._font.align&&(N=(x-a[j])/2),R.push(N)}for(var k=o.length,D=this.tint,B=0;B<k;B++){var G=this._glyphs[B];G?G.texture=o[B].texture:((G=new Zr(o[B].texture)).roundPixels=this.roundPixels,this._glyphs.push(G)),G.position.x=(o[B].position.x+R[o[B].line])*r,G.position.y=o[B].position.y*r,G.scale.x=G.scale.y=r,G.tint=D,G.parent||this.addChild(G)}for(var H=k;H<this._glyphs.length;++H)this.removeChild(this._glyphs[H]);if(this._textWidth=x*r,this._textHeight=(i.y+t.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var V=0;V<k;V++)this._glyphs[V].x-=this._textWidth*this.anchor.x,this._glyphs[V].y-=this._textHeight*this.anchor.y;this._maxLineHeight=P*r},BitmapText.prototype.updateTransform=function updateTransform(){this.validate(),this.containerUpdateTransform()},BitmapText.prototype.getLocalBounds=function getLocalBounds(){return this.validate(),t.prototype.getLocalBounds.call(this)},BitmapText.prototype.validate=function validate(){this.dirty&&(this.updateText(),this.dirty=!1)},r.tint.get=function(){return this._font.tint},r.tint.set=function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0},r.align.get=function(){return this._font.align},r.align.set=function(t){this._font.align=t||"left",this.dirty=!0},r.anchor.get=function(){return this._anchor},r.anchor.set=function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},r.font.get=function(){return this._font},r.font.set=function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):BitmapText.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)},r.text.get=function(){return this._text},r.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},r.maxWidth.get=function(){return this._maxWidth},r.maxWidth.set=function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},r.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},r.textWidth.get=function(){return this.validate(),this._textWidth},r.letterSpacing.get=function(){return this._letterSpacing},r.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},r.textHeight.get=function(){return this.validate(),this._textHeight},BitmapText.registerFont=function registerFont(t,r){var i={},o=t.getElementsByTagName("info")[0],a=t.getElementsByTagName("common")[0],l=t.getElementsByTagName("page"),h=getResolutionOfUrl(l[0].getAttribute("file"),Q.RESOLUTION),g={};i.font=o.getAttribute("face"),i.size=parseInt(o.getAttribute("size"),10),i.lineHeight=parseInt(a.getAttribute("lineHeight"),10)/h,i.chars={},r instanceof Et&&(r=[r]);for(var y=0;y<l.length;y++){var _=l[y].getAttribute("id"),x=l[y].getAttribute("file");g[_]=r instanceof Array?r[y]:r[x]}for(var w=t.getElementsByTagName("char"),S=0;S<w.length;S++){var M=w[S],T=parseInt(M.getAttribute("id"),10),P=M.getAttribute("page")||0,C=new Re(parseInt(M.getAttribute("x"),10)/h+g[P].frame.x/h,parseInt(M.getAttribute("y"),10)/h+g[P].frame.y/h,parseInt(M.getAttribute("width"),10)/h,parseInt(M.getAttribute("height"),10)/h);i.chars[T]={xOffset:parseInt(M.getAttribute("xoffset"),10)/h,yOffset:parseInt(M.getAttribute("yoffset"),10)/h,xAdvance:parseInt(M.getAttribute("xadvance"),10)/h,kerning:{},texture:new Et(g[P].baseTexture,C),page:P}}for(var A=t.getElementsByTagName("kerning"),O=0;O<A.length;O++){var L=A[O],I=parseInt(L.getAttribute("first"),10)/h,R=parseInt(L.getAttribute("second"),10)/h,j=parseInt(L.getAttribute("amount"),10)/h;i.chars[R]&&(i.chars[R].kerning[I]=j)}return BitmapText.fonts[i.font]=i,i},Object.defineProperties(BitmapText.prototype,r),BitmapText}(Ge);bi.fonts={};var _i=function BitmapFontLoader(){};_i.parse=function parse(t,r){t.bitmapFont=bi.registerFont(t.data,r)},_i.add=function add(){wr.setExtensionXhrType("fnt",wr.XHR_RESPONSE_TYPE.DOCUMENT)},_i.dirname=function dirname(t){var r=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return r===t?".":""===r?"/":r},_i.use=function use(t,r){if(t.data&&t.type===wr.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var i=t.isDataUrl?"":_i.dirname(t.url);t.isDataUrl&&("."===i&&(i=""),this.baseUrl&&i&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(i+="/")),(i=i.replace(this.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/");for(var o=t.data.getElementsByTagName("page"),a={},completed=function(i){a[i.metadata.pageFile]=i.texture,Object.keys(a).length===o.length&&(_i.parse(t,a),r())},l=0;l<o.length;++l){var h=o[l].getAttribute("file"),g=i+h,y=!1;for(var _ in this.resources){var x=this.resources[_];if(x.url===g){x.metadata.pageFile=h,x.texture?completed(x):x.onAfterMiddleware.add(completed),y=!0;break}}if(!y){var w={crossOrigin:t.crossOrigin,loadType:wr.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:h},t.metadata.imageMetadata),parentResource:t};this.add(g,w,completed)}}}else r();else r()};var xi=function(t){function AlphaFilter(r){void 0===r&&(r=1),t.call(this,Hn,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=r}t&&(AlphaFilter.__proto__=t),AlphaFilter.prototype=Object.create(t&&t.prototype),AlphaFilter.prototype.constructor=AlphaFilter;var r={alpha:{configurable:!0}};return r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(AlphaFilter.prototype,r),AlphaFilter}(vn);var wi={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Si=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var Mi=function(t){function BlurFilterPass(r,i,o,a,l){var h=function generateBlurVertSource(t,r){var i,o=Math.ceil(t/2),a="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",l="";i=r?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var h=0;h<t;h++){var g=i.replace("%index%",h);l+=g=g.replace("%sampleIndex%",h-(o-1)+".0"),l+="\n"}return(a=a.replace("%blur%",l)).replace("%size%",t)}(l=l||5,r),g=function generateBlurFragSource(t){for(var r,i=wi[t],o=i.length,a=Si,l="",h=0;h<t;h++){var g="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",h);r=h,h>=o&&(r=t-h-1),l+=g=g.replace("%value%",i[r]),l+="\n"}return(a=a.replace("%blur%",l)).replace("%size%",t)}(l);t.call(this,h,g),this.horizontal=r,this.resolution=a||Q.RESOLUTION,this._quality=0,this.quality=o||4,this.blur=i||8}t&&(BlurFilterPass.__proto__=t),BlurFilterPass.prototype=Object.create(t&&t.prototype),BlurFilterPass.prototype.constructor=BlurFilterPass;var r={blur:{configurable:!0},quality:{configurable:!0}};return BlurFilterPass.prototype.apply=function apply(t,r,i,o){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/r.width):this.uniforms.strength=1/i.height*(i.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,r,i,o);else{var a=t.getFilterTexture(),l=t.renderer,h=r,g=a;this.state.blend=!1,t.applyFilter(this,h,g,!0);for(var y=1;y<this.passes-1;y++){l.renderTexture.bind(h,h.filterFrame),this.uniforms.uSampler=g;var _=g;g=h,h=_,l.shader.bind(this),l.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,g,i,o),t.returnFilterTexture(a)}},r.blur.get=function(){return this.strength},r.blur.set=function(t){this.padding=1+2*Math.abs(t),this.strength=t},r.quality.get=function(){return this._quality},r.quality.set=function(t){this._quality=t,this.passes=t},Object.defineProperties(BlurFilterPass.prototype,r),BlurFilterPass}(vn),Ei=function(t){function BlurFilter(r,i,o,a){t.call(this),this.blurXFilter=new Mi(!0,r,i,o,a),this.blurYFilter=new Mi(!1,r,i,o,a),this.resolution=o||Q.RESOLUTION,this.quality=i||4,this.blur=r||8,this.repeatEdgePixels=!1}t&&(BlurFilter.__proto__=t),BlurFilter.prototype=Object.create(t&&t.prototype),BlurFilter.prototype.constructor=BlurFilter;var r={blur:{configurable:!0},quality:{configurable:!0},blurX:{configurable:!0},blurY:{configurable:!0},blendMode:{configurable:!0},repeatEdgePixels:{configurable:!0}};return BlurFilter.prototype.apply=function apply(t,r,i,o){var a=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(a&&l){var h=t.getFilterTexture();this.blurXFilter.apply(t,r,h,!0),this.blurYFilter.apply(t,h,i,o),t.returnFilterTexture(h)}else l?this.blurYFilter.apply(t,r,i,o):this.blurXFilter.apply(t,r,i,o)},BlurFilter.prototype.updatePadding=function updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},r.blur.get=function(){return this.blurXFilter.blur},r.blur.set=function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},r.quality.get=function(){return this.blurXFilter.quality},r.quality.set=function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},r.blurX.get=function(){return this.blurXFilter.blur},r.blurX.set=function(t){this.blurXFilter.blur=t,this.updatePadding()},r.blurY.get=function(){return this.blurYFilter.blur},r.blurY.set=function(t){this.blurYFilter.blur=t,this.updatePadding()},r.blendMode.get=function(){return this.blurYFilter.blendMode},r.blendMode.set=function(t){this.blurYFilter.blendMode=t},r.repeatEdgePixels.get=function(){return this._repeatEdgePixels},r.repeatEdgePixels.set=function(t){this._repeatEdgePixels=t,this.updatePadding()},Object.defineProperties(BlurFilter.prototype,r),BlurFilter}(vn),Ti=function(t){function ColorMatrixFilter(){var r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};t.call(this,Vn,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",r),this.alpha=1}t&&(ColorMatrixFilter.__proto__=t),ColorMatrixFilter.prototype=Object.create(t&&t.prototype),ColorMatrixFilter.prototype.constructor=ColorMatrixFilter;var r={matrix:{configurable:!0},alpha:{configurable:!0}};return ColorMatrixFilter.prototype._loadMatrix=function _loadMatrix(t,r){void 0===r&&(r=!1);var i=t;r&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i},ColorMatrixFilter.prototype._multiply=function _multiply(t,r,i){return t[0]=r[0]*i[0]+r[1]*i[5]+r[2]*i[10]+r[3]*i[15],t[1]=r[0]*i[1]+r[1]*i[6]+r[2]*i[11]+r[3]*i[16],t[2]=r[0]*i[2]+r[1]*i[7]+r[2]*i[12]+r[3]*i[17],t[3]=r[0]*i[3]+r[1]*i[8]+r[2]*i[13]+r[3]*i[18],t[4]=r[0]*i[4]+r[1]*i[9]+r[2]*i[14]+r[3]*i[19]+r[4],t[5]=r[5]*i[0]+r[6]*i[5]+r[7]*i[10]+r[8]*i[15],t[6]=r[5]*i[1]+r[6]*i[6]+r[7]*i[11]+r[8]*i[16],t[7]=r[5]*i[2]+r[6]*i[7]+r[7]*i[12]+r[8]*i[17],t[8]=r[5]*i[3]+r[6]*i[8]+r[7]*i[13]+r[8]*i[18],t[9]=r[5]*i[4]+r[6]*i[9]+r[7]*i[14]+r[8]*i[19]+r[9],t[10]=r[10]*i[0]+r[11]*i[5]+r[12]*i[10]+r[13]*i[15],t[11]=r[10]*i[1]+r[11]*i[6]+r[12]*i[11]+r[13]*i[16],t[12]=r[10]*i[2]+r[11]*i[7]+r[12]*i[12]+r[13]*i[17],t[13]=r[10]*i[3]+r[11]*i[8]+r[12]*i[13]+r[13]*i[18],t[14]=r[10]*i[4]+r[11]*i[9]+r[12]*i[14]+r[13]*i[19]+r[14],t[15]=r[15]*i[0]+r[16]*i[5]+r[17]*i[10]+r[18]*i[15],t[16]=r[15]*i[1]+r[16]*i[6]+r[17]*i[11]+r[18]*i[16],t[17]=r[15]*i[2]+r[16]*i[7]+r[17]*i[12]+r[18]*i[17],t[18]=r[15]*i[3]+r[16]*i[8]+r[17]*i[13]+r[18]*i[18],t[19]=r[15]*i[4]+r[16]*i[9]+r[17]*i[14]+r[18]*i[19]+r[19],t},ColorMatrixFilter.prototype._colorMatrix=function _colorMatrix(t){var r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},ColorMatrixFilter.prototype.brightness=function brightness(t,r){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)},ColorMatrixFilter.prototype.greyscale=function greyscale(t,r){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,r)},ColorMatrixFilter.prototype.blackAndWhite=function blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.hue=function hue(t,r){t=(t||0)/180*Math.PI;var i=Math.cos(t),o=Math.sin(t),a=1/3,l=(0,Math.sqrt)(a),h=[i+(1-i)*a,a*(1-i)-l*o,a*(1-i)+l*o,0,0,a*(1-i)+l*o,i+a*(1-i),a*(1-i)-l*o,0,0,a*(1-i)-l*o,a*(1-i)+l*o,i+a*(1-i),0,0,0,0,0,1,0];this._loadMatrix(h,r)},ColorMatrixFilter.prototype.contrast=function contrast(t,r){var i=(t||0)+1,o=-.5*(i-1),a=[i,0,0,0,o,0,i,0,0,o,0,0,i,0,o,0,0,0,1,0];this._loadMatrix(a,r)},ColorMatrixFilter.prototype.saturate=function saturate(t,r){void 0===t&&(t=0);var i=2*t/3+1,o=-.5*(i-1),a=[i,o,o,0,0,o,i,o,0,0,o,o,i,0,0,0,0,0,1,0];this._loadMatrix(a,r)},ColorMatrixFilter.prototype.desaturate=function desaturate(){this.saturate(-1)},ColorMatrixFilter.prototype.negative=function negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.sepia=function sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.technicolor=function technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},ColorMatrixFilter.prototype.polaroid=function polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.toBGR=function toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.kodachrome=function kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},ColorMatrixFilter.prototype.browni=function browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},ColorMatrixFilter.prototype.vintage=function vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},ColorMatrixFilter.prototype.colorTone=function colorTone(t,r,i,o,a){var l=((i=i||16770432)>>16&255)/255,h=(i>>8&255)/255,g=(255&i)/255,y=((o=o||3375104)>>16&255)/255,_=(o>>8&255)/255,x=(255&o)/255,w=[.3,.59,.11,0,0,l,h,g,t=t||.2,0,y,_,x,r=r||.15,0,l-y,h-_,g-x,0,0];this._loadMatrix(w,a)},ColorMatrixFilter.prototype.night=function night(t,r){var i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,r)},ColorMatrixFilter.prototype.predator=function predator(t,r){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,r)},ColorMatrixFilter.prototype.lsd=function lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},ColorMatrixFilter.prototype.reset=function reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},r.matrix.get=function(){return this.uniforms.m},r.matrix.set=function(t){this.uniforms.m=t},r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(ColorMatrixFilter.prototype,r),ColorMatrixFilter}(vn);Ti.prototype.grayscale=Ti.prototype.greyscale;var Pi=function(t){function DisplacementFilter(r,i){var o=new Se;r.renderable=!1,t.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:r._texture,filterMatrix:o,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=r,this.maskMatrix=o,null==i&&(i=20),this.scale=new ye(i,i)}t&&(DisplacementFilter.__proto__=t),DisplacementFilter.prototype=Object.create(t&&t.prototype),DisplacementFilter.prototype.constructor=DisplacementFilter;var r={map:{configurable:!0}};return DisplacementFilter.prototype.apply=function apply(t,r,i,o){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var a=this.maskSprite.transform.worldTransform,l=Math.sqrt(a.a*a.a+a.b*a.b),h=Math.sqrt(a.c*a.c+a.d*a.d);0!==l&&0!==h&&(this.uniforms.rotation[0]=a.a/l,this.uniforms.rotation[1]=a.b/l,this.uniforms.rotation[2]=a.c/h,this.uniforms.rotation[3]=a.d/h),t.applyFilter(this,r,i,o)},r.map.get=function(){return this.uniforms.mapSampler},r.map.set=function(t){this.uniforms.mapSampler=t},Object.defineProperties(DisplacementFilter.prototype,r),DisplacementFilter}(vn),Ci=function(t){function FXAAFilter(){t.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}return t&&(FXAAFilter.__proto__=t),FXAAFilter.prototype=Object.create(t&&t.prototype),FXAAFilter.prototype.constructor=FXAAFilter,FXAAFilter}(vn),Ai=function(t){function NoiseFilter(r,i){void 0===r&&(r=.5),void 0===i&&(i=Math.random()),t.call(this,Vn,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=r,this.seed=i}t&&(NoiseFilter.__proto__=t),NoiseFilter.prototype=Object.create(t&&t.prototype),NoiseFilter.prototype.constructor=NoiseFilter;var r={noise:{configurable:!0},seed:{configurable:!0}};return r.noise.get=function(){return this.uniforms.uNoise},r.noise.set=function(t){this.uniforms.uNoise=t},r.seed.get=function(){return this.uniforms.uSeed},r.seed.set=function(t){this.uniforms.uSeed=t},Object.defineProperties(NoiseFilter.prototype,r),NoiseFilter}(vn),Oi=new Se;Fe.prototype._cacheAsBitmap=!1,Fe.prototype._cacheData=!1;var Li=function CacheData(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(Fe.prototype,{cacheAsBitmap:{get:function get(){return this._cacheAsBitmap},set:function set(t){var r;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Li),(r=this._cacheData).originalRender=this.render,r.originalRenderCanvas=this.renderCanvas,r.originalUpdateTransform=this.updateTransform,r.originalCalculateBounds=this.calculateBounds,r.originalGetLocalBounds=this.getLocalBounds,r.originalDestroy=this.destroy,r.originalContainsPoint=this.containsPoint,r.originalMask=this._mask,r.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((r=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=r.originalRender,this.renderCanvas=r.originalRenderCanvas,this.calculateBounds=r.originalCalculateBounds,this.getLocalBounds=r.originalGetLocalBounds,this.destroy=r.originalDestroy,this.updateTransform=r.originalUpdateTransform,this.containsPoint=r.originalContainsPoint,this._mask=r.originalMask,this.filterArea=r.originalFilterArea))}}}),Fe.prototype._renderCached=function _renderCached(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Fe.prototype._initCachedDisplayObject=function _initCachedDisplayObject(t){if(!this._cacheData||!this._cacheData.sprite){var r=this.alpha;this.alpha=1,t.batch.flush();var i=this.getLocalBounds().clone();if(this.filters){var o=this.filters[0].padding;i.pad(o)}i.ceil(Q.RESOLUTION);var a=t.renderTexture.current,l=t.renderTexture.sourceFrame,h=t.projection.transform,g=Tt.create(i.width,i.height),y="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=y,ut.addToCache(g.baseTexture,y),Et.addToCache(g,y);var _=Oi;_.tx=-i.x,_.ty=-i.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,t.render(this,g,!0,_,!0),t.projection.transform=h,t.renderTexture.bind(a,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var x=new Zr(g);x.transform.worldTransform=this.transform.worldTransform,x.anchor.x=-i.x/i.width,x.anchor.y=-i.y/i.height,x.alpha=r,x._bounds=this._bounds,this._cacheData.sprite=x,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=x.containsPoint.bind(x)}},Fe.prototype._renderCachedCanvas=function _renderCachedCanvas(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Fe.prototype._initCachedDisplayObjectCanvas=function _initCachedDisplayObjectCanvas(t){if(!this._cacheData||!this._cacheData.sprite){var r=this.getLocalBounds(),i=this.alpha;this.alpha=1;var o=t.context;r.ceil(Q.RESOLUTION);var a=Tt.create(r.width,r.height),l="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=l,ut.addToCache(a.baseTexture,l),Et.addToCache(a,l);var h=Oi;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=r.x,h.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,a,!0,h,!1),t.context=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var g=new Zr(a);g.transform.worldTransform=this.transform.worldTransform,g.anchor.x=-r.x/r.width,g.anchor.y=-r.y/r.height,g.alpha=i,g._bounds=this._bounds,this._cacheData.sprite=g,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=g.containsPoint.bind(g)}},Fe.prototype._calculateCachedBounds=function _calculateCachedBounds(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},Fe.prototype._getCachedLocalBounds=function _getCachedLocalBounds(){return this._cacheData.sprite.getLocalBounds()},Fe.prototype._destroyCachedDisplayObject=function _destroyCachedDisplayObject(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ut.removeFromCache(this._cacheData.textureCacheId),Et.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Fe.prototype._cacheAsBitmapDestroy=function _cacheAsBitmapDestroy(t){this.cacheAsBitmap=!1,this.destroy(t)},Fe.prototype.name=null,Ge.prototype.getChildByName=function getChildByName(t){for(var r=0;r<this.children.length;r++)if(this.children[r].name===t)return this.children[r];return null},Fe.prototype.getGlobalPosition=function getGlobalPosition(t,r){return void 0===t&&(t=new ye),void 0===r&&(r=!1),this.parent?this.parent.toGlobal(this.position,t,r):(t.x=this.position.x,t.y=this.position.y),t};var Ii=function MeshBatchUvs(t,r){this.uvBuffer=t,this.uvMatrix=r,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};Ii.prototype.update=function update(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var r=this.uvBuffer.data;this.data&&this.data.length===r.length||(this.data=new Float32Array(r.length)),this.uvMatrix.multiplyUvs(r,this.data),this._updateID++}};var Ri=new ye,ji=new ke,Ni=function(t){function Mesh(r,i,o,a){void 0===a&&(a=H.TRIANGLES),t.call(this),this.geometry=r,r.refCount++,this.shader=i,this.state=o||mn.for2d(),this.drawMode=a,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=G.NORMAL,this._roundPixels=Q.ROUND_PIXELS,this.batchUvs=null}t&&(Mesh.__proto__=t),Mesh.prototype=Object.create(t&&t.prototype),Mesh.prototype.constructor=Mesh;var r={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return r.uvBuffer.get=function(){return this.geometry.buffers[1]},r.verticesBuffer.get=function(){return this.geometry.buffers[0]},r.material.set=function(t){this.shader=t},r.material.get=function(){return this.shader},r.blendMode.set=function(t){this.state.blendMode=t},r.blendMode.get=function(){return this.state.blendMode},r.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},r.roundPixels.get=function(){return this._roundPixels},r.tint.get=function(){return this.shader.tint},r.tint.set=function(t){this.shader.tint=t},r.texture.get=function(){return this.shader.texture},r.texture.set=function(t){this.shader.texture=t},Mesh.prototype._render=function _render(t){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===H.TRIANGLES&&r.length<2*Mesh.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},Mesh.prototype._renderDefault=function _renderDefault(t){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),t.batch.flush(),r.program.uniformData.translationMatrix&&(r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(r),t.state.set(this.state),t.geometry.bind(this.geometry,r),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},Mesh.prototype._renderToBatch=function _renderToBatch(t){var r=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)},Mesh.prototype.calculateVertices=function calculateVertices(){var t=this.geometry,r=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));for(var i=this.transform.worldTransform,o=i.a,a=i.b,l=i.c,h=i.d,g=i.tx,y=i.ty,_=this.vertexData,x=0;x<_.length/2;x++){var w=r[2*x],S=r[2*x+1];_[2*x]=o*w+l*S+g,_[2*x+1]=a*w+h*S+y}if(this._roundPixels)for(var M=Q.RESOLUTION,T=0;T<_.length;++T)_[T]=Math.round((_[T]*M|0)/M);this.vertexDirty=t.vertexDirtyId}},Mesh.prototype.calculateUvs=function calculateUvs(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new Ii(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},Mesh.prototype._calculateBounds=function _calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},Mesh.prototype.containsPoint=function containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Ri);for(var r=this.geometry.getBuffer("aVertexPosition").data,i=ji.points,o=this.geometry.getIndex().data,a=o.length,l=4===this.drawMode?3:1,h=0;h+2<a;h+=l){var g=2*o[h],y=2*o[h+1],_=2*o[h+2];if(i[0]=r[g],i[1]=r[g+1],i[2]=r[y],i[3]=r[y+1],i[4]=r[_],i[5]=r[_+1],ji.contains(Ri.x,Ri.y))return!0}return!1},Mesh.prototype.destroy=function destroy(r){t.prototype.destroy.call(this,r),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(Mesh.prototype,r),Mesh}(Ge);Ni.BATCHABLE_SIZE=100;var ki=function(t){function MeshMaterial(r,i){var o={uSampler:r,alpha:1,uTextureMatrix:Se.IDENTITY,uColor:new Float32Array([1,1,1,1])};(i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i)).uniforms&&Object.assign(o,i.uniforms),t.call(this,i.program||dn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),o),this._colorDirty=!1,this.uvMatrix=new bn(r),this.batchable=void 0===i.program,this.pluginName=i.pluginName,this.tint=i.tint,this.alpha=i.alpha}t&&(MeshMaterial.__proto__=t),MeshMaterial.prototype=Object.create(t&&t.prototype),MeshMaterial.prototype.constructor=MeshMaterial;var r={texture:{configurable:!0},alpha:{configurable:!0},tint:{configurable:!0}};return r.texture.get=function(){return this.uniforms.uSampler},r.texture.set=function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},r.alpha.set=function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},r.alpha.get=function(){return this._alpha},r.tint.set=function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)},r.tint.get=function(){return this._tint},MeshMaterial.prototype.update=function update(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},Object.defineProperties(MeshMaterial.prototype,r),MeshMaterial}(pn),Di=function(t){function MeshGeometry(r,i,o){t.call(this);var a=new Ot(r),l=new Ot(i,!0),h=new Ot(o,!0,!0);this.addAttribute("aVertexPosition",a,2,!1,z.FLOAT).addAttribute("aTextureCoord",l,2,!1,z.FLOAT).addIndex(h),this._updateId=-1}t&&(MeshGeometry.__proto__=t),MeshGeometry.prototype=Object.create(t&&t.prototype),MeshGeometry.prototype.constructor=MeshGeometry;var r={vertexDirtyId:{configurable:!0}};return r.vertexDirtyId.get=function(){return this.buffers[0]._updateID},Object.defineProperties(MeshGeometry.prototype,r),MeshGeometry}(Nt),Bi=function(t){function PlaneGeometry(r,i,o,a){void 0===r&&(r=100),void 0===i&&(i=100),void 0===o&&(o=10),void 0===a&&(a=10),t.call(this),this.segWidth=o,this.segHeight=a,this.width=r,this.height=i,this.build()}return t&&(PlaneGeometry.__proto__=t),PlaneGeometry.prototype=Object.create(t&&t.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneGeometry.prototype.build=function build(){for(var t=this.segWidth*this.segHeight,r=[],i=[],o=[],a=this.segWidth-1,l=this.segHeight-1,h=this.width/a,g=this.height/l,y=0;y<t;y++){var _=y%this.segWidth,x=y/this.segWidth|0;r.push(_*h,x*g),i.push(_/a,x/l)}for(var w=a*l,S=0;S<w;S++){var M=S%a,T=S/a|0,P=T*this.segWidth+M,C=T*this.segWidth+M+1,A=(T+1)*this.segWidth+M,O=(T+1)*this.segWidth+M+1;o.push(P,C,A,C,O,A)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(o),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},PlaneGeometry}(Di),Fi=function(t){function RopeGeometry(r,i,o){void 0===r&&(r=200),void 0===o&&(o=0),t.call(this,new Float32Array(4*i.length),new Float32Array(4*i.length),new Uint16Array(6*(i.length-1))),this.points=i,this.width=r,this.textureScale=o,this.build()}return t&&(RopeGeometry.__proto__=t),RopeGeometry.prototype=Object.create(t&&t.prototype),RopeGeometry.prototype.constructor=RopeGeometry,RopeGeometry.prototype.build=function build(){var t=this.points;if(t){var r=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),o=this.getIndex();if(!(t.length<1)){r.data.length/4!==t.length&&(r.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),o.data=new Uint16Array(6*(t.length-1)));var a=i.data,l=o.data;a[0]=0,a[1]=0,a[2]=0,a[3]=1;for(var h=0,g=t[0],y=this.width*this.textureScale,_=t.length,x=0;x<_;x++){var w=4*x;if(this.textureScale>0){var S=g.x-t[x].x,M=g.y-t[x].y,T=Math.sqrt(S*S+M*M);g=t[x],h+=T/y}else h=x/(_-1);a[w]=h,a[w+1]=0,a[w+2]=h,a[w+3]=1}for(var P=0,C=0;C<_-1;C++){var A=2*C;l[P++]=A,l[P++]=A+1,l[P++]=A+2,l[P++]=A+2,l[P++]=A+1,l[P++]=A+3}i.update(),o.update(),this.updateVertices()}}},RopeGeometry.prototype.updateVertices=function updateVertices(){var t=this.points;if(!(t.length<1)){for(var r,i=t[0],o=0,a=0,l=this.buffers[0].data,h=t.length,g=0;g<h;g++){var y=t[g],_=4*g;a=-((r=g<t.length-1?t[g+1]:y).x-i.x),o=r.y-i.y;var x=Math.sqrt(o*o+a*a),w=this.textureScale>0?this.textureScale*this.width/2:this.width/2;o/=x,a/=x,o*=w,a*=w,l[_]=y.x+o,l[_+1]=y.y+a,l[_+2]=y.x-o,l[_+3]=y.y-a,i=y}this.buffers[0].update()}},RopeGeometry.prototype.update=function update(){this.textureScale>0?this.build():this.updateVertices()},RopeGeometry}(Di),Gi=function(t){function SimpleRope(r,i,o){void 0===o&&(o=0);var a=new Fi(r.height,i,o),l=new ki(r);o>0&&(r.baseTexture.wrapMode=q.REPEAT),t.call(this,a,l),this.autoUpdate=!0}return t&&(SimpleRope.__proto__=t),SimpleRope.prototype=Object.create(t&&t.prototype),SimpleRope.prototype.constructor=SimpleRope,SimpleRope.prototype._render=function _render(r){(this.autoUpdate||this.geometry.width!==this.shader.texture.height)&&(this.geometry.width=this.shader.texture.height,this.geometry.update()),t.prototype._render.call(this,r)},SimpleRope}(Ni),Hi=function(t){function SimplePlane(r,i,o){var a=new Bi(r.width,r.height,i,o),l=new ki(Et.WHITE);t.call(this,a,l),this.texture=r}t&&(SimplePlane.__proto__=t),SimplePlane.prototype=Object.create(t&&t.prototype),SimplePlane.prototype.constructor=SimplePlane;var r={texture:{configurable:!0}};return SimplePlane.prototype.textureUpdated=function textureUpdated(){this._textureID=this.shader.texture._updateID,this.geometry.width=this.shader.texture.width,this.geometry.height=this.shader.texture.height,this.geometry.build()},r.texture.set=function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},r.texture.get=function(){return this.shader.texture},SimplePlane.prototype._render=function _render(r){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),t.prototype._render.call(this,r)},Object.defineProperties(SimplePlane.prototype,r),SimplePlane}(Ni),Vi=function(t){function SimpleMesh(r,i,o,a,l){void 0===r&&(r=Et.EMPTY);var h=new Di(i,o,a);h.getBuffer("aVertexPosition").static=!1;var g=new ki(r);t.call(this,h,g,null,l),this.autoUpdate=!0}t&&(SimpleMesh.__proto__=t),SimpleMesh.prototype=Object.create(t&&t.prototype),SimpleMesh.prototype.constructor=SimpleMesh;var r={vertices:{configurable:!0}};return r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(t){this.geometry.getBuffer("aVertexPosition").data=t},SimpleMesh.prototype._render=function _render(r){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),t.prototype._render.call(this,r)},Object.defineProperties(SimpleMesh.prototype,r),SimpleMesh}(Ni),Ui=function(t){function NineSlicePlane(r,i,o,a,l){t.call(this,Et.WHITE,4,4),this._origWidth=r.orig.width,this._origHeight=r.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=void 0!==i?i:10,this._rightWidth=void 0!==a?a:10,this._topHeight=void 0!==o?o:10,this._bottomHeight=void 0!==l?l:10,this.texture=r}t&&(NineSlicePlane.__proto__=t),NineSlicePlane.prototype=Object.create(t&&t.prototype),NineSlicePlane.prototype.constructor=NineSlicePlane;var r={vertices:{configurable:!0},width:{configurable:!0},height:{configurable:!0},leftWidth:{configurable:!0},rightWidth:{configurable:!0},topHeight:{configurable:!0},bottomHeight:{configurable:!0}};return NineSlicePlane.prototype.textureUpdated=function textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()},r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(t){this.geometry.getBuffer("aVertexPosition").data=t},NineSlicePlane.prototype.updateHorizontalVertices=function updateHorizontalVertices(){var t=this.vertices,r=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height},NineSlicePlane.prototype.updateVerticalVertices=function updateVerticalVertices(){var t=this.vertices,r=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width},NineSlicePlane.prototype._getMinScale=function _getMinScale(){var t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,o=this._height>i?1:this._height/i;return Math.min(r,o)},r.width.get=function(){return this._width},r.width.set=function(t){this._width=t,this._refresh()},r.height.get=function(){return this._height},r.height.set=function(t){this._height=t,this._refresh()},r.leftWidth.get=function(){return this._leftWidth},r.leftWidth.set=function(t){this._leftWidth=t,this._refresh()},r.rightWidth.get=function(){return this._rightWidth},r.rightWidth.set=function(t){this._rightWidth=t,this._refresh()},r.topHeight.get=function(){return this._topHeight},r.topHeight.set=function(t){this._topHeight=t,this._refresh()},r.bottomHeight.get=function(){return this._bottomHeight},r.bottomHeight.set=function(t){this._bottomHeight=t,this._refresh()},NineSlicePlane.prototype._refresh=function _refresh(){var t=this.texture,r=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var i=1/this._origWidth,o=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=i*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-i*this._rightWidth,r[9]=r[11]=r[13]=r[15]=o*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-o*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},Object.defineProperties(NineSlicePlane.prototype,r),NineSlicePlane}(Hi),zi=function(t){function AnimatedSprite(r,i){t.call(this,r[0]instanceof Et?r[0]:r[0].texture),this._textures=null,this._durations=null,this.textures=r,this._autoUpdate=!1!==i,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this.playing=!1}t&&(AnimatedSprite.__proto__=t),AnimatedSprite.prototype=Object.create(t&&t.prototype),AnimatedSprite.prototype.constructor=AnimatedSprite;var r={totalFrames:{configurable:!0},textures:{configurable:!0},currentFrame:{configurable:!0}};return AnimatedSprite.prototype.stop=function stop(){this.playing&&(this.playing=!1,this._autoUpdate&&We.shared.remove(this.update,this))},AnimatedSprite.prototype.play=function play(){this.playing||(this.playing=!0,this._autoUpdate&&We.shared.add(this.update,this,Ve.HIGH))},AnimatedSprite.prototype.gotoAndStop=function gotoAndStop(t){this.stop();var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture()},AnimatedSprite.prototype.gotoAndPlay=function gotoAndPlay(t){var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture(),this.play()},AnimatedSprite.prototype.update=function update(t){var r=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){var o=this._currentTime%1*this._durations[this.currentFrame];for(o+=r/60*1e3;o<0;)this._currentTime--,o+=this._durations[this.currentFrame];var a=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);o>=this._durations[this.currentFrame];)o-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=o/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this._currentTime=0,this.stop(),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this._currentTime=this._textures.length-1,this.stop(),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())},AnimatedSprite.prototype.updateTexture=function updateTexture(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame)},AnimatedSprite.prototype.destroy=function destroy(r){this.stop(),t.prototype.destroy.call(this,r),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},AnimatedSprite.fromFrames=function fromFrames(t){for(var r=[],i=0;i<t.length;++i)r.push(Et.from(t[i]));return new AnimatedSprite(r)},AnimatedSprite.fromImages=function fromImages(t){for(var r=[],i=0;i<t.length;++i)r.push(Et.from(t[i]));return new AnimatedSprite(r)},r.totalFrames.get=function(){return this._textures.length},r.textures.get=function(){return this._textures},r.textures.set=function(t){if(t[0]instanceof Et)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<t.length;r++)this._textures.push(t[r].texture),this._durations.push(t[r].time)}this.gotoAndStop(0),this.updateTexture()},r.currentFrame.get=function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},Object.defineProperties(AnimatedSprite.prototype,r),AnimatedSprite}(Zr),Wi="5.0.0";function useDeprecated(){var t=this;Object.defineProperties(t,{SVG_SIZE:{get:function get(){return deprecation(Wi,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),t.SVGResource.SVG_SIZE}},TransformStatic:{get:function get(){return deprecation(Wi,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),t.Transform}},TransformBase:{get:function get(){return deprecation(Wi,"PIXI.TransformBase class has been removed, use PIXI.Transform"),t.Transform}},TRANSFORM_MODE:{get:function get(){return deprecation(Wi,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function get(){return deprecation(Wi,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),t.Renderer}},CanvasRenderTarget:{get:function get(){return deprecation(Wi,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),t.utils.CanvasRenderTarget}},loader:{get:function get(){return deprecation(Wi,"PIXI.loader instance has moved to PIXI.Loader.shared"),t.Loader.shared}},FilterManager:{get:function get(){return deprecation(Wi,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),t.systems.FilterSystem}},CanvasTinter:{get:function get(){return deprecation("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),t.canvasUtils}},GroupD8:{get:function get(){return deprecation("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),t.groupD8}}}),t.prepare={},Object.defineProperties(t.prepare,{BasePrepare:{get:function get(){return deprecation("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),t.BasePrepare}},Prepare:{get:function get(){return deprecation("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),t.Prepare}},CanvasPrepare:{get:function get(){return deprecation("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),t.CanvasPrepare}}}),t.extract={},Object.defineProperties(t.extract,{Extract:{get:function get(){return deprecation("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),t.Extract}},CanvasExtract:{get:function get(){return deprecation("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),t.CanvasExtract}}}),t.extras={},Object.defineProperties(t.extras,{TilingSprite:{get:function get(){return deprecation(Wi,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),t.TilingSprite}},TilingSpriteRenderer:{get:function get(){return deprecation(Wi,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),t.TilingSpriteRenderer}},AnimatedSprite:{get:function get(){return deprecation(Wi,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),t.AnimatedSprite}},BitmapText:{get:function get(){return deprecation(Wi,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),t.BitmapText}}}),Object.defineProperties(t.utils,{getSvgSize:{get:function get(){return deprecation(Wi,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),t.SVGResource.getSize}}}),t.mesh={},Object.defineProperties(t.mesh,{Mesh:{get:function get(){return deprecation(Wi,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),t.SimpleMesh}},NineSlicePlane:{get:function get(){return deprecation(Wi,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),t.NineSlicePlane}},Plane:{get:function get(){return deprecation(Wi,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),t.SimplePlane}},Rope:{get:function get(){return deprecation(Wi,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),t.SimpleRope}},RawMesh:{get:function get(){return deprecation(Wi,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),t.Mesh}},CanvasMeshRenderer:{get:function get(){return deprecation(Wi,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),t.CanvasMeshRenderer}},MeshRenderer:{get:function get(){return deprecation(Wi,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),t.MeshRenderer}}}),t.particles={},Object.defineProperties(t.particles,{ParticleContainer:{get:function get(){return deprecation(Wi,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),t.ParticleContainer}},ParticleRenderer:{get:function get(){return deprecation(Wi,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),t.ParticleRenderer}}}),t.ticker={},Object.defineProperties(t.ticker,{Ticker:{get:function get(){return deprecation(Wi,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),t.Ticker}},shared:{get:function get(){return deprecation(Wi,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),t.Ticker.shared}}}),t.loaders={},Object.defineProperties(t.loaders,{Loader:{get:function get(){return deprecation(Wi,"PIXI.loaders.Loader class has moved to PIXI.Loader"),t.Loader}},Resource:{get:function get(){return deprecation(Wi,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),t.LoaderResource}},bitmapFontParser:{get:function get(){return deprecation(Wi,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),t.BitmapFontLoader.use}},parseBitmapFontData:{get:function get(){return deprecation(Wi,"PIXI.loaders.parseBitmapFontData function has moved to PIXI.BitmapFontLoader.parse"),t.BitmapFontLoader.parse}},spritesheetParser:{get:function get(){return deprecation(Wi,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),t.SpritesheetLoader.use}},getResourcePath:{get:function get(){return deprecation(Wi,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),t.SpritesheetLoader.getResourcePath}}}),t.Loader.addPixiMiddleware=function addPixiMiddleware(r){return deprecation(Wi,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),t.loaders.Loader.registerPlugin({use:r()})},Object.defineProperty(t.extract,"WebGLExtract",{get:function get(){return deprecation(Wi,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),t.Extract}}),Object.defineProperty(t.prepare,"WebGLPrepare",{get:function get(){return deprecation(Wi,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),t.Prepare}}),t.Container.prototype._renderWebGL=function _renderWebGL(t){deprecation(Wi,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(t)},t.Container.prototype.renderWebGL=function renderWebGL(t){deprecation(Wi,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(t)},t.DisplayObject.prototype.renderWebGL=function renderWebGL(t){deprecation(Wi,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(t)},t.Container.prototype.renderAdvancedWebGL=function renderAdvancedWebGL(t){deprecation(Wi,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(t)},Object.defineProperties(t.settings,{TRANSFORM_MODE:{get:function get(){return deprecation(Wi,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function set(){deprecation(Wi,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var r=t.BaseTexture;r.prototype.loadSource=function loadSource(r){deprecation(Wi,"PIXI.BaseTexture.loadSource method has been deprecated");var i=t.resources.autoDetectResource(r);i.internal=!0,this.setResource(i),this.update()};var i=!1;Object.defineProperties(r.prototype,{hasLoaded:{get:function get(){return deprecation(Wi,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function get(){return deprecation(Wi,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&this.resource.url},set:function set(t){deprecation(Wi,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=t)}},source:{get:function get(){return deprecation(Wi,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource&&this.resource.source},set:function set(t){deprecation(Wi,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=t)}},premultiplyAlpha:{get:function get(){return deprecation("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function set(t){deprecation("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}},_id:{get:function get(){return i||(deprecation("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),i=!0),this._batchLocation},set:function set(t){this._batchLocation=t}}}),r.fromImage=function fromImage(t,i,o,a){deprecation(Wi,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var l={scale:a,crossorigin:i};return r.from(t,{scaleMode:o,resourceOptions:l})},r.fromCanvas=function fromCanvas(t,i){return deprecation(Wi,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),r.from(t,{scaleMode:i})},r.fromSVG=function fromSVG(t,i,o,a){deprecation(Wi,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var l={scale:a,crossorigin:i};return r.from(t,{scaleMode:o,resourceOptions:l})},Object.defineProperties(t.resources.ImageResource.prototype,{premultiplyAlpha:{get:function get(){return deprecation("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function set(t){deprecation("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(t)}}}),t.Point.prototype.copy=function copy(t){return deprecation(Wi,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(t)},t.ObservablePoint.prototype.copy=function copy(t){return deprecation(Wi,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(t)},t.Rectangle.prototype.copy=function copy(t){return deprecation(Wi,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(t)},t.Matrix.prototype.copy=function copy(t){return deprecation(Wi,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(t)},t.systems.StateSystem.prototype.setState=function setState(t){return deprecation("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(t)},Object.assign(t.systems.FilterSystem.prototype,{getRenderTarget:function getRenderTarget(t,r){return deprecation(Wi,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(r)},returnRenderTarget:function returnRenderTarget(t){deprecation(Wi,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(t)},calculateScreenSpaceMatrix:function calculateScreenSpaceMatrix(t){deprecation(Wi,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var r=t.identity(),i=this.activeState,o=i.sourceFrame,a=i.destinationFrame;return r.translate(o.x/a.width,o.y/a.height),r.scale(a.width,a.height),r},calculateNormalizedScreenSpaceMatrix:function calculateNormalizedScreenSpaceMatrix(t){deprecation(Wi,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var r=this.activeState,i=r.sourceFrame,o=r.destinationFrame,a=t.identity();a.translate(i.x/o.width,i.y/o.height);var l=o.width/i.width,h=o.height/i.height;return a.scale(l,h),a}}),Object.defineProperties(t.RenderTexture.prototype,{sourceFrame:{get:function get(){return deprecation(Wi,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function get(){return deprecation(Wi,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var o=function(t){function BlurXFilter(r,i,o,a){deprecation(Wi,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!0,r,i,o,a)}return t&&(BlurXFilter.__proto__=t),BlurXFilter.prototype=Object.create(t&&t.prototype),BlurXFilter.prototype.constructor=BlurXFilter,BlurXFilter}(t.filters.BlurFilterPass),a=function(t){function BlurYFilter(r,i,o,a){deprecation(Wi,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),t.call(this,!1,r,i,o,a)}return t&&(BlurYFilter.__proto__=t),BlurYFilter.prototype=Object.create(t&&t.prototype),BlurYFilter.prototype.constructor=BlurYFilter,BlurYFilter}(t.filters.BlurFilterPass);Object.assign(t.filters,{BlurXFilter:o,BlurYFilter:a});var l=t.Sprite,h=t.Texture,g=t.Graphics;function spriteFrom(t,r,i,o){return deprecation(Wi,"PIXI.Sprite."+t+" method is deprecated, use PIXI.Sprite.from"),l.from(r,{resourceOptions:{scale:o,crossorigin:i}})}function textureFrom(t,r,i,o){return deprecation(Wi,"PIXI.Texture."+t+" method is deprecated, use PIXI.Texture.from"),h.from(r,{resourceOptions:{scale:o,crossorigin:i}})}g.prototype.generateCanvasTexture||(g.prototype.generateCanvasTexture=function generateCanvasTexture(){deprecation(Wi,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(t.Graphics.prototype,"graphicsData",{get:function get(){return deprecation(Wi,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),Object.defineProperty(t.SimpleRope.prototype,"points",{get:function get(){return deprecation(Wi,"PIXI.SimpleRope.points property is deprecated, use PIXI.SimpleRope.geometry.points"),this.geometry.points},set:function set(t){deprecation(Wi,"PIXI.SimpleRope.points property is deprecated, use PIXI.SimpleRope.geometry.points"),this.geometry.points=t}}),l.fromImage=spriteFrom.bind(null,"fromImage"),l.fromSVG=spriteFrom.bind(null,"fromSVG"),l.fromCanvas=spriteFrom.bind(null,"fromCanvas"),l.fromVideo=spriteFrom.bind(null,"fromVideo"),l.fromFrame=spriteFrom.bind(null,"fromFrame"),h.fromImage=textureFrom.bind(null,"fromImage"),h.fromSVG=textureFrom.bind(null,"fromSVG"),h.fromCanvas=textureFrom.bind(null,"fromCanvas"),h.fromVideo=textureFrom.bind(null,"fromVideo"),h.fromFrame=textureFrom.bind(null,"fromFrame"),Object.defineProperty(t.AbstractRenderer.prototype,"autoResize",{get:function get(){return deprecation(Wi,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function set(t){deprecation(Wi,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=t}}),Object.defineProperty(t.Renderer.prototype,"textureManager",{get:function get(){return deprecation(Wi,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),t.utils.mixins={mixin:function mixin(){deprecation(Wi,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function delayMixin(){deprecation(Wi,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function performMixins(){deprecation(Wi,"PIXI.utils.mixins.performMixins function is no longer available")}}}Gn.registerPlugin("accessibility",Ue),Gn.registerPlugin("extract",ar),Gn.registerPlugin("interaction",tt),Gn.registerPlugin("particle",Er),Gn.registerPlugin("prepare",li),Gn.registerPlugin("batch",tr),Gn.registerPlugin("tilingSprite",yi),_r.registerPlugin(_i),_r.registerPlugin(pi),nr.registerPlugin(qe),nr.registerPlugin(xr);var qi="5.2.1",$i={AlphaFilter:xi,BlurFilter:Ei,BlurFilterPass:Mi,ColorMatrixFilter:Ti,DisplacementFilter:Pi,FXAAFilter:Ci,NoiseFilter:Ai},Xi=i(2),Ki=i(16);function createCaptureHintObj(t,r){var i=t.squareSize,a=r.color,l=r.opacity,h=r.position,g=new Xr;return g.beginFill(16777215),g.drawCircle(0,0,.5*i),g.beginHole(),g.drawCircle(0,0,.41*i),g.endHole(),g.beginFill(0,0),g.drawRect(.5*-i,.5*-i,i,i),g.position.x=h.x,g.position.y=h.y,g.alpha=l,g.tint=o.string2hex(a),g}function create_capture_hint_obj_createCaptureHintObj(t,r){var i=t.squareSize,o=createCaptureHintObj(t,r),a=new $i.BlurFilter(.05*i,6,Ki.a.PixelRatio);return o.filters=[a],o.alpha=.5,o.tint=r.turn===Xi.a.ColorsAsNumbers.White?56063:16711680,o}function createHighlightedSquareObj(t,r){var i=t.squareSize,a=r.color,l=r.opacity,h=r.position,g=.5*i,y=new Xr;return y.beginFill(16777215),y.drawRect(-g,-g,i,i),y.position.x=h.x,y.position.y=h.y,y.alpha=l,y.tint=o.string2hex(a),y}function create_highlighted_square_obj_createHighlightedSquareObj(t,r){var i=t.squareSize,o=createHighlightedSquareObj(t,r),a=new $i.BlurFilter(.1*i,6,Ki.a.PixelRatio);return o.filters=[a],o.width*=1.1,o.height*=1.1,r.type===Xi.a.HighlightedSquare.Types.Move&&(o.tint=r.turn===Xi.a.ColorsAsNumbers.White?56063:16711680),o}function createHoverSquareObj(t){var r=t.scene,i=t.squareSize,o=.5*i,a=.08*i,l=new $i.BlurFilter(.1*i,6,Ki.a.PixelRatio),h=new Xr;return h.lineStyle(a,16777215,1,0),h.drawRect(-o,-o,i,i),h.filters=[l],h.tint=56063,h.visible=!1,r.addChild(h),h}function createMoveHintObj(t,r){var i=t.squareSize,a=r.color,l=r.opacity,h=r.position,g=new Xr;return g.beginFill(16777215),g.drawCircle(0,0,.16*i),g.beginFill(0,0),g.drawRect(.5*-i,.5*-i,i,i),g.position.x=h.x,g.position.y=h.y,g.alpha=l,g.tint=o.string2hex(a),g}function create_move_hint_obj_createMoveHintObj(t,r){var i=t.squareSize,o=createMoveHintObj(t,r),a=new $i.BlurFilter(.05*i,6,Ki.a.PixelRatio);return o.filters=[a],o.alpha=.5,o.tint=r.turn===Xi.a.ColorsAsNumbers.White?56063:16711680,o}var Yi=function(t){function KawaseBlurFilter(r,i,o){void 0===r&&(r=4),void 0===i&&(i=3),void 0===o&&(o=!1),t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",o?"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), filterClamp.xy, filterClamp.zw));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}\n":"\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nuniform vec2 uOffset;\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n\n    // Sample top left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample top right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));\n\n    // Sample bottom right pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Sample bottom left pixel\n    color += texture2D(uSampler, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));\n\n    // Average\n    color *= 0.25;\n\n    gl_FragColor = color;\n}"),this.uniforms.uOffset=new Float32Array(2),this._pixelSize=new ye,this.pixelSize=1,this._clamp=o,this._kernels=null,Array.isArray(r)?this.kernels=r:(this._blur=r,this.quality=i)}t&&(KawaseBlurFilter.__proto__=t),KawaseBlurFilter.prototype=Object.create(t&&t.prototype),KawaseBlurFilter.prototype.constructor=KawaseBlurFilter;var r={kernels:{configurable:!0},clamp:{configurable:!0},pixelSize:{configurable:!0},quality:{configurable:!0},blur:{configurable:!0}};return KawaseBlurFilter.prototype.apply=function apply(t,r,i,o){var a,l=this.pixelSize.x/r._frame.width,h=this.pixelSize.y/r._frame.height;if(1===this._quality||0===this._blur)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*l,this.uniforms.uOffset[1]=a*h,t.applyFilter(this,r,i,o);else{for(var g,y=t.getFilterTexture(),_=r,x=y,w=this._quality-1,S=0;S<w;S++)a=this._kernels[S]+.5,this.uniforms.uOffset[0]=a*l,this.uniforms.uOffset[1]=a*h,t.applyFilter(this,_,x,!0),g=_,_=x,x=g;a=this._kernels[w]+.5,this.uniforms.uOffset[0]=a*l,this.uniforms.uOffset[1]=a*h,t.applyFilter(this,_,i,o),t.returnFilterTexture(y)}},KawaseBlurFilter.prototype._generateKernels=function _generateKernels(){var t=this._blur,r=this._quality,i=[t];if(t>0)for(var o=t,a=t/r,l=1;l<r;l++)o-=a,i.push(o);this._kernels=i},r.kernels.get=function(){return this._kernels},r.kernels.set=function(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max.apply(Math,t)):(this._kernels=[0],this._quality=1)},r.clamp.get=function(){return this._clamp},r.pixelSize.set=function(t){"number"==typeof t?(this._pixelSize.x=t,this._pixelSize.y=t):Array.isArray(t)?(this._pixelSize.x=t[0],this._pixelSize.y=t[1]):t instanceof ye?(this._pixelSize.x=t.x,this._pixelSize.y=t.y):(this._pixelSize.x=1,this._pixelSize.y=1)},r.pixelSize.get=function(){return this._pixelSize},r.quality.get=function(){return this._quality},r.quality.set=function(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()},r.blur.get=function(){return this._blur},r.blur.set=function(t){this._blur=t,this._generateKernels()},Object.defineProperties(KawaseBlurFilter.prototype,r),KawaseBlurFilter}(vn),Zi="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Qi="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform vec3 color;\n\nuniform vec2 shift;\nuniform vec4 inputSize;\n\nvoid main(void){\n    vec4 sample = texture2D(uSampler, vTextureCoord - shift * inputSize.zw);\n\n    // Premultiply alpha\n    sample.rgb = color.rgb * sample.a;\n\n    // alpha user alpha\n    sample *= alpha;\n\n    gl_FragColor = sample;\n}",Ji=function(t){function DropShadowFilter(r){r&&r.constructor!==Object&&(console.warn("DropShadowFilter now uses options instead of (rotation, distance, blur, color, alpha)"),r={rotation:r},void 0!==arguments[1]&&(r.distance=arguments[1]),void 0!==arguments[2]&&(r.blur=arguments[2]),void 0!==arguments[3]&&(r.color=arguments[3]),void 0!==arguments[4]&&(r.alpha=arguments[4])),r=Object.assign({rotation:45,distance:5,color:0,alpha:.5,shadowOnly:!1,kernels:null,blur:2,quality:3,pixelSize:1,resolution:Q.RESOLUTION},r),t.call(this);var i=r.kernels,o=r.blur,a=r.quality,l=r.pixelSize,h=r.resolution;this._tintFilter=new t(Zi,Qi),this._tintFilter.uniforms.color=new Float32Array(4),this._tintFilter.uniforms.shift=new ye,this._tintFilter.resolution=h,this._blurFilter=i?new Yi(i):new Yi(o,a),this.pixelSize=l,this.resolution=h;var g=r.shadowOnly,y=r.rotation,_=r.distance,x=r.alpha,w=r.color;this.shadowOnly=g,this.rotation=y,this.distance=_,this.alpha=x,this.color=w,this._updatePadding()}t&&(DropShadowFilter.__proto__=t),DropShadowFilter.prototype=Object.create(t&&t.prototype),DropShadowFilter.prototype.constructor=DropShadowFilter;var r={resolution:{configurable:!0},distance:{configurable:!0},rotation:{configurable:!0},alpha:{configurable:!0},color:{configurable:!0},kernels:{configurable:!0},blur:{configurable:!0},quality:{configurable:!0},pixelSize:{configurable:!0}};return DropShadowFilter.prototype.apply=function apply(t,r,i,o){var a=t.getFilterTexture();this._tintFilter.apply(t,r,a,!0),this._blurFilter.apply(t,a,i,o),!0!==this.shadowOnly&&t.applyFilter(this,r,i,!1),t.returnFilterTexture(a)},DropShadowFilter.prototype._updatePadding=function _updatePadding(){this.padding=this.distance+2*this.blur},DropShadowFilter.prototype._updateShift=function _updateShift(){this._tintFilter.uniforms.shift.set(this.distance*Math.cos(this.angle),this.distance*Math.sin(this.angle))},r.resolution.get=function(){return this._resolution},r.resolution.set=function(t){this._resolution=t,this._tintFilter&&(this._tintFilter.resolution=t),this._blurFilter&&(this._blurFilter.resolution=t)},r.distance.get=function(){return this._distance},r.distance.set=function(t){this._distance=t,this._updatePadding(),this._updateShift()},r.rotation.get=function(){return this.angle/we},r.rotation.set=function(t){this.angle=t*we,this._updateShift()},r.alpha.get=function(){return this._tintFilter.uniforms.alpha},r.alpha.set=function(t){this._tintFilter.uniforms.alpha=t},r.color.get=function(){return rgb2hex(this._tintFilter.uniforms.color)},r.color.set=function(t){hex2rgb(t,this._tintFilter.uniforms.color)},r.kernels.get=function(){return this._blurFilter.kernels},r.kernels.set=function(t){this._blurFilter.kernels=t},r.blur.get=function(){return this._blurFilter.blur},r.blur.set=function(t){this._blurFilter.blur=t,this._updatePadding()},r.quality.get=function(){return this._blurFilter.quality},r.quality.set=function(t){this._blurFilter.quality=t},r.pixelSize.get=function(){return this._blurFilter.pixelSize},r.pixelSize.set=function(t){this._blurFilter.pixelSize=t},Object.defineProperties(DropShadowFilter.prototype,r),DropShadowFilter}(vn);function addPiece(t,r){var i=t.scene,o=t.fadeInOverlay;o?i.addChildAt(r.obj,i.getChildIndex(o)):i.addChild(r.obj),isPieceStylePseudo3D(t)&&updatePseudo3DPiecePosition(t,r)}function createPieceObj(t){var r=t.squareSize,i=new Zr;return i.width=r,i.height=r,i.anchor.set(.5,.5),i.pivot.set(.5,.5),i}function elevatePiece(t){t.obj.parent.addChild(t.obj)}function fadeInAllPieces(t,r){var i=t.animator,o=t.scene,a=t.boardObj;t.fadeInOverlay&&(o.removeChild(t.fadeInOverlay),t.fadeInOverlay=null);var l=new Zr(a.texture);return l.width=a.width,l.height=a.height,l.position.x=a.position.x,l.position.y=a.position.y,o.addChildAt(l,o.children.length),t.fadeInOverlay=l,i.play({duration:r,keyframes:{0:{alpha:1},100:{alpha:0}},target:l,onEnd:function onEnd(){t.fadeInOverlay&&o.removeChild(t.fadeInOverlay),t.fadeInOverlay=null}})}var eo=i(22);function createState(t){return Object.assign(Object.assign({},t),{analysisOverlay:null,boardCoordinates:null,boardObj:new Zr,boardOffset:{x:0,y:0},extraTextures:{},flipCoordinates:!0,fadeInOverlay:null,piecesTextures:{},promotionHandler:function promotionHandler(){},promotionWindow:null,renderer:new Gn({antialias:!1,autoDensity:!0,resolution:Ki.a.PixelRatio,transparent:!0,view:t.viewEl}),scene:new Ge})}function destroy_destroy(t){var r=t.scene,i=t.renderer;!function disposeCachedTextures(t){var r=t.boardTexture,i=t.piecesTextures,o=t.extraTextures;null==r||r.destroy(!0),Object.values(i).forEach((function(t){return t.destroy(!0)})),Object.values(o).forEach((function(t){return t.destroy(!0)}))}(t),r.destroy({baseTexture:!0,children:!0,texture:!0}),i.destroy()}function fileRankToPosition(t,r){var i=t.boardOffset,o=t.isBoardFlipped,a=t.squareSize;return o?{x:a*(8-r.file)+.5*a+i.x,y:a*(r.rank-1)+.5*a+i.y}:{x:a*(r.file-1)+.5*a+i.x,y:a*(8-r.rank)+.5*a+i.y}}function getBoardPosition(t,r){return r}function getViewPosition(t,r){return r}var to=i(7);function addEffect(t,r){t.scene.addChild(r.obj)}var no=i(42),ro=i(40);function textureFromSVG(t){var r=document.createElement("img");return r.src="data:image/svg+xml;utf8,".concat(encodeURIComponent(t)),r.width=256,r.height=256,Et.from(r)}function createEffectObj(t,r){var i=t.squareSize,o=r.position,a=r.type,l=textureFromSVG(Object(ro.a)({path:no.a[a],size:"100%",viewBox:"0 0 19 19"})),h=new Zr(l);return h.width=.4*i,h.height=.4*i,h.anchor.set(.5,.5),h.pivot.set(.5,.5),h.position.x=o.x+.44*i,h.position.y=o.y-.44*i,h}var io=i(14);function refreshEffects(t){var r=t.effects,i=t.squareSize;Object.values(r).forEach((function(r){var o=Object(io.a)(r.info.square),a=fileRankToPosition(t,o);r.info.position=a,r.obj.width=.4*i,r.obj.height=.4*i,r.obj.position.x=a.x+.44*i,r.obj.position.y=a.y-.44*i}))}function removeEffect(t,r){t.scene.removeChild(r.obj)}function addArrow(t,r){t.scene.addChild(r.obj),function refreshEffectsDisplayOrder(t){Object.values(t.effects).forEach((function(t){return t.obj.parent.addChild(t.obj)}))}(t)}var oo=i(18),ao=i(35),so=i(49),co=i(48),lo=i(50);function createArrowObj(t,r){var i=t.squareSize,a=r.color,l=r.opacity,h=r.isKnight,g=fileRankToPosition(t,r.from),y=fileRankToPosition(t,r.to),_=Object(ao.a)({from:g,to:y}),x=Object(co.a)({from:g,to:y}),w=function getArrowPoints(t){var r=t.length,i=t.squareSize,o=t.isKnight,a=.5*i,l=8*i,h=l*oo.b.WIDTH*.01*.5,g=l*oo.b.HEAD_HEIGHT*.01,y=l*oo.b.HEAD_WIDTH*.01*.5,_=l*oo.b.TAIL_PADDING*.01,x=a-_;if(o)return[a-h,a+_,a+h,a+_,a+h,2*i+a-h,i+x,2*i+a-h,i+x,2*i+a-y,i+x+g,2*i+a,i+x,2*i+a+y,i+x,2*i+a+h,a-h,2*i+a+h];return[a-h,a+_,a+h,a+_,a+h,r+x,a+y,r+x,a,r+x+g,a-y,r+x,a-h,r+x]}({isKnight:h,length:_,squareSize:i}),S=h?Object(lo.a)({from:g,slope:x,to:y}):Object(so.a)({from:g,to:y}),M=oo.c.includes(x)?-1:1,T=new Xr;return T.beginFill(16777215),T.drawPolygon(w),T.pivot=new ye(i/2,i/2),T.angle=S,T.scale.x*=M,T.position.x=g.x,T.position.y=g.y,T.alpha=l,T.tint=o.string2hex(a),T}function redrawArrows(t){var r=t.arrows;Object.values(r).forEach((function(r){var i=r.info;removeArrow(t,r),r.obj=createArrowObj(t,i),addArrow(t,r)}))}function removeArrow(t,r){t.scene.removeChild(r.obj)}function addCustomItem(t,r){t.scene.addChild(r.obj)}var uo=i(53),ho=i(15);function createCustomItemObj(t,r){var i,o=t.squareSize,a=r.position,l=r.type,h=r.image,g=r.opacity,y=1;if(h)i=Et.from(h.url),h.percentOfSquare&&(y=.01*h.percentOfSquare);else{var _=Object(ho.d)(uo[l],r);if(i=textureFromSVG(_),t.options.test){var x=document.createElement("div");x.innerHTML=_,r.testSVG=x.querySelector("svg")}}var w=new Zr(i);return w.width=o*y,w.height=o*y,w.anchor.set(.5,.5),w.pivot.set(.5,.5),w.position.x=a.x,w.position.y=a.y,w.alpha=h&&g?g:.8,w}function refreshCustomItems(t){var r=t.customItems,i=t.squareSize;Object.values(r).forEach((function(r){var o=Object(io.a)(r.info.square),a=fileRankToPosition(t,o);r.info.position=a,r.obj.width=i,r.obj.height=i,r.obj.position.x=a.x,r.obj.position.y=a.y}))}function removeCustomItem(t,r){t.scene.removeChild(r.obj)}function addHint(t,r){t.scene.addChildAt(r.obj,t.scene.children.length-1)}function refreshHints(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object.values(t.hints).forEach((function(i){var o=Object(io.a)(i.info.square),a=fileRankToPosition(t,o);i.info.position=a,i.obj.width*=r,i.obj.height*=r,i.obj.position.x=a.x,i.obj.position.y=a.y}))}function removeHint(t,r){t.scene.removeChild(r.obj)}function addHighlightedSquare(t,r){t.scene.addChildAt(r.obj,1)}function create_hover_square_obj_createHoverSquareObj(t){var r=t.scene,i=t.squareSize,o=new Zr;return o.anchor=new ye(.5,.5),o.width=2*i,o.height=2*i,o.visible=!1,r.addChild(o),o}function hideHoverSquare(t){var r=t.hoverSquare;r&&(r.visible=!1)}function refreshSquares(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=t.highlightedSquares,o=t.hoverSquare;o&&(o.width*=r,o.height*=r),Object.values(i).forEach((function(i){var o=Object(io.a)(i.info.square),a=fileRankToPosition(t,o);i.info.position=a,i.obj.width*=r,i.obj.height*=r,i.obj.position.x=a.x,i.obj.position.y=a.y}))}function removeHighlightedSquare(t,r){t.scene.removeChild(r.obj)}function showHoverSquare(t,r){var i=t.hoverSquare;i&&(i.visible=!0,i.position.x=r.x,i.position.y=r.y)}function addAnalysisOverlay(t){var r=t.scene,i=t.boardObj;if(!t.analysisOverlay){var o=new Xr;o.beginFill(16777215,.2),o.drawRect(0,0,i.width,i.height),o.position.x=i.position.x,r.addChildAt(o,r.getChildIndex(i)+1),t.analysisOverlay=o}}function flipBoard(t){refreshPieces(t),refreshPseudo3DPieces(t),refreshSquares(t),refreshHints(t),refreshCustomItems(t),refreshEffects(t),redrawArrows(t)}function removeAnalysisOverlay(t){var r=t.scene;t.analysisOverlay&&r.removeChild(t.analysisOverlay),t.analysisOverlay=null}var po=i(33);function updateBoardCoordinates(t,r){var i=r.position,a=r.flipped,l=r.refreshOnly,h=t.scene,g=t.viewSize,y=t.boardOffset,_=i===to.a.CoordinatesPositions.Outside;!(_||y.x>0)||l?(t.boardCoordinates&&(h.removeChild(t.boardCoordinates),t.boardCoordinates=null),i!==to.a.CoordinatesPositions.Off&&(t.boardCoordinates=function createCoordinates(t,r){var i=r.flipped,a=r.outside,l=t.squareSize,h=t.boardOffset,g=new Ge,y=o.string2hex(Object(po.e)(t)),_=o.string2hex(Object(po.f)(t)),x=.13*l,w=.13*l,S=.18*l,M=.17*l,T=new ti({fill:16777215,fontSize:.23*l,fontWeight:"bold"});g.width=8*l,g.height=8*l;var P=["a","b","c","d","e","f","g","h"],C=["1","2","3","4","5","6","7","8"];i?P.reverse():C.reverse();return P.forEach((function(t,r){var i=new ai(t,T);i.anchor=new ye(.5,.5),a?(i.position.x=l*(r+1)+h.x-.5*l,i.position.y=8*l+h.y+.45*h.x,i.alpha=.5,i.tint=16777215):(i.position.x=l*(r+1)+h.x-w,i.position.y=8*l+h.y-M,i.tint=r%2?y:_),g.addChild(i)})),C.forEach((function(t,r){var i=new ai(t,T);i.anchor=new ye(.5,.5),a?(i.position.x=.5*h.x,i.position.y=l*r+h.y+.5*l,i.alpha=.5,i.tint=16777215):(i.position.x=h.x+x,i.position.y=l*r+h.y+S,i.tint=r%2?_:y),g.addChild(i)})),g}(t,{flipped:a,outside:_}),h.addChildAt(t.boardCoordinates,1))):updateViewSize(t,g)}function updateViewSize(t,r){var i=r.height,o=r.width,a=t.boardOffset,l=t.options,h=t.renderer,g=l.coordinates===to.a.CoordinatesPositions.Outside,y=.035*o,_=t.squareSize;a.x=g?y:0;var x=o-a.x-a.y;isPieceStylePseudo3D(t)&&(a.x=(o-x)/2),t.squareSize=x/8;var w=_?t.squareSize/_:1;h.resize(o,i),function updateBoardSize(t){var r=t.boardObj,i=t.boardOffset,o=t.squareSize,a=t.analysisOverlay,l=t.fadeInOverlay;r.width=8*o,r.height=r.width,r.position.x=i.x,r.position.y=i.y,a&&(a.width=r.width,a.height=r.height,a.position.x=r.position.x,a.position.y=r.position.y),l&&(l.width=r.width,l.height=r.height,l.position.x=r.position.x,l.position.y=r.position.y)}(t),updateBoardCoordinates(t,{flipped:l.flipped,position:l.coordinates,refreshOnly:!0}),refreshPieces(t),refreshSquares(t,w),refreshHints(t,w),refreshCustomItems(t),refreshEffects(t),redrawArrows(t)}function init_init(t){t.scene.addChild(t.boardObj),updateViewSize(t,t.viewSize)}function normalizePointer(t,r){return r}function positionToFileRank(t,r){var i=t.boardOffset,o=t.isBoardFlipped,a=t.squareSize,l=Math.ceil((r.x-i.x)/a),h=Math.ceil((8*a-(r.y-i.y))/a);return o&&(l=9-l,h=9-h),{file:l,rank:h}}var fo=i(29);function positionToNearestSquare(t,r){var i=t.boardOffset,o=.01,a=8*t.squareSize;return{x:Object(fo.a)(r.x,{min:i.x+o,max:a+i.x-o}),y:Object(fo.a)(r.y,{min:i.y+o,max:a+i.y-o})}}function render_render(t){t.renderer.render(t.scene)}function findPieceFromPosition(t,r){var i=positionToFileRank(t,r);return Object(eo.e)(t,i)}function isPieceStylePseudo3D(t){var r=t.pieceStyle,i=t.pieceThemes[r].isPseudo3d;return Boolean(i)}function onPieceDrop(t,r){isPieceStylePseudo3D(t)&&updatePseudo3DPiecePosition(t,r)}function onPieceMoved(t,r){isPieceStylePseudo3D(t)&&(updatePseudo3DPiecePosition(t,r),updatePieceSize(t,r))}function onPiecesLoaded(t){isPieceStylePseudo3D(t)&&refreshPseudo3DPieces(t)}function onPiecesVisualsChanged(t){var r=t.boardOffset,i=t.piecesTextures,o=t.squareSize,a=t.viewSize,l=r.y;if(isPieceStylePseudo3D(t)){var h=i.wk.orig,g=o*(h.height/h.width);r.y=g-o}else r.y=0;r.y!==l&&updateViewSize(t,a)}function refreshPieces(t){Object.values(t.pieces).forEach((function(r){var i=Object(io.a)(r.info.square),o=fileRankToPosition(t,i);updatePieceSize(t,r),setPiecePosition(r,o)}))}function refreshPseudo3DPieces(t){Object.values(t.pieces).forEach((function(r){updatePseudo3DPiecePosition(t,r)}))}function removePiece(t,r){t.scene.removeChild(r.obj)}function setPiecePosition(t,r){t.obj.x=r.x,t.obj.y=r.y}var mo=i(24);function updatePseudo3DPiecePosition(t,r){for(var i=t.pieces,o=t.isBoardFlipped,a=Object(io.a)(r.info.square).file,l=[],h=r.obj.parent.getChildIndex(r.obj),g=1;g<=8;g++){var y=i[Object(mo.a)({file:a,rank:g})];if(y){var _=y.obj.parent.getChildIndex(y.obj);l.push(y),h<_&&(h=_)}}o||l.reverse(),l.forEach((function(t){return t.obj.parent.addChildAt(t.obj,h)}))}function updatePieceSize(t,r){var i=t.squareSize;if(r.obj.width=i,isPieceStylePseudo3D(t)){var o=r.obj.texture.orig,a=i*(o.height/o.width),l=(a-i/2)/a;r.obj.height=a,r.obj.anchor.y=l,r.obj.pivot.y=l}else r.obj.height=i,r.obj.anchor.y=.5,r.obj.pivot.y=.5}var go,vo=i(25);function updatePieceVisuals(t,r){var i="".concat(Object(vo.a)(r.info.color)).concat(r.info.type);r.obj.texture=t.piecesTextures[i],updatePieceSize(t,r)}function dragPiece(t,r){var i=t.squareSize;return elevatePiece(r),r.obj.filters=[new Ji({alpha:.4,blur:.8,distance:.08*i,resolution:Ki.a.PixelRatio})],t.animator.play({duration:500,easing:_.b,keyframes:{0:{height:r.obj.height,width:r.obj.width},50:{height:1.1*r.obj.height,width:1.1*r.obj.width},100:{height:r.obj.height,width:r.obj.width}},repeat:1/0,target:r.obj})}function dropPiece(t,r){var i=r.piece,o=r.to,a=i.obj,l=a.filters[0],h=t.squareSize,g=a.width/h;return a.angle=0,t.animator.play({data:{shadow:l,state:t},duration:40,keyframes:{0:{height:a.height,shadowDistance:l.distance,width:a.width,x:a.x,y:a.y},100:{height:a.height/g,shadowDistance:0,width:a.width/g,x:o.x,y:o.y}},onEnd:onDroppedPieceEnd,onUpdate:onDroppedPieceUpdate,target:a})}function onDroppedPieceUpdate(t){t.data.shadow.distance=t.animatedProps.shadowDistance}function onDroppedPieceEnd(t){delete t.params.target.filters}function hideCustomItem(t,r){return t.animator.play({duration:go.CustomItem.Duration,keyframes:{0:{alpha:r.obj.alpha,width:r.obj.width,height:r.obj.height},100:{alpha:0,width:2*r.obj.width,height:2*r.obj.height}},target:r.obj})}function hideHighlightedSquare(t,r){return t.animator.play({duration:150,easing:_.e,keyframes:{0:{alpha:r.obj.alpha},100:{alpha:0}},target:r.obj})}function hideHint(t,r){return t.animator.play({duration:80,easing:_.e,keyframes:{0:{height:r.obj.height,width:r.obj.width},100:{height:0,width:0}},target:r.obj})}!function(t){!function(t){t.Duration=250}(t.CustomItem||(t.CustomItem={}))}(go||(go={}));var yo=i(27);function loadAssets(t){return new Promise((function(r){var i=t.extraTextures,o=Object(yo.a)("two-d/arcade"),a=new _r,l=[{name:"lightningBlue",url:"".concat(o,"/lightning-blue.png")},{name:"lightningRed",url:"".concat(o,"/lightning-red.png")}];!function createLightningEmptyTextures(t){t.lightningBlue=new Et(new ut),t.lightningBranchBlue=new Et(new ut),t.lightningRed=new Et(new ut),t.lightningBranchRed=new Et(new ut)}(i),a.add(l).load((function(){t.destroyed||(!function updateLightningTextures(t,r){var i=r.lightningBlue.texture.baseTexture.resource,o=r.lightningRed.texture.baseTexture.resource,a=new Re(0,0,i.width,i.height/2),l=new Re(0,i.height/2,i.width,i.height/2);t.lightningBlue.baseTexture.setResource(i),t.lightningBranchBlue.baseTexture.setResource(i),t.lightningBlue.frame=a,t.lightningBranchBlue.frame=l,t.lightningRed.baseTexture.setResource(o),t.lightningBranchRed.baseTexture.setResource(o),t.lightningRed.frame=a,t.lightningBranchRed.frame=l}(i,a.resources),a.destroy(),r())}))}))}var bo,_o=i(6),xo=i.n(_o),wo=i(3);function getRandomInt(t,r){return Math.floor(Math.random()*(r-t+1))+t}function getRandomNumber(t,r){return Math.random()*(r-t)+t}function interpolateLinearly(t){var r=t.from,i=t.to,o=t.alpha,a=t.restrictAlpha,l=void 0===a||a?Object(fo.a)(o,{min:0,max:1}):o;return r*(1-l)+i*l}function animateLightning(t,r){var i=r.deltaTime,o=r.useDepthGeneration,a=void 0!==o&&o;!function animateLightningLine(t,r){var i=r.deltaTime,o=r.useDepthGeneration,a=t.seed,l=12,h=20;t.accumulatedDeltaTime+=i,t.accumulatedDeltaTimeForBranches+=i,t.accumulatedDeltaTime>1/l&&(a=generateLightningSeed(),generateLightningPoints({breakingPointsCount:t.breakingPointsCount,breakingPointsOffset:t.breakingPointsOffset,wrinklePointsCount:t.wrinklePointsCount,origin:t.points[0],seed:a,source:t.newPoints,target:t.points[t.points.length-1]}),t.accumulatedDeltaTime=0,t.seed=a);if(t.accumulatedDeltaTimeForBranches>1/h){if(t.branchesLevelsParams){for(var g=o?getRandomInt(0,t.branchesLevelsParams.length):0,y=xo()(t.branchesLevelsParams),_=[t],x=function _loop(t){y.shift();var r=[];_.forEach((function(t){r.push.apply(r,xo()(t.branches))})),_=r},w=0;w<g;w++)x(w);_.forEach((function(t){t.branches.forEach((function(r){return t.obj.removeChild(r.obj)})),t.branches.length=0})),y.forEach((function(t){var r=[];_.forEach((function(i){createLightningBranches(i,t),r.push.apply(r,xo()(i.branches))})),_=r}))}t.accumulatedDeltaTimeForBranches=0}for(var S=0;S<t.points.length;S++){var M=t.points[S],T=t.newPoints[S];M.x=interpolateLinearly({from:M.x,to:T.x,alpha:l*i}),M.y=interpolateLinearly({from:M.y,to:T.y,alpha:l*i})}t.obj.getChildAt(t.obj.children.length-1).geometry.update()}(t,{deltaTime:i,useDepthGeneration:a}),t.branches.forEach((function(r){var o=r.originPointIndex,l=new wo.Vector2(t.points[o].x,t.points[o].y);r.points[0].x=l.x,r.points[0].y=l.y,animateLightning(r,{deltaTime:i,useDepthGeneration:a})}))}function createLightningLine(t){var r=t.origin,i=t.target,o=t.width,a=t.breakingPointsCount,l=void 0===a?3:a,h=t.breakingPointsOffset,g=void 0===h?10:h,y=t.wrinklePointsCount,_=void 0===y?3:y,x=t.texture,w=generateLightningSeed(),S=generateLightningPoints({breakingPointsCount:l,breakingPointsOffset:g,wrinklePointsCount:_,origin:r,seed:w,target:i}),M=generateLightningPoints({breakingPointsCount:l,breakingPointsOffset:g,wrinklePointsCount:_,origin:r,seed:w,target:i}),T=new Fi(o,S,0),P=new ki(x),C=new Ni(T,P),A=new Ge;return A.addChild(C),{accumulatedDeltaTime:0,accumulatedDeltaTimeForBranches:0,breakingPointsCount:l,breakingPointsOffset:g,wrinklePointsCount:_,newPoints:M,obj:A,points:S,seed:w,width:o,branches:[],originPointIndex:0}}function createLightningBranches(t,r){for(var i=r.texture,o=r.branchesCount,a=void 0===o?3:o,l=r.wrinklePointsCount,h=void 0===l?3:l,g=r.angleLimit,y=void 0===g?{min:45,max:90}:g,_=r.alphaRatioLimit,x=void 0===_?{min:.9,max:1}:_,w=r.breakingPointsOffsetRatioLimit,S=void 0===w?{min:.4,max:.6}:w,M=r.lengthRatioLimit,T=void 0===M?{min:.1,max:.2}:M,P=r.widthRatioLimit,C=void 0===P?{min:.4,max:.6}:P,A=r.useRelativeLength,O=void 0!==A&&A,L=t.points[0],I=t.points[t.points.length-1],R=new wo.Vector2(L.x,L.y),j=new wo.Vector2(I.x,I.y),N=t.points.map((function(t,r){return r})),k=[],D=0;D<a;D++){var B=getRandomInt(0,N.length-1);N.splice(B,1),k.push(B)}k.sort((function(t,r){return t-r})),k.forEach((function(r){var o=getRandomInt(0,1)||-1,a=getRandomNumber(y.min,y.max),l=getRandomNumber(x.min,x.max),g=getRandomNumber(T.min,T.max),_=getRandomNumber(C.min,C.max),w=getRandomNumber(S.min,S.max),M=new wo.Vector2(t.points[r].x,t.points[r].y),P=O?(new wo.Vector2).subVectors(j,M).length()*g:(new wo.Vector2).subVectors(j,R).length()*g,A=(new wo.Vector2).subVectors(j,M).normalize();A.rotateAround(new wo.Vector2,a*o*(Math.PI/180));var L=A.clone().multiplyScalar(P).add(M),I=createLightningLine({breakingPointsCount:3,wrinklePointsCount:h,breakingPointsOffset:t.breakingPointsOffset*w,origin:new ye(M.x,M.y),target:new ye(L.x,L.y),texture:i,width:t.width*_});I.originPointIndex=r,t.branches.push(I),I.obj.getChildAt(I.obj.children.length-1).alpha=t.obj.alpha*l,t.obj.addChildAt(I.obj,0)}))}function generateLightningPoints(t){var r=t.origin,i=t.target,o=t.breakingPointsCount,a=t.breakingPointsOffset,l=t.wrinklePointsCount,h=t.source||[],g=function getRandomNumberGenerator(t){return{random:random,range:function range(t,r){return random()*(r-t)+t}};function random(){return(2147483647&(t=0|Math.imul(48271,t)))/2147483648}}(t.seed);h.length=0,h.push(new ye(r.x,r.y)),h.push(new ye(i.x,i.y));var y=generateBreakingPoints(o,a,g,r,i);h.splice.apply(h,[1,0].concat(xo()(y)));for(var _=0;_<=o;_++){var x=_+_*l,w=generateBreakingPoints(l,.1*a,g,h[x],h[x+1]);h.splice.apply(h,[x+1,0].concat(xo()(w)))}return h}function generateBreakingPoints(t,r,i,o,a){for(var l=[],h=new wo.Vector2(o.x,o.y),g=new wo.Vector2(a.x,a.y),y=(new wo.Vector2).subVectors(g,h).length(),_=(new wo.Vector2).subVectors(g,h).normalize(),x=new wo.Vector2(_.y,-_.x),w=1;w<=t;w++){var S=y/(t+1)*w,M=r>.5*y?.5*y:r,T=_.clone().multiplyScalar(S).add(h),P=i.range(-M,M),C=x.clone().multiplyScalar(P);T.add(C),l.push(new ye(T.x,T.y))}return l}function generateLightningSeed(){return Math.floor(1e6*Math.random())}function movePiece(t,r){var i=r.piece,o=r.from,a=r.to,l=t.animator,h=t.extraTextures,g=t.scene,y=t.squareSize;i.obj.angle=0,updatePieceSize(t,i),delete i.obj.filters;var x=1===i.info.color?h.lightningBlue:h.lightningRed,w=function createLightning(t){var r=createLightningLine(t);if(t.branchesLevels){var i=[r];t.branchesLevels.forEach((function(t){var r=[];i.forEach((function(i){createLightningBranches(i,t),r.push.apply(r,xo()(i.branches))})),i=r}))}return r.branchesLevelsParams=t.branchesLevels,r}({breakingPointsCount:3,breakingPointsOffset:.25*y,origin:new ye(i.obj.position.x,i.obj.position.y),target:new ye(o.x,o.y),texture:x,width:.25*y});return g.addChild(w.obj),elevatePiece(i),l.play({data:{lightning:w},duration:400,easing:_.a,keyframes:{0:{lightningBreakingPointsOffset:0,lightningTargetX:o.x,lightningTargetY:o.y,x:o.x,y:o.y},30:{lightningTargetX:o.x,lightningTargetY:o.y},60:{lightningBreakingPointsOffset:w.breakingPointsOffset,lightningTargetX:o.x+(a.x-o.x)/4,lightningTargetY:o.y+(a.y-o.y)/4,x:a.x,y:a.y},100:{lightningBreakingPointsOffset:0,lightningTargetX:a.x,lightningTargetY:a.y,x:a.x,y:a.y}},onEnd:function onEnd(r){return function onPieceMoveEnd(t,r){var i=r.data.lightning;t.scene.removeChild(i.obj)}(t,r)},onUpdate:onPieceMoveUpdate,target:i.obj.position})}function onPieceMoveUpdate(t){var r=t.data.lightning,i=t.animatedProps,o=i.x,a=i.y,l=i.lightningTargetX,h=i.lightningTargetY,g=i.lightningBreakingPointsOffset,y=t.frameInfo.deltaTime,_=new ye(o,a),x=new ye(l,h);r.breakingPointsOffset=g,function updateLightningOrigin(t,r){t.points[0].x=r.x,t.points[0].y=r.y}(r,_),function updateLightningTarget(t,r){var i=t.points[t.points.length-1];i.x=r.x,i.y=r.y}(r,x),function regenerateLightning(t){generateLightningPoints({breakingPointsCount:t.breakingPointsCount,breakingPointsOffset:t.breakingPointsOffset,wrinklePointsCount:t.wrinklePointsCount,origin:t.points[0],seed:t.seed,source:t.points,target:t.points[t.points.length-1]})}(r),animateLightning(r,{deltaTime:y})}function showHighlightedSquare(t,r){return t.animator.play({duration:150,easing:_.e,keyframes:{0:{alpha:0},100:{alpha:r.obj.alpha}},target:r.obj})}function show_hover_square_showHoverSquare(t,r){var i=t.selectedPiece,o=t.hoverSquare;o&&(o.visible=!0,o.position.x=r.x,o.position.y=r.y,i&&i.info.color===Xi.a.ColorsAsNumbers.Black?o.tint=16711680:o.tint=56063)}function showHint(t,r){return t.animator.play({duration:80,easing:_.e,keyframes:{0:{height:0,width:0},100:{height:r.obj.height,width:r.obj.width}},target:r.obj})}function attackKing(t,r){var i=t.squareSize*bo.AttackedKing.JiggleRatio,o=r.obj.position.x;return t.animator.play({duration:bo.AttackedKing.Duration,keyframes:{0:{x:o},15:{x:o+i},30:{x:o},45:{x:o-.6*i},60:{x:o},80:{x:o+.3*i},100:{x:o}},repeat:2,repeatDelay:1e3,target:r.obj.position})}function blink_square_blinkSquare(t,r){var i=r.square,o=r.interval,a=r.times;return t.animator.play({duration:o,easing:_.c,keyframes:{0:{alpha:0},50:{alpha:1},100:{alpha:0}},repeat:a,target:i.obj})}function capturePiece(t,r){var i=r.piece,o=.6*(r.fromDrop?40:bo.PieceMove.Duration);return t.animator.play({delay:o,duration:200,keyframes:{0:{alpha:i.obj.alpha},100:{alpha:0}},target:i.obj})}function drag_piece_dragPiece(t,r){var i=t.squareSize;return elevatePiece(r),r.obj.height*=bo.PieceDrag.Scale,r.obj.width*=bo.PieceDrag.Scale,r.obj.filters=[new Ji({alpha:.4,blur:.8,distance:.08*i,resolution:Ki.a.PixelRatio})],t.animator.play({data:{lastPositionX:r.obj.position.x,piece:r},onUpdate:onDraggedPieceUpdate})}function onDraggedPieceUpdate(t){var r=t.data,i=r.piece,o=r.lastPositionX,a=t.frameInfo.deltaTime,l=i.obj.position.x,h=l-o,g=Object(fo.a)(bo.PieceDrag.DragStrength*h*a,{max:bo.PieceDrag.MaxRotation,min:-bo.PieceDrag.MaxRotation});i.obj.angle=interpolateLinearly({from:i.obj.angle,to:g,alpha:bo.PieceDrag.RotationSpeed*a}),r.lastPositionX=l}!function(t){var r;!function(t){t.Duration=250,t.JiggleRatio=.1}(t.AttackedKing||(t.AttackedKing={})),function(t){t.Scale=1.1,t.DragStrength=100,t.MaxRotation=60,t.RotationSpeed=20}(r=t.PieceDrag||(t.PieceDrag={})),function(t){t.Duration=300,t.Scale=r.Scale,function(t){t[t.Blur=.8]="Blur",t[t.Opacity=.4]="Opacity",t[t.SizeRatio=.08]="SizeRatio"}(t.Shadow||(t.Shadow={}))}(t.PieceMove||(t.PieceMove={})),function(t){t.ArcRatio=.5}(t.RookMove||(t.RookMove={})),function(t){t.Duration=250}(t.CustomItem||(t.CustomItem={})),function(t){t.Duration=150}(t.HighlightedSquare||(t.HighlightedSquare={})),function(t){t.Duration=80}(t.Hint||(t.Hint={})),function(t){t[t.Duration=150]="Duration"}(t.PromotionWindow||(t.PromotionWindow={}))}(bo||(bo={}));var So,Mo,Eo,To=function(){function PropertyNode(t,r,i){this.value=t,this.time=r,this.next=null,this.isStepped=!1,this.ease=i?"function"==typeof i?i:Mo.generateEase(i):null}return PropertyNode.createList=function(t){if("list"in t){var r=t.list,i=void 0,o=void 0,a=r[0],l=a.value,h=a.time;if(o=i=new PropertyNode("string"==typeof l?Mo.hexToRGB(l):l,h,t.ease),r.length>2||2===r.length&&r[1].value!==l)for(var g=1;g<r.length;++g){var y=r[g],_=y.value,x=y.time;i.next=new PropertyNode("string"==typeof _?Mo.hexToRGB(_):_,x),i=i.next}return o.isStepped=!!t.isStepped,o}var w=new PropertyNode("string"==typeof t.start?Mo.hexToRGB(t.start):t.start,0);return t.end!==t.start&&(w.next=new PropertyNode("string"==typeof t.end?Mo.hexToRGB(t.end):t.end,1)),w},PropertyNode}(),Po=h;function GetTextureFromString(t){return So(t)}So=parseInt(/^(\d+)\./.exec(qi)[1])<5?Po.Texture.fromImage:Po.Texture.from,(Eo=Mo||(Mo={})).verbose=!1,Eo.DEG_TO_RADS=Math.PI/180,Eo.rotatePoint=function rotatePoint(t,r){if(t){t*=Eo.DEG_TO_RADS;var i=Math.sin(t),o=Math.cos(t),a=r.x*o-r.y*i,l=r.x*i+r.y*o;r.x=a,r.y=l}},Eo.combineRGBComponents=function combineRGBComponents(t,r,i){return t<<16|r<<8|i},Eo.normalize=function normalize(t){var r=1/Eo.length(t);t.x*=r,t.y*=r},Eo.scaleBy=function scaleBy(t,r){t.x*=r,t.y*=r},Eo.length=function length(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Eo.hexToRGB=function hexToRGB(t,r){var i;return r||(r={}),"#"==t.charAt(0)?t=t.substr(1):0===t.indexOf("0x")&&(t=t.substr(2)),8==t.length&&(i=t.substr(0,2),t=t.substr(2)),r.r=parseInt(t.substr(0,2),16),r.g=parseInt(t.substr(2,2),16),r.b=parseInt(t.substr(4,2),16),i&&(r.a=parseInt(i,16)),r},Eo.generateEase=function generateEase(t){var r=t.length,i=1/r;return function(o){var a,l,h=r*o|0;return a=(o-h*i)*r,(l=t[h]||t[r-1]).s+a*(2*(1-a)*(l.cp-l.s)+a*(l.e-l.s))}},Eo.getBlendMode=function getBlendMode(t){if(!t)return G.NORMAL;for(t=t.toUpperCase();t.indexOf(" ")>=0;)t=t.replace(" ","_");return G[t]||G.NORMAL},Eo.createSteppedGradient=function createSteppedGradient(t,r){void 0===r&&(r=10),("number"!=typeof r||r<=0)&&(r=10);var i=new To(Eo.hexToRGB(t[0].value),t[0].time);i.isStepped=!0;for(var o=i,a=t[0],l=1,h=t[l],g=1;g<r;++g){for(var y=g/r;y>h.time;)a=h,h=t[++l];y=(y-a.time)/(h.time-a.time);var _=Eo.hexToRGB(a.value),x=Eo.hexToRGB(h.value),w={r:(x.r-_.r)*y+_.r,g:(x.g-_.g)*y+_.g,b:(x.b-_.b)*y+_.b};o.next=new To(w,g/r),o=o.next}return i};var extendStatics=function(t,r){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(t,r)};function __extends(t,r){function __(){this.constructor=t}extendStatics(t,r),t.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}var Co=function(){function PropertyList(t){void 0===t&&(t=!1),this.current=null,this.next=null,this.isColor=!!t,this.interpolate=null,this.ease=null}return PropertyList.prototype.reset=function(t){this.current=t,this.next=t.next,this.next&&this.next.time>=1?this.interpolate=this.isColor?intColorSimple:intValueSimple:t.isStepped?this.interpolate=this.isColor?intColorStepped:intValueStepped:this.interpolate=this.isColor?intColorComplex:intValueComplex,this.ease=this.current.ease},PropertyList}();function intValueSimple(t){return this.ease&&(t=this.ease(t)),(this.next.value-this.current.value)*t+this.current.value}function intColorSimple(t){this.ease&&(t=this.ease(t));var r=this.current.value,i=this.next.value,o=(i.r-r.r)*t+r.r,a=(i.g-r.g)*t+r.g,l=(i.b-r.b)*t+r.b;return Mo.combineRGBComponents(o,a,l)}function intValueComplex(t){for(this.ease&&(t=this.ease(t));t>this.next.time;)this.current=this.next,this.next=this.next.next;return t=(t-this.current.time)/(this.next.time-this.current.time),(this.next.value-this.current.value)*t+this.current.value}function intColorComplex(t){for(this.ease&&(t=this.ease(t));t>this.next.time;)this.current=this.next,this.next=this.next.next;t=(t-this.current.time)/(this.next.time-this.current.time);var r=this.current.value,i=this.next.value,o=(i.r-r.r)*t+r.r,a=(i.g-r.g)*t+r.g,l=(i.b-r.b)*t+r.b;return Mo.combineRGBComponents(o,a,l)}function intValueStepped(t){for(this.ease&&(t=this.ease(t));this.next&&t>this.next.time;)this.current=this.next,this.next=this.next.next;return this.current.value}function intColorStepped(t){for(this.ease&&(t=this.ease(t));this.next&&t>this.next.time;)this.current=this.next,this.next=this.next.next;var r=this.current.value;return Mo.combineRGBComponents(r.r,r.g,r.b)}var Ao,Oo=function(t){function Particle(r){var i=t.call(this)||this;return i.emitter=r,i.anchor.x=i.anchor.y=.5,i.velocity=new ye,i.rotationSpeed=0,i.rotationAcceleration=0,i.maxLife=0,i.age=0,i.ease=null,i.extraData=null,i.alphaList=new Co,i.speedList=new Co,i.speedMultiplier=1,i.acceleration=new ye,i.maxSpeed=NaN,i.scaleList=new Co,i.scaleMultiplier=1,i.colorList=new Co(!0),i._doAlpha=!1,i._doScale=!1,i._doSpeed=!1,i._doAcceleration=!1,i._doColor=!1,i._doNormalMovement=!1,i._oneOverLife=0,i.next=null,i.prev=null,i.init=i.init,i.Particle_init=Particle.prototype.init,i.update=i.update,i.Particle_update=Particle.prototype.update,i.Sprite_destroy=t.prototype.destroy,i.Particle_destroy=Particle.prototype.destroy,i.applyArt=i.applyArt,i.kill=i.kill,i}return __extends(Particle,t),Particle.prototype.init=function(){this.age=0,this.velocity.x=this.speedList.current.value*this.speedMultiplier,this.velocity.y=0,Mo.rotatePoint(this.rotation,this.velocity),this.noRotation?this.rotation=0:this.rotation*=Mo.DEG_TO_RADS,this.rotationSpeed*=Mo.DEG_TO_RADS,this.rotationAcceleration*=Mo.DEG_TO_RADS,this.alpha=this.alphaList.current.value,this.scale.x=this.scale.y=this.scaleList.current.value,this._doAlpha=!!this.alphaList.current.next,this._doSpeed=!!this.speedList.current.next,this._doScale=!!this.scaleList.current.next,this._doColor=!!this.colorList.current.next,this._doAcceleration=0!==this.acceleration.x||0!==this.acceleration.y,this._doNormalMovement=this._doSpeed||0!==this.speedList.current.value||this._doAcceleration,this._oneOverLife=1/this.maxLife;var t=this.colorList.current.value;this.tint=Mo.combineRGBComponents(t.r,t.g,t.b),this.visible=!0},Particle.prototype.applyArt=function(t){this.texture=t||Et.EMPTY},Particle.prototype.update=function(t){if(this.age+=t,this.age>=this.maxLife||this.age<0)return this.kill(),-1;var r=this.age*this._oneOverLife;if(this.ease&&(r=4==this.ease.length?this.ease(r,0,1,1):this.ease(r)),this._doAlpha&&(this.alpha=this.alphaList.interpolate(r)),this._doScale){var i=this.scaleList.interpolate(r)*this.scaleMultiplier;this.scale.x=this.scale.y=i}if(this._doNormalMovement){var o=void 0,a=void 0;if(this._doSpeed){var l=this.speedList.interpolate(r)*this.speedMultiplier;Mo.normalize(this.velocity),Mo.scaleBy(this.velocity,l),o=this.velocity.x*t,a=this.velocity.y*t}else if(this._doAcceleration){var h=this.velocity.x,g=this.velocity.y;if(this.velocity.x+=this.acceleration.x*t,this.velocity.y+=this.acceleration.y*t,this.maxSpeed){var y=Mo.length(this.velocity);y>this.maxSpeed&&Mo.scaleBy(this.velocity,this.maxSpeed/y)}o=(h+this.velocity.x)/2*t,a=(g+this.velocity.y)/2*t}else o=this.velocity.x*t,a=this.velocity.y*t;this.position.x+=o,this.position.y+=a}if(this._doColor&&(this.tint=this.colorList.interpolate(r)),0!==this.rotationAcceleration){var _=this.rotationSpeed+this.rotationAcceleration*t;this.rotation+=(this.rotationSpeed+_)/2*t,this.rotationSpeed=_}else 0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*t:this.acceleration&&!this.noRotation&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x));return r},Particle.prototype.kill=function(){this.emitter.recycle(this)},Particle.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this.Sprite_destroy(),this.emitter=this.velocity=this.colorList=this.scaleList=this.alphaList=this.speedList=this.ease=this.next=this.prev=null},Particle.parseArt=function(t){var r;for(r=t.length;r>=0;--r)"string"==typeof t[r]&&(t[r]=GetTextureFromString(t[r]));if(Mo.verbose)for(r=t.length-1;r>0;--r)if(t[r].baseTexture!=t[r-1].baseTexture){window.console&&console.warn("PixiParticles: using particle textures from different images may hinder performance in WebGL");break}return t},Particle.parseData=function(t){return t},Particle}(Zr),Lo=function(){function PolygonalChain(t){this.segments=[],this.countingLengths=[],this.totalLength=0,this.init(t)}return PolygonalChain.prototype.init=function(t){if(t&&t.length)if(Array.isArray(t[0]))for(var r=0;r<t.length;++r)for(var i=t[r],o=i[0],a=1;a<i.length;++a){var l=i[a];this.segments.push({p1:o,p2:l,l:0}),o=l}else for(o=t[0],r=1;r<t.length;++r){l=t[r];this.segments.push({p1:o,p2:l,l:0}),o=l}else this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0});for(r=0;r<this.segments.length;++r){var h=this.segments[r],g=h.p1,y=h.p2,_=Math.sqrt((y.x-g.x)*(y.x-g.x)+(y.y-g.y)*(y.y-g.y));this.segments[r].l=_,this.totalLength+=_,this.countingLengths.push(this.totalLength)}},PolygonalChain.prototype.getRandomPoint=function(t){var r,i,o=Math.random()*this.totalLength;if(1===this.segments.length)r=this.segments[0],i=o;else for(var a=0;a<this.countingLengths.length;++a)if(o<this.countingLengths[a]){r=this.segments[a],i=0===a?o:o-this.countingLengths[a-1];break}i/=r.l||1;var l=r.p1,h=r.p2;t.x=l.x+i*(h.x-l.x),t.y=l.y+i*(h.y-l.y)},PolygonalChain}(),Io=h;Ao=parseInt(/^(\d+)\./.exec(qi)[1])<5?Io.ticker.shared:Io.Ticker.shared;var Ro=new ye,jo=function(){function Emitter(t,r,i){this._currentImageIndex=-1,this._particleConstructor=Oo,this.particleImages=null,this.startAlpha=null,this.startSpeed=null,this.minimumSpeedMultiplier=1,this.acceleration=null,this.maxSpeed=NaN,this.startScale=null,this.minimumScaleMultiplier=1,this.startColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.noRotation=!1,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this._frequency=1,this.spawnChance=1,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.spawnPolygonalChain=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this._parent=null,this.addAtBack=!1,this.particleCount=0,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticlesFirst=null,this._activeParticlesLast=null,this._poolFirst=null,this._origConfig=null,this._origArt=null,this._autoUpdate=!1,this._currentImageIndex=-1,this._destroyWhenComplete=!1,this._completeCallback=null,this.parent=t,r&&i&&this.init(r,i),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos}return Object.defineProperty(Emitter.prototype,"orderedArt",{get:function(){return-1!==this._currentImageIndex},set:function(t){this._currentImageIndex=t?0:-1},enumerable:!0,configurable:!0}),Object.defineProperty(Emitter.prototype,"frequency",{get:function(){return this._frequency},set:function(t){this._frequency="number"==typeof t&&t>0?t:1},enumerable:!0,configurable:!0}),Object.defineProperty(Emitter.prototype,"particleConstructor",{get:function(){return this._particleConstructor},set:function(t){if(t!=this._particleConstructor){this._particleConstructor=t,this.cleanup();for(var r=this._poolFirst;r;r=r.next)r.destroy();this._poolFirst=null,this._origConfig&&this._origArt&&this.init(this._origArt,this._origConfig)}},enumerable:!0,configurable:!0}),Object.defineProperty(Emitter.prototype,"parent",{get:function(){return this._parent},set:function(t){this.cleanup(),this._parent=t},enumerable:!0,configurable:!0}),Emitter.prototype.init=function(t,r){if(t&&r){this.cleanup(),this._origConfig=r,this._origArt=t,t=Array.isArray(t)?t.slice():[t];var i=this._particleConstructor;this.particleImages=i.parseArt?i.parseArt(t):t,r.alpha?this.startAlpha=To.createList(r.alpha):this.startAlpha=new To(1,0),r.speed?(this.startSpeed=To.createList(r.speed),this.minimumSpeedMultiplier=("minimumSpeedMultiplier"in r?r.minimumSpeedMultiplier:r.speed.minimumSpeedMultiplier)||1):(this.minimumSpeedMultiplier=1,this.startSpeed=new To(0,0));var o=r.acceleration;o&&(o.x||o.y)?(this.startSpeed.next=null,this.acceleration=new ye(o.x,o.y),this.maxSpeed=r.maxSpeed||NaN):this.acceleration=new ye,r.scale?(this.startScale=To.createList(r.scale),this.minimumScaleMultiplier=("minimumScaleMultiplier"in r?r.minimumScaleMultiplier:r.scale.minimumScaleMultiplier)||1):(this.startScale=new To(1,0),this.minimumScaleMultiplier=1),r.color?this.startColor=To.createList(r.color):this.startColor=new To({r:255,g:255,b:255},0),r.startRotation?(this.minStartRotation=r.startRotation.min,this.maxStartRotation=r.startRotation.max):this.minStartRotation=this.maxStartRotation=0,r.noRotation&&(this.minStartRotation||this.maxStartRotation)?this.noRotation=!!r.noRotation:this.noRotation=!1,r.rotationSpeed?(this.minRotationSpeed=r.rotationSpeed.min,this.maxRotationSpeed=r.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.rotationAcceleration=r.rotationAcceleration||0,this.minLifetime=r.lifetime.min,this.maxLifetime=r.lifetime.max,this.particleBlendMode=Mo.getBlendMode(r.blendMode),r.ease?this.customEase="function"==typeof r.ease?r.ease:Mo.generateEase(r.ease):this.customEase=null,i.parseData?this.extraData=i.parseData(r.extraData):this.extraData=r.extraData||null,this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,r.particlesPerWave&&r.particlesPerWave>1&&(this.particlesPerWave=r.particlesPerWave),this.particleSpacing=0,this.angleStart=0,this.parseSpawnType(r),this.frequency=r.frequency,this.spawnChance="number"==typeof r.spawnChance&&r.spawnChance>0?r.spawnChance:1,this.emitterLifetime=r.emitterLifetime||-1,this.maxParticles=r.maxParticles>0?r.maxParticles:1e3,this.addAtBack=!!r.addAtBack,this.rotation=0,this.ownerPos=new ye,this.spawnPos=new ye(r.pos.x,r.pos.y),this.initAdditional(t,r),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=void 0===r.emit||!!r.emit,this.autoUpdate=!!r.autoUpdate,this.orderedArt=!!r.orderedArt}},Emitter.prototype.initAdditional=function(t,r){},Emitter.prototype.parseSpawnType=function(t){var r;switch(t.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var i=t.spawnRect;this.spawnRect=new Re(i.x,i.y,i.w,i.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle,r=t.spawnCircle,this.spawnCircle=new je(r.x,r.y,r.r);break;case"ring":this.spawnType="ring",this._spawnFunc=this._spawnRing,r=t.spawnCircle,this.spawnCircle=new je(r.x,r.y,r.r),this.spawnCircle.minRadius=r.minR;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particleSpacing=t.particleSpacing,this.angleStart=t.angleStart?t.angleStart:0;break;case"point":this.spawnType="point",this._spawnFunc=this._spawnPoint;break;case"polygonalChain":this.spawnType="polygonalChain",this._spawnFunc=this._spawnPolygonalChain,this.spawnPolygonalChain=new Lo(t.spawnPolygon);break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}},Emitter.prototype.recycle=function(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t==this._activeParticlesLast&&(this._activeParticlesLast=t.prev),t==this._activeParticlesFirst&&(this._activeParticlesFirst=t.next),t.prev=null,t.next=this._poolFirst,this._poolFirst=t,t.parent&&t.parent.removeChild(t),--this.particleCount},Emitter.prototype.rotate=function(t){if(this.rotation!=t){var r=t-this.rotation;this.rotation=t,Mo.rotatePoint(r,this.spawnPos),this._posChanged=!0}},Emitter.prototype.updateSpawnPos=function(t,r){this._posChanged=!0,this.spawnPos.x=t,this.spawnPos.y=r},Emitter.prototype.updateOwnerPos=function(t,r){this._posChanged=!0,this.ownerPos.x=t,this.ownerPos.y=r},Emitter.prototype.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(Emitter.prototype,"emit",{get:function(){return this._emit},set:function(t){this._emit=!!t,this._emitterLife=this.emitterLifetime},enumerable:!0,configurable:!0}),Object.defineProperty(Emitter.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate&&!t?Ao.remove(this.update,this):!this._autoUpdate&&t&&Ao.add(this.update,this),this._autoUpdate=!!t},enumerable:!0,configurable:!0}),Emitter.prototype.playOnceAndDestroy=function(t){this.autoUpdate=!0,this.emit=!0,this._destroyWhenComplete=!0,this._completeCallback=t},Emitter.prototype.playOnce=function(t){this.emit=!0,this._completeCallback=t},Emitter.prototype.update=function(t){if(this._autoUpdate&&(t=t/Q.TARGET_FPMS/1e3),this._parent){var r,i,o,a,l;for(i=this._activeParticlesFirst;i;i=o)o=i.next,i.update(t);this._prevPosIsValid&&(a=this._prevEmitterPos.x,l=this._prevEmitterPos.y);var h=this.ownerPos.x+this.spawnPos.x,g=this.ownerPos.y+this.spawnPos.y;if(this._emit)for(this._spawnTimer-=t<0?0:t;this._spawnTimer<=0;){if(this._emitterLife>0&&(this._emitterLife-=this._frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this.particleCount>=this.maxParticles)this._spawnTimer+=this._frequency;else{var y=void 0;if(y=this.minLifetime==this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer<y){var _=void 0,x=void 0;if(this._prevPosIsValid&&this._posChanged){var w=1+this._spawnTimer/t;_=(h-a)*w+a,x=(g-l)*w+l}else _=h,x=g;r=0;for(var S=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount);r<S;++r)if(!(this.spawnChance<1&&Math.random()>=this.spawnChance)){var M=void 0;if(this._poolFirst?(M=this._poolFirst,this._poolFirst=this._poolFirst.next,M.next=null):M=new this.particleConstructor(this),this.particleImages.length>1?-1!==this._currentImageIndex?(M.applyArt(this.particleImages[this._currentImageIndex++]),(this._currentImageIndex<0||this._currentImageIndex>=this.particleImages.length)&&(this._currentImageIndex=0)):M.applyArt(this.particleImages[Math.floor(Math.random()*this.particleImages.length)]):M.applyArt(this.particleImages[0]),M.alphaList.reset(this.startAlpha),1!=this.minimumSpeedMultiplier&&(M.speedMultiplier=Math.random()*(1-this.minimumSpeedMultiplier)+this.minimumSpeedMultiplier),M.speedList.reset(this.startSpeed),M.acceleration.x=this.acceleration.x,M.acceleration.y=this.acceleration.y,M.maxSpeed=this.maxSpeed,1!=this.minimumScaleMultiplier&&(M.scaleMultiplier=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier),M.scaleList.reset(this.startScale),M.colorList.reset(this.startColor),this.minRotationSpeed==this.maxRotationSpeed?M.rotationSpeed=this.minRotationSpeed:M.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,M.rotationAcceleration=this.rotationAcceleration,M.noRotation=this.noRotation,M.maxLife=y,M.blendMode=this.particleBlendMode,M.ease=this.customEase,M.extraData=this.extraData,this.applyAdditionalProperties(M),this._spawnFunc(M,_,x,r),M.init(),M.update(-this._spawnTimer),M.parent){var T=this._parent.children;if(T[0]==M)T.shift();else if(T[T.length-1]==M)T.pop();else{var P=T.indexOf(M);T.splice(P,1)}this.addAtBack?T.unshift(M):T.push(M)}else this.addAtBack?this._parent.addChildAt(M,0):this._parent.addChild(M);this._activeParticlesLast?(this._activeParticlesLast.next=M,M.prev=this._activeParticlesLast,this._activeParticlesLast=M):this._activeParticlesLast=this._activeParticlesFirst=M,++this.particleCount}}this._spawnTimer+=this._frequency}}if(this._posChanged&&(this._prevEmitterPos.x=h,this._prevEmitterPos.y=g,this._prevPosIsValid=!0,this._posChanged=!1),!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){var C=this._completeCallback;this._completeCallback=null,C()}this._destroyWhenComplete&&this.destroy()}}},Emitter.prototype.applyAdditionalProperties=function(t){},Emitter.prototype._spawnPoint=function(t,r,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,t.position.x=r,t.position.y=i},Emitter.prototype._spawnRect=function(t,r,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,Ro.x=Math.random()*this.spawnRect.width+this.spawnRect.x,Ro.y=Math.random()*this.spawnRect.height+this.spawnRect.y,0!==this.rotation&&Mo.rotatePoint(this.rotation,Ro),t.position.x=r+Ro.x,t.position.y=i+Ro.y},Emitter.prototype._spawnCircle=function(t,r,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,Ro.x=Math.random()*this.spawnCircle.radius,Ro.y=0,Mo.rotatePoint(360*Math.random(),Ro),Ro.x+=this.spawnCircle.x,Ro.y+=this.spawnCircle.y,0!==this.rotation&&Mo.rotatePoint(this.rotation,Ro),t.position.x=r+Ro.x,t.position.y=i+Ro.y},Emitter.prototype._spawnRing=function(t,r,i){var o=this.spawnCircle;this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,o.minRadius!==o.radius?Ro.x=Math.random()*(o.radius-o.minRadius)+o.minRadius:Ro.x=o.radius,Ro.y=0;var a=360*Math.random();t.rotation+=a,Mo.rotatePoint(a,Ro),Ro.x+=this.spawnCircle.x,Ro.y+=this.spawnCircle.y,0!==this.rotation&&Mo.rotatePoint(this.rotation,Ro),t.position.x=r+Ro.x,t.position.y=i+Ro.y},Emitter.prototype._spawnPolygonalChain=function(t,r,i){this.minStartRotation==this.maxStartRotation?t.rotation=this.minStartRotation+this.rotation:t.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,this.spawnPolygonalChain.getRandomPoint(Ro),0!==this.rotation&&Mo.rotatePoint(this.rotation,Ro),t.position.x=r+Ro.x,t.position.y=i+Ro.y},Emitter.prototype._spawnBurst=function(t,r,i,o){0===this.particleSpacing?t.rotation=360*Math.random():t.rotation=this.angleStart+this.particleSpacing*o+this.rotation,t.position.x=r,t.position.y=i},Emitter.prototype.cleanup=function(){var t,r;for(t=this._activeParticlesFirst;t;t=r)r=t.next,this.recycle(t),t.parent&&t.parent.removeChild(t);this._activeParticlesFirst=this._activeParticlesLast=null,this.particleCount=0},Emitter.prototype.destroy=function(){var t;this.autoUpdate=!1,this.cleanup();for(var r=this._poolFirst;r;r=t)t=r.next,r.destroy();this._poolFirst=this._parent=this.particleImages=this.spawnPos=this.ownerPos=this.startColor=this.startScale=this.startAlpha=this.startSpeed=this.customEase=this._completeCallback=null},Emitter}(),No=new ye,ko=["pow","sqrt","abs","floor","round","ceil","E","PI","sin","cos","tan","asin","acos","atan","atan2","log"],Do=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(ko).join("|"),"g");(function(t){function PathParticle(r){var i=t.call(this,r)||this;return i.path=null,i.initialRotation=0,i.initialPosition=new ye,i.movement=0,i}__extends(PathParticle,t),PathParticle.prototype.init=function(){this.initialRotation=this.rotation,this.Particle_init(),this.path=this.extraData.path,this._doNormalMovement=!this.path,this.movement=0,this.initialPosition.x=this.position.x,this.initialPosition.y=this.position.y},PathParticle.prototype.update=function(t){var r=this.Particle_update(t);if(r>=0&&this.path){var i=this.speedList.interpolate(r)*this.speedMultiplier;this.movement+=i*t,No.x=this.movement,No.y=this.path(this.movement),Mo.rotatePoint(this.initialRotation,No),this.position.x=this.initialPosition.x+No.x,this.position.y=this.initialPosition.y+No.y}return r},PathParticle.prototype.destroy=function(){this.Particle_destroy(),this.path=this.initialPosition=null},PathParticle.parseArt=function(t){return Oo.parseArt(t)},PathParticle.parseData=function(t){var r={};if(t&&t.path)try{r.path=function(t){for(var r=t.match(Do),i=r.length-1;i>=0;--i)ko.indexOf(r[i])>=0&&(r[i]="Math."+r[i]);return t=r.join(""),new Function("x","return "+t+";")}(t.path)}catch(i){Mo.verbose&&console.error("PathParticle: error in parsing path expression"),r.path=null}else Mo.verbose&&console.error("PathParticle requires a path string in extraData!"),r.path=null;return r}})(Oo),function(t){function AnimatedParticle(r){var i=t.call(this,r)||this;return i.textures=null,i.duration=0,i.framerate=0,i.elapsed=0,i.loop=!1,i}__extends(AnimatedParticle,t),AnimatedParticle.prototype.init=function(){this.Particle_init(),this.elapsed=0,this.framerate<0&&(this.duration=this.maxLife,this.framerate=this.textures.length/this.duration)},AnimatedParticle.prototype.applyArt=function(t){this.textures=t.textures,this.framerate=t.framerate,this.duration=t.duration,this.loop=t.loop},AnimatedParticle.prototype.update=function(t){var r=this.Particle_update(t);if(r>=0){this.elapsed+=t,this.elapsed>this.duration&&(this.loop?this.elapsed=this.elapsed%this.duration:this.elapsed=this.duration-1e-6);var i=this.elapsed*this.framerate+1e-7|0;this.texture=this.textures[i]||Et.EMPTY}return r},AnimatedParticle.prototype.destroy=function(){this.Particle_destroy(),this.textures=null},AnimatedParticle.parseArt=function(t){for(var r,i,o,a,l,h=[],g=0;g<t.length;++g){r=t[g],h[g]=i={},i.textures=l=[],o=r.textures;for(var y=0;y<o.length;++y)if("string"==typeof(a=o[y]))l.push(GetTextureFromString(a));else if(a instanceof Et)l.push(a);else{var _=a.count||1;for(a="string"==typeof a.texture?GetTextureFromString(a.texture):a.texture;_>0;--_)l.push(a)}"matchLife"==r.framerate?(i.framerate=-1,i.duration=0,i.loop=!1):(i.loop=!!r.loop,i.framerate=r.framerate>0?r.framerate:60,i.duration=l.length/i.framerate)}return h}}(Oo);function animateDust(t){var r=t.animator,i=t.duration,o=t.position,a=t.startColor,l=t.endColor,h=t.squareSize,g=t.particleTextures,y=new Sr,_=g[getRandomInt(0,g.length-1)],x=new jo(y,_,function getDustConfig(t){var r=t.lifeTime,i=t.startColor,o=t.endColor,a=t.squareSize,l=2.5*a,h=.8*l,g=a*getRandomNumber(.002,.004);return{alpha:{end:0,start:1},autoUpdate:!1,color:{end:o,start:i},emit:!0,emitterLifetime:.1,frequency:.001,lifetime:{max:r,min:0},maxParticles:35,pos:{x:0,y:0},scale:{end:.1*g,start:g},spawnCircle:{minR:0*a,r:.1*a,x:0,y:0},spawnType:"ring",speed:{end:h,start:l},startRotation:{max:0,min:0}}}({endColor:l,lifeTime:.001*i,squareSize:h,startColor:a}));return y.position.x=o.x,y.position.y=o.y,r.play({data:{dustContainer:y,dustEmitter:x},duration:i,onEnd:onDustEnd,onUpdate:onDustUpdate}),y}function onDustUpdate(t){var r=t.data,i=t.frameInfo;r.dustEmitter.update(i.deltaTime)}function onDustEnd(t){var r=t.data,i=r.dustContainer;r.dustEmitter.destroy(),i.destroy({children:!0})}function drop_piece_dropPiece(t,r){var i=r.piece,o=r.to,a=r.capturing,l=i.obj,h=l.filters[0],g=t.squareSize,y=l.width/g;return l.angle=0,t.animator.play({data:{capturing:a,shadow:h,state:t},duration:40,keyframes:{0:{height:l.height,shadowDistance:h.distance,width:l.width,x:l.x,y:l.y},100:{height:l.height/y,shadowDistance:0,width:l.width/y,x:o.x,y:o.y}},onEnd:drop_piece_onDroppedPieceEnd,onUpdate:drop_piece_onDroppedPieceUpdate,target:l})}function drop_piece_onDroppedPieceUpdate(t){t.data.shadow.distance=t.animatedProps.shadowDistance}function drop_piece_onDroppedPieceEnd(t){var r=t.params.target,i=t.data.state,o=t.data.capturing,a=i.animator,l=i.scene,h=i.squareSize,g=i.extraTextures,y=i.assetsLoaded;if(delete r.filters,!t.forcedEnd&&y){var _=animateDust({animator:a,duration:o?400:210,endColor:"#ffffff",particleTextures:[g.dust1,g.dust2,g.dust3],position:r.position,squareSize:h,startColor:"#ffffff"});l.addChildAt(_,l.getChildIndex(r)-1)}}function hide_custom_item_hideCustomItem(t,r){return t.animator.play({duration:bo.CustomItem.Duration,keyframes:{0:{alpha:r.obj.alpha,width:r.obj.width,height:r.obj.height},100:{alpha:0,width:2*r.obj.width,height:2*r.obj.height}},target:r.obj})}function hide_highlighted_square_hideHighlightedSquare(t,r){return t.animator.play({duration:bo.HighlightedSquare.Duration,easing:_.e,keyframes:{0:{alpha:r.obj.alpha},100:{alpha:0}},target:r.obj})}function hide_move_hint_hideHint(t,r){return t.animator.play({duration:bo.Hint.Duration,easing:_.e,keyframes:{0:{height:r.obj.height,width:r.obj.width},100:{height:0,width:0}},target:r.obj})}function hidePromotionWindow(t){return t.animator.play({duration:bo.PromotionWindow.Duration,keyframes:{0:{alpha:1},100:{alpha:0}},target:t.promotionWindow})}function load_assets_loadAssets(t){return new Promise((function(r){var i=t.extraTextures,o=Object(yo.a)("two-d/natural"),a=new _r;a.add([{name:"dust1",url:"".concat(o,"/dust-particle1.png")},{name:"dust2",url:"".concat(o,"/dust-particle2.png")},{name:"dust3",url:"".concat(o,"/dust-particle3.png")}]).load((function(){t.destroyed||(i.dust1=a.resources.dust1.texture,i.dust2=a.resources.dust2.texture,i.dust3=a.resources.dust3.texture,a.destroy(),r())}))}))}function move_piece_movePiece(t,r){var i=r.piece,o=r.from,a=r.to,l=r.castling,h=r.capturing,g=t.animator,y=t.squareSize,x=l&&i.info.type===Xi.a.Piece.Types.Rook;i.obj.angle=0,updatePieceSize(t,i),i.obj.filters=[new Ji({alpha:bo.PieceMove.Shadow.Opacity,blur:bo.PieceMove.Shadow.Blur,distance:y*bo.PieceMove.Shadow.SizeRatio,resolution:Ki.a.PixelRatio})];var w=x?function getRookAnimationParams(t,r){var i=r.pieceObj,o=r.from,a=r.to,l=r.capturing,h=getPieceAnimationParams(t,{capturing:l,from:o,pieceObj:i,to:a}),g=h.keyframes[50],y=i.y>i.height,x=i.height*bo.RookMove.ArcRatio*(y?-1:1);return h.easing=_.b,g.y=i.y+x,h}(t,{capturing:h,from:o,pieceObj:i.obj,to:a}):getPieceAnimationParams(t,{capturing:h,from:o,pieceObj:i.obj,to:a});return elevatePiece(i),g.play(w)}function getPieceAnimationParams(t,r){var i=r.pieceObj,o=r.from,a=r.to,l=r.capturing,h=i.filters[0];return{data:{capturing:l,shadow:h,state:t},duration:bo.PieceMove.Duration,easing:_.a,keyframes:{0:{height:i.height,shadowDistance:0,width:i.width,x:o.x,y:o.y},50:{height:i.height*bo.PieceMove.Scale,shadowDistance:h.distance,width:i.width*bo.PieceMove.Scale},100:{height:i.height,shadowDistance:0,width:i.width,x:a.x,y:a.y}},onEnd:onMovedPieceEnd,onUpdate:onMovedPieceUpdate,target:i}}function onMovedPieceUpdate(t){t.data.shadow.distance=t.animatedProps.shadowDistance}function onMovedPieceEnd(t){var r=t.params.target,i=t.data.state,o=t.data.capturing,a=i.animator,l=i.scene,h=i.squareSize,g=i.extraTextures,y=i.assetsLoaded;if(delete r.filters,!t.forcedEnd&&y){var _=animateDust({animator:a,duration:o?400:210,endColor:"#ffffff",particleTextures:[g.dust1,g.dust2,g.dust3],position:r.position,squareSize:h,startColor:"#ffffff"});l.addChildAt(_,l.getChildIndex(r)-1)}}function pieceOut(t,r){var i=t.animator,o=fileRankToPosition(t,Object(io.a)(r.info.square));return i.play({duration:50,easing:_.b,keyframes:{0:{angle:r.obj.angle,x:r.obj.position.x,y:r.obj.position.y},100:{angle:0,x:o.x,y:o.y}},target:r.obj})}function pieceOver(t,r){var i=r.piece,o=r.pointer,a=t.animator,l=t.squareSize;return a.play({data:{isDragging:null!==t.selectedPiece,lastPositionX:i.obj.position.x,origin:{x:i.obj.position.x,y:i.obj.position.y},piece:i,pointer:o,squareSize:l},onUpdate:onPieceOverUpdate})}function onPieceOverUpdate(t){var r=t.data,i=t.frameInfo.deltaTime,o=r.piece,a=r.pointer,l=r.squareSize,h=r.origin,g=r.isDragging,y=o.obj,_=l*(g?.03:.01),x=a.boardPosition.x-h.x,w=a.boardPosition.y-h.y;g&&(x*=-1,w*=-1);var S=h.x+Object(fo.a)(x,{max:_,min:-_}),M=h.y+Object(fo.a)(w,{max:_,min:-_});y.x=interpolateLinearly({from:y.x,to:S,alpha:20*i}),y.y=interpolateLinearly({from:y.y,to:M,alpha:20*i});var T=y.x-r.lastPositionX,P=Object(fo.a)(200*T*i,{max:45,min:-45});o.obj.angle=interpolateLinearly({from:o.obj.angle,to:P,alpha:20*i}),r.lastPositionX=y.x}function restorePiece(t,r){return r.obj.alpha=0,t.animator.play({delay:.6*bo.PieceMove.Duration,duration:200,keyframes:{0:{alpha:0},100:{alpha:1}},target:r.obj})}function show_highlighted_square_showHighlightedSquare(t,r){return t.animator.play({duration:bo.HighlightedSquare.Duration,easing:_.e,keyframes:{0:{alpha:0},100:{alpha:r.obj.alpha}},target:r.obj})}function show_move_hint_showHint(t,r){return t.animator.play({duration:bo.Hint.Duration,easing:_.e,keyframes:{0:{height:0,width:0},100:{height:r.obj.height,width:r.obj.width}},target:r.obj})}function showPromotionWindow(t){return t.animator.play({duration:bo.PromotionWindow.Duration,keyframes:{0:{alpha:0},100:{alpha:1}},target:t.promotionWindow})}function loadAllTextures(t){return new Promise((function(r){Promise.all([loadBoardTexture(t),loadPiecesTextures(t),loadExtraTextures(t)]).then((function(){return r()}))}))}var Bo=i(46);function loadBoardTexture(t){return new Promise((function(r){var i=t.boardStyle,o=t.boardThemes,a="board",l=o[i][2],h=new _r;ut.removeFromCache(a),Et.removeFromCache(a),h.add(a,Object(Bo.a)(l,256)).load((function(){t.destroyed||(t.boardTexture&&t.boardTexture.destroy(!0),t.boardTexture=h.resources.board.texture,t.boardObj.texture=t.boardTexture,h.destroy(),r())}))}))}function loadExtraTextures(t){return new Promise((function(r){var i=t.extraTextures,o=t.hoverSquare,a=Object(yo.a)("two-d"),l=new _r;l.add([{name:"hoverSquare",url:"".concat(a,"/hover-square.png")}]).load((function(){t.destroyed||(i.hoverSquare=l.resources.hoverSquare.texture,o&&(o.texture=i.hoverSquare),l.destroy(),r())}))}))}var Fo,Go=i(41);function loadPiecesTextures(t){return new Promise((function(r){var i=t.pieceStyle,o=t.pieceThemes,a=["wp","wn","wb","wr","wq","wk","bp","bn","bb","br","bq","bk"],l=Object(Go.a)(o[i].path,256),h=new _r,g=a.map((function(t){return ut.removeFromCache(t),Et.removeFromCache(t),{name:t,url:"".concat(l,"/").concat(t,".png")}}));h.add(g).load((function(){t.destroyed||(a.forEach((function(r){t.piecesTextures[r]&&t.piecesTextures[r].destroy(!0),t.piecesTextures[r]=h.resources[r].texture})),h.destroy(),r())}))}))}function closePromotionWindow(t){t.promotionWindow&&t.scene.removeChild(t.promotionWindow),t.promotionWindow=null}function createPromotionWindow(t,r){var i=r.color,o=r.squareOffset,a=r.top,l=t.scene,h=t.squareSize,g=t.boardOffset,y=.5*h,_=[Xi.a.Piece.Types.Queen,Xi.a.Piece.Types.Knight,Xi.a.Piece.Types.Rook,Xi.a.Piece.Types.Bishop];a||_.reverse();var x=function createContainer(){var t=new Ge;return t.filters=[new Ji({alpha:.45,blur:3,distance:4,resolution:Ki.a.PixelRatio})],t}(),w=function createBackground(t,r){var i=new Xr;return i.beginFill(16777215),i.drawRoundedRect(0,0,t,4*t+r,3),i}(h,y),S=function createCloseButton(t){var r=t.squareSize,i=new Xr,o=.5*r;i.cursor="pointer",i.beginFill(15856113),i.drawRoundedRect(0,0,r,o,3);var a=new ai("B",new ti({fill:9210504,fontFamily:"Chess",fontSize:.65*o}));return a.anchor=new ye(.5,.5),a.position.x=.5*r,a.position.y=.45*o,i.addChild(a),i}(t),M=function createPieces(t,r){var i=r.color,o=r.pieceTypes,a=t.piecesTextures,l=t.squareSize,h=new Ge;return h.name=Fo.PromotionWindow.PiecesContainerName,o.forEach((function(t,r){var o=a["".concat(i).concat(t)],g=o.orig,y=new Zr(o);y.width=l,y.height=l*(g.height/g.width),y.anchor.y=1,y.position.y=l*(r+1),y.cursor="pointer",y.name=t,h.addChild(y)})),h}(t,{color:i,pieceTypes:_});x.addChild(w),x.addChild(S),x.addChild(M),x.position.x=h*o+g.x,a?(S.position.y=4*h,M.position.y=0,x.position.y=g.y):(S.position.y=0,M.position.y=y,x.position.y=4*h-y+g.y),l.addChild(x),t.promotionWindow&&t.scene.removeChild(t.promotionWindow),t.promotionWindow=x}!function(t){!function(t){t.PiecesContainerName="piecesContainer"}(t.PromotionWindow||(t.PromotionWindow={}))}(Fo||(Fo={}));var Ho=i(5),Vo=i(26);function openPromotionWindow(t,r){var i=t.isBoardFlipped,o=t.viewEl,a=Object(io.a)(r.to),l=a.file,h=a.rank,g=Object(vo.a)(r.color),y=i?8-l:l-1,_=i?1===h:8===h,x=new Promise((function(r){t.promotionHandler=r}));return createPromotionWindow(t,{color:g,squareOffset:y,top:_}),o.addEventListener(Ho.b,(function onPromotionWindowInteraction(r){var i=t.isPromotionWindowVisible,a=t.promotionWindow,l=t.promotionHandler,h=Object(Vo.a)(r,o),g=normalizePointer(0,h);if(i&&a){var y=function getPromotionPiece(t,r){var i,o=t.getChildByName(Fo.PromotionWindow.PiecesContainerName);return[Xi.a.Piece.Types.Queen,Xi.a.Piece.Types.Knight,Xi.a.Piece.Types.Rook,Xi.a.Piece.Types.Bishop].forEach((function(t){var a=o.getChildByName(t).getBounds(!0);r.x>a.x&&r.x<a.x+a.width&&r.y>a.y&&r.y<a.y+a.height&&(i=t)})),i}(a,g);l(y),r.stopPropagation()}o.removeEventListener(Ho.b,onPromotionWindowInteraction)})),x}function onPointerDown(t){var r=t.containerEl,i=t.isPromotionWindowVisible,o=t.pointer;i||findPieceFromPosition(t,o.boardPosition)&&r.classList.add("piece-dragging")}function onPointerMove(t){var r=t.containerEl,i=t.isPromotionWindowVisible,o=t.pointer,a=t.selectedPiece;if(!i){var l=findPieceFromPosition(t,o.boardPosition);!a&&l?r.classList.add("piece-hover"):a||r.classList.remove("piece-hover")}}function onPointerUp(t){var r=t.containerEl,i=t.isPromotionWindowVisible;t.options.enabled&&!i&&r.classList.remove("piece-dragging")}var Uo=i(20);function createWebGLRenderer2D(t){var r=t.el,i=t.options,o=t.boardStyles,a=void 0===o?Uo.a:o,l=t.pieceStyles,h=void 0===l?Uo.b:l,_=t.testElement,x={animationMethods:i.animationType===to.a.Animation.Types.Arcade?g:y,boardThemes:a,pieceThemes:h,className:"board-webgl-2d",containerEl:r,methods:{addAnalysisOverlay:addAnalysisOverlay,addArrow:addArrow,addCustomItem:addCustomItem,addEffect:addEffect,addHighlightedSquare:addHighlightedSquare,addHint:addHint,addPiece:addPiece,closePromotionWindow:closePromotionWindow,createArrowObj:createArrowObj,createCaptureHintObj:createCaptureHintObj,createCustomItemObj:createCustomItemObj,createEffectObj:createEffectObj,createHighlightedSquareObj:createHighlightedSquareObj,createHoverSquareObj:create_hover_square_obj_createHoverSquareObj,createMoveHintObj:createMoveHintObj,createPieceObj:createPieceObj,createState:createState,destroy:destroy_destroy,fadeInAllPieces:fadeInAllPieces,fileRankToPosition:fileRankToPosition,flipBoard:flipBoard,getBoardPosition:getBoardPosition,getViewPosition:getViewPosition,hideHoverSquare:hideHoverSquare,init:init_init,loadAssets:loadAllTextures,normalizePointer:normalizePointer,onPieceDrop:onPieceDrop,onPieceMoved:onPieceMoved,onPiecesLoaded:onPiecesLoaded,onPiecesVisualsChanged:onPiecesVisualsChanged,onPointerDown:onPointerDown,onPointerMove:onPointerMove,onPointerUp:onPointerUp,openPromotionWindow:openPromotionWindow,positionToFileRank:positionToFileRank,positionToNearestSquare:positionToNearestSquare,removeAnalysisOverlay:removeAnalysisOverlay,removeArrow:removeArrow,removeCustomItem:removeCustomItem,removeEffect:removeEffect,removeHighlightedSquare:removeHighlightedSquare,removeHint:removeHint,removePiece:removePiece,render:render_render,setPiecePosition:setPiecePosition,showHoverSquare:showHoverSquare,updateBoardCoordinates:updateBoardCoordinates,updateBoardStyle:loadBoardTexture,updatePiecesStyle:loadPiecesTextures,updatePieceVisuals:updatePieceVisuals,updateViewSize:updateViewSize},name:"webgl-2d",options:i,testElement:_};return Object(Ki.b)(x)}},function(t,r,i){var o=i(81);function _get(r,i,a){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=_get=Reflect.get:t.exports=_get=function _get(t,r,i){var a=o(t,r);if(a){var l=Object.getOwnPropertyDescriptor(a,r);return l.get?l.get.call(i):l.value}},_get(r,i,a||r)}t.exports=_get},function(t,r,i){(function(o,a){var l;!function(o){var h=o.Promise,g=h&&"resolve"in h&&"reject"in h&&"all"in h&&"race"in h&&function(){var t;return new h((function(r){t=r})),"function"==typeof t}();r?(r.Promise=g?h:Promise,r.Polyfill=Promise):void 0===(l=function(){return g?h:Promise}.call(r,i,r,t))||(t.exports=l);var y="pending",_="sealed",x="fulfilled",w="rejected",NOOP=function(){};function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}var S,M=void 0!==a?a:setTimeout,T=[];function asyncFlush(){for(var t=0;t<T.length;t++)T[t][0](T[t][1]);T=[],S=!1}function asyncCall(t,r){T.push([t,r]),S||(S=!0,M(asyncFlush,0))}function invokeCallback(t){var r=t.owner,i=r.state_,o=r.data_,a=t[i],l=t.then;if("function"==typeof a){i=x;try{o=a(o)}catch(h){reject(l,h)}}handleThenable(l,o)||(i===x&&resolve(l,o),i===w&&reject(l,o))}function handleThenable(t,r){var i;try{if(t===r)throw new TypeError("A promises callback cannot return that same promise.");if(r&&("function"==typeof r||"object"==typeof r)){var o=r.then;if("function"==typeof o)return o.call(r,(function(o){i||(i=!0,r!==o?resolve(t,o):fulfill(t,o))}),(function(r){i||(i=!0,reject(t,r))})),!0}}catch(a){return i||reject(t,a),!0}return!1}function resolve(t,r){t!==r&&handleThenable(t,r)||fulfill(t,r)}function fulfill(t,r){t.state_===y&&(t.state_=_,t.data_=r,asyncCall(publishFulfillment,t))}function reject(t,r){t.state_===y&&(t.state_=_,t.data_=r,asyncCall(publishRejection,t))}function publish(t){var r=t.then_;t.then_=void 0;for(var i=0;i<r.length;i++)invokeCallback(r[i])}function publishFulfillment(t){t.state_=x,publish(t)}function publishRejection(t){t.state_=w,publish(t)}function Promise(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof Promise==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function invokeResolver(t,r){function rejectPromise(t){reject(r,t)}try{t((function resolvePromise(t){resolve(r,t)}),rejectPromise)}catch(i){rejectPromise(i)}}(t,this)}Promise.prototype={constructor:Promise,state_:y,then_:null,data_:void 0,then:function(t,r){var i={owner:this,then:new this.constructor(NOOP),fulfilled:t,rejected:r};return this.state_===x||this.state_===w?asyncCall(invokeCallback,i):this.then_.push(i),i.then},catch:function(t){return this.then(null,t)}},Promise.all=function(t){if(!isArray(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(r,i){var o=[],a=0;function resolver(t){return a++,function(i){o[t]=i,--a||r(o)}}for(var l,h=0;h<t.length;h++)(l=t[h])&&"function"==typeof l.then?l.then(resolver(h),i):o[h]=l;a||r(o)}))},Promise.race=function(t){if(!isArray(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(r,i){for(var o,a=0;a<t.length;a++)(o=t[a])&&"function"==typeof o.then?o.then(r,i):r(o)}))},Promise.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(r){r(t)}))},Promise.reject=function(t){return new this((function(r,i){i(t)}))}}("undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:this)}).call(this,i(54),i(109).setImmediate)},function(t,r,i){"use strict";var o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function toObject(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var r={},i=0;i<10;i++)r["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(r).map((function(t){return r[t]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(t){o[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(a){return!1}}()?Object.assign:function(t,r){for(var i,h,g=toObject(t),y=1;y<arguments.length;y++){for(var _ in i=Object(arguments[y]))a.call(i,_)&&(g[_]=i[_]);if(o){h=o(i);for(var x=0;x<h.length;x++)l.call(i,h[x])&&(g[h[x]]=i[h[x]])}}return g}},function(t,r,i){var o=i(38);t.exports=function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=o(t)););return t}},function(t,r){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,r){t.exports=function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,r,i){var o=i(69),a=i(85);function _construct(r,i,l){return a()?t.exports=_construct=Reflect.construct:t.exports=_construct=function _construct(t,r,i){var a=[null];a.push.apply(a,r);var l=new(Function.bind.apply(t,a));return i&&o(l,i.prototype),l},_construct.apply(null,arguments)}t.exports=_construct},function(t,r){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}},function(t,r,i){var o=i(72);t.exports=function _arrayWithoutHoles(t){if(Array.isArray(t))return o(t)}},function(t,r){t.exports=function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,r){t.exports=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,r,i){},function(t,r,i){},function(t,r){t.exports=function _arrayWithHoles(t){if(Array.isArray(t))return t}},function(t,r){t.exports=function _iterableToArrayLimit(t,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],o=!0,a=!1,l=void 0;try{for(var h,g=t[Symbol.iterator]();!(o=(h=g.next()).done)&&(i.push(h.value),!r||i.length!==r);o=!0);}catch(y){a=!0,l=y}finally{try{o||null==g.return||g.return()}finally{if(a)throw l}}return i}}},function(t,r){t.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,r,i){},function(t,r,i){var o=function(t){"use strict";var r,i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",g=a.toStringTag||"@@toStringTag";function define(t,r,i){return Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(A){define=function(t,r,i){return t[r]=i}}function wrap(t,r,i,o){var a=r&&r.prototype instanceof Generator?r:Generator,l=Object.create(a.prototype),h=new Context(o||[]);return l._invoke=function makeInvokeMethod(t,r,i){var o=y;return function invoke(a,l){if(o===x)throw new Error("Generator is already running");if(o===w){if("throw"===a)throw l;return doneResult()}for(i.method=a,i.arg=l;;){var h=i.delegate;if(h){var g=maybeInvokeDelegate(h,i);if(g){if(g===S)continue;return g}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===y)throw o=w,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=x;var M=tryCatch(t,r,i);if("normal"===M.type){if(o=i.done?w:_,M.arg===S)continue;return{value:M.arg,done:i.done}}"throw"===M.type&&(o=w,i.method="throw",i.arg=M.arg)}}}(t,i,h),l}function tryCatch(t,r,i){try{return{type:"normal",arg:t.call(r,i)}}catch(A){return{type:"throw",arg:A}}}t.wrap=wrap;var y="suspendedStart",_="suspendedYield",x="executing",w="completed",S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var M={};M[l]=function(){return this};var T=Object.getPrototypeOf,P=T&&T(T(values([])));P&&P!==i&&o.call(P,l)&&(M=P);var C=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(M);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(i,a,l,h){var g=tryCatch(t[i],t,a);if("throw"!==g.type){var y=g.arg,_=y.value;return _&&"object"==typeof _&&o.call(_,"__await")?r.resolve(_.__await).then((function(t){invoke("next",t,l,h)}),(function(t){invoke("throw",t,l,h)})):r.resolve(_).then((function(t){y.value=t,l(y)}),(function(t){return invoke("throw",t,l,h)}))}h(g.arg)}var i;this._invoke=function enqueue(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,i){invoke(t,o,r,i)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,i){var o=t.iterator[i.method];if(o===r){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=r,maybeInvokeDelegate(t,i),"throw"===i.method))return S;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var a=tryCatch(o,t.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,S;var l=a.arg;return l?l.done?(i[t.resultName]=l.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=r),i.delegate=null,S):l:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,S)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var i=t[l];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,h=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=r,next.done=!0,next};return h.next=h}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}return GeneratorFunction.prototype=C.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName=define(GeneratorFunctionPrototype,g,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,g,"GeneratorFunction")),t.prototype=Object.create(C),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[h]=function(){return this},t.AsyncIterator=AsyncIterator,t.async=function(r,i,o,a,l){void 0===l&&(l=Promise);var h=new AsyncIterator(wrap(r,i,o,a),l);return t.isGeneratorFunction(i)?h:h.next().then((function(t){return t.done?t.value:h.next()}))},defineIteratorMethods(C),define(C,g,"Generator"),C[l]=function(){return this},C.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var i in t)r.push(i);return r.reverse(),function next(){for(;r.length;){var i=r.pop();if(i in t)return next.value=i,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!t)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function handle(o,a){return h.type="throw",h.arg=t,i.next=o,a&&(i.method="next",i.arg=r),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var l=this.tryEntries[a],h=l.completion;if("root"===l.tryLoc)return handle("end");if(l.tryLoc<=this.prev){var g=o.call(l,"catchLoc"),y=o.call(l,"finallyLoc");if(g&&y){if(this.prev<l.catchLoc)return handle(l.catchLoc,!0);if(this.prev<l.finallyLoc)return handle(l.finallyLoc)}else if(g){if(this.prev<l.catchLoc)return handle(l.catchLoc,!0)}else{if(!y)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return handle(l.finallyLoc)}}}},abrupt:function(t,r){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var l=a;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var h=l?l.completion:{};return h.type=t,h.arg=r,l?(this.method="next",this.next=l.finallyLoc,S):this.complete(h)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),S},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),resetTryEntry(i),S}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc===t){var o=i.completion;if("throw"===o.type){var a=o.arg;resetTryEntry(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,o){return this.delegate={iterator:values(t),resultName:i,nextLoc:o},"next"===this.method&&(this.arg=r),S}},t}(t.exports);try{regeneratorRuntime=o}catch(a){Function("r","regeneratorRuntime = r")(o)}},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){},function(t,r,i){"use strict";(function(t){var r=i(79),o=i(80),a=i.n(o);window.Promise||(window.Promise=r.Polyfill),Object.assign||(Object.assign=a.a);var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function now(){return(new Date).getTime()}),!l.performance||!l.performance.now){var h=Date.now();l.performance||(l.performance={}),l.performance.now=function(){return Date.now()-h}}for(var g=Date.now(),y=["ms","moz","webkit","o"],_=0;_<y.length&&!l.requestAnimationFrame;++_){var x=y[_];l.requestAnimationFrame=l[x+"RequestAnimationFrame"],l.cancelAnimationFrame=l[x+"CancelAnimationFrame"]||l[x+"CancelRequestAnimationFrame"]}l.requestAnimationFrame||(l.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var r=Date.now(),i=16+g-r;return i<0&&(i=0),g=r,setTimeout((function(){g=Date.now(),t(performance.now())}),i)}),l.cancelAnimationFrame||(l.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function mathSign(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function numberIsInteger(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array)}).call(this,i(54))},function(t,r,i){(function(t){var o=void 0!==t&&t||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function Timeout(t,r){this._id=t,this._clearFn=r}r.setTimeout=function(){return new Timeout(a.call(setTimeout,o,arguments),clearTimeout)},r.setInterval=function(){return new Timeout(a.call(setInterval,o,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(o,this._id)},r.enroll=function(t,r){clearTimeout(t._idleTimeoutId),t._idleTimeout=r},r.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},r._unrefActive=r.active=function(t){clearTimeout(t._idleTimeoutId);var r=t._idleTimeout;r>=0&&(t._idleTimeoutId=setTimeout((function onTimeout(){t._onTimeout&&t._onTimeout()}),r))},i(110),r.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,r.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(54))},function(t,r,i){(function(t,r){!function(t,i){"use strict";if(!t.setImmediate){var o,a=1,l={},h=!1,g=t.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(t);y=y&&y.setTimeout?y:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){o=function(t){r.nextTick((function(){runIfPresent(t)}))}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var r=!0,i=t.onmessage;return t.onmessage=function(){r=!1},t.postMessage("","*"),t.onmessage=i,r}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},o=function(r){t.port2.postMessage(r)}}():g&&"onreadystatechange"in g.createElement("script")?function installReadyStateChangeImplementation(){var t=g.documentElement;o=function(r){var i=g.createElement("script");i.onreadystatechange=function(){runIfPresent(r),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():function installSetTimeoutImplementation(){o=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var r="setImmediate$"+Math.random()+"$",onGlobalMessage=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(r)&&runIfPresent(+i.data.slice(r.length))};t.addEventListener?t.addEventListener("message",onGlobalMessage,!1):t.attachEvent("onmessage",onGlobalMessage),o=function(i){t.postMessage(r+i,"*")}}(),y.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var r=new Array(arguments.length-1),i=0;i<r.length;i++)r[i]=arguments[i+1];var h={callback:t,args:r};return l[a]=h,o(a),a++},y.clearImmediate=clearImmediate}function clearImmediate(t){delete l[t]}function runIfPresent(t){if(h)setTimeout(runIfPresent,0,t);else{var r=l[t];if(r){h=!0;try{!function run(t){var r=t.callback,i=t.args;switch(i.length){case 0:r();break;case 1:r(i[0]);break;case 2:r(i[0],i[1]);break;case 3:r(i[0],i[1],i[2]);break;default:r.apply(void 0,i)}}(r)}finally{clearImmediate(t),h=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(54),i(111))},function(t,r){var i,o,a=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(i===setTimeout)return setTimeout(t,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(r){try{return i.call(null,t,0)}catch(r){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){i=defaultSetTimout}try{o="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){o=defaultClearTimeout}}();var l,h=[],g=!1,y=-1;function cleanUpNextTick(){g&&l&&(g=!1,l.length?h=l.concat(h):y=-1,h.length&&drainQueue())}function drainQueue(){if(!g){var t=runTimeout(cleanUpNextTick);g=!0;for(var r=h.length;r;){for(l=h,h=[];++y<r;)l&&l[y].run();y=-1,r=h.length}l=null,g=!1,function runClearTimeout(t){if(o===clearTimeout)return clearTimeout(t);if((o===defaultClearTimeout||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{return o(t)}catch(r){try{return o.call(null,t)}catch(r){return o.call(this,t)}}}(t)}}function Item(t,r){this.fun=t,this.array=r}function noop(){}a.nextTick=function(t){var r=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];h.push(new Item(t,r)),1!==h.length||g||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=noop,a.addListener=noop,a.once=noop,a.off=noop,a.removeListener=noop,a.removeAllListeners=noop,a.emit=noop,a.prependListener=noop,a.prependOnceListener=noop,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,r,i){(function(t,o){var a;!function(l){r&&r.nodeType,t&&t.nodeType;var h="object"==typeof o&&o;h.global!==h&&h.window!==h&&h.self;var g,y=2147483647,_=36,x=/^xn--/,w=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=Math.floor,P=String.fromCharCode;function error(t){throw RangeError(M[t])}function map(t,r){for(var i=t.length,o=[];i--;)o[i]=r(t[i]);return o}function mapDomain(t,r){var i=t.split("@"),o="";return i.length>1&&(o=i[0]+"@",t=i[1]),o+map((t=t.replace(S,".")).split("."),r).join(".")}function ucs2decode(t){for(var r,i,o=[],a=0,l=t.length;a<l;)(r=t.charCodeAt(a++))>=55296&&r<=56319&&a<l?56320==(64512&(i=t.charCodeAt(a++)))?o.push(((1023&r)<<10)+(1023&i)+65536):(o.push(r),a--):o.push(r);return o}function ucs2encode(t){return map(t,(function(t){var r="";return t>65535&&(r+=P((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=P(t)})).join("")}function digitToBasic(t,r){return t+22+75*(t<26)-((0!=r)<<5)}function adapt(t,r,i){var o=0;for(t=i?T(t/700):t>>1,t+=T(t/r);t>455;o+=_)t=T(t/35);return T(o+36*t/(t+38))}function decode(t){var r,i,o,a,l,h,g,x,w,S,M,P=[],C=t.length,A=0,O=128,L=72;for((i=t.lastIndexOf("-"))<0&&(i=0),o=0;o<i;++o)t.charCodeAt(o)>=128&&error("not-basic"),P.push(t.charCodeAt(o));for(a=i>0?i+1:0;a<C;){for(l=A,h=1,g=_;a>=C&&error("invalid-input"),((x=(M=t.charCodeAt(a++))-48<10?M-22:M-65<26?M-65:M-97<26?M-97:_)>=_||x>T((y-A)/h))&&error("overflow"),A+=x*h,!(x<(w=g<=L?1:g>=L+26?26:g-L));g+=_)h>T(y/(S=_-w))&&error("overflow"),h*=S;L=adapt(A-l,r=P.length+1,0==l),T(A/r)>y-O&&error("overflow"),O+=T(A/r),A%=r,P.splice(A++,0,O)}return ucs2encode(P)}function encode(t){var r,i,o,a,l,h,g,x,w,S,M,C,A,O,L,I=[];for(C=(t=ucs2decode(t)).length,r=128,i=0,l=72,h=0;h<C;++h)(M=t[h])<128&&I.push(P(M));for(o=a=I.length,a&&I.push("-");o<C;){for(g=y,h=0;h<C;++h)(M=t[h])>=r&&M<g&&(g=M);for(g-r>T((y-i)/(A=o+1))&&error("overflow"),i+=(g-r)*A,r=g,h=0;h<C;++h)if((M=t[h])<r&&++i>y&&error("overflow"),M==r){for(x=i,w=_;!(x<(S=w<=l?1:w>=l+26?26:w-l));w+=_)L=x-S,O=_-S,I.push(P(digitToBasic(S+L%O,0))),x=T(L/O);I.push(P(digitToBasic(x,0))),l=adapt(i,A,o==a),i=0,++o}++i,++r}return I.join("")}g={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function toASCII(t){return mapDomain(t,(function(t){return w.test(t)?"xn--"+encode(t):t}))},toUnicode:function toUnicode(t){return mapDomain(t,(function(t){return x.test(t)?decode(t.slice(4).toLowerCase()):t}))}},void 0===(a=function(){return g}.call(r,i,r,t))||(t.exports=a)}()}).call(this,i(113)(t),i(54))},function(t,r){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,r,i){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,r,i){"use strict";r.decode=r.parse=i(116),r.encode=r.stringify=i(117)},function(t,r,i){"use strict";function hasOwnProperty(t,r){return Object.prototype.hasOwnProperty.call(t,r)}t.exports=function(t,r,i,a){r=r||"&",i=i||"=";var l={};if("string"!=typeof t||0===t.length)return l;var h=/\+/g;t=t.split(r);var g=1e3;a&&"number"==typeof a.maxKeys&&(g=a.maxKeys);var y=t.length;g>0&&y>g&&(y=g);for(var _=0;_<y;++_){var x,w,S,M,T=t[_].replace(h,"%20"),P=T.indexOf(i);P>=0?(x=T.substr(0,P),w=T.substr(P+1)):(x=T,w=""),S=decodeURIComponent(x),M=decodeURIComponent(w),hasOwnProperty(l,S)?o(l[S])?l[S].push(M):l[S]=[l[S],M]:l[S]=M}return l};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,r,i){"use strict";var stringifyPrimitive=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,r,i,l){return r=r||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?map(a(t),(function(a){var l=encodeURIComponent(stringifyPrimitive(a))+i;return o(t[a])?map(t[a],(function(t){return l+encodeURIComponent(stringifyPrimitive(t))})).join(r):l+encodeURIComponent(stringifyPrimitive(t[a]))})).join(r):l?encodeURIComponent(stringifyPrimitive(l))+i+encodeURIComponent(stringifyPrimitive(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function map(t,r){if(t.map)return t.map(r);for(var i=[],o=0;o<t.length;o++)i.push(r(t[o],o));return i}var a=Object.keys||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&r.push(i);return r}},function(t,r,i){},function(t,r,i){},function(t,r,i){"use strict";i.r(r),i.d(r,"analysisMode",(function(){return y})),i.d(r,"exploringMode",(function(){return _})),i.d(r,"guessTheMoveMode",(function(){return x})),i.d(r,"observingMode",(function(){return w})),i.d(r,"passiveObservingMode",(function(){return M})),i.d(r,"playingMode",(function(){return S})),i.d(r,"setupMode",(function(){return T})),i.d(r,"Renderer",(function(){return zn})),i.d(r,"Annotations",(function(){return dn})),i.d(r,"Board",(function(){return Qe.a})),i.d(r,"Core",(function(){return ke.a})),i.d(r,"createAPI",(function(){return api_createAPI})),i.d(r,"createAccessibilityPlugin",(function(){return createAccessibilityPlugin})),i.d(r,"createAnalysisOverlayPlugin",(function(){return createAnalysisOverlayPlugin})),i.d(r,"createArrowsPlugin",(function(){return createArrowsPlugin})),i.d(r,"createArrowKeysPlugin",(function(){return createArrowKeysPlugin})),i.d(r,"createAssetsPlugin",(function(){return createAssetsPlugin})),i.d(r,"createBlinkingSquarePlugin",(function(){return createBlinkingSquarePlugin})),i.d(r,"createBoardSizePlugin",(function(){return createBoardSizePlugin})),i.d(r,"createBughouseAPIPlugin",(function(){return createBughouseAPIPlugin})),i.d(r,"createBughouseSiblingBoardPlugin",(function(){return createBughouseSiblingBoardPlugin})),i.d(r,"createCheatDetectionPlugin",(function(){return createCheatDetectionPlugin})),i.d(r,"createCoordinatesPlugin",(function(){return createCoordinatesPlugin})),i.d(r,"createClocksPlugin",(function(){return createClocksPlugin})),i.d(r,"createCustomItemsPlugin",(function(){return createCustomItemsPlugin})),i.d(r,"createDebugPlugin",(function(){return createDebugPlugin})),i.d(r,"createEcoPlugin",(function(){return createEcoPlugin})),i.d(r,"createEffectsPlugin",(function(){return createEffectsPlugin})),i.d(r,"createFadeSetupPlugin",(function(){return createFadeSetupPlugin})),i.d(r,"createFlipBoardPlugin",(function(){return createFlipBoardPlugin})),i.d(r,"createHandPiecesPlugin",(function(){return createHandPiecesPlugin})),i.d(r,"createHighlightsPlugin",(function(){return createHighlightsPlugin})),i.d(r,"createHorizontalMoveListPlugin",(function(){return createHorizontalMoveListPlugin})),i.d(r,"createHoverSquarePlugin",(function(){return createHoverSquarePlugin})),i.d(r,"createKitchenSinkPlugins",(function(){return createKitchenSinkPlugins})),i.d(r,"createMinimalPlugins",(function(){return createMinimalPlugins})),i.d(r,"createMoveHintsPlugin",(function(){return createMoveHintsPlugin})),i.d(r,"createPiecesPlugin",(function(){return createPiecesPlugin})),i.d(r,"createPregamePlugin",(function(){return createPregamePlugin})),i.d(r,"createPremovesPlugin",(function(){return createPremovesPlugin})),i.d(r,"createRendererErrorCatcherPlugin",(function(){return createRendererErrorCatcherPlugin})),i.d(r,"createReportingPlugin",(function(){return createReportingPlugin})),i.d(r,"createSoundsPlugin",(function(){return createSoundsPlugin})),i.d(r,"createStandardPlugins",(function(){return createStandardPlugins})),i.d(r,"createTimeControlPlugin",(function(){return createTimeControlPlugin})),i.d(r,"createThreatsPlugin",(function(){return createThreatsPlugin})),i.d(r,"createValidatePositionPlugin",(function(){return createValidatePositionPlugin})),i.d(r,"createVerticalMoveListPlugin",(function(){return createVerticalMoveListPlugin})),i.d(r,"createGame",(function(){return chessboard_createGame})),i.d(r,"createHandPieces",(function(){return createHandPieces})),i.d(r,"createDefaultRenderer",(function(){return Cn.createRenderer})),i.d(r,"createWebGLRenderer3D",(function(){return An.createRenderer})),i.d(r,"defaultBoardStyles",(function(){return pt.a})),i.d(r,"defaultPieceStyles",(function(){return pt.b})),i.d(r,"EffectIcons",(function(){return Ke.a})),i.d(r,"eventChangesGamePosition",(function(){return eventChangesGamePosition})),i.d(r,"Game",(function(){return We.a})),i.d(r,"getBoardURL",(function(){return yr.a})),i.d(r,"getColorAsLetter",(function(){return Y.a})),i.d(r,"getColorAsWord",(function(){return Ot.a})),i.d(r,"getDefaultOptions",(function(){return dr.a})),i.d(r,"getOppositeColor",(function(){return Z.a})),i.d(r,"getPGNForDownload",(function(){return getPGNForDownload})),i.d(r,"getPieceBaseURL",(function(){return gr.a})),i.d(r,"getSanFromFileRank",(function(){return br.a})),i.d(r,"isNode",(function(){return isNode})),i.d(r,"Logger",(function(){return qe})),i.d(r,"makeSvgIcon",(function(){return Ye.a})),i.d(r,"mergePlugins",(function(){return mergePlugins})),i.d(r,"Modes",(function(){return jt})),i.d(r,"MoveList",(function(){return It})),i.d(r,"Plugins",(function(){return lr})),i.d(r,"Pointerdown",(function(){return At.b})),i.d(r,"Pointermove",(function(){return At.c})),i.d(r,"Pointerup",(function(){return At.d})),i.d(r,"positionChangeEvents",(function(){return Et})),i.d(r,"runPlugin",(function(){return runPlugin})),i.d(r,"CapturedPiecesComponent",(function(){return ee})),i.d(r,"JCE",(function(){return ne.a})),i.d(r,"plugins",(function(){return a})),i.d(r,"PluginTypes",(function(){return o})),i.d(r,"renderers",(function(){return l})),i.d(r,"testHelpers",(function(){return g}));var o={};i.r(o),i.d(o,"AnalysisOverlay",(function(){return J})),i.d(o,"ArrowKeys",(function(){return oe})),i.d(o,"Arrows",(function(){return ae})),i.d(o,"Assets",(function(){return se})),i.d(o,"BlinkingSquare",(function(){return ce})),i.d(o,"BoardSize",(function(){return le})),i.d(o,"BughouseAPI",(function(){return ue})),i.d(o,"BughouseSiblingBoard",(function(){return de})),i.d(o,"CheatDetection",(function(){return re})),i.d(o,"Clocks",(function(){return he})),i.d(o,"Coordinates",(function(){return pe})),i.d(o,"CustomItems",(function(){return fe})),i.d(o,"Debug",(function(){return me})),i.d(o,"ECO",(function(){return ge})),i.d(o,"Effects",(function(){return ve})),i.d(o,"FadeSetup",(function(){return ye})),i.d(o,"HandPieces",(function(){return be})),i.d(o,"Highlights",(function(){return ie})),i.d(o,"HML",(function(){return _e})),i.d(o,"HoverSquare",(function(){return xe})),i.d(o,"MoveHints",(function(){return we})),i.d(o,"Pieces",(function(){return Se})),i.d(o,"Pregame",(function(){return Me})),i.d(o,"Premoves",(function(){return Ee})),i.d(o,"Reporting",(function(){return Te})),i.d(o,"Sounds",(function(){return Pe})),i.d(o,"Threats",(function(){return Ce})),i.d(o,"TimeControl",(function(){return Ae})),i.d(o,"Timer",(function(){return Oe})),i.d(o,"Validate",(function(){return Le})),i.d(o,"VML",(function(){return je}));var a={};i.r(a),i.d(a,"createAnalysisOverlayPlugin",(function(){return createAnalysisOverlayPlugin})),i.d(a,"createArrowKeysPlugin",(function(){return createArrowKeysPlugin})),i.d(a,"createArrowsPlugin",(function(){return createArrowsPlugin})),i.d(a,"createAssetsPlugin",(function(){return createAssetsPlugin})),i.d(a,"createBlinkingSquarePlugin",(function(){return createBlinkingSquarePlugin})),i.d(a,"createBoardSizePlugin",(function(){return createBoardSizePlugin})),i.d(a,"createCheatDetectionPlugin",(function(){return createCheatDetectionPlugin})),i.d(a,"createCoordinatesPlugin",(function(){return createCoordinatesPlugin})),i.d(a,"createCustomItemsPlugin",(function(){return createCustomItemsPlugin})),i.d(a,"createDebugPlugin",(function(){return createDebugPlugin})),i.d(a,"createEffectsPlugin",(function(){return createEffectsPlugin})),i.d(a,"createFadeSetupPlugin",(function(){return createFadeSetupPlugin})),i.d(a,"createFlipBoardPlugin",(function(){return createFlipBoardPlugin})),i.d(a,"createHighlightsPlugin",(function(){return createHighlightsPlugin})),i.d(a,"createHoverSquarePlugin",(function(){return createHoverSquarePlugin})),i.d(a,"createMoveHintsPlugin",(function(){return createMoveHintsPlugin})),i.d(a,"createPiecesPlugin",(function(){return createPiecesPlugin})),i.d(a,"createRendererErrorCatcherPlugin",(function(){return createRendererErrorCatcherPlugin})),i.d(a,"createSoundsPlugin",(function(){return createSoundsPlugin})),i.d(a,"createTimeControlPlugin",(function(){return createTimeControlPlugin})),i.d(a,"createKeysPlugin",(function(){return createKeysPlugin})),i.d(a,"createEcoPlugin",(function(){return createEcoPlugin})),i.d(a,"createPregamePlugin",(function(){return createPregamePlugin})),i.d(a,"createPremovesPlugin",(function(){return createPremovesPlugin})),i.d(a,"createReportingPlugin",(function(){return createReportingPlugin})),i.d(a,"createVerticalMoveListPlugin",(function(){return createVerticalMoveListPlugin})),i.d(a,"createHorizontalMoveListPlugin",(function(){return createHorizontalMoveListPlugin})),i.d(a,"createMinimalPlugins",(function(){return createMinimalPlugins})),i.d(a,"createStandardPlugins",(function(){return createStandardPlugins})),i.d(a,"createPremiumPlugins",(function(){return createPremiumPlugins})),i.d(a,"createKitchenSinkPlugins",(function(){return createKitchenSinkPlugins}));var l={};i.r(l),i.d(l,"createDefaultRenderer",(function(){return Cn.createRenderer})),i.d(l,"create3DRenderer",(function(){return An.createRenderer})),i.d(l,"createWebGL2DRenderer",(function(){return On.createRenderer}));var h={};i.r(h),i.d(h,"highlights",(function(){return Rn}));var g={};i.r(g),i.d(g,"booleanArgumentPassed",(function(){return booleanArgumentPassed})),i.d(g,"config",(function(){return h})),i.d(g,"getBoardPosition",(function(){return getBoardPosition})),i.d(g,"getCoordsFromSquare",(function(){return getCoordsFromSquare})),i.d(g,"getElementBackgroundImage",(function(){return getElementBackgroundImage})),i.d(g,"getFileRankFromSan",(function(){return getFileRankFromSan})),i.d(g,"getHighlightType",(function(){return getHighlightType})),i.d(g,"getPieceShortStringFromUrl",(function(){return getPieceShortStringFromUrl})),i.d(g,"getSanFromFileRank",(function(){return getSanFromFileRank})),i.d(g,"getSelectorName",(function(){return getSelectorName})),i.d(g,"getSquareFromRects",(function(){return getSquareFromRects})),i.d(g,"rgbToHex",(function(){return Ln.a})),i.d(g,"shouldExist",(function(){return shouldExist})),i.d(g,"triggerEvent",(function(){return triggerEvent})),i.d(g,"trueFalseToBoolean",(function(){return trueFalseToBoolean}));var y={};i.r(y),i.d(y,"create",(function(){return Nn}));var _={};i.r(_),i.d(_,"create",(function(){return Dn}));var x={};i.r(x),i.d(x,"create",(function(){return Bn}));var w={};i.r(w),i.d(w,"create",(function(){return Gn}));var S={};i.r(S),i.d(S,"create",(function(){return Hn}));var M={};i.r(M),i.d(M,"create",(function(){return Un}));var T={};i.r(T),i.d(T,"create",(function(){return qn}));i(78);var P=i(56),C=i(62),A=i(38),O=i(63),L=i(6),I=i.n(L),R=i(1),j=i.n(R),N=i(45),k=i(58),D=i(44),B=i.n(D);function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var i,o=A(t);if(r){var a=A(this).constructor;Reflect.construct(o,arguments,a)}else o.apply(this,arguments);return C(this,i)}}function noop(){}function internal_run(t){return t()}function blank_object(){return Object.create(null)}function run_all(t){t.forEach(internal_run)}function is_function(t){return"function"==typeof t}function safe_not_equal(t,r){return t!=t?r==r:t!==r||t&&"object"===D(t)||"function"==typeof t}function null_to_empty(t){return null==t?"":t}new Set;function append(t,r){t.appendChild(r)}function insert(t,r,i){t.insertBefore(r,i||null)}function detach(t){t.parentNode.removeChild(t)}function destroy_each(t,r){for(var i=0;i<t.length;i+=1)t[i]&&t[i].d(r)}function internal_element(t){return document.createElement(t)}function internal_text(t){return document.createTextNode(t)}function space(){return internal_text(" ")}function listen(t,r,i,o){return t.addEventListener(r,i,o),function(){return t.removeEventListener(r,i,o)}}function attr(t,r,i){null==i?t.removeAttribute(r):t.setAttribute(r,i)}function set_data(t,r){r=""+r,t.data!==r&&(t.data=r)}function toggle_class(t,r,i){t.classList[i?"add":"remove"](r)}function custom_event(t,r){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!1,r),i}var G,H=function(){function HtmlTag(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;N(this,HtmlTag),this.e=internal_element("div"),this.a=r,this.u(t)}return k(HtmlTag,[{key:"m",value:function m(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=0;i<this.n.length;i+=1)insert(t,this.n[i],r);this.t=t}},{key:"u",value:function u(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}},{key:"p",value:function p(t){this.d(),this.u(t),this.m(this.t,this.a)}},{key:"d",value:function d(){this.n.forEach(detach)}}]),HtmlTag}();function set_current_component(t){G=t}function get_current_component(){if(!G)throw new Error("Function called outside component initialization");return G}function createEventDispatcher(){var t=G;return function(r,i){var o=t.$$.callbacks[r];if(o){var a=custom_event(r,i);o.slice().forEach((function(r){r.call(t,a)}))}}}var V=[],U=[],z=[],W=[],q=Promise.resolve(),$=!1;function schedule_update(){$||($=!0,q.then(internal_flush))}function add_render_callback(t){z.push(t)}function internal_flush(){var t=new Set;do{for(;V.length;){var r=V.shift();set_current_component(r),internal_update(r.$$)}for(;U.length;)U.pop()();for(var i=0;i<z.length;i+=1){var o=z[i];t.has(o)||(o(),t.add(o))}z.length=0}while(V.length);for(;W.length;)W.pop()();$=!1}function internal_update(t){t.fragment&&(t.update(t.dirty),run_all(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(add_render_callback))}var X=new Set;function transition_in(t,r){t&&t.i&&(X.delete(t),t.i(r))}"undefined"!=typeof window&&window;function destroy_component(t,r){t.$$.fragment&&(run_all(t.$$.on_destroy),t.$$.fragment.d(r),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function make_dirty(t,r){t.$$.dirty||(V.push(t),schedule_update(),t.$$.dirty=blank_object()),t.$$.dirty[r]=!0}function internal_init(t,r,i,o,a,l){var h=G;set_current_component(t);var g=r.props||{},y=t.$$={fragment:null,ctx:null,props:l,update:noop,not_equal:a,bound:blank_object(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:blank_object(),dirty:null},_=!1;y.ctx=i?i(t,g,(function(r,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;return y.ctx&&a(y.ctx[r],y.ctx[r]=o)&&(y.bound[r]&&y.bound[r](o),_&&make_dirty(t,r)),i})):g,y.update(),_=!0,run_all(y.before_update),y.fragment=o(y.ctx),r.target&&(r.hydrate?y.fragment.l(function children(t){return Array.from(t.childNodes)}(r.target)):y.fragment.c(),r.intro&&transition_in(t.$$.fragment),function mount_component(t,r,i){var o=t.$$,a=o.fragment,l=o.on_mount,h=o.on_destroy,g=o.after_update;a.m(r,i),add_render_callback((function(){var r=l.map(internal_run).filter(is_function);h?h.push.apply(h,L(r)):run_all(r),t.$$.on_mount=[]})),g.forEach(add_render_callback)}(t,r.target,r.anchor),internal_flush()),set_current_component(h)}"undefined"!=typeof HTMLElement&&HTMLElement;var K=function(){function SvelteComponent(){N(this,SvelteComponent)}return k(SvelteComponent,[{key:"$destroy",value:function $destroy(){destroy_component(this,1),this.$destroy=noop}},{key:"$on",value:function $on(t,r){var i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(r),function(){var t=i.indexOf(r);-1!==t&&i.splice(t,1)}}},{key:"$set",value:function $set(){}}]),SvelteComponent}();var Y=i(25),Z=i(30),Q=["p","b","n","r","q"];i(89);function get_each_context(t,r,i){const o=Object.create(t);return o.className=r[i],o}function create_each_block(t){var r,i;return{c(){attr(r=internal_element("div"),"class",i="captured-piece "+t.className+" svelte-1u3j5jx")},m(t,i){insert(t,r,i)},p(t,o){t.classNames&&i!==(i="captured-piece "+o.className+" svelte-1u3j5jx")&&attr(r,"class",i)},d(t){t&&detach(r)}}}function create_if_block(t){var r,i,o;return{c(){r=internal_element("div"),i=internal_text("+"),o=internal_text(t.score),attr(r,"class","score svelte-1u3j5jx")},m(t,a){insert(t,r,a),append(r,i),append(r,o)},p(t,r){t.score&&set_data(o,r.score)},d(t){t&&detach(r)}}}function create_fragment(t){var r,i,o;let a=t.classNames,l=[];for(let g=0;g<a.length;g+=1)l[g]=create_each_block(get_each_context(t,a,g));var h=t.score&&create_if_block(t);return{c(){r=internal_element("div");for(let t=0;t<l.length;t+=1)l[t].c();i=space(),h&&h.c(),attr(r,"class",o="captured-pieces "+t.colorAsLetter+" svelte-1u3j5jx")},m(t,o){insert(t,r,o);for(let i=0;i<l.length;i+=1)l[i].m(r,null);append(r,i),h&&h.m(r,null)},p(t,g){if(t.classNames){let o;for(a=g.classNames,o=0;o<a.length;o+=1){const h=get_each_context(g,a,o);l[o]?l[o].p(t,h):(l[o]=create_each_block(h),l[o].c(),l[o].m(r,i))}for(;o<l.length;o+=1)l[o].d(1);l.length=a.length}g.score?h?h.p(t,g):((h=create_if_block(g)).c(),h.m(r,null)):h&&(h.d(1),h=null),t.colorAsLetter&&o!==(o="captured-pieces "+g.colorAsLetter+" svelte-1u3j5jx")&&attr(r,"class",o)},i:noop,o:noop,d(t){t&&detach(r),destroy_each(l,t),h&&h.d()}}}function captured_pieces_svelte_instance(t,r,i){let o,a,{color:l,pieces:h,score:g}=r;return t.$set=t=>{"color"in t&&i("color",l=t.color),"pieces"in t&&i("pieces",h=t.pieces),"score"in t&&i("score",g=t.score)},t.$$.update=(t={color:1,pieces:1})=>{t.color&&i("colorAsLetter",o=Object(Y.a)(Object(Z.a)(l))),t.pieces&&i("classNames",a=h?Q.map(function toClassName(t){return function mapToClassName(r){if(!t[r])return;const i=1===t[r]?"":t[r];return`${o}${r}${i}`}}(h)).filter(Boolean):[])},{color:l,pieces:h,score:g,colorAsLetter:o,classNames:a}}var J,ee=class captured_pieces_svelte_Captured_pieces extends K{constructor(t){super(),internal_init(this,t,captured_pieces_svelte_instance,create_fragment,safe_not_equal,["color","pieces","score"])}},te=i(21),ne=i.n(te);!function(t){!function(t){t.Name="analysis-overlay"}(t.Plugin||(t.Plugin={}))}(J||(J={}));var re,ie,oe,ae,se,ce,le,ue,de,he,pe,fe,me,ge,ve,ye,be,_e,xe,we,Se,Me,Ee,Te,Pe,Ce,Ae,Oe,Le,Ie,Re,je,Ne,ke=i(0);function isOneOf(t){return function isType(r){return t.length?t.includes(r.type):Object.values(t).includes(r.type)}}function createAnalysisOverlayPlugin(){var t;return{destroy:function destroy(){null==t||t.removeAnalysisOverlay()},match:[{condition:isOneOf([ke.a.APIEvents.Load,ke.a.OptionsEvents.Update,ke.a.InstanceEvents.ModeChanged,ke.a.InstanceEvents.RendererSet]),handler:function updateAnalysisOverlay(r,i){var o=i.options,a=i.renderer;!t&&a&&(t=a);o.overlayInAnalysisMode?null==t||t.addAnalysisOverlay():null==t||t.removeAnalysisOverlay()}}],name:J.Plugin.Name}}function is(t){return function isType(r){return t===r.type}}function createArrowKeysPlugin(t){return{match:[{condition:is(Ne.Events.Keydown),handler:function onKeydown(r,i){var o=r.data,a=i.queue,l=function createKeydownCallbacks(r){var i,o,a,l,h=r.api;return{downCb:null!==(i=null==t?void 0:t[oe.Arrow.Down])&&void 0!==i?i:h.selectLineEnd,leftCb:null!==(o=null==t?void 0:t[oe.Arrow.Left])&&void 0!==o?o:h.moveBackward,rightCb:null!==(a=null==t?void 0:t[oe.Arrow.Right])&&void 0!==a?a:h.moveForward,upCb:null!==(l=null==t?void 0:t[oe.Arrow.Up])&&void 0!==l?l:h.selectLineStart}}(i),h=l.downCb,g=l.leftCb,y=l.rightCb,_=l.upCb;switch(o){case oe.Arrow.Down:a.add(h);break;case oe.Arrow.Left:a.add(g);break;case oe.Arrow.Right:a.add(y);break;case oe.Arrow.Up:a.add(_)}}}],name:oe.Plugin.Name}}function createArrowsPlugin(){var t={};return{match:[{condition:isOneOf(ke.a.APIEvents),handler:updateArrows},{condition:is(ke.a.InstanceEvents.RendererSet),handler:function resetArrows(r,i){t={},updateArrows(r,i)}}],name:ae.Plugin.Name};function updateArrows(r,i){var o=i.api,a=i.options,l=i.renderer,h=o.getMarkings();if(a.allowMarkings||(h.arrow={}),l){var g=function getArrowDiffs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.keys(t).filter((function(t){return!r[t]})).reduce((function(r,i){return r[i]=t[i],r}),{}),o=Object.keys(r).filter((function(r){return!t[r]})).reduce((function(t,i){return t[i]=r[i],t}),{}),a=Object.keys(r).filter((function(i){return t[i]&&(t[i].color!==r[i].color||t[i].opacity!==r[i].opacity)})).reduce((function(t,i){return t[i]=r[i],t}),{});return{toAdd:o,toRemove:Object.keys(i),toUpdate:a}}(t,h.arrow);Object.keys(g.toAdd).length&&l.addArrows(g.toAdd,i),g.toRemove.length&&l.removeArrows(g.toRemove,i),Object.keys(g.toUpdate).length&&l.updateArrows(g.toUpdate,i),t=Object.assign({},h.arrow)}}}function createAssetsPlugin(){var t,r;return{match:[{condition:isOneOf([ke.a.InstanceEvents.RendererSet,ke.a.OptionsEvents.Update]),handler:function updateAssets(i,o){var a=o.options,l=o.renderer;if(!l)return;a.boardStyle!==t&&(t=a.boardStyle,l.updateBoardImage(o));a.pieceStyle!==r&&(r=a.pieceStyle,l.updatePieceBaseImage(o))}}],name:se.Plugin.Name}}!function(t){!function(t){t.Name="cheatDetection"}(t.Plugin||(t.Plugin={}))}(re||(re={})),function(t){!function(t){t.Name="highlights"}(t.Plugin||(t.Plugin={}))}(ie||(ie={})),function(t){!function(t){t.Name="arrow-keys"}(t.Plugin||(t.Plugin={})),function(t){t.Left="arrowleft",t.Up="arrowup",t.Right="arrowright",t.Down="arrowdown"}(t.Arrow||(t.Arrow={}))}(oe||(oe={})),function(t){!function(t){t.Name="arrows"}(t.Plugin||(t.Plugin={}))}(ae||(ae={})),function(t){!function(t){t.Name="assets"}(t.Plugin||(t.Plugin={}))}(se||(se={})),function(t){!function(t){t.Name="blinking-square"}(t.Plugin||(t.Plugin={}))}(ce||(ce={})),function(t){!function(t){t.Name="board-size"}(t.Plugin||(t.Plugin={}))}(le||(le={})),function(t){!function(t){t.Name="bughouse-api"}(t.Plugin||(t.Plugin={}))}(ue||(ue={})),function(t){!function(t){t.Name="bughouse-sibling-board"}(t.Plugin||(t.Plugin={}))}(de||(de={})),function(t){!function(t){t.Name="clocks"}(t.Plugin||(t.Plugin={})),function(t){t.Blitz="blitz",t.Bullet="bullet",t.Rapid="rapid"}(t.TimeControlTypes||(t.TimeControlTypes={}))}(he||(he={})),function(t){!function(t){t.Name="coordinates"}(t.Plugin||(t.Plugin={}))}(pe||(pe={})),function(t){!function(t){t.Name="custom-items"}(t.Plugin||(t.Plugin={})),function(t){t.Root="custom-item"}(t.Classes||(t.Classes={}))}(fe||(fe={})),function(t){!function(t){t.Name="debug"}(t.Plugin||(t.Plugin={}))}(me||(me={})),function(t){t.Name="eco",function(t){t.Update="UpdateECO"}(t.Events||(t.Events={})),function(t){!function(t){t.StartingPosition="A00"}(t.Codes||(t.Codes={})),t.InitialFen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",function(t){t.StartingPosition="Starting Position",t.CustomPosition="Custom Position"}(t.Text||(t.Text={}))}(t.Config||(t.Config={}))}(ge||(ge={})),function(t){!function(t){t.Name="effects"}(t.Plugin||(t.Plugin={}))}(ve||(ve={})),function(t){!function(t){t.Name="fade-setup"}(t.Plugin||(t.Plugin={}))}(ye||(ye={})),function(t){!function(t){t.Name="handPieces"}(t.Plugin||(t.Plugin={})),function(t){t.SetHand="SetHand"}(t.Events||(t.Events={}))}(be||(be={})),function(t){!function(t){t.Name="hml"}(t.Plugin||(t.Plugin={}))}(_e||(_e={})),function(t){!function(t){t.Name="hover-square"}(t.Plugin||(t.Plugin={}))}(xe||(xe={})),function(t){!function(t){t.Name="move-hints"}(t.Plugin||(t.Plugin={}))}(we||(we={})),function(t){!function(t){t.Name="pieces"}(t.Plugin||(t.Plugin={}))}(Se||(Se={})),function(t){!function(t){t.Name="pregame"}(t.Plugin||(t.Plugin={}))}(Me||(Me={})),function(t){!function(t){t.Premove="Premove"}(t.Events||(t.Events={})),function(t){t.Name="premoves"}(t.Plugin||(t.Plugin={}))}(Ee||(Ee={})),function(t){!function(t){t.Name="reporting"}(t.Plugin||(t.Plugin={}))}(Te||(Te={})),function(t){!function(t){t.Name="sounds"}(t.Plugin||(t.Plugin={})),function(t){t.GameStart="game-start",t.GameEnd="game-end",t.Capture="capture",t.Castle="castle",t.Premove="premove",t.MoveSelf="move-self",t.MoveCheck="move-check",t.MoveOpponent="move-opponent",t.Promote="promote",t.Notify="notify",t.TenSeconds="tenseconds",t.Illegal="illegal"}(t.BoardSounds||(t.BoardSounds={})),t.maxTagsPerSound=5}(Pe||(Pe={})),function(t){!function(t){t.Updated="ThreatsUpdated"}(t.Events||(t.Events={})),function(t){t.Name="threats"}(t.Plugin||(t.Plugin={}))}(Ce||(Ce={})),function(t){!function(t){t.Name="timeControl"}(t.Plugin||(t.Plugin={})),function(t){t.Blitz="blitz",t.Bullet="bullet",t.Rapid="rapid"}(t.Types||(t.Types={}))}(Ae||(Ae={})),function(t){!function(t){t.Reset="Reset",t.Start="Start",t.Stop="Stop",t.Tick="Tick"}(t.Actions||(t.Actions={})),function(t){t.End="End",t.Reset="Reset",t.Start="Start",t.Stop="Stop",t.Tick="Tick",t.TimeAdded="TimeAdded"}(t.Events||(t.Events={})),function(t){t.Ended="Ended",t.Going="Going",t.Initial="Initial",t.Stopped="Stopped"}(t.States||(t.States={}))}(Oe||(Oe={})),Ie=Le||(Le={}),(Ie.Plugin||(Ie.Plugin={})).Name="validate",function(t){t.InvalidPosition="InvalidPosition"}(Re=Ie.ErrorCodes||(Ie.ErrorCodes={})),Ie.ErrorMessages=j()({},Re.InvalidPosition,"Board position does not match the FEN from JCE"),function(t){!function(t){t.Ready="Ready",t.ResultNodeSelected="ResultNodeSelected",t.Updated="Updated"}(t.Events||(t.Events={})),function(t){t.Name="vml"}(t.Plugin||(t.Plugin={}))}(je||(je={})),function(t){!function(t){t.Keydown="Keydown",t.Keyup="Keyup"}(t.Events||(t.Events={})),function(t){t.Name="keys"}(t.Plugin||(t.Plugin={}))}(Ne||(Ne={}));var De,Be=i(11);function createBlinkingSquarePlugin(){return{match:[{condition:is(ke.a.APIEvents.BlinkSquare),handler:function blinkSquare(t,r){var i=r.renderer;null==i||i.blinkSquares(Object(Be.a)(j()({},t.data.square,t.data)),r)}}],name:ce.Plugin.Name}}function createBoardSizePlugin(){return{match:[{condition:isOneOf([ke.a.UIEvents.Resize,ke.a.InstanceEvents.RendererSet]),handler:function resize(t,r){var i=r.renderer;null==i||i.resize(r)}}],name:le.Plugin.Name}}function createEventEmitter(){const t=[];return{emit:function emit(r,i){let o;for(o of t)o.type!==r&&"all"!==o.type||o.handler(i)},listeners:t,off:off,offAll:function offAll(t){return off({handler:t,type:"all"})},offMany:function offMany(t=[]){t.forEach((t=>off(t)))},on:on,onAll:function onAll(t){on("all",t)},onMany:function onMany(t=[],r){t.forEach((t=>on(t,r)))}};function off(r){const i=t.findIndex((t=>r.type===t.type&&r.handler===t.handler));-1!==i&&t.splice(i,1)}function on(r,i){const o={handler:i,type:r};t.push(o)}}function createStateMachine({data:t,initialState:r,states:i},o=createEventEmitter()){let a=r;return Object.assign(Object.assign({},o),{getCurrentState:function getCurrentState(){return a},getData:function getData(){return Object.assign({},t)},transition:function transition(r,l){if(!i[a][r])return o.emit(De.Event.Types.NoTransition,{action:r,data:t,state:a}),!1;const h=i[a][r](l),g="string"==typeof h?h:h.nextState,buildEvent=i=>({action:r,currentState:a,data:t,event:i,nextState:g,params:l});a!==g&&o.emit(De.Event.Types.OnExit,buildEvent(De.Event.Types.OnExit));h.data&&Object.assign(t,h.data);a!==g&&o.emit(De.Event.Types.OnEnter,buildEvent(De.Event.Types.OnEnter));a===g?o.emit(De.Event.Types.OnReEnter,buildEvent(De.Event.Types.OnReEnter)):a=g;return!0}})}!function(t){let r;!function(t){let r;!function(t){t.NoTransition="NoTransition",t.OnEnter="Enter",t.OnExit="Exit",t.OnReEnter="ReEnter"}(r=t.Types||(t.Types={}))}(r=t.Event||(t.Event={}))}(De||(De={}));var Fe,Ge,He=createStateMachine({data:{chosenPiece:"",didChangePieces:!1,mouseCoords:[],moveHoldTimes:[],tentativeMouseCoords:{x:0,y:0}},initialState:"idle",states:{changedPiece:{load:state_machine_load,move:function move(){return{data:{chosenPiece:void 0,didChangePieces:!0,mouseCoords:[].concat(I()(He.getData().mouseCoords),[He.getData().tentativeMouseCoords]),moveHoldTimes:[].concat(I()(He.getData().moveHoldTimes),[Date.now()-He.getData().moveHoldTimeStart])},nextState:"idle"}}},chosenPiece:{choosePiece:function choosePiece(t){var r=t.tentativeMouseCoords;return{data:{moveHoldTimeStart:t.moveHoldTimeStart,tentativeMouseCoords:r},nextState:"changedPiece"}},load:state_machine_load,move:function move(){return{data:{chosenPiece:void 0,mouseCoords:[].concat(I()(He.getData().mouseCoords),[He.getData().tentativeMouseCoords]),moveHoldTimes:[].concat(I()(He.getData().moveHoldTimes),[Date.now()-He.getData().moveHoldTimeStart])},nextState:"idle"}}},idle:{choosePiece:function choosePiece(t){return{data:{chosenPiece:t.chosenPiece,didChangePieces:!1,moveHoldTimeStart:t.moveHoldTimeStart,tentativeMouseCoords:t.tentativeMouseCoords},nextState:"chosenPiece"}},load:state_machine_load}}});function state_machine_load(){return{data:{chosenPiece:"",didChangePieces:!1,mouseCoords:[],moveHoldTimes:[],tentativeMouseCoords:{x:0,y:0}},nextState:"idle"}}function didUseCheatMouse(t){var r={},i=t.mouseCoords.length/2;return t.mouseCoords.some((function(t){var o="".concat(t.x,"-").concat(t.y);return void 0===r[o]?r[o]=0:r[o]+=1,r[o]>=i}),{})}function createCheatDetectionPlugin(){return{api:function api(){return function createCheatDetectionAPI(t){var r=t.machine;return{get:function get(){var t=r.getData();return{didChangePieces:t.didChangePieces,didUseCheatMouse:didUseCheatMouse(t),moveHoldTimes:t.moveHoldTimes}}}}({machine:He})},match:[{condition:isOneOf([ke.a.UserEvents.PointerdownLeft,ke.a.UserEvents.Pointerup]),handler:function choosePiece(t,r){var i=r.mode,o=r.state;if(o.get(ke.a.State.MachineState)===Fe.States.PromotionAreaShowing||!t.data||!i.isAllowedToMove())return;var a=o.get(ke.a.State.SelectedPiece)||o.get(ke.a.State.DraggingPiece);a&&a!==He.getData().chosenPiece&&He.transition("choosePiece",{chosenPiece:a,moveHoldTimeStart:Date.now(),tentativeMouseCoords:t.data.coordsInsideSquare})}},{condition:is(ke.a.APIEvents.Load),handler:function handleAPILoad(){He.transition("load")}},{condition:is(ke.a.APIEvents.Move),handler:function handleAPIMove(){He.transition("move")}}],name:re.Plugin.Name}}function createCoordinatesPlugin(){var t,r=!1;return{match:[{condition:isOneOf([ke.a.InstanceEvents.RendererSet,ke.a.OptionsEvents.Update]),handler:function updateCoordinates(i,o){var a=o.options,l=o.renderer;if(!l)return;a.coordinates===t&&a.flipped===r||l.setCoordinates({flipped:a.flipped,position:a.coordinates},o);t=a.coordinates,r=a.flipped}}],name:pe.Plugin.Name}}function diffsToAdd(t,r){return Object.keys(r).filter((function(r){return!t[r]})).reduce((function(t,i){return t[i]=r[i],t}),{})}function diffsToRemove(t,r){return Object.keys(t).filter((function(t){return!r[t]})).reduce((function(r,i){return r[i]=t[i],r}),{})}function diffsToUpdate(t,r){return Object.keys(r).filter((function(i){var o=t[i],a=r[i];return o&&!function markingsMatch(t,r){return Object.keys(r).every((function(i){var o={new:r[i],old:t[i]};return function isObject(t){return"[object Object]"===Object.prototype.toString.call(t)}(o.new)?function objectsAreShallowEqual(t,r){var i={a:Object.getOwnPropertyNames(t),b:Object.getOwnPropertyNames(r)};return i.a.length===i.b.length&&i.a.every((function(i){return t[i]===r[i]}))}(o.new,o.old):o.old===o.new}))}(o,a)})).reduce((function(t,i){return t[i]=r[i],t}),{})}!function(t){!function(t){t.AddingMarkings="AddingMarkings",t.Idle="Idle",t.PieceDragging="PieceDragging",t.PieceSelected="PieceSelected",t.PromotionAreaShowing="PomotionAreaShowing"}(t.States||(t.States={}))}(Fe||(Fe={})),function(t){t.Name="core"}(Ge||(Ge={}));i(90);var Ve=i(12),Ue=i(32),ze=i(4),We=i(2);var qe,$e=i(53);function createCustomItemsMethods(t){var r=t.board,i=t.el,o=t.options,a=document.createComment("/Custom Items");r.addToDom({el:a,insertAfter:!0,type:Ve.b.Pieces});var l=Object(Be.a)(),h=Object(Be.a)();return{addCustomItems:addCustomItems,removeCustomItems:removeCustomItems,updateCustomItems:function updateCustomItems(t){removeCustomItems({squares:Object.keys(t)}),addCustomItems(t)}};function addCustomItems(t){Object.keys(t).forEach((function(g){l.isDefined(g)&&function flushAnimatingCustomItem(t){var r=h.get(t);r&&r.classList.contains("captured")&&(i.removeChild(r),h.deleteItem(t),clearTimeout(l.get(t)),l.deleteItem(t))}(g);var y,_=t[g],x=_.color,w=_.image,S=_.key,M=_.opacity,T=_.text,P=_.type,C=_.visualOrder,A=document.createElement("div");(A.classList.add(fe.Classes.Root),A.innerHTML=$e[P],function assignSVGAttributes(){var t=A.querySelector("svg");if(!t)return;x&&(t.style.fill=x);M&&(t.style.opacity=String(M));if(w){var r=t.querySelector("image");if(!r)return;if(r.setAttribute("href",w.url),w.percentOfSquare){var i=t.viewBox.baseVal.width,o=i*w.percentOfSquare*.01,a=(i-o)/2;Object.assign(r.style,{height:o,width:o,x:a,y:a})}}if(T){var l=t.querySelector("text");if(!l)return;l.innerHTML=T.value,T.color&&(l.style.fill=T.color)}}(),Object(Ue.a)({el:A,square:S}),o.test)&&Object(ze.c)(A,(y={},j()(y,ze.b.Color,x),j()(y,ze.b.Element,ze.a.CustomItem),j()(y,ze.b.Opacity,M),j()(y,ze.b.Square,S),j()(y,ze.b.Type,P),y));var O=function getDOMTarget(t){if(!t)return null;var r="below"===t.position;return"arrows"===t.target?{insertBefore:r,type:Ve.b.Arrows}:"effects"===t.target?{insertBefore:r,type:Ve.b.Effects}:"pieces"===t.target?{insertBefore:!r,type:r?Ve.b.Effects:Ve.b.Pieces}:null}(C);O?r.addToDom(Object.assign({el:A},O)):i.insertBefore(A,a),h.set(g,A)}))}function removeCustomItems(t){var r=t.animated,o=void 0!==r&&r;t.squares.forEach((function(t){var r=h.get(t);r&&(o?(r.classList.add("captured"),l.set(t,setTimeout((function(){l.isDefined(t)&&l.deleteItem(t),r&&(i.removeChild(r),h.deleteItem(t))}),250))):(i.removeChild(r),h.deleteItem(t)))}))}}function isNot(t){return function isType(r){return t!==r.type}}function createCustomItemsPlugin(){var t={};return{match:[{condition:is(ke.a.InstanceEvents.RendererSet),handler:function init(t,r){var i=r.renderer;null==i||i.extendRenderer(createCustomItemsMethods)}},{condition:isNot(ke.a.UserEvents.Pointermove),handler:function updateRenderedCustomItems(r,i){var o=i.api,a=i.options,l=i.renderer,h=o.getMarkings();a.allowMarkings||(h.customItem={});if(!l)return;var g=function getCustomItemDiffs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{toAdd:diffsToAdd(t,r),toRemove:Object.keys(diffsToRemove(t,r)),toUpdate:diffsToUpdate(t,r)}}(t,h.customItem);Object.keys(g.toAdd).length&&l.addCustomItems&&l.addCustomItems(g.toAdd);g.toRemove.length&&l.removeCustomItems&&l.removeCustomItems({animated:!0,squares:g.toRemove});Object.keys(g.toUpdate).length&&l.updateCustomItems&&l.updateCustomItems(g.toUpdate);t=Object.assign({},h.customItem)}}],name:fe.Plugin.Name}}function createDebugPlugin(){var t,r;return{create:function create(t){t.logger.on(qe.Events.EntryAdded,logToConsole)},name:me.Plugin.Name};function logToConsole(i){i.code===ke.a.LogCodes.State&&JSON.stringify(i.data)===t||i.code===ke.a.LogCodes.Event&&i.data.type===ke.a.UserEvents.Pointermove&&r===ke.a.UserEvents.Pointermove||i.code===ke.a.LogCodes.Event&&i.data.type===ke.a.UIEvents.Resize&&r===ke.a.UIEvents.Resize||(i.code===ke.a.LogCodes.State&&(t=JSON.stringify(i.data)),i.code===ke.a.LogCodes.Event&&(r=i.data.type),console.group(i.code),i.level===qe.Levels.Error?console.error(i.data):console.log(i.data),console.groupEnd())}}!function(t){!function(t){t.EntryAdded="EntryAdded"}(t.Events||(t.Events={})),function(t){t.Debug="Debug",t.Error="Error",t.None="None"}(t.Levels||(t.Levels={}))}(qe||(qe={}));i(94);var Xe,Ke=i(42),Ye=i(40);function createEffectsMethods(t){var r=t.board,i=t.el,o=t.options,a=document.createComment("/Effects");r.addToDom({el:a,insertAfter:!0,type:Ve.b.HoverSquare});var l=Object(Be.a)();return{addEffects:addEffects,removeEffects:removeEffects,updateEffects:function updateEffects(t){removeEffects(Object.keys(t)),addEffects(t)}};function addEffects(t){Object.keys(t).forEach((function(r){var h,g=document.createElement("div"),y=t[r].type;(g.classList.add("effect"),g.innerHTML=Object(Ye.a)({path:Ke.a[y],size:"100%"}),Object(Ue.a)({el:g,square:t[r].key}),o.test)&&Object(ze.c)(g,(h={},j()(h,ze.b.Element,ze.a.Effect),j()(h,ze.b.Square,t[r].key),j()(h,ze.b.Type,t[r].type),h));i.insertBefore(g,a),l.set(r,g)}))}function removeEffects(t){t.forEach((function(t){if(l.isDefined(t)){var i=l.get(t);r.el.removeChild(i),l.deleteItem(t)}}))}}function createEffectsPlugin(){var t={};return{match:[{condition:is(ke.a.InstanceEvents.RendererSet),handler:function init(r,i){var o=i.renderer;null==o||o.extendRenderer(createEffectsMethods),t={},updateRenderedEffects(r,i)}},{condition:isNot(ke.a.UserEvents.Pointermove),handler:updateRenderedEffects}],name:ve.Plugin.Name};function updateRenderedEffects(r,i){var o=i.api,a=i.options,l=i.renderer,h=o.getMarkings();if(a.allowMarkings||(h.effect={}),l){var g=function getEffectDiffs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{toAdd:diffsToAdd(t,r),toRemove:Object.keys(diffsToRemove(t,r)),toUpdate:diffsToUpdate(t,r)}}(t,h.effect);Object.keys(g.toAdd).length&&l.addEffects&&l.addEffects(g.toAdd,i),g.toRemove.length&&l.removeEffects&&l.removeEffects(g.toRemove,i),Object.keys(g.toUpdate).length&&l.updateEffects&&l.updateEffects(g.toUpdate,i),t=Object.assign({},h.effect)}}}function createFadeSetupPlugin(){return{match:[{condition:is(ke.a.APIEvents.Load),handler:function fadeSetup(t,r){var i;null===(i=null==r?void 0:r.renderer)||void 0===i||i.fadeSetup(r)}}],name:ye.Plugin.Name}}function createFlipBoardPlugin(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe.FlipBoardModifierKey;return{match:[{condition:isOneOf([ke.a.InstanceEvents.Create,ke.a.InstanceEvents.RendererSet,ke.a.OptionsEvents.Update]),handler:runFlipBoardPlugin},{condition:is(Ne.Events.Keydown),handler:onKeydown}],name:Xe.Plugin.Name};function onKeydown(t,i){var o=i.api,a=i.options,l=i.queue;t.data===r&&l.add(o.setOptions,{flipped:!a.flipped})}function runFlipBoardPlugin(r,i){var o=i.options,a=i.renderer,l=i.state;if(a){if(o.flipped!==t){a.flipBoard(o.flipped,i);var h=l.get(ke.a.State.PromotionMove);h&&a.openPromotionWindow(h,i)}t=o.flipped}}}function isNotOneOf(t){return function isType(r){return!t.includes(r.type)}}function createHighlightsPlugin(t){var r,i=Object(Be.a)(),o=I()(t);return{api:function api(){return{addModule:addModule,getModules:getModules,removeModule:removeModule}},create:function create(){r=function createGetObjectDiff(t){var r=Object(Be.a)(),i=[],o=Object(Be.a)();return function getDiff(a,l){i.length=0;var h=a.getCollection(),g=l.getCollection();for(var y in h)h.hasOwnProperty.call(h,y)&&(r.deleteItem(y),o.deleteItem(y),l.isDefined(y)||i.push(y));for(var _ in g)if(g.hasOwnProperty.call(g,_)&&(a.isDefined(_)||r.set(_,l.get(_)),a.isDefined(_))){var x=a.get(_),w=l.get(_);t(x,w)&&o.set(_,l.get(_))}return{toAdd:r,toRemove:i,toUpdate:o}}}(highlightsAreNotEqual)},destroy:function destroy(t){var r=t.renderer;null==r||r.removeSquares(i.keys(),t)},match:[{condition:isNotOneOf([ke.a.UserEvents.Pointermove,ke.a.InstanceEvents.RendererSet]),handler:updateRenderedHighlights},{condition:is(ke.a.InstanceEvents.RendererSet),handler:function resetHighlights(t,r){i=Object(Be.a)(),updateRenderedHighlights(t,r)}}],name:ie.Plugin.Name};function highlightsAreNotEqual(t,r){return Boolean(t.color!==r.color||t.opacity!==r.opacity)}function addModule(t,r){o.find((function(r){return r===t}))||(r?o.splice(r,0,t):o.push(t))}function getModules(){return I()(o)}function removeModule(t){var r=o.findIndex((function(r){return r===t}));r>-1&&o.splice(r,1)}function updateRenderedHighlights(t,a){var l=a.renderer,h=Object(Be.a)(o.reduce((function(r,i){return Object.assign(r,i(t,a).getCollection()),r}),{})),g=r(i,h),y=g.toAdd,_=g.toUpdate,x=g.toRemove;return i=Object(Be.a)(Object.assign({},h.getCollection())),y.keys().length&&(null==l||l.addSquares(y,a)),x.length&&(null==l||l.removeSquares(x,a)),_.keys().length&&(null==l||l.updateSquares(_,a)),t}}!function(t){t.FlipBoardModifierKey="x",function(t){t.Name="flip-board"}(t.Plugin||(t.Plugin={}))}(Xe||(Xe={}));var Ze,Qe=i(7);function pipeConditions(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return function checkMultipleConditions(t,i){return r.every((function(r){return r(t,i)}))}}function createHoverSquarePlugin(){var t,r=createStateMachine({data:{square:void 0},initialState:"hidden",states:{hidden:{dragPiece:function dragPiece(t){return{data:{square:t},nextState:"showing"}}},showing:{dragPiece:function dragPiece(t){return{data:{square:t},nextState:"showing"}},dropPiece:function dropPiece(){return{nextState:"hidden"}},setOptionToFalse:function setOptionToFalse(){return{nextState:"hidden"}}}}});return{match:[{condition:pipeConditions((t=Qe.a.BooleanOptions.HoverSquareOutline,function optionValueIsTruthy(r,i){var o,a;return Boolean(null===(a=null===(o=i.api)||void 0===o?void 0:o.getOptions)||void 0===a?void 0:a.call(o)[t])}),isNotOneOf([ke.a.APIEvents.ClearMarkings,Oe.Events.Tick])),handler:function updateHoverSquare(t,i){var o=i.options,a=i.renderer,l=i.state,h=!0!==l.get(ke.a.State.HideHoverSquare)&&l.get(ke.a.State.MachineState)!==Fe.States.PromotionAreaShowing&&l.get(ke.a.State.DraggingPiece),g=t.data&&(t.data.square||t.data.squareInsideBoard||h),y=!1;y=o.highlightMoves?h?r.transition("dragPiece",g):r.transition("dropPiece"):r.transition("setOptionToFalse");if(!y||!a)return;"hidden"===r.getCurrentState()?a.hideHoverSquare(i):a.showHoverSquare(r.getData().square,i)}}],name:xe.Plugin.Name}}function createMoveHintsPlugin(){var t=[];return{match:[{condition:isNotOneOf([ke.a.UserEvents.Pointermove,Oe.Events.Tick]),handler:updateMoveHints},{condition:is(ke.a.InstanceEvents.RendererSet),handler:function resetMoveHints(r,i){t=[],updateMoveHints(r,i)}}],name:we.Plugin.Name};function updateMoveHints(r,i){var o=i.renderer;o&&(t=function updateHints(t){var r=t.addMoveHints,i=t.addCaptureHints,o=t.context,a=t.currentHints,l=t.getNextHints,h=t.removeHints,g=a,y=o.api,_=o.mode,x=o.options,w=o.state;if(!x||!x.highlightLegalMoves||!_.isAllowedToMove())return h(I()(a),o),g.length=0,g;var S=w.get(ke.a.State.SelectedPiece)||w.get(ke.a.State.DraggingPiece);if(!S)return g.length&&(h(g,o),g=[]),g;var M=w.get(ke.a.State.MachineState)===Fe.States.PromotionAreaShowing?[]:y.getLegalMovesForSquare(S),T=g.filter((function(t){return!M.includes(t)}));h(T,o);var P=l(M),C=[],A=[],O=y.getPieces().keys();return P.forEach((function(t){i&&O.includes(t)?A.push(t):C.push(t)})),C.length&&r(C,o),A.length&&(null==i||i(A,o)),g.filter((function(t){return!T.includes(t)})).concat(P)}({addMoveHints:o.addMoveHints,addCaptureHints:o.addCaptureHints,context:i,currentHints:t,getNextHints:function getNextHints(r){return r.filter((function(r){return!t.includes(r)}))},removeHints:o.removeHints}))}}function createPiecesPlugin(){return{match:[{condition:isOneOf(ke.a.APIEvents),handler:function updatePieces(t,r){var i=r.renderer;if(!i)return;if(t.type===ke.a.APIEvents.IllegalMove)return void i.illegalMove(r);var o=t.data,a=o.plyDiff,l=o.move,h=o.pieces;if(h)return void i.loadPieces({pieces:h},r);if(l&&-1===a)return void i.undoMove(l,r);l&&i.makeMove(l,r)}},{condition:is(ke.a.InstanceEvents.RendererSet),handler:function reloadPieces(t,r){var i=r.api,o=r.renderer;null==o||o.loadPieces({pieces:i.getPieces()},r)}}],name:Se.Plugin.Name}}function createRendererErrorCatcherPlugin(){var t={};return{create:create,destroy:function destroy(r){var i=r.renderer;if(!i)return;Object.keys(t).forEach((function(r){i[r]=t[r]})),t={}},match:[{condition:is(ke.a.InstanceEvents.RendererSet),handler:function handler(t,r){return create(r)}}],name:Ze.Plugin.Name};function create(r){var i=r.options,o=r.renderer;o&&!i.test&&["dragPiece","dropPiece","makeMove","removePiece","undoMove"].forEach((function(i){var a=function reloadOnError(t){var r=t.context,i=t.method;return function wrappedRendererMethod(){try{return i.apply(void 0,arguments)}catch(l){var t=r.api,o=r.logger,a=r.renderer;console.error("Board position reloaded due to game and renderer state desynchronisation:\n",l),o.log({code:Ze.ErrorCodes.StateDesynchronisation,data:l,level:qe.Levels.Error}),null==a||a.loadPieces({pieces:t.getPieces(),reloadAll:!0},r)}}}({context:r,method:o[i]});t[i]=o[i],o[i]=a}))}}!function(t){!function(t){t.StateDesynchronisation="StateDesynchronisation"}(t.ErrorCodes||(t.ErrorCodes={})),function(t){t.Name="rendererErrorCatcher"}(t.Plugin||(t.Plugin={}))}(Ze||(Ze={}));var Je=i(39);function getThemeUrls(t,r){return["webm","ogg","mp3","wav"].map((function(i){return function getThemeUrl(t){var r=t.theme,i=void 0===r?"default":r,o=t.type,a=t.format;return"".concat(Je.a.soundsTheme,"_").concat(a.toUpperCase(),"_/").concat(i,"/").concat(o,".").concat(a)}({format:i,theme:t,type:r})}))}const et=["mousedown","keydown","touchstart","touchend"];let tt=!1;const nt=window.chesscom||{},rt=window.AudioContext||window.webkitAudioContext;let it=Boolean(rt);function isSuspended(){return it}function resumeAudio(t){if(rt){if(nt.audioContext||(nt.audioContext=function newAudioContext(){try{return new rt}catch(t){return null}}()),!nt.audioContext||!nt.audioContext.resume)return it=!1,void t();nt.audioContext.resume().then((()=>{it=!1,t()}))}}class Sound{constructor(t,r){this.tags=[],this.assets=t,this.maxTags=r}load(){this.unload(),this.addTag()}addTag(){const t=document.createElement("audio");t.setAttribute("preload","auto"),this.assets.forEach((r=>{const i=r.split(".").pop(),o="mp3"===i?"audio/mpeg":"audio/"+i,a=document.createElement("source");a.setAttribute("src",r),a.setAttribute("type",o),t.appendChild(a)})),document.body.appendChild(t),t.pause&&t.pause(),this.tags.push(t)}unload(){for(;this.tags.length;){const t=this.tags.shift();(null==t?void 0:t.parentNode)&&t.parentNode.removeChild(t)}}play(){const t=this.tags.find((t=>t.paused||t.ended));if(!t){if(this.tags.length>=this.maxTags)return;return this.addTag(),void this.play()}const r=t.play();r&&r.catch((()=>{}))}}var ot;!function(t){t.Suspended="web-ui-sound-suspended",t.Enabled="web-ui-sound-enabled"}(ot||(ot={}));let at=0,st=!1;function whenEnabled(t){!function waitMessage(t,r){window.addEventListener("message",(function listener(i){var o;(null===(o=null==i?void 0:i.data)||void 0===o?void 0:o.key)===t&&(r(),window.removeEventListener("message",listener))}))}(ot.Enabled,t)}function enableSound(){isSuspended()&&resumeAudio((()=>{window.postMessage({key:ot.Enabled},window.location.origin),function removeWindowEvents(t){tt&&(tt=!1,et.forEach((r=>window.removeEventListener(r,t))))}(enableSound)}))}function loadSound(t,r=5){const i=new Sound(t,r);return isSuspended()?(!function addWindowEvents(t){tt||(tt=!0,et.forEach((r=>window.addEventListener(r,t))))}(enableSound),whenEnabled((()=>i.load()))):i.load(),i}var ct=[Pe.BoardSounds.GameStart,Pe.BoardSounds.GameEnd,Pe.BoardSounds.Capture,Pe.BoardSounds.Castle,Pe.BoardSounds.Premove,Pe.BoardSounds.MoveSelf,Pe.BoardSounds.MoveCheck,Pe.BoardSounds.MoveOpponent,Pe.BoardSounds.Promote,Pe.BoardSounds.Notify,Pe.BoardSounds.TenSeconds,Pe.BoardSounds.Illegal];function createSounds(t){var r,i=ct,o="default";t&&(i=t.codes,o=t.theme);var a=o;return load({codes:i,theme:o}),{destroy:function destroy(){Object.keys(r).forEach((function(t){r[t].unload()}))},getSounds:function getSounds(){return r},getTheme:function getTheme(){return a},load:load,play:function play(t){var i=r[t];if(!i)return null;try{return function Sound_playSound(t){isSuspended()?!st&&at>3?(at=0,st=!0,window.postMessage({key:ot.Suspended},window.location.origin)):st||(at++,enableSound(),whenEnabled((()=>t.play()))):t.play()}(i)}catch(o){return null}}};function load(t){a=t.theme,r=(t.codes||ct).reduce((function(t,r){return t[r]=loadSound(getThemeUrls(a,r),Pe.maxTagsPerSound),t}),{}),enableSound()}}var lt=i(64),ut=i(47);function isPromotion(t){return t.flags===We.a.Move.Flags.Promotion||t.flags===We.a.Move.Flags.CapturePromotion}function createSoundsPlugin(t){var r=t;return{api:function api(){return{getSoundsInstance:function getSoundsInstance(){return r}}},match:[{condition:isNot(ke.a.UserEvents.Pointermove),handler:function runPlaySoundPlugin(t,i){var o,a=i.api,l=i.options,h=i.state;r||(r=createSounds({theme:l.soundTheme}));if(t.type===ke.a.OptionsEvents.Update&&l.soundTheme!==r.getTheme())return r.destroy(),r.load({theme:l.soundTheme}),t;if(t.type===ke.a.SoundEvents.Play)return r.play(t.data.sound),h.set({soundPlayed:t.data.sound}),!1;if(!l.playSounds||!(null===(o=t.data)||void 0===o?void 0:o.plyDiff))return!1;var g=a.getSelectedNode();t.type===ke.a.APIEvents.MoveBackward&&(g=t.data.move);if(!g)return!1;var y=a.getPlayingAs(),_=Boolean(y&&y!==g.color),x=function getSoundType(t,r){return t&&t.san?function is_check_isCheck(t){return!(!t||!t.san)&&["+","#"].includes(t.san.slice(-1))}(t)?Pe.BoardSounds.MoveCheck:t.isPremove?Pe.BoardSounds.Premove:Object(lt.a)(t)?Pe.BoardSounds.Capture:Object(ut.a)(t)?Pe.BoardSounds.Castle:isPromotion(t)?Pe.BoardSounds.Promote:r?Pe.BoardSounds.MoveOpponent:Pe.BoardSounds.MoveSelf:null}(g,_);x&&(r.play(x),h.set({soundPlayed:x}));return!1}}],name:Pe.Plugin.Name}}function createTimeControlPlugin(t){return{create:function create(r){var i=r.api;t&&i.timeControl.set(t)},name:Ae.Plugin.Name}}function createKeysService(t,r){var i=!0,o=new Set;return document.addEventListener("keydown",onKeydown),document.addEventListener("keyup",onKeyup),{isPressed:function isPressed(t){return o.has(t)},disable:function disable(){i=!1},enable:function enable(){i=!0},destroy:function destroy(){document.removeEventListener("keydown",onKeydown),document.removeEventListener("keyup",onKeyup)}};function onKeydown(r){var a,l=document.activeElement;if(i&&!function isElementBlacklisted(t){return Boolean(!t||t.isContentEditable||["INPUT","TEXTAREA"].includes(t.tagName))}(l)){var h=null===(a=r.key)||void 0===a?void 0:a.toLowerCase();h&&(o.add(h),t(h))}}function onKeyup(t){var i,a=null===(i=t.key)||void 0===i?void 0:i.toLowerCase();a&&(o.delete(a),r(a))}}var dt=i(17);function createKeysPlugin(){var t,r=createKeysService((function onKeydown(r){null==t||t(Object(dt.a)(Ne.Events.Keydown,r))}),(function onKeyup(r){null==t||t(Object(dt.a)(Ne.Events.Keyup,r))}));return{api:function api(){return{isPressed:r.isPressed}},create:function create(r){t=r.run},destroy:function destroy(){null==r||r.destroy()},match:[{condition:is(ke.a.OptionsEvents.Update),handler:function updateKeysPlugin(t,i){i.options.captureKeyStrokes?r.enable():r.disable()}}],name:Ne.Plugin.Name}}var ht,pt=i(20);function getHighlightedSquareColor(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qe.a.HighlightedSquareTypes.Move,o=null===(r=Object(pt.c)(t.boardStyle))||void 0===r?void 0:r.highlightColor;switch(i){case Qe.a.HighlightedSquareTypes.Move:return t.highlightColor||o||Qe.a.HighlightedSquareColors.Selected;case Qe.a.HighlightedSquareTypes.Selected:return o||Qe.a.HighlightedSquareColors.Selected;default:return Qe.a.HighlightedSquareColors.Selected}}function createHighlightedSquare(t){var r,i,o=t.color,a=t.type,l=t.keyPressed,h=void 0===l?"default":l,g=t.options,y=t.square,_=t.turn;switch(a){case We.a.HighlightedSquare.Types.Analysis:r=g.analysisHighlightColors[We.a.Node.Marking.JCEColorsMap[h]],i=g.analysisHighlightOpacity;break;case We.a.HighlightedSquare.Types.Premove:r=g.premoveHighlightColor,i=g.premoveHighlightOpacity;break;default:r=o||getHighlightedSquareColor(g),i=g.highlightOpacity}return{color:r,opacity:i,square:y,turn:_,type:a}}function getAnalysisHighlights(t,r){var i=r.api,o=r.options;if(!o||!o.allowMarkings)return Object(Be.a)();var a=i.getMarkings().square,l=Object(Be.a)();return Object.keys(a).forEach((function(t){var r=a[t],i=function getHighlightedSquare(){if(Object.values(We.a.Node.Marking.ColorKeys).includes(r.color))return createHighlightedSquare({keyPressed:r.color,options:o,square:r.key,type:We.a.HighlightedSquare.Types.Analysis});return function createMarkedSquare(t,r){return Object.assign({square:t},r)}(r.key,Object.assign({color:r.color},r))}();l.set(t,i)})),a&&0!==Object.keys(a).length?l:Object(Be.a)()}function isLine(t){return void 0!==t.id}function getMoveHighlights(t,r){var i=r.api,o=r.options;if(!o||!o.highlightMoves)return Object(Be.a)();var a=i.getSelectedNode();if(!a||isLine(a))return Object(Be.a)();var l=[a.from,a.to].reduce((function(t,r){return r?(t[r]=createHighlightedSquare({options:o,square:r,turn:a.color,type:We.a.HighlightedSquare.Types.Move}),t):t}),{});return Object(Be.a)(l)}function getSelectionSquare(t,r){var i,o=r.options,a=r.state;if(!o||!o.highlightMoves)return Object(Be.a)();var l=a.get(ke.a.State.SelectedPiece)||a.get(ke.a.State.DraggingPiece);return l?Object(Be.a)(j()({},l,createHighlightedSquare({color:null===(i=Object(pt.c)(o.boardStyle))||void 0===i?void 0:i.highlightColor,options:o,square:l,type:We.a.HighlightedSquare.Types.Selection}))):Object(Be.a)()}function createAccessibilityPlugin(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ht.DefaultRightClickModifierKey;return{beforeState:[{condition:is(ke.a.UserEvents.PointerdownLeft),handler:convertToPointerdownRightIfModifierKeyPressed}],name:ht.Plugin.Name,requires:["keys"]};function convertToPointerdownRightIfModifierKeyPressed(r,i){var o=i.api,a=i.queue,l=i.run;return!o.keys.isPressed(t)||(a.add(l,Object.assign(Object.assign({},r),{type:ke.a.UserEvents.PointerdownRight})),!1)}}!function(t){t.DefaultRightClickModifierKey="a",function(t){t.Name="accessibility"}(t.Plugin||(t.Plugin={}))}(ht||(ht={}));var ft=i(23),mt=i.n(ft),gt=i(36),vt=i.n(gt);class Store{constructor(t="keyval-store",r="keyval"){this.storeName=r,this._dbp=new Promise(((i,o)=>{const a=indexedDB.open(t,1);a.onerror=()=>o(a.error),a.onsuccess=()=>i(a.result),a.onupgradeneeded=()=>{a.result.createObjectStore(r)}}))}_withIDBStore(t,r){return this._dbp.then((i=>new Promise(((o,a)=>{const l=i.transaction(this.storeName,t);l.oncomplete=()=>o(),l.onabort=l.onerror=()=>a(l.error),r(l.objectStore(this.storeName))}))))}}let yt;function getDefaultStore(){return yt||(yt=new Store),yt}function idb_keyval_get(t,r=getDefaultStore()){let i;return r._withIDBStore("readonly",(r=>{i=r.get(t)})).then((()=>i.result))}function idb_keyval_extensions_setMany(t,r){return r._withIDBStore("readwrite",(function(r){t.forEach((function(t){r.put(t,t.f)}))}))}var bt,_t,xt="IS_POPULATED";function getDB(){return bt}function _initDB(){return(_initDB=vt()(mt.a.mark((function _callee2(t,r){return mt.a.wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",storeIsPopulated().then(function(){var i=vt()(mt.a.mark((function _callee(i){return mt.a.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(i){o.next=2;break}return o.abrupt("return",populateStore(t,r).then(setPopulated));case 2:return o.abrupt("return",Promise.resolve());case 3:case"end":return o.stop()}}),_callee)})));return function(t){return i.apply(this,arguments)}}()));case 1:case"end":return i.stop()}}),_callee2)})))).apply(this,arguments)}function setPopulated(){return function idb_keyval_set(t,r,i=getDefaultStore()){return i._withIDBStore("readwrite",(i=>{i.put(r,t)}))}(xt,!0,bt)}function storeIsPopulated(){return _storeIsPopulated.apply(this,arguments)}function _storeIsPopulated(){return(_storeIsPopulated=vt()(mt.a.mark((function _callee3(){return mt.a.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",idb_keyval_get(xt,bt).then(Boolean));case 1:case"end":return t.stop()}}),_callee3)})))).apply(this,arguments)}function populateStore(t,r){return _populateStore.apply(this,arguments)}function _populateStore(){return(_populateStore=vt()(mt.a.mark((function _callee4(t,r){return mt.a.wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",r.get(t).then((function(t){var r;return idb_keyval_extensions_setMany(null!==(r=t.data)&&void 0!==r?r:t,bt)})));case 1:case"end":return i.stop()}}),_callee4)})))).apply(this,arguments)}function getECO(t){var r=t.ecoPath,i=t.fens,o=t.http,a=function formatFENsForECOLookup(t){return t.reverse().map((function(t){return t.split(" ").slice(0,3).join(" ")}))}(i);return function initDB(t,r){return _initDB.apply(this,arguments)}(r,o).then((function(){return function getECOValuesFromDB(t){return Promise.all(t.map((function(t){return idb_keyval_get(t,getDB())})))}(a).then((function(t){return t.find(Boolean)}))}))}function getOpeningsLink(t){var r=t.cleanUrl,i=t.generateURL,o=t.routeType;return i?i(o,{cleanUrl:r}):r||void 0}function updateOpeningData(t,r){var i=t.firstChild;i&&(i.innerText=function buildInnerEcoText(t){return t?t.ecoText:""}(r),!r.link&&i.href&&(i.removeAttribute("href"),i.removeAttribute("target")),r.link&&(i.setAttribute("href",null==r?void 0:r.link),i.setAttribute("target","_blank")))}function createUpdateECO(t){var r,i=t.ecoPath,o=t.el,a=t.generateURL,l=t.http,h=t.placeholderText,g=t.routeType,y=t.shouldLinkToOpenings,_=t.translator;return function updateECO(t){var o=t.api.getHistoryFENs();getECO({ecoPath:i,fens:o,http:l}).then((function(t){if(!t)return handleEcoUpdate(r={ecoText:h?h.customPosition:ge.Config.Text.CustomPosition});ge.Config.InitialFen.includes(t.f)&&(t.n=h?h.startingPosition:ge.Config.Text.StartingPosition,t.u="");var i,o={ecoText:(i=t.n,_?_(i):i),link:y&&Boolean(t.u)?getOpeningsLink({cleanUrl:t.u,generateURL:a,routeType:g}):void 0};(function hasOpeningChanged(t){return!((null==r?void 0:r.ecoText)===(null==t?void 0:t.ecoText)&&(null==r?void 0:r.link)===(null==t?void 0:t.link))})(o)&&handleEcoUpdate(o)}))};function handleEcoUpdate(t){var i=o.hasChildNodes();r=t,i||function initializeEcoComponent(t){var r=t.el,i=t.openingData,o=t.shouldLinkToOpenings,a=document.createElement(o?"a":"span");a.setAttribute("class",_t.Classes.OpeningText),r.appendChild(a),r.classList.add(_t.Classes.Panel),updateOpeningData(r,i)}({el:o,openingData:t,shouldLinkToOpenings:y}),updateOpeningData(o,r)}}!function(t){!function(t){t.Panel="eco-panel",t.OpeningText="eco-opening-text"}(t.Classes||(t.Classes={}))}(_t||(_t={}));var wt,St;i(96);!function(t){t.ECO="chesscom_eco"}(wt||(wt={})),function(t){t.ECO="eco"}(St||(St={}));var Mt={get:function get(t){return fetch(t,{method:"GET"}).then((function(t){return t.json()}))}},Et=[ke.a.APIEvents.CreateGame,ke.a.APIEvents.DeletePosition,ke.a.APIEvents.Load,ke.a.APIEvents.Move,ke.a.APIEvents.MoveBackward,ke.a.APIEvents.MoveForward,ke.a.APIEvents.MoveVariation,ke.a.APIEvents.PromoteVariation,ke.a.APIEvents.SelectLineEnd,ke.a.APIEvents.SelectLineStart,ke.a.APIEvents.SelectNode,ke.a.APIEvents.Reload,ke.a.APIEvents.ResetToMainLine,ke.a.APIEvents.Undo];function createEcoPlugin(t){var r,i=t.ecoPath,o=void 0===i?"":i,a=t.el,l=t.generateURL,h=t.http,g=void 0===h?Mt:h,y=t.placeholderText,_=t.routeType,x=void 0===_?"":_,w=t.shouldLinkToOpenings,S=void 0!==w&&w,M=t.storeData,T=void 0===M?{name:wt.ECO,table:St.ECO}:M,P=t.translator;if(!("indexedDB"in window))return{name:ge.Name};return{api:r,create:function create(t){getDB()||function createDB(t){var r=t.name,i=t.table;bt=new Store(r,i)}(Object.assign({},T)),(r=function createECOAPI(t){return{updateECO:createUpdateECO(t)}}({ecoPath:o,el:a,generateURL:l,http:g,placeholderText:y,routeType:x,shouldLinkToOpenings:S,translator:P})).updateECO(t)},destroy:function destroy(){a.innerHTML="",a.classList.remove(_t.Classes.Panel)},match:[{condition:isOneOf(Et),handler:function updateECO(t,i){r.updateECO(i)}}],name:ge.Name}}function createPregamePlugin(){var t,r=!1;return{create:function create(i){var o=i.api;if(!o.premoves)return"The premoves plugin must be registered in order to use the pregame plugin.";return void(t=o.extendAPI(Me.Plugin.Name,{pregame:function pregame(){return function createPregame(t){var i=t.api;return{get:get,set:set};function get(){return r}function set(t){var o;r=t,setTurn(i),!1===t&&(i.setTurn(We.a.ColorsAsNumbers.White),null===(o=i.premoves)||void 0===o||o.consumeNext())}}(i)}}))},destroy:function destroy(){t()},match:[{condition:is(ke.a.APIEvents.SetPlayingAs),handler:function handler(t,r){return setTurn(r.api)}}],name:Me.Plugin.Name,requires:["premoves"]};function setTurn(t){r&&t.setTurn(t.getPlayingAs()===We.a.ColorsAsNumbers.White?We.a.ColorsAsNumbers.Black:We.a.ColorsAsNumbers.White)}}function createCancelPremoves(t,r){return function cancelPremoves(){t.premoves.cancel(),r.apply(void 0,arguments)}}function isAllowedToMoveInPlayingMode(t){var r=t.api,i=t.canMoveWhenNotPlayerTurn,o=t.modeOptions,a=o.canAddMovesToMainLine,l=o.canMoveWhenGameIsOver,h=o.canModifyExistingMovesOnMainLine;return Boolean((l||!r.isGameOver())&&(a&&r.isAtEndOfLine()||h)&&(i||r.getPlayingAs()===r.getTurn()))}function createIsAllowedToMove(t,r){return function isAllowedToMove(){return isAllowedToMoveInPlayingMode({api:r,canMoveWhenNotPlayerTurn:!0,modeOptions:t.getOptions()})}}function createCancel(t){return function cancel(){var r=t.api,i=t.game;return r.premoves.getQueue().length?(i.premove.cancel(),r.reload()):null}}function setTimestampOnNode(t){var r,i=t.api,o=t.node,a=t.timestamp,l=i.getContext(),h=l.game,g=l.respond,y=o.ids,_=y.line,x=y.move;if(null===a)return(null===(r=o.commands)||void 0===r?void 0:r.timestamp)&&delete o.commands.timestamp,g(ke.a.APIEvents.NodeUpdated,{changes:{timestamp:a,node:o}});o.commands||(o.commands={}),h.updateNode({commands:Object.assign(o.commands,{timestamp:"".concat(a)})},x,_)}function millisecondsToDeciseconds(t){return Math.round(t/100)}function isNode(t){var r;return void 0!==(null===(r=t)||void 0===r?void 0:r.ids)}function getPreviousNodeOfSameColor(t){var r=t.api,i=t.node,o=r.getNodeByIds({move:i.ids.move-2,line:i.ids.line});return isNode(o)?o:null}function addTimeToConsumedPremove(t){var r=t.api,i=t.timeControl,o=r.getLine(0);if(!o)return null;var a=o[o.length-1],l=getPreviousNodeOfSameColor({api:r,node:a}),h=i.baseTime,g=i.increment,y=function getGameTimeLeft(t){var r=t.baseTime,i=t.increment,o=t.lastNodeTime;return getStartingTime()-1;function getStartingTime(){return o?o+i:r}}({baseTime:millisecondsToDeciseconds(h),increment:millisecondsToDeciseconds(g),lastNodeTime:null==l?void 0:l.time});return y&&a&&(a.time=y),y}function createConsumeNext(t){return function consumeNext(){var r=t.api,i=t.game,o=t.mutateGame,a=t.respond;if(!r.premoves.getQueue().length)return null;if(r.isGameOver())return r.premoves.cancel();r.premoves.reload();var l=o((function consume(){i.premove.consume()}));if(!l||0===l.plyDiff)return a(ke.a.APIEvents.IllegalMove,null);if(l.consumedPremove=!0,r.premoves.getQueue().length&&(l.pieces=r.premoves.getPieces()),l.move){var h=r.timeControl.get();h&&(addTimeToConsumedPremove({api:r,timeControl:h}),setTimestampOnNode({api:r,node:l.move,timestamp:1})),Object.assign(l.move,{animate:!1,userGenerated:!0})}return l.result&&r.setResult(l.result),a(ke.a.APIEvents.Move,l)}}function get_legal_moves_for_square_createGetLegalMovesForSquare(t){return function getLegalMovesForSquare(r){var i=t.game.premove.moves(r);return i?i.filter((function(t){return void 0===r||t.from===r})).map((function(t){return t.to})).filter((function(t,r,i){return i.indexOf(t)===r})):[]}}function get_move_createGetMove(t){return function getMove(r){var i=t.game,o=i.premove.moves(r.from),a=o?o.find((function(t){return t.to===r.to})):null;return a?i.moveDetails(Object.assign({},a)):null}}function get_pieces_createGetPieces(t){return function getPieces(){var r=t.game;return Object(Be.a)(r.premove.getPieces(!0))}}function createGetQueue(t){return function getQueue(){return t.game.premove.queue}}function createIsLegalMove(t){return function isLegalMove(r){var i=t.game;return!!i.premove.move(r)&&(i.undo(),!0)}}function createLoadQueue(t){return function loadQueue(r){var i,o=t.game;o.premove.queue.length=0,(i=o.premove.queue).push.apply(i,I()(r))}}function move_createMove(t){return function move(r){var i=t.api,o=t.game,a=t.respond;return o.premove.move(r)?(i.getOptions().playSounds&&a(ke.a.SoundEvents.Play,{sound:Pe.BoardSounds.Premove}),a(ke.a.APIEvents.SetBoardPosition,{pieces:i.premoves.getPieces()})):null}}function createReload(t){return function reload(){var r=t.api;if(r.premoves.getQueue().length){var i=I()(r.premoves.getQueue());r.reload(),r.premoves.loadQueue(i)}else r.reload()}}function getPremoveHighlights(t,r){var i,o=r.api,a=r.options,l=null===(i=o.premoves)||void 0===i?void 0:i.getQueue();if(!a||!a.allowMarkings||!l.length)return Object(Be.a)();var h=Object(Be.a)();return l.forEach((function(t){t.from&&h.set(t.from,createHighlightedSquare({options:a,square:t.from,type:We.a.HighlightedSquare.Types.Premove}));var r=t.kingTo||t.to;h.set(r,createHighlightedSquare({options:a,square:r,type:We.a.HighlightedSquare.Types.Premove}))})),h}function createPremovesPlugin(){return{api:function createPremovesAPI(t){return{cancel:createCancel(t),consumeNext:createConsumeNext(t),getLegalMovesForSquare:get_legal_moves_for_square_createGetLegalMovesForSquare(t),getMove:get_move_createGetMove(t),getPieces:get_pieces_createGetPieces(t),getQueue:createGetQueue(t),isLegalMove:createIsLegalMove(t),loadQueue:createLoadQueue(t),move:move_createMove(t),reload:createReload(t)}},apiOverrides:{agreeDraw:function agreeDraw(t){var r=t.api;return createCancelPremoves(r,r.agreeDraw)},deletePosition:function deletePosition(t){var r=t.api;return createCancelPremoves(r,r.deletePosition)},getLegalMovesForSquare:function getLegalMovesForSquare(t){return function createGetLegalMovesForSquare(t){var r=t.getLegalMovesForSquare;return function getLegalMovesForSquare(i){return t.getPlayingAs()!==t.getTurn()?t.premoves.getLegalMovesForSquare(i):r(i)}}(t.api)},getMove:function getMove(t){return function createGetMove(t){var r=t.getMove;return function getMove(i){return t.getPlayingAs()!==t.getTurn()?t.premoves.getMove(i):r(i)}}(t.api)},getPieces:function getPieces(t){return function createGetPieces(t){var r=t.getPieces;return function getPieces(){return t.premoves.getQueue().length?t.premoves.getPieces():r()}}(t.api)},load:function load(t){var r=t.api;return createCancelPremoves(r,r.load)},move:function move(t){return function createMove(t){var r=t.move;return function move(i){var o;return t.premoves.getQueue().length&&t.premoves.reload(),t.getPlayingAs()!==t.getTurn()&&i.userGenerated&&(o=t.premoves.move(i)),o||r(i)}}(t.api)},moveBackward:function moveBackward(t){var r=t.api;return createCancelPremoves(r,r.moveBackward)},moveForward:function moveForward(t){var r=t.api;return createCancelPremoves(r,r.moveForward)},outOfTime:function outOfTime(t){var r=t.api;return createCancelPremoves(r,r.outOfTime)},resign:function resign(t){var r=t.api;return createCancelPremoves(r,r.resign)},selectLineEnd:function selectLineEnd(t){var r=t.api;return createCancelPremoves(r,r.selectLineEnd)},selectLineStart:function selectLineStart(t){var r=t.api;return createCancelPremoves(r,r.selectLineStart)},selectNode:function selectNode(t){var r=t.api;return createCancelPremoves(r,r.selectNode)},undo:function undo(t){var r=t.api;return createCancelPremoves(r,r.undo)}},beforeState:[{condition:isOneOf([ke.a.UserEvents.PointerdownRight,ke.a.APIEvents.Move]),handler:function extendCoreContext(t,r){var i=r.api,o=r.queue;if(!i.premoves.getQueue().length)return!0;if(t.type===ke.a.UserEvents.PointerdownRight)return o.add(i.premoves.cancel),!1;if(function eventIsMoveNotMadeByUser(t){return t.type===ke.a.APIEvents.Move&&!t.data.consumedPremove}(t))return o.add(i.premoves.consumeNext),!1;return!0}}],create:function create(t){var r=t.api;r.highlights&&r.highlights.addModule(getPremoveHighlights)},destroy:function destroy(t){var r,i=t.api;null===(r=i.highlights)||void 0===r||r.removeModule(getPremoveHighlights)},modeOverrides:{isAllowedToMove:createIsAllowedToMove},name:Ee.Plugin.Name}}function createReportingPlugin(t){var r=t.onAll,i=t.onDebug,o=t.onError;return{create:function create(t){if(!r&&!i&&!o)return;t.logger.on(qe.Events.EntryAdded,handleLogEntry)},name:Te.Plugin.Name};function handleLogEntry(t){i&&t.level===qe.Levels.Debug&&runCallback(i,t),o&&t.level===qe.Levels.Error&&runCallback(o,t),r&&runCallback(r,t)}function runCallback(t,r){!function requestIdleCallback(t,r){var i=window.requestIdleCallback;i?i(t,r):function fallback(t){var r=Date.now();setTimeout((function run(){t({didTimeout:!1,timeRemaining:function timeRemaining(){return Math.max(0,50-(Date.now()-r))}})}),1)}(t)}((function(){return t(r)}))}}var Tt=function noop(){};function createQueue(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=[],i=!1;return{add:add,clear:clear,flush:flush,getEntries:getEntries};function add(o){for(var a=Tt,l=Tt,h=new Promise((function(t,r){l=t,a=r})),g=arguments.length,y=new Array(g>1?g-1:0),_=1;_<g;_++)y[_-1]=arguments[_];return r.push({fn:o,params:y,reject:a,resolve:l}),t&&!1===i&&flush(),h}function clear(){i=!1,r.length=0}function flush(){return _flush.apply(this,arguments)}function _flush(){return(_flush=vt()(mt.a.mark((function _callee(){var t,o;return mt.a.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.shift()){a.next=4;break}return i=!1,a.abrupt("return");case 4:return i=!0,a.prev=5,a.next=8,t.fn.apply(t,I()(t.params));case 8:return o=a.sent,t.resolve(o),a.abrupt("return",flush());case 13:throw a.prev=13,a.t0=a.catch(5),t.reject(a.t0),a.t0;case 17:case"end":return a.stop()}}),_callee,null,[[5,13]])})))).apply(this,arguments)}function getEntries(){return r}}var Pt,Ct=i(57);function addCustomColor(t,r){Object.values(Pt.CssVariables).forEach((function setVariable(i){!function setCSSVariable(t){var r=t.el,i=t.value,o=t.variable;if(void 0!==i)return r.style.setProperty(o,i);r.style.removeProperty(o)}({el:t,value:r,variable:i})}))}!function(t){!function(t){t.Color="--nodeCustomColor"}(t.CssVariables||(t.CssVariables={}))}(Pt||(Pt={}));var At=i(5);function toFigurine(t,r){return t.toUpperCase()===t?function getFigurineHTML(t,r){return'<span class="icon-font-chess '.concat(function getPieceName(t){return We.a.Piece.Names[t.toLowerCase()]}(t),"-").concat(r,'" data-figurine="').concat(t,'"></span>')}(t,r):t}function formatText(t){var r=t.color,i=t.moveListDisplayType,o=t.san,a=t.translations;return o.split("").map((function(t){return"NBRQK".includes(t)?i===Qe.a.MoveListDisplayTypes.Figurine?toFigurine(t,r):a[t]():t})).join("")}var Ot=i(31);function is_ep_capture_isEPCapture(t){return t===We.a.Move.Flags.EPCapture}var Lt,It,Rt;function toClassString(t){return".".concat(t)}function scrollToNode(t){var r=t.containerEl,i=t.moveListEl,o=t.nodeEl;if(i&&o){var a=r||i,l=a.getBoundingClientRect(),h=o.getBoundingClientRect(),g=(l.bottom-l.top)/2,y=l.top-h.top+g;a.scrollTop-=y}}function createVMLDOM(t){var r=t.el,i=t.resultNodeIsSelectable,o=t.toggleTimestamps,a=[],l=function createState(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Object.assign({},t);return{get:get,set:set};function get(){return r}function set(t){Object.assign(r,t)}}(t);return{addMove:addMove,addNode:function addNode(t){var r=t.color,i=t.flags,o=t.ids,a=t.ply,l=t.san,h=t.wholeMoveNumber;if(!r||!a||!l||!h||getNodeElement(a))return;var g=getMoveElement(h);g||(g=addMove(h));var y=createNodeElement({color:Object(Ot.a)(r),moveId:o.move,isEPCapture:!!i&&is_ep_capture_isEPCapture(i),ply:a,san:l});if(!y)return;t.ply&&(null==t?void 0:t.hasOwnProperty("customColor"))&&addCustomColor(y,t.customColor);return g.appendChild(y)},addTimestamp:function addTimestamp(t){var r=t.baseTime,i=t.node,o=t.timestamp,a=t.title,l=t.value,h=i.color,g=i.ply,y=i.wholeMoveNumber;if(!h||!g||!y)return;var _=getMoveElement(y);if(!_)return;var x=getTimestampElement(g);x&&_.removeChild(x);var w=function createTimestampElement(t){var r=document.createElement("div");return r.setAttribute("data-ply",t.toString()),r.setAttribute("data-vml-element","timestamp"),r}(g);a&&function setTimestampElementTitle(t,r){r.title=t}(a,w);return setTimestampElementColor(h,w),setTimestampValue({baseTime:r,ply:g,timestamp:o,value:l},w),_.appendChild(w),w},clearList:function clearList(){destroyList(),createList()},createList:createList,deselectNode:function deselectNode(t){var r=t?getNodeElement(t):getSelectedNodeElement();if(!r)return;deselectNodeElement(r)},destroyList:destroyList,enableColors:function enableColors(t){if(l.get().colorsEnabled===t)return;l.set({colorsEnabled:t}),r.classList[t?"add":"remove"]("movelist-colored")},getLastPly:getLastPly,getParams:l.get,getResult:function getResult(){var t=getResultNodeElement();if(!t)return We.a.Results.None;return t.innerText},getResultNodeElement:getResultNodeElement,getTimestamp:function getTimestamp(t){var r=getTimestampElement(t);if(!r)return null;var i=r.getAttribute("data-time");if(0===(null==i?void 0:i.length))return null;return parseFloat(i)},hasResultNode:function hasResultNode(){return Boolean(r.querySelector(toClassString("game-result")))},isResultNodeSelected:function isResultNodeSelected(){var t;return Boolean(null===(t=r.querySelector(toClassString("game-result")))||void 0===t?void 0:t.classList.contains("selected"))},removeTimestamp:function removeTimestamp(t){var r=getTimestampElement(t);if(!r)return;r.parentNode.removeChild(r)},scrollToSelectedNode:function scrollToSelectedNode(){var t=l.get().scrollContainer,i=getSelectedNodeElement(),o=t||r;if(!i)return void(o.scrollTop=0);scrollToNode({containerEl:o,moveListEl:r,nodeEl:i})},selectNode:function selectNode(t){var r=getNodeElement(t);if(!r)return;selectNodeElement(r)},selectNodeElement:selectNodeElement,selectResultNode:function selectResultNode(){var t=getResultNodeElement();t&&(selectNodeElement(t),r.dispatchEvent(new CustomEvent(Lt.Events.SelectResultNode)))},setResultNode:function setResultNode(t){var o=getResultNodeElement();if(null!==o){var a=o.parentNode;if(!a)return;a.removeChild(o),0===a.childNodes.length&&a.parentNode.removeChild(a)}if(t===We.a.Results.None)return;var l,h=getNodeElements().slice(-1)[0],g=h&&function getNodeElementColor(t){return t.classList.contains(We.a.ColorsAsWords.Black)?We.a.ColorsAsNumbers.Black:We.a.ColorsAsNumbers.White}(h)!==We.a.ColorsAsNumbers.Black?We.a.ColorsAsWords.Black:We.a.ColorsAsWords.White,y=g===We.a.ColorsAsWords.White?addMove():function getMoveElements(){return Array.from(r.querySelectorAll("".concat(toClassString("move"))))}().slice(-1)[0];if(i){var _=getLastPly()||2;(l=createNodeElement({color:g,isEPCapture:!1,moveId:getNodeElements().length-1,ply:_,san:t,isResultNode:!0})).classList.add(g,"game-result")}else l=function createResultNodeElement(t,r){var i=document.createElement("span");return i.innerHTML=t,i.classList.add(r,"game-result"),i}(t,g);y.appendChild(l)},setTimestampValue:setTimestampValue,setParams:l.set,updateNodeColor:function updateNodeColor(t,r){var i=getNodeElement(t);if(!i)return;addCustomColor(i,r)}};function addMove(t){var i=document.createElement("div");return i.classList.add("move"),t&&(i.setAttribute("data-whole-move-number","".concat(t)),i.innerHTML="".concat(t,".")),r.appendChild(i),i}function createList(){destroyList(),r.classList.add("vertical-move-list"),o&&r.classList.add("toggle-timestamps")}function createNodeElement(t){var i=t.color,o=t.isEPCapture,h=t.isResultNode,g=t.moveId,y=t.ply,_=t.san,x=l.get(),w=x.EPIconInfoPath,S=x.moveListDisplayType,M=x.translations,T=document.createElement("div");if(T.setAttribute("data-ply",y.toString()),T.classList.add(i,"node"),T.innerHTML=formatText({color:i,moveListDisplayType:S,san:_,translations:M}),o){var P=function createEPIcon(t){var r=document.createElement("span");return r.classList.add("icon-font-chess","circle-info","en-passant-move-icon"),r.addEventListener(At.b,EPIconPointerdownHandler),{el:r,listener:{el:r,eventName:At.b,handler:EPIconPointerdownHandler}};function EPIconPointerdownHandler(r){r.stopPropagation(),window.open(t,"_blank")}}(w),C=P.el,A=P.listener;T.appendChild(C),a.push({el:C,eventName:At.b,handler:A.handler})}return T.addEventListener(At.b,halfMovePointerdownHandler),a.push({eventName:At.b,handler:halfMovePointerdownHandler}),T;function halfMovePointerdownHandler(){r.dispatchEvent(new CustomEvent(Lt.Events.SelectNode,{detail:{ids:{move:g,line:0},ply:y,isResultNode:h}}))}}function deselectNodeElement(t){t.classList.remove("selected")}function destroyList(){a.forEach((function(t){r.removeEventListener(t.eventName,t.handler)})),r.classList.remove("vertical-move-list"),r.innerHTML=""}function getLastPly(){var t=getNodeElements();if(t.length){var r=function getNodeElementPly(t){var r=t.getAttribute("data-ply");return r?parseInt(r,10):null}(t[t.length-1]);if(r)return r}}function getMoveElement(t){return r.querySelector("[".concat("data-whole-move-number",'="',t,'"]'))}function getNodeElement(t){return r.querySelector("".concat(toClassString("node"),"[","data-ply",'="').concat(t,'"]'))}function getNodeElements(){return Array.from(r.querySelectorAll("".concat(toClassString("node"))))}function getResultNodeElement(){return r.querySelector(toClassString("game-result"))}function getTimestampElement(t){return r.querySelector("[".concat("data-vml-element",'="',"timestamp",'"][',"data-ply",'="',t,'"]'))}function getSelectedNodeElement(){return r.querySelector(toClassString("selected"))}function selectNodeElement(t){var r=getSelectedNodeElement();t!==r&&(r&&deselectNodeElement(r),t.classList.add("selected"))}function setMaxMoveTimeTaken(t){null!==t?r.style.setProperty("--timeMaxValue",t.toString()):r.style.removeProperty("--timeMaxValue")}function setTimestampElementColor(t,r){r.classList.add(function getTimestampClass(t){return"time-".concat(t)}(Object(Ot.a)(t)))}function setTimestampValue(t,i){var o=t.baseTime,a=t.ply,l=t.value,h=t.timestamp,g=i||getTimestampElement(a);if(g){var y=function getTimestampWidth(){var t=r.style.getPropertyValue("--timestampWidth");return t.length?parseFloat(t):null}(),_=function getMaxMoveTimeTaken(){var t=r.style.getPropertyValue("--timeMaxValue");return t.length?parseFloat(t):null}();if(g.setAttribute("data-time",h.toString()),g.style.setProperty("--timeValue",h.toString()),g.innerHTML=l,(!y||7*l.length>y)&&function setTimestampWidth(t){var i=7*t;r.style.setProperty("--timestampWidth","".concat(i,"px"))}(l.length),o){var x=function getBarWidth(t,r){var i=t/(r/40);return 130/Math.PI*Math.atan(i/3)}(h,millisecondsToDeciseconds(o));return g.style.setProperty("--timeBarWidth","".concat(x,"px")),r.classList.add("timestamps-with-base-time"),void(_&&setMaxMoveTimeTaken(null))}r.classList.remove("timestamps-with-base-time"),(!_||h>_)&&setMaxMoveTimeTaken(h)}}}!function(t){!function(t){t.SelectNode="SelectNode",t.SelectResultNode="SelectResultNode"}(t.Events||(t.Events={}))}(Lt||(Lt={})),function(t){!function(t){!function(t){t.ClearAllAnalysis="Clear All Analysis",t.DeleteCommentAfter="Delete Comment After",t.DeleteCommentBefore="Delete Comment Before",t.DeleteLine="Delete Entire Variation",t.DeleteMove="Delete Move",t.InsertCommentAfter="Comment After",t.InsertCommentBefore="Comment Before",t.InsertContinuation="Insert Continuation",t.MoveVariationDown="Move Variation Down",t.MoveVariationUp="Move Variation Up",t.Promote="Promote",t.RemoveAnnotation="Remove Annotation",t.RemoveBegin="Remove Begin",t.RemoveEnd="Remove End",t.RemoveEvaluationAnnotation="Remove Evaluation Annotation",t.RemoveFocus="Remove Focus",t.SetBegin="Set Begin",t.SetEnd="Set End",t.SetFocus="Set Focus"}(t.Actions||(t.Actions={})),function(t){t.BadMove="Bad move",t.BlackHasDecisiveAdvantage="Black has a decisive advantage",t.BlackHasModerateAdvantage="Black has a moderate advantage",t.BlackHasSlightAdvantage="Black has a slight advantage",t.Blunder="Blunder",t.Drawish="Drawish",t.DubiousMove="Dubious move",t.ExcellentMove="Excellent move",t.GoodMove="Good move",t.Novelty="Novelty",t.Unclear="Unclear",t.PositionInZuqZwang="The position is in zugzwang",t.SpeculativeMove="Speculative move",t.WhiteHasSlightAdvantage="White has a slight advantage",t.WhiteHasModerateAdvantage="White has a moderate advantage",t.WhiteHasDecisiveAdvantage="White has a decisive advantage",t.WithInitiative="With initiative",t.WithCompensation="With compensation",t.WithAttack="With an attack"}(t.Annotations||(t.Annotations={})),function(t){t.B="B",t.K="K",t.N="N",t.P="P",t.Q="Q",t.R="R"}(t.Pieces||(t.Pieces={})),function(t){t.NumberOfDays="numberOfDays",t.NumberOfHours="numberOfHours",t.NumberOfMinutes="numberOfMinutes"}(t.Plural||(t.Plural={})),function(t){t.AddComment="Add Comment..."}(t.Prompt||(t.Prompt={}))}(t.Translation||(t.Translation={}))}(It||(It={}));var jt,Nt,kt,Dt,Bt,Ft,Gt,Ht=(Rt={},j()(Rt,It.Translation.Prompt.AddComment,(function(){return It.Translation.Prompt.AddComment})),j()(Rt,It.Translation.Annotations.BadMove,(function(){return It.Translation.Annotations.BadMove})),j()(Rt,It.Translation.Annotations.BlackHasDecisiveAdvantage,(function(){return It.Translation.Annotations.BlackHasDecisiveAdvantage})),j()(Rt,It.Translation.Annotations.BlackHasModerateAdvantage,(function(){return It.Translation.Annotations.BlackHasModerateAdvantage})),j()(Rt,It.Translation.Annotations.BlackHasSlightAdvantage,(function(){return It.Translation.Annotations.BlackHasSlightAdvantage})),j()(Rt,It.Translation.Annotations.Blunder,(function(){return It.Translation.Annotations.Blunder})),j()(Rt,It.Translation.Actions.ClearAllAnalysis,(function(){return It.Translation.Actions.ClearAllAnalysis})),j()(Rt,It.Translation.Actions.DeleteCommentAfter,(function(){return It.Translation.Actions.DeleteCommentAfter})),j()(Rt,It.Translation.Actions.DeleteCommentBefore,(function(){return It.Translation.Actions.DeleteCommentBefore})),j()(Rt,It.Translation.Actions.DeleteLine,(function(){return It.Translation.Actions.DeleteLine})),j()(Rt,It.Translation.Actions.DeleteMove,(function(){return It.Translation.Actions.DeleteMove})),j()(Rt,It.Translation.Annotations.Drawish,(function(){return It.Translation.Annotations.Drawish})),j()(Rt,It.Translation.Annotations.DubiousMove,(function(){return It.Translation.Annotations.DubiousMove})),j()(Rt,It.Translation.Annotations.ExcellentMove,(function(){return It.Translation.Annotations.ExcellentMove})),j()(Rt,It.Translation.Annotations.GoodMove,(function(){return It.Translation.Annotations.GoodMove})),j()(Rt,It.Translation.Actions.InsertCommentAfter,(function(){return It.Translation.Actions.InsertCommentAfter})),j()(Rt,It.Translation.Actions.InsertCommentBefore,(function(){return It.Translation.Actions.InsertCommentBefore})),j()(Rt,It.Translation.Actions.InsertContinuation,(function(){return It.Translation.Actions.InsertContinuation})),j()(Rt,It.Translation.Actions.MoveVariationDown,(function(){return It.Translation.Actions.MoveVariationDown})),j()(Rt,It.Translation.Actions.MoveVariationUp,(function(){return It.Translation.Actions.MoveVariationUp})),j()(Rt,It.Translation.Annotations.Novelty,(function(){return It.Translation.Annotations.Novelty})),j()(Rt,It.Translation.Pieces.B,(function(){return It.Translation.Pieces.B})),j()(Rt,It.Translation.Pieces.K,(function(){return It.Translation.Pieces.K})),j()(Rt,It.Translation.Pieces.N,(function(){return It.Translation.Pieces.N})),j()(Rt,It.Translation.Pieces.P,(function(){return It.Translation.Pieces.P})),j()(Rt,It.Translation.Pieces.Q,(function(){return It.Translation.Pieces.Q})),j()(Rt,It.Translation.Pieces.R,(function(){return It.Translation.Pieces.R})),j()(Rt,It.Translation.Actions.Promote,(function(){return It.Translation.Actions.Promote})),j()(Rt,It.Translation.Actions.RemoveAnnotation,(function(){return It.Translation.Actions.RemoveAnnotation})),j()(Rt,It.Translation.Actions.RemoveBegin,(function(){return It.Translation.Actions.RemoveBegin})),j()(Rt,It.Translation.Actions.RemoveEnd,(function(){return It.Translation.Actions.RemoveEnd})),j()(Rt,It.Translation.Actions.RemoveEvaluationAnnotation,(function(){return It.Translation.Actions.RemoveEvaluationAnnotation})),j()(Rt,It.Translation.Actions.RemoveFocus,(function(){return It.Translation.Actions.RemoveFocus})),j()(Rt,It.Translation.Actions.SetBegin,(function(){return It.Translation.Actions.SetBegin})),j()(Rt,It.Translation.Actions.SetEnd,(function(){return It.Translation.Actions.SetEnd})),j()(Rt,It.Translation.Actions.SetFocus,(function(){return It.Translation.Actions.SetFocus})),j()(Rt,It.Translation.Annotations.SpeculativeMove,(function(){return It.Translation.Annotations.SpeculativeMove})),j()(Rt,It.Translation.Annotations.PositionInZuqZwang,(function(){return It.Translation.Annotations.PositionInZuqZwang})),j()(Rt,It.Translation.Annotations.Unclear,(function(){return It.Translation.Annotations.Unclear})),j()(Rt,It.Translation.Annotations.WhiteHasDecisiveAdvantage,(function(){return It.Translation.Annotations.WhiteHasDecisiveAdvantage})),j()(Rt,It.Translation.Annotations.WhiteHasModerateAdvantage,(function(){return It.Translation.Annotations.WhiteHasModerateAdvantage})),j()(Rt,It.Translation.Annotations.WhiteHasSlightAdvantage,(function(){return It.Translation.Annotations.WhiteHasSlightAdvantage})),j()(Rt,It.Translation.Annotations.WithAttack,(function(){return It.Translation.Annotations.WithAttack})),j()(Rt,It.Translation.Annotations.WithCompensation,(function(){return It.Translation.Annotations.WithCompensation})),j()(Rt,It.Translation.Annotations.WithInitiative,(function(){return It.Translation.Annotations.WithInitiative})),j()(Rt,It.Translation.Plural.NumberOfDays,(function(t){return"".concat(t,1===t?" day":" days")})),j()(Rt,It.Translation.Plural.NumberOfHours,(function(t){return"".concat(t,1===t?" hr":" hrs")})),j()(Rt,It.Translation.Plural.NumberOfMinutes,(function(t){return"".concat(t,1===t?" min":" mins")})),Rt);i(97);function decisecondsToDaysHoursMinutesObject(t){var r=Math.ceil(t/10),i=Math.floor(r/86400),o=Math.floor(r%86400/3600),a=Math.ceil(r%3600/60);return 60===a&&(a=0,o+=1),24===o&&(o=0,i+=1),{days:i,hours:o,minutes:a}}function decisecondsToDaysHoursMinutesString(t,r){var i=decisecondsToDaysHoursMinutesObject(t),o=i.days,a=i.hours,l=i.minutes,h={days:a>0||l>0?", ":"",hours:l>0?", ":""},g=o>0?"".concat(r[It.Translation.Plural.NumberOfDays](o)).concat(h.days):"",y=a>0?"".concat(r[It.Translation.Plural.NumberOfHours](a)).concat(h.hours):"",_=l>0?"".concat(r[It.Translation.Plural.NumberOfMinutes](l)):"";return"".concat(g).concat(y).concat(_)}function decisecondsToHumanReadableFormat(t,r){var i=decisecondsToDaysHoursMinutesObject(t),o=i.days,a=i.hours,l=i.minutes;return o?o>0?"".concat(r[It.Translation.Plural.NumberOfDays](o)):"":a?a>0?"".concat(r[It.Translation.Plural.NumberOfHours](a)):"":l>0?"".concat(r[It.Translation.Plural.NumberOfMinutes](l)):""}function formatDecisecondsAsClockString(t){var r=Math.floor(t/600),i=((t-600*r)/10).toFixed(1);if(0===r)return i;var o="0".concat(i).substr(-4);return"".concat(r,":").concat(o)}function getTimestampElementParameters(t){var r=t.formatTimestampAsHumanReadable,i=t.timestamp,o=t.translations;return{title:r?decisecondsToDaysHoursMinutesString(i,o):void 0,value:r?decisecondsToHumanReadableFormat(i,o):formatDecisecondsAsClockString(i)}}function getTimestampFromNode(t){var r;return(null===(r=t.commands)||void 0===r?void 0:r.timestamp)?parseInt(t.commands.timestamp,10):null}function createVMLAPIOverrides(t){var r=t.resultNodeIsSelectable;return{moveBackward:function moveBackward(t){return function createMoveBackward(t){var r=t.api,i=r.moveBackward;return function moveBackward(){r.vml.getMoveList().isResultNodeSelected()?r.selectLineEnd(0):i()}}({api:t.api})},moveForward:function moveForward(t){return function createMoveForward(t){var r=t.api,i=t.resultNodeIsSelectable,o=r.moveForward;return function moveForward(){if(i){var t=r.vml.getMoveList(),a=r.getFEN(),l=r.getLastMove().fen;t.isResultNodeSelected()||(l===a?t.selectResultNode():o())}else o()}}({api:t.api,resultNodeIsSelectable:r})}}}function createVerticalMoveListPlugin(t){var r,i=t.displayTimeInClockFormat,o=void 0===i||i,a=t.el,l=t.emitter,h=void 0===l?createEventEmitter():l,g=t.formatTimestampAsHumanReadable,y=void 0===g?!o:g,_=t.loadLineOnCreate,x=void 0===_||_,w=t.namespace,S=void 0===w?je.Plugin.Name:w,M=t.resultNodeIsSelectable,T=void 0!==M&&M,P=t.scrollContainer,C=t.showResultNode,A=void 0===C||C,O=t.showTimestamps,L=void 0===O||O,R=t.toggleTimestamps,j=void 0!==R&&R,N=t.translations,k=void 0===N?Ht:N,D=!0,B=function createReadyStateManager(){var t=!1,r=Object(Ct.a)();return{isReady:function isReady(){return t},ready:function ready(i){var o;t=!0,null===(o=r.resolve)||void 0===o||o.call(r,i)},waitForReady:function waitForReady(){return r.promise}}}(),G=createQueue(!1),H=function createVML(t){var r=t.colorsEnabled,i=void 0!==r&&r,o=t.el,a=t.epIconInfoPath,l=void 0===a?Je.a.enPassant:a,h=t.getTimeControl,g=t.formatTimestampAsHumanReadable,y=void 0!==g&&g,_=t.moveListDisplayType,x=void 0===_?Qe.a.MoveListDisplayTypes.Text:_,w=t.resultNodeIsSelectable,S=void 0!==w&&w,M=t.scrollContainer,T=t.showResultNode,P=void 0===T||T,C=t.showTimestamps,A=void 0===C||C,O=t.toggleTimestamps,L=void 0!==O&&O,I=t.translations,R=void 0===I?Ht:I,j=h,N=createVMLDOM({colorsEnabled:i,el:o,EPIconInfoPath:l,moveListDisplayType:x,resultNodeIsSelectable:S,scrollContainer:M,toggleTimestamps:L,translations:R});return N.createList(),{addNode:function addNode(t){var r=N.getResult();r!==We.a.Results.None&&N.setResultNode(We.a.Results.None),N.addNode(t),addTimestamp(t),r!==We.a.Results.None&&N.setResultNode(r)},create:N.createList,deselectNode:N.deselectNode,destroy:N.destroyList,enableColors:N.enableColors,handleSelectResultNode:function handleSelectResultNode(t){N.isResultNodeSelected()||!t.isResultNode?N.selectNode(t.ply):selectResultNode()},isResultNodeSelected:N.isResultNodeSelected,loadNodes:function loadNodes(t,r){var i=N.getResult();N.clearList(),t.forEach((function(t){N.addNode(t),addTimestamp(t)})),i!==We.a.Results.None&&N.setResultNode(i);var o=null!=r?r:N.getLastPly();void 0!==o&&N.selectNode(o),N.scrollToSelectedNode()},selectNode:function selectNode(t){void 0===t?N.deselectNode():"number"==typeof t?N.selectNode(t):N.selectNodeElement(t),N.scrollToSelectedNode()},selectResultNode:selectResultNode,setMoveListDisplayType:function setMoveListDisplayType(t){N.setParams({moveListDisplayType:t})},setResult:function setResult(t){P?N.setResultNode(t):N.getResult()!==We.a.Results.None&&N.setResultNode(We.a.Results.None)},setGetTimeControl:function setGetTimeControl(t){j=t},updateNodeColor:N.updateNodeColor,updateTimestamp:function updateTimestamp(t){var r=t.ply,i=getTimestampFromNode(t);if(r){if(null===i)return N.removeTimestamp(r);var o=getTimestampElementParameters({formatTimestampAsHumanReadable:y,timestamp:i,translations:R}),a=o.title,l=o.value,h=N.getTimestamp(r);h?h!==i&&N.setTimestampValue({baseTime:getBaseTime(),ply:r,timestamp:i,value:l}):N.addTimestamp({baseTime:getBaseTime(),node:t,timestamp:i,title:a,value:l})}}};function addTimestamp(t){var r=getTimestampFromNode(t);if(r&&A){var i=getTimestampElementParameters({formatTimestampAsHumanReadable:y,timestamp:r,translations:R}),o=i.title,a=i.value;N.addTimestamp({baseTime:getBaseTime(),node:t,timestamp:r,title:o,value:a})}}function getBaseTime(){var t;return null===(t=null==j?void 0:j())||void 0===t?void 0:t.baseTime}function selectResultNode(){N.selectResultNode()}}({el:a,formatTimestampAsHumanReadable:y,resultNodeIsSelectable:T,getTimeControl:function getTimeControl(){return null},scrollContainer:P||a,showResultNode:A,showTimestamps:L,toggleTimestamps:j,translations:k}),V=function createUpdateMoveList(t){return function updateMoveList(r){var i,o,a=r.event,l=r.line,h=r.selectedNode,g=a.data,y=a.type,_=null==h?void 0:h.ply;return y===ke.a.APIEvents.AddMove?t.addNode(g.listMove):g&&1===g.plyDiff&&h?(t.addNode(h),t.selectNode(_)):y===ke.a.APIEvents.CreateGame||y===ke.a.APIEvents.Load||y===ke.a.APIEvents.DeletePosition?t.loadNodes(l):y===ke.a.APIEvents.LineUpdated?(t.loadNodes(l),t.selectNode(_)):g.moveListDisplayType?(t.setMoveListDisplayType(g.moveListDisplayType),t.loadNodes(l,_)):y===ke.a.APIEvents.NodeUpdated&&(null===(i=g.changes)||void 0===i?void 0:i.hasOwnProperty("timestamp"))?t.updateTimestamp(g.changes.node):y===ke.a.APIEvents.UpdatePGNHeaders&&g.Result?t.setResult(g.Result):0===_?t.deselectNode():t.selectNode(_),(null===(o=g.changes)||void 0===o?void 0:o.hasOwnProperty("customColor"))&&t.updateNodeColor(g.ids.move+1,g.changes.customColor),_}}(H);return{api:function api(t){return Object.assign(Object.assign({activate:function activate(){setActiveStatus(!0),updateVerticalMoveList(Object(dt.a)(ke.a.APIEvents.Load),t.api)},deactivate:function deactivate(){return setActiveStatus(!1)}},h),{getMoveList:function getMoveList(){return H},isActive:function isActive(){return Boolean(D)},isReady:function isReady(){return B.isReady()},waitForVMLReady:B.waitForReady})},apiOverrides:createVMLAPIOverrides({resultNodeIsSelectable:T}),create:function create(t){var i,o=t.api;if(H.setGetTimeControl(o.timeControl.get),H.create(),x){var l=o.getLine(0),g=null===(i=o.getSelectedNode())||void 0===i?void 0:i.ply;(null==l?void 0:l.length)&&H.loadNodes(l,g)}r=function createVMLEventListeners(t){a.addEventListener("SelectNode",selectNode),T&&a.addEventListener("SelectResultNode",selectResultNode);return function destroyListener(){a.removeEventListener("SelectNode",selectNode),T&&a.removeEventListener("SelectResultNode",selectResultNode)};function selectNode(r){var i=r.detail;if(D){var o=i.ids;t.selectNode(o.line,o.move),T&&t.isAtEndOfLine()&&(G.flush(),H.handleSelectResultNode(i))}}function selectResultNode(){t.getContext().respond(je.Events.ResultNodeSelected)}}(o),B.ready(H),h.emit(je.Events.Ready,H)},destroy:function destroy(){if(null==r||r(),!H)return;H.destroy()},match:[{condition:function shouldUpdateMoveList(t){return D&&isOneOf([].concat(I()(Et),[Nt.APIEvents.AddMove,ke.a.APIEvents.LineUpdated,ke.a.APIEvents.NodeUpdated,ke.a.APIEvents.DeletePosition,ke.a.APIEvents.UpdatePGNHeaders,ke.a.InstanceEvents.Create,ke.a.InstanceEvents.ModeChanged,ke.a.OptionsEvents.Update]))(t)},handler:function handler(t,r){return updateVerticalMoveList(t,r.api)}}],name:S};function updateVerticalMoveList(t,r){var i,o=r.getRelativeNode();G.add(V,{event:t,line:null===(i=r.getLine)||void 0===i?void 0:i.call(r,0),selectedNode:isNode(o)?o:void 0}),requestAnimationFrame((function(){requestAnimationFrame((function flushMoveListQueue(){G.flush(),h.emit(je.Events.Updated,H)}))}))}function setActiveStatus(t){D=t}}function select_node_selectNode(t){return function getMachineStateForSelectedNode(t,r){return isLine(t)?Dt.StartingPosition:t.ids.move===Object.keys(r[t.ids.line]).length-1?Dt.EndOfLineSelected:Dt.MiddleOfLineSelected}(t.node,t.lines)}function endOfLineSelected(){var t;return t={},j()(t,ke.a.APIEvents.SelectNode,select_node_selectNode),j()(t,ke.a.APIEvents.Move,(function makeMove(t){var r=t.component,i=t.event,o=r.api;return r.dom.insertNode({node:i,nodeToInsertAfter:o.getSelectedNode()}),Dt.EndOfLineSelected})),t}function middleOfLineSelected(){var t;return t={},j()(t,ke.a.APIEvents.SelectNode,select_node_selectNode),j()(t,ke.a.APIEvents.Move,(function makeMove(t){var r=t.component,i=t.event,o=r.api,a=r.dom;return o.getMoveNode({line:i.ids.line,move:i.ids.move})?(o.selectNode({line:i.ids.line,move:i.ids.move}),Dt.MiddleOfLineSelected):(a.insertVariation({node:i}),Dt.EndOfLineSelected)})),t}function createHMLStateMachine(){return createStateMachine(function getStateMachine(){var t,r;return{initialState:Dt.StartingPosition,states:(t={},j()(t,Dt.StartingPosition,(r={},j()(r,ke.a.APIEvents.SelectNode,select_node_selectNode),j()(r,ke.a.APIEvents.Move,(function makeMove(t){var r=t.component,i=t.event,o=r.api,a=r.dom;return o.getMoveNode({line:i.ids.line,move:i.ids.move})?(o.selectNode({line:i.ids.line,move:i.ids.move}),Dt.MiddleOfLineSelected):0!==i.ids.line?(a.insertVariation({node:i}),Dt.EndOfLineSelected):(a.insertNode({node:i}),Dt.EndOfLineSelected)})),r)),j()(t,Dt.EndOfLineSelected,endOfLineSelected()),j()(t,Dt.MiddleOfLineSelected,middleOfLineSelected()),t)}}())}!function(t){!function(t){t.Analysis="analysis",t.Explorer="exploring",t.GuessTheMove="guess-the-move",t.PassiveObserving="passive-observing",t.Observing="observing",t.Playing="playing",t.Setup="setup"}(t.Types||(t.Types={}))}(jt||(jt={})),function(t){!function(t){t.AddMove="AddMove",t.AnalysisEnd="AnalysisEnd",t.AnalysisStart="AnalysisStart"}(t.APIEvents||(t.APIEvents={})),function(t){t.Name="observing"}(t.Plugin||(t.Plugin={}))}(Nt||(Nt={})),function(t){!function(t){t.GameResult="game-result",t.Moves="moves"}(t.Placeholders||(t.Placeholders={})),function(t){t.Component="horizontal-move-list",t.MainLine="main",t.Variation="variation"}(t.ClassNames||(t.ClassNames={})),function(t){t.Begin="begin",t.Focus="focus",t.End="end"}(t.NodeLimitTypes||(t.NodeLimitTypes={}))}(kt||(kt={})),function(t){t.EndOfLineSelected="EndOfLineSelected",t.MiddleOfLineSelected="MiddleOfLineSelected",t.StartingPosition="StartingPosition"}(Dt||(Dt={})),function(t){!function(t){t.ClearAnalysis="ClearAnalysis",t.DeleteComment="DeleteComment",t.DeleteCommentBefore="DeleteCommentBefore",t.DeleteMove="DeleteMove",t.DeleteVariation="DeleteVariation",t.InsertComment="InsertComment",t.InsertCommentBefore="InsertCommentBefore",t.InsertContinuation="InsertContinuation",t.MoveVariationDown="MoveVariationDown",t.MoveVariationUp="MoveVariationUp",t.PromoteVariation="PromoteVariation",t.RemoveAnnotation="RemoveAnnotation",t.RemoveBegin="RemoveBegin",t.RemoveEnd="RemoveEnd",t.RemoveAdditionalAnnotation="RemoveAdditionalAnnotation",t.RemoveFocus="RemoveFocus",t.SetBegin="SetBegin",t.SetEnd="SetEnd",t.SetFocus="SetFocus"}(t.Actions||(t.Actions={})),function(t){t.AddAnnotation="AddAnnotation",t.AddAdditionalAnnotation="AddAdditionalAnnotation"}(t.AnnotationActions||(t.AnnotationActions={})),function(t){t.Actions="actions",t.Translations="translations"}(t.Keys||(t.Keys={})),function(t){t.ActionClicked="action-clicked",t.AnnotationClicked="annotation-clicked",t.Close="close-context-menu"}(t.Events||(t.Events={}))}(Bt||(Bt={})),function(t){!function(t){t.ActionName="action-name",t.Annotation="annotation",t.AnnotationsContainer="annotations-container",t.Component="move-node-context-menu",t.Divider="divider"}(t.Classes||(t.Classes={}))}(Ft||(Ft={})),function(t){!function(t){t.Click="click"}(t.Events||(t.Events={}))}(Gt||(Gt={}));var Vt={condition:function handle_add_move_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.AddMove}},handler:function handle_add_move_handler(t){var r=t.context,i=t.event,o=r.moveList,a=i.data.listMove,l=o.api.getMoveNode({line:0,move:a.ids.move-1});o.dom.insertNode({node:a,nodeToInsertAfter:l})}};var Ut={condition:function handle_create_continuation_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.CreateContinuation}},handler:function handle_create_continuation_handler(t){var r=t.context,i=t.event,o=t.selectedNode,a=r.moveList,l=r.methods.selectCurrentPosition;if(a.dom.insertVariation({node:i.data.node}),a.api.getMoveNode(i.data.node.ids))return void a.api.selectNode(i.data.node.ids);l(o)}};var zt={condition:function handle_delete_position_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.DeletePosition}},handler:function handle_delete_position_handler(t){var r=t.context,i=t.coreContext,o=t.selectedNode,a=t.event,l=r.moveList,h=r.methods.selectCurrentPosition,g=i.api,y=a.data,_=y.ids,x=y.line;if(!l.api.getNodes()[_.line])return void h(o);(function deletePositionFromMoveList(t){var r=t.ids,i=t.line,o=t.lines,a=t.moveList;o.find((function(t){var r=t.atMoveNode,o=t.curFen;return r===i.atMoveNode&&o===i.curFen}))?a.dom.removeNode(r):a.dom.load()})({ids:_,line:x,lines:g.getRawLines(),moveList:l}),h(o)}};var Wt,qt,$t,Xt={condition:function handle_game_result_node_condition(t){var r=t.event;return function match(){return ke.a.APIEvents.UpdatePGNHeaders===r.type&&r.data.Result}},handler:function handle_game_result_node_handler(t){var r=t.context,i=t.coreContext;r.moveList.dom.setResultNode(i.api.getResult())}};function isEditingComment(t){return Boolean(t.getElement().querySelector(function toSelector(t,r="."){return`${r}${t}`}(Wt.Classes.Component)))}!function(t){!function(t){t.FocusOut="comment-field-focus-out",t.CommentChanged="comment-has-changed"}(t.Events||(t.Events={})),function(t){t.Component="editable-comment"}(t.Classes||(t.Classes={})),function(t){t[t.CommentUpdateDelay=500]="CommentUpdateDelay"}(t.Constants||(t.Constants={}))}(Wt||(Wt={})),function(t){let r;!function(t){t.Hidden="hidden",t.Invisible="invisible"}(r=t.Classes||(t.Classes={}))}(qt||(qt={})),function(t){let r;!function(t){t[t.Backspace=8]="Backspace",t[t.Delete=46]="Delete",t[t.DownArrow=40]="DownArrow",t[t.Enter=13]="Enter",t[t.Escape=27]="Escape",t[t.LeftArrow=37]="LeftArrow",t[t.RightArrow=39]="RightArrow",t[t.Spacebar=32]="Spacebar",t[t.Stop=137]="Stop",t[t.Tab=9]="Tab",t[t.UpArrow=38]="UpArrow"}(r=t.KeyCodes||(t.KeyCodes={}))}($t||($t={}));var Kt={condition:function handle_line_comment_updated_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.LineCommentUpdated}},handler:function handle_line_comment_updated_handler(t){var r=t.context,i=t.event,o=r.moveList,a=i.data;if(isEditingComment(o.dom))return;o.dom.updateLineComponent(a.lineId,{initComment:a.comment})}};var Yt={condition:function handle_load_condition(t){var r=t.event;return function match(){return[ke.a.APIEvents.CreateGame,ke.a.APIEvents.Load].includes(r.type)}},handler:function handle_load_handler(t){var r=t.context,i=t.coreContext,o=r.moveList,a=r.methods.destroyContextMenu,l=r.queue,h=i.api;a(),l.flush(),o.dom.load(),o.dom.setResultNode(h.getResult())}};var Zt={condition:function handle_move_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.Move}},handler:function handle_move_handler(t){var r=t.context,i=t.event,o=t.selectedNode,a=r.moveList,l=r.stateMachine,h=r.methods.selectCurrentPosition;if(a.api.getMoveNode(i.data.move.ids))return void a.api.selectNode(i.data.move.ids);l.transition(ke.a.APIEvents.Move,{component:a,event:i.data.move,selectedNode:o}),h(o)}};var Qt={condition:function handle_node_updated_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.NodeUpdated}},handler:function handle_node_updated_handler(t){var r=t.context,i=t.event,o=r.moveList,a=i.data;if(isEditingComment(o.dom))return;o.dom.updateMoveNodeComponent(a.ids,a.changes)}};var Jt={condition:function handle_promote_variation_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.PromoteVariation}},handler:function handle_promote_variation_handler(t){t.context.moveList.dom.load()}};var en={condition:function handle_reset_to_main_line_condition(t){var r=t.event;return function match(){return[ke.a.APIEvents.ResetToMainLine].includes(r.type)}},handler:function handle_reset_to_main_line_handler(t){t.context.moveList.dom.load()}};var tn={condition:function handle_update_options_condition(t){var r=t.event;return function match(){return r.type===ke.a.OptionsEvents.Update}},handler:function handle_update_options_handler(t){var r=t.coreContext,i=t.context,o=t.event,a=i.el,l=i.moveList,h=i.methods.destroyContextMenu,g=r.api.getOptions();l.api.setOptions(o.data),g.test&&Object(ze.c)(a,j()({},ze.b.Editable,o.data.moveListContextMenuEnabled));!1===o.data.moveListContextMenuEnabled&&h()}};var nn={condition:function handle_selected_node_change_condition(t){var r=t.event;return function match(){return r.type===ke.a.APIEvents.MoveForward||r.type===ke.a.APIEvents.MoveBackward||r.type===ke.a.APIEvents.SelectLineEnd||r.type===ke.a.APIEvents.SelectLineStart||r.type===ke.a.APIEvents.SelectNode||r.type===ke.a.APIEvents.ResetToMainLine}},handler:function handle_selected_node_change_handler(t){var r=t.context,i=t.selectedNode;(0,r.methods.selectCurrentPosition)(i)}};var rn,an;i(70);!function(t){!function(t){t.Annotation="annotation",t.CustomColor="customColor",t.id="id",t.MoveNumber="moveNumber",t.San="san",t.Selected="selected"}(t.Keys||(t.Keys={})),function(t){t.Annotation="annotation",t.CustomColor="customColor",t.MoveNumber="moveNumber",t.San="san"}(t.TouchableKeys||(t.TouchableKeys={}))}(rn||(rn={})),function(t){!function(t){t.Comment="comment",t.GameResultNode="game-result-node",t.IconFont="icon-font-chess",t.MoveNode="move-node",t.MoveNumber="move-number",t.MoveText="move-text",t.Selected="selected",t.StaticComment="static-comment"}(t.Classes||(t.Classes={})),function(t){t[t.TouchDelay=500]="TouchDelay"}(t.Constants||(t.Constants={})),function(t){t.Click="click",t.OpenContextMenu="contextmenu"}(t.Events||(t.Events={}))}(an||(an={}));var sn,cn=i(8),ln=i(9);var un=(sn={},j()(sn,Bt.Actions.InsertCommentBefore,function createInsertCommentBeforeAction(){return{action:Bt.Actions.InsertCommentBefore,handler:function handler(t,r){var i=r.moveList,o=r.context.game,a=t,l=o.getLine(t.ids.line);a=0===t.ids.move&&l?l:o.getNodeByIds(t.previous);i.dom.insertEditableComment(a)},isVisible:function isVisible(t){var r=t.api,i=t.node;if(0===i.ids.move){var o=r.getLine(i.ids.line);return!o||!o.initComment}var a=r.getNodeByIds(i.previous);return isNode(a)&&!a.comment},name:It.Translation.Actions.InsertCommentBefore}}()),j()(sn,Bt.Actions.InsertComment,function createInsertCommentAction(){return{action:Bt.Actions.InsertComment,handler:function handler(t,r){r.moveList.dom.insertEditableComment(t)},isVisible:function isVisible(t){return void 0===t.node.comment},name:It.Translation.Actions.InsertCommentAfter}}()),j()(sn,Bt.Actions.DeleteCommentBefore,function createDeleteCommentBeforeAction(){return{action:Bt.Actions.DeleteCommentBefore,handler:function handler(t,r){var i=r.context.game,o=r.moveList,a=r.moveNodeComponent,l=t,h=i.getLine(t.ids.line);h&&0===t.ids.move?(l=h,i.updateLineComment(void 0,h.id)):(l=i.getNodeByIds(t.previous),i.updateNode(l.ids,{comment:void 0}),a.touch(rn.TouchableKeys.MoveNumber));o.dom.removeComment(l)},isVisible:function isVisible(t){var r=t.api,i=t.node;if(0===i.ids.move){var o=r.getLine(i.ids.line);return Boolean(o&&o.initComment)}var a=r.getNodeByIds(i.previous);return isNode(a)&&Boolean(a.comment)},name:It.Translation.Actions.DeleteCommentBefore}}()),j()(sn,Bt.Actions.DeleteComment,function createDeleteCommentAction(){return{action:Bt.Actions.DeleteComment,handler:function handler(t,r){var i=r.context.game,o=r.moveList,a=r.moveNodeComponent;i.updateNode(t.ids,{comment:void 0}),o.dom.removeComment(t),a.touchNextNode()},isVisible:function isVisible(t){return"string"==typeof t.node.comment},name:It.Translation.Actions.DeleteCommentAfter}}()),j()(sn,Bt.Actions.RemoveAnnotation,function createRemoveAnnotationAction(){return{action:Bt.Actions.RemoveAnnotation,handler:function handler(t,r){var i=r.context.game,o=r.moveNodeComponent;i.updateNode(t.ids,{annotation:void 0}),o.touch(rn.TouchableKeys.Annotation)},isVisible:function isVisible(t){var r=t.node;return Boolean(r.annotation)},name:It.Translation.Actions.RemoveAnnotation}}()),j()(sn,Bt.Actions.RemoveAdditionalAnnotation,function createRemoveAdditionalAnnotationAction(){return{action:Bt.Actions.RemoveAdditionalAnnotation,handler:function handler(t,r){var i=r.context.game,o=r.moveNodeComponent;i.updateNode(t.ids,{additionalAnnotation:void 0}),o.touch(rn.TouchableKeys.Annotation)},isVisible:function isVisible(t){var r=t.node;return Boolean(r.additionalAnnotation&&r.additionalAnnotation.length>0)},name:It.Translation.Actions.RemoveEvaluationAnnotation}}()),j()(sn,Bt.Actions.DeleteVariation,function createDeleteVariationAction(){return{action:Bt.Actions.DeleteVariation,handler:function handler(t,r){var i=r.context.game,o=r.moveList;i.deletePosition(-1,t.ids.line),o.dom.load()},isVisible:function isVisible(t){return 0!==t.node.ids.line},name:It.Translation.Actions.DeleteLine}}()),j()(sn,Bt.Actions.DeleteMove,function createDeleteMoveAction(){return{action:Bt.Actions.DeleteMove,handler:function handler(t,r){r.context.game.deletePosition(t.ids.move,t.ids.line)},isVisible:function isVisible(t){var r=t.api;if(0===t.node.ids.line)return r.getMode().getOptions().canModifyExistingMovesOnMainLine;return!0},name:It.Translation.Actions.DeleteMove}}()),j()(sn,Bt.Actions.PromoteVariation,function createPromoteVariationAction(){return{action:Bt.Actions.PromoteVariation,handler:function handler(t,r){r.context.game.promoteVariation(t.ids.line,1)},isVisible:function isVisible(t){var r=t.api,i=t.node.ids.line;if(0===i)return!1;var o=r.getLine(i);if(!o)return!1;if(0===o.parentId){var a=r.getMode().getOptions(),l=a.canAddMovesToMainLine,h=a.canModifyExistingMovesOnMainLine;return l&&h}return!0},name:It.Translation.Actions.Promote}}()),j()(sn,Bt.Actions.MoveVariationDown,function createMoveVariationDownAction(){return{action:Bt.Actions.MoveVariationDown,handler:function handler(t,r){var i=r.context.game,o=r.moveList;i.moveVariation(t.ids.line,!1)&&o.dom.load()},isVisible:function isVisible(t){var r=t.api,i=t.node;if(0===i.ids.line)return!1;var o=r.getLine(i.ids.line);if(!o)return!1;var a=r.getNodeByIds({line:o.parentId,move:o.atMoveNode});if(a.lines&&a.lines.length>1)return!function isOnLastLineOfParentNode(t,r){return!!r.lines&&t.ids.line===r.lines[r.lines.length-1]}(i,a);return!1},name:It.Translation.Actions.MoveVariationDown}}()),j()(sn,Bt.Actions.MoveVariationUp,function createMoveVariationUpAction(){return{action:Bt.Actions.MoveVariationUp,handler:function handler(t,r){var i=r.context.game,o=r.moveList;i.moveVariation(t.ids.line,!0)&&o.dom.load()},isVisible:function isVisible(t){var r=t.api,i=t.node;if(0===i.ids.line)return!1;var o=r.getLine(i.ids.line);if(!o)return!1;var a=r.getNodeByIds({line:o.parentId,move:o.atMoveNode});if(a.lines&&a.lines.length>1)return!function isOnFirstLineOfParentNode(t,r){return!!r.lines&&t.ids.line===r.lines[0]}(i,a);return!1},name:It.Translation.Actions.MoveVariationUp}}()),j()(sn,Bt.Actions.InsertContinuation,function createInsertContinuationAction(){return{action:Bt.Actions.InsertContinuation,handler:function handler(t,r){r.context.game.createContinuation()},isVisible:function isVisible(t){var r=t.api,i=t.node,o=r.getRawLines();return i.ids.move===o[i.ids.line].length-1},name:It.Translation.Actions.InsertContinuation}}()),j()(sn,Bt.Actions.ClearAnalysis,function createClearAnalysisAction(){return{action:Bt.Actions.ClearAnalysis,handler:function handler(t,r){var i=r.context.game,o=r.moveList,a=Object.keys(o.api.getNodes()),l=i.getLine(0);if(!l)return;var h={};if(a.length>1)for(var g=a.length-1;g>0;g--){var y=i.getLine(g);if(!y)return;o.dom.removeLine(y),0===y.parentId&&(h[y.atMoveNode]=!0)}Object.keys(o.api.getComments()).forEach((function(t){o.api.getComments()[t].destroy()})),i.resetToMainLine(),l.forEach((function(r){var a=[],l=!1;if(h[r.ids.move]&&a.push(rn.TouchableKeys.MoveNumber),(r.annotation||r.additionalAnnotation)&&a.push(rn.TouchableKeys.Annotation),r.comment&&r.color===We.a.ColorsAsNumbers.White&&(l=!0),i.updateNode(r.ids,{additionalAnnotation:void 0,annotation:void 0,comment:void 0}),Object.keys(a).length>0||l){var g=o.api.getMoveNode(r.ids);if(!g)throw new cn.a({code:ln.a.ElementNotFound,data:t,message:"No move node found."});a.forEach((function(t){g.touch(t)})),g.touchNextNode()}})),l.initComment&&i.updateLineComment(void 0,l.id)},isVisible:function isVisible(){return!0},name:It.Translation.Actions.ClearAllAnalysis}}()),sn);function createGetContextMenuActions(t){return function getContextMenuActions(r){var i=t.contextMenuActions,o=t.game,a=o.getNodeByIds(r);if(!isNode(a))throw new cn.a({code:ln.a.BadData,data:r,message:"No move node found"});var l=[];return Object.values(i).forEach((function(r){r&&(r.isVisible({api:o,node:a,options:o.getOptions(),state:t.state})&&l.push(r))})),l}}function createGetMoveNodeMethod(t){return function getMoveNode(r){var i=r.line,o=r.move;return t.state.nodes[i]&&t.state.nodes[i][o]}}function createResetSelectedNode(t){return function resetSelectedNode(){var r=t.state;r.selectedNode&&(r.selectedNode.set(j()({},rn.Keys.Selected,!1)),r.selectedNode=void 0)}}function createSelectLineStart(t){return function selectLineStart(r){var i=t.api,o=t.stateMachine;i.resetSelectedNode(),o.transition(ke.a.APIEvents.SelectNode,{lines:i.getNodes(),node:r})}}function getLineElement(t){return document.getElementById("line-".concat(t))}function forceNextFrame(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];requestAnimationFrame((function(){requestAnimationFrame((function(){t.apply(void 0,I()(r))}))}))}function createSelectNodeMethod(t){return function selectNode(r){var i=r.line,o=r.move,a=t.api,l=t.el,h=t.scrollContainer,g=t.state,y=t.stateMachine;if(void 0!==i&&void 0!==o){a.resetSelectedNode();var _=a.getMoveNode({line:i,move:o});_&&(_.set(j()({},rn.Keys.Selected,!0)),g.selectedNode=_,y.transition(ke.a.APIEvents.SelectNode,{lines:a.getNodes(),node:g.selectedNode.getNodeData()}),forceNextFrame((function(){l.classList.contains(kt.ClassNames.Component)&&(0===_.ids.line||getLineElement(_.ids.line))&&function scroll_to_node_scrollToNode(t){var r,i=t.containerEl,o=t.moveNode,a=t.moveListEl;try{r=o.getElement()}catch(l){}r&&scrollToNode({containerEl:i,moveListEl:a,nodeEl:r})}({containerEl:h,moveListEl:l,moveNode:_})})))}}}function move_list_display_type_setMoveListDisplayType(t){!function forEachNode(t,r){Object.keys(t).forEach((function(i){(Object.keys(t[i])||[]).forEach((function(o){r(t[i][o])}))}))}(t.api.getNodes(),(function touchSan(t){t.touch(rn.TouchableKeys.San)}))}function setMoveListContextMenuEnabled(t){var r=t.state.comments;Object.keys(r).forEach((function(i){r[i][t.options.moveListContextMenuEnabled?"registerClickListeners":"deregisterClickListeners"]()}))}function createSetOptionsMethod(t){var r={moveListContextMenuEnabled:setMoveListContextMenuEnabled,moveListDisplayType:move_list_display_type_setMoveListDisplayType};return function setOptions(i){Object.keys(t.options).forEach((function(o){if(o in i){var a=t.options[o]!==i[o];t.options[o]=i[o],a&&r[o]&&r[o](t)}}))}}i(98);function move_node_svelte_create_if_block(t){var r,i;return{c(){r=internal_element("span"),i=internal_text(t.moveNumber),attr(r,"class",an.Classes.MoveNumber+" svelte-1blqx1z")},m(t,o){insert(t,r,o),append(r,i)},p(t,r){t.moveNumber&&set_data(i,r.moveNumber)},d(t){t&&detach(r)}}}function move_node_svelte_create_fragment(t){var r,i,o,a,l,h,g,y=t.annotation||"",_=t.moveNumber&&move_node_svelte_create_if_block(t);return{c(){r=internal_element("span"),_&&_.c(),i=space(),o=internal_element("span"),l=function empty(){return internal_text("")}(),a=new H(t.san,l),h=new H(y,null),attr(o,"class",an.Classes.MoveText+" svelte-1blqx1z"),attr(r,"id",t.id),attr(r,"class",an.Classes.MoveNode+" svelte-1blqx1z"),toggle_class(r,"customColor",t.customColor),toggle_class(r,"selected",t.selected),g=[listen(r,"click",t.handleNodeClick),listen(r,"contextmenu",t.dispatchContextMenu),listen(r,"touchstart",t.handleTouchStart),listen(r,"touchend",t.handleTouchEnd,{passive:!0})]},m(t,g){insert(t,r,g),_&&_.m(r,null),append(r,i),append(r,o),a.m(o),append(o,l),h.m(o)},p(t,o){o.moveNumber?_?_.p(t,o):((_=move_node_svelte_create_if_block(o)).c(),_.m(r,i)):_&&(_.d(1),_=null),t.san&&a.p(o.san),t.annotation&&y!==(y=o.annotation||"")&&h.p(y),t.id&&attr(r,"id",o.id),t.customColor&&toggle_class(r,"customColor",o.customColor),t.selected&&toggle_class(r,"selected",o.selected)},i:noop,o:noop,d(t){t&&detach(r),_&&_.d(),run_all(g)}}}function move_node_svelte_instance(t,r,i){const o=createEventDispatcher();let a,{customColor:l,id:h,moveNumber:g,san:y,annotation:_,selected:x}=r;function dispatchContextMenu(t){t.preventDefault(),o(an.Events.OpenContextMenu)}function handleNodeClick(t){o(an.Events.Click)}return t.$set=t=>{"customColor"in t&&i("customColor",l=t.customColor),"id"in t&&i("id",h=t.id),"moveNumber"in t&&i("moveNumber",g=t.moveNumber),"san"in t&&i("san",y=t.san),"annotation"in t&&i("annotation",_=t.annotation),"selected"in t&&i("selected",x=t.selected)},t.$$.update=(t={customColor:1})=>{t.customColor&&function updateNodeColorVariables(t){const r=document.getElementById(h);r&&addCustomColor(r,t)}(l)},{customColor:l,id:h,moveNumber:g,san:y,annotation:_,selected:x,dispatchContextMenu:dispatchContextMenu,handleNodeClick:handleNodeClick,handleTouchStart:function handleTouchStart(t){handleNodeClick(),a=setTimeout((()=>{dispatchContextMenu(t),a=null}),an.Constants.TouchDelay)},handleTouchEnd:function handleTouchEnd(){a&&clearTimeout(a)}}}var dn,hn=class move_node_svelte_Move_node extends K{constructor(t){super(),internal_init(this,t,move_node_svelte_instance,move_node_svelte_create_fragment,safe_not_equal,["customColor","id","moveNumber","san","annotation","selected"])}};function createSvelteComponent(t){var r=t.ComponentType,i=t.methods,o=t.options,a=t.replaceContainer,l=void 0===a||a?function replace_container_replaceContainer(t,r){var i=document.createDocumentFragment(),o=new t(Object.assign({},r,{target:i}));return r.target.replaceWith(i),o}(r,o):new r(o),h={destroy:function destroy(){l.$destroy()},el:o.target,get:function get(t){if("string"==typeof t)return l.$$.ctx[t];return function pick(t,r){return r.reduce(((r,i)=>(r[i]=t[i],r)),{})}(l.$$.ctx,t)},instance:l,on:function on(t,r){l.$on(t,r)},set:function set(t){l.$set(t)}};return i&&i.length&&i.forEach((function(t){h[t]=l[t]})),h}!function(t){!function(t){t.$1="$1",t.$2="$2",t.$3="$3",t.$4="$4",t.$5="$5",t.$6="$6",t.$10="$10",t.$11="$11",t.$12="$12",t.$13="$13",t.$14="$14",t.$15="$15",t.$16="$16",t.$17="$17",t.$18="$18",t.$19="$19",t.$22="$22",t.$36="$36",t.$40="$40",t.$146="$146",t.$256="$256"}(t.Nags||(t.Nags={})),function(t){t.$1="!",t.$2="?",t.$3="!!",t.$4="??",t.$5="!?",t.$6="?!",t.$10="=",t.$11="=",t.$12="=",t.$13="∞",t.$14="⩲",t.$15="⩱",t.$16="±",t.$17="∓",t.$18="+-",t.$19="-+",t.$22="⨀",t.$40="↑",t.$146="N",t.$256="=/∞"}(t.Values||(t.Values={}))}(dn||(dn={}));var pn,fn={$1:"!",$2:"?",$3:"!!",$4:"??",$5:"!?",$6:"?!",$10:"=",$11:"=",$12:"=",$13:"∞",$14:"⩲",$15:"⩱",$16:"±",$17:"∓",$18:"+-",$19:"-+",$22:"⨀",$23:"⨀",$32:"⟳",$33:"⟳",$36:"→",$37:"→",$40:"↑",$41:"↑",$44:"∞/=",$45:"=/∞",$132:"⇆",$133:"⇆",$146:"N",$256:"=/∞"},mn={"??":"?\\?","!?":"!\\?","-+":"-\\+","∞/=":"∞\\/\\=","=/∞":"=\\/\\∞","=":"s=",N:"N\\b"},gn=["!","?","!!","??","!?","?!","="],vn=function invertObject(t){return Object.keys(t).reduce(((r,i)=>Object.assign(Object.assign({},r),{[t[i]]:i})),{})}(fn),yn=[{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$1,display:fn.$1,meaning:It.Translation.Annotations.GoodMove},{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$2,display:fn.$2,meaning:It.Translation.Annotations.BadMove},{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$3,display:fn.$3,meaning:It.Translation.Annotations.ExcellentMove},{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$4,display:fn.$4,meaning:It.Translation.Annotations.Blunder},{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$5,display:fn.$5,meaning:It.Translation.Annotations.SpeculativeMove},{action:Bt.AnnotationActions.AddAnnotation,code:dn.Nags.$6,display:fn.$6,meaning:It.Translation.Annotations.DubiousMove},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$10,display:fn.$10,meaning:It.Translation.Annotations.Drawish},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$13,display:fn.$13,meaning:It.Translation.Annotations.Unclear},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$14,display:fn.$14,meaning:It.Translation.Annotations.WhiteHasSlightAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$15,display:fn.$15,meaning:It.Translation.Annotations.BlackHasSlightAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$16,display:fn.$16,meaning:It.Translation.Annotations.WhiteHasModerateAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$17,display:fn.$17,meaning:It.Translation.Annotations.BlackHasModerateAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$18,display:fn.$18,meaning:It.Translation.Annotations.WhiteHasDecisiveAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$19,display:fn.$19,meaning:It.Translation.Annotations.BlackHasDecisiveAdvantage},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$22,display:fn.$22,meaning:It.Translation.Annotations.PositionInZuqZwang},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$36,display:fn.$36,meaning:It.Translation.Annotations.WithInitiative},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$40,display:fn.$40,meaning:It.Translation.Annotations.WithCompensation},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$146,display:fn.$146,meaning:It.Translation.Annotations.Novelty},{action:Bt.AnnotationActions.AddAdditionalAnnotation,code:dn.Nags.$256,display:fn.$256,meaning:It.Translation.Annotations.WithAttack}];function normalizeAnnotation(t){return t&&(Object.prototype.hasOwnProperty.call(fn,t)||Object.prototype.hasOwnProperty.call(vn,t))?function isNagFormat(t){return Boolean(t&&"$"===t.charAt(0))}(t)?fn[t]:normalizeAnnotation(vn[t]):t||""}function generateAnnotationString(t){var r="";return t.annotation&&(r="".concat(r).concat(normalizeAnnotation(t.annotation))),t.additionalAnnotation&&t.additionalAnnotation[0]&&(r="".concat(r,"&nbsp;").concat(normalizeAnnotation(t.additionalAnnotation[0]))),r}function getNodeDisplayNumber(t){var r=t.node,i=t.previous,o=t.startingMoveNumber,a=void 0===o?1:o,l="",h=function getMoveNumber(t){var r=t.color,i=t.ply,o=t.startingMoveNumber,a=void 0===o?1:o;return(r===We.a.ColorsAsNumbers.White?Math.ceil(i/2+1):Math.floor(i/2+1))+(a-1)}({color:r.color,ply:r.moveNumber,startingMoveNumber:a});return function shouldShowDisplayNumber(t,r){return Boolean(t.color===We.a.ColorsAsNumbers.White||t.ids&&0===t.ids.move||r&&"string"==typeof r.comment||r&&r.lines&&r.lines.length)}(r,i)&&(l+="".concat(h,"."),function shouldShowEllipsisOnBlackMoveNumber(t,r){return Boolean(t.color===We.a.ColorsAsNumbers.Black&&(r&&"string"==typeof r.comment||r&&r.lines&&r.lines.length||t.ids&&0===t.ids.move))}(r,i)&&(l+="..")),l}var bn=(pn={},j()(pn,rn.Keys.MoveNumber,(function touchMoveNumber(t){var r=t.game,i=t.node;return getNodeDisplayNumber({node:i,previous:(null==i?void 0:i.previous)?r.getNodeByIds(i.previous):void 0,startingMoveNumber:r.getStartingMoveNumber()})})),j()(pn,rn.Keys.Annotation,(function touchAnnotations(t){return generateAnnotationString(t.node)})),j()(pn,rn.Keys.CustomColor,(function touchCustomColor(t){return t.node.customColor})),j()(pn,rn.Keys.San,(function touchSan(t){var r=t.moveList,i=t.node,o=t.translations;return formatText({color:Object(Ot.a)(i.color),moveListDisplayType:r.getOptions().moveListDisplayType,san:i.san,translations:o})})),pn);function createMoveNode(t){var r=t.moveList,i=t.game,o=t.node,a=t.options,l=t.emitter,h=t.translations;if(isLine(o))throw new cn.a({code:ln.a.BadData,data:o,message:"Invalid move ids."});var g=function createMoveNodeComponent(t,r){var i=r.anchor,o=r.props;return createSvelteComponent({ComponentType:hn,options:{anchor:i,props:o,target:t},replaceContainer:!1})}(a.target,{anchor:a.anchor,props:{annotation:generateAnnotationString(o),id:getId(),moveNumber:bn[rn.Keys.MoveNumber](createTouchContext()),san:bn[rn.Keys.San](createTouchContext()),selected:!1}}),y={addNodeStyles:function addNodeStyles(t){var r=getElement();t&&Object.assign(r.style,t)},destroy:g.destroy,getElement:getElement,getId:getId,getNodeData:getNodeData,ids:o.ids,insertBeforeNode:function insertBeforeNode(t){var r=getElement();r.parentNode&&r.parentNode.insertBefore(t,r)},insertAfterNode:function insertAfterNode(t){var i=r.dom.getElement(),o=getElement();o.nextElementSibling?i.insertBefore(t,o.nextElementSibling):i.appendChild(t)},removeNodeStyles:function removeNodeStyles(){getElement().removeAttribute("style")},set:g.set,touch:function touch(t){g.set(j()({},t,bn[t](createTouchContext())))},touchNextNode:function touchNextNode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[rn.TouchableKeys.MoveNumber],i=r.api.getMoveNode({line:o.ids.line,move:o.ids.move+1});i&&t.forEach((function(t){return i.touch(t)}))}};return function registerComponentListeners(){g.on(an.Events.Click,(function selectNode(){i.selectNode(o.ids.line,o.ids.move)})),g.on(an.Events.OpenContextMenu,(function emitContextMenuOpen(){r.api.getOptions().moveListContextMenuEnabled&&(i.selectNode(o.ids.line,o.ids.move),l.emit(an.Events.OpenContextMenu,{node:o}))}))}(),y;function createTouchContext(){return{game:{getNodeByIds:i.getNodeByIds,getStartingMoveNumber:i.getStartingMoveNumber},moveList:{getOptions:r.api.getOptions},node:getNodeData(),translations:h}}function getElement(){var t=document.getElementById(getId())||g.el.querySelector("#".concat(getId()));if(!t)throw new cn.a({code:ln.a.ElementNotFound,data:o.ids,message:"Move node element was not found for ".concat(o.ids.line,"-").concat(o.ids.move,".")});return t}function getId(){var t=o.ids;return"move-node-".concat(t.line,"-").concat(t.move)}function getNodeData(){return i.getNodeByIds(o.ids)}}function createAddNodeMethod(t){return function addNode(r,i){var o=t.api,a=t.dom,l=t.game,h=t.state,g=t.stateMachine,y=t.translations,_=r.ids;return void 0===h.nodes[_.line]&&(h.nodes[_.line]={}),void 0!==h.nodes[_.line][_.move]&&h.nodes[_.line][_.move].destroy(),h.nodes[_.line][_.move]=createMoveNode({emitter:g,game:l,moveList:{api:o,dom:a},node:r,options:i,translations:y}),h.nodes[_.line][_.move]}}function disableContextMenu(t){t.preventDefault()}function createDestroyMethod(t){return function destroy(){var r=t.dom,i=t.el,o=t.queue;i.classList.remove(kt.ClassNames.Component),i.removeEventListener("contextmenu",disableContextMenu),r.reset(),o.clear()}}function stripHTMLTags(t,r){if(r){var i=["br"],o=i.map((function(t){return"\\/".concat(t)})),a=i.concat(o).join("|"),l=new RegExp("<(?!".concat(a,"s*/?)[^>]+>"),"g");return t.replace(l,"")}return t.replace(/<\/?[^>]+(>|$)/g,"")}function cleanCommentString(t){var r;return" "===(r=function decodeHTMLEntities(t){var r=document.createElement("textarea");return r.innerHTML=t.replace(/&nbsp;/g," "),r.value}(stripHTMLTags(t)))&&(r=""),r}i(99);function editable_comment_svelte_create_fragment(t){var r,i,o,a;return{c(){r=internal_element("span"),i=internal_text(t.formattedComment),attr(r,"class",Wt.Classes.Component+" svelte-1rym3v1"),attr(r,"contenteditable","true"),attr(r,"placeholder",o=t.translations["Add Comment..."]()),a=[listen(r,"focusin",t.selectCommentText),listen(r,"focusout",t.handleFocusOut),listen(r,"input",t.handleInput)]},m(o,a){insert(o,r,a),append(r,i),t.span_binding(r)},p(t,a){t.formattedComment&&set_data(i,a.formattedComment),t.translations&&o!==(o=a.translations["Add Comment..."]())&&attr(r,"placeholder",o)},i:noop,o:noop,d(i){i&&detach(r),t.span_binding(null),run_all(a)}}}function editable_comment_svelte_instance(t,r,i){const o=createEventDispatcher();let a,l,{comment:h="",translations:g}=r;return function onMount(t){get_current_component().$$.on_mount.push(t)}((()=>{a.focus()})),t.$set=t=>{"comment"in t&&i("comment",h=t.comment),"translations"in t&&i("translations",g=t.translations)},t.$$.update=(t={comment:1})=>{t.comment&&i("formattedComment",l=h||"")},{comment:h,translations:g,el:a,selectCommentText:function selectCommentText(){h&&document.execCommand("selectAll",!1,null)},handleFocusOut:function handleFocusOut(){o(Wt.Events.FocusOut,a.innerHTML)},handleInput:function handleInput(){o(Wt.Events.CommentChanged,a.innerHTML)},formattedComment:l,span_binding:function span_binding(t){U[t?"unshift":"push"]((()=>{i("el",a=t)}))}}}var _n=class editable_comment_svelte_Editable_comment extends K{constructor(t){super(),internal_init(this,t,editable_comment_svelte_instance,editable_comment_svelte_create_fragment,safe_not_equal,["comment","translations"])}};function getLineEditableCommentConfig(t,r){var i,o,a=r.moveList,l=r.api;o=0===t.id?a.dom.getElement():getLineElement(t.id);var h=a.api.getMoveNode({line:t.id,move:0});return h&&(i=h.getElement()),{anchor:i,comment:t.initComment,element:o,handler:function saveComment(r,i){!function update_line_comment_updateLineComment(t,r){var i=r.api,o=r.comment,a=r.moveList,l=r.noUIUpdates;i.updateLineComment("string"==typeof o&&o.length>0?o:void 0,t.id),l||t.initComment&&(0===t.id?a.dom.getElement():getLineElement(t.id)).prepend(a.dom.addComment(t))}(t,{api:l,comment:r,moveList:a,noUIUpdates:i})}}}function createInsertEditableCommentMethod(t){return function insertEditableComment(r){var i,o,a=t.api,l=t.dom,h=t.game,g=t.translations;if(isNode(r))i=function getNodeEditableCommentConfig(t,r){var i=r.moveList,o=r.api,a=i.api.getMoveNode(t.ids);if(!a)throw new cn.a({code:ln.a.ElementNotFound,data:t,message:"No move node found."});return{comment:t.comment,element:a.getElement(),handler:function saveComment(t,r){!function updateNodeComment(t,r){var i=r.api,o=r.comment,a=r.moveList,l=r.noUIUpdates;i.updateNode(t.ids,{comment:"string"==typeof o&&o.length>0?o:void 0}),l||(t.getNodeData().comment&&t.getElement().appendChild(a.dom.addComment(t.getNodeData())),t.touchNextNode())}(a,{api:o,comment:t,moveList:i,noUIUpdates:r})}}}(r,{api:h,moveList:{api:a,dom:l}});else{if(!isLine(r))throw new cn.a({code:ln.a.BadData,data:r,message:"No line or node found"});i=getLineEditableCommentConfig(r,{api:h,moveList:{api:a,dom:l}})}l.removeEditableComment(),t.editableCommentComponent=function createEditableCommentComponent(t,r){var i=r.anchor,o=r.props;return createSvelteComponent({ComponentType:_n,options:{anchor:i,props:o,target:t},replaceContainer:!1})}(i.element,{anchor:i.anchor,props:{comment:i.comment,translations:g}}),t.editableCommentComponent.on(Wt.Events.CommentChanged,(function handleCommentChange(t){var r=t.detail;clearTimeout(o),o=setTimeout((function(){!function saveComment(){var t=cleanCommentString(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"");i.handler(t,!0)}(r)}),Wt.Constants.CommentUpdateDelay)})),t.editableCommentComponent.on(Wt.Events.FocusOut,(function saveAndDestroy(r){var a=r.detail;clearTimeout(o);var l=cleanCommentString(a);i.handler(l),t.dom.removeEditableComment()}))}}i(100);function getCommentElementId(t){if(isLine(t))return"line-comment-".concat(t.id);if(isNode(t))return"move-node-comment-".concat(t.ids.line,"-").concat(t.ids.move);throw new cn.a({code:ln.a.BadData,data:t,message:"No line or node found"})}function createCommentComponent(t,r){var i,o,a,l=getCommentElementId(t),h=!1;if(isLine(t))i=t.initComment,a={line:t.id,move:0};else{if(!isNode(t))throw new cn.a({code:ln.a.BadData,data:t,message:"No line or node found"});i=t.comment,a=t.ids}return function createElement(){(o=document.createElement("span")).id=l,o.innerHTML=stripHTMLTags(i||"",!0),o.classList.add(an.Classes.Comment,an.Classes.StaticComment),r.editingEnabled&&registerClickListeners()}(),{deregisterClickListeners:deregisterClickListeners,destroy:destroy,getElement:function getElement(){return o},getId:function getId(){return l},registerClickListeners:registerClickListeners};function destroy(){deregisterClickListeners(),r.removeCommentFromMoveList(l)}function registerClickListeners(){h||(o.addEventListener("click",handleCommentClick,{once:!0}),o.addEventListener("contextmenu",handleContextMenuClick),h=!0)}function deregisterClickListeners(){o.removeEventListener("click",handleCommentClick),o.removeEventListener("contextmenu",handleContextMenuClick),h=!1}function handleCommentClick(){destroy(),r.emitter.emit(Gt.Events.Click,t)}function handleContextMenuClick(t){t.preventDefault(),r.emitter.emit(an.Events.OpenContextMenu,{node:{ids:a}})}}function createAddCommentMethod(t){return function addComment(r){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=t.dom,a=t.options,l=t.state,h=t.stateMachine,g=Boolean("isCommentEnabled"in r?r.isCommentEnabled:i),y=createCommentComponent(r,{editingEnabled:a.moveListContextMenuEnabled&&g,emitter:h,removeCommentFromMoveList:function removeCommentFromMoveList(){o.removeComment(r)}});return l.comments[y.getId()]&&o.removeComment(r),l.comments[y.getId()]=y,y.getElement()}}function createInsertNodeMethod(t){return function insertNode(r){var i=r.node,o=r.nodeToInsertAfter,a=t.dom,l=t.el,h=t.placeholders[kt.Placeholders.Moves],g=o?void 0:h,y=l;if(o){var _=o.getElement();if(!_)throw new cn.a({code:ln.a.ElementNotFound,message:"Node element does not exist."});y=_.parentNode}a.addNode(i,{anchor:g,target:y})}}function createLineElement(t){var r,i=document.createElement("span");i.id="line-".concat(t);for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return(r=i.classList).add.apply(r,a),i}function createInsertVariationMethod(t){return function insertVariation(r){var i=r.node,o=t.api,a=t.dom,l=t.el,h=t.game,g=i.ids,y=h.getRawLines()[g.line],_={line:y.parentId,move:y.atMoveNode},x=o.getMoveNode({line:_.line,move:_.move+1}),w=h.getNodeByIds(_);if(!w||isLine(w))throw new cn.a({code:ln.a.ElementNotFound,message:"Anchor node element for variation not found."});var S=l,M=createLineElement(y.id,kt.ClassNames.Variation);if(0===w.ids.line&&M.classList.add(kt.ClassNames.MainLine),a.addNode(i,{target:M}),w.lines&&w.lines.length>1)S=getLineElement(w.lines[w.lines.length-2]);else{var T=o.getMoveNode(w.ids);T&&(S=T.getElement())}S&&S.after(M),void 0!==x&&x.touch(rn.TouchableKeys.MoveNumber)}}function getVariations(t,r){return r.lines?r.lines.reduce((function(r,i){return r.push(t[i]),r}),[]):[]}function createLineVariationElements(t){var r,i=t.api,o=t.depth,a=t.parentLineEl,l=t.lines,h=t.line;r=1===o?document.createDocumentFragment():createLineElement(h.id,kt.ClassNames.Variation),h.initComment&&r.appendChild(i.addComment(h)),h.forEach((function(t){var a=i.addNode(t,{target:r});t.comment&&a.getElement().appendChild(i.addComment(t)),t.lines&&getVariations(l,t).forEach((function(t){createLineVariationElements({api:i,depth:o+1,line:t,lines:l,parentLineEl:r})}))})),a.appendChild(r)}function createLoadMethod(t){return function load(){var r=t.api,i=t.dom,o=t.el,a=t.game,l=t.placeholders[kt.Placeholders.Moves];i.reset();var h=a.getRawLines();h[0].initComment&&o.insertBefore(i.addComment(h[0]),l),h[0].forEach((function(t){var r=i.addNode(t,{anchor:l,target:o});t.comment&&r.getElement().appendChild(i.addComment(t)),t.lines&&getVariations(h,t).forEach((function(t){var r=createLineElement(t.id,kt.ClassNames.Variation,kt.ClassNames.MainLine);createLineVariationElements({api:{addComment:i.addComment,addNode:i.addNode},depth:1,line:t,lines:h,parentLineEl:r}),o.insertBefore(r,l)}))}));var g=a.getSelectedNode();g&&r.selectNode(g.ids),function restoreCustomColorsData(t){var r=t.dom,i=t.game;i.getRawLines().forEach((function(t){t.forEach((function(t){var o=i.getNodeByIds(t.ids);if(isNode(o)){var a=o.customColor;a&&r.updateMoveNodeComponent(t.ids,{customColor:a})}}))}))}(t)}}function createRemoveCommentMethod(t){return function removeComment(r){var i=t.state,o=getCommentElementId(r);i.comments[o]&&(!function removeCommentElement(t){var r=document.getElementById(getCommentElementId(t));r&&r.parentNode&&r.parentNode.removeChild(r)}(r),delete i.comments[o])}}function createRemoveEditableCommentMethod(t){return function removeEditableComment(){if(void 0!==t.editableCommentComponent){try{t.editableCommentComponent.destroy()}catch(r){}t.editableCommentComponent=void 0}}}function createRemoveLineMethod(t){return function removeLine(r){var i=t.api,o=t.dom,a=t.state,l=r.id;if(void 0===a.nodes[l])throw new cn.a({code:ln.a.BadData,data:r,message:"No line with id ".concat(l," found")});a.nodes[l][0]&&o.removeNode({line:l,move:0});var h,g=getLineElement(l);g&&g.parentNode.removeChild(g),delete a.nodes[l],void 0!==r.atMoveNode&&void 0!==r.parentId&&(h=i.getMoveNode({line:r.parentId,move:r.atMoveNode+1})),h&&h.touch(rn.TouchableKeys.MoveNumber)}}function createRemoveNodeMethod(t){return function removeNode(r){var i=r.line,o=r.move,a=t.api,l=t.state,h=a.getMoveNode({line:i,move:o});if(h){var g=Object.keys(l.nodes[h.ids.line]).length-1;if(l.nodes[h.ids.line][h.ids.move]!==l.nodes[h.ids.line][g])for(var y=g;y>h.ids.move;y--)l.nodes[h.ids.line][y].destroy(),delete l.nodes[h.ids.line][y];h.destroy(),delete l.nodes[h.ids.line][h.ids.move],function removeOrphanedElements(t){var r=t.game,i=t.state,o=r.getRawLines();Object.keys(i.nodes).forEach((function(t){var r;o[t]||(Object.values(i.nodes[t]).forEach((function(t){return t.destroy()})),null===(r=getLineElement(Number(t)))||void 0===r||r.remove(),delete i.nodes[t])}))}(t);var _=a.getMoveNode({line:h.ids.line,move:h.ids.move+1});_&&_.touch(rn.TouchableKeys.MoveNumber)}}}function createResetMethod(t){return function reset(){var r=t.dom,i=t.el,o=t.state,a=t.placeholders;r.removeEditableComment(),i.innerHTML="",o.comments={},o.nodes={},o.selectedNode=void 0,i.appendChild(a[kt.Placeholders.Moves]),i.appendChild(a[kt.Placeholders.GameResult])}}function createSetResultNodeMethod(t){return function setResultNode(r){var i,o=document.querySelector(".".concat(an.Classes.GameResultNode)),a=t.placeholders[kt.Placeholders.GameResult];if(o&&(null===(i=o.parentElement)||void 0===i||i.removeChild(o)),r!==We.a.Results.None){var l=t.el,h=document.createElement("span");h.classList.add(an.Classes.GameResultNode),h.innerText=r,l.insertBefore(h,a)}}}function createUpdateLineComponent(t){return function updateLineComponent(r,i){var o=t.dom,a=t.game.getLine(r);if(a&&void 0!==i.initComment){var l=0===a.id?o.getElement():getLineElement(a.id);null==l||l.prepend(o.addComment(a))}}}function createUpdateMoveNodeComponent(t){return function updateMoveNodeComponent(r,i){var o=t.api,a=t.dom,l=t.game.getNodeByIds(r),h=o.getMoveNode(r);if(l&&!isLine(l)&&h){var g=h.getElement(),y=[],_=i.additionalAnnotation,x=i.annotation,w=i.comment,S=i.customColor,M=i.isCommentEnabled;if(void 0===_&&void 0===x||y.push(rn.TouchableKeys.Annotation),void 0!==w)if(""===w)a.removeComment(l);else{var T=h.getNodeData(),P=a.addComment(T,null==M||M);g.appendChild(P)}void 0!==S&&y.push(rn.TouchableKeys.CustomColor),y.forEach((function(t){return h.touch(t)}))}}}function createHorizontalMoveList(t){var r=t.el,i=t.game,o=t.options,a=t.stateMachineListeners,l=t.stateMachine,h=t.queue,g=t.placeholders,y=t.scrollContainer,_=t.translations,x={api:{},contextMenuActions:un,dom:{},editableCommentComponent:void 0,el:r,game:i,options:o,queue:h,placeholders:g,scrollContainer:y,state:{comments:{},nodes:{},selectedNode:void 0},stateMachine:l,stateMachineListeners:a,translations:void 0===_?Ht:_},w=x.api,S=x.dom,M=x.game;return Object.assign(w,Object.assign({},function createHMLComponentAPI(t){return{getComments:function getComments(){return t.state.comments},getContext:function getContext(){return t},getContextMenuActions:createGetContextMenuActions(t),getMoveNode:createGetMoveNodeMethod(t),getNodes:function getNodes(){return t.state.nodes},getOptions:function getOptions(){return t.options},getSelectedNode:function getSelectedNode(){return t.state.selectedNode},resetSelectedNode:createResetSelectedNode(t),selectLineStart:createSelectLineStart(t),selectNode:createSelectNodeMethod(t),setOptions:createSetOptionsMethod(t)}}(x))),Object.assign(S,Object.assign({},function createHMLDOMService(t){var r=t.el,i=t.placeholders;return r.classList.add(kt.ClassNames.Component),r.addEventListener("contextmenu",disableContextMenu),r.appendChild(i[kt.Placeholders.Moves]),r.appendChild(i[kt.Placeholders.GameResult]),{addComment:createAddCommentMethod(t),addNode:createAddNodeMethod(t),destroy:createDestroyMethod(t),getElement:function getElement(){return r},insertEditableComment:createInsertEditableCommentMethod(t),insertNode:createInsertNodeMethod(t),insertVariation:createInsertVariationMethod(t),load:createLoadMethod(t),removeComment:createRemoveCommentMethod(t),removeEditableComment:createRemoveEditableCommentMethod(t),removeLine:createRemoveLineMethod(t),removeNode:createRemoveNodeMethod(t),reset:createResetMethod(t),setResultNode:createSetResultNodeMethod(t),setScrollContainer:function setScrollContainer(r){return t.scrollContainer=r},updateLineComponent:createUpdateLineComponent(t),updateMoveNodeComponent:createUpdateMoveNodeComponent(t)}}(x))),M.extendAPI(_e.Plugin.Name,{addContextMenuActions:function addContextMenuActions(){return function createAddContextMenuActions(t){return function addContextMenuActions(r){Object.keys(r).forEach((function(i){t.contextMenuActions[i]=r[i]}))}}(x)}}),{api:w,dom:S}}function initializeMoveList(t){var r=t.context,i=t.coreContext,o=r.el,a=r.scrollContainer,l=r.translations,h=i.api,g=h.getOptions();r.moveList=createHorizontalMoveList({el:o,game:h,options:{moveListContextMenuEnabled:g.moveListContextMenuEnabled,moveListDisplayType:g.moveListDisplayType},queue:r.queue,placeholders:r.placeholders,scrollContainer:a,stateMachine:r.stateMachine,stateMachineListeners:r.stateMachineListeners,translations:l}),r.moveList.dom.load()}i(101);function context_menu_svelte_get_each_context(t,r,i){const o=Object.create(t);return o.annotation=r[i],o}function get_each_context_1(t,r,i){const o=Object.create(t);return o.action=r[i],o}function create_each_block_1(t){var r,i,o,a=t.translations[t.action.name]?t.translations[t.action.name]():t.action.name+"";function click_handler(){return t.click_handler(t)}return{c(){r=internal_element("span"),i=internal_text(a),attr(r,"class",Ft.Classes.ActionName+" svelte-t5531j"),o=listen(r,"click",click_handler)},m(t,o){insert(t,r,o),append(r,i)},p(r,o){t=o,(r.translations||r.actions)&&a!==(a=t.translations[t.action.name]?t.translations[t.action.name]():t.action.name+"")&&set_data(i,a)},d(t){t&&detach(r),o()}}}function context_menu_svelte_create_each_block(t){var r,i,o,a,l,h=t.annotation.display+"";function click_handler_1(){return t.click_handler_1(t)}return{c(){r=internal_element("span"),i=internal_text(h),o=space(),attr(r,"alt",a=t.translations[t.annotation.meaning]()),attr(r,"class",Ft.Classes.Annotation+" svelte-t5531j"),l=listen(r,"click",click_handler_1)},m(t,a){insert(t,r,a),append(r,i),append(r,o)},p(i,o){t=o,i.translations&&a!==(a=t.translations[t.annotation.meaning]())&&attr(r,"alt",a)},d(t){t&&detach(r),l()}}}function context_menu_svelte_create_fragment(t){var r,i,o,a,l,h;let g=t.actions,y=[];for(let w=0;w<g.length;w+=1)y[w]=create_each_block_1(get_each_context_1(t,g,w));let _=yn,x=[];for(let w=0;w<_.length;w+=1)x[w]=context_menu_svelte_create_each_block(context_menu_svelte_get_each_context(t,_,w));return document.body.addEventListener("click",t.handleDocumentClick),{c(){r=internal_element("div");for(let t=0;t<y.length;t+=1)y[t].c();i=space(),o=internal_element("div"),a=space(),l=internal_element("div");for(let t=0;t<x.length;t+=1)x[t].c();h=space(),attr(o,"class",Ft.Classes.Divider+" svelte-t5531j"),attr(l,"class",Ft.Classes.AnnotationsContainer+" svelte-t5531j"),attr(r,"class",Ft.Classes.Component+" svelte-t5531j")},m(g,_){insert(g,r,_);for(let t=0;t<y.length;t+=1)y[t].m(r,null);append(r,i),append(r,o),append(r,a),append(r,l);for(let t=0;t<x.length;t+=1)x[t].m(l,null);append(r,h),t.div2_binding(r)},p(t,o){if(t.ContextMenuComponent||t.translations||t.actions){let a;for(g=o.actions,a=0;a<g.length;a+=1){const l=get_each_context_1(o,g,a);y[a]?y[a].p(t,l):(y[a]=create_each_block_1(l),y[a].c(),y[a].m(r,i))}for(;a<y.length;a+=1)y[a].d(1);y.length=g.length}if(t.translations||t.annotations||t.ContextMenuComponent){let r;for(_=yn,r=0;r<_.length;r+=1){const i=context_menu_svelte_get_each_context(o,_,r);x[r]?x[r].p(t,i):(x[r]=context_menu_svelte_create_each_block(i),x[r].c(),x[r].m(l,null))}for(;r<x.length;r+=1)x[r].d(1);x.length=_.length}},i:noop,o:noop,d(i){i&&detach(r),destroy_each(y,i),destroy_each(x,i),t.div2_binding(null),document.body.removeEventListener("click",t.handleDocumentClick)}}}function context_menu_svelte_instance(t,r,i){let{actions:o,translations:a}=r;const l=createEventDispatcher();let h;return t.$set=t=>{"actions"in t&&i("actions",o=t.actions),"translations"in t&&i("translations",a=t.translations)},{actions:o,translations:a,dispatch:l,el:h,getElement:function getElement(){return h},handleDocumentClick:function handleDocumentClick(t){t.target.classList.contains(Ft.Classes.Component)||l(Bt.Events.Close)},click_handler:({action:t})=>l(Bt.Events.ActionClicked,{action:t}),click_handler_1:({annotation:t})=>l(Bt.Events.AnnotationClicked,{action:t.action,data:t.code}),div2_binding:function div2_binding(t){U[t?"unshift":"push"]((()=>{i("el",h=t)}))}}}var xn=class context_menu_svelte_Context_menu extends K{constructor(t){super(),internal_init(this,t,context_menu_svelte_instance,context_menu_svelte_create_fragment,safe_not_equal,["actions","translations","getElement"])}get getElement(){return this.$$.ctx.getElement}};function createContextMenu(t){var r=t.actions,i=t.el,o=t.moveNode,a=t.emitter,l=t.translations,h=o.getElement(),g=function createContextMenuComponent(t,r){var i=r.anchor,o=r.props;return createSvelteComponent({ComponentType:xn,methods:["getElement"],options:{anchor:i,props:o,target:t},replaceContainer:!1})}(h.parentElement||i,{anchor:h,props:{actions:r,translations:l}});return setPosition(),function registerListeners(){g.on(Bt.Events.ActionClicked,createEventHandler(Bt.Events.ActionClicked)),g.on(Bt.Events.AnnotationClicked,createEventHandler(Bt.Events.AnnotationClicked)),g.on(Bt.Events.Close,(function(){return a.emit(Bt.Events.Close)})),i.addEventListener("scroll",function debounce(t,r){var i;return function run(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];clearTimeout(i),i=setTimeout((function(){i=null,t.apply(void 0,a)}),r)}}(setPosition,50))}(),{destroy:g.destroy};function createEventHandler(t){return function handleEvent(r){var i=r.detail;a.emit(t,{action:i.action,data:i.data,moveNode:o.getNodeData()})}}function setPosition(){var t=g.getElement();if(t){var r=function getContextMenuPosition(t){var r=t.contextMenu,i=t.moveNode,o=t.padding,a=void 0===o?{x:10,y:20}:o,l=i.y+a.y-window.pageYOffset,h=window.innerHeight-r.height,g={left:0,top:0};return g.top=Math.min(l,h),g.bottom=g.top+r.height,i.x>window.innerWidth-r.width?g.left=i.x+i.width-r.width:(l<h&&(a.x=0),g.left=i.x+a.x),g}({contextMenu:t.getBoundingClientRect(),moveNode:h.getBoundingClientRect()}),i=r.left,o=r.top;t.style.left="".concat(i,"px"),t.style.top="".concat(o,"px")}}}function initializeContextMenu(t){var r=t.el,i=t.moveList,o=t.stateMachine,a=t.methods.destroyContextMenu,l=t.translations;function handleContextMenuAction(t){a(),function createContextMenuActionHandler(t,r){return function handleContextMenuAction(i){var o=i.action,a=i.data,l=i.moveNode,h=r.api.getMoveNode(l.ids);if(!h)throw new cn.a({code:ln.a.BadData,data:l.ids,message:"No move node found."});o.handler(l,{context:t,data:a,moveList:r,moveNodeComponent:h}),t.queue.flush()}}(i.api.getContext(),i)(t)}function handleAnnotationAction(t){var r=t.action,o=t.data,l=t.moveNode;a();var h=i.api.getMoveNode(l.ids);if(!h)throw new cn.a({code:ln.a.BadData,data:l.ids,message:"No move node found."});var g={data:o,game:i.api.getContext().game,moveNodeComponent:h,node:l};r===Bt.AnnotationActions.AddAnnotation?function addAnnotation(t){var r=t.node,i=t.game,o=t.data,a=t.moveNodeComponent,l=normalizeAnnotation(o),h=a.getNodeData().annotation===l?void 0:l;i.updateNode(r.ids,{annotation:h}),a.touch(rn.TouchableKeys.Annotation)}(g):r===Bt.AnnotationActions.AddAdditionalAnnotation&&function addAdditionalAnnotation(t){var r=t.node,i=t.game,o=t.data,a=t.moveNodeComponent,l=normalizeAnnotation(o),h=a.getNodeData().additionalAnnotation,g=(null==h?void 0:h[0])===l?void 0:[l];i.updateNode(r.ids,{additionalAnnotation:g}),a.touch(rn.TouchableKeys.Annotation)}(g)}function createOpenContextMenuHandler(h){var g;i.api.selectNode(h.node.ids);var y=i.api.getContextMenuActions(h.node.ids);a(),t.contextMenu=createContextMenu({actions:y,el:null!==(g=t.scrollContainer)&&void 0!==g?g:r,emitter:o,moveNode:i.api.getMoveNode(h.node.ids),translations:l})}t.stateMachineListeners.push([Bt.Events.ActionClicked,handleContextMenuAction],[Bt.Events.AnnotationClicked,handleAnnotationAction],[an.Events.OpenContextMenu,createOpenContextMenuHandler]),o.on(Bt.Events.ActionClicked,handleContextMenuAction),o.on(Bt.Events.AnnotationClicked,handleAnnotationAction),o.on(an.Events.OpenContextMenu,createOpenContextMenuHandler)}var wn={condition:function handle_initialization_condition(t){var r=t.context,i=t.event;return function match(){return i.type===ke.a.InstanceEvents.Create||i.type===ke.a.InstanceEvents.ModeChanged||!r.moveList||0===Object.entries(r.moveList).length}},handler:function handle_initialization_handler(t){var r=t.context,i=t.coreContext;initializeMoveList({context:r,coreContext:i}),r.enableContextMenu&&initializeContextMenu(r)}};function createQueuedEventHandler(t,r){return function queuedEvent(i){i.selectedNode=Object.assign({},i.coreContext.api.getRelativeNode()),t.add(r,i)}}var Sn=i(19),Mn=i.n(Sn);function noop_shared_noop(){}var En,Tn=")";function copyMoveListContentToClipboard(t){var r=t.api,i=t.el,o=t.win,a=(void 0===o?window:o).getSelection(),l=null==a?void 0:a.anchorNode,h=null==a?void 0:a.focusNode;if(!l||!h)return null;var g=r.getPGN(),y=getPosition({moveList:i,node:l,pgn:g}),_=getPosition({moveList:i,node:h,pgn:g});if(null===y||null===_)return null;var x=Math.min(y,_),w=Math.max(y,_),S=getMoveText(copy_move_list_content_to_clipboard_getMoveElement(y<_?h:l)).length,M=w+S-x,T=g.substr(x,M);return function copyStringToClipboard(t){var r=document.createElement("textarea");document.body.append(r),r.value=t,r.focus(),r.select(),document.execCommand("cut"),r.remove()}(T=function addClosingParentheses(t){for(var r=t.lastIndex,i=t.pgn,o=t.pgnPiece,a=new RegExp("\\".concat("("),"g"),l=(o.match(a)||[]).length,h=o,g=0;g<l&&i[r+g]===Tn;g++)h+=Tn;return h}({lastIndex:w+S,pgn:g,pgnPiece:T})),T}function getPosition(t){var r=t.moveList,i=t.pgn,o=copy_move_list_content_to_clipboard_getMoveElement(t.node),a=getMoveText(o),l=function getMoveOrder(t,r){return Array.from(t.querySelectorAll(".".concat(an.Classes.MoveNode))).filter((function(t){return t.textContent===r.textContent})).findIndex((function(t){return t===r}))}(r,o)||0;return i.split("").findIndex((function(t,r){if(i.substr(r,a.length)===a){if(0===l)return r;l--}return!1}))}function copy_move_list_content_to_clipboard_getMoveElement(t){var r;return!t.parentNode||(null===(r=null==t?void 0:t.classList)||void 0===r?void 0:r.contains(an.Classes.MoveNode))?t:copy_move_list_content_to_clipboard_getMoveElement(t.parentNode)}function getMoveText(t){var r=t.querySelector(".".concat(an.Classes.MoveNumber)),i=t.querySelector(".".concat(an.Classes.MoveText)),o=t.querySelector(".".concat(an.Classes.Comment)),a="";return r&&(a+="".concat(r.textContent," ")),i&&(a+=i.textContent),o&&(a+=" {".concat(o.textContent,"}")),a}function createDiagramAction(t){var r=t.action,i=t.nodeLimit,o=r.includes("Set");return{action:Bt.Actions[r],handler:function handler(t,r){var a=r.moveList,l=r.moveNodeComponent;!function diagramActionHandler(t){var r,i,o,a=t.limitType,l=t.isSettingNodeLimits,h=t.moveList,g=t.moveNodeComponent,y=t.node,_=h.api.getContext(),x=null===(r=_.state.nodeLimit)||void 0===r?void 0:r[a];x&&(o=h.api.getMoveNode({line:x.ids.line,move:x.ids.move}));l?function setNodeLimits(t){var r=t.limitType,i=t.moveList,o=t.moveNodeComponent,a=t.node,l=i.api.getContext();l.state.nodeLimit&&(l.state.nodeLimit[r]=a);if(r===kt.NodeLimitTypes.Focus)return void o.addNodeStyles({fontStyle:"italic"});var h=document.createElement("span"),g="diagram-".concat(r),y=r===kt.NodeLimitTypes.Begin?"[[":"]]";h.classList.add(g),h.innerHTML=y,r===kt.NodeLimitTypes.Begin?o.insertBeforeNode(h):r===kt.NodeLimitTypes.End&&o.insertAfterNode(h)}({limitType:a,moveList:h,moveNodeComponent:g,node:y}):(null===(i=_.state.nodeLimit)||void 0===i||delete i[a],removeNodeLimits({limitType:a,moveList:h,moveNodeComponent:g}));o&&removeNodeLimits({limitType:a,moveList:h,moveNodeComponent:o})}({limitType:i,isSettingNodeLimits:o,moveList:a,moveNodeComponent:l,node:t})},isVisible:function isVisible(t){var r,a,l=t.state,h=null===(r=l.nodeLimit)||void 0===r?void 0:r[i],g=Boolean((null==h?void 0:h.move)===(null===(a=l.selectedNode)||void 0===a?void 0:a.getNodeData().move));return o?Boolean(!h||!g):Boolean(h&&g)},name:It.Translation.Actions[r]}}var Pn=(En={},j()(En,Bt.Actions.SetBegin,createDiagramAction({action:Bt.Actions.SetBegin,nodeLimit:kt.NodeLimitTypes.Begin})),j()(En,Bt.Actions.SetFocus,createDiagramAction({action:Bt.Actions.SetFocus,nodeLimit:kt.NodeLimitTypes.Focus})),j()(En,Bt.Actions.SetEnd,createDiagramAction({action:Bt.Actions.SetEnd,nodeLimit:kt.NodeLimitTypes.End})),j()(En,Bt.Actions.RemoveBegin,createDiagramAction({action:Bt.Actions.RemoveBegin,nodeLimit:kt.NodeLimitTypes.Begin})),j()(En,Bt.Actions.RemoveFocus,createDiagramAction({action:Bt.Actions.RemoveFocus,nodeLimit:kt.NodeLimitTypes.Focus})),j()(En,Bt.Actions.RemoveEnd,createDiagramAction({action:Bt.Actions.RemoveEnd,nodeLimit:kt.NodeLimitTypes.End})),En);function createAddDiagramActions(t,r){var i=t.api;return function addDiagramActions(){i.addContextMenuActions(Pn),r.moveList.api.getContext().state.nodeLimit={},i.extendAPI(_e.Plugin.Name,{getDiagramNodeLimits:function getDiagramNodeLimits(){return r.moveList.api.getContext().state.nodeLimit}})}}function removeNodeLimits(t){var r=t.limitType,i=t.moveList,o=t.moveNodeComponent,a=i.dom.getElement().querySelector(".diagram-".concat(r));a?a.remove():o.removeNodeStyles()}function createSetScrollContainer(t){return function setScrollContainer(r){t.scrollContainer=r,t.moveList.dom.setScrollContainer(r)}}function createHorizontalMoveListPlugin(t){var r,i=t.el,o=t.enableContextMenu,a=void 0===o||o,l=t.scrollContainer,h=t.translations,g=void 0===h?Ht:h,y=(r={},j()(r,kt.Placeholders.GameResult,document.createComment("/Game Result")),j()(r,kt.Placeholders.Moves,document.createComment("/Moves")),r),_={contextMenu:void 0,el:i,enableContextMenu:a,methods:{destroy:noop_shared_noop,destroyContextMenu:noop_shared_noop,handleCommentClick:noop_shared_noop,handleCopy:noop_shared_noop,selectCurrentPosition:noop_shared_noop},moveList:{},queue:createQueue(!1),placeholders:y,scrollContainer:l||i,stateMachine:createHMLStateMachine(),stateMachineListeners:[],translations:g};return{api:function api(t){return function createHMLAPI(t,r){return{addDiagramActions:createAddDiagramActions(t,r),setScrollContainer:createSetScrollContainer(r)}}(t,_)},create:function create(t){(function registerMethods(t){_.methods.destroy=function createDestroy(t){return function destroy(){var r,i;t.stateMachineListeners.forEach((function(r){var i=Mn()(r,2),o=i[0],a=i[1];t.stateMachine.off({handler:a,type:o})})),t.stateMachineListeners=[],t.moveList&&(null===(i=null===(r=t.moveList)||void 0===r?void 0:r.dom)||void 0===i?void 0:i.destroy)&&t.moveList.dom.destroy()}}(_),_.methods.destroyContextMenu=function createDestroyContextMenu(t){return function destroyContextMenu(){t.contextMenu&&(t.contextMenu.destroy(),t.contextMenu=void 0)}}(_),_.methods.handleCommentClick=function createCommentClickHandler(t){return function commentClickHandler(r){t.moveList.dom.insertEditableComment(r)}}(_),_.methods.handleCopy=function createCopyEventHandler(t){var r=t.context,i=t.el;return function copyEventHandler(t){var o;(null===(o=t.target.classList)||void 0===o?void 0:o.contains(Wt.Classes.Component))||copyMoveListContentToClipboard({api:r.api,el:i})&&t.preventDefault()}}({context:t,el:i}),_.methods.selectCurrentPosition=function createSelectCurrentPosition(t){return function selectCurrentPosition(r){r&&(isLine(r)?t.moveList.api.selectLineStart(r):isNode(r)&&t.moveList.api.selectNode(r.ids))}}(_)})(t),function registerListeners(){_.stateMachine.on(Bt.Events.Close,_.methods.destroyContextMenu),_.stateMachine.on(Gt.Events.Click,_.methods.handleCommentClick),_.stateMachineListeners.push([Bt.Events.Close,_.methods.destroyContextMenu],[Gt.Events.Click,_.methods.handleCommentClick]),i.addEventListener("copy",_.methods.handleCopy)}(),runHorizontalMoveListPlugin({data:null,type:ke.a.APIEvents.Load},t)},destroy:function destroy(){_.methods.destroy(),i.removeEventListener("copy",_.methods.handleCopy)},match:[{condition:isOneOf([ke.a.APIEvents.AddMove,ke.a.APIEvents.CreateContinuation,ke.a.APIEvents.CreateGame,ke.a.APIEvents.DeletePosition,ke.a.APIEvents.LineCommentUpdated,ke.a.APIEvents.Load,ke.a.APIEvents.Move,ke.a.APIEvents.MoveBackward,ke.a.APIEvents.MoveForward,ke.a.APIEvents.NodeUpdated,ke.a.APIEvents.PromoteVariation,ke.a.APIEvents.ResetToMainLine,ke.a.APIEvents.SelectLineEnd,ke.a.APIEvents.SelectLineStart,ke.a.APIEvents.SelectNode,ke.a.APIEvents.Undo,ke.a.APIEvents.UpdatePGNHeaders,ke.a.InstanceEvents.ModeChanged,ke.a.InstanceEvents.Create,ke.a.OptionsEvents.Update]),handler:runHorizontalMoveListPlugin}],name:_e.Plugin.Name};function runHorizontalMoveListPlugin(t,r){!function runPatternMatcher(t){var r=t.conditionParams,i=t.handlerContext,o=i.context.queue;!function matchPattern(t,r){var i=t.find((function(t){return t[0](r)}));if(i)i[1](r)}([Vt,Ut,zt,Xt,wn,Kt,Yt,Zt,Qt,Jt,en,nn,tn].map((function(t){var i=t.condition,a=t.handler;return[i(r),createQueuedEventHandler(o,a)]})),i),forceNextFrame((function flushHorizontalMoveListQueue(){o.flush()}))}({conditionParams:{context:_,event:t},handlerContext:{context:_,coreContext:r,event:t}})}}function createMinimalPlugins(){return[createAssetsPlugin(),createBoardSizePlugin(),createPiecesPlugin(),createRendererErrorCatcherPlugin()]}function createStandardPlugins(){return[].concat(I()(createMinimalPlugins()),[createKeysPlugin(),createAccessibilityPlugin(),createArrowKeysPlugin(),createArrowsPlugin(),createBlinkingSquarePlugin(),createCoordinatesPlugin(),createFlipBoardPlugin(),createHighlightsPlugin([getSelectionSquare,getMoveHighlights,getAnalysisHighlights]),createHoverSquarePlugin(),createMoveHintsPlugin(),createSoundsPlugin()])}function createPremiumPlugins(){return[].concat(I()(createStandardPlugins()),[createFadeSetupPlugin(),createEffectsPlugin(),createCustomItemsPlugin(),createCheatDetectionPlugin()])}function createKitchenSinkPlugins(){return[].concat(I()(createPremiumPlugins()),[createAnalysisOverlayPlugin(),createDebugPlugin()])}var Cn=i(60),An=i(59),On=i(77),Ln=i(55);function booleanArgumentPassed(t){return!0===t||!1===t}function getElementBackgroundImage(t,r){return window.getComputedStyle(t,r).backgroundImage}function getPieceShortStringFromUrl(t){var r=Mn()(t.split("/").pop().split(".")[0],2),i=r[0],o=r[1];return"w"===i?o.toUpperCase():o}function getFileRankFromSan(t){return{file:t.toLowerCase().charCodeAt(0)-96,rank:Number(t.charAt(1))}}function getBoardPosition(t,r){return t.reduce((function(t,i){var o=getPieceShortStringFromUrl(getElementBackgroundImage(i,r.classList.contains(Ve.a.Pseudo3d)?":after":void 0)),a=getFileRankFromSan(i.dataset.testSquare),l=a.file,h=a.rank;return o&&l&&h?(t[8-h][l-1]=o,t):t}),[[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".",".",".",".","."]]).map((function(t){return t.join("").replace(/(\.+)/g,(function(t){return t.length.toString()}))})).join("/")}function getCoordsFromSquare(t,r,i){return new Cypress.Promise((function(o){var a,l,h=r.getBoundingClientRect(),g=(h.right-h.left)/8,y=getFileRankFromSan(t);i&&(y.file=9-y.file,y.rank=9-y.rank),null!==y?(a=(y.file-1)*g+g/2,l=(9-y.rank)*g-g/2):(a=-1,l=-1),o({x:a,y:l})}))}function getHighlightType(t){var r=t.color,i=t.opacity,o=t.options;return"#ffff00"===r&&i===o.highlightOpacity?"default":r===o.premoveHighlightColor&&i===o.premoveHighlightOpacity?"premove":r===o.analysisHighlightColors.alt&&i===o.analysisHighlightOpacity?"altAnalysis":r===o.analysisHighlightColors.default&&i===o.analysisHighlightOpacity?"defaultAnalysis":r===o.analysisHighlightColors.shift&&i===o.analysisHighlightOpacity?"shiftAnalysis":r===o.analysisHighlightColors.ctrl&&i===o.analysisHighlightOpacity?"ctrlAnalysis":r&&i?{color:r,opacity:i}:null}function getSanFromFileRank(t){if(!(!t||!t.file||!t.rank||t.file>8||t.rank>8))return"".concat(String.fromCharCode(96+t.file)).concat(t.rank.toString())}function getSelectorName(t){return t.substring(1)}function getSquareFromRects(t){var r=t.boardRect,i=t.elRect,o=t.flipped,a=void 0!==o&&o,l=r.width/8,h=(i.left-r.left)/l+1,g=(i.top-r.top)/l+1;return getSanFromFileRank(a?{file:9-h,rank:g}:{file:h,rank:9-g})}function shouldExist(t,r){cy.get(r).should((function(r){t?expect(r[0]).to.exist:expect(r[0]).to.not.exist}))}function triggerEvent(t){var r=t.event,i=t.options,o=void 0===i?{}:i,a=t.data,l=void 0===a?{}:a,h=t.pointerCoordsFn,g=function getEventDetails(t){if("Pointermove"===t)return{eventName:"pointermove"};if("PointerdownLeft"===t)return{eventName:"pointerdown",which:0};if("PointerdownMiddle"===t)return{eventName:"pointerdown",which:2};if("PointerdownRight"===t)return{eventName:"pointerdown",which:3};if("MousedownLeft"===t)return{eventName:"mousedown",which:0};if("MousedownRight"===t)return{eventName:"mousedown",which:3};if("Pointerup"===t)return{eventName:"pointerup"};if("DoubleClick"===t)return{eventName:"dblclick"};if("Wheel"===t)return{eventName:"wheel"};return{eventName:t}}(r),y=g.eventName,_=g.which;if(_&&Object.assign(o,{which:_}),l.keyPressed&&Object.assign(o,j()({},"".concat(l.keyPressed,"Key"),!0)),l.deltaY&&Object.assign(o,{deltaY:l.deltaY}),l.el){var x=l.position||"center";l.withText?cy.get(l.el).contains(l.withText).first().trigger(y,x,o):cy.get(l.el).first().trigger(y,x,o)}else if(void 0!==l.square&&null===l.square)cy.document().trigger(y,1,1,o);else{var w=o.board,S=o.flipped;cy.getBoard(w).then((function(t){l.coords?cy.getBoard(w).trigger(y,l.coords.x,l.coords.y,o):void 0!==l.square?h(l.square,t[0],S).then((function(t){cy.getBoard(w).trigger(y,t.x,t.y,o)})):cy.getBoard(w).trigger(y,o)}))}}function trueFalseToBoolean(t){switch(t){case"true":return!0;case"false":return!1;default:return t}}var In,Rn={"8_bit":"#ffff00",bases:"#f5cc2a",blackwhite:"#5b91b3",blue:"#00a5ff",brown:"#ffff00",bubblegum:"#de5d6f",burled_wood:"#ee9016",dark_wood:"#cc9122",dash:"#eca722",default:"#ffff00",glass:"#5b91b3",graffiti:"#f39011",green:"#ffff00",grey:"#a4b8c4",icy_sea:"#5ed7f1",light:"#a4b8c4",lolz:"#a3becd",marble:"#f0db86",marbleblue:"#65daf7",marblebrown:"#f39011",marblegreen:"#f0db86",metal:"#a3becd",natural:"#f0e464",nature:"#eef396",neon:"#6d90a6",newspaper:"#99976e",orange:"#ffff00",overlay:"#0d9acf",parchment:"#d8cc66",pink:"#de5d6f",purple:"#7dacc9",red:"#f8f893",sand:"#e2bc87",sky:"#65daf7",stone:"#36525f",tan:"#f7d84a",tournament:"#a4c25b",translucent:"#5b91b3",walnut:"#d1a52d",winboard:"#a4c25b",wood:"#cc9122",wooddark:"#ee9016",woodlight:"#d8cc66",woodmid:"#cc9122",woodolive:"#a3becd"};function buildMode(t){var r=t.base,i=t.initialOptions;return function getBoundMode(t){var o=Object.keys(i).reduce((function(t,r){return t[r]=i[r].default,t}),{}),a=r({api:t,options:o}),l=function createExtendMode(t,r){return function extendMode(i){var o=Object.entries(i).map((function(i){var o,a=Mn()(i,2),l=a[0],h=a[1];if(h&&(null===(o=t.overridableMethods)||void 0===o?void 0:o.includes(l))){var g=t[l];return t[l]=h(t,r),function destroyOverride(){t[l]=g}}}));return function destroyOverride(){o.map((function(t){return null==t?void 0:t()}))}}}(a,t);return Object.assign(a,{extendMode:l,getOptions:function getOptions(){return o},setOption:function setOption(t,r){var a;if(!(null===(a=i[t])||void 0===a?void 0:a.editable))return void warnOptionNotEditable(t);o[t]=r}})}}function createModeFactory(t,r){return function createMode(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=Object.keys(i).reduce((function(t,o){var a;return(null===(a=r[o])||void 0===a?void 0:a.editable)?Object.assign(t,j()({},o,{default:i[o],editable:!0})):warnOptionNotEditable(o),t}),r);return buildMode({base:t,initialOptions:o})}}function warnOptionNotEditable(t){console.warn("".concat(t," is not an editable option in this mode."))}function can_move_forward_canMoveForward(t){var r=t.api,i=t.followAlternateLines,o=void 0!==i&&i,a=t.mv,l=r.getContext(),h=l.game,g=(0,l.mutateGame)((function callMethod(){h.moveForward(o,a)}));return!!(null==g?void 0:g.plyDiff)&&(h.moveBackward(),!0)}function api_overrides_move_createMove(t){var r=t.api,i=r.move;return function move(t){var o=r.isAtEndOfLine(),a=r.getMode().getOptions().canAddMovesToMainLine;return can_move_forward_canMoveForward({api:r,followAlternateLines:!0,mv:t})?i(t):function shouldAddContinuation(t){var r,i=t.canAddMovesToMainLine,o=t.isAtEndOfLine,a=t.node,l=isNode(a)?null===(r=null==a?void 0:a.ids)||void 0===r?void 0:r.line:null==a?void 0:a.id;return!i&&o&&0===l}({canAddMovesToMainLine:a,isAtEndOfLine:o,node:r.getRelativeNode()})?function addContinuation(){if(r.createContinuation())return i(t);return null}():i(t)}}!function(t){!function(t){t.Name="analysis"}(t.Plugin||(t.Plugin={}))}(In||(In={}));var jn,Nn=createModeFactory((function base_base(t){var r=t.api;return{isAllowedToMove:function isAllowedToMove(){return r.getMode().getOptions().canAddMovesToMainLine||Boolean(r.getSelectedNode())},name:jt.Types.Analysis,plugins:[{apiOverrides:{move:api_overrides_move_createMove},name:In.Plugin.Name},createAnalysisOverlayPlugin()]}}),{canAddMovesToMainLine:{default:!0,editable:!0},canInteractWithPieces:{default:!0,editable:!0},canMoveWhenGameIsOver:{default:!0,editable:!1},canModifyExistingMovesOnMainLine:{default:!0,editable:!1}});function getIdsToDelete(t){return isNode(t)?{line:t.ids.line,move:t.ids.move+1}:{line:0,move:0}}function exploring_api_overrides_move_createMove(t){var r=t.api,i=r.move;return function move(t){if(r.isAtEndOfLine())return i(t);var o=getIdsToDelete(r.getRelativeNode()),a=o.line,l=o.move;return r.deletePosition(l,a),i(t)}}!function(t){!function(t){t.Name="exploring"}(t.Plugin||(t.Plugin={}))}(jn||(jn={}));var kn,Dn=createModeFactory((function exploring_base_base(){return{isAllowedToMove:function isAllowedToMove(){return!0},name:jt.Types.Explorer,plugins:[{apiOverrides:{move:exploring_api_overrides_move_createMove},name:jn.Plugin.Name}]}}),{canAddMovesToMainLine:{default:!0,editable:!1},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!0,editable:!1}});function createGuessTheMoveAPI(t){var r=[];return{cancel:function cancel(){var i=t.api,o=t.respond,a=getActiveGuess();if(!a)return;r.pop(),o(ke.a.APIEvents.SetBoardPosition,{pieces:i.getPieces()}),o(kn.APIEvents.CancelGuess,a)},confirm:function confirm(r){var i=t.respond,o=getLastGuess();if(!o)return;Object.assign(o,{confirmed:!0,correct:r}),i(kn.APIEvents.GuessConfirmed,o)},get:function get(){return r},getActiveGuess:getActiveGuess,guess:function guess(i){var o,a,l=t.api,h=t.respond,g=Object.assign(Object.assign({},i),{confirmed:!1,correct:!1,ids:null!==(a=null===(o=l.getSelectedNode())||void 0===o?void 0:o.ids)&&void 0!==a?a:{line:0,move:0}});r.push(g),h(kn.APIEvents.GuessMade,g)},reset:function reset(){r=[]}};function getActiveGuess(){var t=getLastGuess();return(null==t?void 0:t.confirmed)?void 0:t}function getLastGuess(){return r[r.length-1]}}function guess_the_move_api_overrides_move_createMove(t){var r=t.api,i=t.game,o=t.respond,a=r.move;return function move(t){return t.userGenerated?function handleGuessAttempt(t){if(r.isLegalMove(t)){var a=i.move(t);if(!a)return o(ke.a.APIEvents.IllegalMove);r.guessTheMove.guess(a);var l=Object.assign({},r.getPieces());return i.undo(),o(ke.a.APIEvents.SetBoardPosition,{pieces:l})}return o(ke.a.APIEvents.IllegalMove)}(t):function handleGameMoveAndConfirmGuess(t){var i=r.getMove(t),o=r.guessTheMove.getActiveGuess();if(!i||!o)return a(t);var l=i.color===r.getPlayingAs()&&i.san===o.san;return t.animate=!l,r.reload(),a(t),r.guessTheMove.confirm(l)}(t)}}function getGuessTheMoveHighlights(t,r){var i,o=r.api,a=r.options,l=null===(i=o.guessTheMove)||void 0===i?void 0:i.getActiveGuess();if(!a||!a.allowMarkings||!l)return Object(Be.a)();var h=Object(Be.a)();l.from&&h.set(l.from,createHighlightedSquare({options:a,square:l.from,type:We.a.HighlightedSquare.Types.Premove}));var g=l.kingTo||l.to;return h.set(g,createHighlightedSquare({options:a,square:g,type:We.a.HighlightedSquare.Types.Premove})),h}function createHandleIllegalMove(t){return function handleIllegalMove(){t.isAtEndOfLine()||t.selectLineEnd()}}!function(t){!function(t){t.Name="guessTheMove"}(t.Plugin||(t.Plugin={})),function(t){t.CancelGuess="CancelGuess",t.GuessConfirmed="GuessConfirmed",t.GuessMade="GuessMade"}(t.APIEvents||(t.APIEvents={}))}(kn||(kn={}));var Bn=createModeFactory((function guess_the_move_base_base(t){var r,i=t.api;return{isAllowedToMove:function isAllowedToMove(){return i.isAtEndOfLine()&&!i.guessTheMove.getActiveGuess()},handleIllegalMove:createHandleIllegalMove(i),name:jt.Types.GuessTheMove,plugins:[(r=!1,{api:createGuessTheMoveAPI,apiOverrides:{move:guess_the_move_api_overrides_move_createMove},beforeState:[{condition:is(ke.a.UserEvents.PointerdownRight),handler:function cancelGuess(t,r){var i=r.api,o=r.queue;return!i.guessTheMove.getActiveGuess()||(o.add(i.guessTheMove.cancel),!1)}}],destroy:function destroy(t){var r,i=t.api;null===(r=i.highlights)||void 0===r||r.removeModule(getGuessTheMoveHighlights)},match:[{condition:isOneOf(Et),handler:function handler(t,r){var i=r.api;t.type===ke.a.APIEvents.Load&&i.guessTheMove.reset(),i.setPlayingAs(i.getTurn())}},{condition:isOneOf(kn.APIEvents),handler:function addHighlights(t,i){var o,a,l;if(!r){var h=i.api;null===(o=h.highlights)||void 0===o||o.addModule(getGuessTheMoveHighlights),(null!==(l=null===(a=h.highlights)||void 0===a?void 0:a.getModules())&&void 0!==l?l:[]).find((function(t){return"getGuessTheMoveHighlights"===t.name}))&&(r=!0)}}},{condition:is(kn.APIEvents.GuessConfirmed),handler:function handleGuessConfirmation(t,r){var i=r.api,o=t.data,a=o.correct,l=o.ids;i.updateNode(l,{customColor:a?"#96bc4b":"#c93430"})}}],name:kn.Plugin.Name})],usePlayingAs:!0}}),{canAddMovesToMainLine:{default:!0,editable:!1},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!1,editable:!1}});function createLoad(t){var r=t.api,i=t.respond,o=r.load;return function load(t,a){return r.observing.clearCachedIds(),i(Nt.APIEvents.AnalysisEnd),o(t,a)}}function isMainLine(t){return 0===t}function observing_api_overrides_move_createMove(t){var r=t.api,i=r.move;return function move(o){return o.userGenerated?function userGeneratedMove(o){var a=t.game,l=t.respond,h=Object.assign({},a.ids()),g=h.move,y=h.line,_=r.observing.isAnalyzing();if(isMainLine(y)){if(-1===g)return l(ke.a.APIEvents.IllegalMove,o);can_move_forward_canMoveForward({api:r,followAlternateLines:!0,mv:o})||r.createContinuation()}if(!i(o))return;if(!isMainLine(a.ids().line))return r.observing.setCachedIds(g,y),_?void 0:l(Nt.APIEvents.AnalysisStart);return i(o)}(o):function programmaticMove(t){if(!isMainLine(r.getPosition().ids.line)||!r.isAtEndOfLine())return r.observing.addMoveToEndOfLine(t,0);return i(t)}(o)}}function getExtendedNode(t){var r=t.move,i=t.startingMoveNumber;if(!r)return null;var o=r.moveNumber,a=o%2==0&&r.color===We.a.ColorsAsNumbers.Black||o%2!=0&&r.color===We.a.ColorsAsNumbers.White,l=i+Math.floor(o/2)+(a&&r.color===We.a.ColorsAsNumbers.White?1:0);return Object.assign(Object.assign({},r),{ply:r.ids.move+1,wholeMoveNumber:l})}function createAddMoveToEndOfLine(t){return function addMoveToEndOfLine(r){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=t.api,l=t.game,h=t.mutateGame,g=t.respond,y=null!==(i=a.getSelectedNode())&&void 0!==i?i:{ids:{move:-1,line:0}},_=y.ids,x=_.move,w=_.line;l.selectLineEnd(o);var S=h((function callMethod(){l.move(r)}));return l.selectPosition(x,w),null===S?g(ke.a.APIEvents.IllegalMove,{fen:l.fen(),move:r}):(S.move=getExtendedNode({move:S.move,startingMoveNumber:l.startingMoveNumber()})||void 0,g(ke.a.APIEvents.AddMove,{listMove:S.move}))}}function createRestorePosition(t){return function restorePosition(r,i){var o=t.api,a=t.respond,l=Object.assign({},o.observing.getCachedIds());if(r?o.load(r,i):o.load({pgn:o.getPGN()}),a(Nt.APIEvents.AnalysisEnd),l){var h=l.move,g=l.line;o.selectNode(g,h)}}}function createRefreshAnalysisOverlay(t){return function refreshAnalysisOverlay(){var r=t.api,i=r.getOptions().overlayInAnalysisMode,o=r.observing.isAnalyzing();i!==o&&r.setOptions({overlayInAnalysisMode:o})}}function createObservingModeAPI(t){var r,i;return{addMoveToEndOfLine:createAddMoveToEndOfLine(t),clearCachedIds:function clearCachedIds(){r=void 0,i=void 0},getCachedIds:function getCachedIds(){return{move:r,line:i}},isAnalyzing:function isAnalyzing(){return void 0!==r},refreshAnalysisOverlay:createRefreshAnalysisOverlay(t),restorePosition:createRestorePosition(t),setCachedIds:function setCachedIds(t,o){r=t,i=o}}}var Fn,Gn=createModeFactory((function observing_base_base(){return{isAllowedToMove:function isAllowedToMove(){return!0},name:jt.Types.Observing,plugins:[createAnalysisOverlayPlugin(),{api:createObservingModeAPI,apiOverrides:{load:createLoad,move:observing_api_overrides_move_createMove},create:function create(t){t.api.setOptions({overlayInAnalysisMode:!1})},match:[{condition:isOneOf([Nt.APIEvents.AnalysisStart,Nt.APIEvents.AnalysisEnd]),handler:function refreshAnalysisOverlay(t,r){var i,o=r.api;null===(i=o.observing)||void 0===i||i.refreshAnalysisOverlay()}}],name:Nt.Plugin.Name}]}}),{canAddMovesToMainLine:{default:!0,editable:!1},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!1,editable:!1}});function playing_api_overrides_move_createMove(t){var r=t.api,i=r.move,o=function handleMoveOnPreviousNodeFactory(t){var r=t.api;return function handleMoveOnPreviousNode(){if(!r.isAtEndOfLine())if(r.getMode().getOptions().canModifyExistingMovesOnMainLine){var t=getIdsToDelete(r.getRelativeNode()),i=t.line,o=t.move;r.deletePosition(o,i)}else r.selectLineEnd()}}(t);return function move(t){return r.isGameOver()&&r.getMode().getOptions().canMoveWhenGameIsOver&&r.setResult(We.a.Results.None),o(),i(t)}}!function(t){!function(t){t.Name="playing"}(t.Plugin||(t.Plugin={}))}(Fn||(Fn={}));var Hn=createModeFactory((function playing_base_base(t){var r=t.api;return{handleIllegalMove:createHandleIllegalMove(r),isAllowedToMove:function isAllowedToMove(){return isAllowedToMoveInPlayingMode({api:r,canMoveWhenNotPlayerTurn:!1,modeOptions:r.getMode().getOptions()})},name:jt.Types.Playing,plugins:[{apiOverrides:{move:playing_api_overrides_move_createMove},name:Fn.Plugin.Name}],overridableMethods:["isAllowedToMove"],usePlayingAs:!0}}),{canAddMovesToMainLine:{default:!0,editable:!0},canMoveWhenGameIsOver:{default:!1,editable:!0},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!1,editable:!0}});var Vn,Un=createModeFactory((function passive_observing_base_base(){return{isAllowedToMove:function isAllowedToMove(){return!1},name:jt.Types.PassiveObserving}}),{canAddMovesToMainLine:{default:!1,editable:!1},canInteractWithPieces:{default:!1,editable:!1},canModifyExistingMovesOnMainLine:{default:!1,editable:!1}});function createDropPiece(t){return function dropPiece(r){var i=r.piece,o=r.square,a=t.api,l=t.game;return l.remove(o),l.put(i,o),a.setGameDetails({FEN:l.fen()}),a.reload()}}function createMovePiece(t){return function movePiece(r){var i=r.from,o=r.piece,a=r.to,l=t.api,h=t.game;return h.remove(i),h.remove(a),h.put(o,a),l.setGameDetails({FEN:h.fen()}),l.reload()}}function createRemovePiece(t){return function removePiece(r){var i=t.api,o=t.game;return o.remove(r),i.setGameDetails({FEN:o.fen()}),i.reload()}}function createSetupAPI(t){return{dropPiece:createDropPiece(t),movePiece:createMovePiece(t),removePiece:createRemovePiece(t)}}function api_overrides_get_move_createGetMove(){return function getMove(t){return t}}function setup_api_overrides_move_createMove(t){var r=t.api;return function move(t){var i=t.color,o=t.drop,a=t.from,l=t.to,h=r.setup,g=i&&o?{color:i,type:o}:r.getPiece(a);g&&(a&&l?h.movePiece({from:a,piece:g,to:l}):l?h.dropPiece({piece:g,square:l}):a&&h.removePiece(a))}}!function(t){!function(t){t.DropPiece="DropPiece",t.MovePiece="MovePiece",t.RemovePiece="RemovePiece"}(t.Events||(t.Events={})),function(t){t.Name="setup"}(t.Plugin||(t.Plugin={}))}(Vn||(Vn={}));var zn,Wn,qn=createModeFactory((function setup_base_base(){return{isAllowedToMove:function isAllowedToMove(){return!0},name:jt.Types.Setup,plugins:[{api:createSetupAPI,apiOverrides:{getMove:api_overrides_get_move_createGetMove,isLegalMove:function isLegalMove(){return!0},move:setup_api_overrides_move_createMove},name:Vn.Plugin.Name}]}}),{canAddMovesToMainLine:{default:!1,editable:!1},canDropOffBoard:{default:!0,editable:!1},canInteractWithPieces:{default:!0,editable:!0},canModifyExistingMovesOnMainLine:{default:!1,editable:!1},canDropPiecesContinuously:{default:!0,editable:!0}});function createAgreeDraw(t){return function agreeDraw(){var r=t.api,i=t.respond;return r.isGameOver()?null:(r.setResult(We.a.Results.Draw),i(ke.a.APIEvents.DrawAgreed))}}function createBlinkSquare(t){return function blinkSquare(r){return(0,t.respond)(ke.a.APIEvents.BlinkSquare,r)}}function tryMovingForward(t){var r=t.move,i=t.followContinuations,o=void 0===i||i,a=t.steps,l=void 0===a?1:a,h=t.context,g=h.mutateGame,y=h.game,_=y.ids(),x=g((function callMethod(){y.moveForward(o,r)})),w=1===(null==x?void 0:x.plyDiff);if(l>1&&w)for(var S=1;S<l&&(w=y.moveForward(o));S++);var M=y.ids();return y.selectPosition(_.move,_.line),{firstStepData:x,startIds:_,endIds:M,success:w}}function createCanMoveForward(t){return function canMoveForward(r){var i=null!=r?r:{},o=i.move,a=i.followContinuations,l=i.steps;return tryMovingForward({context:t,move:o,followContinuations:a,steps:l}).success}}function isClaimableDraw(t){return t.inThreefoldRepetition()||t.in50MoveRule()}function createClaimDraw(t){return function claimDraw(){var r=t.api,i=t.game;return r.isGameOver()?null:isClaimableDraw(i)?(r.setResult(We.a.Results.Draw),t.respond(ke.a.APIEvents.DrawClaimed)):null}}function createClearMarkings(t){return function clearMarkings(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=t.game,o=t.markingCache,a=t.respond;if(r.length>0){var l=i.markings();r.forEach((function(t){l[t]&&Object.keys(l[t]).forEach((function(r){i.mark(l[t][r],!0),o.clear(t)}))}))}else i.clearMarkings(),o.clear();return a(ke.a.APIEvents.ClearMarkings)}}function createCreateContinuation(t){return function createContinuation(){var r=t.api,i=t.game,o=t.respond,a=i._getPos();if("initial"in a)return null;i.createVariation(),i.move(a);var l=r.getRelativeNode();return o(ke.a.APIEvents.CreateContinuation,{node:l})}}function createDeletePosition(t){return function deletePosition(r,i){var o=t.api,a=t.game,l=t.respond,h=o.getRawLines()[i];return a.deletePosition(r,i),0===i&&o.getResult()!==We.a.Results.None&&o.setResult(We.a.Results.None),l(ke.a.APIEvents.DeletePosition,{ids:{line:i,move:r},line:h,pieces:o.getPieces()})}}function createExtendAPI(t){var r={};return function extendAPI(i,o){var a=Object.entries(o).map((function(o){var a=Mn()(o,2),l=a[0],h=a[1];if(h)return r[l]||(r[l]={extensions:{},original:t.api[l]}),t.api[l]=h(t),r[l].extensions[i]=h,function destroyOverride(){delete r[l].extensions[i],t.api[l]=r[l].original,Object.keys(r[l].extensions).map((function(i){return t.api[l]=r[l].extensions[i](t)}))}}));return function destroyOverride(){a.map((function(t){return t&&t()}))}}}function createGetCalculatedResult(t){return function getCalculatedResult(){var r=t.api,i=t.game,o=We.a.Results.None,a=isClaimableDraw(i);return a&&r.getOptions().autoClaimDraw||!a&&i.inDraw()?o=We.a.Results.Draw:function isJCEWin(t){return t.inCheckmate()||Boolean(t.isVariantWin())||Boolean(t.isBughouseWin())}(i)&&(o=i.turn()===We.a.ColorsAsNumbers.Black?We.a.Results.White:We.a.Results.Black),o}}function createGetContext(t){return function getContext(){return t}}function createGetCurrentFullLine(t){return function getCurrentFullLine(){return t.game.history({toCurrent:!0,verbose:!0})}}function createGetFen(t){return function getFEN(){return t.game.fen()}}function createGetHeaders(t){return function getHeaders(){return t.game.headers()}}function createGetHistoryFENs(t){return function getHistoryFENs(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=t.game,o=i._getPos();return o.ids&&0===o.ids.line&&-1===o.ids.move&&o.fen?[o.fen]:i.history({toCurrent:!r,verbose:!0}).map((function(t){return t.fen}))}}function createGetHistorySANs(t){return function getHistorySANs(){return t.game.history(!1)}}function createGetLastMove(t){return function getLastMove(){return t.game.history(!0).slice(-1)[0]}}function createGetLegalMoves(t){return function getLegalMoves(){var r=t.game;return ne.a.getLegalMoves({game:r})}}function api_get_legal_moves_for_square_createGetLegalMovesForSquare(t){return function getLegalMovesForSquare(r){return t.api.getLegalMoves().filter((function(t){return void 0===r||t.from===r})).map((function(t){return t.to})).filter((function(t,r,i){return i.indexOf(t)===r}))}}function createGetLine(t){return function getLine(r){var i=t.game.startingMoveNumber(),o=t.api.getRawLines()[r];if(o)return o.forEach((function(t,r){var a=getExtendedNode({move:t,startingMoveNumber:i});o[r]=a})),o}}function getFormattedMarkings(t){var r,i=t.cachedMarkings,o=t.JCEMarkings,a=(r={},j()(r,We.a.Node.Marking.Types.Arrow,{}),j()(r,We.a.Node.Marking.Types.CustomItem,{}),j()(r,We.a.Node.Marking.Types.Effect,{}),j()(r,We.a.Node.Marking.Types.Square,{}),r);return function getTypes(t){return Object.keys(t)}(a).forEach((function(t){var r=Object.assign(Object.assign({},i[t]),o[t]);Object.assign(a,j()({},t,r)),Object.keys(a[t]).forEach((function(r){if(r){var i=a[t][r];a[t][r]=function isJCEMarking(t){return Boolean(t.data)}(i)?function transformFromJCE(t){var r;return Object.assign({color:t.color,key:t.key,markingType:t.type},function getObjectFromArray(t){return t.reduce((function(t,r,i,o){return i%2?t[o[i-1]]=r:t[r]=null,t}),{})}(null!==(r=t.data)&&void 0!==r?r:[]))}(i):i}}))})),a}function createGetMarkings(t){return function getMarkings(){var r=t.game,i=t.markingCache,o=r.markings();return getFormattedMarkings({cachedMarkings:i.get(),JCEMarkings:o})}}function createGetMaterial(t){return function getMaterial(){return t.game.material()}}function api_get_move_createGetMove(t){return function getMove(r){var i=t.game;if(null===r.to)return null;var o=i.getMove(r);return null===o&&(Object.assign(r,{promotion:"q"}),o=i.getMove(r)),o&&(o=i.moveDetails(o)),o}}function createGetNodeByIds(t){return function getNodeByIds(r){var i=t.api,o=t.game,a=i.getRawLines()[r.line];return a?-1===r.move?a:getExtendedNode({move:a[r.move],startingMoveNumber:o.startingMoveNumber()}):null}}function get_ply_diff_getMoveNumber(t){var r=t.moveNumber;return void 0!==r?r:-1}function getEPCapturedSquare(t){if(t.flags===We.a.Move.Flags.EPCapture&&t.from)return"".concat(t.to.slice(0,1)).concat(t.from.slice(-1))}function extend(t){var r=Object.assign(Object.assign({},t),{EPCapturedSquare:getEPCapturedSquare(t)});return t.rookFrom&&t.rookTo&&(r.rookMove={animate:!0,from:t.rookFrom,to:t.rookTo}),r}function createGetNodeDiffData(t){return function getNodeDiffData(r,i){var o=t.api,a=t.game,l=null!=i?i:a._getPos(),h=null!=r?r:a._getPos(-1,0),g={};return g.plyDiff=function getPlyDiff(t,r){return get_ply_diff_getMoveNumber(r)-get_ply_diff_getMoveNumber(t)}(h,l),g.lineDiff=function getLineDiff(t,r){return r.ids.line-t.ids.line}(h,l),-1===g.plyDiff?g.move=extend(Object.assign(Object.assign({},r),{animate:!0})):1===g.plyDiff?(g.animate=!0,g.move=extend(Object.assign(Object.assign({},l),{animate:!0}))):g.pieces=o.getPieces(),g}}function createGetNodeIds(t){return function getNodeIds(){return t.game.ids()}}function api_get_pieces_createGetPieces(t){return function getPieces(){var r=t.game;return Object(Be.a)(r.getPieces(!0))}}function createGetPGN(t){return function getPGN(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.game;return i.pgn(Object.assign(Object.assign({},r),{useResultHeader:!0}))}}function createGetPiece(t){return function getPiece(r){return t.game.get(r)}}function createGetPosition(t){return function getPosition(r,i){return t.game._getPos(r,i)}}function createGetPositionDetails(t){return function getPositionDetails(r){var i=t.api.getPGN();return ne.a.getPositionDetails({pgn:i},r)}}function createGetRawLines(t){return function getRawLines(){return t.game._lines()}}function createGetRelativeNode(t){return function getRelativeNode(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=t.game,o=Object.assign({},i.ids());o.move+=r;var a=t.api.getRawLines()[o.line];return-1===o.move?a:getExtendedNode({move:a[o.move],startingMoveNumber:i.startingMoveNumber()})}}function createGetResult(t){return function getResult(){return t.game.headers().Result}}function createGetSelectedNode(t){return function getSelectedNode(){var r=t.game,i=r.ids();return-1===i.move?null:getExtendedNode({move:t.api.getRawLines()[i.line][i.move],startingMoveNumber:r.startingMoveNumber()})}}function createGetTCN(t){return function getTCN(){var r=t.game;return ne.a.encodeTCN(r.history(!0))}}function createGetTurn(t){return function getTurn(){return t.game.turn()}}(zn||(zn={})).TriggerOptions=[Qe.a.SaveableOptions.AnimationType,Qe.a.SaveableOptions.PieceStyle],function(t){t.MoveBackward="moveBackward",t.MoveForward="moveForward",t.SelectLineEnd="selectLineEnd",t.SelectLineStart="selectLineStart"}(Wn||(Wn={}));var $n={"3-check":We.a.Variants.ThreeCheck,Bughouse:We.a.Variants.Bughouse,Chess:We.a.Variants.Chess,Chess960:We.a.Variants.Chess960,Crazyhouse:We.a.Variants.Crazyhouse,"King of the Hill":We.a.Variants.KingOfTheHill};function createGetVariant(t){return function getVariant(){var r=t.api;return $n[r.getHeaders().Variant]||We.a.Variants.Chess}}function createIsAtEndOfLine(t){return function isAtEndOfLine(){var r=t.game.ids();return t.api.getRawLines()[r.line].length-1===r.move}}function createIsCheck(t){return function isCheck(){var r=t.game;if(r.inCheck()){var i=t.api.getPieces();return i.keys().filter((function(t){var o=i.get(t);return"k"===o.type&&o.color===r.turn()}))[0]}return!1}}function createIsGameOver(t){return function isGameOver(){return"*"!==t.api.getResult()}}function is_legal_move_createIsLegalMove(t){return function isLegalMove(r){return null!==t.game.getMove(r)}}function get_timestamp_getTimestamp(t){var r=t.baseTimeDs,i=t.incrementDs,o=t.lastTimeDs,a=t.currentTimeDs;if(!a)return 1;var l=(null!=o?o:r)-(a-i);return Math.max(l,1)}function load_createLoad(t){return function load(r,i){var o=r.fen,a=r.moves,l=r.pgn,h=r.times,g=r.timestamps,y=r.timeControl,_=r.variant,x=void 0===_?We.a.Variants.Chess:_,w=t.api,S=t.game,M=t.respond,T=!1;l?T=S.loadPgn(l):o&&(T=S.load(o,x)),(a||""===a)&&(T=S.loadMoves(a,i));var P=w.getLine(0),C=h?function convertTimesToTimestamps(t,r){if(r&&t){var i=millisecondsToDeciseconds(t.baseTime),o=millisecondsToDeciseconds(t.increment);return r.map((function(t,a){return"number"!=typeof t?t:get_timestamp_getTimestamp({baseTimeDs:i,incrementDs:o,lastTimeDs:a<=1?void 0:r[a-2],currentTimeDs:t})}))}return r}(y||w.timeControl.get(),h):g;if(C&&P&&P.forEach((function(t,r){var i=C[r];void 0!==i&&setTimestampOnNode({api:w,node:t,timestamp:i})})),y&&w.timeControl.set(y),!T)throw new cn.a({code:ln.a.BadData,data:{fen:o,pgn:l},message:"Unable to load with provided data."});var A=w.getResult();return w.setResult(A===We.a.Results.None?w.getCalculatedResult():A),M(ke.a.APIEvents.Load,Object.assign(Object.assign(Object.assign({},ne.a.getPositionDetails({game:S,skipValidation:!0})),ne.a.getPositionInfo({analysis:!0,game:S})),{line:P,pieces:w.getPieces(),variant:x}))}}function formatColor(t){var r;return t?null!==(r=We.a.Node.Marking.ColorKeys[t])&&void 0!==r?r:t:We.a.Node.Marking.ColorKeys.default}function extendMarking(t){return Object.entries(t).reduce((function(t,r){return function getTypeMarkings(t,r){return(Array.isArray(r)?r:[r]).map(getMarking);function getMarking(r){return Object.assign(Object.assign({},r),{color:formatColor(r.color),key:getKey(r),markingType:t})}}(r[0],r[1]).map((function(r){return t.push(r)})),t}),[])}function getKey(t){var r=t.from,i=t.to,o=t.square;return r&&i?"".concat(r).concat(i):o}function isValidMoveLanOrSquare(t){return/^([a-h][1-8]){1,2}$/.test(t)}function transformForJCE(t){var r=["key","markingType"],i=Object.values(We.a.Node.Marking.ColorKeys).includes(t.color);return i&&r.push("color"),Object.entries(t).reduce((function(t,i){return r.includes(i[0])||(t.data=[].concat(I()(t.data),I()(i.map((function(t){return String(t)}))))),t}),{color:i?t.color:void 0,data:[],key:t.key,type:t.markingType})}function createMark(t){return function mark(r,i){var o=t.game,a=t.markingCache;return extendMarking(r).map((function markType(t){if(!isValidMoveLanOrSquare(t.key))return;i?o.mark(transformForJCE(t)):a.add(t,t.markingType,t.key)})),t.respond(ke.a.APIEvents.Mark)}}function calculateTimestampValue(t){var r=t.api,i=t.node,o=r.getLine(0),a=r.timeControl.get();if(!o||!a)return null;var l=i.time,h=getPreviousNodeOfSameColor({api:r,node:i}),g=null==h?void 0:h.time,y=a.baseTime,_=a.increment;return get_timestamp_getTimestamp({baseTimeDs:millisecondsToDeciseconds(y),incrementDs:millisecondsToDeciseconds(_),lastTimeDs:g,currentTimeDs:l})}function setClkOnNode(t){var r=t.api,i=t.node,o=t.clk,a=i.ids,l=a.line,h=a.move,g=r.getContext().game;i.commands||(i.commands={}),g.updateNode({commands:Object.assign(i.commands,{clk:null===o?o:o.toString()})},h,l)}function api_move_createMove(t){return function move(r){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=t.api,a=t.game,l=t.mutateGame,h=t.respond,g=r.san,y=r.tcn,_=void 0===r.animate||r.animate,x=r.userGenerated,w=r.userGeneratedDrop,S=l((function makeMove(){if(!(y?a.loadMoves(y.slice(0,2),{atCurrent:!0,method:"merge"}):a.move(g||r,i)))return null;if(r.time){var t=a.moveDetails();t.time=r.time,setClkOnNode({api:o,node:t,clk:r.time});var l=calculateTimestampValue({api:o,node:t});l&&setTimestampOnNode({api:o,node:t,timestamp:l})}}));return null===S?h(ke.a.APIEvents.IllegalMove,{fen:a.fen(),move:r}):(S.result&&o.setResult(S.result),Object.assign(S.move,{animate:_,userGenerated:x,userGeneratedDrop:w}),S.move=extend(S.move),h(ke.a.APIEvents.Move,S))}}function move_forward_createMoveForward(t){return function moveForward(r,i){var o=t.respond,a=t.api,l=t.game,h=function getMoveForwardParameters(t,r){var i,o,a={};"object"===B()(t)?a=t:o=t;var l=a,h=l.move,g=l.followContinuations,y=l.steps;return{move:null!=h?h:r,followContinuations:null===(i=null!=g?g:o)||void 0===i||i,steps:null!=y?y:1}}(r,i),g=h.move,y=h.followContinuations,_=h.steps;if(_<1)return null;var x=tryMovingForward({context:t,move:g,followContinuations:y,steps:_}),w=x.firstStepData,S=x.success,M=x.endIds;return 1===_||1!==(null==w?void 0:w.plyDiff)?(l.selectPosition(M.move,M.line),o(ke.a.APIEvents.MoveForward,w)):S?a.selectNode(M.line,M.move):null}}function createMoveVariation(t){return function moveVariation(r,i){var o=t.game,a=t.respond;return o.moveVariation(r,i)?a(ke.a.APIEvents.MoveVariation):null}}function removeUnsetHeaders(t){return Object.keys(t).reduce((function(r,i){return t[i]!==We.a.EmptyPGNHeaders.Value&&t[i]!==We.a.EmptyPGNHeaders.Date&&(r[i]=t[i]),r}),{})}var Xn={trans:function trans(t,r,i){return t},transChoice:function transChoice(t,r,i,o){return"".concat(r)}};function createOutOfTime(t){return function outOfTime(r){var i=t.api,o=t.game,a=t.respond,l=Object(Z.a)(r),h=function capitalizeFirstLetter(t){return`${t[0].toUpperCase()}${t.slice(1)}`}(Object(Ot.a)(l)),g=i.getHeaders()[h];i.setResult(l===We.a.ColorsAsNumbers.Black?We.a.Results.Black:We.a.Results.White),o.header({Termination:Xn.trans("%username% won on time",{"%username":g})});var y=Object.assign(Object.assign({},removeUnsetHeaders(o.header())),{color:r});return a(ke.a.APIEvents.OutOfTime,y)}}function reload_createReload(t){return function reload(){var r=t.api,i=t.game;return(0,t.respond)(ke.a.APIEvents.Reload,{holdSelectedPiece:!0,pieces:Object(Be.a)(i.getPieces(!0)),variant:r.getVariant()})}}function createPromoteVariation(t){return function promoteVariation(r,i){var o=t.game,a=t.respond;return o.promoteVariation(r,i)?a(ke.a.APIEvents.PromoteVariation):null}}function createResetGame(t){return function resetGame(){var r=t.api,i=t.respond;return r.setResult(We.a.Results.None),r.load({fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}),i(ke.a.APIEvents.ResetGame)}}function createResign(t){return function resign(r){var i=t.api,o=t.respond;if(i.isGameOver())return null;var a=r===We.a.ColorsAsNumbers.White?We.a.Results.Black:We.a.Results.White;return i.setResult(a),o(ke.a.APIEvents.GameResigned,a)}}function createResetToMainLine(t){return function resetToMainLine(){var r=t.api,i=t.game,o=t.respond;return i.resetToMainLine(),o(ke.a.APIEvents.ResetToMainLine,{pieces:r.getPieces()})}}function createSelectLineEnd(t){return function selectLineEnd(r){var i=t.api,o=t.game,a=t.mutateGame,l=t.respond,h=a((function callMethod(){o.selectLineEnd(r)}));return h&&(h.pieces=i.getPieces()),l(ke.a.APIEvents.SelectLineEnd,h)}}function select_line_start_createSelectLineStart(t){return function selectLineStart(){var r=t.api,i=t.game,o=t.mutateGame,a=t.respond,l=o((function callMethod(){i.selectLineStart()}));return l&&(l.pieces=r.getPieces()),a(ke.a.APIEvents.SelectLineStart,l)}}function createSelectNode(t){return function selectNode(r,i){var o=t.api,a=t.game,l=t.respond,h=a.moveDetails();a.selectPosition(i,r);var g=a.moveDetails(),y=o.getNodeDiffData(h,g);return 0===y.plyDiff&&0===y.lineDiff?null:(0!==y.lineDiff&&(y.pieces=o.getPieces()),l(ke.a.APIEvents.SelectNode,y))}}function createSetGameDetails(t){return function setGameDetails(r){var i=t.game,o=t.respond,a=removeUnsetHeaders(i.header(r));return o(ke.a.APIEvents.UpdatePGNHeaders,a)}}function createSetResult(t){return function setResult(r){return t.api.setGameDetails({Result:r})}}function createSetTurn(t){return function setTurn(r){var i=t.game,o=t.respond;return i.turn()===r?null:(i.turn(r),o(ke.a.APIEvents.TurnSet,r))}}function createToggleMarking(t){return function toggleMarking(r,i){var o=t.api,a=t.game,l=t.markingCache;return extendMarking(r).map((function markType(t){if(!isValidMoveLanOrSquare(t.key))return;var r=function markingExists(t,r){var i,o=null===(i=null==r?void 0:r[t.markingType])||void 0===i?void 0:i[t.key];if(!o)return!1;return Boolean(t.markingType===o.markingType&&t.color===o.color)}(t,o.getMarkings());i?a.mark(transformForJCE(t),r):r?l.remove(t.markingType,t.key):l.add(t,t.markingType,t.key)})),t.respond(ke.a.APIEvents.Mark)}}function createUndo(t){return function undo(){var r=t.api,i=r.getSelectedNode();return i?r.deletePosition(i.ids.move,i.ids.line):null}}function createUpdateNode(t){return function updateNode(r,i){var o=t.game,a=t.respond;return o.updateNode(i,r.move,r.line),a(ke.a.APIEvents.NodeUpdated,{changes:i,ids:r,node:o._getPos(r.move,r.line)})}}function createUpdateLineComment(t){return function updateLineComment(r,i){var o=t.game,a=t.respond;return o.updateLineComment(r,i),a(ke.a.APIEvents.LineCommentUpdated,{comment:r,lineId:i})}}function createUnmark(t){return function unmark(r,i){var o=t.game,a=t.markingCache;return extendMarking(r).map((function unmarkType(t){i?o.mark(transformForJCE(t),!0):a.remove(t.markingType,t.key)})),t.respond(ke.a.APIEvents.Mark)}}function createWrappedAPIHandler(t){return function wrappedAPIHandler(r){var i=r.methodName,o=r.eventName,a=t.game,l=t.mutateGame,h=t.respond;return function wrappedHandler(){for(var t=arguments.length,r=new Array(t),g=0;g<t;g++)r[g]=arguments[g];var y=l((function callMethod(){a[i].apply(a,r)}));return!y||0===y.lineDiff&&0===y.plyDiff?null:h(o,y)}}}function getBughouseGameTimeValues(t){return Array.isArray(t)&&Array.isArray(t[0])?t[0]:t}function createCreateGame(t){return function createGame(r){var i=ne.a.createGame(Object.assign(Object.assign({timestamps:r.times||r.timestamps||void 0},r),{analysis:!0}));if(i){var o=t.api,a=r.times,l=r.timestamps;return o.load({pgn:i.pgn({useResultHeader:!0}),variant:r.variant,times:a?getBughouseGameTimeValues(a):void 0,timestamps:l?getBughouseGameTimeValues(l):void 0})}}}function createGetTimeControl(t){return function getTimeControl(){var r=t.api.getHeaders().TimeControl;if(!r||"-"===r||r.includes("?")||r.includes("/"))return null;var i=r.split("+").map((function(t){return Math.round(1e3*parseFloat(t))})),o=Mn()(i,2);return{baseTime:o[0],increment:o[1]||0}}}var Kn={baseTime:3e5,increment:0};function createGetTimeControlType(t){return function getTimeControlType(){var r=t.api.timeControl.get();if(r){var i=function getExpectedGameDuration(t){return(t.baseTime+40*(t.increment||0))/1e3}(r);if(i<1800)return Ae.Types.Bullet;if(i>6e3)return Ae.Types.Rapid}return Ae.Types.Blitz}}function createSetTimeControl(t){return function setTimeControl(r){var i=t.api;if(null===r)return i.setGameDetails({TimeControl:"-"});var o=r.baseTime/1e3,a=r.increment/1e3;return i.setGameDetails({TimeControl:a?"".concat(o,"+").concat(a):"".concat(o)})}}function createTimeControlAPI(t){return{get:createGetTimeControl(t),getType:createGetTimeControlType(t),set:createSetTimeControl(t)}}function toUnit(t,r){if(null===t)return null;var i;switch(r){case"Milliseconds":i=100*t;break;case"Seconds":i=10*t;break;case"Deciseconds":default:i=t}return i}function getValidTimestamp(t,r){return null===t?null:Math.max(1,function toRoundedDeciseconds(t,r){var i;switch(r){case"Milliseconds":i=t/100;break;case"Seconds":i=10*t;break;case"Deciseconds":default:i=t}return Math.round(i)}(t,r))}function createTimestampsAPI(t){return{get:get,set:function set(r,i){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Deciseconds",l=t.api,h=t.respond,g=l.getLine,y=null===(o=g(0))||void 0===o?void 0:o[i];if(!y)return null;var _=getValidTimestamp(r,a);if(void 0===_)return null;return setTimestampOnNode({api:l,node:y,timestamp:_}),h(ke.a.APIEvents.NodeUpdated,{changes:{timestamp:_,node:y}})},setMany:function setMany(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Deciseconds",o=t.api,a=t.respond,l=0===r.length?getAll().map((function(){return null})):r;return o.getRawLines()[0].forEach((function(t,r){if(void 0!==l[r]){var a=getValidTimestamp(l[r],i);void 0!==a&&setTimestampOnNode({api:o,node:t,timestamp:a})}})),a(ke.a.APIEvents.LineUpdated)}};function get(r){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.filtered,l=void 0===a||a,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Deciseconds",g=t.api,y=null===(i=g.getLine(0))||void 0===i?void 0:i.map(getTimestampFromNode);if(void 0!==r)return y[r]&&toUnit(y[r],h);var _=l?y.filter((function(t){return void 0!==t})):y;return _.map((function(t){return toUnit(t,h)}))}function getAll(){return get(void 0,{filtered:!1})}}function createGetTimes(t){return function get(r){var i,o=t.api.getLine(0);return void 0!==r?null===(i=o[r])||void 0===i?void 0:i.time:o.map((function(t){return t.time}))}}function createSetManyTimes(t){return function setMany(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=t.api,o=t.respond;return i.getRawLines()[0].forEach((function(t,o){void 0!==r[o]&&(!t.time&&r[o]&&(t.time=r[o]),i.timestamps.set(calculateTimestampValue({api:i,node:t}),o))})),o(ke.a.APIEvents.LineUpdated)}}function createSetTimes(t){return function set(r,i){var o,a=t.api,l=t.respond,h=null===(o=(0,a.getLine)(0))||void 0===o?void 0:o[i];return h?(h.time||(h.time=r),a.timestamps.set(calculateTimestampValue({api:a,node:h}),i),l(ke.a.APIEvents.NodeUpdated,{changes:{time:r,node:h}})):null}}function createTimesAPI(t){return{get:createGetTimes(t),set:createSetTimes(t),setMany:createSetManyTimes(t)}}function api_createAPI(t){var r=t.game,i=t.options,o=t.eventEmitter,a=r||ne.a.createGame(Object.assign(Object.assign({},i),{analysis:!0}));if(!a)throw new cn.a({code:ln.a.BadData,data:i,message:"Error creating game from createAPI"});var l=o||createEventEmitter(),h=function createMemoryCache(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=copy(t);return{add:add,clear:clear,get:get,remove:remove};function add(t){for(var i=r,o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];a.forEach((function(t){t in i||(i[t]={}),i=i[t]})),Object.assign(i,t)}function clear(i){i?r[i]={}:r=copy(t)}function get(){return copy(r)}function remove(){for(var t=r,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var l=o.length-1;o.forEach((function(r,i){r in t&&i!==l&&(t=t[r])})),delete t[o[l]]}function copy(t){return JSON.parse(JSON.stringify(t))}}({arrow:{},customItem:{},effect:{},square:{}}),g={},y=function createMutateGame(t,r){return function mutateGame(i){var o=t.moveDetails(),a=r.getCalculatedResult();if(null===i())return null;var l=t.moveDetails(),h=r.getCalculatedResult(),g=r.getNodeDiffData(o,l);return a!==h&&isMainLine(null==l?void 0:l.ids.line)&&(g.result=h),g}}(a,g),_=function createRespond(t){return function respond(r,i){var o=Object(dt.a)(r,i);return t.emit(r,o),o}}(l),x={api:g,emitter:l,game:a,markingCache:h,mutateGame:y,respond:_};return Object.assign(x.api,function createAPIModel(){return Object.assign(Object.assign(Object.assign(Object.assign({agreeDraw:createAgreeDraw(x),blinkSquare:createBlinkSquare(x),canMoveForward:createCanMoveForward(x),claimDraw:createClaimDraw(x),clearMarkings:createClearMarkings(x),createContinuation:createCreateContinuation(x),createGame:createCreateGame(x)},function createPlayingAsAPI(t){var r=We.a.ColorsAsNumbers.White,i=!1;return{getPlayingAs:function getPlayingAs(){return i?r:void 0},setPlayingAs:function setPlayingAs(i){if(i===r)return null;var o=t.respond;return r=i,o(ke.a.APIEvents.SetPlayingAs,i)},usePlayingAs:function usePlayingAs(t){i=t||!1}}}(x)),{deletePosition:createDeletePosition(x)}),l),{extendAPI:createExtendAPI(x),getCalculatedResult:createGetCalculatedResult(x),getContext:createGetContext(x),getCurrentFullLine:createGetCurrentFullLine(x),getFEN:createGetFen(x),getHeaders:createGetHeaders(x),getHistoryFENs:createGetHistoryFENs(x),getHistorySANs:createGetHistorySANs(x),getLastMove:createGetLastMove(x),getLegalMoves:createGetLegalMoves(x),getLegalMovesForSquare:api_get_legal_moves_for_square_createGetLegalMovesForSquare(x),getLine:createGetLine(x),getMarkings:createGetMarkings(x),getMaterial:createGetMaterial(x),getMove:api_get_move_createGetMove(x),getNodeByIds:createGetNodeByIds(x),getNodeDiffData:createGetNodeDiffData(x),getNodeIds:createGetNodeIds(x),getPGN:createGetPGN(x),getPiece:createGetPiece(x),getPieces:api_get_pieces_createGetPieces(x),getPosition:createGetPosition(x),getPositionDetails:createGetPositionDetails(x),getRawLines:createGetRawLines(x),getRelativeNode:createGetRelativeNode(x),getResult:createGetResult(x),getSelectedNode:createGetSelectedNode(x),getStartingMoveNumber:x.game.startingMoveNumber,getTCN:createGetTCN(x),getTurn:createGetTurn(x),getVariant:createGetVariant(x),isAtEndOfLine:createIsAtEndOfLine(x),isCheck:createIsCheck(x),isGameOver:createIsGameOver(x),isLegalMove:is_legal_move_createIsLegalMove(x),load:load_createLoad(x),mark:createMark(x),move:api_move_createMove(x),moveBackward:createWrappedAPIHandler(x)({eventName:ke.a.APIEvents.MoveBackward,methodName:Wn.MoveBackward}),moveForward:move_forward_createMoveForward(x),moveVariation:createMoveVariation(x),outOfTime:createOutOfTime(x),promoteVariation:createPromoteVariation(x),reload:reload_createReload(x),resetGame:createResetGame(x),resetToMainLine:createResetToMainLine(x),resign:createResign(x),selectLineEnd:createSelectLineEnd(x),selectLineStart:select_line_start_createSelectLineStart(x),selectNode:createSelectNode(x),setGameDetails:createSetGameDetails(x),setResult:createSetResult(x),setTurn:createSetTurn(x),timeControl:createTimeControlAPI(x),times:createTimesAPI(x),timestamps:createTimestampsAPI(x),toggleMarking:createToggleMarking(x),undo:createUndo(x),unmark:createUnmark(x),updateLineComment:createUpdateLineComment(x),updateNode:createUpdateNode(x)})}()),x.api}function createBughouseAPIPlugin(){var t;return{create:function create(t){t.api.getVariant()===We.a.Variants.Bughouse&&extendAPIAndHandlePositionChanges(t)},destroy:function destroy(){null==t||t()},match:[{condition:isOneOf([ke.a.APIEvents.CreateGame,ke.a.APIEvents.Load]),handler:function handler(r,i){var o=r.data;null==t||t(),o.variant===We.a.Variants.Bughouse&&extendAPIAndHandlePositionChanges(i)}}],name:ue.Plugin.Name};function extendAPIAndHandlePositionChanges(r){t=function createSiblingGameAPI(t){return t.api.extendAPI("siblingGame",{siblingGame:function createApiMethods(t){return api_createAPI({game:t.game.siblingGame,options:{}})}})}(r);var i=r.api,o=i.siblingGame,a=(0,i.getContext)().respond;o.onMany(Et,(function(){return a(be.Events.SetHand)}))}}var Yn;i(118);function createGetSet(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t;return{get:get,set:set};function get(t){return t?r[t]:r}function set(t){Object.assign(r,t)}}var Zn,Qn=(Yn={anyAPIEvent:function anyAPIEvent(t){return t.UpdateParams.cancelMarkingStartSquare(),Fe.States.Idle}},j()(Yn,ke.a.UserEvents.PointerdownLeft,(function(t){return t.UpdateParams.cancelMarkingStartSquare(),Fe.States.Idle})),j()(Yn,ke.a.UserEvents.Pointerup,(function(t){var r=t.context,i=t.data,o=i.keyPressed,a=i.square,l=t.params.markingStartSquare,h=t.UpdateParams,g=r.api.toggleMarking,y=r.queue;return a&&l&&y.add(g,function adding_markings_getMarking(t){var r=t.endSquare,i=t.keyPressed,o=t.startSquare,a={color:formatColor(i)};if(o===r)return{square:Object.assign(Object.assign({},a),{square:r})};return{arrow:Object.assign(Object.assign({},a),{from:o,to:r})}}({endSquare:a,keyPressed:o,startSquare:l}),!0),h.cancelMarkingStartSquare(),Fe.States.Idle})),Yn);var Jn,er=(Zn={},j()(Zn,ke.a.UserEvents.PointerdownLeft,(function(t){var r=t.context,i=t.data,o=i.coords,a=i.square,l=t.UpdateParams,h=r.api,g=h.clearMarkings,y=h.getPieces,_=r.mode.getOptions,x=r.options,w=r.queue,S=r.renderer,M=r.state;if(a&&w.add(g,[We.a.Node.Marking.Types.Arrow,We.a.Node.Marking.Types.Effect,We.a.Node.Marking.Types.Square],!0),!x.enabled||!_().canInteractWithPieces)return Fe.States.Idle;if(!y().isDefined(a))return Fe.States.Idle;if(x.moveMethod===Qe.a.MoveMethods.Click){var T=null==S?void 0:S.getCoordsFromSquare(a,x.flipped);if(void 0===T)throw new cn.a({code:ln.a.BadData,message:"getCoordsFromSquare returned undefined for ".concat(a)});return l.dragPiece(T,a),M.set({hideHoverSquare:!0}),null==S||S.dragPiece({coords:T,square:a},r),Fe.States.PieceDragging}return l.dragPiece(o,a),null==S||S.dragPiece({coords:o,square:a},r),Fe.States.PieceDragging})),j()(Zn,ke.a.UserEvents.PointerdownRight,(function(t){var r=t.context,i=t.data.square,o=t.UpdateParams,a=r.api.clearMarkings,l=r.options,h=r.queue;if(l.enabled)return i?(o.setMarkingStartSquare(i),Fe.States.AddingMarkings):(h.add(a,[We.a.Node.Marking.Types.Arrow,We.a.Node.Marking.Types.Effect,We.a.Node.Marking.Types.Square],!0),Fe.States.Idle)})),Zn);function shouldDropOrDeselectPiece(t){var r,i=t.api,o=t.move,a=t.plyDiff,l=t.pieceSquare,h=l&&(null===(r=i.getPieces().getCollection()[l])||void 0===r?void 0:r.color);return!o||1!==a||!h||h===o.color&&!o.userGenerated||(o.from===l||o.to===l)}var tr,nr,rr=(Jn={anyAPIEvent:function anyAPIEvent(t){var r=t.context,i=t.data,o=i.holdSelectedPiece,a=i.move,l=i.plyDiff,h=t.params.draggingPiece,g=t.UpdateParams,y=r.renderer;return h&&!o&&shouldDropOrDeselectPiece({api:r.api,move:a,pieceSquare:h,plyDiff:l})?(g.resetElevatedState(),null==y||y.dropPiece(h,r),Fe.States.Idle):Fe.States.PieceDragging}},j()(Jn,ke.a.UserEvents.MousedownRight,(function(t){var r=t.context,i=t.params.draggingPiece,o=t.UpdateParams,a=r.renderer;if(!i)throw new cn.a({code:ln.a.BadData,message:"Attempted to pointerdown on a dragging piece but dragging piece is null or undefined"});return o.dropPiece(),o.deselectPiece(),null==a||a.dropPiece(i,r),Fe.States.Idle})),j()(Jn,ke.a.UserEvents.Pointermove,(function(t){var r=t.context,i=t.data.coordsInsideBoard,o=t.params.draggingPiece,a=t.UpdateParams,l=r.renderer;if(!o)throw new cn.a({code:ln.a.BadData,message:"Attempted to drag a piece but draggingPiece is null or undefined"});return a.dragPiece(i,o),null==l||l.dragPiece({coords:i,square:o},r),Fe.States.PieceDragging})),j()(Jn,ke.a.UserEvents.Pointerup,(function(t){var r,i=t.context,o=t.data,a=o.keyPressed,l=o.square,h=t.params,g=h.draggingPiece,y=h.selectedPiece,_=t.UpdateParams,x=i.api,w=x.blinkSquare,S=x.getMove,M=x.getPiece,T=x.getTurn,P=x.isCheck,C=x.move,A=x.playSound,O=i.mode,L=i.options,I=i.queue,R=i.renderer;if(!g)throw new cn.a({code:ln.a.BadData,message:"Attempted to pointerup on a dragging piece but dragging piece is null or undefined"});if(i.options.test){var j=i.el.querySelector(".dragging");null==j||j.setAttribute("data-test-dragging","false"),null==j||j.removeAttribute("dragging")}if(g===l)return _.dropPiece(),null==R||R.dropPiece(g,i),y===l?(_.deselectPiece(),Fe.States.Idle):(_.selectPiece(g),Fe.States.PieceSelected);y&&_.deselectPiece();var N={from:g,to:l},k=S(N),D=!(!O.isAllowedToMove()||!k)&&Object.assign(Object.assign({},k),{animate:!1,userGenerated:!0,userGeneratedDrop:!0});if(!D){_.dropPiece(),O.handleIllegalMove&&I.add(O.handleIllegalMove,N);var B=P();return(null===(r=M(g))||void 0===r?void 0:r.color)===T()&&B&&(I.add(w,function createCheckBlinkingSquare(t,r){return{color:r,interval:500,opacity:.5,square:t,times:3}}(B,L.checkBlinkingSquareColor)),L.playSounds&&I.add(A,{sound:Pe.BoardSounds.Illegal})),null==R||R.illegalMove(i),null==R||R.dropPiece(g,i),_.selectPiece(g),Fe.States.PieceSelected}return isPromotion(D)?L.autoPromote&&"alt"!==a?(_.dropPiece(),null==R||R.dropPiece(D.to,i),I.add(C,Object.assign(Object.assign({},D),{promotion:We.a.Piece.Types.Queen})),Fe.States.Idle):(_.dragPiece({},g),_.showPromotionArea(D),null==R||R.dragPiece({square:g,toSquare:D.to},i),null==R||R.openPromotionWindow(D,i),Fe.States.PromotionAreaShowing):(_.dropPiece(),null===l&&O.getOptions().canDropOffBoard?null==R||R.removePiece(g,i):null==R||R.dropPiece(l,i),I.add(C,D),Fe.States.Idle)})),Jn),ir=(tr={anyAPIEvent:function anyAPIEvent(t){var r=t.context,i=t.data,o=i.holdSelectedPiece,a=i.move,l=i.plyDiff,h=t.params.selectedPiece,g=t.UpdateParams;return!o&&shouldDropOrDeselectPiece({api:r.api,move:a,pieceSquare:h,plyDiff:l})?(g.resetElevatedState(),Fe.States.Idle):Fe.States.PieceSelected}},j()(tr,ke.a.UserEvents.PointerdownLeft,(function(t){var r=t.context,i=t.data,o=i.coords,a=i.keyPressed,l=i.square,h=t.params.selectedPiece,g=t.UpdateParams,y=r.api,_=y.getMove,x=y.getPieces,w=y.move,S=r.mode.isAllowedToMove,M=r.options,T=r.queue,P=r.renderer,C=r.state;if(!h)throw new cn.a({code:ln.a.BadData,message:"Attempted to interact with a selectedPiece but selectedPiece is null or undefined"});if(l===h){var A=M.moveMethod===Qe.a.MoveMethods.Drag?o:(null==P?void 0:P.getCoordsFromSquare(l,M.flipped))||o;return g.dragPiece(A,h),M.moveMethod===Qe.a.MoveMethods.Click&&C.set({hideHoverSquare:!0}),null==P||P.dragPiece({coords:A,square:h},r),Fe.States.PieceDragging}var O={from:h,to:l},L=x(),I=_(O),R=!(!S()||!I)&&Object.assign(Object.assign({},I),{userGenerated:!0});if(!R){if(g.deselectPiece(),!L.isDefined(l))return Fe.States.Idle;if(M.moveMethod===Qe.a.MoveMethods.Click){var j=(null==P?void 0:P.getCoordsFromSquare(l,M.flipped))||o;return g.dragPiece(j,l),C.set({hideHoverSquare:!0}),null==P||P.dragPiece({coords:j,square:l},r),Fe.States.PieceDragging}return g.dragPiece(o,l),null==P||P.dragPiece({coords:o,square:l},r),Fe.States.PieceDragging}return isPromotion(R)?M.autoPromote&&"alt"!==a?(g.deselectPiece(),T.add(w,R,Object.assign(Object.assign({},R),{promotion:We.a.Piece.Types.Queen})),Fe.States.Idle):(g.deselectPiece(),g.dragPiece({},h),g.showPromotionArea(R),null==P||P.dragPiece({square:h,toSquare:R.to},r),null==P||P.openPromotionWindow(R,r),Fe.States.PromotionAreaShowing):(g.deselectPiece(),T.add(w,R),Fe.States.Idle)})),j()(tr,ke.a.UserEvents.PointerdownRight,(function(t){var r=t.context,i=t.data.square,o=t.UpdateParams;if(r.options.enabled)return o.deselectPiece(),o.setMarkingStartSquare(i),Fe.States.AddingMarkings})),tr);function cancelPromotion(t){var r=t.context,i=t.params.draggingPiece,o=t.UpdateParams,a=r.renderer;return o.dropPiece(),o.cancelPromotion(),null==a||a.dropPiece(i,r),null==a||a.closePromotionWindow(r),Fe.States.Idle}var or,ar=(nr={anyAPIEvent:cancelPromotion},j()(nr,ke.a.BoardEvents.PromotionPiecePointerdown,(function(t){var r=t.context,i=t.data.piece,o=t.params,a=o.draggingPiece,l=o.promotionMove,h=t.UpdateParams,g=r.api.move,y=r.queue,_=r.renderer;return h.dropPiece(),h.cancelPromotion(),null==_||_.dropPiece(a,r),null==_||_.closePromotionWindow(r),l?(y.add(g,{animate:!1,from:l.from,promotion:i,to:l.to,userGenerated:!0}),Fe.States.Idle):Fe.States.Idle})),j()(nr,ke.a.BoardEvents.PromotionAreaClosePointerdown,cancelPromotion),j()(nr,ke.a.UserEvents.PointerdownLeft,cancelPromotion),j()(nr,ke.a.UserEvents.PointerdownRight,cancelPromotion),nr),sr={createUpdateParams:function createUpdateParams(t){return{cancelMarkingStartSquare:function cancelMarkingStartSquare(){t.markingStartSquare=void 0},cancelPromotion:function cancelPromotion(){t.promotionMove=void 0},deselectPiece:function deselectPiece(){t.selectedPiece=void 0},dragPiece:function dragPiece(r,i){t.draggingPiece=i,t.draggingCoords=r},dropPiece:function dropPiece(){t.draggingPiece=void 0,t.draggingCoords=void 0},resetElevatedState:function resetElevatedState(){t.draggingPiece=void 0,t.draggingCoords=void 0,t.promotionMove=void 0,t.selectedPiece=void 0},selectPiece:function selectPiece(r){t.selectedPiece=r},setMarkingStartSquare:function setMarkingStartSquare(r){t.markingStartSquare=r},showPromotionArea:function showPromotionArea(r){t.promotionMove=Object.assign({},r)}}},getCurrentState:function getCurrentState(){return Fe.States.Idle},getParams:function getParams(){return{draggingCoords:void 0,draggingPiece:void 0,markingStartSquare:void 0,promotionMove:void 0,selectedPiece:void 0}},states:(or={},j()(or,Fe.States.AddingMarkings,Qn),j()(or,Fe.States.PieceDragging,rr),j()(or,Fe.States.Idle,er),j()(or,Fe.States.PromotionAreaShowing,ar),j()(or,Fe.States.PieceSelected,ir),or)};function createUpdateMachineState(){var t=sr.getParams(),r=sr.createUpdateParams(t),i=sr.getCurrentState(),o=[Oe.Events.Tick];return function updateMachineState(a,l){if(!o.includes(a.type)){var h=l.state;h.set({draggingPiece:t.draggingPiece,machineState:i,promotionMove:t.promotionMove,selectedPiece:t.selectedPiece});var g=function isAPIEvent(t){return Object.values(ke.a.APIEvents).includes(t.type)}(a)&&!function shouldIgnoreEvent(t){return[ke.a.APIEvents.BlinkSquare,ke.a.APIEvents.ClearMarkings,ke.a.APIEvents.Mark,ke.a.APIEvents.LineUpdated,ke.a.APIEvents.NodeUpdated,ke.a.APIEvents.UpdatePGNHeaders].includes(t)}(a.type)?"anyAPIEvent":a.type;if(sr.states[i]&&sr.states[i][g]){var y=sr.states[i][g]({context:l,data:a.data,params:t,UpdateParams:r}),_=i;if(i=y||i,!function machineIsValid(){if(i===Fe.States.Idle)return!t.draggingPiece&&!t.selectedPiece;if(i===Fe.States.PieceDragging)return Boolean(t.draggingPiece);if(i===Fe.States.PieceSelected)return!t.draggingPiece&&Boolean(t.selectedPiece);return!0}())throw{data:{draggingPiece:t.draggingPiece,machineState:i,oldState:_,selectedPiece:t.selectedPiece},error:new cn.a({code:ln.a.InvalidStateMachine,message:"The machine parameters and state do not match up."})};h.set({draggingPiece:t.draggingPiece,machineState:i,selectedPiece:t.selectedPiece})}else h.set({machineState:i})}}}function runBeforeState(t,r){if(!t.beforeState)return!0;var i=!0;return t.beforeState.forEach((function(t){!1===function run_before_state_run(t,r){if(!t.condition.apply(t,I()(r)))return;return t.handler.apply(t,I()(r))}(t,r)&&(i=!1)})),i}function runPlugin(t,r){t.match&&t.match.forEach((function(t){return function run(t,r){if(!t.condition.apply(t,I()(r)))return;t.handler.apply(t,I()(r))}(t,r)}))}function createCore(t){var r=t.logger,i=t.params,o=t.plugins,a=function createContext(t){var r=t.logger,i=t.params,o=t.run,a=createQueue(!1),l=Object.assign({logger:r,queue:a,reset:function reset(){l.queue=createQueue(!1),l.state=createGetSet()},run:o,setMode:function setMode(t){l.mode=t},setRenderer:function setRenderer(t){l.renderer=t},state:createGetSet()},i);return l.reset(),l}({logger:r,params:i,run:run}),l=createUpdateMachineState();return{getContext:function getContext(){return a},getMode:function getMode(){return a.mode},run:run,setLogLevel:function setLogLevel(t){r.setLogLevel(t)},setMode:function setMode(t){a.setMode(t)},setRenderer:function setRenderer(t){a.setRenderer(t)}};function run(t){var r=a.logger;r.log({code:ke.a.LogCodes.Event,data:t}),a.reset();var i=o.get();(function runBeforeStateHooks(t,r){return r.every((function(r){return runBeforeState(r,[t,a])}))})(t,i)&&l(t,a);var h=function splitPluginsByHookType(t){return t.reduce((function(t,r){return r.afterRender?t.afterRender.push(r):t.beforeRender.push(r),t}),{beforeRender:[],afterRender:[]})}(i),g=h.beforeRender,y=h.afterRender;try{g.forEach((function(r){return runPlugin(r,[t,a])})),a.queue.flush(),y.forEach((function(r){return runPlugin(r,[t,a])})),r.log({code:ke.a.LogCodes.State,data:a.state.get()})}catch(_){throw r.log({code:ke.a.LogCodes.State,data:Object.assign(Object.assign({},_.data),{event:t,queue:a.queue,state:a.state.get()}),level:qe.Levels.Error}),_}}}function getKeyPressed(t){return t.altKey?"alt":t.ctrlKey?"ctrl":t.shiftKey?"shift":""}var cr=i(28);function onNextTick(t){setTimeout(t)}function createUserEventHandlers(t){var r=t.el,i=t.getPointerPosition,o=t.options,a=t.run;return{handleDocumentPointerdown:function handleDocumentPointerdown(t){var r=Object(cr.a)(t)?ke.a.UserEvents.PointerdownRight:ke.a.UserEvents.PointerdownLeft,i=Object(dt.a)(r);return i.data={square:null},a(i)},handlePointerdown:function handlePointerdown(t){t.stopPropagation(),document.addEventListener(At.c,handlePointermove),document.addEventListener(At.d,handlePointerup);var l=Object(cr.a)(t)?ke.a.UserEvents.PointerdownRight:ke.a.UserEvents.PointerdownLeft,h=Object(dt.a)(l);return h.data=Object.assign(Object.assign({},i({el:r,event:t,flipped:o.flipped})),{keyPressed:getKeyPressed(t)}),onNextTick((function addMouseDownListener(){document.addEventListener(At.a.Mousedown,handleMousedown,{once:!0})})),a(h)},handlePointermove:handlePointermove,handlePointerup:handlePointerup};function handleMousedown(t){var l=Object(cr.a)(t)?ke.a.UserEvents.MousedownRight:ke.a.UserEvents.MousedownLeft,h=Object(dt.a)(l);return h.data=Object.assign(Object.assign({},i({el:r,event:t,flipped:o.flipped})),{keyPressed:getKeyPressed(t)}),a(h)}function handlePointermove(t){var l=Object(dt.a)(ke.a.UserEvents.Pointermove);return l.data=Object.assign(Object.assign({},i({el:r,event:t,flipped:o.flipped})),{keyPressed:getKeyPressed(t)}),a(l)}function handlePointerup(t){document.removeEventListener(At.a.Mousedown,handleMousedown),document.removeEventListener(At.c,handlePointermove),document.removeEventListener(At.d,handlePointerup);var l=Object(dt.a)(ke.a.UserEvents.Pointerup);return l.data=Object.assign(Object.assign({},i({el:r,event:t,flipped:o.flipped})),{keyPressed:getKeyPressed(t)}),a(l)}}var lr,ur,dr=i(43);function buildErrorMsg(t){return(Array.isArray(t)?t:[t]).map((function(t){var r;return"".concat(t.name," (requires: ").concat(null===(r=t.requires)||void 0===r?void 0:r.join(", "),")")})).join(", ")}function getMapOfLoadablePlugins(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;return getLoadablePlugins(t,r,new Map)}function getLoadablePlugins(t,r,i){if(0===t.size)return i;var o=t.size,a=new Map([].concat(I()(r.entries()),I()(i.entries())));return t.forEach((function(r){(function requiredPluginsExist(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;return!t||t.every((function(t){return r.has(t)}))})(r.requires,a)&&(i.set(r.name,r),t.delete(r.name))})),o===t.size?(i.clear(),i):getLoadablePlugins(t,r,i)}function getPluginsOrderedByRequires(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(0===t.length)return[];var i=new Map(t.map((function(t){return[t.name,t]}))),o=getMapOfLoadablePlugins(i,r);if(0===o.size){var a=buildErrorMsg(t);throw new Error("Required plugins do not exist: ".concat(a))}return I()(o.values())}function getRendererType(t){var r=Qe.a.Animation.Types,i=r.Arcade,o=r.Natural;return"real3d"===t.pieceStyle?"webgl-3d":[i,o].includes(t.animationType)?"webgl-2d":"default"}function getRenderer(t){return function fetchRenderer(t){return"webgl-3d"===t?Promise.resolve().then(i.bind(null,59)):"webgl-2d"===t?Promise.resolve().then(i.bind(null,77)):Promise.resolve().then(i.bind(null,60))}(getRendererType(t))}function chessboard_createGame(t){var r=t.api,i=t.apiOptions,o=t.el,a=t.emitter,l=t.init,h=t.logger,g=void 0===h?function createLogger(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=createEventEmitter(),o=[],a=qe.Levels.Debug,l=(t={},j()(t,qe.Levels.None,0),j()(t,qe.Levels.Error,1),j()(t,qe.Levels.Debug,2),t);return Object.assign(Object.assign({},i),{get:get,log:log,setLogLevel:setLogLevel});function get(t){return t?o.filter((function(r){return Object.entries(t).every((function(t){var i=Mn()(t,2),o=i[0],a=i[1];return r[o]===a}))})):o}function log(t){var h=t.code,g=t.data,y=t.level,_=void 0===y?qe.Levels.Debug:y,x=t.message;if(!(l[_]>l[a])){o.length===r&&o.splice(0,1);var w={code:h,data:g,level:_,message:x,timestamp:Date.now()};o.push(w),i.emit(qe.Events.EntryAdded,w)}}function setLogLevel(t){a=t}}():h,y=t.mode,_=t.options,x=void 0===_?Object(dr.a)():_,w=t.plugins,S=void 0===w?createStandardPlugins():w,M=t.renderer,T=r||api_createAPI({eventEmitter:a,options:i||{}}),P=Object.assign(Object.assign({},Object(dr.a)()),x);o.id="board-".concat(P.id);var C,A,O=function createPluginsAPI(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0,o=new Map;return add(r),{add:add,get:get,has:has,remove:remove,setCreatePluginContext:setCreatePluginContext};function loadPlugin(r){if(o.has(r.name)&&remove(r.name),o.set(r.name,r),t){var a=r.api,l=r.apiOverrides,h=r.create,g=r.modeOverrides,y=r.name;if(h){var _=h(t);if(_)return null==i||i.log({code:lr.LogCodes.CreateFailure,data:{currentPlugins:get().map((function(t){return t.name})),data:_,plugin:y},level:qe.Levels.Error,message:"Could not create ".concat(y," plugin")}),void o.delete(r.name)}a&&(r.destroyAPIMethods=t.api.extendAPI(y,j()({},y,a))),l&&(r.destroyAPIOverrides=t.api.extendAPI(y,l)),g&&(r.destroyModeOverrides=t.mode.extendMode(g))}}function add(t){getPluginsOrderedByRequires(Array.isArray(t)?t:[t],o).forEach(loadPlugin)}function get(){return I()(o.values())}function has(t){return o.has(t)}function remove(r){var i,a,l,h;if(o.has(r)){var g=o.get(r);null===(i=null==g?void 0:g.destroy)||void 0===i||i.call(g,t),null===(a=null==g?void 0:g.destroyAPIMethods)||void 0===a||a.call(g),null===(l=null==g?void 0:g.destroyAPIOverrides)||void 0===l||l.call(g),null===(h=null==g?void 0:g.destroyModeOverrides)||void 0===h||h.call(g),o.delete(r)}}function setCreatePluginContext(r){t=r}}(),L=function createSetRenderer(){var t=createQueue();return function(){var r=vt()(mt.a.mark((function _callee(r){return mt.a.wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:t.add(handler,r);case 1:case"end":return i.stop()}}),_callee)})));return function set(t){return r.apply(this,arguments)}}();function handler(t){return _handler.apply(this,arguments)}function _handler(){return(_handler=vt()(mt.a.mark((function _callee2(t){return mt.a.wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(destroyRenderer(),null==t){r.next=5;break}r.t0=t,r.next=8;break;case 5:return r.next=7,getRenderer(P);case 7:r.t0=r.sent.createRenderer({el:o,options:P});case 8:C=r.t0,R.setRenderer(C),Object.assign(N,{animationComplete:C.animationComplete,getPointerPosition:C.getPointerPosition,isAnimating:C.isAnimating}),A=createUserEventHandlers({el:o,getPointerPosition:C.getPointerPosition,options:P,run:runCoreEvent}),o.addEventListener(At.b,A.handlePointerdown),document.addEventListener(At.b,A.handleDocumentPointerdown),T.emit(ke.a.InstanceEvents.RendererSet,Object(dt.a)(ke.a.InstanceEvents.RendererSet,C.name));case 15:case"end":return r.stop()}}),_callee2)})))).apply(this,arguments)}}(),R=createCore({logger:g,params:{api:T,el:o,options:P},plugins:O});O.setCreatePluginContext(R.getContext());var N=Object.assign(T,{destroy:function destroy(){destroyRenderer(),T.offAll(runCoreEvent);var t=Object(dt.a)(ke.a.InstanceEvents.Destroy);runCoreEvent(t),T.emit(ke.a.InstanceEvents.Destroy,t)},getMode:R.getMode,getOptions:function getOptions(){return Object.assign({},P)},getRenderer:function getRenderer(){return C},playSound:function playSound(t){runCoreEvent(Object(dt.a)(ke.a.SoundEvents.Play,t))},plugins:O,resize:function resize(t,r){runCoreEvent(Object(dt.a)(ke.a.UIEvents.Resize,{height:r,width:t}))},run:runCoreEvent,setLogLevel:R.setLogLevel,setMode:setMode,setOptions:function setOptions(t){if(Object.assign(P||{},t),t&&Object.keys(t).some((function(t){return zn.TriggerOptions.includes(t)}))&&C&&getRendererType(P)!==C.name)return void L();T.emit(ke.a.OptionsEvents.Update,Object(dt.a)(ke.a.OptionsEvents.Update,t))},setRenderer:L});return setMode(y),O.add(S),runCoreEvent(Object(dt.a)(ke.a.InstanceEvents.Create)),o.addEventListener("contextmenu",(function(t){return t.stopPropagation(),t.preventDefault(),!1})),T.onAll(runCoreEvent),T.emit(ke.a.InstanceEvents.Create,Object(dt.a)(ke.a.InstanceEvents.Create,R.getMode().name)),L(M).then((function(){l&&T.load(l)})),N;function destroyRenderer(){R.setRenderer(),null==C||C.destroy(),C=void 0,o.removeEventListener(At.b,null==A?void 0:A.handlePointerdown),document.removeEventListener(At.b,null==A?void 0:A.handleDocumentPointerdown),document.removeEventListener(At.c,null==A?void 0:A.handlePointermove),document.removeEventListener(At.d,null==A?void 0:A.handlePointerup)}function runCoreEvent(t){return R.run(t),t}function setMode(t){var r,i,o=R&&R.getMode();o&&(null===(r=o.plugins)||void 0===r||r.forEach((function(t){return O.remove(t.name)})),O.get().forEach((function(t){var r;return null===(r=t.destroyModeOverrides)||void 0===r?void 0:r.call(t)})),null===(i=o.destroy)||void 0===i||i.call(o));var a=t(T);return T.usePlayingAs(a.usePlayingAs),a.plugins&&O.add(a.plugins),O.get().forEach((function(t){return t.modeOverrides&&a.extendMode(t.modeOverrides)})),R&&(R.setMode(a),runCoreEvent(Object(dt.a)(ke.a.InstanceEvents.ModeChanged)),T.emit(ke.a.InstanceEvents.ModeChanged,Object(dt.a)(ke.a.InstanceEvents.ModeChanged,R.getMode().name))),a}}function toPiecesObjWithCount(t,r){var i=r.toLowerCase(),o="".concat(r===i?"b":"w").concat(i);return t[o]||(t[o]=0),t[o]+=1,t}function getRootPieceElement(t){return t.classList.contains(ur.Classes.Piece)?t:t.parentElement?getRootPieceElement(t.parentElement):void 0}!function(t){!function(t){t.CreateFailure="CreateFailure"}(t.LogCodes||(t.LogCodes={}))}(lr||(lr={})),function(t){!function(t){t.BodyDragging="hand-pieces-dragging-body",t.Component="hand-pieces",t.Dragging="dragging",t.Flipped="flipped",t.Horizontal="horizontal",t.Piece="hand-piece",t.Pseudo3d="pseudo3d",t.Vertical="vertical",t.WithKing="with-king"}(t.Classes||(t.Classes={})),function(t){t.Dragging="data-hand-piece-dragging",t.Selected="data-hand-piece-selected"}(t.DataAttributes||(t.DataAttributes={})),function(t){t.Horizontal="horizontal",t.Vertical="vertical"}(t.DisplayDirections||(t.DisplayDirections={}))}(ur||(ur={}));i(119);function hand_pieces_svelte_get_each_context(t,r,i){const o=Object.create(t);return o.piece=r[i],o}function hand_pieces_svelte_create_if_block(t){var r,i,o=t.handPieces[t.piece]+"";return{c(){r=internal_element("span"),i=internal_text(o),attr(r,"class","hand-piece-count svelte-g5ezs8")},m(t,o){insert(t,r,o),append(r,i)},p(t,r){t.handPieces&&o!==(o=r.handPieces[r.piece]+"")&&set_data(i,o)},d(t){t&&detach(r)}}}function hand_pieces_svelte_create_each_block(t){var r,i,o,a,l,h=t.handPieces[t.piece]>1&&hand_pieces_svelte_create_if_block(t);function pointerdown_handler(...r){return t.pointerdown_handler(t,...r)}return{c(){r=internal_element("div"),h&&h.c(),i=space(),attr(r,"class",o="hand-piece "+t.piece+" svelte-g5ezs8"),attr(r,"data-hand-piece",a=t.piece),l=listen(r,"pointerdown",pointerdown_handler)},m(t,o){insert(t,r,o),h&&h.m(r,null),append(r,i)},p(l,g){(t=g).handPieces[t.piece]>1?h?h.p(l,t):((h=hand_pieces_svelte_create_if_block(t)).c(),h.m(r,i)):h&&(h.d(1),h=null),l.handPieces&&o!==(o="hand-piece "+t.piece+" svelte-g5ezs8")&&attr(r,"class",o),l.handPieces&&a!==(a=t.piece)&&attr(r,"data-hand-piece",a)},d(t){t&&detach(r),h&&h.d(),l()}}}function hand_pieces_svelte_create_fragment(t){var r,i;let o=Object.keys(t.handPieces),a=[];for(let l=0;l<o.length;l+=1)a[l]=hand_pieces_svelte_create_each_block(hand_pieces_svelte_get_each_context(t,o,l));return{c(){r=internal_element("div");for(let t=0;t<a.length;t+=1)a[t].c();attr(r,"class",i=null_to_empty(t.componentClasses)+" svelte-g5ezs8")},m(i,o){insert(i,r,o);for(let t=0;t<a.length;t+=1)a[t].m(r,null);t.div_binding(r)},p(t,l){if(t.handPieces){let i;for(o=Object.keys(l.handPieces),i=0;i<o.length;i+=1){const h=hand_pieces_svelte_get_each_context(l,o,i);a[i]?a[i].p(t,h):(a[i]=hand_pieces_svelte_create_each_block(h),a[i].c(),a[i].m(r,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=o.length}t.componentClasses&&i!==(i=null_to_empty(l.componentClasses)+" svelte-g5ezs8")&&attr(r,"class",i)},i:noop,o:noop,d(i){i&&detach(r),destroy_each(a,i),t.div_binding(null)}}}function hand_pieces_svelte_instance(t,r,i){let o,a=[],l=function getFullHand(){var t=Object.values(We.a.Piece.Types);return[].concat(I()(t),I()(t.map((function(t){return t.toUpperCase()}))))}(),{flipped:h=!1,isPseudo3d:g=!1,fillHandWithAllPieces:y=!1,context:_,pieceIsInteractable:x,direction:w=ur.Classes.Vertical}=r;function pointerDownHandler({piece:t,event:r}){const[a,l]=t;if(!x(a)||Object(cr.a)(r))return;let h=r.target;const g={color:a,component:o,type:l};if(y||S[t]>1){i("handPieces",S[t]-=1,S);const r=getRootPieceElement(h);if(!r)return;g.cloneOf=r,h=function cloneAndInsertElement(t){var r=t.cloneNode();return t.insertAdjacentElement("afterend",r),r}(r)}_.eventHandlers.pointerDownLeft({el:h,event:r,piece:g})}let S,M;return t.$set=t=>{"flipped"in t&&i("flipped",h=t.flipped),"isPseudo3d"in t&&i("isPseudo3d",g=t.isPseudo3d),"fillHandWithAllPieces"in t&&i("fillHandWithAllPieces",y=t.fillHandWithAllPieces),"context"in t&&i("context",_=t.context),"pieceIsInteractable"in t&&i("pieceIsInteractable",x=t.pieceIsInteractable),"direction"in t&&i("direction",w=t.direction)},t.$$.update=(t={fillHandWithAllPieces:1,fullHand:1,hand:1,flipped:1,direction:1,isPseudo3d:1})=>{(t.fillHandWithAllPieces||t.fullHand||t.hand)&&i("handPieces",S=(y?l:a).reduce(toPiecesObjWithCount,{})),(t.flipped||t.direction||t.fillHandWithAllPieces||t.isPseudo3d)&&i("componentClasses",M=`${ur.Classes.Component} ${h?ur.Classes.Flipped:""} ${w===ur.DisplayDirections.Horizontal?ur.Classes.Horizontal:ur.Classes.Vertical} ${y?ur.Classes.WithKing:""} ${g?ur.Classes.Pseudo3d:""}`)},{component:o,flipped:h,isPseudo3d:g,fillHandWithAllPieces:y,context:_,pieceIsInteractable:x,direction:w,setHand:function setHand(t){i("hand",a=t.split(""))},pointerDownHandler:pointerDownHandler,handPieces:S,componentClasses:M,pointerdown_handler:({piece:t},r)=>pointerDownHandler({event:r,piece:t}),div_binding:function div_binding(t){U[t?"unshift":"push"]((()=>{i("component",o=t)}))}}}var hr,pr,fr=class hand_pieces_svelte_Hand_pieces extends K{constructor(t){super(),internal_init(this,t,hand_pieces_svelte_instance,hand_pieces_svelte_create_fragment,safe_not_equal,["flipped","isPseudo3d","fillHandWithAllPieces","context","pieceIsInteractable","direction","setHand"])}get setHand(){return this.$$.ctx.setHand}};!function(t){t.DraggingPiece="DraggingPiece",t.Idle="Idle",t.PieceSelected="PieceSelected"}(hr||(hr={})),function(t){t.ResetToIdle="ResetToIdle"}(pr||(pr={}));var mr=i(52);function toggleDraggingPiece(t){var r=t.el,i=t.game,o=t.isDragging,a=void 0!==o&&o,l=t.piece;if(r&&l){var h=l.component,g=l.type,y=i.getOptions().test;a?(y&&g&&r.setAttribute(ur.DataAttributes.Dragging,g),r.classList.add(ur.Classes.Dragging),document.body.classList.add(ur.Classes.BodyDragging),document.body.append(r)):(y&&r.removeAttribute(ur.DataAttributes.Dragging),r.classList.remove(ur.Classes.Dragging),document.body.classList.remove(ur.Classes.BodyDragging),h.append(r))}}function toggleSelectedPiece(t){var r,i=t.el,o=t.game,a=t.isSelected,l=void 0!==a&&a,h=t.piece;if(i){var g=o.getOptions(),y=getHighlightedSquareColor(g,Qe.a.HighlightedSquareTypes.Selected),_=null!==(r=null==h?void 0:h.cloneOf)&&void 0!==r?r:i;g.test&&(l?_.setAttribute(ur.DataAttributes.Selected,y):_.removeAttribute(ur.DataAttributes.Selected)),_.style.backgroundColor=l?y:""}}function resetPieceToHand(t){var r=t.api,i=t.el,o=t.game,a=t.piece;toggleSelectedPiece({el:i,game:o,isSelected:!1,piece:a}),toggleDraggingPiece({el:i,game:o,isDragging:!1,piece:a}),(null==a?void 0:a.cloneOf)?(i.remove(),r.setHand(r.getHand())):function clearInlineStyles(t){t.style.height="",t.style.width="",t.style.left="",t.style.top="",t.style.transform=""}(i)}function dropPiece(t){var r=t.api,i=t.boardEl,o=t.coords,a=t.el,l=t.game,h=t.piece,g=l.getPointerPosition({el:i,event:{clientX:o.x,clientY:o.y},flipped:l.getOptions().flipped}).square;return resetPieceToHand({api:r,el:a,game:l,piece:h}),g&&h&&function dropPieceOnBoard(t){var r=t.game,i=t.piece,o=t.square;r.getMode().isAllowedToMove()&&r.move({color:Object(mr.a)(i.color),drop:i.type,to:o,userGenerated:!0})}({game:l,piece:h,square:g}),g}function dragging_piece_draggingPiece(t){var r,i=t.api,o=t.boardEl,a=t.game,l=t.eventHandlers;return r={},j()(r,ke.a.UserEvents.MousedownRight,(function mouseDownRight(t){var r=t.el,h=t.piece;return resetPieceToHand({api:i,el:r,game:a,piece:h}),document.removeEventListener(At.b,l.documentPointerDown),o.removeEventListener(At.b,l.documentPointerDown),hr.Idle})),j()(r,ke.a.UserEvents.Pointermove,(function pointerMove(t){var r=t.coords,i=t.el,o=t.initialCoords;return i?(i.style.transform=function translateCoordinates(t){var r=t.coords,i=t.initialCoords;return"translate(".concat(r.x-i.x,"px, ").concat(r.y-i.y,"px)")}({coords:r,initialCoords:o}),hr.DraggingPiece):hr.Idle})),j()(r,ke.a.UserEvents.Pointerup,(function pointerUp(t){var r=t.coords,h=t.el,g=t.initialCoords,y=t.piece;return function droppedInsideInitialCoords(t){var r=t.coords,i=t.initialCoords,o=r.x,a=r.y;if(0===o&&0===a)return!0;var l=i.height,h=i.width,g=i.x,y=i.y,_=h/2,x=l/2;return o>=g-_&&o<=g+_&&a<=y+x&&a>=y-x}({coords:r,initialCoords:g})?(resetPieceToHand({api:i,el:h,game:a,piece:y}),l?(document.addEventListener(At.b,l.documentPointerDown),document.addEventListener(At.a.Mousedown,l.mouseDown),o.addEventListener(At.b,l.documentPointerDown),toggleSelectedPiece({el:h,game:a,isSelected:!0,piece:y}),hr.PieceSelected):hr.Idle):(dropPiece({api:i,boardEl:o,coords:r,el:h,game:a,piece:y}),hr.Idle)})),j()(r,pr.ResetToIdle,(function resetToIdle(t){var r=t.el,h=t.piece;return document.removeEventListener(At.b,l.documentPointerDown),document.removeEventListener(At.a.Mousedown,l.mouseDown),o.removeEventListener(At.b,l.documentPointerDown),document.removeEventListener(At.a.PointerMove,l.pointerMove),resetPieceToHand({api:i,el:r,game:a,piece:h}),hr.Idle})),r}function idle_idle(t){var r=t.game;return j()({},ke.a.UserEvents.PointerdownLeft,(function PointerDownLeft(t){var i=t.el,o=t.piece;return function setInitialPiecePosition(t){var r=t.el,i=t.initialCoords,o=i.height,a=i.width,l=i.x,h=i.y;r.style.height="".concat(o,"px"),r.style.width="".concat(a,"px"),r.style.left="".concat(l-a/2,"px"),r.style.top="".concat(h-o/2,"px")}({el:i,initialCoords:t.initialCoords}),toggleDraggingPiece({el:i,game:r,isDragging:!0,piece:o}),hr.DraggingPiece}))}function createHandPiecesStateMachine(t){return createStateMachine(function state_machine_getStateMachine(t){var r,i,o,a,l,h,g,y;return{initialState:hr.Idle,states:(r={},j()(r,hr.PieceSelected,(i=t,a=i.api,l=i.boardEl,h=i.eventHandlers,g=i.game,y=i.selectedPieceDropsContinuously,o={},j()(o,ke.a.UserEvents.MousedownRight,(function mouseDownRight(t){var r=t.el,i=t.piece;return resetPieceToHand({api:a,el:r,game:g,piece:i}),toggleSelectedPiece({el:r,game:g,isSelected:!1,piece:i}),document.removeEventListener(At.b,h.documentPointerDown),l.removeEventListener(At.b,h.documentPointerDown),hr.Idle})),j()(o,ke.a.UserEvents.PointerdownLeft,(function PointerDownLeft(t){var r=t.el,i=t.coords,o=t.piece;if(!h)return hr.Idle;var _=g.getMode().getOptions().canDropPiecesContinuously;return dropPiece({api:a,boardEl:l,coords:i,el:r,game:g,piece:o})&&(null!=_?_:y)?(toggleSelectedPiece({el:r,game:g,isSelected:!0,piece:o}),hr.PieceSelected):(toggleSelectedPiece({el:r,game:g,isSelected:!1,piece:o}),document.removeEventListener(At.b,h.documentPointerDown),l.removeEventListener(At.b,h.documentPointerDown),hr.Idle)})),j()(o,pr.ResetToIdle,(function resetToIdle(t){var r=t.el,i=t.piece;return document.removeEventListener(At.b,h.documentPointerDown),l.removeEventListener(At.b,h.documentPointerDown),toggleSelectedPiece({el:r,game:g,isSelected:!1,piece:i}),hr.Idle})),o)),j()(r,hr.DraggingPiece,dragging_piece_draggingPiece(t)),j()(r,hr.Idle,idle_idle(t)),r)}}(t))}function createResetToIdle(t){return function resetToIdle(){t.stateMachine.transition(pr.ResetToIdle,t.transitionParams)}}var gr=i(41);function createGetHand(t){var r=t.game.getContext().game;return function getHand(){var t;return(null===(t=null==r?void 0:r.hand)||void 0===t?void 0:t.call(r))||""}}function destroy_createDestroy(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return function destroy(){return r.forEach((function(t){return null==t?void 0:t()}))}}function createPieceIsInteractable(t){var r=t.game;return function pieceIsInteractable(t){return!!r.getMode().isAllowedToMove()&&(void 0===r.getPlayingAs()||Boolean(r.getPlayingAs()===Object(mr.a)(t)))}}function createHandPieces(t){var r=t.selectedPieceDropsContinuously,i=void 0!==r&&r,o=t.boardEl,a=t.containerEl,l=t.direction,h=t.fillHandWithAllPieces,g=void 0!==h&&h,y=t.flipped,_=t.game,x=t.pieceStyles,w=void 0===x?pt.b:x,S=t.replaceContainer,M={selectedPieceDropsContinuously:i,api:{},boardEl:o,eventHandlers:{},game:_,stateMachine:{},transitionParams:{coords:{x:0,y:0},el:document.createElement("div"),initialCoords:{height:0,width:0,x:0,y:0},piece:null}},T=function createHandPiecesComponent(t){var r=t.options,i=t.target,o=t.replaceContainer,a=void 0===o||o;return createSvelteComponent({ComponentType:fr,methods:["setHand"],options:Object.assign(Object.assign({},r),{target:i}),replaceContainer:a})}({options:{props:{context:M,direction:l,fillHandWithAllPieces:g,flipped:y,pieceIsInteractable:createPieceIsInteractable(M)}},replaceContainer:S,target:a}),P=function createUpdatePieceStyle(t){var r=t.component,i=t.pieceStyles,o=document.createElement("style");return document.head.append(o),{getPieceStyles:getPieceStyles,removePieceStyleElement:function removePieceStyleElement(){o.remove()},updatePieceStyle:function updatePieceStyle(t){o.innerHTML=getPieceStyles(t);var a=i[t].isPseudo3d;r.set({isPseudo3d:a})}};function getPieceStyles(t){var r=i[t],o=r.path,a=r.format,l=r.isPseudo3d,h=Object(gr.a)(o),g=l?"::after":"";return pt.d.reduce((function(t,r){return"".concat(t," .hand-piece.").concat(r).concat(g," { background-image: url('").concat(h,"/").concat(r,".").concat(a,"'); }")}),"")}}({component:T,pieceStyles:w}),C=P.removePieceStyleElement,A=P.updatePieceStyle;return M.api=function createAPI(){return{destroy:destroy_createDestroy(T.destroy,C),getHand:createGetHand(M),resetToIdle:createResetToIdle(M),setDirection:function setDirection(t){return T.set({direction:t})},setFlipped:function setFlipped(t){return T.set({flipped:t})},setHand:T.instance.setHand,setFillHandWithAllPieces:function setFillHandWithAllPieces(t){return T.set({fillHandWithAllPieces:t})},updatePieceStyle:A}}(),M.eventHandlers=function create_user_event_handlers_createUserEventHandlers(t){var r={documentPointerDown:function documentPointerDown(r){Object(cr.a)(r)||(t.transitionParams.coords={x:r.clientX,y:r.clientY},t.stateMachine.transition(ke.a.UserEvents.PointerdownLeft,t.transitionParams))},mouseDown:mouseDown,pointerDownLeft:function pointerDownLeft(i){var o=i.el,a=i.piece,l=i.event;if(!Object(cr.a)(l)){var h=o.getBoundingClientRect(),g=h.width,y=h.height;t.transitionParams.el=o,t.transitionParams.piece=a,t.transitionParams.initialCoords={height:y,width:g,x:l.clientX,y:l.clientY},document.addEventListener(At.a.PointerMove,r.pointerMove),document.addEventListener(At.a.PointerUp,r.pointerUp),onNextTick((function(){document.addEventListener(At.a.Mousedown,mouseDown)})),t.stateMachine.transition(ke.a.UserEvents.PointerdownLeft,t.transitionParams)}},pointerMove:function pointerMove(r){var i=r.clientX,o=r.clientY;t.transitionParams.coords={x:i,y:o},t.stateMachine.transition(ke.a.UserEvents.Pointermove,t.transitionParams)},pointerUp:function pointerUp(i){var o=i.clientX,a=i.clientY;document.removeEventListener(At.a.PointerUp,r.pointerUp),document.removeEventListener(At.a.PointerMove,r.pointerMove),document.removeEventListener(At.a.Mousedown,r.mouseDown),t.transitionParams.coords={x:o,y:a},t.stateMachine.transition(ke.a.UserEvents.Pointerup,t.transitionParams)}};return r;function mouseDown(i){Object(cr.a)(i)&&(document.oncontextmenu=function(){return!1},onNextTick((function(){document.oncontextmenu=function(){return!0}})),document.removeEventListener(At.a.Mousedown,r.mouseDown),document.removeEventListener(At.a.PointerMove,r.pointerMove),t.stateMachine.transition(ke.a.UserEvents.MousedownRight,t.transitionParams))}}(M),M.stateMachine=createHandPiecesStateMachine(M),M.api}function createHandPiecesPlugin(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.direction,o=r.el,a=r.pieceStyles,l=r.replaceContainer;return{create:create,destroy:destroy,match:[{condition:isOneOf([ke.a.APIEvents.Load,ke.a.OptionsEvents.Update]),handler:onLoadOrOptionChanged},{condition:isOneOf([].concat(I()(Et),[be.Events.SetHand])),handler:onPositionChanged},{condition:is(ke.a.InstanceEvents.ModeChanged),handler:onModeChanged}],name:be.Plugin.Name};function create(r){var h=r.api,g=r.el,y=r.mode,_=isSetupMode(y.name);t=createHandPieces({selectedPieceDropsContinuously:_&&y.getOptions().canDropPiecesContinuously,boardEl:g,containerEl:o||g,direction:i,fillHandWithAllPieces:_,game:h,pieceStyles:a,replaceContainer:l}),loadHand(r)}function destroy(){t.destroy()}function onLoadOrOptionChanged(r,i){r.type===ke.a.APIEvents.Load&&t.resetToIdle(),loadHand(i)}function onPositionChanged(){t.setHand(t.getHand())}function onModeChanged(t){setModeOptions(t.data)}function loadHand(r){var i=r.options,o=i.flipped,a=i.pieceStyle,l=r.mode.name;t.setFlipped(o),t.updatePieceStyle(a),t.setHand(t.getHand()),setModeOptions(l)}function setModeOptions(r){var i=isSetupMode(r);t.setFillHandWithAllPieces(i)}function isSetupMode(t){return t===jt.Types.Setup}}function createBughouseSiblingBoardPlugin(t){var r,i;return{create:create,destroy:function destroy(){destroySiblingGame()},match:[{condition:isOneOf([ke.a.APIEvents.Load,ke.a.APIEvents.CreateGame,ke.a.InstanceEvents.RendererSet]),handler:function loadHandler(t,r){create(r)}},{condition:isOneOf(Et),handler:updateSiblingGameHand},{condition:is(ke.a.OptionsEvents.Update),handler:function updateOptionsHandler(t){var i=t.data;void 0!==i.flipped&&(null==r||r.setOptions({flipped:!i.flipped}))}},{condition:is(ke.a.UIEvents.Resize),handler:function resizeHandler(){clearTimeout(i),i=setTimeout((function(){var t;null===(t=null==r?void 0:r.resize)||void 0===t||t.call(r)}),10)}}],name:de.Plugin.Name};function create(i){i.api.siblingGame&&(!function createSiblingGame(i){var o=i.renderer;if(!o)return;destroySiblingGame(),(r=function createSiblingGameBoard(t){var r=t.context,i=t.el,o=t.mainBoardRenderer,a=r.api.getOptions(),l=Object.assign(Object.assign({},a),{flipped:!a.flipped,id:"".concat(a.id,"-sibling")});i.classList.add("board");var h,g=o.createRenderer(Object.assign(Object.assign({},o.getRendererOptions()),{containerEl:i,el:i,options:l,testElement:ze.a.SiblingBoard}));return chessboard_createGame({api:r.api.siblingGame,el:i,mode:M.create(),options:l,plugins:(h=createStandardPlugins().filter((function(t){return t.name!==Pe.Plugin.Name})),[].concat(I()(h),[createHandPiecesPlugin({replaceContainer:!1})])),renderer:g})}({context:i,el:t,mainBoardRenderer:o})).resize()}(i),i.api.siblingGame.reload(),updateSiblingGameHand())}function updateSiblingGameHand(){var t;null===(t=null==r?void 0:r.getContext)||void 0===t||t.call(r).respond(be.Events.SetHand)}function destroySiblingGame(){var t;null===(t=null==r?void 0:r.destroy)||void 0===t||t.call(r)}}function createTimerStateMachine(t){var r,i,o,a;return createStateMachine({initialState:Oe.States.Initial,states:(a={},j()(a,Oe.States.Ended,j()({},Oe.Actions.Reset,reset)),j()(a,Oe.States.Going,(r={},j()(r,Oe.Actions.Reset,reset),j()(r,Oe.Actions.Stop,(function(){return t.timeSpent=Date.now()-t.startTimestamp,Oe.States.Stopped})),j()(r,Oe.Actions.Tick,(function(){return t.timeSpent=Date.now()-t.startTimestamp,t.currentTime=t.resetTime-t.timeSpent,t.currentTime<=0?Oe.States.Ended:Oe.States.Going})),r)),j()(a,Oe.States.Initial,(i={},j()(i,Oe.Actions.Reset,reset),j()(i,Oe.Actions.Start,(function(){return t.startTimestamp=Date.now(),Oe.States.Going})),i)),j()(a,Oe.States.Stopped,(o={},j()(o,Oe.Actions.Reset,reset),j()(o,Oe.Actions.Start,(function(){return t.startTimestamp=Date.now()-t.timeSpent,Oe.States.Going})),o)),a)});function reset(r){return Object.assign(t,{currentTime:r,resetTime:r,timeSpent:0}),Oe.States.Initial}}var vr=1e3;function createTimer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.color,i=t.decisecondThreshold,o=void 0===i?2e4:i,a=t.emitter,l=void 0===a?createEventEmitter():a,h=t.initialTime,g=t.interval,y=void 0===g?vr:g,_={color:r,currentTime:h||0,lastTickTimestamp:0,resetTime:h||0,startTimestamp:0,state:Oe.States.Initial,timeSpent:0},x=createTimerStateMachine(_);return x.on(De.Event.Types.OnEnter,handleEnter),x.on(De.Event.Types.OnReEnter,handleReEnter),Object.assign(Object.assign({},l),{add:add,destroy:destroy,get:get,reset:reset,start:start,stop:stop});function add(t){_.startTimestamp-=t,_.timeSpent-=t,_.currentTime+=t,emitEvent(Oe.Events.TimeAdded)}function emitEvent(t){l.emit(t,Object.assign(Object.assign({},get()),{type:t}))}function destroy(){x.off({handler:handleEnter,type:De.Event.Types.OnEnter}),x.off({handler:handleReEnter,type:De.Event.Types.OnReEnter})}function get(){return x.getCurrentState()===Oe.States.Going&&(_.timeSpent=_.startTimestamp?Date.now()-_.startTimestamp:0),_.currentTime=_.resetTime-_.timeSpent,_}function handleEnter(t){var r;switch(t.nextState){case Oe.States.Ended:r=Oe.Events.End;break;case Oe.States.Going:setNextTick(),r=Oe.Events.Start;break;case Oe.States.Initial:r=Oe.Events.Reset;break;case Oe.States.Stopped:r=Oe.Events.Stop}_.state=t.nextState,r&&emitEvent(r)}function handleReEnter(t){var r;switch(t.nextState){case Oe.States.Going:setNextTick(),r=Oe.Events.Tick;break;case Oe.States.Initial:r=Oe.Events.Reset;break;case Oe.States.Stopped:}r&&emitEvent(r)}function reset(t){x.transition(Oe.Actions.Stop),x.transition(Oe.Actions.Reset,t||_.resetTime)}function setNextTick(){var t=Math.round(_.currentTime/y)*y;o&&t<=o?setTimeout((function(){x.transition(Oe.Actions.Tick)}),100):setTimeout((function(){x.transition(Oe.Actions.Tick)}),y)}function start(){x.transition(Oe.Actions.Start)}function stop(){x.transition(Oe.Actions.Stop)}}function extendLoadFactory(t){var r=t.api.load;return function extendLoad(i){var o=t.api,a=o.getHeaders().TimeControl,l=r(i);return o.setGameDetails({TimeControl:a}),l}}function createClocksPlugin(){var t,r=function createTimers(t){var r;return r={},j()(r,We.a.ColorsAsNumbers.White,createTimer({color:We.a.ColorsAsNumbers.White,initialTime:t.baseTime})),j()(r,We.a.ColorsAsNumbers.Black,createTimer({color:We.a.ColorsAsNumbers.Black,initialTime:t.baseTime})),r}(Kn);return{api:function api(){return function createClocksAPI(t){var r=t.timers,i=!0;return Object.assign({activate:function activate(){i=!0},deactivate:function deactivate(){i=!1},isActive:function isActive(){return i},resetClocks:function resetClocks(t){var i=t.baseTime;r[We.a.ColorsAsNumbers.Black].reset(i),r[We.a.ColorsAsNumbers.White].reset(i)},stopClocks:function stopClocks(){r[We.a.ColorsAsNumbers.Black].stop(),r[We.a.ColorsAsNumbers.White].stop()}},r)}({timers:r})},apiOverrides:{load:extendLoadFactory,move:function extendMoveFactory(t){var r=t.api.move;return function extendMove(i){var o=t.api,a=o.clocks,l=o.timeControl.get();if(!a.isActive()||!l)return r(i);var h=a[o.getTurn()],g=l.increment;i.time=millisecondsToDeciseconds(h.get().currentTime+g);var y=r(i);return g&&(null==y?void 0:y.type)===ke.a.APIEvents.Move&&h.add(g),y}}},create:function create(i){var o=i.api;t=function createTimerListeners(t,r){var i=[We.a.ColorsAsNumbers.Black,We.a.ColorsAsNumbers.White].reduce((function(r,i){return t[i].on(Oe.Events.End,outOfTime),r.push((function destroyListenersForColor(){t[i].off({handler:outOfTime,type:Oe.Events.End})})),r}),[]);return function destroyListeners(){i.forEach((function(t){return t()}))};function outOfTime(t){t.color&&r.outOfTime(t.color)}}(r,o)},destroy:function destroy(){t()},match:[{condition:is(ke.a.APIEvents.Move),handler:function handleMove(t,r){var i=r.api,o=t.data.move.color;if(!i.timeControl.get()||!i.clocks.isActive())return;i.clocks[o].stop(),i.clocks[Object(Z.a)(o)].start()}},{condition:function timeControlUpdated(t){return is(ke.a.APIEvents.UpdatePGNHeaders)(t)&&t.data.TimeControl},handler:function resetClocks(t,r){var i=r.api,o=i.timeControl.get();o?i.clocks.resetClocks(o):i.clocks.stopClocks()}}],name:he.Plugin.Name}}function createThreatsAPI(t){var r=t.game.threats,i=!0,o=null;return{enable:withRun((function enable(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i=t})),getAsArray:function getAsArray(){return function getThreatenedSquares(t){return Object.keys(t).filter((function(t){return["pins","undefended","underdefended"].includes(t)})).reduce((function(r,i){return r.push.apply(r,I()(t[i]||[])),r}),[]).map((function(t){return t.slice(-2)}))}(r())},getAsObject:function getAsObject(){return r()},isEnabled:function isEnabled(){return i},isShowingThreatsCreatedByColor:function isShowingThreatsCreatedByColor(t){return o===t||null===o},onlyShowThreatsCreatedByColor:withRun((function onlyShowThreatsCreatedByColor(t){o=t}))};function withRun(r){return function callThenRun(){r.apply(void 0,arguments),t.respond(Ce.Events.Updated)}}}function getThreatsHighlights(t,r){var i=r.api,o=r.options;if(!i.threats||!i.threats.isEnabled()||!i.threats.isShowingThreatsCreatedByColor(Object(Z.a)(i.getTurn())))return Object(Be.a)({});var a=i.threats.getAsArray().reduce((function(t,r){return r?(t[r]={color:o.threatSquareColor,opacity:o.threatSquareOpacity,square:r},t):t}),{});return Object(Be.a)(a)}function createThreatsPlugin(){return{api:createThreatsAPI,create:function create(t){addHighlightsModule(t.api)},destroy:function destroy(t){var r,i=t.api;null===(r=i.highlights)||void 0===r||r.removeModule(getThreatsHighlights)},match:[{condition:is(ke.a.InstanceEvents.ModeChanged),handler:function handleModeChange(t,r){addHighlightsModule(r.api)}}],name:Ce.Plugin.Name};function addHighlightsModule(t){var r;null===(r=t.highlights)||void 0===r||r.addModule(getThreatsHighlights)}}function createValidatePositionPlugin(){return{afterRender:!0,match:[{condition:function shouldValidatePosition(t){return isOneOf([].concat(I()(Object.values(ke.a.APIEvents)),I()(Object.values(ke.a.InstanceEvents)),I()(Object.values(ke.a.OptionsEvents))))(t)},handler:function validatePosition(t,r){var i=r.api,o=r.logger,a=r.renderer;if(!a)return;var l=a.getPieces(),h=i.getPieces().getCollection();(function piecesMatch(t,r){return Object.entries(t).every((function(t){var i=Mn()(t,2),o=i[0],a=i[1],l=r[o];return a.type===l.type&&a.color===l.color}))&&Object.keys(t).length===Object.keys(r).length})(l,h)||o.log({code:Le.ErrorCodes.InvalidPosition,data:{APIPieces:h,boardPieces:l},level:qe.Levels.Error,message:Le.ErrorMessages.InvalidPosition})}}],name:Le.Plugin.Name}}function eventChangesGamePosition(t){return Et.includes(t.type)}var yr=i(46);function revertAnnotationType(t){var r=Object.keys(vn).sort((function(t,r){return r.length-t.length})),i=new Set(gn),o=t;return r.forEach((function(t){var r,a="\\".concat(null!==(r=mn[t])&&void 0!==r?r:t),l=i.has(t)?" ".concat(vn[t]):vn[t];o=o.replace(new RegExp(a,"gm"),l)})),o}function getPGNForDownload(t){var r=t.split("\n\n"),i=Mn()(r,2);return[i[0],revertAnnotationType(i[1])].join("\n\n")}var br=i(24);function mergePlugins(t,r){var i=Object.values(t).map((function(t){return t.name}));return r.reduce((function(t,r){var o=i.indexOf(r.name);return o>-1?t.splice(o,1,r):t.push(r),t}),t)}}])}).call(this,i("./node_modules/webpack/buildin/global.js"))},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/board-tab-item-underlined.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"board-tab-item-underlined-component",active:"board-tab-item-underlined-active",blue:"board-tab-item-underlined-blue",icon:"board-tab-item-underlined-icon"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu-share-link.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"share-menu-share-link-component",input:"share-menu-share-link-input",action:"share-menu-share-link-action",icon:"share-menu-share-link-icon",message:"share-menu-share-link-message","message-enter":"share-menu-share-link-message-enter","message-leave-to":"share-menu-share-link-message-leave-to","message-enter-active":"share-menu-share-link-message-enter-active","message-leave-active":"share-menu-share-link-message-leave-active"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu-tab-selector.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"share-menu-tab-selector-component",tab:"share-menu-tab-selector-tab"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={close:"share-menu-close",content:"share-menu-content",header:"share-menu-header",share:"share-menu-share",tab:"share-menu-tab",modal:"share-menu-modal",wrapper:"share-menu-wrapper"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-embed.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={bold:"share-menu-tab-embed-bold",header:"share-menu-tab-embed-header",inactive:"share-menu-tab-embed-inactive",scrollable:"share-menu-tab-embed-scrollable",accordion:"share-menu-tab-embed-accordion",component:"share-menu-tab-embed-component",darkMode:"share-menu-tab-embed-darkMode",controls:"share-menu-tab-embed-controls",stretch:"share-menu-tab-embed-stretch",select:"share-menu-tab-embed-select",half:"share-menu-tab-embed-half",section:"share-menu-tab-embed-section",flex:"share-menu-tab-embed-flex",code:"share-menu-tab-embed-code",content:"share-menu-tab-embed-content",label:"share-menu-tab-embed-label",input:"share-menu-tab-embed-input",toggles:"share-menu-tab-embed-toggles",toggle:"share-menu-tab-embed-toggle"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-event.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={button:"share-menu-tab-event-button",download:"share-menu-tab-event-download",heading:"share-menu-tab-event-heading",icon:"share-menu-tab-event-icon",section:"share-menu-tab-event-section"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-gif.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"share-menu-tab-gif-component",gif:"share-menu-tab-gif-gif",square:"share-menu-tab-gif-square",button:"share-menu-tab-gif-button"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-image.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"share-menu-tab-image-component",image:"share-menu-tab-image-image",button:"share-menu-tab-image-button"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-pgn.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={button:"share-menu-tab-pgn-button",download:"share-menu-tab-pgn-download",heading:"share-menu-tab-pgn-heading",pgn:"share-menu-tab-pgn-pgn",icon:"share-menu-tab-pgn-icon",section:"share-menu-tab-pgn-section",textarea:"share-menu-tab-pgn-textarea",toggle:"share-menu-tab-pgn-toggle",toggles:"share-menu-tab-pgn-toggles"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-button.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"form-button-component",dark:"form-button-dark","x-small":"form-button-x-small",small:"form-button-small",large:"form-button-large","x-large":"form-button-x-large","full-width":"form-button-full-width",basic:"form-button-basic",darkMode:"form-button-darkMode","basic-with-dark-mode":"form-button-basic-with-dark-mode",primary:"form-button-primary",info:"form-button-info",danger:"form-button-danger"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-input.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"form-input-component",darkMode:"form-input-darkMode",input:"form-input-input",textarea:"form-input-textarea",wrapper:"form-input-wrapper",icon:"form-input-icon",left:"form-input-left",right:"form-input-right",large:"form-input-large","x-large":"form-input-x-large"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-select.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"form-select-component",darkMode:"form-select-darkMode",icon:"form-select-icon",large:"form-select-large"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-textarea.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"form-textarea-component",darkMode:"form-textarea-darkMode",autosize:"form-textarea-autosize",vertical:"form-textarea-vertical","full-width":"form-textarea-full-width"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/icons/icon-font.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"icon-font-component",primary:"icon-font-primary",darkMode:"icon-font-darkMode",secondary:"icon-font-secondary",tertiary:"icon-font-tertiary",chess:"icon-font-chess",captured:"icon-font-captured"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/loaders/loader-three-bounce.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"loader-three-bounce-component",circle:"loader-three-bounce-circle",dot:"loader-three-bounce-dot",animate:"loader-three-bounce-animate",bounce1:"loader-three-bounce-bounce1",bounce2:"loader-three-bounce-bounce2"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/modals/modal-container.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"modal-container-component","parent-centered":"modal-container-parent-centered",bg:"modal-container-bg",enter:"modal-container-enter",leave:"modal-container-leave","content-centered":"modal-container-content-centered"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/modals/modal-content.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"modal-content-component"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/horizontal-move-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"horizontal-move-list-component",line:"horizontal-move-list-line",main:"horizontal-move-list-main",alternate:"horizontal-move-list-alternate","last-child":"horizontal-move-list-last-child","dark-mode":"horizontal-move-list-dark-mode",result:"horizontal-move-list-result"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node-context-menu.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"move-node-context-menu-component",darkMode:"move-node-context-menu-darkMode",item:"move-node-context-menu-item",big:"move-node-context-menu-big",last:"move-node-context-menu-last",small:"move-node-context-menu-small"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/move-node.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"move-node-component",highlighted:"move-node-highlighted",colorable:"move-node-colorable",colored:"move-node-colored",clickable:"move-node-clickable",number:"move-node-number","main-line":"move-node-main-line"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/move-text.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"move-text-component","dark-mode":"move-text-dark-mode",selected:"move-text-selected","contains-figurine":"move-text-contains-figurine",icon:"move-text-icon","en-passant":"move-text-en-passant"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/node-comment.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"node-comment-component",placeholder:"node-comment-placeholder"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/sections/section-container.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"section-container-component",visible:"section-container-visible"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/social/social-share.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"social-share-component",transparent:"social-share-transparent",background:"social-share-background",preloader:"social-share-preloader",expanded:"social-share-expanded",primary:"social-share-primary",link:"social-share-link",icon:"social-share-icon",secondary:"social-share-secondary",visible:"social-share-visible",facebook:"social-share-facebook",twitter:"social-share-twitter",reddit:"social-share-reddit",google:"social-share-google",share:"social-share-share"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/tinymce/tinymce.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"tinymce-component","component-support-dark-mode":"tinymce-component-support-dark-mode"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-analysis.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-analysis-component"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-board.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-board-component"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-button-bar.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-button-bar-component",wrapper:"diagram-button-bar-wrapper"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-button.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-button-component",icon:"diagram-button-icon"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-header.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-game-header-component",wrapper:"diagram-game-header-wrapper",common:"diagram-game-header-common",separate:"diagram-game-header-separate",info:"diagram-game-header-info",center:"diagram-game-header-center",right:"diagram-game-header-right"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-game-list-component",selected:"diagram-game-list-selected",item:"diagram-game-list-item",list:"diagram-game-list-list"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-row.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-game-row-component",item:"diagram-game-row-item",rating:"diagram-game-row-rating",wrapper:"diagram-game-row-wrapper",big:"diagram-game-row-big",small:"diagram-game-row-small",username:"diagram-game-row-username",center:"diagram-game-row-center",right:"diagram-game-row-right"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-header.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-header-component",title:"diagram-header-title",versus:"diagram-header-versus",info:"diagram-header-info",separator:"diagram-header-separator"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-move-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-move-list-component","small-screen":"diagram-move-list-small-screen",list:"diagram-move-list-list","puzzle-container":"diagram-move-list-puzzle-container","puzzle-full-size":"diagram-move-list-puzzle-full-size","puzzle-progress":"diagram-move-list-puzzle-progress","puzzle-move-list":"diagram-move-list-puzzle-move-list","puzzle-node":"diagram-move-list-puzzle-node","puzzle-node-space":"diagram-move-list-puzzle-node-space","puzzle-move":"diagram-move-list-puzzle-move"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-share-modal.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={modal:"diagram-share-modal-modal"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-variation-popover.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-variation-popover-component",wrapper:"diagram-variation-popover-wrapper",row:"diagram-variation-popover-row",icon:"diagram-variation-popover-icon",selected:"diagram-variation-popover-selected","icon-wrap":"diagram-variation-popover-icon-wrap"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-viewer.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"diagram-viewer-component",body:"diagram-viewer-body","full-width":"diagram-viewer-full-width"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/modals/confirm-popover-inline.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={component:"confirm-popover-inline-component",inner:"confirm-popover-inline-inner",top:"confirm-popover-inline-top",right:"confirm-popover-inline-right",bottom:"confirm-popover-inline-bottom",left:"confirm-popover-inline-left",message:"confirm-popover-inline-message",buttons:"confirm-popover-inline-buttons",button:"confirm-popover-inline-button"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/modals/confirm-popover.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){t.exports={modal:"confirm-popover-modal",messageLabel:"confirm-popover-messageLabel",buttons:"confirm-popover-buttons",regular:"confirm-popover-regular","button-v5":"confirm-popover-button-v5"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/node-space.vue?vue&type=style&index=0&module=true&lang=css&":function(t,r,i){t.exports={component:"node-space-component"}},"./node_modules/@chesscom/web-ui/dist/ui/vue/index.js":function(t,r,i){!function webpackUniversalModuleDefinition(r,i){t.exports=i()}("undefined"!=typeof self&&self,(function(){return function(t){var r={};function __webpack_require__(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,i){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:i})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,r){if(1&r&&(t=__webpack_require__(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(__webpack_require__.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)__webpack_require__.d(i,o,function(r){return t[r]}.bind(null,o));return i},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=106)}([function(t,r,i){"use strict";function normalizeComponent(t,r,i,o,a,l,h,g){var y,_="function"==typeof t?t.options:t;if(r&&(_.render=r,_.staticRenderFns=i,_._compiled=!0),o&&(_.functional=!0),l&&(_._scopeId="data-v-"+l),h?(y=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(h)},_._ssrRegister=y):a&&(y=g?function(){a.call(this,this.$root.$options.shadowRoot)}:a),y)if(_.functional){_._injectStyles=y;var x=_.render;_.render=function renderWithStyleInjection(t,r){return y.call(r),x(t,r)}}else{var w=_.beforeCreate;_.beforeCreate=w?[].concat(w,y):[y]}return{exports:t,options:_}}i.d(r,"a",(function(){return normalizeComponent}))},function(t,r){t.exports=function(t){if(!t.webpackPolyfill){var r=Object.create(t);r.children||(r.children=[]),Object.defineProperty(r,"loaded",{enumerable:!0,get:function(){return r.l}}),Object.defineProperty(r,"id",{enumerable:!0,get:function(){return r.i}}),Object.defineProperty(r,"exports",{enumerable:!0}),r.webpackPolyfill=1}return r}},function(t,r,i){"use strict";(function(t){var o=i(68),a=i(31),l=i(48),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/icon-font/icon-font.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";var o=i(21),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";(function(t){var o=i(67),a=i(27),l=i(47),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/button/button.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){t.exports={component:"ui_button-component",button:"ui_button-button",dark:"ui_button-dark",primary:"ui_button-primary",active:"ui_button-active","x-small":"ui_button-x-small",small:"ui_button-small",large:"ui_button-large","x-large":"ui_button-x-large",full:"ui_button-full"}},function(t,r,i){t.exports={component:"ui_icon-font-component"}},function(t,r,i){t.exports={component:"ui_message-list-item-component",avatar:"ui_message-list-item-avatar",content:"ui_message-list-item-content","username-date":"ui_message-list-item-username-date",date:"ui_message-list-item-date",preview:"ui_message-list-item-preview"}},function(t,r,i){t.exports={component:"ui_modal-content-component",content:"ui_modal-content-content"}},function(t,r,i){t.exports={component:"ui_outside-close-component",icon:"ui_outside-close-icon"}},function(t,r,i){t.exports={component:"ui_modal-header-component","dark-mode":"ui_modal-header-dark-mode",icon:"ui_modal-header-icon"}},function(t,r,i){"use strict";(function(t){var o=i(74),a=i(26),l=i(53),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/modal/modal.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){t.exports={component:"ui_modal-component",footer:"ui_modal-footer",header:"ui_modal-header","rounded-sm":"ui_modal-rounded-sm","rounded-lg":"ui_modal-rounded-lg",body:"ui_modal-body",content:"ui_modal-content","parent-centered":"ui_modal-parent-centered",bg:"ui_modal-bg","bg-dark":"ui_modal-bg-dark","bg-transparent":"ui_modal-bg-transparent",enter:"ui_modal-enter",leave:"ui_modal-leave",xs:"ui_modal-xs",sm:"ui_modal-sm",md:"ui_modal-md",lg:"ui_modal-lg",xl:"ui_modal-xl"}},function(t,r,i){t.exports={component:"ui_modal-puzzle-component","close-button":"ui_modal-puzzle-close-button",header:"ui_modal-puzzle-header",title:"ui_modal-puzzle-title",subtitle:"ui_modal-puzzle-subtitle",modes:"ui_modal-puzzle-modes",mode:"ui_modal-puzzle-mode",arrow:"ui_modal-puzzle-arrow",rated:"ui_modal-puzzle-rated",learning:"ui_modal-puzzle-learning",rush:"ui_modal-puzzle-rush",description:"ui_modal-puzzle-description",footer:"ui_modal-puzzle-footer",bullets:"ui_modal-puzzle-bullets",modal:"ui_modal-puzzle-modal",content:"ui_modal-puzzle-content"}},function(t,r,i){t.exports={component:"ui_pagination-component",wrapper:"ui_pagination-wrapper",pagination:"ui_pagination-pagination",first:"ui_pagination-first",prev:"ui_pagination-prev",last:"ui_pagination-last",next:"ui_pagination-next",spread:"ui_pagination-spread",top:"ui_pagination-top"}},function(t,r,i){t.exports={component:"ui_section-container-component",heading:"ui_section-container-heading",black:"ui_section-container-black",grey:"ui_section-container-grey","light-grey":"ui_section-container-light-grey",green:"ui_section-container-green",red:"ui_section-container-red",white:"ui_section-container-white",dark:"ui_section-container-dark",title:"ui_section-container-title",normal:"ui_section-container-normal",large:"ui_section-container-large",content:"ui_section-container-content",link:"ui_section-container-link"}},function(t,r,i){t.exports={component:"ui_section-link-component","dark-mode":"ui_section-link-dark-mode",name:"ui_section-link-name",icon:"ui_section-link-icon",chevron:"ui_section-link-chevron","header-count":"ui_section-link-header-count"}},function(t,r,i){t.exports={component:"ui_section-tabs-component","dark-mode":"ui_section-tabs-dark-mode",tab:"ui_section-tabs-tab",active:"ui_section-tabs-active",icon:"ui_section-tabs-icon",label:"ui_section-tabs-label"}},function(t,r,i){t.exports={component:"ui_sortable-list-item-component",main:"ui_sortable-list-item-main",checkbox:"ui_sortable-list-item-checkbox",title:"ui_sortable-list-item-title",name:"ui_sortable-list-item-name",controls:"ui_sortable-list-item-controls",gear:"ui_sortable-list-item-gear",arrows:"ui_sortable-list-item-arrows",arrow:"ui_sortable-list-item-arrow",settings:"ui_sortable-list-item-settings","check-list-item":"ui_sortable-list-item-check-list-item","select-item":"ui_sortable-list-item-select-item","select-item-dropdown":"ui_sortable-list-item-select-item-dropdown","select-item-disabled":"ui_sortable-list-item-select-item-disabled","select-item-slot":"ui_sortable-list-item-select-item-slot","select-item-caret":"ui_sortable-list-item-select-item-caret","select-item-select":"ui_sortable-list-item-select-item-select","gear-wrapper":"ui_sortable-list-item-gear-wrapper","gear-select":"ui_sortable-list-item-gear-select"}},function(t,r,i){t.exports={component:"ui_user-username-component"}},function(t,r,i){t.exports={component:"ui_v5-button-component",primary:"ui_v5-button-primary",large:"ui_v5-button-large",secondary:"ui_v5-button-secondary",tertiary:"ui_v5-button-tertiary",danger:"ui_v5-button-danger",basic:"ui_v5-button-basic","basic-dark":"ui_v5-button-basic-dark","basic-light":"ui_v5-button-basic-light",pagination:"ui_v5-button-pagination","extra-padding":"ui_v5-button-extra-padding",small:"ui_v5-button-small","x-small":"ui_v5-button-x-small",full:"ui_v5-button-full",icon:"ui_v5-button-icon",disabled:"ui_v5-button-disabled",active:"ui_v5-button-active"}},function(t,r,i){t.exports={"component-dark":"ui_v5-input-component-dark",component:"ui_v5-input-component","component-light":"ui_v5-input-component-light",large:"ui_v5-input-large",icon:"ui_v5-input-icon",input:"ui_v5-input-input","input-adv":"ui_v5-input-input-adv",left:"ui_v5-input-left",right:"ui_v5-input-right",button:"ui_v5-input-button"}},function(t,r,i){t.exports={"component-dark":"ui_v5-select-component-dark",component:"ui_v5-select-component","component-light":"ui_v5-select-component-light",large:"ui_v5-select-large"}},function(t,r,i){t.exports={component:"ui_v5-sidebar-component",header:"ui_v5-sidebar-header","compact-header":"ui_v5-sidebar-compact-header","title-wrapper":"ui_v5-sidebar-title-wrapper",title:"ui_v5-sidebar-title",logo:"ui_v5-sidebar-logo","action-icon":"ui_v5-sidebar-action-icon",left:"ui_v5-sidebar-left",right:"ui_v5-sidebar-right",tabs:"ui_v5-sidebar-tabs",content:"ui_v5-sidebar-content"}},function(t,r,i){t.exports={component:"ui_v5-switch-component",checkbox:"ui_v5-switch-checkbox",label:"ui_v5-switch-label",readonly:"ui_v5-switch-readonly",button:"ui_v5-switch-button",group:"ui_v5-switch-group"}},function(t,r,i){t.exports={"component-dark":"ui_v5-textarea-component-dark",component:"ui_v5-textarea-component","component-light":"ui_v5-textarea-component-light",small:"ui_v5-textarea-small",large:"ui_v5-textarea-large","x-large":"ui_v5-textarea-x-large"}},function(t,r,i){"use strict";var o,a;!function(t){!function(t){t.DidHide="modal-did-hide"}(t.Events||(t.Events={}))}(o||(o={})),function(t){!function(t){t[t.Backspace=8]="Backspace",t[t.Delete=46]="Delete",t[t.DownArrow=40]="DownArrow",t[t.Enter=13]="Enter",t[t.Escape=27]="Escape",t[t.LeftArrow=37]="LeftArrow",t[t.RightArrow=39]="RightArrow",t[t.Spacebar=32]="Spacebar",t[t.Stop=137]="Stop",t[t.Tab=9]="Tab",t[t.UpArrow=38]="UpArrow"}(t.KeyCodes||(t.KeyCodes={}))}(a||(a={}));var l={name:"Modal",props:{autoShow:{type:Boolean,default:!1},closeOnAction:{type:Boolean,default:!0},centerOverParent:{type:Boolean,default:!1},isTransparent:{type:Boolean,default:!1},corners:{type:String,default:null},modalWidth:{type:String,default:null}},data:function data(){return{visible:!1}},mounted:function mounted(){this.closeOnAction&&window.addEventListener("keyup",this.onKeyPress),this.autoShow&&this.show()},beforeUnmount:function beforeUnmount(){this.closeOnAction&&window.removeEventListener("keyup",this.onKeyPress)},methods:{hide:function hide(){this.visible=!1,this.$emit(o.Events.DidHide)},onBackgroundClick:function onBackgroundClick(t){this.closeOnAction&&this.$refs.body&&!this.$refs.body.contains(t.target)&&this.hide()},onKeyPress:function onKeyPress(t){t.keyCode===a.KeyCodes.Escape&&this.hide()},show:function show(){this.visible=!0}}};r.a=l},function(t,r,i){"use strict";var o;!function(t){!function(t){!function(t){t.Base="button",t.IgnoreDarkMode="ignore-dark-mode"}(t.Classes||(t.Classes={})),function(t){t.Large="large",t.Small="small",t.Xl="x-large"}(t.Sizes||(t.Sizes={})),function(t){t.Primary="primary"}(t.Themes||(t.Themes={}))}(t.Component||(t.Component={}))}(o||(o={}));var a={name:"FormButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},href:{default:null,type:String,required:!1},size:{type:String,required:!1,default:o.Component.Sizes.Large},theme:{type:String,default:""},type:{type:String,default:"button"}},methods:{handleClick:function handleClick(t){this.$emit("click",t),t.stopPropagation(),this.href&&(window.location=this.href)}}};r.a=a},function(t,r,i){"use strict";var o={name:"MessageListItem",props:{avatarSrc:{type:String,required:!0},date:{type:String,required:!0},preview:{type:String,required:!0}},methods:{pixelDensity:function pixelDensity(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t)return null;var i="@2x";return/\.svg$/.test(t)?t:([1.5,3,4].includes(r)&&(i="@".concat(r,"x")),t.replace(/(\.\w+)$/,(function(t){return i+t})))}}};r.a=o},function(t,r,i){"use strict";var o,a=i(4),l=i(2);!function(t){!function(t){t.Page="page"}(t.QueryStringParams||(t.QueryStringParams={}))}(o||(o={}));var h={Types:o,name:"Pagination",components:{FormButton:a.a,IconFont:l.a},props:{currentPage:{type:Number,required:!0},pages:{type:Array,required:!0},tabLimit:{type:Number,default:4},totalPages:{type:Number,required:!0},scrollTo:{default:"",type:String,required:!1},paginationQuery:{type:String,default:o.QueryStringParams.Page}},computed:{lastPageIsHidden:function lastPageIsHidden(){return!this.pages.includes(this.totalPages)},showLowerEllipsis:function showLowerEllipsis(){return this.currentPage>1&&-1===this.pages.indexOf(1)},showUpperEllipsis:function showUpperEllipsis(){return this.lastPageIsHidden},showTopButton:function showTopButton(){return this.scrollTo||!1}},methods:{isSamePage:function isSamePage(t){return this.currentPage===t},goToPageNumber:function goToPageNumber(t){return this.isSamePage(t)?"Current Page, Page ".concat(t):"Page ".concat(t)},goToTop:function goToTop(){var t=document.getElementById(this.scrollTo)||null;t&&t.scrollIntoView({behavior:"smooth",block:"start"})},commitChangePage:function commitChangePage(t){this.$emit("change-page",t)}}};r.a=h},function(t,r,i){"use strict";var o,a,l={};i.r(l),i.d(l,"ListTypes",(function(){return o})),i.d(l,"PositionDirections",(function(){return a})),function(t){t.CheckList="check-list",t.SelectList="select-list"}(o||(o={})),function(t){t.Down="down",t.Up="up"}(a||(a={}));var h={Types:l,name:"SortableListItem",props:{checkListItems:{default:function _default(){return[]},type:Array},enabled:{required:!0,type:Boolean},gearOptions:{default:function _default(){return[]},type:Array},gearValue:{default:0,type:Number},isDownArrowDisabled:{default:!1,type:Boolean},isUpArrowDisabled:{default:!1,type:Boolean},listType:{default:"",type:String},name:{required:!0,type:String},selectListSlotsCount:{default:0,type:Number},selectListSlots:{default:function _default(){return[]},type:Array},selectListOptions:{default:function _default(){return[]},type:Array},showGearIcon:{default:!1,type:Boolean}},data:function data(){return{listTypes:Object.freeze(o),positionDirections:Object.freeze(a)}},methods:{checkboxIcon:function checkboxIcon(t){return t?"square-checkmark":"square"},onCheckListItemChange:function onCheckListItemChange(t,r){this.$emit("check-list-item-change",{enabled:r,value:t})},onGearChange:function onGearChange(t){this.$emit("gear-option-change",{value:t.target.value})},onItemToggle:function onItemToggle(t){this.$emit("item-enabled-change",t.target.checked)},onPositionChange:function onPositionChange(t){this.$emit("position-change",t)},onSelectListItemInput:function onSelectListItemInput(t,r){this.$emit("select-list-item-input",{slot:t-1,value:r.target.value})}}};r.a=h},function(t,r,i){"use strict";var o={name:"IconFont",props:{name:{required:!0,type:String},size:{default:3,required:!1,type:Number}}};r.a=o},function(t,r,i){"use strict";r.a={name:"ModalContent"}},function(t,r,i){"use strict";r.a={name:"OutsideClose"}},function(t,r,i){"use strict";var o={name:"ModalHeader",components:{IconFont:i(2).a},props:{icon:{type:String,default:""}}};r.a=o},function(t,r,i){"use strict";var o={name:"PuzzleModal",components:{Modal:i(11).a}};r.a=o},function(t,r,i){"use strict";var o={name:"SectionContainer",props:{darkMode:{default:!1,type:Boolean},heading:{default:function _default(){return{}},type:Object},lightMode:{default:!1,type:Boolean},link:{default:"",type:String}}};r.a=o},function(t,r,i){"use strict";var o={name:"SectionLink",components:{IconFont:i(2).a},props:{icon:{type:String,default:""},name:{type:String,required:!0},isDarkMode:{type:Boolean,required:!1},url:{default:"",type:String}}};r.a=o},function(t,r,i){"use strict";var o={name:"SectionTabs",components:{IconFont:i(2).a},props:{isDarkMode:{default:!1,type:Boolean},selectedValue:{required:!0,type:String},showLabels:{default:!0,type:Boolean},tabs:{required:!0,type:Array}},methods:{changeTab:function changeTab(t){this.$emit("tab-changed",t)}}};r.a=o},function(t,r,i){"use strict";r.a={name:"UserUsername"}},function(t,r,i){"use strict";var o={name:"V5Button",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},extraPadding:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},href:{default:null,type:String,required:!1},size:{type:String,default:""},theme:{type:String,default:"basic"},type:{type:String,default:"button"}}};r.a=o},function(t,r,i){"use strict";var o=i(62),a=i.n(o),l={name:"V5Input",props:{ariaLabel:{type:String,default:""},autocomplete:{type:String,default:"off"},autofocus:Boolean,clearButtonIcon:{type:String,default:""},disabled:Boolean,iconLeft:{type:String,default:""},iconRight:{type:String,default:""},id:{type:String,default:""},maxlength:{type:Number,default:524288},name:{type:String,default:""},placeholder:{type:String,default:""},size:{type:String,default:"small"},type:{type:String,default:"text"},value:{type:[String,Number],default:""}},computed:{inputClasses:function inputClasses(){var t,r=this.$style,i=this.iconLeft,o=this.iconRight,l=this.size,h=this.clearButtonIcon;return[r.input,r["input-adv"],r[l],(t={},a()(t,r.left,i),a()(t,r.right,o||h),t)]}},methods:{clearButtonAction:function clearButtonAction(t){this.$emit("clear-button-action",t)},blurEvent:function blurEvent(t){this.$emit("blur",t)},focusEvent:function focusEvent(t){this.$emit("focus",t)},keyupEvent:function keyupEvent(t){this.$emit("keyup",t)},onIconClick:function onIconClick(t){this.$emit("icon-click-".concat(t))},updateValue:function updateValue(t){this.$emit("input",t)}}};r.a=l},function(t,r,i){"use strict";var o={name:"V5Input",props:{size:{type:String,default:""},forceTheme:{type:String,default:""},value:{default:"",type:[Number,String]}},computed:{componentClass:function componentClass(){var t=this.forceTheme.length?"component-".concat(this.forceTheme):"component";return this.$style[t]}},methods:{keyupEvent:function keyupEvent(t){this.$emit("keyup",t)}}};r.a=o},function(t,r,i){"use strict";var o={name:"V5Select",props:{emptyOption:{type:String,default:""},forceTheme:{type:String,default:""},labelKey:{type:String,default:"label"},options:{type:Array,required:!0},placeholderText:{type:String,default:""},size:{type:String,default:""},value:{type:[String,Number],required:!1,default:""},valueKey:{type:String,default:"value"}},computed:{componentClass:function componentClass(){var t=this.forceTheme.length?"component-".concat(this.forceTheme):"component";return this.$style[t]}},methods:{getLabel:function getLabel(t){return this.labelKey?t[this.labelKey]:t},getValue:function getValue(t){return this.valueKey?t[this.valueKey]:t},setSelectedOption:function setSelectedOption(t){this.$emit("input",t),this.onChange&&this.onChange()}}};r.a=o},function(t,r,i){"use strict";var o={name:"V5Sidebar",props:{title:{type:String,required:!0},compactHeader:{type:Boolean,default:!1}}};r.a=o},function(t,r,i){"use strict";var o={name:"V5Switch",props:{name:{type:String,required:!0},value:{type:Boolean,required:!0},isDisabled:{type:Boolean,default:!1}},methods:{setSwitchStatus:function setSwitchStatus(t){this.$emit("input",t)}}};r.a=o},function(t,r,i){"use strict";var o={name:"V5Textarea",props:{forceTheme:{type:String,default:""},size:{type:String,default:""},value:{default:"",type:[Number,String]}},computed:{componentClass:function componentClass(){var t=this.forceTheme.length?"component-".concat(this.forceTheme):"component";return this.$style[t]}}};r.a=o},function(t,r,i){"use strict";var o=i(5),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(6),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(7),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(8),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(9),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(10),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(12),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(13),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(14),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(15),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(16),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(17),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(18),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(19),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(20),a=i.n(o);r.default=a.a},function(t,r){t.exports=function _defineProperty(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}},function(t,r,i){"use strict";var o=i(22),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(23),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(24),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var o=i(25),a=i.n(o);r.default=a.a},function(t,r,i){"use strict";var render=function(){var t,r=this,i=r.$createElement;return(r._self._c||i)("button",{class:[r.$style.component,r.$style[r.size],r.$style[r.theme],(t={},t[r.$style.full]=r.fullWidth,t[r.$style.active]=r.active,t[r.$style.disabled]=r.disabled,t)],attrs:{"aria-selected":r.active,disabled:r.disabled,type:r.type},on:{click:r.handleClick}},[r._t("default")],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement;return(t._self._c||r)("div",t._b({class:[t.$style.component,"icon-font-chess",t.name],style:[{fontSize:t.size+"rem",marginTop:"-"+1.7*t.size/2+"px"}],on:{click:function(r){return t.$emit("click",r)}}},"div",t.$attrs,!1))},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("img",{class:t.$style.avatar,attrs:{src:t.avatarSrc,srcset:t.pixelDensity(t.avatarSrc)}}),t._v(" "),i("div",{class:t.$style.content},[i("div",{class:t.$style["username-date"]},[t._t("user-tagline"),t._v(" "),i("div",{class:t.$style.date,domProps:{textContent:t._s(t.date)}})],2),t._v(" "),i("div",{class:t.$style.preview,domProps:{textContent:t._s(t.preview)}})])])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement;return(t._self._c||r)("div",{class:t.$style.component},[t._t("default")],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("button",{class:t.$style.component,attrs:{type:"button"},on:{click:function(r){return t.$emit("click",r)}}},[i("div",{staticClass:"icon-font-chess x",class:t.$style.icon})])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[t._t("default"),t._v(" "),t.icon?i("IconFont",{class:t.$style.icon,attrs:{name:t.icon},on:{click:function(r){return t.$emit("close",r)}}}):t._e()],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("Modal",{ref:"modal",class:t.$style.modal,attrs:{"close-on-action":!1,"auto-show":""}},[i("div",{class:t.$style.content},[i("div",{class:t.$style.component,attrs:{"data-cy":"modalIntro"}},[i("div",{class:t.$style.header},[i("div",{class:t.$style.title},[t._v("\n          Solve Chess Puzzles\n        ")])]),t._v(" "),i("div",{class:t.$style.description},[i("div",{class:[t.$style.arrow,t.$style.rated]}),t._v(" "),i("p",[t._v("\n          Test your tactical skills with puzzles that push your limits. The faster you solve, the higher your score.\n        ")])]),t._v(" "),i("div",{class:t.$style.footer},[t._v("\n        Here is where footer info would go\n      ")])])])])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("Transition",{attrs:{"enter-active-class":r.$style.enter,"leave-active-class":r.$style.leave}},[r.visible?o("div",[r.centerOverParent?r._e():o("div",{class:[r.$style.bg,[r.isTransparent?r.$style["bg-transparent"]:r.$style["bg-dark"]]]}),r._v(" "),o("div",{class:[r.$style.component,(t={},t[r.$style["parent-centered"]]=r.centerOverParent,t)],on:{click:function(t){return r.onBackgroundClick(t)}}},[o("div",{ref:"body",class:[r.$style.body,r.$style[r.corners],r.$style[r.modalWidth]]},[this.$slots.header?o("div",{class:r.$style.header},[r._t("header")],2):r._e(),r._v(" "),this.$slots.content?o("div",{class:r.$style.content},[r._t("content")],2):r._e(),r._v(" "),r._t("default"),r._v(" "),this.$slots.footer?o("div",{class:r.$style.footer},[r._t("footer")],2):r._e()],2)])]):r._e()])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[t.showTopButton?i("FormButton",{class:t.$style.top,attrs:{theme:"pagination","aria-label":"Back To Top","data-cy-top-button":""},on:{click:function(r){return t.goToTop()}}},[i("IconFont",{attrs:{name:"chevron-up"}}),t._v("\n    Top\n  ")],1):t._e(),t._v(" "),i("nav",{class:t.$style.pagination,attrs:{"data-cy-navigation":""}},[1!==t.currentPage?i("FormButton",{class:t.$style.first,attrs:{theme:"pagination","aria-label":"First Page","data-cy-first-page-button":""},on:{click:function(r){return t.commitChangePage(1)}}},[t._v("\n      First\n    ")]):t._e(),t._v(" "),i("FormButton",{class:t.$style.prev,attrs:{theme:"pagination","aria-label":"Previous Page","data-cy-previous-page-button":"","is-disabled":1===t.currentPage},on:{click:function(r){return t.commitChangePage(t.currentPage-1)}}},[i("IconFont",{attrs:{name:"chevron-left",size:2}})],1),t._v(" "),t.showLowerEllipsis?i("div",{class:t.$style.spread},[i("span",[t._v("...")])]):t._e(),t._v(" "),t._l(t.pages,(function(r,o){return i("FormButton",{key:o,attrs:{theme:"pagination","aria-label":t.goToPageNumber(r),active:t.isSamePage(r)},on:{click:function(i){return t.commitChangePage(r)}}},[t._v("\n      "+t._s(r.toString())+"\n    ")])})),t._v(" "),t.showUpperEllipsis?i("div",{class:t.$style.spread},[i("span",[t._v("...")])]):t._e(),t._v(" "),i("FormButton",{class:t.$style.next,attrs:{theme:"pagination","aria-label":"Next Page","is-disabled":t.currentPage===t.totalPages,"data-cy-next-page-btn":""},on:{click:function(r){return t.commitChangePage(t.currentPage+1)}}},[i("IconFont",{attrs:{name:"chevron-right",size:2}})],1),t._v(" "),t.currentPage!==t.totalPages?i("FormButton",{class:t.$style.last,attrs:{theme:"pagination","aria-label":"Last Page","data-cy-last-page-button":""},on:{click:function(r){return t.commitChangePage(-1)}}},[t._v("\n      Last\n    ")]):t._e()],2)],1)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:[t.$style.component,{"dark-mode":t.darkMode,"light-mode":t.lightMode}]},[t.$slots.heading?i("div",{class:[t.$style.heading,t.$style[t.heading.theme]]},[i("span",{class:[t.$style.title,t.$style[t.heading.size]]},[t._t("heading")],2)]):t._e(),t._v(" "),t.$slots.link?i("a",{class:[t.$style.link,{"dark-mode":t.darkMode,"light-mode":t.lightMode}],attrs:{href:t.link.url}},[t._t("link")],2):t._e(),t._v(" "),t.$slots.title?i("span",{class:t.$style.link},[t._t("title")],2):t._e(),t._v(" "),t._t("title-content"),t._v(" "),t.$slots.default?i("div",{class:t.$style.content},[t._t("default")],2):t._e()],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("a",{class:[r.$style.component,(t={},t[r.$style["dark-mode"]]=r.isDarkMode,t)],attrs:{href:r.url}},[r.icon?o("IconFont",{class:r.$style.icon,attrs:{family:"chess",name:r.icon}}):r._e(),r._v(" "),o("span",{class:r.$style.name},[r._v(r._s(r.name))]),r._v(" "),r._t("default"),r._v(" "),o("IconFont",{class:r.$style.chevron,attrs:{theme:"primary",name:"chevron-right"}})],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",{class:[r.$style.component,(t={},t[r.$style["dark-mode"]]=r.isDarkMode,t)]},r._l(r.tabs,(function(t){var i;return o("div",{key:t.value,class:[r.$style.tab,(i={},i[r.$style.active]=r.selectedValue===t.value,i)],on:{click:function(i){return r.changeTab(t.value)}}},[t.icon?o("IconFont",{class:r.$style.icon,attrs:{name:t.icon}}):r._e(),r._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:r.showLabels,expression:"showLabels"}],class:r.$style.label,domProps:{textContent:r._s(t.label)}})],1)})),0)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{class:t.$style.main},[i("div",{class:t.$style.title},[i("input",{class:t.$style.checkbox,attrs:{id:"checkbox-"+t.name,type:"checkbox"},domProps:{checked:t.enabled},on:{change:function(r){return t.onItemToggle(r)}}}),t._v(" "),i("label",{class:t.$style.name,attrs:{for:"checkbox-"+t.name},domProps:{textContent:t._s(t.name)}})]),t._v(" "),i("div",{class:t.$style.controls},[t.showGearIcon?i("div",{class:t.$style["gear-wrapper"]},[i("span",{staticClass:"icon-font-chess circle-gearwheel",class:t.$style.gear}),t._v(" "),i("select",{class:t.$style["gear-select"],attrs:{disabled:!t.enabled},on:{change:function(r){return t.onGearChange(r)}}},t._l(t.gearOptions,(function(r){return i("option",{key:r.value,domProps:{selected:r.value===t.gearValue,value:r.value,textContent:t._s(r.name)}})})),0)]):t._e(),t._v(" "),i("div",{class:t.$style.arrows},[i("span",{staticClass:"icon-font-chess caret-up",class:t.$style.arrow,style:[{pointerEvents:t.isUpArrowDisabled?"none":"auto"}],on:{click:function(r){return t.onPositionChange(t.positionDirections.Up)}}}),t._v(" "),i("span",{staticClass:"icon-font-chess caret-down",class:t.$style.arrow,style:[{pointerEvents:t.isDownArrowDisabled?"none":"auto"}],on:{click:function(r){return t.onPositionChange(t.positionDirections.Down)}}})])])]),t._v(" "),t.listType===t.listTypes.CheckList?i("div",{class:t.$style.settings},t._l(t.checkListItems,(function(r){return i("div",{key:r.value,class:t.$style["check-list-item"]},[i("input",{class:t.$style.checkbox,attrs:{id:"checkbox-"+r.value,type:"checkbox",disabled:!t.enabled},domProps:{checked:r.enabled},on:{input:function(i){return t.onCheckListItemChange(r.value,!r.enabled)}}}),t._v(" "),i("label",{attrs:{for:"checkbox-"+r.value},domProps:{textContent:t._s(r.name)}})])})),0):t._e(),t._v(" "),t.listType===t.listTypes.SelectList?i("div",{class:t.$style.settings},t._l(t.selectListSlotsCount,(function(r,o){var a;return i("div",{key:r,class:[t.$style["select-item"],(a={},a[t.$style["select-item-disabled"]]=!t.enabled,a)]},[i("div",{class:t.$style["select-item-slot"],domProps:{textContent:t._s(r)}}),t._v(" "),i("div",{class:t.$style["select-item-dropdown"]},[i("div",{class:t.selectListSlots[o].className,domProps:{textContent:t._s(t.selectListSlots[o].name)}}),t._v(" "),i("span",{staticClass:"icon-font-chess caret-down",class:t.$style["select-item-caret"]}),t._v(" "),i("select",{class:t.$style["select-item-select"],attrs:{disabled:!t.enabled},on:{change:function(i){return t.onSelectListItemInput(r,i)}}},t._l(t.selectListOptions,(function(r){return i("option",{key:r.value,domProps:{selected:r.value===t.selectListSlots[o].value,value:r.value,textContent:t._s(r.name)}})})),0)])])})),0):t._e()])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement;return(t._self._c||r)("div",{class:t.$style.component},[t._t("default")],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t,r,i=this,o=i.$createElement,a=i._self._c||o;return i.href?a("a",{class:[i.$style.component,i.$style[i.theme],i.$style[i.size],(t={},t[i.$style.full]=i.fullWidth,t[i.$style.active]=i.active,t[i.$style.disabled]=i.disabled,t[i.$style["extra-padding"]]=i.extraPadding,t)],attrs:{href:i.href},on:{click:function(t){return i.$emit("click",t)}}},[i._t("default")],2):a("button",{class:[i.$style.component,i.$style[i.theme],i.$style[i.size],(r={},r[i.$style.full]=i.fullWidth,r[i.$style.active]=i.active,r[i.$style["extra-padding"]]=i.extraPadding,r)],attrs:{disabled:i.disabled,type:i.type},on:{click:function(t){return i.$emit("click",t)}}},[i._t("default")],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:[t.$style.component,t.$style[t.size]],on:{keyup:function(r){return t.$emit("keyup",r)}}},[t.iconLeft?i("span",{staticClass:"icon-font-chess",class:[t.$style.icon,t.$style.left,t.iconLeft],attrs:{theme:"primary"},on:{click:function(r){return t.onIconClick("left")}}}):t._e(),t._v(" "),i("input",{class:t.inputClasses,attrs:{id:t.id,"aria-label":t.ariaLabel,autocomplete:t.autocomplete,autofocus:t.autofocus,maxlength:t.maxlength,name:t.name,placeholder:t.placeholder,readonly:t.disabled,type:t.type},domProps:{value:t.value},on:{blur:function(r){return t.blurEvent(r)},focus:function(r){return t.focusEvent(r)},input:function(r){return t.updateValue(r.target.value)},keyup:function(r){return t.keyupEvent(r)}}}),t._v(" "),t.iconRight?i("span",{staticClass:"icon-font-chess",class:[t.$style.icon,t.$style.right,t.iconRight],attrs:{theme:"primary"},on:{click:function(r){return t.onIconClick("right")}}}):t._e(),t._v(" "),t.clearButtonIcon&&!t.iconRight&&t.value?i("button",{class:t.$style.button,on:{click:function(r){return t.clearButtonAction(r)}}},[i("span",{staticClass:"icon-font-chess circle-x"})]):t._e(),t._v(" "),!t.clearButtonIcon||t.iconRight||t.value?t._e():i("span",{staticClass:"icon-font-chess",class:[t.$style.icon,t.$style.right,t.clearButtonIcon]})])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement;return(t._self._c||r)("input",{class:[t.componentClass,t.$style.input,t.$style[t.size]],domProps:{value:t.value},on:{focus:function(r){return t.$emit("focus",r)},input:function(r){return t.$emit("input",r.target.value)},keydown:function(r){return t.$emit("keydown",r)},keyup:function(r){return t.keyupEvent(r)}}})},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("select",{class:[t.componentClass,t.$style[t.size]],on:{change:function(r){return t.setSelectedOption(r.target.value)}}},[t.placeholderText?i("option",{attrs:{disabled:"",hidden:"",selected:"",value:""},domProps:{textContent:t._s(t.placeholderText)}}):t._e(),t._v(" "),t.emptyOption?i("option",{attrs:{selected:"",value:""},domProps:{textContent:t._s(t.emptyOption)}}):t._e(),t._v(" "),t._l(t.options,(function(r,o){return i("option",{key:o,attrs:{disabled:r.disabled,hidden:r.hidden},domProps:{selected:t.getValue(r)===t.value,value:t.getValue(r)}},[t._v("\n    "+t._s(t.getLabel(r))+"\n  ")])}))],2)},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",{class:r.$style.component},[o("div",{class:[r.$style.header,(t={},t[r.$style["compact-header"]]=r.compactHeader,t)]},[r.$slots.leftActionIcon?o("div",{class:[r.$style["action-icon"],r.$style.left]},[r._t("leftActionIcon")],2):r._e(),r._v(" "),o("div",{class:r.$style["title-wrapper"]},[o("span",{class:r.$style.title},[r._v("\n        "+r._s(r.title)+"\n      ")]),r._v(" "),r.$slots.logo?o("div",{class:r.$style.logo},[r._t("logo")],2):r._e()]),r._v(" "),r.$slots.rightActionIcon?o("div",{class:[r.$style["action-icon"],r.$style.right]},[r._t("rightActionIcon")],2):r._e()]),r._v(" "),r.$slots.tabs?o("div",{class:r.$style.tabs},[r._t("tabs")],2):r._e(),r._v(" "),o("div",{class:r.$style.content},[r._t("default")],2)])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("input",{class:t.$style.checkbox,attrs:{id:t.name,type:"checkbox",disabled:t.isDisabled,name:t.name},domProps:{checked:t.value},on:{change:function(r){return t.setSwitchStatus(r.target.checked)}}}),t._v(" "),i("label",{class:t.$style.label,attrs:{for:t.name}},[i("div",{class:t.$style.button})])])},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";var render=function(){var t=this,r=t.$createElement;return(t._self._c||r)("textarea",{class:[t.componentClass,t.$style[t.size]],domProps:{value:t.value},on:{input:function(r){return t.$emit("input",r.target.value)}}})},o=[];render._withStripped=!0,i.d(r,"a",(function(){return render})),i.d(r,"b",(function(){return o}))},function(t,r,i){"use strict";(function(t){var o=i(69),a=i(28),l=i(49),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/message-list-item/message-list-item.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(70),a=i(32),l=i(50),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/modal/modal-content/modal-content.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(71),a=i(33),l=i(51),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/modal/modal-content/outside-close.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(72),a=i(34),l=i(52),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/modal/modal-header/modal-header.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(73),a=i(35),l=i(54),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/modal/modal-puzzle/modal-puzzle.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(75),a=i(29),l=i(55),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/pagination/pagination.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(76),a=i(36),l=i(56),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/section/section-container.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(77),a=i(37),l=i(57),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/section/section-link/section-link.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(78),a=i(38),l=i(58),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/section/section-tabs/section-tabs.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(79),a=i(30),l=i(59),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/sortable-list/sortable-list-item/sortable-list-item.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(80),a=i(39),l=i(60),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/user-username/user-username.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(81),a=i(40),l=i(61),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-button/v5-button.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(82),a=i(41),l=i(3),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-input/v5-input-adv.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(83),a=i(42),l=i(3),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-input/v5-input.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(84),a=i(43),l=i(63),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-select/v5-select.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(85),a=i(44),l=i(64),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-sidebar/v5-sidebar.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(86),a=i(45),l=i(65),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-switch/v5-switch.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";(function(t){var o=i(87),a=i(46),l=i(66),h=i(0),g={};t.hot,t.hot;var y=Object(h.a)(a.a,o.a,o.b,!1,(function injectStyles(t){g.$style=l.default.locals||l.default,Object.defineProperty(this,"$style",{configurable:!0,get:function(){return g.$style}})}),null,null);y.options.__file="src/ui/v5-textarea/v5-textarea.vue",r.a=y.exports}).call(this,i(1)(t))},function(t,r,i){"use strict";i.r(r);var o=i(4);i.d(r,"Button",(function(){return o.a}));var a=i(2);i.d(r,"IconFont",(function(){return a.a}));var l=i(88);i.d(r,"MessageListItem",(function(){return l.a}));var h=i(89);i.d(r,"ModalContent",(function(){return h.a}));var g=i(90);i.d(r,"OutsideClose",(function(){return g.a}));var y=i(91);i.d(r,"ModalHeader",(function(){return y.a}));var _=i(92);i.d(r,"ModalPuzzle",(function(){return _.a}));var x=i(11);i.d(r,"Modal",(function(){return x.a}));var w=i(93);i.d(r,"Pagination",(function(){return w.a}));var S=i(94);i.d(r,"SectionContainer",(function(){return S.a}));var M=i(95);i.d(r,"SectionLink",(function(){return M.a}));var T=i(96);i.d(r,"SectionTabs",(function(){return T.a}));var P=i(97);i.d(r,"SortableListItem",(function(){return P.a}));var C=i(98);i.d(r,"UserUsername",(function(){return C.a}));var A=i(99);i.d(r,"V5Button",(function(){return A.a}));var O=i(100);i.d(r,"V5InputAdv",(function(){return O.a}));var L=i(101);i.d(r,"V5Input",(function(){return L.a}));var I=i(102);i.d(r,"V5Select",(function(){return I.a}));var R=i(103);i.d(r,"V5Sidebar",(function(){return R.a}));var j=i(104);i.d(r,"V5Switch",(function(){return j.a}));var N=i(105);i.d(r,"V5Textarea",(function(){return N.a}))}])}))},"./node_modules/@vue/composition-api/dist/vue-composition-api.esm.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/@vue/composition-api/dist/vue-composition-api.esm.js")},"./node_modules/amplitude-js/amplitude.js":function(t,r,i){t.exports=i("dll-reference amplitudeDLL")("./node_modules/amplitude-js/amplitude.js")},"./node_modules/autosize/dist/autosize.js":function(t,r,i){var o,a,l;a=[t,r],void 0===(l="function"==typeof(o=function(t,r){"use strict";var i,o,a="function"==typeof Map?new Map:(i=[],o=[],{has:function has(t){return i.indexOf(t)>-1},get:function get(t){return o[i.indexOf(t)]},set:function set(t,r){-1===i.indexOf(t)&&(i.push(t),o.push(r))},delete:function _delete(t){var r=i.indexOf(t);r>-1&&(i.splice(r,1),o.splice(r,1))}}),l=function createEvent(t){return new Event(t,{bubbles:!0})};try{new Event("test")}catch(g){l=function createEvent(t){var r=document.createEvent("Event");return r.initEvent(t,!0,!1),r}}function assign(t){if(t&&t.nodeName&&"TEXTAREA"===t.nodeName&&!a.has(t)){var r=null,i=null,o=null,h=function pageResize(){t.clientWidth!==i&&update()},g=function(r){window.removeEventListener("resize",h,!1),t.removeEventListener("input",update,!1),t.removeEventListener("keyup",update,!1),t.removeEventListener("autosize:destroy",g,!1),t.removeEventListener("autosize:update",update,!1),Object.keys(r).forEach((function(i){t.style[i]=r[i]})),a.delete(t)}.bind(t,{height:t.style.height,resize:t.style.resize,overflowY:t.style.overflowY,overflowX:t.style.overflowX,wordWrap:t.style.wordWrap});t.addEventListener("autosize:destroy",g,!1),"onpropertychange"in t&&"oninput"in t&&t.addEventListener("keyup",update,!1),window.addEventListener("resize",h,!1),t.addEventListener("input",update,!1),t.addEventListener("autosize:update",update,!1),t.style.overflowX="hidden",t.style.wordWrap="break-word",a.set(t,{destroy:g,update:update}),init()}function init(){var i=window.getComputedStyle(t,null);"vertical"===i.resize?t.style.resize="none":"both"===i.resize&&(t.style.resize="horizontal"),r="content-box"===i.boxSizing?-(parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)):parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),isNaN(r)&&(r=0),update()}function changeOverflow(r){var i=t.style.width;t.style.width="0px",t.offsetWidth,t.style.width=i,t.style.overflowY=r}function getParentOverflows(t){for(var r=[];t&&t.parentNode&&t.parentNode instanceof Element;)t.parentNode.scrollTop&&r.push({node:t.parentNode,scrollTop:t.parentNode.scrollTop}),t=t.parentNode;return r}function resize(){if(0!==t.scrollHeight){var o=getParentOverflows(t),a=document.documentElement&&document.documentElement.scrollTop;t.style.height="",t.style.height=t.scrollHeight+r+"px",i=t.clientWidth,o.forEach((function(t){t.node.scrollTop=t.scrollTop})),a&&(document.documentElement.scrollTop=a)}}function update(){resize();var r=Math.round(parseFloat(t.style.height)),i=window.getComputedStyle(t,null),a="content-box"===i.boxSizing?Math.round(parseFloat(i.height)):t.offsetHeight;if(a!==r?"hidden"===i.overflowY&&(changeOverflow("scroll"),resize(),a="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight):"hidden"!==i.overflowY&&(changeOverflow("hidden"),resize(),a="content-box"===i.boxSizing?Math.round(parseFloat(window.getComputedStyle(t,null).height)):t.offsetHeight),o!==a){o=a;var h=l("autosize:resized");try{t.dispatchEvent(h)}catch(g){}}}}function destroy(t){var r=a.get(t);r&&r.destroy()}function update(t){var r=a.get(t);r&&r.update()}var h=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((h=function autosize(t){return t}).destroy=function(t){return t},h.update=function(t){return t}):((h=function autosize(t,r){return t&&Array.prototype.forEach.call(t.length?t:[t],(function(t){return assign(t,r)})),t}).destroy=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],destroy),t},h.update=function(t){return t&&Array.prototype.forEach.call(t.length?t:[t],update),t}),r.default=h,t.exports=r.default})?o.apply(r,a):o)||(t.exports=l)},"./node_modules/axios/index.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/axios/index.js")},"./node_modules/bazinga-translator/js/translator.js":function(t,r,i){var o,a;void 0===(a="function"==typeof(o=function(){"use strict";var t={},r="en",i=[],o=new RegExp(/^\w+\: +(.+)$/),a=new RegExp(/^\s*((\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]]))\s?(.+?)$/),l=new RegExp(/^\s*(\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]])/),h={locale:get_current_locale(),fallback:r,placeHolderPrefix:"%",placeHolderSuffix:"%",defaultDomain:"messages",pluralSeparator:"|",add:function(r,o,a,l){var h=l||this.locale||this.fallback,g=a||this.defaultDomain;return t[h]||(t[h]={}),t[h][g]||(t[h][g]={}),t[h][g][r]=o,!1===exists(i,g)&&i.push(g),this},trans:function(t,r,i,o){return replace_placeholders(get_message(t,i,o,this.locale,this.fallback),r||{})},transChoice:function(t,r,i,o,a){var l=get_message(t,o,a,this.locale,this.fallback),h=parseInt(r,10);return void 0===(i=i||{}).count&&(i.count=r),void 0===l||isNaN(h)||(l=pluralize(l,h,a||this.locale||this.fallback)),replace_placeholders(l,i)},fromJSON:function(t){if("string"==typeof t&&(t=JSON.parse(t)),t.locale&&(this.locale=t.locale),t.fallback&&(this.fallback=t.fallback),t.defaultDomain&&(this.defaultDomain=t.defaultDomain),t.translations)for(var r in t.translations)for(var i in t.translations[r])for(var o in t.translations[r][i])this.add(o,t.translations[r][i][o],i,r);return this},reset:function(){t={},i=[],this.locale=get_current_locale()}};function replace_placeholders(t,r){var i,o=h.placeHolderPrefix,a=h.placeHolderSuffix;for(i in r){var l=new RegExp(o+i+a,"g");if(l.test(t)){var g=String(r[i]).replace(new RegExp("\\$","g"),"$$$$");t=t.replace(l,g)}}return t}function get_message(r,o,a,l,h){var g,y,_,x=a||l||h,w=o,S=x.split("_")[0];if(!(x in t))if(S in t)x=S;else{if(!(h in t))return r;x=h}if(null==w)for(var M=0;M<i.length;M++)if(has_message(x,i[M],r)||has_message(S,i[M],r)||has_message(h,i[M],r)){w=i[M];break}if(has_message(x,w,r))return t[x][w][r];for(;x.length>2&&(g=x.length,_=(y=x.split(/[\s_]+/))[y.length-1].length,1!==y.length);)if(has_message(x=x.substring(0,g-(_+1)),w,r))return t[x][w][r];return has_message(h,w,r)?t[h][w][r]:r}function has_message(r,i,o){return r in t&&i in t[r]&&o in t[r][i]}function pluralize(t,r,i){var g,y,_=[],x=[],w=t.split(h.pluralSeparator),S=[];for(g=0;g<w.length;g++){var M=w[g];a.test(M)?_[(S=M.match(a))[0]]=S[S.length-1]:o.test(M)?(S=M.match(o),x.push(S[1])):x.push(M)}for(y in _)if(l.test(y))if((S=y.match(l))[1]){var T,P=S[2].split(",");for(T in P)if(r==P[T])return _[y]}else{var C=convert_number(S[4]),A=convert_number(S[5]);if(("["===S[3]?r>=C:r>C)&&("]"===S[6]?r<=A:r<A))return _[y]}return x[plural_position(r,i)]||x[0]||void 0}function convert_number(t){return"-Inf"===t?Number.NEGATIVE_INFINITY:"+Inf"===t||"Inf"===t?Number.POSITIVE_INFINITY:parseInt(t,10)}function plural_position(t,r){var i=r;switch("pt_BR"===i&&(i="xbr"),i.length>3&&(i=i.split("_")[0]),i){case"bo":case"dz":case"id":case"ja":case"jv":case"ka":case"km":case"kn":case"ko":case"ms":case"th":case"tr":case"vi":case"zh":return 0;case"af":case"az":case"bn":case"bg":case"ca":case"da":case"de":case"el":case"en":case"eo":case"es":case"et":case"eu":case"fa":case"fi":case"fo":case"fur":case"fy":case"gl":case"gu":case"ha":case"he":case"hu":case"is":case"it":case"ku":case"lb":case"ml":case"mn":case"mr":case"nah":case"nb":case"ne":case"nl":case"nn":case"no":case"om":case"or":case"pa":case"pap":case"ps":case"pt":case"so":case"sq":case"sv":case"sw":case"ta":case"te":case"tk":case"ur":case"zu":return 1==t?0:1;case"am":case"bh":case"fil":case"fr":case"gun":case"hi":case"ln":case"mg":case"nso":case"xbr":case"ti":case"wa":return 0===t||1==t?0:1;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;case"cs":case"sk":return 1==t?0:t>=2&&t<=4?1:2;case"ga":return 1==t?0:2==t?1:2;case"lt":return t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2;case"sl":return t%100==1?0:t%100==2?1:t%100==3||t%100==4?2:3;case"mk":return t%10==1?0:1;case"mt":return 1==t?0:0===t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3;case"lv":return 0===t?0:t%10==1&&t%100!=11?1:2;case"pl":return 1==t?0:t%10>=2&&t%10<=4&&(t%100<12||t%100>14)?1:2;case"cy":return 1==t?0:2==t?1:8==t||11==t?2:3;case"ro":return 1==t?0:0===t||t%100>0&&t%100<20?1:2;case"ar":return 0===t?0:1==t?1:2==t?2:t>=3&&t<=10?3:t>=11&&t<=99?4:5;default:return 0}}function exists(t,r){for(var i=0;i<t.length;i++)if(r===t[i])return!0;return!1}function get_current_locale(){return"undefined"!=typeof document?document.documentElement.lang.replace("-","_"):r}return h})?o.call(r,i,r,t):o)||(t.exports=a)},"./node_modules/file-saver/dist/FileSaver.min.js":function(t,r,i){(function(i){var o,a,l;a=[],void 0===(l="function"==typeof(o=function(){"use strict";function b(t,r){return void 0===r?r={autoBom:!1}:"object"!=typeof r&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function c(t,r,i){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){o(a.response,r,i)},a.onerror=function(){console.error("could not download file")},a.send()}function d(t){var r=new XMLHttpRequest;return r.open("HEAD",t,!1),r.send(),200<=r.status&&299>=r.status}function e(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(c){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,o=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(t,i,o){var a=r.URL||r.webkitURL,l=document.createElement("a");i=i||t.name||"download",l.download=i,l.rel="noopener","string"==typeof t?(l.href=t,l.origin===location.origin?e(l):d(l.href)?c(t,i,o):e(l,l.target="_blank")):(l.href=a.createObjectURL(t),setTimeout((function(){a.revokeObjectURL(l.href)}),4e4),setTimeout((function(){e(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,i){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(b(t,i),r);else if(d(t))c(t,r,i);else{var o=document.createElement("a");o.href=t,o.target="_blank",setTimeout((function(){e(o)}))}}:function(t,i,o,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof t)return c(t,i,o);var l="application/octet-stream"===t.type,h=/constructor/i.test(r.HTMLElement)||r.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||l&&h)&&"object"==typeof FileReader){var y=new FileReader;y.onloadend=function(){var t=y.result;t=g?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=t:location=t,a=null},y.readAsDataURL(t)}else{var _=r.URL||r.webkitURL,x=_.createObjectURL(t);a?a.location=x:location.href=x,a=null,setTimeout((function(){_.revokeObjectURL(x)}),4e4)}});r.saveAs=o.saveAs=o,t.exports=o})?o.apply(r,a):o)||(t.exports=l)}).call(this,i("./node_modules/webpack/buildin/global.js"))},"./node_modules/lodash-es/_Map.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_getNative.js"),a=i("./node_modules/lodash-es/_root.js"),l=Object(o.a)(a.default,"Map");r.a=l},"./node_modules/lodash-es/_Stack.js":function(t,r,i){"use strict";var o=function listCacheClear(){this.__data__=[],this.size=0},a=i("./node_modules/lodash-es/eq.js");var l=function assocIndexOf(t,r){for(var i=t.length;i--;)if(Object(a.a)(t[i][0],r))return i;return-1},h=Array.prototype.splice;var g=function listCacheDelete(t){var r=this.__data__,i=l(r,t);return!(i<0)&&(i==r.length-1?r.pop():h.call(r,i,1),--this.size,!0)};var y=function listCacheGet(t){var r=this.__data__,i=l(r,t);return i<0?void 0:r[i][1]};var _=function listCacheHas(t){return l(this.__data__,t)>-1};var x=function listCacheSet(t,r){var i=this.__data__,o=l(i,t);return o<0?(++this.size,i.push([t,r])):i[o][1]=r,this};function ListCache(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var o=t[r];this.set(o[0],o[1])}}ListCache.prototype.clear=o,ListCache.prototype.delete=g,ListCache.prototype.get=y,ListCache.prototype.has=_,ListCache.prototype.set=x;var w=ListCache;var S=function stackClear(){this.__data__=new w,this.size=0};var M=function stackDelete(t){var r=this.__data__,i=r.delete(t);return this.size=r.size,i};var T=function stackGet(t){return this.__data__.get(t)};var P=function stackHas(t){return this.__data__.has(t)},C=i("./node_modules/lodash-es/_Map.js"),A=i("./node_modules/lodash-es/_getNative.js"),O=Object(A.a)(Object,"create");var L=function hashClear(){this.__data__=O?O(null):{},this.size=0};var I=function hashDelete(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},R=Object.prototype.hasOwnProperty;var j=function hashGet(t){var r=this.__data__;if(O){var i=r[t];return"__lodash_hash_undefined__"===i?void 0:i}return R.call(r,t)?r[t]:void 0},N=Object.prototype.hasOwnProperty;var k=function hashHas(t){var r=this.__data__;return O?void 0!==r[t]:N.call(r,t)};var D=function hashSet(t,r){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=O&&void 0===r?"__lodash_hash_undefined__":r,this};function Hash(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var o=t[r];this.set(o[0],o[1])}}Hash.prototype.clear=L,Hash.prototype.delete=I,Hash.prototype.get=j,Hash.prototype.has=k,Hash.prototype.set=D;var B=Hash;var G=function mapCacheClear(){this.size=0,this.__data__={hash:new B,map:new(C.a||w),string:new B}};var H=function isKeyable(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var V=function getMapData(t,r){var i=t.__data__;return H(r)?i["string"==typeof r?"string":"hash"]:i.map};var U=function mapCacheDelete(t){var r=V(this,t).delete(t);return this.size-=r?1:0,r};var z=function mapCacheGet(t){return V(this,t).get(t)};var W=function mapCacheHas(t){return V(this,t).has(t)};var q=function mapCacheSet(t,r){var i=V(this,t),o=i.size;return i.set(t,r),this.size+=i.size==o?0:1,this};function MapCache(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var o=t[r];this.set(o[0],o[1])}}MapCache.prototype.clear=G,MapCache.prototype.delete=U,MapCache.prototype.get=z,MapCache.prototype.has=W,MapCache.prototype.set=q;var $=MapCache;var X=function stackSet(t,r){var i=this.__data__;if(i instanceof w){var o=i.__data__;if(!C.a||o.length<199)return o.push([t,r]),this.size=++i.size,this;i=this.__data__=new $(o)}return i.set(t,r),this.size=i.size,this};function Stack(t){var r=this.__data__=new w(t);this.size=r.size}Stack.prototype.clear=S,Stack.prototype.delete=M,Stack.prototype.get=T,Stack.prototype.has=P,Stack.prototype.set=X;r.a=Stack},"./node_modules/lodash-es/_Symbol.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/_Symbol.js")},"./node_modules/lodash-es/_arrayLikeKeys.js":function(t,r,i){"use strict";var o=function baseTimes(t,r){for(var i=-1,o=Array(t);++i<t;)o[i]=r(i);return o},a=i("./node_modules/lodash-es/isArguments.js"),l=i("./node_modules/lodash-es/isArray.js"),h=i("./node_modules/lodash-es/isBuffer.js"),g=i("./node_modules/lodash-es/_isIndex.js"),y=i("./node_modules/lodash-es/isTypedArray.js"),_=Object.prototype.hasOwnProperty;r.a=function arrayLikeKeys(t,r){var i=Object(l.a)(t),x=!i&&Object(a.a)(t),w=!i&&!x&&Object(h.a)(t),S=!i&&!x&&!w&&Object(y.a)(t),M=i||x||w||S,T=M?o(t.length,String):[],P=T.length;for(var C in t)!r&&!_.call(t,C)||M&&("length"==C||w&&("offset"==C||"parent"==C)||S&&("buffer"==C||"byteLength"==C||"byteOffset"==C)||Object(g.a)(C,P))||T.push(C);return T}},"./node_modules/lodash-es/_assignValue.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_baseAssignValue.js"),a=i("./node_modules/lodash-es/eq.js"),l=Object.prototype.hasOwnProperty;r.a=function assignValue(t,r,i){var h=t[r];l.call(t,r)&&Object(a.a)(h,i)&&(void 0!==i||r in t)||Object(o.a)(t,r,i)}},"./node_modules/lodash-es/_baseAssignValue.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_defineProperty.js");r.a=function baseAssignValue(t,r,i){"__proto__"==r&&o.a?Object(o.a)(t,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[r]=i}},"./node_modules/lodash-es/_baseFor.js":function(t,r,i){"use strict";var o=function createBaseFor(t){return function(r,i,o){for(var a=-1,l=Object(r),h=o(r),g=h.length;g--;){var y=h[t?g:++a];if(!1===i(l[y],y,l))break}return r}}();r.a=o},"./node_modules/lodash-es/_baseForOwn.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_baseFor.js"),a=i("./node_modules/lodash-es/keys.js");r.a=function baseForOwn(t,r){return t&&Object(o.a)(t,r,a.a)}},"./node_modules/lodash-es/_baseGetTag.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/_baseGetTag.js")},"./node_modules/lodash-es/_baseUnary.js":function(t,r,i){"use strict";r.a=function baseUnary(t){return function(r){return t(r)}}},"./node_modules/lodash-es/_castFunction.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/identity.js");r.a=function castFunction(t){return"function"==typeof t?t:o.a}},"./node_modules/lodash-es/_cloneArrayBuffer.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_root.js").default.Uint8Array;r.a=function cloneArrayBuffer(t){var r=new t.constructor(t.byteLength);return new o(r).set(new o(t)),r}},"./node_modules/lodash-es/_cloneBuffer.js":function(t,r,i){"use strict";(function(t){var o=i("./node_modules/lodash-es/_root.js"),a="object"==typeof exports&&exports&&!exports.nodeType&&exports,l=a&&"object"==typeof t&&t&&!t.nodeType&&t,h=l&&l.exports===a?o.default.Buffer:void 0,g=h?h.allocUnsafe:void 0;r.a=function cloneBuffer(t,r){if(r)return t.slice();var i=t.length,o=g?g(i):new t.constructor(i);return t.copy(o),o}}).call(this,i("./node_modules/webpack/buildin/harmony-module.js")(t))},"./node_modules/lodash-es/_cloneTypedArray.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_cloneArrayBuffer.js");r.a=function cloneTypedArray(t,r){var i=r?Object(o.a)(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}},"./node_modules/lodash-es/_copyArray.js":function(t,r,i){"use strict";r.a=function copyArray(t,r){var i=-1,o=t.length;for(r||(r=Array(o));++i<o;)r[i]=t[i];return r}},"./node_modules/lodash-es/_copyObject.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_assignValue.js"),a=i("./node_modules/lodash-es/_baseAssignValue.js");r.a=function copyObject(t,r,i,l){var h=!i;i||(i={});for(var g=-1,y=r.length;++g<y;){var _=r[g],x=l?l(i[_],t[_],_,i,t):void 0;void 0===x&&(x=t[_]),h?Object(a.a)(i,_,x):Object(o.a)(i,_,x)}return i}},"./node_modules/lodash-es/_defineProperty.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_getNative.js"),a=function(){try{var t=Object(o.a)(Object,"defineProperty");return t({},"",{}),t}catch(r){}}();r.a=a},"./node_modules/lodash-es/_freeGlobal.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/_freeGlobal.js")},"./node_modules/lodash-es/_getNative.js":function(t,r,i){"use strict";var o,a=i("./node_modules/lodash-es/isFunction.js"),l=i("./node_modules/lodash-es/_root.js").default["__core-js_shared__"],h=(o=/[^.]+$/.exec(l&&l.keys&&l.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";var g=function isMasked(t){return!!h&&h in t},y=i("./node_modules/lodash-es/isObject.js"),_=i("./node_modules/lodash-es/_toSource.js"),x=/^\[object .+?Constructor\]$/,w=Function.prototype,S=Object.prototype,M=w.toString,T=S.hasOwnProperty,P=RegExp("^"+M.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var C=function baseIsNative(t){return!(!Object(y.default)(t)||g(t))&&(Object(a.a)(t)?P:x).test(Object(_.a)(t))};var A=function getValue(t,r){return null==t?void 0:t[r]};r.a=function getNative(t,r){var i=A(t,r);return C(i)?i:void 0}},"./node_modules/lodash-es/_getPrototype.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_overArg.js"),a=Object(o.a)(Object.getPrototypeOf,Object);r.a=a},"./node_modules/lodash-es/_initCloneObject.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/isObject.js"),a=Object.create,l=function(){function object(){}return function(t){if(!Object(o.default)(t))return{};if(a)return a(t);object.prototype=t;var r=new object;return object.prototype=void 0,r}}(),h=i("./node_modules/lodash-es/_getPrototype.js"),g=i("./node_modules/lodash-es/_isPrototype.js");r.a=function initCloneObject(t){return"function"!=typeof t.constructor||Object(g.a)(t)?{}:l(Object(h.a)(t))}},"./node_modules/lodash-es/_isIndex.js":function(t,r,i){"use strict";var o=/^(?:0|[1-9]\d*)$/;r.a=function isIndex(t,r){var i=typeof t;return!!(r=null==r?9007199254740991:r)&&("number"==i||"symbol"!=i&&o.test(t))&&t>-1&&t%1==0&&t<r}},"./node_modules/lodash-es/_isPrototype.js":function(t,r,i){"use strict";var o=Object.prototype;r.a=function isPrototype(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||o)}},"./node_modules/lodash-es/_nodeUtil.js":function(t,r,i){"use strict";(function(t){var o=i("./node_modules/lodash-es/_freeGlobal.js"),a="object"==typeof exports&&exports&&!exports.nodeType&&exports,l=a&&"object"==typeof t&&t&&!t.nodeType&&t,h=l&&l.exports===a&&o.default.process,g=function(){try{var t=l&&l.require&&l.require("util").types;return t||h&&h.binding&&h.binding("util")}catch(r){}}();r.a=g}).call(this,i("./node_modules/webpack/buildin/harmony-module.js")(t))},"./node_modules/lodash-es/_overArg.js":function(t,r,i){"use strict";r.a=function overArg(t,r){return function(i){return t(r(i))}}},"./node_modules/lodash-es/_root.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/_root.js")},"./node_modules/lodash-es/_toSource.js":function(t,r,i){"use strict";var o=Function.prototype.toString;r.a=function toSource(t){if(null!=t){try{return o.call(t)}catch(r){}try{return t+""}catch(r){}}return""}},"./node_modules/lodash-es/eq.js":function(t,r,i){"use strict";r.a=function eq(t,r){return t===r||t!=t&&r!=r}},"./node_modules/lodash-es/identity.js":function(t,r,i){"use strict";r.a=function identity(t){return t}},"./node_modules/lodash-es/isArguments.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_baseGetTag.js"),a=i("./node_modules/lodash-es/isObjectLike.js");var l=function baseIsArguments(t){return Object(a.default)(t)&&"[object Arguments]"==Object(o.default)(t)},h=Object.prototype,g=h.hasOwnProperty,y=h.propertyIsEnumerable,_=l(function(){return arguments}())?l:function(t){return Object(a.default)(t)&&g.call(t,"callee")&&!y.call(t,"callee")};r.a=_},"./node_modules/lodash-es/isArray.js":function(t,r,i){"use strict";var o=Array.isArray;r.a=o},"./node_modules/lodash-es/isArrayLike.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/isFunction.js"),a=i("./node_modules/lodash-es/isLength.js");r.a=function isArrayLike(t){return null!=t&&Object(a.a)(t.length)&&!Object(o.a)(t)}},"./node_modules/lodash-es/isBuffer.js":function(t,r,i){"use strict";(function(t){var o=i("./node_modules/lodash-es/_root.js"),a=i("./node_modules/lodash-es/stubFalse.js"),l="object"==typeof exports&&exports&&!exports.nodeType&&exports,h=l&&"object"==typeof t&&t&&!t.nodeType&&t,g=h&&h.exports===l?o.default.Buffer:void 0,y=(g?g.isBuffer:void 0)||a.a;r.a=y}).call(this,i("./node_modules/webpack/buildin/harmony-module.js")(t))},"./node_modules/lodash-es/isFunction.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_baseGetTag.js"),a=i("./node_modules/lodash-es/isObject.js");r.a=function isFunction(t){if(!Object(a.default)(t))return!1;var r=Object(o.default)(t);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r}},"./node_modules/lodash-es/isLength.js":function(t,r,i){"use strict";r.a=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},"./node_modules/lodash-es/isObject.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/isObject.js")},"./node_modules/lodash-es/isObjectLike.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/isObjectLike.js")},"./node_modules/lodash-es/isSymbol.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/lodash-es/isSymbol.js")},"./node_modules/lodash-es/isTypedArray.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_baseGetTag.js"),a=i("./node_modules/lodash-es/isLength.js"),l=i("./node_modules/lodash-es/isObjectLike.js"),h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Arguments]"]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object Boolean]"]=h["[object DataView]"]=h["[object Date]"]=h["[object Error]"]=h["[object Function]"]=h["[object Map]"]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h["[object Set]"]=h["[object String]"]=h["[object WeakMap]"]=!1;var g=function baseIsTypedArray(t){return Object(l.default)(t)&&Object(a.a)(t.length)&&!!h[Object(o.default)(t)]},y=i("./node_modules/lodash-es/_baseUnary.js"),_=i("./node_modules/lodash-es/_nodeUtil.js"),x=_.a&&_.a.isTypedArray,w=x?Object(y.a)(x):g;r.a=w},"./node_modules/lodash-es/keys.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_arrayLikeKeys.js"),a=i("./node_modules/lodash-es/_isPrototype.js"),l=i("./node_modules/lodash-es/_overArg.js"),h=Object(l.a)(Object.keys,Object),g=Object.prototype.hasOwnProperty;var y=function baseKeys(t){if(!Object(a.a)(t))return h(t);var r=[];for(var i in Object(t))g.call(t,i)&&"constructor"!=i&&r.push(i);return r},_=i("./node_modules/lodash-es/isArrayLike.js");r.a=function keys(t){return Object(_.a)(t)?Object(o.a)(t):y(t)}},"./node_modules/lodash-es/keysIn.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_arrayLikeKeys.js"),a=i("./node_modules/lodash-es/isObject.js"),l=i("./node_modules/lodash-es/_isPrototype.js");var h=function nativeKeysIn(t){var r=[];if(null!=t)for(var i in Object(t))r.push(i);return r},g=Object.prototype.hasOwnProperty;var y=function baseKeysIn(t){if(!Object(a.default)(t))return h(t);var r=Object(l.a)(t),i=[];for(var o in t)("constructor"!=o||!r&&g.call(t,o))&&i.push(o);return i},_=i("./node_modules/lodash-es/isArrayLike.js");r.a=function keysIn(t){return Object(_.a)(t)?Object(o.a)(t,!0):y(t)}},"./node_modules/lodash-es/stubFalse.js":function(t,r,i){"use strict";r.a=function stubFalse(){return!1}},"./node_modules/regenerator-runtime/runtime.js":function(t,r,i){var o=function(t){"use strict";var r,i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",g=a.toStringTag||"@@toStringTag";function define(t,r,i){return Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(A){define=function(t,r,i){return t[r]=i}}function wrap(t,r,i,o){var a=r&&r.prototype instanceof Generator?r:Generator,l=Object.create(a.prototype),h=new Context(o||[]);return l._invoke=function makeInvokeMethod(t,r,i){var o=y;return function invoke(a,l){if(o===x)throw new Error("Generator is already running");if(o===w){if("throw"===a)throw l;return doneResult()}for(i.method=a,i.arg=l;;){var h=i.delegate;if(h){var g=maybeInvokeDelegate(h,i);if(g){if(g===S)continue;return g}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===y)throw o=w,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=x;var M=tryCatch(t,r,i);if("normal"===M.type){if(o=i.done?w:_,M.arg===S)continue;return{value:M.arg,done:i.done}}"throw"===M.type&&(o=w,i.method="throw",i.arg=M.arg)}}}(t,i,h),l}function tryCatch(t,r,i){try{return{type:"normal",arg:t.call(r,i)}}catch(A){return{type:"throw",arg:A}}}t.wrap=wrap;var y="suspendedStart",_="suspendedYield",x="executing",w="completed",S={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var M={};M[l]=function(){return this};var T=Object.getPrototypeOf,P=T&&T(T(values([])));P&&P!==i&&o.call(P,l)&&(M=P);var C=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(M);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(i,a,l,h){var g=tryCatch(t[i],t,a);if("throw"!==g.type){var y=g.arg,_=y.value;return _&&"object"==typeof _&&o.call(_,"__await")?r.resolve(_.__await).then((function(t){invoke("next",t,l,h)}),(function(t){invoke("throw",t,l,h)})):r.resolve(_).then((function(t){y.value=t,l(y)}),(function(t){return invoke("throw",t,l,h)}))}h(g.arg)}var i;this._invoke=function enqueue(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,i){invoke(t,o,r,i)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,i){var o=t.iterator[i.method];if(o===r){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=r,maybeInvokeDelegate(t,i),"throw"===i.method))return S;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var a=tryCatch(o,t.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,S;var l=a.arg;return l?l.done?(i[t.resultName]=l.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=r),i.delegate=null,S):l:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,S)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var i=t[l];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,h=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=r,next.done=!0,next};return h.next=h}}return{next:doneResult}}function doneResult(){return{value:r,done:!0}}return GeneratorFunction.prototype=C.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName=define(GeneratorFunctionPrototype,g,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,g,"GeneratorFunction")),t.prototype=Object.create(C),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[h]=function(){return this},t.AsyncIterator=AsyncIterator,t.async=function(r,i,o,a,l){void 0===l&&(l=Promise);var h=new AsyncIterator(wrap(r,i,o,a),l);return t.isGeneratorFunction(i)?h:h.next().then((function(t){return t.done?t.value:h.next()}))},defineIteratorMethods(C),define(C,g,"Generator"),C[l]=function(){return this},C.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var i in t)r.push(i);return r.reverse(),function next(){for(;r.length;){var i=r.pop();if(i in t)return next.value=i,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(resetTryEntry),!t)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function handle(o,a){return h.type="throw",h.arg=t,i.next=o,a&&(i.method="next",i.arg=r),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var l=this.tryEntries[a],h=l.completion;if("root"===l.tryLoc)return handle("end");if(l.tryLoc<=this.prev){var g=o.call(l,"catchLoc"),y=o.call(l,"finallyLoc");if(g&&y){if(this.prev<l.catchLoc)return handle(l.catchLoc,!0);if(this.prev<l.finallyLoc)return handle(l.finallyLoc)}else if(g){if(this.prev<l.catchLoc)return handle(l.catchLoc,!0)}else{if(!y)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return handle(l.finallyLoc)}}}},abrupt:function(t,r){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var l=a;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var h=l?l.completion:{};return h.type=t,h.arg=r,l?(this.method="next",this.next=l.finallyLoc,S):this.complete(h)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),S},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),resetTryEntry(i),S}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc===t){var o=i.completion;if("throw"===o.type){var a=o.arg;resetTryEntry(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,o){return this.delegate={iterator:values(t),resultName:i,nextLoc:o},"next"===this.method&&(this.arg=r),S}},t}(t.exports);try{regeneratorRuntime=o}catch(a){Function("r","regeneratorRuntime = r")(o)}},"./node_modules/tiny-emitter/index.js":function(t,r){function E(){}E.prototype={on:function(t,r,i){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:r,ctx:i}),this},once:function(t,r,i){var o=this;function listener(){o.off(t,listener),r.apply(i,arguments)}return listener._=r,this.on(t,listener,i)},emit:function(t){for(var r=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),o=0,a=i.length;o<a;o++)i[o].fn.apply(i[o].ctx,r);return this},off:function(t,r){var i=this.e||(this.e={}),o=i[t],a=[];if(o&&r)for(var l=0,h=o.length;l<h;l++)o[l].fn!==r&&o[l].fn._!==r&&a.push(o[l]);return a.length?i[t]=a:delete i[t],this}},t.exports=E,t.exports.TinyEmitter=E},"./node_modules/vue-loader/lib/runtime/componentNormalizer.js":function(t,r,i){"use strict";function normalizeComponent(t,r,i,o,a,l,h,g){var y,_="function"==typeof t?t.options:t;if(r&&(_.render=r,_.staticRenderFns=i,_._compiled=!0),o&&(_.functional=!0),l&&(_._scopeId="data-v-"+l),h?(y=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(h)},_._ssrRegister=y):a&&(y=g?function(){a.call(this,(_.functional?this.parent:this).$root.$options.shadowRoot)}:a),y)if(_.functional){_._injectStyles=y;var x=_.render;_.render=function renderWithStyleInjection(t,r){return y.call(r),x(t,r)}}else{var w=_.beforeCreate;_.beforeCreate=w?[].concat(w,y):[y]}return{exports:t,options:_}}i.d(r,"a",(function(){return normalizeComponent}))},"./node_modules/vue/dist/vue.esm.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/vue/dist/vue.esm.js")},"./node_modules/vuex/dist/vuex.esm.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./node_modules/vuex/dist/vuex.esm.js")},"./node_modules/webpack/buildin/global.js":function(t,r,i){t.exports=i("dll-reference amplitudeDLL")("./node_modules/webpack/buildin/global.js")},"./node_modules/webpack/buildin/harmony-module.js":function(t,r){t.exports=function(t){if(!t.webpackPolyfill){var r=Object.create(t);r.children||(r.children=[]),Object.defineProperty(r,"loaded",{enumerable:!0,get:function(){return r.l}}),Object.defineProperty(r,"id",{enumerable:!0,get:function(){return r.i}}),Object.defineProperty(r,"exports",{enumerable:!0}),r.webpackPolyfill=1}return r}},"./ui/components/board/board-tab-item-underlined.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/board-tab-item-underlined.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/share-menu-share-link.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu-share-link.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/share-menu-tab-selector.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu-tab-selector.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/share-menu.vue":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./web/core/api/diagram-editor/helpers.js"),h=i("./web/core/api/board/share-menu/config.js"),g=i("./web/core/api/diagram-editor/service.js"),y=i("./web/core/api/board/helper/index.js"),_=i("./utils/http/handle-error.js"),x=i("./ui/components/icons/icon-font.vue"),w=i("./ui/components/modals/modal-content.vue"),S=i("./ui/components/modals/modal-container.vue"),M=i("./core/utils/dom/copy-to-clipboard.js"),T=i("./ui/components/forms/form-input.vue"),P={name:"ShareLink",components:{FormInput:T.a,IconFont:x.a},props:{shareUrl:{type:String,required:!0}},data:function data(){return{showCopiedMessage:!1}},methods:{copyLink:function copyLink(){var t=this;Object(M.a)(this.shareUrl),this.showCopiedMessage=!0,setTimeout((function(){t.showCopiedMessage=!1}),1500)}}},C=i("./ui/components/board/share-menu/share-menu-share-link.vue?vue&type=style&index=0&lang=scss&module=true&"),A=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var O=Object(A.a)(P,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("icon-font",{class:t.$style.icon,attrs:{theme:"primary",name:"link"}}),t._v(" "),i("form-input",{ref:"link",class:t.$style.input,attrs:{"light-mode":!0,readonly:!0,value:t.shareUrl},on:{focus:function(t){return t.target.select()}}}),t._v(" "),i("button",{class:t.$style.action,attrs:{type:"button","aria-label":t.$trans("Copy to Clipboard!")},on:{click:t.copyLink}},[i("icon-font",{class:t.$style.icon,attrs:{theme:"primary",name:"copy"}})],1),t._v(" "),i("transition",{attrs:{name:t.$style.message}},[t.showCopiedMessage?i("div",{class:t.$style.message,domProps:{textContent:t._s(t.$trans("Copied to Clipboard!"))}}):t._e()])],1)}),[],!1,(function injectStyles(t){this.$style=C.default.locals||C.default}),null,null).exports,L=i("./ui/components/social/social-share.vue"),I=i("./ui/components/forms/form-select.vue"),R=i("./ui/components/tinymce/tinymce.vue"),j={name:"TabEmbed",components:{FormInput:T.a,FormSelect:I.a,TinyMce:R.a},props:{diagramOptions:{type:Object,required:!0}},emits:["update-diagram-option"],data:function data(){return{editorOptions:Object.freeze({height:210,resize:!1,toolbar:!1})}},computed:{controls:function controls(){var t=this;return[{action:function action(r){return t.$emit("update-diagram-option",{key:"currentBoardStyle",val:r})},id:"board",label:this.$trans("Board"),options:this.diagramOptions.boardColors,value:this.diagramOptions.currentBoardStyle},{action:function action(r){return t.$emit("update-diagram-option",{key:"currentPieceStyle",val:r})},id:"pieces",label:this.$trans("Pieces"),options:this.diagramOptions.pieceStyles,value:this.diagramOptions.currentPieceStyle}]},diagramCode:function diagramCode(){return"[gid=".concat(this.diagramOptions.diagramId,"]")},diagramEmbed:function diagramEmbed(){var t=window.location.host,r="//".concat(t,"/emboard?id=").concat(this.diagramOptions.diagramId),i='<script>window.addEventListener("message",e=>{e[\'data\']&&"'.concat(this.diagramOptions.diagramId,"\"===e['data']['id']&&document.getElementById(`${e['data']['id']}`)&&(document.getElementById(`${e['data']['id']}`).style.height=`${e['data']['frameHeight']+30}px`)});<\/script>");return'<iframe id="'.concat(this.diagramOptions.diagramId,'" ').concat('allowtransparency="true" frameborder="0" style="width:100%;border:none;"',' src="').concat(r,'"></iframe>').concat(i)},toggles:function toggles(){var t=this;return[{action:function action(r){return t.$emit("update-diagram-option",{key:"coordinates",val:r.target.checked})},checked:Boolean(this.diagramOptions.coordinates),key:"coordinates",label:this.$trans("Coordinates"),show:!0},{action:function action(r){return t.$emit("update-diagram-option",{key:"isPuzzle",val:r.target.checked})},checked:this.diagramOptions.isPuzzle,key:"puzzle",label:this.$trans("Puzzle"),show:!0},{action:function action(r){return t.$emit("update-diagram-option",{key:"isMultiGame",val:r.target.checked})},checked:this.diagramOptions.isMultiGame,key:"isMultiGame",label:this.$trans("Multi PGN viewer"),show:this.diagramOptions.numberOfGames>1}]}}},N=i("./ui/components/board/share-menu/tabs/share-menu-tab-embed.vue?vue&type=style&index=0&lang=scss&module=true&");var k=Object(A.a)(j,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[t.diagramOptions.diagramId?i("section",{class:t.$style.section},[i("label",{class:t.$style.heading,attrs:{for:"embed"}},[t._v("\n      "+t._s(t.$trans("Embed"))+"\n    ")]),t._v(" "),i("form-input",{attrs:{id:"embed",disabled:!0,"light-mode":!0,readonly:!0,value:t.diagramEmbed}})],1):t._e(),t._v(" "),i("section",{class:t.$style.section,domProps:{textContent:t._s(t.$trans("To display the diagram, copy/paste the image OR code below into a post on Chess.com."))}}),t._v(" "),i("section",{class:[t.$style.section,t.$style.flex]},[i("div",{class:t.$style.half},[t.diagramOptions.diagramImage?i("div",{class:t.$style.editor},[i("tiny-mce",{attrs:{theme:"analysis","custom-config":t.editorOptions,"init-value":t.diagramOptions.diagramImage}})],1):t._e()]),t._v(" "),i("div",{class:t.$style.half},[i("div",{class:t.$style.code},[t.diagramOptions.diagramId?i("form-input",{attrs:{"light-mode":!0,disabled:!0,readonly:!0,value:t.diagramCode}}):t._e()],1),t._v(" "),t._l(t.controls,(function(r){return i("div",{key:r.label,class:t.$style.controls},[i("label",{class:t.$style.label,attrs:{for:r.id}},[t._v("\n          "+t._s(r.label)+"\n        ")]),t._v(" "),i("form-select",{class:t.$style.input,attrs:{id:r.id,"label-key":"name","light-mode":"","value-key":"code",options:r.options,value:r.value},on:{input:r.action}})],1)})),t._v(" "),i("div",{class:t.$style.toggles},t._l(t.toggles,(function(r){return i("div",{key:r.key,class:t.$style.toggle},[r.show?i("div",[i("input",{attrs:{id:r.key,type:"checkbox","light-mode":!0},domProps:{checked:r.checked},on:{change:r.action}}),t._v(" "),i("label",{attrs:{for:r.key},domProps:{textContent:t._s(r.label)}})]):t._e()])})),0)],2)])])}),[],!1,(function share_menu_tab_embed_injectStyles(t){this.$style=N.default.locals||N.default}),null,null).exports,D=i("./utils/download-as-file.js"),B=i("./utils/http/index.js"),G={name:"TabEvent",components:{FormButton:i("./ui/components/forms/form-button.vue").a,FormInput:T.a,IconFont:x.a},props:{eventFilename:{type:String},eventUrl:{type:String}},methods:{downloadEvent:function downloadEvent(){var t=this;this.eventUrl&&function getEventPgn(t){return B.default.get(t)}(this.eventUrl).then((function(r){t.download(r.data,t.eventFilename)})).catch((function(r){t.download(r,t.eventFilename)}))},download:function download(t,r){Object(D.a)(t,r)}}},H=i("./ui/components/board/share-menu/tabs/share-menu-tab-event.vue?vue&type=style&index=0&lang=scss&module=true&");var V=Object(A.a)(G,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{class:t.$style.section},[i("div",{class:t.$style.heading,domProps:{textContent:t._s("URL")}}),t._v(" "),i("form-input",{class:t.$style.input,attrs:{readonly:!0,value:t.eventUrl},on:{focus:function(t){return t.target.select()}}})],1),t._v(" "),i("div",{class:t.$style.section},[i("div",{class:t.$style.heading,domProps:{textContent:t._s("Download")}}),t._v(" "),i("div",{class:t.$style.download},[i("form-button",{class:t.$style.button,attrs:{size:"large",theme:"primary"},on:{click:t.downloadEvent}},[i("icon-font",{class:t.$style.icon,attrs:{family:"chess",name:"download",theme:"secondary"}})],1)],1)])])}),[],!1,(function share_menu_tab_event_injectStyles(t){this.$style=H.default.locals||H.default}),null,null).exports,U=i("./node_modules/file-saver/dist/FileSaver.min.js"),z=i("./node_modules/@chesscom/web-ui/dist/ui/vue/index.js"),W={name:"TabGif",components:{LoaderThreeBounce:i("./ui/components/loaders/loader-three-bounce.vue").a,V5Button:z.V5Button},props:{gifUrl:{type:String,default:null},isLoadingGif:{type:Boolean,default:!1}},methods:{download:function download(){Object(U.saveAs)(this.gifUrl,"board.gif")}}},q=i("./ui/components/board/share-menu/tabs/share-menu-tab-gif.vue?vue&type=style&index=0&lang=scss&module=true&");var $=Object(A.a)(W,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[t.isLoadingGif?i("div",{class:t.$style.square},[i("loader-three-bounce",{attrs:{"is-circle":!0,size:50}})],1):i("img",{class:t.$style.gif,attrs:{src:t.gifUrl}}),t._v(" "),i("v5-button",{class:t.$style.button,attrs:{size:"small",theme:"primary",disabled:t.isLoadingGif},domProps:{textContent:t._s(t.$trans("Download"))},on:{click:t.download}})],1)}),[],!1,(function share_menu_tab_gif_injectStyles(t){this.$style=q.default.locals||q.default}),null,null).exports,X=i("./web/core/api/board/config.js"),K={name:"TabImage",components:{V5Button:z.V5Button},props:{boardOptions:{type:Object,default:function _default(){return{}}},fen:{type:String,required:!0}},data:function data(){return{boardStyle:this.boardOptions.boardStyle||X.f.boardStyle,flipped:this.boardOptions.flipBoard||X.f.flipped,pieceStyle:this.boardOptions.pieceStyle||X.f.pieceStyle}},computed:{dynamicBoardUrl:function dynamicBoardUrl(){var t=this.flipped?"&flip=true":"";return"/dynboard?fen=".concat(this.fen,"&board=").concat(this.boardStyle,"&piece=").concat(this.pieceStyle,"&size=3").concat(t)}}},Y=i("./ui/components/board/share-menu/tabs/share-menu-tab-image.vue?vue&type=style&index=0&lang=scss&module=true&");var Z=Object(A.a)(K,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("img",{class:t.$style.image,attrs:{src:t.dynamicBoardUrl}}),t._v(" "),i("a",{attrs:{target:"_blank",href:t.dynamicBoardUrl,download:"board.jpeg"}},[i("v5-button",{class:t.$style.button,attrs:{size:"small",theme:"primary"},domProps:{textContent:t._s(t.$trans("Download"))}})],1)])}),[],!1,(function share_menu_tab_image_injectStyles(t){this.$style=Y.default.locals||Y.default}),null,null).exports,Q=i("./utils/game/get-pgn-with-opts.ts"),J=i("./chessboard/src/game/move-node/helper.js"),ee=i("./core/utils/features/constants.js"),te=i("./node_modules/@chesscom/chessboard/dist/chessboard/chessboard.js"),ne=i("./core/utils/features/index.js"),re=i("./ui/components/forms/form-textarea.vue"),ie={name:"TabPgn",components:{FormInput:T.a,FormTextarea:re.a,V5Button:z.V5Button},props:{analyzedPgn:{type:String},fen:{type:String,required:!0},hasTimestamps:{type:Boolean},pgn:{type:String,required:!0},pgnHeaders:{type:Object,default:function _default(){return{}}}},setup:function setup(){return{checkboxModel:Q.a,checkboxUi:Q.b,setCheckboxModel:Q.d,setCheckboxUi:Q.e}},computed:{displayedPgn:function displayedPgn(){var t=this.analyzedPgn&&this.checkboxModel.isAnalyzedPgnEnabled?this.analyzedPgn:this.pgn,r=Object(ne.a)(ee.a.PGN_ANNOTATIONS),i="function"==typeof te.getPGNForDownload;return r&&i?Object(te.getPGNForDownload)(t):t},filename:function filename(){return function getPgnDownloadName(t){var r="pgn_data.pgn";return t&&t.White&&t.Black&&(r="".concat(t.White,"_vs_").concat(t.Black,".pgn"),t.Date&&(r="".concat(t.White,"_vs_").concat(t.Black,"_").concat(t.Date,".pgn"))),r}(this.pgnHeaders)},sanitizedPgn:function sanitizedPgn(){return Object(J.d)(this.pgn)},hasTimestampsInUserPgn:function hasTimestampsInUserPgn(){return this.hasTimestamps&&!this.checkboxModel.isAnalyzedPgnEnabled}},mounted:function mounted(){this.showAnalyzedPgnCheckbox(this.analyzedPgn)},methods:{download:function download(){Object(D.a)(this.displayedPgn,this.filename)},onAnalyzedPgnEnabledChange:function onAnalyzedPgnEnabledChange(t){this.setCheckboxModel({isAnalyzedPgnEnabled:t})},onCommentsEnabledChange:function onCommentsEnabledChange(t){this.setCheckboxModel({isCommentsEnabled:t.target.checked})},onHighlightsEnabledChange:function onHighlightsEnabledChange(t){this.setCheckboxModel({isHighlightsEnabled:t.target.checked})},onTimestampsEnabledChange:function onTimestampsEnabledChange(t){this.setCheckboxModel({isTimestampsEnabled:t.target.checked})},showAnalyzedPgnCheckbox:function showAnalyzedPgnCheckbox(t){this.setCheckboxUi({isAnalyzedPgnCheckboxVisible:Boolean(t)}),this.setCheckboxModel({isAnalyzedPgnEnabled:Boolean(t)})}},wach:{analyzedPgn:"showAnalyzedPgnCheckbox"}},oe=i("./ui/components/board/share-menu/tabs/share-menu-tab-pgn.vue?vue&type=style&index=0&lang=scss&module=true&");var ae=Object(A.a)(ie,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{class:t.$style.section},[i("div",{class:t.$style.heading,domProps:{textContent:t._s("FEN")}}),t._v(" "),i("form-input",{class:t.$style.input,attrs:{readonly:!0,"light-mode":!0,value:t.fen},on:{focus:function(t){return t.target.select()}}})],1),t._v(" "),i("div",{class:t.$style.section},[i("div",{class:t.$style.pgn},[i("div",{class:t.$style.heading,domProps:{textContent:t._s("PGN")}}),t._v(" "),i("div",{class:t.$style.toggles},[t.checkboxUi.isHighlightsCheckboxVisible?i("label",{class:t.$style.toggle,attrs:{title:t.$trans("Highlights")}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkboxModel.isHighlightsEnabled,expression:"checkboxModel.isHighlightsEnabled"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.checkboxModel.isHighlightsEnabled)?t._i(t.checkboxModel.isHighlightsEnabled,null)>-1:t.checkboxModel.isHighlightsEnabled},on:{change:[function(r){var i=t.checkboxModel.isHighlightsEnabled,o=r.target,a=!!o.checked;if(Array.isArray(i)){var l=t._i(i,null);o.checked?l<0&&t.$set(t.checkboxModel,"isHighlightsEnabled",i.concat([null])):l>-1&&t.$set(t.checkboxModel,"isHighlightsEnabled",i.slice(0,l).concat(i.slice(l+1)))}else t.$set(t.checkboxModel,"isHighlightsEnabled",a)},t.onHighlightsEnabledChange]}}),t._v(" "),i("span",{class:["board-arrow","icon-font-chess",t.$style.icon]})]):t._e(),t._v(" "),t.checkboxUi.isCommentsCheckboxVisible?i("label",{class:t.$style.toggle,attrs:{title:"Comments"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkboxModel.isCommentsEnabled,expression:"checkboxModel.isCommentsEnabled"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.checkboxModel.isCommentsEnabled)?t._i(t.checkboxModel.isCommentsEnabled,null)>-1:t.checkboxModel.isCommentsEnabled},on:{change:[function(r){var i=t.checkboxModel.isCommentsEnabled,o=r.target,a=!!o.checked;if(Array.isArray(i)){var l=t._i(i,null);o.checked?l<0&&t.$set(t.checkboxModel,"isCommentsEnabled",i.concat([null])):l>-1&&t.$set(t.checkboxModel,"isCommentsEnabled",i.slice(0,l).concat(i.slice(l+1)))}else t.$set(t.checkboxModel,"isCommentsEnabled",a)},t.onCommentsEnabledChange]}}),t._v(" "),i("span",{class:["icon-font-chess","chat",t.$style.icon]})]):t._e(),t._v(" "),t.checkboxUi.isAnalyzedPgnCheckboxVisible?i("label",{class:t.$style.toggle,attrs:{title:t.$trans("Annotation")}},[i("input",{attrs:{type:"radio",name:"isComputerAnalysisEnabled"},domProps:{checked:!t.checkboxModel.isAnalyzedPgnEnabled},on:{change:function(r){return t.onAnalyzedPgnEnabledChange(!1)}}}),t._v(" "),i("span",{class:["user","icon-font-chess",t.$style.icon]})]):t._e(),t._v(" "),t.checkboxUi.isAnalyzedPgnCheckboxVisible?i("label",{class:t.$style.toggle,attrs:{title:t.$trans("Computer Analysis")}},[i("input",{attrs:{type:"radio",name:"isComputerAnalysisEnabled"},domProps:{checked:t.checkboxModel.isAnalyzedPgnEnabled},on:{change:function(r){return t.onAnalyzedPgnEnabledChange(!0)}}}),t._v(" "),i("span",{class:["comp-analysis","icon-font-chess",t.$style.icon]})]):t._e(),t._v(" "),t.hasTimestamps?i("label",{class:t.$style.toggle,attrs:{title:t.$trans("PGN Timestamps")}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.checkboxModel.isTimestampsEnabled,expression:"checkboxModel.isTimestampsEnabled"}],attrs:{disabled:!t.hasTimestampsInUserPgn,type:"checkbox"},domProps:{checked:Array.isArray(t.checkboxModel.isTimestampsEnabled)?t._i(t.checkboxModel.isTimestampsEnabled,null)>-1:t.checkboxModel.isTimestampsEnabled},on:{change:[function(r){var i=t.checkboxModel.isTimestampsEnabled,o=r.target,a=!!o.checked;if(Array.isArray(i)){var l=t._i(i,null);o.checked?l<0&&t.$set(t.checkboxModel,"isTimestampsEnabled",i.concat([null])):l>-1&&t.$set(t.checkboxModel,"isTimestampsEnabled",i.slice(0,l).concat(i.slice(l+1)))}else t.$set(t.checkboxModel,"isTimestampsEnabled",a)},t.onTimestampsEnabledChange]}}),t._v(" "),i("span",{class:["circle-clock","icon-font-chess",t.$style.icon]})]):t._e()])]),t._v(" "),i("form-textarea",{class:t.$style.textarea,attrs:{name:"pgn","light-mode":!0,readonly:!0,value:t.displayedPgn},on:{focus:function(t){return t.target.select()}}})],1),t._v(" "),i("div",{class:t.$style.download},[i("v5-button",{class:t.$style.button,attrs:{size:"small",theme:"primary"},on:{click:t.download}},[i("span",{class:["icon-font-chess","download",t.$style.icon]})])],1)])}),[],!1,(function share_menu_tab_pgn_injectStyles(t){this.$style=oe.default.locals||oe.default}),null,null).exports,se=i("./utils/mixins/dark-mode-functional.js"),ce={name:"BoardTabItem",components:{IconFont:x.a},mixins:[se.a],props:{icon:{type:String},isActive:{type:Boolean,default:!1},label:{type:String,required:!0},theme:{type:String}}},le=i("./ui/components/board/board-tab-item-underlined.vue?vue&type=style&index=0&lang=scss&module=true&");var ue={name:"TabSelector",components:{TabItem:Object(A.a)(ce,(function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",r._g({class:[r.$style.component,r.$style[r.theme],(t={},t[r.$style.active]=r.isActive,t[r.$style.darkMode]=r.isDarkMode,t)]},r.$listeners),[r.icon?o("icon-font",{class:r.$style.icon,attrs:{theme:"primary","is-dark-mode":r.isDarkMode,name:r.icon}}):r._e(),r._v(" "),o("span",{class:r.$style.label,domProps:{textContent:r._s(r.label)}})],1)}),[],!1,(function board_tab_item_underlined_injectStyles(t){this.$style=le.default.locals||le.default}),null,null).exports},props:{activeTab:{type:String,required:!0},tabs:{type:Array,required:!0},theme:{type:String}},emits:["tab-selected"],methods:{tabIsActive:function tabIsActive(t){return t===this.activeTab}}},de=i("./ui/components/board/share-menu/share-menu-tab-selector.vue?vue&type=style&index=0&lang=scss&module=true&");var he=Object(A.a)(ue,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},t._l(t.tabs,(function(r){return i("tab-item",{key:r.key,class:t.$style.tab,attrs:{"is-active":t.tabIsActive(r.key),label:r.label,theme:t.theme},on:{click:function(i){return t.$emit("tab-selected",r.key)}}})})),1)}),[],!1,(function share_menu_tab_selector_injectStyles(t){this.$style=de.default.locals||de.default}),null,null).exports;function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var pe={name:"ShareMenu",components:{IconFont:x.a,ModalContainer:S.a,ModalContent:w.a,ShareLink:O,SocialShare:L.a,TabEmbed:k,TabEvent:V,TabGif:$,TabImage:Z,TabPgn:ae,TabSelector:he},props:{analyzedPgn:{type:String},boardOptions:{type:Object,default:function _default(){return{}}},boardSettings:{type:Object,default:function _default(){return{}}},eventFilename:{type:String},eventUrl:{type:String},initialDiagramOptions:{type:Object,default:function _default(){return{}}},includedTabs:{type:Array,default:function _default(){return h.a}},excludedTabs:{type:Array,default:function _default(){return[]}},isLoggedIn:{type:Boolean,default:!1},initialActiveTab:{type:String,default:h.b.PGN.key},hasTimestamps:{type:Boolean,default:!1},variant:{type:String},tcn:{type:String},fen:{type:String},pgn:{type:String},pgnHeaders:{type:Object},shareUrl:{type:String},tacticsId:{type:Number}},emits:["hide"],data:function data(){return{activeTab:this.initialActiveTab,animatedGifUrl:null,diagramEditor:{boardColors:null,coordinates:null,currentBoardStyle:null,currentPieceStyle:null,diagramId:null,diagramImage:null,isMultiGame:!1,isPuzzle:null,numberOfGames:1,pieceStyles:null},savedEmbedProps:{currentBoardStyle:"",currentPieceStyle:"",pgn:""},isLoadingGif:!1}},computed:{diagramOptions:function diagramOptions(){return{boardOptions:_objectSpread(_objectSpread({},this.boardOptions),{},{boardStyle:this.diagramEditor.currentBoardStyle,coordinates:this.diagramEditor.coordinates,pieceStyle:this.diagramEditor.currentPieceStyle}),diagramId:this.diagramEditor.diagramId,hasMoves:Boolean(this.tcn.length),isPuzzle:this.diagramEditor.isPuzzle,nodeLimit:this.initialDiagramOptions.nodeLimit||{}}},displayableTabs:function displayableTabs(){var t=this;return this.includedTabs.map((function(t){return h.b[t.toUpperCase()]})).filter((function(r){return!t.excludedTabs.includes(r.key)&&r.isVisible({showGif:t.showGif})}))},gamePgn:function gamePgn(){return this.initialDiagramOptions&&this.initialDiagramOptions.games&&this.diagramEditor.isMultiGame?this.initialDiagramOptions.games.map((function(t){return t.setup.pgnBody})).join(""):this.pgn},generatedShareUrl:function generatedShareUrl(){return this.shareUrl||Object(y.e)(this.tacticsId)},isUpdatedDiagram:function isUpdatedDiagram(){var t=this;return!["coordinates","currentPieceStyle","currentBoardStyle","isPuzzle","pgn"].every((function(r){return t.diagramEditor[r]===t.savedEmbedProps[r]}))},needsDiagramUpdate:function needsDiagramUpdate(){return this.activeTab===h.b.EMBED.key&&this.isUpdatedDiagram},normalizedFen:function normalizedFen(){return Object(y.f)(this.fen)},showGif:function showGif(){return this.isLoggedIn&&this.tcn.length>1&&["chess","chess960"].includes(this.variant.toLowerCase())}},watch:{boardSettings:"buildInitialDiagram","diagramEditor.coordinates":"postDiagram","diagramEditor.currentBoardStyle":"postDiagram","diagramEditor.currentPieceStyle":"postDiagram","diagramEditor.isPuzzle":"postDiagram","diagramEditor.isMultiGame":"postDiagram"},created:function created(){this.getAnimatedGifUrl(),this.buildInitialDiagram()},methods:{buildInitialDiagram:function buildInitialDiagram(){var t=this.boardSettings||{},r=t.boardColors,i=void 0===r?[]:r,o=t.pieceStyles,a=void 0===o?[]:o;this.diagramEditor.boardColors=i,this.diagramEditor.coordinates=this.boardOptions.coordinates,this.diagramEditor.currentBoardStyle=this.boardOptions.boardStyle,this.diagramEditor.currentPieceStyle=Object(l.d)(this.boardOptions.pieceStyle),this.diagramEditor.isPuzzle=this.initialDiagramOptions.isPuzzle,this.diagramEditor.isMultiGame=this.initialDiagramOptions.games&&this.initialDiagramOptions.games.length>1,this.diagramEditor.numberOfGames=this.initialDiagramOptions.games?this.initialDiagramOptions.games.length:1,this.diagramEditor.pieceStyles=Object(l.e)(a)},getAnimatedGifUrl:function getAnimatedGifUrl(){var t=this;if(this.showGif&&!this.animatedGifUrl&&this.activeTab===h.b.GIF.key){var r;this.isLoadingGif=!0;var i={tcn:this.tcn,flip:this.boardOptions.flipBoard,isChess960:"chess960"===this.variant.toLowerCase(),initialPosition:(null===(r=this.initialDiagramOptions)||void 0===r?void 0:r.initialPosition)||this.pgnHeaders.FEN||null};Object(y.d)(i).then((function(r){t.animatedGifUrl=r,t.isLoadingGif=!1}))}},getTabComponent:function getTabComponent(t){return"tab-".concat(t)},getDiagramInfo:function getDiagramInfo(){var t=Object(l.c)(this.diagramOptions),r=Object(l.a)(this.gamePgn,t),i=this.diagramEditor.diagramId;return Object(g.b)(i,r).then((function(t){return t.data})).catch(_.a)},postDiagram:function postDiagram(){var t=this;if(this.needsDiagramUpdate){var r=this.diagramEditor,i=r.currentBoardStyle,o=r.currentPieceStyle;this.getDiagramInfo().then((function(r){r&&r>0&&(t.diagramEditor.diagramId=r,t.diagramEditor.diagramImage=Object(l.b)(r)),t.savedEmbedProps={pgn:t.gamePgn,currentBoardStyle:i,currentPieceStyle:o}}))}},hide:function hide(){this.$refs.modalContainer&&this.$refs.modalContainer.hide(),this.animatedGifUrl=null},selectTab:function selectTab(t){this.activeTab=t,this.postDiagram(),this.getAnimatedGifUrl()},show:function show(){this.fen&&this.pgn&&this.$refs.modalContainer.show()},updateDiagramOption:function updateDiagramOption(t){var r=t.key,i=t.val;this.diagramEditor[r]=i}}},fe=i("./ui/components/board/share-menu/share-menu.vue?vue&type=style&index=0&lang=scss&module=true&");var me=Object(A.a)(pe,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("modal-container",{ref:"modalContainer",attrs:{"close-on-esc-press":""},on:{"modal-did-hide":function(r){return t.$emit("hide",r)}}},[i("div",{class:t.$style.wrapper},[i("icon-font",{class:t.$style.close,attrs:{name:"x",theme:"secondary"},on:{click:t.hide}}),t._v(" "),i("modal-content",{ref:"modal",class:t.$style.modal},[t.fen?i("div",[i("header",{class:t.$style.header},[i("div",{class:t.$style.share},[i("share-link",t._b({class:t.$style.link,attrs:{"share-url":t.generatedShareUrl}},"share-link",t.$attrs,!1)),t._v(" "),i("social-share",{attrs:{background:"transparent"}})],1),t._v(" "),i("tab-selector",{ref:"tab-selector",attrs:{"active-tab":t.activeTab,tabs:t.displayableTabs},on:{"tab-selected":t.selectTab}})],1),t._v(" "),i("section",{class:t.$style.content},[t._l(t.displayableTabs,(function(r){return[i(t.getTabComponent(r.key),{directives:[{name:"show",rawName:"v-show",value:t.activeTab===r.key,expression:"activeTab === tab.key"}],key:r.key,tag:"component",class:t.$style.tab,attrs:{"analyzed-pgn":t.analyzedPgn,"board-options":t.boardOptions,"board-settings":t.boardSettings,"diagram-options":t.diagramEditor,"event-filename":t.eventFilename,"event-url":t.eventUrl,"gif-url":t.animatedGifUrl,"has-timestamps":t.hasTimestamps,"is-loading-gif":t.isLoadingGif,fen:t.normalizedFen,pgn:t.pgn,"pgn-headers":t.pgnHeaders,"tactics-id":t.tacticsId},on:{"update-diagram-option":t.updateDiagramOption}})]}))],2)]):t._e()])],1)])}),[],!1,(function share_menu_injectStyles(t){this.$style=fe.default.locals||fe.default}),null,null);r.a=me.exports},"./ui/components/board/share-menu/share-menu.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/share-menu.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/tabs/share-menu-tab-embed.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-embed.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/tabs/share-menu-tab-event.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-event.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/tabs/share-menu-tab-gif.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-gif.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/tabs/share-menu-tab-image.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-image.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/board/share-menu/tabs/share-menu-tab-pgn.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/board/share-menu/tabs/share-menu-tab-pgn.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/forms/form-button.vue":function(t,r,i){"use strict";var o={name:"FormButton",mixins:[i("./utils/mixins/dark-mode-functional.js").a],props:{disabled:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},href:{type:String,required:!1},size:{type:String,required:!1},theme:{type:String,required:!1},type:{type:String,default:"button"}},methods:{handleClick:function handleClick(){this.href&&(window.location=this.href)}}},a=i("./ui/components/forms/form-button.vue?vue&type=style&index=0&lang=scss&module=true&"),l=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var h=Object(l.a)(o,(function(){var t,r=this,i=r.$createElement;return(r._self._c||i)("button",r._g({class:[r.componentClasses(),r.$style[r.size],r.$style[r.theme],(t={},t[r.$style["full-width"]]=r.fullWidth,t)],attrs:{disabled:r.disabled,type:r.type},on:{click:r.handleClick}},r.$listeners),[r._t("default")],2)}),[],!1,(function injectStyles(t){this.$style=a.default.locals||a.default}),null,null);r.a=h.exports},"./ui/components/forms/form-button.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-button.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/forms/form-input.vue":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./utils/mixins/dark-mode-functional.js"),h=i("./utils/mixins/dark-mode-forces.js"),g=i("./ui/components/icons/icon-font.vue"),y=i("./utils/directives/tooltip.js"),_={name:"FormInput",components:{IconFont:g.a},directives:{tooltip:y.a},mixins:[l.a,h.a],props:{ariaLabel:String,autocomplete:String,autofocus:Boolean,disabled:{type:Boolean,default:!1,required:!1},iconLeft:{type:String,required:!1},iconLeftTooltip:{type:String,default:""},iconRight:{type:String,required:!1},iconRightTooltip:{type:String,default:""},id:String,maxlength:Number,name:String,placeholder:{type:String,required:!1},readonly:{type:Boolean,default:!1,required:!1},size:{type:String,required:!1},type:{type:String,default:"text"},value:{type:[String,Number],required:!1}},emits:["input","enter","keyup","focus","blur"],computed:{inputClasses:function inputClasses(){var t,r=this.$style,i=this.iconLeft,o=this.iconRight,l=this.lightMode,h=this.size;return[r.input,r[h],(t={},a()(t,r.left,i),a()(t,r.right,o),a()(t,"light-mode",l),t)]}},methods:{blurEvent:function blurEvent(t){this.$emit("blur",t)},focusEvent:function focusEvent(t){this.$emit("focus",t)},keyupEvent:function keyupEvent(t){this.$emit("keyup",t)},keyupEnterEvent:function keyupEnterEvent(t){this.$emit("enter",t)},onIconClick:function onIconClick(t){this.$emit("icon-click-".concat(t))},updateValue:function updateValue(t){this.$emit("input",t)}}},x=i("./ui/components/forms/form-input.vue?vue&type=style&index=0&lang=scss&module=true&"),w=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var S=Object(w.a)(_,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:[t.componentClasses(),t.themeClasses]},[t.iconLeft?i("icon-font",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.iconLeftTooltip,expression:"iconLeftTooltip"}],class:[t.$style.icon,t.$style.left],attrs:{"is-dark-mode":t.isDarkMode,name:t.iconLeft,theme:"primary"},on:{click:function(r){return t.onIconClick("left")}}}):t._e(),t._v(" "),i("input",{class:t.inputClasses,attrs:{id:t.id,"aria-label":t.ariaLabel,autocomplete:t.autocomplete,autofocus:t.autofocus,maxlength:t.maxlength,name:t.name,placeholder:t.placeholder,readonly:t.readonly,type:t.type},domProps:{value:t.value},on:{blur:function(r){return t.blurEvent(r)},focus:function(r){return t.focusEvent(r)},input:function(r){return t.updateValue(r.target.value)},keyup:[function(r){return t.keyupEvent(r)},function(r){return!r.type.indexOf("key")&&t._k(r.keyCode,"enter",13,r.key,"Enter")?null:t.keyupEnterEvent(r)}]}}),t._v(" "),t.iconRight?i("icon-font",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.iconRightTooltip,expression:"iconRightTooltip"}],class:[t.$style.icon,t.$style.right],attrs:{"is-dark-mode":t.isDarkMode,name:t.iconRight},on:{click:function(r){return t.onIconClick("right")}}}):t._e()],1)}),[],!1,(function injectStyles(t){this.$style=x.default.locals||x.default}),null,null);r.a=S.exports},"./ui/components/forms/form-input.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-input.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/forms/form-select.vue":function(t,r,i){"use strict";var o=i("./utils/mixins/dark-mode-functional.js"),a=i("./utils/mixins/dark-mode-forces.js"),l={name:"FormSelect",components:{IconFont:i("./ui/components/icons/icon-font.vue").a},mixins:[o.a,a.a],props:{ariaLabel:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},emptyOption:{type:String},icon:{type:String,default:"caret-down"},id:{type:String,required:!1},labelKey:{type:String,default:"label"},name:{type:String,required:!1},onChange:{type:Function,required:!1},options:{type:Array,required:!0},placeholderText:{type:String,required:!1},size:{type:String,required:!1},value:{type:[String,Number],required:!1},valueKey:{type:String,default:"value"}},emits:["input"],methods:{getLabel:function getLabel(t){return this.labelKey?t[this.labelKey]:t},getValue:function getValue(t){return this.valueKey?t[this.valueKey]:t},setSelectedOption:function setSelectedOption(t){this.$emit("input",t),this.onChange&&this.onChange()}}},h=i("./ui/components/forms/form-select.vue?vue&type=style&index=0&lang=scss&module=true&"),g=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var y=Object(g.a)(l,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:[t.componentClasses(),t.themeClasses]},[i("select",{class:t.$style[t.size],attrs:{id:t.id,"aria-label":t.ariaLabel,name:t.name,disabled:t.disabled},on:{change:function(r){return t.setSelectedOption(r.target.value)}}},[t.placeholderText?i("option",{attrs:{disabled:"",hidden:"",selected:"",value:""}},[t._v("\n      "+t._s(t.placeholderText)+"\n    ")]):t._e(),t._v(" "),t.emptyOption?i("option",{attrs:{selected:"",value:""}},[t._v("\n      "+t._s(t.emptyOption)+"\n    ")]):t._e(),t._v(" "),t._l(t.options,(function(r,o){return i("option",{key:o,attrs:{disabled:r.disabled,hidden:r.hidden},domProps:{selected:t.getValue(r)===t.value,value:t.getValue(r)}},[t._v("\n      "+t._s(t.getLabel(r))+"\n    ")])}))],2),t._v(" "),i("icon-font",{class:t.$style.icon,attrs:{theme:"primary",name:t.icon}})],1)}),[],!1,(function injectStyles(t){this.$style=h.default.locals||h.default}),null,null);r.a=y.exports},"./ui/components/forms/form-select.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-select.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/forms/form-textarea.vue":function(t,r,i){"use strict";var o=i("./node_modules/autosize/dist/autosize.js"),a=i.n(o),l={name:"FormTextarea",mixins:[i("./utils/mixins/dark-mode-functional.js").a],props:{ariaLabel:{type:String,required:!1},autofocus:{default:!1,type:Boolean},autosize:{type:Boolean,default:!1},onEnter:{type:Function,required:!1},name:{type:String,required:!1},placeholder:{type:String,required:!1},value:{type:String,required:!1}},emits:["input","resize","focus","blur"],mounted:function mounted(){this.autosize&&(a()(this.$el),this.$el.addEventListener("autosize:resized",this.resizeEvent)),this.autofocus&&this.$el.focus()},beforeDestroy:function beforeDestroy(){this.autosize&&this.$el.removeEventListener("autosize:resized",this.resizeEvent)},methods:{blurEvent:function blurEvent(t){this.$emit("blur",t)},focusEvent:function focusEvent(t){this.$emit("focus",t)},handleEnter:function handleEnter(t){var r=this;this.onEnter&&!t.shiftKey&&(t.preventDefault(),this.onEnter(),this.$nextTick((function(){a.a.update(r.$el)})))},resizeEvent:function resizeEvent(){var t=this;this.$nextTick((function(){t.$emit("resize")}))},updateValue:function updateValue(t){this.$emit("input",t)}}},h=i("./ui/components/forms/form-textarea.vue?vue&type=style&index=0&lang=scss&module=true&"),g=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var y=Object(g.a)(l,(function(){var t,r=this,i=r.$createElement;return(r._self._c||i)("textarea",{class:[r.componentClasses(),(t={},t[r.$style.autosize]=r.autosize,t)],attrs:{"aria-label":r.ariaLabel,name:r.name,placeholder:r.placeholder},domProps:{value:r.value},on:{blur:function(t){return r.blurEvent(t)},focus:function(t){return r.focusEvent(t)},input:function(t){return r.updateValue(t.target.value)},keydown:function(t){return!t.type.indexOf("key")&&r._k(t.keyCode,"enter",13,t.key,"Enter")?null:r.handleEnter(t)}}})}),[],!1,(function injectStyles(t){this.$style=h.default.locals||h.default}),null,null);r.a=y.exports},"./ui/components/forms/form-textarea.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/forms/form-textarea.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/icons/icon-font.vue":function(t,r,i){"use strict";var o={name:"IconFont",mixins:[{props:{family:{type:String,default:"chess"},isDarkMode:{type:Boolean,default:!1},name:{type:String,required:!0},theme:{type:String,default:""}}}]},a=i("./ui/components/icons/icon-font.vue?vue&type=style&index=0&lang=scss&module=true&"),l=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var h=Object(l.a)(o,(function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",r._g({class:[r.$style.component,(t={},t[r.$style.darkMode]=r.isDarkMode,t)]},r.$listeners),[o("span",{class:[r.$style[r.family],r.name,r.$style[r.theme]]})])}),[],!1,(function injectStyles(t){this.$style=a.default.locals||a.default}),null,null);r.a=h.exports},"./ui/components/icons/icon-font.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/icons/icon-font.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/icons/svg/make-svg.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o=function makeSvg(t){var r=t.path,i=void 0===r?"":r,o=t.size,a=void 0===o?24:o,l=t.viewBox,h=void 0===l?"0 0 18 19":l;return'\n  <svg width="'.concat(a,'" height="').concat(a,'" viewBox="').concat(h,'">\n    ').concat(i,"\n  </svg>\n")}},"./ui/components/loaders/loader-three-bounce.vue":function(t,r,i){"use strict";var o={name:"LoaderThreeBounce",props:{isCircle:{type:Boolean,default:!1},size:{type:Number,default:80}},computed:{dotCss:function dotCss(){var t="".concat(Math.round(this.size/4),"px");return{width:t,height:t}}}},a=i("./ui/components/loaders/loader-three-bounce.vue?vue&type=style&index=0&lang=scss&module=true&"),l=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var h=Object(l.a)(o,(function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",{class:[r.$style.component,(t={},t[r.$style.circle]=r.isCircle,t)],style:{width:r.size+"px"}},[o("div",{class:[r.$style.dot,r.$style.bounce1],style:r.dotCss}),r._v(" "),o("div",{class:[r.$style.dot,r.$style.bounce2],style:r.dotCss}),r._v(" "),o("div",{class:r.$style.dot,style:r.dotCss})])}),[],!1,(function injectStyles(t){this.$style=a.default.locals||a.default}),null,null);r.a=h.exports},"./ui/components/loaders/loader-three-bounce.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/loaders/loader-three-bounce.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/modals/modal-container.vue":function(t,r,i){"use strict";var o=i("./web/core/api/modals/config.js"),a={name:"ModalContainer",props:{autoShow:{type:Boolean,default:!1},closeOnBackgroundClick:{type:Boolean,default:!0},closeOnEscPress:{type:Boolean,default:!1},centerOverParent:{type:Boolean,default:!1},centerOverContent:{type:Boolean,default:!1}},emits:["background-clicked"],data:function data(){return{visible:!1}},mounted:function mounted(){this.closeOnEscPress&&window.addEventListener("keyup",this.onKeyPress),this.autoShow&&this.show()},beforeDestroy:function beforeDestroy(){this.closeOnEscPress&&window.removeEventListener("keyup",this.onKeyPress)},methods:{hide:function hide(){this.visible=!1,this.$emit(o.b.MODAL_DID_HIDE)},onBackgroundClick:function onBackgroundClick(){this.closeOnBackgroundClick&&(this.hide(),this.$emit("background-clicked"))},onKeyPress:function onKeyPress(t){27===t.keyCode&&this.hide()},show:function show(){this.visible=!0}}},l=i("./ui/components/modals/modal-container.vue?vue&type=style&index=0&lang=scss&module=true&"),h=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var g=Object(h.a)(a,(function(){var t,r,i=this,o=i.$createElement,a=i._self._c||o;return a("transition",{attrs:{"enter-active-class":i.$style.enter,"leave-active-class":i.$style.leave}},[i.visible?a("div",{class:[i.$style.component,(t={},t[i.$style["parent-centered"]]=i.centerOverParent,t),(r={},r[i.$style["content-centered"]]=i.centerOverContent,r)]},[i.centerOverParent?i._e():a("div",{class:i.$style.bg,on:{click:i.onBackgroundClick}}),i._v(" "),i._t("default")],2):i._e()])}),[],!1,(function injectStyles(t){this.$style=l.default.locals||l.default}),null,null);r.a=g.exports},"./ui/components/modals/modal-container.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/modals/modal-container.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/modals/modal-content.vue":function(t,r,i){"use strict";var o={name:"ModalContent",components:{SectionContainer:i("./ui/components/sections/section-container.vue").a},props:{overflow:String}},a=i("./ui/components/modals/modal-content.vue?vue&type=style&index=0&lang=scss&module=true&"),l=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var h=Object(l.a)(o,(function(){var t=this,r=t.$createElement;return(t._self._c||r)("section-container",{class:t.$style.component,attrs:{"light-mode":"",overflow:t.overflow}},[t._t("default")],2)}),[],!1,(function injectStyles(t){this.$style=a.default.locals||a.default}),null,null);r.a=h.exports},"./ui/components/modals/modal-content.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/modals/modal-content.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/horizontal-move-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/horizontal-move-list.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/move-node-context-menu.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node-context-menu.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/move-node/move-node.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/move-node.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/move-node/move-text.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/move-text.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/move-node/node-comment.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/node-comment.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/move-list/move-node/node-space.vue?vue&type=style&index=0&module=true&lang=css&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/move-list/move-node/node-space.vue?vue&type=style&index=0&module=true&lang=css&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/sections/section-container.vue":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l={name:"SectionContainer",mixins:[i("./utils/mixins/dark-mode-forces.js").a],props:{overflow:{type:String,required:!1}},computed:{componentClasses:function componentClasses(){var t=this.overflow,r=this.$style;return[r.component,a()({},r[t],t),this.themeClasses]}}},h=i("./ui/components/sections/section-container.vue?vue&type=style&index=0&lang=scss&module=true&"),g=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var y=Object(g.a)(l,(function(){var t=this,r=t.$createElement;return(t._self._c||r)("div",{class:t.componentClasses},[t._t("default")],2)}),[],!1,(function injectStyles(t){this.$style=h.default.locals||h.default}),null,null);r.a=y.exports},"./ui/components/sections/section-container.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/sections/section-container.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/social/social-share.vue":function(t,r,i){"use strict";var o=i("./ui/components/icons/icon-font.vue"),a=i("./utils/browser.js"),l=i("./web/core/api/social/config.js"),h=i("./utils/window.js"),g=i("./utils/http/index.js"),y=i("./utils/router.js"),_=i("./utils/event-hub.js"),x={name:"SocialShare",components:{IconFont:o.a},props:{background:{type:String,default:"default"},userId:{type:String,required:!1},username:{type:String,required:!1},chessTvExtraButtons:{type:Boolean,default:!1}},data:function data(){return{isExpanded:!1,translations:l.f,share:l.e,web:l.g}},methods:{bookmarkPage:a.a,printWindow:a.f,sendInvitation:function sendInvitation(t,r){var i="/settings"===a.i?"":"".concat(a.j," ").concat(a.h," %0D%0A%0D%0A"),o=t?"?friend=".concat(t):"",h="body=".concat(i,"I play at Chess.com! Download their free app:%0D%0A%0D%0A\n      … for Android - ").concat(l.d.android(),"\n      … for iPhone %26 iPad - ").concat(l.d.ios()," %0D%0A\n      … or sign up online at ").concat(l.d.register()).concat(o,"\n      %0D%0A%0D%0A ... %0D%0A%0D%0A");r&&(h+="Then challenge me! %22".concat(r,"%22 is my username! %0D%0A\n            http://www.chess.com/members/view/").concat(r)),Object(a.g)("subject=Check out Chess.com",h)},shareWindow:function shareWindow(t){"facebook"!==t&&"twitter"!==t||function trackSharedGame(t){g.default.post(y.a.generate("web_game_callback_shared",{type:t}))}(t),"function"==typeof l.e[t]&&Object(h.a)(l.e[t]())},toggleExpanded:function toggleExpanded(){this.isExpanded=!this.isExpanded},handleReport:function handleReport(){_.a.emit(l.b.REPORT_TV_VIDEO)}}},w=i("./ui/components/social/social-share.vue?vue&type=style&index=0&lang=scss&module=true&"),S=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var M=Object(S.a)(x,(function(){var t,r,i,o=this,a=o.$createElement,l=o._self._c||a;return l("div",{class:[o.$style.component,(t={},t[o.$style[o.background]]=o.background,t)]},[l("div",{class:[o.$style.background,(r={},r[o.$style.expanded]=o.isExpanded,r)]},[l("div",{class:o.$style.primary},[o.chessTvExtraButtons?[l("a",{class:[o.$style.link,o.$style.twitch],attrs:{target:"_blank","aria-label":o.translations.twitch,href:o.share.twitch(),title:o.translations.twitch}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"twitch",theme:"secondary"}})],1),o._v(" "),l("a",{class:[o.$style.link,o.$style.youtube],attrs:{target:"_blank","aria-label":o.translations.youtube,href:o.web.youtube,title:o.translations.youtube}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"youtube",theme:"secondary"}})],1),o._v(" "),l("a",{class:[o.$style.link,o.$style.instagram],attrs:{target:"_blank","aria-label":o.translations.instagram,href:o.web.instagram,title:o.translations.instagram}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"instagram",theme:"secondary"}})],1),o._v(" "),l("a",{class:[o.$style.link,o.$style.discord],attrs:{target:"_blank","aria-label":o.translations.discord,href:o.share.discord(),title:o.translations.discord}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"discord",theme:"secondary"}})],1)]:o._e(),o._v(" "),l("button",{class:[o.$style.link,o.$style.facebook],attrs:{type:"button","aria-label":o.translations.shareFacebook,title:o.translations.shareFacebook},on:{click:function(t){return o.shareWindow("facebook")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"facebook",theme:"secondary"}})],1),o._v(" "),l("button",{class:[o.$style.link,o.$style.twitter],attrs:{type:"button","aria-label":o.translations.shareTwitter,title:o.translations.shareTwitter},on:{click:function(t){return o.shareWindow("twitter")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"twitter",theme:"secondary"}})],1),o._v(" "),l("button",{class:[o.$style.link,o.$style.reddit],attrs:{type:"button","aria-label":o.translations.shareReddit,title:o.translations.shareReddit},on:{click:function(t){return o.shareWindow("reddit")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"reddit",theme:"secondary"}})],1),o._v(" "),l("button",{class:[o.$style.link,o.$style.share],attrs:{type:"button","aria-label":o.translations.showMore,title:o.translations.showMore},on:{click:o.toggleExpanded}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",theme:"secondary",name:o.isExpanded?"x":"share"}})],1),o._v(" "),o.chessTvExtraButtons?l("button",{class:[o.$style.link,o.$style.share],attrs:{type:"button","aria-label":o.translations.report,title:o.translations.report},on:{click:o.handleReport}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"circle-danger",theme:"secondary"}})],1):o._e()],2),o._v(" "),l("div",{class:[o.$style.secondary,(i={},i[o.$style.visible]=o.isExpanded,i)]},[l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.shareLinkedIn,title:o.translations.shareLinkedIn},on:{click:function(t){return o.shareWindow("linkedin")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"linkedin",theme:"secondary"}})],1),o._v(" "),l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.shareMix,title:o.translations.shareMix},on:{click:function(t){return o.shareWindow("mix")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"mix",theme:"secondary"}})],1),o._v(" "),l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.shareTumblr,title:o.translations.shareTumblr},on:{click:function(t){return o.shareWindow("tumblr")}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"tumblr",theme:"secondary"}})],1),o._v(" "),l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.addFavorites,title:o.translations.addFavorites},on:{click:o.bookmarkPage}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"favorites",theme:"secondary"}})],1),o._v(" "),l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.sendEmail,title:o.translations.sendEmail},on:{click:function(t){return o.sendInvitation(o.userId,o.username)}}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"mail",theme:"secondary"}})],1),o._v(" "),l("button",{class:o.$style.link,attrs:{type:"button","aria-label":o.translations.print,title:o.translations.print},on:{click:o.printWindow}},[l("icon-font",{class:o.$style.icon,attrs:{"aria-hidden":"true",family:"chess",name:"printer",theme:"secondary"}})],1)])])])}),[],!1,(function injectStyles(t){this.$style=w.default.locals||w.default}),null,null);r.a=M.exports},"./ui/components/social/social-share.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/social/social-share.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./ui/components/tinymce/tinymce.vue":function(t,r,i){"use strict";var o=i("./utils/tinymce/config.js"),a=i("./utils/translator.js");function showConfirm(t){var r=a.a.trans("Are you sure you want to leave? You have unsaved changes");return t.returnValue=r,r}function disableConfirm(){window.removeEventListener("beforeunload",showConfirm)}function createEventListeners(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];window.addEventListener("beforeunload",showConfirm),t.forEach((function(t){return t&&t.addEventListener("click",disableConfirm,!0)}))}var l=i("./utils/editor.js"),h={},g={name:"Tinymce",props:{customConfig:{type:Object,required:!1},disabled:{type:Boolean,default:!1},initValue:{type:String,default:""},theme:{type:String},placeholder:{type:String},unsavedChangesConfirm:{type:Boolean,default:!1}},emits:["input","content-updated"],watch:{initValue:function initValue(t){h.setContent("<p>".concat(t,"</p>")),this.$emit("input",t)},disabled:function disabled(){h.destroy(),h=new l.a,this.setupEditor()}},mounted:function mounted(){h=new l.a,this.setupEditor()},beforeDestroy:function beforeDestroy(){h.destroy()},methods:{getCurrentValue:function getCurrentValue(){return h.getContent()},setupEditor:function setupEditor(){var t=this,r=this,i="advanced"===this.theme?Object(o.a)():Object(o.b)(),a=document.getElementById(o.d.SUBMIT_BUTTON),l=this.unsavedChangesConfirm?function unsavedChangesConfirmConfig(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{init_instance_callback:function init_instance_callback(r){r.on("input",(function(){return createEventListeners(t)}),{once:!0})}}}([a]):{},g=Object.assign({},i,r.customConfig,l,{target:r.$refs.editor,setup:function setup(t){t.settings.readonly=r.disabled,r.disabled||(t.on("blur",(function(){r.$emit("content-updated",t.getContent())})),t.on("KeyUp",(function(){r.$emit("input",t.getContent())})),t.on("Change",(function(){r.$emit("input",t.getContent())})),t.on("BeforeSetContent",(function(t){t.content.match(/<a href="http:.*?\.chess\.com.*?a>/)&&(t.content=t.content.replace(/http:/g,"https:"))})),t.shortcuts.add("ctrl+13","submit",(function(){a&&a.click()})))}});h.init(g).then((function(){t.$emit("input",h.getContent())}))}}},y=i("./ui/components/tinymce/tinymce.vue?vue&type=style&index=0&lang=scss&module=true&"),_=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var x=Object(_.a)(g,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{ref:"editor",attrs:{placeholder:t.placeholder},domProps:{innerHTML:t._s(t.initValue)}})])}),[],!1,(function injectStyles(t){this.$style=y.default.locals||y.default}),null,null);r.a=x.exports},"./ui/components/tinymce/tinymce.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./ui/components/tinymce/tinymce.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./utils/amplitude/logger.js":function(t,r,i){"use strict";var o=i("./utils/iterable/service.js"),a=i("./node_modules/amplitude-js/amplitude.js"),l=i.n(a),h=i("./node_modules/lodash-es/_baseForOwn.js"),g=i("./node_modules/lodash-es/_castFunction.js");var y=function forOwn(t,r){return t&&Object(h.a)(t,Object(g.a)(r))},_={init:function init(){if(_.initialized)return!0;var t=window.context||{};return l.a.getInstance().init(t.amplitudeKey,null,{includeUtm:!0,includeReferrer:!0,includeGclid:!0}),null!=t&&null!=t.user&&l.a.getInstance().setUserId(t.user.id),_.initialized=!0,!0},logEvent:function logEvent(t,r,i,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;_.init()?(_.setUserProperties(i),_.incrementUserProperties(o),l.a.getInstance().logEvent(t,r||{})):a<3&&setTimeout((function(){_.logEvent(t,r,i,o,a+1)}),1e3)},setUserProperties:function setUserProperties(t){_.init()&&null!=t&&l.a.getInstance().setUserProperties(t)},incrementUserProperties:function incrementUserProperties(t){if(_.init()&&null!=t){var r=new l.a.Identify;y(t,(function(t,i){r.add(i,t)})),l.a.getInstance().identify(r)}},logSocialShare:function logSocialShare(){_.logEvent("Social - SocialShare",null,null,{numSocialShares:1})},logOnboardChangeAvatar:function logOnboardChangeAvatar(t){_.logEvent("Onboard - Avatar",null,{hasAvatar:t})},logOnboardChangeTheme:function logOnboardChangeTheme(t){_.logEvent("Onboard - Theme",null,{themeName:t})},logAccountClose:function logAccountClose(t){_.logEvent("User - AccountClose",t)},logStartCheckout:function logStartCheckout(t){var r="Upgrade - Checkout";_.logEvent(r,t),Object(o.a)(r,t)},logSubmitPayment:function logSubmitPayment(t){_.logEvent("Upgrade - SubmitPayment",{auth:t})},logAccountDowngrade:function logAccountDowngrade(t,r){var i="Upgrade - Cancel";_.logEvent(i,t,r),Object(o.a)(i,t)},logAccountDowngradeTrial:function logAccountDowngradeTrial(t,r){var i="Upgrade - CancelTrial";_.logEvent(i,t,r),Object(o.a)(i,t)},logVideoComplete:function logVideoComplete(t,r,i,o){_.logEvent("Videos - Complete",{skillLevels:t,category:r,title:i,author:o})},logVideoStart:function logVideoStart(t,r,i,o){_.logEvent("Videos - Start",{skillLevels:t,category:r,title:i,author:o},null,{numVideos:1})}};r.a=_},"./utils/browser.js":function(t,r,i){"use strict";i.d(r,"d",(function(){return o})),i.d(r,"c",(function(){return a})),i.d(r,"i",(function(){return l})),i.d(r,"j",(function(){return h})),i.d(r,"h",(function(){return g})),i.d(r,"a",(function(){return y})),i.d(r,"f",(function(){return x})),i.d(r,"g",(function(){return w})),i.d(r,"e",(function(){return S})),i.d(r,"b",(function(){return T}));var o=function getWindowTitle(){return encodeURIComponent(window.document.title)},a=function getWindowLocation(){return encodeURIComponent(window.location.href)},l=window.location.pathname,h=o(),g=a();window.chessBrowserChecker={};var y=function bookmarkPage(){if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(h,g,"");else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(g,h);else{var t=-1!==window.navigator.userAgent.toLowerCase().indexOf("mac")?"Cmd":"Ctrl";alert("Press ".concat(t,"+D to bookmark this page."))}},_={chrome:"Chrome",edge:"edge",firefox:"Firefox",ie:"IE",safari:"Safari",waterfox:"Waterfox"},x=function printWindow(){window.print()},w=function sendEmail(t,r){window.location.href="mailto:?".concat(t,"&").concat(r)},S=function isMobile(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)},M=function isEdge(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return null!==t.match(/Edg/)},T=function getBrowser(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent,i=r.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(M(r)){var o=r.indexOf("Edg"),a=4;r.match("Edge/")&&(a=5);var l=o+a,h=parseInt(r.substring(l,r.indexOf(".",l)),10);return{name:"Edge",version:parseInt(h,10)}}if(/trident/i.test(i[1]))return t=/\brv[ :]+(\d+)/g.exec(r)||[],{name:"IE",version:parseInt(t[1]||-1,10)};if(i[1]===_.chrome&&null!=(t=r.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:parseInt(t[1],10)};if(i[1]===_.firefox){var g=r.match(/(waterfox(?=\/))\/?\s*(\d+)/i)||[];if(g[1]===_.waterfox)return{name:g[1],version:parseInt(g[2],10)}}return(i=i[2]?[i[1],i[2]]:[window.navigator.appName,window.navigator.appVersion,"-?"])[0]===_.safari&&null!=(t=r.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),"MSIE"===i[0]?{name:_.ie,version:parseInt(i[1],10)}:{name:i[0],version:parseInt(i[1],10)}}},"./utils/cache/cached.js":function(t,r,i){"use strict";var o=i("./web/core/api/user/helper.js"),a=i("./utils/types.ts"),l=i("./utils/cache/service.js"),h=JSON.parse(l.default.get("chessComAppState")),g=h&&h.user&&h.user.isImpersonating||Object(o.d)(),y=Object(a.f)(h)&&h.board;r.a=!g&&y?h:{board:{}}},"./utils/cache/service.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./utils/cache/service.js")},"./utils/common/debounce.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./utils/common/debounce.js")},"./utils/common/merge.js":function(t,r,i){"use strict";var o=i("./node_modules/lodash-es/_Stack.js"),a=i("./node_modules/lodash-es/_baseAssignValue.js"),l=i("./node_modules/lodash-es/eq.js");var h=function assignMergeValue(t,r,i){(void 0!==i&&!Object(l.a)(t[r],i)||void 0===i&&!(r in t))&&Object(a.a)(t,r,i)},g=i("./node_modules/lodash-es/_baseFor.js"),y=i("./node_modules/lodash-es/_cloneBuffer.js"),_=i("./node_modules/lodash-es/_cloneTypedArray.js"),x=i("./node_modules/lodash-es/_copyArray.js"),w=i("./node_modules/lodash-es/_initCloneObject.js"),S=i("./node_modules/lodash-es/isArguments.js"),M=i("./node_modules/lodash-es/isArray.js"),T=i("./node_modules/lodash-es/isArrayLike.js"),P=i("./node_modules/lodash-es/isObjectLike.js");var C=function isArrayLikeObject(t){return Object(P.default)(t)&&Object(T.a)(t)},A=i("./node_modules/lodash-es/isBuffer.js"),O=i("./node_modules/lodash-es/isFunction.js"),L=i("./node_modules/lodash-es/isObject.js"),I=i("./node_modules/lodash-es/_baseGetTag.js"),R=i("./node_modules/lodash-es/_getPrototype.js"),j=Function.prototype,N=Object.prototype,k=j.toString,D=N.hasOwnProperty,B=k.call(Object);var G=function isPlainObject(t){if(!Object(P.default)(t)||"[object Object]"!=Object(I.default)(t))return!1;var r=Object(R.a)(t);if(null===r)return!0;var i=D.call(r,"constructor")&&r.constructor;return"function"==typeof i&&i instanceof i&&k.call(i)==B},H=i("./node_modules/lodash-es/isTypedArray.js");var V=function safeGet(t,r){if(("constructor"!==r||"function"!=typeof t[r])&&"__proto__"!=r)return t[r]},U=i("./node_modules/lodash-es/_copyObject.js"),z=i("./node_modules/lodash-es/keysIn.js");var W=function toPlainObject(t){return Object(U.a)(t,Object(z.a)(t))};var q=function baseMergeDeep(t,r,i,o,a,l,g){var T=V(t,i),P=V(r,i),I=g.get(P);if(I)h(t,i,I);else{var R=l?l(T,P,i+"",t,r,g):void 0,j=void 0===R;if(j){var N=Object(M.a)(P),k=!N&&Object(A.a)(P),D=!N&&!k&&Object(H.a)(P);R=P,N||k||D?Object(M.a)(T)?R=T:C(T)?R=Object(x.a)(T):k?(j=!1,R=Object(y.a)(P,!0)):D?(j=!1,R=Object(_.a)(P,!0)):R=[]:G(P)||Object(S.a)(P)?(R=T,Object(S.a)(T)?R=W(T):Object(L.default)(T)&&!Object(O.a)(T)||(R=Object(w.a)(P))):j=!1}j&&(g.set(P,R),a(R,P,o,l,g),g.delete(P)),h(t,i,R)}};var $=function baseMerge(t,r,i,a,l){t!==r&&Object(g.a)(r,(function(g,y){if(l||(l=new o.a),Object(L.default)(g))q(t,r,y,i,baseMerge,a,l);else{var _=a?a(V(t,y),g,y+"",t,r,l):void 0;void 0===_&&(_=g),h(t,y,_)}}),z.a)},X=i("./node_modules/lodash-es/identity.js");var K=function apply(t,r,i){switch(i.length){case 0:return t.call(r);case 1:return t.call(r,i[0]);case 2:return t.call(r,i[0],i[1]);case 3:return t.call(r,i[0],i[1],i[2])}return t.apply(r,i)},Y=Math.max;var Z=function overRest(t,r,i){return r=Y(void 0===r?t.length-1:r,0),function(){for(var o=arguments,a=-1,l=Y(o.length-r,0),h=Array(l);++a<l;)h[a]=o[r+a];a=-1;for(var g=Array(r+1);++a<r;)g[a]=o[a];return g[r]=i(h),K(t,this,g)}};var Q=function constant(t){return function(){return t}},J=i("./node_modules/lodash-es/_defineProperty.js"),ee=J.a?function(t,r){return Object(J.a)(t,"toString",{configurable:!0,enumerable:!1,value:Q(r),writable:!0})}:X.a,te=Date.now;var ne=function shortOut(t){var r=0,i=0;return function(){var o=te(),a=16-(o-i);if(i=o,a>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(ee);var re=function baseRest(t,r){return ne(Z(t,r,X.a),t+"")},ie=i("./node_modules/lodash-es/_isIndex.js");var oe=function isIterateeCall(t,r,i){if(!Object(L.default)(i))return!1;var o=typeof r;return!!("number"==o?Object(T.a)(i)&&Object(ie.a)(r,i.length):"string"==o&&r in i)&&Object(l.a)(i[r],t)};var ae=function createAssigner(t){return re((function(r,i){var o=-1,a=i.length,l=a>1?i[a-1]:void 0,h=a>2?i[2]:void 0;for(l=t.length>3&&"function"==typeof l?(a--,l):void 0,h&&oe(i[0],i[1],h)&&(l=a<3?void 0:l,a=1),r=Object(r);++o<a;){var g=i[o];g&&t(r,g,o,l)}return r}))}((function(t,r,i){$(t,r,i)}));r.a=ae},"./utils/dark-mode.ts":function(t,r,i){"use strict";i.d(r,"a",(function(){return a})),i.d(r,"b",(function(){return l}));var o="dark-mode",a=function getIsDarkMode(){return document.body.classList.contains(o)},l=a()},"./utils/directives/click-outside.js":function(t,r,i){"use strict";var o=i("./live/src/es6/core/type.utils.js"),a=i("./live/src/es6/core/timer.utils.js");r.a={name:"click-outside",bind:function bind(t,r){var i,l,h=1,g="click";if(o.a.isFunction(r.value)?i=r.value:o.a.isObject(r.value)&&(i=r.value.handler,h=r.value.delay,g=r.value.clickEvent||"click"),!o.a.isFunction(i))throw new Error("must pass function to click-outside");var y=function onClickElement(t){return t.stopPropagation()},_=function onClickDocument(r){return t!==r.target&&i(t,r)};t.$unbindClickOutside&&t.$unbindClickOutside(),t.$unbindClickOutside=function(){a.a.clearTimeout(l),t.removeEventListener(g,y),document.removeEventListener(g,_),delete t.$unbindClickOutside},l=a.a.setTimeout((function(){t.addEventListener(g,y),document.addEventListener(g,_)}),h)},unbind:function unbind(t){t.$unbindClickOutside&&t.$unbindClickOutside()}}},"./utils/directives/confirm-popover.js":function(t,r,i){"use strict";i.d(r,"c",(function(){return I})),i.d(r,"a",(function(){return j}));var o=i("./web/core/api/content/config.js"),a=i("./node_modules/@chesscom/web-ui/dist/ui/vue/index.js"),l=i("./utils/event-hub.js"),h=i("./ui/components/modals/modal-container.vue"),g=i("./ui/components/modals/modal-content.vue"),y={name:"ConfirmPopover",components:{ModalContainer:h.a,ModalContent:g.a,V5Button:a.V5Button},props:{additionalClass:String,messageLabel:String,yesBtnLabel:String,cancelBtnLabel:String,onConfirm:{type:Function,default:function _default(){}},onBackgroundClick:{type:Function,default:function _default(){}},onCancel:Function},data:function data(){return{eventHubMessage:null}},computed:{message:function message(){var t;return null!==(t=this.eventHubMessage)&&void 0!==t?t:this.messageLabel},yesButtonLabel:function yesButtonLabel(){var t;return null!==(t=this.yesBtnLabel)&&void 0!==t?t:this.$trans("Yes")},cancelButtonLabel:function cancelButtonLabel(){var t;return null!==(t=this.cancelBtnLabel)&&void 0!==t?t:this.$trans("Cancel")}},mounted:function mounted(){var t=this;l.a.on(o.d.SHOW_MODAL,(function(r){"string"==typeof r&&(t.eventHubMessage=r),t.show()}))},methods:{hide:function hide(){this.$refs.modalContainer.hide()},show:function show(){this.$refs.modalContainer.show()},onYesClick:function onYesClick(){this.hide(),"function"==typeof this.onConfirm&&this.onConfirm(),l.a.emit(o.d.CONFIRM_POPOVER_YES)},onCancelClick:function onCancelClick(){this.hide(),"function"==typeof this.onCancel&&this.onCancel()}}},_=i("./web/core/widgets/modals/confirm-popover.vue?vue&type=style&index=0&lang=scss&module=true&"),x=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var w=Object(x.a)(y,(function(){var t,r,i=this,o=i.$createElement,a=i._self._c||o;return a("modal-container",{ref:"modalContainer",on:{"background-clicked":i.onBackgroundClick}},[a("modal-content",{ref:"modal",class:i.$style.modal},[a("div",{class:i.$style.messageLabel},[i._v("\n      "+i._s(i.message)+"\n    ")]),i._v(" "),a("div",{class:i.$style.buttons},[a("v5-button",{class:[i.$style.button,(t={},t[i.$style[""+i.additionalClass]]=i.additionalClass,t),i.$style["button-v5"]],attrs:{size:"small",theme:"basic-light","cancel-btn":i.cancelButtonLabel},domProps:{textContent:i._s(i.cancelButtonLabel)},on:{click:i.onCancelClick}}),i._v(" "),a("v5-button",{class:[i.$style.button,(r={},r[i.$style[""+i.additionalClass]]=i.additionalClass,r),i.$style["button-v5"]],attrs:{size:"small",theme:"primary","yes-btn":i.yesButtonLabel},domProps:{textContent:i._s(i.yesButtonLabel)},on:{click:i.onYesClick}})],1)])],1)}),[],!1,(function injectStyles(t){this.$style=_.default.locals||_.default}),null,null).exports,S=i("./utils/dom/index.js"),M=i("./web/core/api/position/helper.js"),T=i("./web/core/api/position/is-rtl.js"),P={name:"ConfirmPopover",components:{V5Button:a.V5Button},props:{messageLabel:String,onConfirm:{type:Function,default:function _default(){}}},data:function data(){return{position:{placement:"top",left:0,top:0},visible:!1}},computed:{style:function style(){var t={transform:"translate(".concat(this.position.left,"px, ").concat(this.position.top,"px)")};return Object(T.a)()&&(t={transform:"translate(0, ".concat(this.position.top,"px)"),left:"".concat(this.position.left,"px"),right:"auto"}),t}},methods:{hide:function hide(){Object(S.a)(".".concat(o.e.CONFIRM_OPEN)).forEach((function(t){return t.classList.remove(o.e.CONFIRM_OPEN)})),this.visible=!1,this.removeListeners()},show:function show(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top";this.visible=!0,this.addListeners(),this.$nextTick((function(){r.position=Object(M.a)(t,r.$el,i,10)}))},onYesClick:function onYesClick(){this.hide(),this.onConfirm()},scrollListener:function scrollListener(){window.addEventListener("scroll",this.hide,{once:!0})},clickListener:function clickListener(){document.addEventListener("click",this.hide,{capture:!0,once:!0})},addListeners:function addListeners(){this.scrollListener(),this.clickListener()},removeListeners:function removeListeners(){window.removeEventListener("scroll",this.scrollListener),document.removeEventListener("click",this.clickListener,!0)}}},C=i("./web/core/widgets/modals/confirm-popover-inline.vue?vue&type=style&index=0&lang=scss&module=true&");var A,O=Object(x.a)(P,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],ref:"modal",class:[t.$style.component,t.$style[t.position.placement]],style:t.style},[i("div",{class:t.$style.inner},[i("div",{class:t.$style.message,domProps:{innerHTML:t._s(t.messageLabel)}}),t._v(" "),i("div",{class:t.$style.buttons},[i("v5-button",{class:t.$style.button,attrs:{size:"small",theme:"basic-light"},domProps:{textContent:t._s(t.$trans("Cancel"))},on:{click:t.hide}}),t._v(" "),i("v5-button",{class:t.$style.button,attrs:{size:"small",theme:"primary"},domProps:{textContent:t._s(t.$trans("Yes"))},on:{click:t.onYesClick}})],1)])])}),[],!1,(function confirm_popover_inline_injectStyles(t){this.$style=C.default.locals||C.default}),null,null).exports,L=i("./utils/lazy-vue/index.js"),I=Object(L.a)({confirmPopover:{component:w,el:"#confirm-popover"},confirmPopoverInline:{component:O,el:"#confirm-popover-inline"}}),R=[],j=function callConfirmPopover(t){var r=t.message,i=t.onConfirm;(A=I.createInstance("confirmPopover").$children[0]).messageLabel=r,A.onConfirm=i,A.show()};r.b={bind:function bind(t,r){var i=function directiveClickListener(i){if(A="modal"===r.value.type?"confirmPopover":"confirmPopoverInline",!document.getElementById(o.e.CONFIRM_POPOVER_INLINE)){var a=document.createElement("div");a.setAttribute("id",o.e.CONFIRM_POPOVER_INLINE),document.body.appendChild(a)}var l=I.createInstance(A),h=document.querySelector(".".concat(o.e.TOOLTIP_CLASS,".").concat(o.e.TOOLTIP_TOP)),g=l.$children[0];g&&(g.messageLabel=r.value.message,g.onConfirm=r.value.onConfirm,g.show(i.target,r.value.placement),t.classList.add(o.e.CONFIRM_OPEN)),h&&h.classList.remove(o.e.TOOLTIP_TOP),i.preventDefault()};t.addEventListener("click",i),t.dataset.listenerIndex=R.length,R.push(i)},unbind:function unbind(t){t.removeEventListener("click",R[t.dataset.listenerIndex])}}},"./utils/directives/tooltip.js":function(t,r,i){"use strict";var o,a=i("./node_modules/vue/dist/vue.esm.js"),l=i("./web/core/api/position/helper.js"),h=i("./web/core/api/content/config.js"),g=i("./live/src/es6/core/type.utils.js"),y=function remove(t,r){var i=g.a.isFunction(r)?t.findIndex(r):t.indexOf(r);-1!==i&&t.splice(i,1)},_=i("./live/src/es6/core/timer.utils.js"),x=function getOptions(t){return g.a.isString(t.value)?{content:t.value}:t.value},w={name:"Tooltip",created:function created(){this.active=null,this.instances=[]},beforeDestroy:function beforeDestroy(){this.instances=null,this.clearTooltip()},methods:{bind:function bind(t,r){this.instances.push({element:t,options:x(r)}),t.addEventListener("mouseenter",this.showTooltip)},update:function update(t,r){var i=this.instances.find((function(r){return r.element===t}));i&&(i.options=x(r))},unbind:function unbind(t){var r=this.instances.find((function(r){return r.element===t}));r&&(this.active===r&&this.hideTooltip({target:r.element}),y(this.instances,r),t.removeEventListener("mouseenter",this.showTooltip),t.removeEventListener("mouseleave",this.hideTooltip))},showTooltip:function showTooltip(t){var r=this,i=t.target,o=this.instances.find((function(t){return t.element===i}));if(o&&o.options&&o.options.content){var a=o.options.delay||400,g=o.options.position||"top",y=o.options.padding||0;this.clearTooltip(),o.element.classList.contains(h.e.CONFIRM_OPEN)||(this.active=o,o.element.addEventListener("mouseleave",this.hideTooltip),this.showTimeout=_.a.setTimeout((function(){r.showFrame=window.requestAnimationFrame((function(){r.$refs&&r.$refs.content&&o.options&&(r.$refs.content.innerHTML=o.options.content),r.$el.classList.add(g),Object(l.c)(o.element,r.$el,g,y)}))}),a)),o.options.closeOnScroll&&this.hideOnScroll(i)}},hideOnScroll:function hideOnScroll(t){var r=this;window.addEventListener("scroll",(function(){r.hideTooltip({target:t})}))},hideTooltip:function hideTooltip(t){var r=this,i=t.target;this.instances.find((function(t){return t.element===i}))&&(this.clearTooltip(),this.hideFrame=window.requestAnimationFrame((function(){r.$refs&&r.$refs.content&&(r.$refs.content.innerHTML=null),Object(l.d)(r.$el)})))},clearTooltip:function clearTooltip(){this.active&&(this.active.element.removeEventListener("mouseleave",this.hideTooltip),this.active=null),_.a.clearTimeout(this.showTimeout),window.cancelAnimationFrame(this.hideFrame),window.cancelAnimationFrame(this.showFrame),window.removeEventListener("scroll",this.hideOnScroll)}}},S=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js"),M=Object(S.a)(w,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{staticClass:"tooltip tip vue-tooltip"},[i("div",{staticClass:"arrow"}),t._v(" "),i("div",{ref:"content",staticClass:"inner"})])}),[],!1,null,null,null).exports,T=a.default.extend(M),P=!1,C=function getTooltip(){if(o||(o=new T),!P){var t=document.createElement("div");document.body.appendChild(t),o.$mount(t),P=!0}return o};r.a={bind:function bind(t,r){return C().bind(t,r)},componentUpdated:function componentUpdated(t,r){return C().update(t,r)},unbind:function unbind(t,r){return C().unbind(t,r)}}},"./utils/dom/index.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return h})),i.d(r,"b",(function(){return g})),i.d(r,"c",(function(){return y})),i.d(r,"d",(function(){return _})),i.d(r,"e",(function(){return x})),i.d(r,"f",(function(){return w})),i.d(r,"g",(function(){return showHideMore}));var o=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),a=i.n(o),l=i("./web/core/api/content/config.js"),h=(i("./web/core/api/board/helper/get-board-element.js"),function getArrayOfElements(t){return a()(document.querySelectorAll(t))}),g=function getClickedChild(t,r,i){var o=i,a=null;if(!t||!r||!i)return a;for(;o&&o!==t&&!a;)o.classList.contains(r)&&(a=o),o=o.parentNode;return a},y=function getElement(t){return document.querySelector(".".concat(t))},_=function getElements(t){return document.getElementsByClassName(t)},x=function getScrollElement(){return window},w=function injectMounts(t,r){r.forEach((function(r){var i=document.createElement("div");i.id=r,t.appendChild(i)}))};function showHideMore(t,r,i,o){var a=_(t);Array.from(a).forEach((function(t){var a=t.getAttribute("data-key"),h=document.querySelectorAll(".".concat(r,"[data-key=").concat(a,"]")),g=t.querySelector(".".concat(i)),y=t.querySelector(".".concat(o));g.innerHTML=l.g.showMore,t.addEventListener("click",(function(){var t=g.innerHTML===l.g.showMore;g.innerHTML=t?l.g.showLess:l.g.showMore,y.classList.toggle("toggle-content-icon-up"),Array.from(h).forEach((function(t){t.style.display="block"===t.style.display?"none":"block"}))}))}))}},"./utils/download-as-file.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return downloadAsFile}));var o=i("./node_modules/file-saver/dist/FileSaver.min.js");function downloadAsFile(t,r){var i=new Blob([t],{type:"application/x-chess-pgn;charset=utf-8"});Object(o.saveAs)(i,r||"download")}},"./utils/editor.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return x}));var o,a=i("./node_modules/@babel/runtime/helpers/classCallCheck.js"),l=i.n(a),h=i("./node_modules/@babel/runtime/helpers/createClass.js"),g=i.n(h),y=i("./web/core/api/content/config.js"),_=i("./utils/dark-mode.ts");var x=function(){function _default(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;l()(this,_default),t&&(this.editor=t)}return g()(_default,[{key:"getEditor",value:function getEditor(){var t=this;return!this.editor&&window.tinymce&&(this.editor=window.tinymce),this.editor?Promise.resolve(this.editor):function lazyLoadTinyMCE(){return o||(o=new Promise((function(t,r){var i=document.createElement("script");i.src=window.Config.pathToTinyMCE,i.async=!0,i.type="text/javascript",i.onload=function(){t()},i.onerror=function(t){r(t||new Error("failed to load tinymce"))},i.onreadystatechange=function(){"complete"===i.readyState&&t()},document.body.appendChild(i)}))),o}().then((function(){return t.editor=window.tinymce,t.editor}))}},{key:"init",value:function init(t){if(t.darkModeSupport){var r=_.b?y.c.DARK_MODE:"",i="".concat(y.c.SUPPORT_DARK_MODE," ").concat(r),o=Object.assign(t,{body_class:i});return this.getEditor().then((function(t){return t.init(o)}))}return this.getEditor().then((function(r){return r.init(t)}))}},{key:"execCommand",value:function execCommand(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.getEditor().then((function(t){var i;return(i=t.activeEditor).execCommand.apply(i,r)}))}},{key:"fire",value:function fire(t){this.getEditor().then((function(r){return r.activeEditor.fire(t)}))}},{key:"getContent",value:function getContent(){if(!this.editor)throw new Error("TinyMCE not initialized");return this.editor.activeEditor.getContent()}},{key:"getParams",value:function getParams(){return this.getEditor().then((function(t){if(t.activeEditor)return t.activeEditor.windowManager.getParams()}))}},{key:"insertContent",value:function insertContent(t){this.getEditor().then((function(r){return r.activeEditor.insertContent(t)}))}},{key:"setContent",value:function setContent(t){this.getEditor().then((function(r){return r.activeEditor.setContent(t)}))}},{key:"destroy",value:function destroy(){this.editor&&this.editor.activeEditor.destroy()}},{key:"closePopup",value:function closePopup(){this.getEditor().then((function(t){return t.activeEditor.windowManager.close(window)}))}},{key:"openPopup",value:function openPopup(){this.getEditor().then((function(t){return t.activeEditor.windowManager.open()}))}}]),_default}()},"./utils/event-hub.js":function(t,r,i){"use strict";var o=i("./node_modules/tiny-emitter/index.js"),a=i.n(o),l=i("./node_modules/vue/dist/vue.esm.js"),h=document.querySelector('[data-v3-event-emitter-migration="true"]')?new a.a:new l.default;h instanceof l.default&&(h.emit=h.$emit,h.off=h.$off,h.on=h.$on,h.once=h.$once),r.a=h},"./utils/game/get-pgn-with-opts.ts":function(t,r,i){"use strict";i.d(r,"b",(function(){return a})),i.d(r,"a",(function(){return l})),i.d(r,"d",(function(){return setCheckboxModel})),i.d(r,"e",(function(){return setCheckboxUi})),i.d(r,"c",(function(){return h}));var o=i("./node_modules/@vue/composition-api/dist/vue-composition-api.esm.js"),a=Object(o.reactive)({isCommentsCheckboxVisible:!1,isHighlightsCheckboxVisible:!1,isAnalyzedPgnCheckboxVisible:!1}),l=Object(o.reactive)({isAnalyzedPgnEnabled:!1,isCommentsEnabled:!0,isHighlightsEnabled:!1,isTimestampsEnabled:!1});function setCheckboxModel(t){Object.keys(t).forEach((function(r){l[r]=t[r]}))}function setCheckboxUi(t){Object.keys(t).forEach((function(r){a[r]=t[r]}))}var h=function getPgnOpts(t){var r=t.isCommentsEnabled,i=t.isHighlightsEnabled,o=!r,a=[];return t.isTimestampsEnabled&&a.push("clk"),i&&a.push("c_effect","c_arrow"),{hideComments:o,restrictCommands:a}}},"./utils/html.transformer.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a})),i.d(r,"c",(function(){return l}));var o=function cleanTinyMCE(t){return function removeHtmlWhiteSpace(t){return t.replace(/&nbsp;/g,"")}(function removeHtmlTags(t){return t.replace(/(<(?!img|\/?iframe)([^>]+)>)/gi,"")}(t)).trim()},a=function htmlDecode(t){return(new DOMParser).parseFromString("<!doctype html><body>".concat(t),"text/html").body.textContent},l=function htmlEncode(t){if(!t)return t;for(var r=[60,62],i=t.length,o=[];i--;){var a=t[i].charCodeAt();r.indexOf(a)>-1?o[i]="&#".concat(a,";"):o[i]=t[i]}return o.join("")}},"./utils/http/handle-error.js":function(t,r,i){"use strict";var o=i("./web/core/api/alerts/config.ts"),a=(i("./utils/translator.js"),function getMessageFromError(t){if(t.response&&401!==t.response.status)return(t.response.data&&t.response.data.message?t.response.data.message:o.b.badRequest)||t.response.statusText}),l=i("./web/core/store/index.js");r.a=function(t){var r=a(t);return r&&l.default.dispatch("alerts/create",{type:o.f.error,message:r}),Promise.reject(t)}},"./utils/http/index.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./utils/http/index.js")},"./utils/is-2fa.js":function(t,r,i){"use strict";var o=i("./utils/router.js");r.a=function(){return-1!==window.location.href.indexOf(o.a.generate("web_2fa_login"))}},"./utils/iterable/service.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return w})),i.d(r,"b",(function(){return S}));var o=window.context?window.context.iterableKey:"",a={ITERABLE_API_TRACK_URL:"https://api.iterable.com/api/events/track?apiKey=".concat(o),ITERABLE_API_UPDATE_URL:"https://api.iterable.com/api/users/update?apiKey=".concat(o)},l=i("./utils/http/index.js"),h=window.context||{},g=h.user,y=h.iterableMuteApiCallsFeature,_=g?String(g.id):"",x=g&&!g.isGuest&&!y,w=function track(t,r){if(x)return l.default.post(a.ITERABLE_API_TRACK_URL,{userId:_,eventName:t,createdAt:Date.now(),dataFields:r||{}})},S=function update(t){if(x)return l.default.post(a.ITERABLE_API_UPDATE_URL,{userId:_,dataFields:t||{}})}},"./utils/lazy-vue/index.js":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./node_modules/vue/dist/vue.esm.js"),h=i("./utils/translation/mixin.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}l.default.mixin(h.a);var g=function instantiate(t){return new l.default(_objectSpread(_objectSpread({},t),{},{el:t.el,render:function render(r){return r(t.component,{props:t.propsData})},store:t.store}))};r.a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={},i=function createInstance(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t[i]&&Object.keys(t[i]).length?(r[i]=r[i]||g(_objectSpread(_objectSpread({},t[i]),o)),r[i]):null},o=function createInstances(t){t.forEach((function(t){return i(t)}))};return{createInstance:i,createInstances:o,instances:r}}},"./utils/mixins/dark-mode-forces.js":function(t,r,i){"use strict";r.a={props:{darkMode:{type:Boolean,default:!1},lightMode:{type:Boolean,default:!1}},computed:{themeClasses:function themeClasses(){return{"light-mode":this.lightMode,"dark-mode":this.darkMode}}}}},"./utils/mixins/dark-mode-functional.js":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o);r.a={props:{isDarkMode:{type:Boolean,default:!1}},methods:{componentClasses:function componentClasses(){var t;return t={},a()(t,this.$style.component,!0),a()(t,this.$style.darkMode,this.isDarkMode),t}}}},"./utils/multivue.js":function(t,r,i){"use strict";var o=i("./utils/dom/index.js"),a=i("./node_modules/vue/dist/vue.esm.js");function _createForOfIteratorHelper(t,r){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){i&&(t=i);var o=0,a=function F(){};return{s:a,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,h=!0,g=!1;return{s:function s(){i=t[Symbol.iterator]()},n:function n(){var t=i.next();return h=t.done,t},e:function e(t){g=!0,l=t},f:function f(){try{h||null==i.return||i.return()}finally{if(g)throw l}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var i=0,o=new Array(r);i<r;i++)o[i]=t[i];return o}r.a=function(t,r,i,l,h){var g=Object(o.a)(t),y=[],_={};if(0===g.length)return y;var x,w=_createForOfIteratorHelper(g);try{for(w.s();!(x=w.n()).done;){var S=x.value,M=!0;"function"==typeof i&&(_=i(S)),l&&(S.dataset[l]?M=!1:S.dataset[l]=!0);var T={el:S};if(h&&(T.store=h),M){var P=Object.assign(T,r,{propsData:_});y.push(new a.default(P))}}}catch(C){w.e(C)}finally{w.f()}return y}},"./utils/object.js":function(t,r,i){"use strict";i.d(r,"g",(function(){return Pe})),i.d(r,"e",(function(){return Ce})),i.d(r,"f",(function(){return objectHasSomeProperties})),i.d(r,"d",(function(){return Ae})),i.d(r,"b",(function(){return Oe})),i.d(r,"c",(function(){return hasShallowDiff})),i.d(r,"a",(function(){return filterKeys}));var o=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),a=i.n(o),l=(i("./node_modules/@babel/runtime/helpers/typeof.js"),i("./node_modules/@babel/runtime/helpers/defineProperty.js")),h=i.n(l),g=i("./node_modules/lodash-es/_Symbol.js");var y=function arrayMap(t,r){for(var i=-1,o=null==t?0:t.length,a=Array(o);++i<o;)a[i]=r(t[i],i,t);return a},_=i("./node_modules/lodash-es/isArray.js"),x=i("./node_modules/lodash-es/isSymbol.js"),w=g.default?g.default.prototype:void 0,S=w?w.toString:void 0;var M=function baseToString(t){if("string"==typeof t)return t;if(Object(_.a)(t))return y(t,baseToString)+"";if(Object(x.default)(t))return S?S.call(t):"";var r=t+"";return"0"==r&&1/t==-Infinity?"-0":r};var T=function toString_toString(t){return null==t?"":M(t)};var P=function baseSlice(t,r,i){var o=-1,a=t.length;r<0&&(r=-r>a?0:a+r),(i=i>a?a:i)<0&&(i+=a),a=r>i?0:i-r>>>0,r>>>=0;for(var l=Array(a);++o<a;)l[o]=t[o+r];return l};var C=function castSlice(t,r,i){var o=t.length;return i=void 0===i?o:i,!r&&i>=o?t:P(t,r,i)},A=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var O=function hasUnicode(t){return A.test(t)};var L=function asciiToArray(t){return t.split("")},I="[\\ud800-\\udfff]",R="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",j="\\ud83c[\\udffb-\\udfff]",N="[^\\ud800-\\udfff]",k="(?:\\ud83c[\\udde6-\\uddff]){2}",D="[\\ud800-\\udbff][\\udc00-\\udfff]",B="(?:"+R+"|"+j+")"+"?",G="[\\ufe0e\\ufe0f]?",H=G+B+("(?:\\u200d(?:"+[N,k,D].join("|")+")"+G+B+")*"),V="(?:"+[N+R+"?",R,k,D,I].join("|")+")",U=RegExp(j+"(?="+j+")|"+V+H,"g");var z=function unicodeToArray(t){return t.match(U)||[]};var W=function stringToArray(t){return O(t)?z(t):L(t)};var q=function createCaseFirst(t){return function(r){r=T(r);var i=O(r)?W(r):void 0,o=i?i[0]:r.charAt(0),a=i?C(i,1).join(""):r.slice(1);return o[t]()+a}}("toUpperCase");var $=function capitalize(t){return q(T(t).toLowerCase())};var X=function arrayReduce(t,r,i,o){var a=-1,l=null==t?0:t.length;for(o&&l&&(i=t[++a]);++a<l;)i=r(i,t[a],a,t);return i};var K=function basePropertyOf(t){return function(r){return null==t?void 0:t[r]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Y=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Z=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var Q=function deburr(t){return(t=T(t))&&t.replace(Y,K).replace(Z,"")},J=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var ee=function asciiWords(t){return t.match(J)||[]},te=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var ne=function hasUnicodeWord(t){return te.test(t)},re="\\u2700-\\u27bf",ie="a-z\\xdf-\\xf6\\xf8-\\xff",oe="A-Z\\xc0-\\xd6\\xd8-\\xde",ae="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",se="["+ae+"]",ce="\\d+",le="[\\u2700-\\u27bf]",ue="["+ie+"]",de="[^\\ud800-\\udfff"+ae+ce+re+ie+oe+"]",he="(?:\\ud83c[\\udde6-\\uddff]){2}",pe="[\\ud800-\\udbff][\\udc00-\\udfff]",fe="["+oe+"]",me="(?:"+ue+"|"+de+")",ge="(?:"+fe+"|"+de+")",ve="(?:['’](?:d|ll|m|re|s|t|ve))?",ye="(?:['’](?:D|LL|M|RE|S|T|VE))?",be="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_e="[\\ufe0e\\ufe0f]?",xe=_e+be+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",he,pe].join("|")+")"+_e+be+")*"),we="(?:"+[le,he,pe].join("|")+")"+xe,Se=RegExp([fe+"?"+ue+"+"+ve+"(?="+[se,fe,"$"].join("|")+")",ge+"+"+ye+"(?="+[se,fe+me,"$"].join("|")+")",fe+"?"+me+"+"+ve,fe+"+"+ye,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ce,we].join("|"),"g");var Me=function unicodeWords(t){return t.match(Se)||[]};var Ee=function words(t,r,i){return t=T(t),void 0===(r=i?void 0:r)?ne(t)?Me(t):ee(t):t.match(r)||[]},Te=RegExp("['’]","g");(function createCompounder(t){return function(r){return X(Ee(Q(r).replace(Te,"")),t,"")}})((function(t,r,i){return r=r.toLowerCase(),t+(i?$(r):r)}));function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){h()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var Pe=function objectIsEmpty(t){return t&&!Object.keys(t).length};var Ce=function objectHasData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t&&Object.keys(t).length>0};function objectHasSomeProperties(t,r){return r.some((function(r){return t[r]}))}var Ae=function invertObject(t){return Object.keys(t).reduce((function(r,i){return _objectSpread(_objectSpread({},r),{},h()({},t[i],i))}),{})},Oe=function hasProperty(t,r){return Object.prototype.hasOwnProperty.call(t,r)};function hasShallowDiff(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object.keys(t).length!==Object.keys(r).length)return!0;for(var i in t)if(t[i]!==r[i])return!0;return!1}function filterKeys(t,r){return Object.entries(t).reduce((function(t,i){var o=a()(i,2),l=o[0],h=o[1];return r.includes(l)&&(t[l]=h),t}),{})}},"./utils/router.js":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/classCallCheck.js"),a=i.n(o),l=i("./node_modules/@babel/runtime/helpers/createClass.js"),h=i.n(l);i("./utils/sentry/set-sentry-context.js");var g=function(){function Router(){a()(this,Router),this.baseUrl=null,null==window.Routing&&(window.Routing={generate:function generate(t){return t}})}return h()(Router,[{key:"generate",value:function generate(t,r,i){var o=r||{},a=this.baseUrl||o.baseUrl||null;"string"==typeof o.username&&(o.username=o.username.toLowerCase());try{return null!=a?(delete o.baseUrl,a+window.Routing.generate(t,o,!1)):window.Routing.generate(t,o,i)}catch(h){var l=new Error("Couldn't find missing route '".concat(t,"'."));return console.error(l),function captureException(t,r){if(window.Sentry){var i=t instanceof Error?t:new Error(t);r?window.Sentry.withScope((function(t){Object.keys(r).forEach((function(i){return t.setExtra(i,r[i])})),window.Sentry.captureException(i)})):window.Sentry.captureException(i)}}(l,{missing_route:t}),"/"}}},{key:"getRouteRegex",value:function getRouteRegex(t){for(var r=function escapeRegex(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},i=function removePossesiveQuantifier(t){return t.replace("++","+")},o=window.Routing.getRoute(t),a="",l=o.tokens.length-1;l>=0;--l){var h=o.tokens[l];"variable"===h[0]?a+="".concat(r(h[1]),"(?<").concat(h[3],">").concat(i(h[2]),")"):a+=r(h[1])}return"^".concat(a,"$")}},{key:"setBaseUrl",value:function setBaseUrl(t){this.baseUrl=t}}]),Router}();r.a=new g},"./utils/sentry/set-sentry-context.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./utils/sentry/set-sentry-context.js")},"./utils/shared/add-directive-event-listeners.helper.js":function(t,r,i){"use strict";function addDirectiveEventListeners(t,r,i){var o="$unbind".concat(t);r[o]&&r[o](),Object.keys(i).forEach((function(t){r.addEventListener(t,i[t])})),r[o]=function(){Object.keys(i).forEach((function(t){r.removeEventListener(t,i[t]),delete i[t]})),delete r[o]}}i.d(r,"a",(function(){return addDirectiveEventListeners}))},"./utils/sound/config.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return o})),i.d(r,"c",(function(){return a})),i.d(r,"d",(function(){return l})),i.d(r,"a",(function(){return h})),i.d(r,"e",(function(){return g})),i.d(r,"f",(function(){return y})),i.d(r,"g",(function(){return _}));var o=3,a={SOUND_SUSPENDED:"sound-suspended",SOUND_ENABLED:"sound-enabled"},l=["webm","ogg","mp3","wav"],h="default",g="//images.chesscomfiles.com/chess-themes/sounds",y=["move-check","premove","capture","castle","game-end","game-start","promote","move-opponent","move-self"],_=y.concat(["click","correct","drawoffer","illegal","incorrect","notify","tenseconds"])},"./utils/sound/get-urls.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return getUrls}));var o=i("./utils/sound/config.js");function getThemeUrl(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.a;return"".concat(o.e,"/_").concat(r.toUpperCase(),"_/").concat(i,"/").concat(t,".").concat(r)}function getUrls(t,r){return o.f.includes(t)?o.d.map((function(i){return getThemeUrl(t,i,r)})):o.g.includes(t)?o.d.map((function(r){return getThemeUrl(t,r)})):["/bundles/web/sounds/".concat(t,".mp3")]}},"./utils/string.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a})),i.d(r,"c",(function(){return l}));var o=function stringBooleanToBoolean(t){return"true"===t},a=function stripHTMLComments(t){return t.replace(/<!--([\s\S]*?)-->/gm,"")},l=function titleize(t){return"string"==typeof t?t.toLowerCase().replace(/(?:^|\s|-)\S/g,(function(t){return t.toUpperCase()})):t}},"./utils/tinymce/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return g})),i.d(r,"b",(function(){return h})),i.d(r,"c",(function(){return y})),i.d(r,"d",(function(){return _}));function fixWidth(t){var r=t.style.width,i=parseInt(r,10);r&&r.includes("px")&&i>668&&(t.style.width=function calcWidth(t){var r=[];return["marginLeft","marginRight","borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"].forEach((function(i){parseInt(t.style[i],10)&&r.push(t.style[i])})),r.length>0?(r=r.join(" - "),"calc(100% - ".concat(r,")")):"100%"}(t))}function pastePostproccess(t,r){var i=r.node;Array.from(i.querySelectorAll("[style]")).forEach((function(t){!function fixMargin(t){var r=t.style.marginLeft,i=t.style.marginRight;r&&i&&r===i&&(t.style.marginLeft="auto",t.style.marginRight="auto")}(t),fixWidth(t)}))}var o=i("./web/core/api/user/helper.js");function filterToolbarButtons(t){return Object(o.a)("isNewlyRegistered")?t.replace(/imageuploader|smileys|media|link|unlink/g,""):t}var a="chessdiagram imageuploader smileys media link unlink bullist numlist table hr undo redo fullscreen",l="bold italic underline alignleft aligncenter alignright alignjustify outdent indent forecolor backcolor fontselect fontsizeselect",h=function defaultConfig(){return Object.assign(window.TinymceConfig.theme_options,window.TinymceConfig.editor_options,{height:100,plugins:"placeholder",paste_postprocess:pastePostproccess,resize:!0,toolbar1:filterToolbarButtons("chessdiagram imageuploader smileys media bold italic forecolor fontsizeselect bullist numlist hr link unlink"),toolbar:!0})},g=function advancedConfig(){return Object.assign(h(),{height:200,toolbar1:filterToolbarButtons(a),toolbar2:l,toolbar3:"blockquote anchor subscript superscript charmap preview code styleselect",verify_html:!1})},y=function defaultTwoRowConfig(){return Object.assign(h(),{height:200,toolbar1:filterToolbarButtons(a),toolbar2:l,verify_html:!1})},_={MCE_HEADER:"mce-window-head",MCE_DRAG_ELEMENT:"mce-dragh",SUBMIT_BUTTON:"message-submit"}},"./utils/translation/mixin.js":function(t,r,i){"use strict";var o=i("./utils/translation/translation.helper.js");r.a={methods:{$trans:o.b,$transChoice:o.c}}},"./utils/translation/translation.helper.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return g})),i.d(r,"c",(function(){return y})),i.d(r,"a",(function(){return _}));var o=i("./node_modules/bazinga-translator/js/translator.js"),a=i.n(o);a.a.placeHolderPrefix="",a.a.placeHolderSuffix="";var l=function escapeParameters(t){var r={};return null!=t&&Object.keys(t).forEach((function(i){var o=function escapeRegExp(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(i);null!=o&&o.length>0&&(r[o]=t[i])})),r},h=function getTranslatedPhrase(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"messages",i=arguments.length>2?arguments[2]:void 0;return window.chesscom_translations&&window.chesscom_translations[r]&&window.chesscom_translations[r][t]?window.chesscom_translations[r][t]:window.chesscom_live_translations&&window.chesscom_live_translations[r]&&window.chesscom_live_translations[r][t]?window.chesscom_live_translations[r][t]:"live"===r&&window.i18n_phrases&&window.i18n_phrases[t]?window.i18n_phrases:"countries"===r&&window.Country&&window.Country[t]?window.Country:i?void 0:"javascript"!==r?getTranslatedPhrase(t,"javascript"):t},g=function trans(t,r,i){return a.a.trans(h(t,i),l(r),i)},y=function transChoice(t,r,i,o){return void 0===r?"":a.a.transChoice(h(t,o),r,l(i))},_={trans:g,transChoice:y}},"./utils/translator.js":function(t,r,i){"use strict";var o=i("./utils/translation/translation.helper.js");r.a=o.a},"./utils/types.ts":function(t,r,i){"use strict";i.d(r,"f",(function(){return isObject})),i.d(r,"g",(function(){return isString})),i.d(r,"c",(function(){return isFunction})),i.d(r,"e",(function(){return isNumber})),i.d(r,"d",(function(){return isNil})),i.d(r,"a",(function(){return isArray})),i.d(r,"b",(function(){return isBoolean}));var o=i("./node_modules/@babel/runtime/helpers/typeof.js"),a=i.n(o);function isNull(t){return null===t}function isObject(t){return!isNull(t)&&"object"===a()(t)}function isString(t){return"string"==typeof t}function isFunction(t){return"function"==typeof t}function isNumber(t){return"number"==typeof t}function isNil(t){return isNull(t)||function isUndefined(t){return void 0===t}(t)}function isArray(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}},"./utils/window.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a}));var o=i("./utils/amplitude/logger.js"),a=function openWindow(t){o.a.logSocialShare();var r=window.screen.width/2-280,i=window.screen.height/2-340,a="width=".concat(560,", height=").concat(510),l="left=".concat(r,", top=").concat(i);window.open(t,"_blank","".concat(a,",").concat(l,",").concat("resizable=no, status=no, menubar=no, scrollbars=no"))}},"./utils/window/post-message.ts":function(t,r,i){"use strict";function postMessage(t){window.postMessage(t,window.location.origin)}i.d(r,"a",(function(){return postMessage}))},"./web/core/api/alerts/config.ts":function(t,r,i){"use strict";i.d(r,"a",(function(){return a})),i.d(r,"b",(function(){return l})),i.d(r,"d",(function(){return h})),i.d(r,"e",(function(){return g})),i.d(r,"f",(function(){return y})),i.d(r,"c",(function(){return _}));var o=i("./utils/translator.js"),a=7e3,l={badRequest:o.a.trans("Oops. Looks like there was an error. Sorry! Please refresh.")},h={avatarUploaded:o.a.trans("Avatar uploaded"),commentCreated:o.a.trans("Thank you for your comment."),commentDeleted:o.a.trans("Comment deleted."),commentEmptyContent:o.a.trans("You cannot send an empty comment"),commentMarkedAsSpam:o.a.trans("Comment marked as spam."),commentUpdated:o.a.trans("Comment updated."),commentLinkCopied:o.a.trans("Comment link is copied to clipboard"),copied:o.a.trans("Copied to clipboard"),forumsMarkedAsRead:o.a.trans("All forum topics have been marked as read"),featureContent:o.a.trans("Feature Set! It might take a minute or two to appear."),inviteEmpty:o.a.trans("Please select the players for whom to send the invitation"),inviteSent:o.a.trans("Your invitations were sent successfully"),pgnCopied:o.a.trans("PGN copied to buffer")},g={ALERT_FLASH_CONTAINER:"widget-alert-flash",DISMISSING:"alert-banner-dismissing"},y={error:"error",info:"info",success:"success"},_="create-header-alert";y.error,l.badRequest},"./web/core/api/board/config.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return k})),i.d(r,"h",(function(){return D})),i.d(r,"d",(function(){return B})),i.d(r,"f",(function(){return G})),i.d(r,"i",(function(){return H})),i.d(r,"c",(function(){return V})),i.d(r,"j",(function(){return U})),i.d(r,"e",(function(){return z})),i.d(r,"g",(function(){return W})),i.d(r,"a",(function(){return q}));var o="icon-background",a="icon-component",l="icon-component-shadow",h="icon-shadow",g='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#95bb4a"/>\n  <path d="M9 3.72a.48.48 0 0 0-.44.3L7.24 7.46l-3.68.19a.48.48 0 0 0-.27.84l2.86 2.32-1 3.56a.47.47 0 0 0 .18.5.46.46 0 0 0 .27.09.5.5 0 0 0 .26-.08l3.09-2 3.09 2a.5.5 0 0 0 .26.08.46.46 0 0 0 .27-.09.47.47 0 0 0 .18-.5l-1-3.56 2.86-2.32a.48.48 0 0 0-.27-.84l-3.68-.19L9.44 4A.48.48 0 0 0 9 3.72z" opacity=".1"/>\n  <path d="M9 3.22a.48.48 0 0 0-.44.3L7.24 7l-3.68.19a.48.48 0 0 0-.27.81l2.86 2.32-1 3.56a.47.47 0 0 0 .18.5.46.46 0 0 0 .27.09.5.5 0 0 0 .26-.08l3.09-2 3.09 2a.5.5 0 0 0 .26.08.46.46 0 0 0 .27-.09.47.47 0 0 0 .18-.5l-1-3.56L14.71 8a.48.48 0 0 0-.27-.84L10.76 7 9.44 3.52a.48.48 0 0 0-.44-.3z" fill="#fff"/>\n'),y='\n  <path class="'.concat(h,'" opacity=".3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"/>\n  <path class="').concat(o,'" fill="#a88865" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"/>\n  <path class="').concat(l,'" opacity=".3" d="M8.4,6c-1-.75-2.52-1.09-4.83-1.09H2.49v8.71H3.57A8.13,8.13,0,0,1,8.4,14.76Z"/>\n  <path class="').concat(l,'" opacity=".3" d="M9.49,14.76a8.14,8.14,0,0,1,4.84-1.17h1.08V4.88H14.33C12,4.88,10.52,5.22,9.49,6Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M8.4,5.47c-1-.75-2.52-1.09-4.83-1.09H3v8.71h.58A8.13,8.13,0,0,1,8.4,14.26Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M9.49,14.26a8.14,8.14,0,0,1,4.84-1.17h.58V4.38h-.58c-2.32,0-3.81.34-4.84,1.09Z"/>\n'),_='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#c93430"/>\n  <g class="').concat(l,'" opacity=".2">\n    <path d="M14.68 5.48a2.77 2.77 0 0 0-.77-.92 3.81 3.81 0 0 0-1.1-.56 3.86 3.86 0 0 0-1.2-.19 3.68 3.68 0 0 0-1.19.19 5.72 5.72 0 0 0-.9.37l-.33.2a3.5 3.5 0 0 1 .43.63A3.26 3.26 0 0 1 10 6.66a.45.45 0 0 0 .19 0l.11-.09a1.13 1.13 0 0 1 .28-.18 2.54 2.54 0 0 1 .42-.23 1.61 1.61 0 0 1 .49-.07 1.13 1.13 0 0 1 .73.24.74.74 0 0 1 .3.6 1 1 0 0 1-.25.68c-.17.19-.39.4-.65.64s-.33.27-.49.42a3.08 3.08 0 0 0-.45.55 2.55 2.55 0 0 0-.33.66 2.43 2.43 0 0 0-.13.84v.35a.34.34 0 0 0 .32.32h1.72a.27.27 0 0 0 .22-.1.29.29 0 0 0 .09-.22v-.21a.93.93 0 0 1 .27-.7 6.62 6.62 0 0 1 .65-.64A4.62 4.62 0 0 0 14 9a5.58 5.58 0 0 0 .49-.6 2.92 2.92 0 0 0 .36-.73 3.08 3.08 0 0 0 .14-1 2.76 2.76 0 0 0-.31-1.19zM12.3 12.72h-1.89a.29.29 0 0 0-.22.09.33.33 0 0 0-.09.22v1.84a.31.31 0 0 0 .09.22.26.26 0 0 0 .22.1h1.89a.33.33 0 0 0 .23-.09.34.34 0 0 0 .1-.23V13a.34.34 0 0 0-.1-.22.33.33 0 0 0-.23-.06zM6.68 12.72H4.79a.29.29 0 0 0-.22.09.33.33 0 0 0-.09.22v1.84a.35.35 0 0 0 .08.22.28.28 0 0 0 .23.1h1.89a.35.35 0 0 0 .23-.09.34.34 0 0 0 .1-.23V13a.34.34 0 0 0-.1-.22.35.35 0 0 0-.23-.06zM8.28 4.56A3.63 3.63 0 0 0 7.19 4 3.86 3.86 0 0 0 6 3.81 3.78 3.78 0 0 0 4.79 4a6.65 6.65 0 0 0-.9.37 2.84 2.84 0 0 0-.55.38l-.21.19a.31.31 0 0 0 0 .41l1 1.21a.31.31 0 0 0 .21.13.54.54 0 0 0 .25-.06l.1-.09a1.46 1.46 0 0 1 .29-.18 2.2 2.2 0 0 1 .41-.18 1.57 1.57 0 0 1 .49-.07 1.13 1.13 0 0 1 .73.24.74.74 0 0 1 .3.6 1 1 0 0 1-.26.68c-.17.19-.38.4-.64.64a6.4 6.4 0 0 0-.49.42 2.7 2.7 0 0 0-.52.53 2.94 2.94 0 0 0-.34.66 2.7 2.7 0 0 0-.12.84v.35a.29.29 0 0 0 .09.22.28.28 0 0 0 .22.1h1.76a.26.26 0 0 0 .21-.1.29.29 0 0 0 .09-.22v-.21a1 1 0 0 1 .27-.7 8.22 8.22 0 0 1 .66-.64A5.68 5.68 0 0 0 8.36 9a7 7 0 0 0 .48-.6 3 3 0 0 0 .37-.73 3.1 3.1 0 0 0 .13-1 2.67 2.67 0 0 0-1.06-2.11z"/>\n  </g>\n  <path class="').concat(a,'" fill="#fff" d="M14.68 5a2.77 2.77 0 0 0-.77-.92 3.81 3.81 0 0 0-1.1-.56 3.86 3.86 0 0 0-1.2-.19 3.68 3.68 0 0 0-1.19.17 5.72 5.72 0 0 0-.9.37l-.33.2a3.5 3.5 0 0 1 .43.63A3.26 3.26 0 0 1 10 6.16a.45.45 0 0 0 .19 0l.09-.16a1.13 1.13 0 0 1 .28-.18 2.54 2.54 0 0 1 .44-.16 1.61 1.61 0 0 1 .49-.07 1.13 1.13 0 0 1 .73.24.74.74 0 0 1 .3.6 1 1 0 0 1-.25.68c-.17.19-.39.4-.65.64s-.33.27-.49.42a3.08 3.08 0 0 0-.45.55 2.55 2.55 0 0 0-.33.66 2.43 2.43 0 0 0-.13.84v.35a.34.34 0 0 0 .32.32h1.72a.27.27 0 0 0 .22-.1.29.29 0 0 0 .09-.22v-.21a.93.93 0 0 1 .27-.7 6.62 6.62 0 0 1 .62-.66 4.62 4.62 0 0 0 .54-.46 5.58 5.58 0 0 0 .49-.6 2.92 2.92 0 0 0 .36-.73 3.08 3.08 0 0 0 .14-1A2.76 2.76 0 0 0 14.68 5zM12.3 12.22h-1.89a.29.29 0 0 0-.22.09.33.33 0 0 0-.09.22v1.84a.31.31 0 0 0 .09.22.26.26 0 0 0 .22.1h1.89a.33.33 0 0 0 .23-.09.34.34 0 0 0 .1-.23v-1.84a.34.34 0 0 0-.1-.22.33.33 0 0 0-.23-.09zM6.68 12.22H4.79a.29.29 0 0 0-.22.09.33.33 0 0 0-.09.22v1.84a.35.35 0 0 0 .08.22.28.28 0 0 0 .23.1h1.89a.35.35 0 0 0 .23-.09.34.34 0 0 0 .1-.23v-1.84a.34.34 0 0 0-.1-.22.35.35 0 0 0-.23-.09zM8.28 4.06a3.63 3.63 0 0 0-1.09-.56A3.86 3.86 0 0 0 6 3.31a3.78 3.78 0 0 0-1.2.17 6.65 6.65 0 0 0-.9.37 2.84 2.84 0 0 0-.55.38l-.21.19a.31.31 0 0 0 0 .41L4.09 6a.31.31 0 0 0 .21.13.54.54 0 0 0 .25-.06l.1-.07a1.46 1.46 0 0 1 .29-.18 2.2 2.2 0 0 1 .41-.18 1.57 1.57 0 0 1 .49-.07 1.13 1.13 0 0 1 .73.24.74.74 0 0 1 .3.6 1 1 0 0 1-.26.68c-.17.19-.38.4-.64.64a6.4 6.4 0 0 0-.49.42 2.7 2.7 0 0 0-.48.57 2.94 2.94 0 0 0-.34.66 2.7 2.7 0 0 0-.12.84v.35a.29.29 0 0 0 .09.22.28.28 0 0 0 .22.1h1.76a.26.26 0 0 0 .21-.1.29.29 0 0 0 .09-.22v-.21a1 1 0 0 1 .27-.7A8.22 8.22 0 0 1 7.84 9a5.68 5.68 0 0 0 .52-.48 7 7 0 0 0 .48-.6 3 3 0 0 0 .37-.73 3.1 3.1 0 0 0 .13-1 2.67 2.67 0 0 0-1.06-2.13z"/>\n'),x='\n  <path class="'.concat(h,'" opacity=".3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"/>\n  <path class="').concat(o,'" fill="#1baca6" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"/>\n  <path class="').concat(l,'" opacity=".2" d="M12.57,14.85a.3.3,0,0,1-.1.24.32.32,0,0,1-.23.1h-2a.3.3,0,0,1-.24-.1.41.41,0,0,1-.08-.24V13a.32.32,0,0,1,.09-.23.29.29,0,0,1,.23-.1h2a.32.32,0,0,1,.23.1.29.29,0,0,1,.1.23Zm-.11-3.93a.33.33,0,0,1-.1.23.34.34,0,0,1-.23.08H10.35a.32.32,0,0,1-.34-.31L9.86,4.15A.42.42,0,0,1,10,3.91a.3.3,0,0,1,.24-.1H12.3a.36.36,0,0,1,.25.1.42.42,0,0,1,.09.24Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M12.57,14.35a.3.3,0,0,1-.1.24.32.32,0,0,1-.23.1h-2a.3.3,0,0,1-.24-.1.41.41,0,0,1-.08-.24v-1.9a.32.32,0,0,1,.09-.23.29.29,0,0,1,.23-.1h2a.32.32,0,0,1,.23.1.29.29,0,0,1,.1.23Zm-.11-3.93a.33.33,0,0,1-.1.23.34.34,0,0,1-.23.08H10.35a.32.32,0,0,1-.34-.31L9.86,3.65A.42.42,0,0,1,10,3.41a.3.3,0,0,1,.24-.1H12.3a.36.36,0,0,1,.25.1.42.42,0,0,1,.09.24Z"/>\n  <path class="').concat(l,'" opacity=".2" d="M8.07,14.85a.3.3,0,0,1-.1.24.32.32,0,0,1-.23.1h-2a.3.3,0,0,1-.24-.1.41.41,0,0,1-.08-.24V13a.32.32,0,0,1,.09-.23.29.29,0,0,1,.23-.1h2a.32.32,0,0,1,.23.1.29.29,0,0,1,.1.23ZM8,10.92a.33.33,0,0,1-.1.23.34.34,0,0,1-.23.08H5.85a.32.32,0,0,1-.34-.31L5.36,4.15a.42.42,0,0,1,.09-.24.3.3,0,0,1,.24-.1H7.8a.36.36,0,0,1,.25.1.42.42,0,0,1,.09.24Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M8.07,14.35a.3.3,0,0,1-.1.24.32.32,0,0,1-.23.1h-2a.3.3,0,0,1-.24-.1.41.41,0,0,1-.08-.24v-1.9a.32.32,0,0,1,.09-.23.29.29,0,0,1,.23-.1h2a.32.32,0,0,1,.23.1.29.29,0,0,1,.1.23ZM8,10.42a.33.33,0,0,1-.1.23.34.34,0,0,1-.23.08H5.85a.32.32,0,0,1-.34-.31L5.36,3.65a.42.42,0,0,1,.09-.24.3.3,0,0,1,.24-.1H7.8a.36.36,0,0,1,.25.1.42.42,0,0,1,.09.24Z"/>\n'),w='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#95bb4a"/>\n  <path class="').concat(l,'" d="M15.11 6.81l-5.66 5.66-1.66 1.65a.38.38 0 0 1-.55 0L2.89 9.78a.39.39 0 0 1 0-.55l1.39-1.39a.39.39 0 0 1 .55 0l2.69 2.69 5.65-5.65a.38.38 0 0 1 .55 0l1.39 1.38a.39.39 0 0 1 0 .55z" opacity=".2"/>\n  <path class="').concat(a,'" d="M15.11 6.31L9.45 12l-1.66 1.62a.38.38 0 0 1-.55 0L2.89 9.28a.39.39 0 0 1 0-.55l1.39-1.39a.39.39 0 0 1 .55 0L7.52 10l5.65-5.65a.38.38 0 0 1 .55 0l1.39 1.38a.39.39 0 0 1 0 .58z" fill="#fff"/>\n'),S='\n  <path class="'.concat(h,'" opacity=".3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"/>\n  <path class="').concat(o,'" fill="#5a9ac0" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"/>\n  <path class="').concat(l,'" opacity=".2" d="M15,6.8,7.81,14a.38.38,0,0,1-.55,0L3,9.73a.41.41,0,0,1,0-.55L4.36,7.81a.4.4,0,0,1,.54,0l2.63,2.64L13.1,4.9a.38.38,0,0,1,.55,0L15,6.25A.38.38,0,0,1,15,6.8Z"/>\n  <path class="').concat(a,'" fill="#ffffff" d="M15,6.3,7.81,13.49a.38.38,0,0,1-.55,0L3,9.23a.41.41,0,0,1,0-.55L4.36,7.31a.4.4,0,0,1,.54,0L7.53,10,13.1,4.4a.38.38,0,0,1,.55,0L15,5.75A.38.38,0,0,1,15,6.3Z"/>\n'),M='\n  <path class="'.concat(h,'" opacity=".3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z" />\n  <path class="').concat(o,'" fill="#95bb4a" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z" />\n  <path class="').concat(l,'" opacity=".1"\n    d="M4.44,5.41v7.68a1,1,0,0,0,1,1h7.68a1,1,0,0,0,1-1V5.41a1,1,0,0,0-1-1H5.41A1,1,0,0,0,4.44,5.41ZM12,12H6.53V6.53H12Z" />\n  <path class="').concat(a,'" fill="#ffffff"\n    d="M4.19,5.16v7.68a1,1,0,0,0,1,1h7.68a1,1,0,0,0,1-1V5.16a1,1,0,0,0-1-1H5.16A1,1,0,0,0,4.19,5.16Zm7.53,6.56H6.28V6.28h5.44Z" />\n'),T='\n  <path class="'.concat(h,'" opacity=".3" d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"/>\n  <path class="').concat(o,'" fill="#a09f9e" d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M9,2.5A6.5,6.5,0,1,0,15.5,9,6.5,6.5,0,0,0,9,2.5Z"/>\n  <path class="').concat(o,'" fill="#a09f9e" d="M9,5a4,4,0,1,0,4,4A4,4,0,0,0,9,5Z"/>\n  <path class="').concat(a,'" fill="#fff" d="M9,7.5A1.5,1.5,0,1,0,10.5,9,1.5,1.5,0,0,0,9,7.5Z"/>\n'),P='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#f0c15c"/>\n  <path class="').concat(l,'" opacity=".3" d="M13.51 14.85a.3.3 0 0 1-.1.24.33.33 0 0 1-.24.1h-2a.29.29 0 0 1-.23-.1.36.36 0 0 1-.09-.24V13a.33.33 0 0 1 .1-.23.27.27 0 0 1 .22-.1h2a.33.33 0 0 1 .24.1.29.29 0 0 1 .1.23zm-.12-3.93a.29.29 0 0 1-.1.23.31.31 0 0 1-.23.08h-1.77a.31.31 0 0 1-.34-.31l-.15-6.77a.49.49 0 0 1 .08-.24.32.32 0 0 1 .25-.1h2.11a.38.38 0 0 1 .25.1.42.42 0 0 1 .09.24z"/>\n  <path class="').concat(a,'" fill="#fff" d="M13.51 14.35a.3.3 0 0 1-.1.24.33.33 0 0 1-.24.1h-2a.29.29 0 0 1-.23-.1.36.36 0 0 1-.09-.24v-1.9a.33.33 0 0 1 .1-.23.27.27 0 0 1 .22-.1h2a.33.33 0 0 1 .24.1.29.29 0 0 1 .1.23zm-.12-3.93a.29.29 0 0 1-.1.23.31.31 0 0 1-.23.08h-1.77a.31.31 0 0 1-.34-.31l-.15-6.77a.49.49 0 0 1 .08-.24.32.32 0 0 1 .25-.1h2.11a.38.38 0 0 1 .25.1.42.42 0 0 1 .09.24z"/>\n  <path class="').concat(l,'" opacity=".3" d="M7.5 14.87a.33.33 0 0 1-.09.23.35.35 0 0 1-.23.09H5.29a.28.28 0 0 1-.23-.1.35.35 0 0 1-.06-.22V13a.33.33 0 0 1 .09-.22.29.29 0 0 1 .22-.09h1.87a.35.35 0 0 1 .23.09.33.33 0 0 1 .09.22zm2.21-7.16a3 3 0 0 1-.37.73 7 7 0 0 1-.48.6 5.68 5.68 0 0 1-.52.48 8.22 8.22 0 0 0-.66.64 1 1 0 0 0-.27.7v.21a.29.29 0 0 1-.09.22.26.26 0 0 1-.21.1H5.38a.28.28 0 0 1-.22-.1.29.29 0 0 1-.09-.22v-.35a2.7 2.7 0 0 1 .12-.84 3.39 3.39 0 0 1 .33-.66A3.12 3.12 0 0 1 6 8.67a6.4 6.4 0 0 1 .49-.42c.25-.24.47-.45.64-.64a1 1 0 0 0 .26-.68.74.74 0 0 0-.3-.6 1.14 1.14 0 0 0-.73-.24 1.53 1.53 0 0 0-.49.07 2.2 2.2 0 0 0-.41.18 1.46 1.46 0 0 0-.29.18l-.1.09a.54.54 0 0 1-.25.06.31.31 0 0 1-.21-.13l-1-1.21a.31.31 0 0 1 0-.41l.21-.19a2.84 2.84 0 0 1 .55-.38A6.65 6.65 0 0 1 5.29 4a3.74 3.74 0 0 1 1.2-.17 3.86 3.86 0 0 1 1.2.17 3.75 3.75 0 0 1 1.09.56 2.67 2.67 0 0 1 1.06 2.19 3.1 3.1 0 0 1-.13.96z"/>\n  <path class="').concat(a,'" fill="#fff" d="M7.5 14.37a.33.33 0 0 1-.09.23.35.35 0 0 1-.23.09H5.29a.28.28 0 0 1-.23-.1.35.35 0 0 1-.06-.22v-1.84a.33.33 0 0 1 .09-.22.29.29 0 0 1 .22-.09h1.87a.35.35 0 0 1 .23.09.33.33 0 0 1 .09.22zm2.21-7.16a3 3 0 0 1-.37.73 7 7 0 0 1-.48.6 5.68 5.68 0 0 1-.52.46 8.22 8.22 0 0 0-.66.64 1 1 0 0 0-.27.7v.21a.29.29 0 0 1-.09.22.26.26 0 0 1-.21.1H5.38a.28.28 0 0 1-.22-.1.29.29 0 0 1-.09-.22v-.35a2.7 2.7 0 0 1 .12-.84 3.39 3.39 0 0 1 .33-.66A3.12 3.12 0 0 1 6 8.17a6.4 6.4 0 0 1 .49-.42c.25-.24.47-.45.64-.64a1 1 0 0 0 .26-.68.74.74 0 0 0-.3-.6 1.14 1.14 0 0 0-.73-.24 1.53 1.53 0 0 0-.49.07 2.2 2.2 0 0 0-.41.18 1.46 1.46 0 0 0-.31.16l-.1.09a.54.54 0 0 1-.25.06.31.31 0 0 1-.21-.15l-1-1.21a.31.31 0 0 1 0-.41l.21-.19a2.84 2.84 0 0 1 .55-.38 6.65 6.65 0 0 1 .9-.37 3.74 3.74 0 0 1 1.2-.17 3.86 3.86 0 0 1 1.2.19 3.75 3.75 0 0 1 1.09.56 2.67 2.67 0 0 1 1.1 2.23 3.1 3.1 0 0 1-.13.96z"/>\n'),C='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#c93430"/>\n  <path class="').concat(l,'" d="M14 12.58a.4.4 0 0 1 0 .56l-1.38 1.38a.4.4 0 0 1-.56 0L9 11.44l-3.08 3.08a.4.4 0 0 1-.56 0L4 13.14a.4.4 0 0 1 0-.56L7.06 9.5 4 6.42a.4.4 0 0 1 0-.56l1.36-1.38a.4.4 0 0 1 .56 0L9 7.56l3.08-3.08a.4.4 0 0 1 .56 0L14 5.86a.4.4 0 0 1 0 .56L10.94 9.5z" opacity=".2"/>\n  <path class="').concat(a,'" d="M14 12.08a.4.4 0 0 1 0 .56L12.64 14a.4.4 0 0 1-.56 0L9 10.94 5.92 14a.4.4 0 0 1-.56 0L4 12.64a.4.4 0 0 1 0-.56L7.06 9 4 5.92a.4.4 0 0 1 0-.56L5.36 4a.4.4 0 0 1 .56 0L9 7.06 12.08 4a.4.4 0 0 1 .56 0L14 5.36a.4.4 0 0 1 0 .56L10.94 9z" fill="#f1f2f2"/>\n'),A='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#dd5357"/>\n  <path class="').concat(l,'" d="M14 12.58a.4.4 0 0 1 0 .56l-1.38 1.38a.4.4 0 0 1-.56 0L9 11.44l-3.08 3.08a.4.4 0 0 1-.56 0L4 13.14a.4.4 0 0 1 0-.56L7.06 9.5 4 6.42a.4.4 0 0 1 0-.56l1.36-1.38a.4.4 0 0 1 .56 0L9 7.56l3.08-3.08a.4.4 0 0 1 .56 0L14 5.86a.4.4 0 0 1 0 .56L10.94 9.5z" opacity=".2"/>\n  <path class="').concat(a,'" d="M14 12.08a.4.4 0 0 1 0 .56L12.64 14a.4.4 0 0 1-.56 0L9 10.94 5.92 14a.4.4 0 0 1-.56 0L4 12.64a.4.4 0 0 1 0-.56L7.06 9 4 5.92a.4.4 0 0 1 0-.56L5.36 4a.4.4 0 0 1 .56 0L9 7.06 12.08 4a.4.4 0 0 1 .56 0L14 5.36a.4.4 0 0 1 0 .56L10.94 9z" fill="#f1f2f2"/>\n'),O='\n  <path class="'.concat(h,'" d="M9 .5a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" opacity=".3"/>\n  <path class="').concat(o,'" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#e6912c"/>\n  <path class="').concat(l,'" d="M9.82 14.87a.34.34 0 0 1-.1.23.33.33 0 0 1-.23.09H7.6a.26.26 0 0 1-.22-.1.31.31 0 0 1-.09-.22V13a.33.33 0 0 1 .09-.22.29.29 0 0 1 .22-.09h1.89a.33.33 0 0 1 .23.09.34.34 0 0 1 .1.22zM12 7.71a3.31 3.31 0 0 1-.36.73 7.11 7.11 0 0 1-.49.6 4.62 4.62 0 0 1-.52.48 6.62 6.62 0 0 0-.65.64.93.93 0 0 0-.27.7v.21a.29.29 0 0 1-.09.22.28.28 0 0 1-.22.1H7.69a.3.3 0 0 1-.22-.1.29.29 0 0 1-.09-.22v-.35a2.43 2.43 0 0 1 .13-.84 2.55 2.55 0 0 1 .33-.66 3.08 3.08 0 0 1 .45-.55c.16-.15.33-.29.49-.42s.47-.45.64-.64a1 1 0 0 0 .26-.68.74.74 0 0 0-.3-.6 1.13 1.13 0 0 0-.73-.24 1.57 1.57 0 0 0-.49.07 2.54 2.54 0 0 0-.41.18 1.46 1.46 0 0 0-.29.18l-.1.09a.53.53 0 0 1-.24.06c-.12 0-.19-.07-.21-.13l-1-1.21a.3.3 0 0 1 0-.41l.21-.19a2.67 2.67 0 0 1 .56-.38A5.72 5.72 0 0 1 7.61 4a3.68 3.68 0 0 1 1.19-.19A3.86 3.86 0 0 1 10 4a3.63 3.63 0 0 1 1.09.56 2.79 2.79 0 0 1 .78.92 2.76 2.76 0 0 1 .29 1.27 3.08 3.08 0 0 1-.16.96z" opacity=".2"/>\n  <path class="').concat(a,'" d="M9.82 14.37a.34.34 0 0 1-.1.23.33.33 0 0 1-.23.09H7.6a.26.26 0 0 1-.22-.1.31.31 0 0 1-.09-.22v-1.84a.33.33 0 0 1 .09-.22.29.29 0 0 1 .22-.09h1.89a.33.33 0 0 1 .23.09.34.34 0 0 1 .1.22zM12 7.21a3.31 3.31 0 0 1-.36.73 7.11 7.11 0 0 1-.49.6 4.62 4.62 0 0 1-.52.48 6.62 6.62 0 0 0-.65.64.93.93 0 0 0-.27.7v.21a.29.29 0 0 1-.09.22.28.28 0 0 1-.22.1H7.69a.3.3 0 0 1-.22-.1.29.29 0 0 1-.09-.22v-.35a2.43 2.43 0 0 1 .13-.84 2.55 2.55 0 0 1 .33-.66 3.08 3.08 0 0 1 .45-.55c.16-.15.33-.29.49-.42s.47-.45.64-.64a1 1 0 0 0 .26-.68.74.74 0 0 0-.3-.6 1.13 1.13 0 0 0-.73-.24 1.57 1.57 0 0 0-.49.07 2.54 2.54 0 0 0-.41.18 1.46 1.46 0 0 0-.29.16l-.1.09a.53.53 0 0 1-.24.06C7 6.14 6.93 6.1 6.91 6l-1-1.21a.3.3 0 0 1 0-.41l.21-.19a2.67 2.67 0 0 1 .56-.38 5.72 5.72 0 0 1 .9-.37 3.68 3.68 0 0 1 1.22-.13 3.86 3.86 0 0 1 1.2.19 3.63 3.63 0 0 1 1.09.56 2.79 2.79 0 0 1 .78.92 2.76 2.76 0 0 1 .29 1.27 3.08 3.08 0 0 1-.16.96z" fill="#fff"/>\n'),L='\n    <path class="'.concat(h,'" d="M6.33,16.85l-6-12A3,3,0,0,1,3,.5H15a3,3,0,0,1,2.67,4.33l-6,12A3,3,0,0,1,6.33,16.85Z" opacity=".3"/>\n    <path class="').concat(o,'" d="M6.33,16.35l-6-12A3,3,0,0,1,3,0H15a3,3,0,0,1,2.67,4.33l-6,12A3,3,0,0,1,6.33,16.35Z" fill="#c93430"/>\n    <path class="').concat(l,'" d="M8.92,2,5.9,9.3A.14.14,0,0,0,6,9.48h2.6a.14.14,0,0,1,.14.14l0,5.4c0,.12.18.19.23.08l3.7-7.92A.13.13,0,0,0,12.53,7H9.64a.14.14,0,0,1-.14-.13L9.15,2.05C9.15,1.93,9,1.87,8.92,2Z" opacity=".2"/>\n    <path class="').concat(a,'" d="M8.92,1.48,5.9,8.8A.14.14,0,0,0,6,9h2.6a.14.14,0,0,1,.14.14l0,5.4c0,.12.18.19.23.08l3.7-7.92a.13.13,0,0,0-.13-.18H9.64a.14.14,0,0,1-.14-.13L9.15,1.55C9.15,1.43,9,1.37,8.92,1.48Z" fill="#fff"/>\n'),I='\n  <path\n    class="'.concat(h,'"\n    d="M9,.5a9,9,0,1,0,9,9A9,9,0,0,0,9,.5Z"\n    opacity=".3"></path>\n\n  <path\n    class="').concat(o,'"\n    d="M9,0a9,9,0,1,0,9,9A9,9,0,0,0,9,0Z"\n    fill="#8a8886"></path>\n\n  <path\n    d="M3.59,10.23a.25.25,0,0,1,.24-.31l1.08-.15a.49.49,0,0,1,.2.06.25.25,0,0,1,.11.2,3.58,3.58,0,0,0,.42,1.28,3.68,3.68,0,0,0,.84,1.06,3.76,3.76,0,0,0,1.16.69A3.9,3.9,0,0,0,9,13.31,3.58,3.58,0,0,0,10.47,13a3.94,3.94,0,0,0,1.22-.81A4.09,4.09,0,0,0,12.5,11a3.74,3.74,0,0,0,0-3,4.09,4.09,0,0,0-.81-1.2A3.94,3.94,0,0,0,10.47,6,3.65,3.65,0,0,0,9,5.69a3.61,3.61,0,0,0-1.23.21,3.23,3.23,0,0,0-1.09.6L7.77,7.59c.16.15.21.29.16.38s-.18.17-.4.17H4.37a.36.36,0,0,1-.2,0A.76.76,0,0,1,4,8a.52.52,0,0,1-.17-.38V4.45c0-.2.06-.33.17-.38s.25,0,.41.16L5.51,5.34a5.83,5.83,0,0,1,1.64-1A5.19,5.19,0,0,1,9,4.05a5.3,5.3,0,0,1,2.12.44,5,5,0,0,1,1.73,1.16A5.59,5.59,0,0,1,14,7.38a5.23,5.23,0,0,1,.44,2.12A5.16,5.16,0,0,1,14,11.62a5.59,5.59,0,0,1-1.16,1.73,5.32,5.32,0,0,1-1.73,1.18A5.64,5.64,0,0,1,9,15a5.23,5.23,0,0,1-1.94-.37A5.27,5.27,0,0,1,4.21,12.1,5.1,5.1,0,0,1,3.59,10.23Z"\n    class="').concat(l,'"\n    opacity=".3"></path>\n\n  <path\n    d="M3.59,9.73a.25.25,0,0,1,.24-.31l1.08-.15a.49.49,0,0,1,.2.06.25.25,0,0,1,.11.2,3.58,3.58,0,0,0,.42,1.28,3.68,3.68,0,0,0,.84,1.06,3.76,3.76,0,0,0,1.16.69A3.9,3.9,0,0,0,9,12.81a3.58,3.58,0,0,0,1.47-.31,3.94,3.94,0,0,0,1.22-.81,4.09,4.09,0,0,0,.81-1.2,3.74,3.74,0,0,0,0-3,4.09,4.09,0,0,0-.81-1.2,3.94,3.94,0,0,0-1.22-.81A3.65,3.65,0,0,0,9,5.19a3.61,3.61,0,0,0-1.23.21A3.23,3.23,0,0,0,6.68,6L7.77,7.09c.16.15.21.29.16.38s-.18.17-.4.17H4.37a.36.36,0,0,1-.2,0A.76.76,0,0,1,4,7.49a.52.52,0,0,1-.17-.38V4c0-.2.06-.33.17-.38s.25,0,.41.16L5.51,4.84a5.83,5.83,0,0,1,1.64-1A5.19,5.19,0,0,1,9,3.55,5.3,5.3,0,0,1,11.12,4a5,5,0,0,1,1.73,1.16A5.59,5.59,0,0,1,14,6.88,5.23,5.23,0,0,1,14.45,9,5.16,5.16,0,0,1,14,11.12a5.59,5.59,0,0,1-1.16,1.73A5.32,5.32,0,0,1,11.12,14,5.64,5.64,0,0,1,9,14.45a5.23,5.23,0,0,1-1.94-.37A5.27,5.27,0,0,1,4.21,11.6,5.1,5.1,0,0,1,3.59,9.73Z"\n    class="').concat(a,'"\n    fill="#ffffff"></path>\n'),R=i("./web/core/api/move-list/config.js"),j=i("./utils/translation/translation.helper.js"),N="//images.chesscomfiles.com",k={ALMOST_CORRECT:{color:"#8a8886",icon:I,type:"Undo"},BEST_MOVE:{color:"#9EBA5A",icon:g,key:"bestMove",label:Object(j.b)("Best Move"),phrase:Object(j.b)("is best"),type:"BestMove"},BLUNDER:{annotation:R.c.$4,color:"#b33430",icon:_,key:"blunder",label:Object(j.b)("Blunder"),phrase:Object(j.b)("is a blunder"),type:"Blunder"},BOOK:{icon:y,key:"book",label:Object(j.b)("Book"),phrase:Object(j.b)("is a book move"),type:"Book"},BRILLIANT:{color:"#1baca6",icon:x,key:"brilliant",label:Object(j.b)("Brilliant"),phrase:Object(j.b)("is brilliant"),type:"Brilliant"},CORRECT:{color:"#acce59",key:"correct",icon:w,label:Object(j.b)("Correct"),type:"Correct"},CRITICAL:{key:"critical",label:Object(j.b)("Critical")},EXCELLENT:{color:"#5a9ac0",icon:S,key:"excellent",label:Object(j.b)("Excellent"),phrase:Object(j.b)("is excellent"),type:"Excellent"},FORCED:{icon:M,key:"forced",label:Object(j.b)("Forced"),phrase:Object(j.b)("is forced"),type:"Forced"},GOOD:{icon:T,key:"good",label:Object(j.b)("Good"),phrase:Object(j.b)("is good"),type:"Good"},INACCURACY:{annotation:R.c.$6,color:"#f0c15c",icon:P,key:"inaccuracy",label:Object(j.b)("Inaccuracy"),phrase:Object(j.b)("is an inaccuracy"),type:"Inaccuracy"},INCORRECT:{color:"#c93430",icon:C,key:"incorrect",label:Object(j.b)("Incorrect"),type:"Incorrect"},MISSED_WIN:{color:"#dd5357",icon:A,key:"missedWin",label:Object(j.b)("Missed Win"),phrase:Object(j.b)("is a missed win"),type:"MissedWin"},MISTAKE:{annotation:R.c.$2,color:"#e6912c",icon:O,key:"mistake",label:Object(j.b)("Mistake"),phrase:Object(j.b)("is a mistake"),type:"Mistake"},STAR:{color:"#e6912c",icon:g,key:"star",type:"BestMove"},THREAT:{color:"#c93430",icon:L,key:"threat",label:Object(j.b)("Threat"),phrase:Object(j.b)("is threat"),type:"Threat"}},D={COORDINATE_FILE:".coordinates .letter"},B={INSIDE:"inside",NONE:null,OUTSIDE:"outside"},G=("".concat(N,"/chess-themes/boards"),"".concat(N,"/chess-themes/pieces"),"".concat(N,"/chess-themes/sounds"),{boardStyle:"green",pieceStyle:"neo",highlightColor:"#FFFF33",highlightOpacity:.5,arrowColor:"rgb(255, 168, 0)",flipped:!1,files:8,ranks:8}),H={DARK_MODE_CHANGE:"darkModeChange"},V=[{key:0,label:Object(j.b)("None"),value:B.NONE},{key:1,label:Object(j.b)("Inside"),value:B.INSIDE},{key:2,label:Object(j.b)("Outside"),value:B.OUTSIDE}],U={pieces:["real3d"],animations:["arcade","natural"]},z=[{key:"0",value:null},{key:"1",value:"inside"},{key:"2",value:"outside"}],W={board:".board-board",resize:".board-controls",sidebar:".board-sidebar"},q={minSidebarWidth:300,boardPaddingLeft:30}},"./web/core/api/board/helper/get-board-element.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a})),i.d(r,"b",(function(){return l}));var o=i("./web/core/api/board/config.js"),a=function getBoardContainerElement(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=o.g.board.substr(1),i=document.getElementsByClassName(r)[t];return i||null},l=function getBoardElement(){var t=a();if(!t)return null;var r=t.childNodes;return Array.from(r).find((function(t){return 1===t.nodeType}))}},"./web/core/api/board/helper/index.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a})),i.d(r,"b",(function(){return g})),i.d(r,"c",(function(){return S.a})),i.d(r,"d",(function(){return w})),i.d(r,"e",(function(){return M})),i.d(r,"f",(function(){return T})),i.d(r,"g",(function(){return P})),i.d(r,"h",(function(){return C})),i.d(r,"i",(function(){return A}));var o=i("./web/core/api/board/config.js"),a=function animationChangeRequiresRefresh(t,r){return o.j.animations.indexOf(t)>-1||o.j.animations.indexOf(r)>-1},l=i("./chessboard/src/game/index.js"),h=i("./ui/components/icons/svg/make-svg.js"),g=function buildEffect(t){var r=t.icon,i=t.node;return{position:{x:"right",y:"top"},square:t.square||l.a.convertLanToFileRanks("".concat(i.from).concat(i.to)).toFileRank,template:Object(h.a)({path:r,size:"100%"})}},y=i("./utils/http/index.js"),_=i("./utils/router.js"),x=function seekGifUntilReady(t,r){y.default.get(t).then((function(i){202===i.status?setTimeout(seekGifUntilReady.bind(null,t,r),2e3):200===i.status&&r(t)})).catch((function(){r(t)}))},w=function getCustomAnimatedGif(t){var r=t.tcn,i=t.flip,o=t.isChess960,a=t.initialPosition,l=_.a.generate("web_game_callback_create_dyn_gif_url"),h={tcn:r,flip:i,isChess960:o,initialSetup:a};return y.default.post(l,h).then((function(t){return new Promise((function(r){x(t.data,r)}))}))},S=i("./web/core/api/board/helper/get-board-element.js"),M=function getShareUrl(){var t=window.document.documentElement.lang,r=window.location,i=t.split("-")[0];return r.pathname.split("/")[1]===i||"en"===i?r.href:"".concat(r.protocol,"//").concat(r.hostname,"/").concat(i).concat(r.pathname)},T=function normalizeFen(t){var r=t;-1!==r.indexOf("|")&&(r=r.split("|")[0].trim());var i=r.split(" "),o=i[0].split("/");return o.length>8&&(o.pop(),i[0]=o.join("/"),r=i.join(" ")),r},P=function pieceChangeRequiresRefresh(t,r){var i=t===r,a=o.j.pieces.indexOf(t)>-1||o.j.pieces.indexOf(r)>-1;return!i&&a},C=function setBoardSize(t){var r=document.querySelector(o.g.board);r&&"number"==typeof t&&(r.style.width="".concat(t,"px"))},A=function showBoardResize(){var t=document.querySelector(o.g.resize);t&&(t.style.visibility="visible")}},"./web/core/api/board/share-menu/config.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return o})),i.d(r,"a",(function(){return a}));var o={PGN:{key:"pgn",isVisible:function isVisible(){return!0},label:"PGN"},IMAGE:{key:"image",isVisible:function isVisible(){return!0},label:"Image"},GIF:{key:"gif",isVisible:function isVisible(t){return t.showGif},label:"Animated Gif"},EMBED:{key:"embed",isVisible:function isVisible(){return!0},label:"Embed"},EVENT:{key:"event",isVisible:function isVisible(){return!0},label:"Event"}},a=[o.PGN.key,o.IMAGE.key,o.GIF.key,o.EMBED.key]},"./web/core/api/content/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return g})),i.d(r,"b",(function(){return y})),i.d(r,"c",(function(){return _})),i.d(r,"g",(function(){return x})),i.d(r,"e",(function(){return w})),i.d(r,"d",(function(){return S})),i.d(r,"f",(function(){return M}));var o,a,l=i("./utils/router.js"),h=i("./utils/translator.js"),g={ARIA_CONTROLS:"aria-controls",ARIA_SELECTED:"aria-selected",AVATAR:"data-avatar",CUSTOM_BTN_CLASS:"data-custom-btn-class",CUSTOM_COLLAPSE_CLASS:"data-custom-collapse-class",DARK_MODE:"data-dark-mode",IS_V5:"data-is-v5",HIDDEN:"hidden",ICON_BUTTON:"data-icon-button",PAGE_V5:"data-page-v5",SLOTS:"data-stats-slots",STATS:"data-stats",SURVEY_DATA:"data-survey",SURVEY_VOTED:"data-voted-survey",USERNAME:"data-username",VS_STATS:"data-vs-stats"},y={getArticleAuthors:"web_article_callback_list_authors",getBlogAuthors:"web_blog_callback_authors",getContent:"web_content_callback_load_more",getNewsAuthors:"web_news_callback_list_authors",setArticleFeature:"web_content_callback_feature_article",setBlogFeature:"web_blog_callback_feature",setLessonsFeature:"web_content_callback_feature_lesson_course",setNewsFeature:"web_content_callback_feature_news",setVideoFeature:"web_content_callback_feature_chess_video"},_={BLOG:"blog",CSRF_TOKEN:null===(o=window.context)||void 0===o||null===(a=o.csrf)||void 0===a?void 0:a.token,DARK_MODE:"dark-mode",LESSONS:"lessons",NEWS:"news",VIDEO:"video",GRID_VIEW:"grid",LIST_VIEW:"list",LOCALE:window.context&&window.context.locale||"en_US",LOGGED_IN:window.context&&window.context.user,SUPPORT_DARK_MODE:"support-dark-mode",TIME:{hour:36e5},USERNAME:window.context&&window.context.user?window.context.user.username:null},x={category:function category(t){return h.a.trans(t,{},"dynamic")},daysOfWeek:[h.a.trans("Sunday"),h.a.trans("Monday"),h.a.trans("Tuesday"),h.a.trans("Wednesday"),h.a.trans("Thursday"),h.a.trans("Friday"),h.a.trans("Saturday")],loading:h.a.trans("Loading..."),months:[h.a.trans("January"),h.a.trans("February"),h.a.trans("March"),h.a.trans("April"),h.a.trans("May"),h.a.trans("June"),h.a.trans("July"),h.a.trans("August"),h.a.trans("September"),h.a.trans("October"),h.a.trans("November"),h.a.trans("December")],noResult:h.a.trans("No results found."),pleaseEnter:function pleaseEnter(t){return h.a.trans("Please enter %number% or more characters",{"%number%":t})},showMore:h.a.trans("More"),showLess:h.a.trans("Less")},w={AMPLITUDE_LOGGER:"amplitude-logger",BOARD_POPOVER:"v-board-popover",CAPTCHA:"captcha",COLLAPSE:"v-toggle-collapse",COLLAPSED:"toggle-collapsed",CONTENT_AD:"content-ad",CONTENT_CATEGORY_SELECT:"content-category-select",CONTENT_LANGUAGE_SELECT:"content-language-select",CONFIRM_OPEN:"confirm-open",CONFIRM_POPOVER:"v-confirm-popover",CONFIRM_POPOVER_INLINE:"confirm-popover-inline",DONATE_MODAL:"donate-modal",FEATURE_SIDEBAR_LINK:"post-category-link-feature",FILTERS:"page-filters",FOLLOW_UNFOLLOW_AUTHOR:"follow-unfollow-author",FORM_DATEPICKER:"v-datepicker",FORM_DROPDOWN:"form-dropdown",GAME_PREVIEW:"game-preview",GIFT_MEMBERSHIP_MODAL:"gift-membership-modal",HEADLINE_SIDEBAR_LINK:"post-category-link-headline",HIDDEN:"toggle-hidden",LANGUAGE_DROPDOWN:"post-view-languages",MESSAGE_PARENT:"vue-message",NAVIGATION_FOOTER:"navigation-footer",NEW_GAME:"new-game",PAGINATION_BOTTOM:"pagination-bottom",PAGINATION_TOP:"pagination-top",PAGINATION_SCROLL_TOP:".pagination-top",POST_AUTHOR_FOLLOW:"post-author-follow",POST_CAN_EDIT_URL:"post-can-edit-url",POST_EDIT_URL:"post-edit-url",POST_EDIT_URL_FIELD:"post-edit-url-field",POST_IMAGE_BUTTON:"image-upload-button",POST_IMAGE_THUMBNAIL:"image-upload-thumbnail",SCROLL_TOP_ANCHOR:"scroll-top-anchor",SHORT_SIDEBAR_AD_BOTTOM:"short-sidebar-ad-bottom",SHORT_SIDEBAR_AD_TOP:"short-sidebar-ad-top",SIDEBAR_STATS:"sidebar-stats",SIDEBAR_SURVEY:"sidebar-survey",SIDEBAR_TOGGLE_BUTTON_TEXT:"toggle-content-button-text",SIDEBAR_TOGGLE_ICON:"toggle-content-icon",SIDEBAR_USER_ITEMS:"sidebar-users-grid-toggle-item",SIDEBAR_USERS_TOGGLE_BUTTON:"toggle-content-button",STAT_CHART:"stat-chart",TABS_BUTTON:"v5-tabs-button",TABS_PANEL:"v5-tabs-panel",TIMEZONES:"page-timezones",TOOLTIP:"v-tooltip",TOOLTIP_CLASS:"tooltip",TOOLTIP_TOP:"top",USER_POPOVER:"v-user-popover",USER_POPOVER_TOOLTIP:"v-user-popover-tooltip",USER_TAGLINE:"post-view-meta-user",VERSION_DROPDOWN:"version-dropdown"},S={CONFIRM_POPOVER_YES:"confirm-popover-yes",SHOW_MODAL:"show-confirm-popover",VOTE_COUNTED:"vote-counted",VIEW_CHANGE:"view-change",VIEW_GRID:"view-grid",VIEW_LIST:"view-list"},M={changeContentLanguage:function changeContentLanguage(){return l.a.generate("web_user_callback_set_content_language")},enPassant:function enPassant(){return l.a.generate("web_article_view",{url:"how-to-capture-en-passant"})},inviteLink:function inviteLink(t,r,i){return l.a.generate(t,{url:r,secret:i})},loginPage:l.a.generate("web_security_login_and_go"),redirectToLoginPage:function redirectToLoginPage(t){return l.a.generate("web_security_login_and_go",{redirectUrl:t})},surveyVote:function surveyVote(t,r){return l.a.generate("web_survey_callback_vote",{id:t,optionId:r})},teamMatch:function teamMatch(t){return l.a.generate("web_team_match_view",{match:t})},tournament:function tournament(t){return l.a.generate("web_tournament_view",{url:t})},userProfile:function userProfile(t){return l.a.generate("web_member_view",{username:t})}}},"./web/core/api/content/helpers/generate-route.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a}));var o=i("./utils/router.js"),a=function generateRoute(t,r,i){var a=t,l=r;if(i){var h=document.querySelector("[data-url-locale]"),g=h&&h.getAttribute("data-url-locale"),y=g&&"en"!==g.split("_")[0]&&g.split("_")[0];y&&l&&(a="i18n_".concat(a),l._locale=y)}return o.a.generate(a,l)}},"./web/core/api/diagram-editor/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return l})),i.d(r,"b",(function(){return h})),i.d(r,"c",(function(){return g})),i.d(r,"d",(function(){return y})),i.d(r,"f",(function(){return _})),i.d(r,"g",(function(){return x})),i.d(r,"e",(function(){return w}));var o=i("./utils/router.js"),a=i("./utils/translator.js"),l=/https?:\/\/(?:www.)?chess(?:-dev|-\d+)?.com\/a\/[\d\w]{12}/,h={CHESS_GAME:"chessGame",CHESS_PROBLEM:"chessProblem",SIMPLE_DIAGRAM:"simpleDiagram"},g=(a.a.trans("We cannot find an analysis with that URL."),a.a.trans("We cannot find the game in that URL."),a.a.trans("Something wrong with loaded PGN, we load it in soft mode"),{daily:"game",game:"game",games:"game_archive",live:"game_live",votechess:"votechess_game"}),y=/https?:\/\/(?:www.)?chess(?:-dev|-\d+)?.com\/(votechess|games|daily|live|game)\/(?:game|view|daily)\/(\d+)\/?/,_=(a.a.trans("No Result (*)"),a.a.trans("White Won (1-0)"),a.a.trans("Black Won (0-1)"),a.a.trans("Draw (1/2-1/2)"),{getChessDiagram:function getChessDiagram(t){return o.a.generate("web_tinymce_get_chessdiagram",{id:t||"new"})},getSavedAnalysisFromUrl:function getSavedAnalysisFromUrl(t){return o.a.generate("web_analysis_game_callback_view",{uuid:t})}}),x=(a.a.trans("White to move"),a.a.trans("Black to move"),{CHESS:"Chess",CHESS960:"Chess960",ODDS_CHESS:"Odds Chess",KING_OF_THE_HILL:"King of the Hill",THREE_CHECK:"Three-Check"}),w={CHESS:"chess",KING_OF_THE_HILL:"kingofthehill",THREE_CHECK:"threecheck"}},"./web/core/api/diagram-editor/helpers.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return y})),i.d(r,"d",(function(){return _})),i.d(r,"e",(function(){return w})),i.d(r,"f",(function(){return S})),i.d(r,"a",(function(){return createTextSetup})),i.d(r,"c",(function(){return T}));i("./node_modules/@babel/runtime/helpers/defineProperty.js"),i("./web/core/api/diagram-editor/service.js");var o=i("./web/core/api/diagram-editor/config.js"),a=(i("./utils/html.transformer.js"),i("./utils/object.js")),l=i("./web/core/api/board/config.js"),h=i("./utils/string.js"),g=i("./chessboard/src/board/board.service.js"),y=(i("./utils/http/handle-error.js"),i("./utils/editor.js"),i("./chessboard/src/game/engine/JCE.js"),function generateImage(t){return'<div style="text-align: center;"><img id="chess_com_diagram_0_'.concat(t,'" class="chessDiagramEditorImg mceItemNonEditable" src="/bundles/web/images/diagram-placeholder.png" name="mce_chessDiagramEditorImg" /></div><br>')}),_=function getDiagramPieceStyle(t){return l.j.pieces.includes(t)?g.a.getDefaultOptions().pieceStyle:t},x=function getDiagramType(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?r?o.b.CHESS_PROBLEM:o.b.CHESS_GAME:o.b.SIMPLE_DIAGRAM},w=function stripDisabledPieceStyles(t){return t.filter((function(t){return!l.j.pieces.includes(t.code)}))},S=function transformCommentDiagramForEditor(t){var r=/(<div *?id="(chess_com_diagram_([0-9]+)_([0-9]+))"[^>]*?>([\s\S]*?)<\/div>)/gm,i=r.exec(t);if(i){var o=t;return o=(o=Object(h.b)(o)).replace(r,y(i[4]))}return t};function splitMultiPgn(t){var r='[Event "';return t.split(r).slice(1).map((function(t){return"".concat(r).concat(t)}))}function createTextSetup(t,r){var i=splitMultiPgn(t),o=r;return i.map((function(t){return o.pgn=t.replace(/\\/g,""),function generateTextSetup(t){return"&-diagramtype:\n    ".concat(t.diagramType,"\n    &-colorscheme:\n    ").concat(t.boardStyle,"\n    &-piecestyle:\n    ").concat(t.pieceStyle,"\n    &-float:\n    left\n    &-flip:\n    ").concat(t.isBoardFlipped,"\n    &-prompt:\n    false\n    &-coords:\n    ").concat(t.coords,"\n    &-size:\n    45\n    &-lastmove:\n\n    &-focusnode:\n    ").concat(t.focusNode,"\n    &-beginnode:\n    ").concat(t.beginNode,"\n    &-endnode:\n    ").concat(t.endNode,"\n    &-hideglobalbuttons:\n    false\n    &-pgnbody:\n    ").concat(t.pgn).replace(/^[^\S\r\n]+/gm,"")}(o)})).join("")}var M=function getLimitMove(t){return Object(a.e)(t)?t.ids.move+1:""},T=function getDiagramConfig(t){var r=t.boardOptions,i=t.hasMoves,o=t.isPuzzle,a=t.nodeLimit;return{beginNode:M(a.begin),boardStyle:r.boardStyle,coords:Boolean(r.coordinates),diagramType:x(i,o),endNode:M(a.end),focusNode:M(a.focus),isBoardFlipped:r.flipBoard,pgn:"",pieceStyle:_(r.pieceStyle)}}},"./web/core/api/diagram-editor/service.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return createChessDiagram})),i.d(r,"b",(function(){return getChessDiagram}));var o=i("./web/core/api/diagram-editor/config.js"),a=i("./utils/http/index.js");function createChessDiagram(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return a.default.post(o.f.getChessDiagram(),{textSetup:t})}function getChessDiagram(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return a.default.post(o.f.getChessDiagram(t),{textSetup:r})}},"./web/core/api/diagram-viewer/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return l})),i.d(r,"b",(function(){return h})),i.d(r,"c",(function(){return g})),i.d(r,"d",(function(){return y})),i.d(r,"e",(function(){return _})),i.d(r,"f",(function(){return x})),i.d(r,"g",(function(){return w})),i.d(r,"h",(function(){return S})),i.d(r,"i",(function(){return M})),i.d(r,"j",(function(){return T})),i.d(r,"k",(function(){return P})),i.d(r,"l",(function(){return C})),i.d(r,"m",(function(){return A})),i.d(r,"n",(function(){return O})),i.d(r,"o",(function(){return L}));var o=i("./web/core/api/content/helpers/generate-route.js"),a=i("./utils/translator.js"),l={FAILED:"Failed",SOLVED:"Solved"},h={ANALYSIS:"analysis",BIG_SCREEN_HEIGHT:567,DESKTOP_WIDTH:768,DIAGRAM_OBSERVED:"data-diagram-observed",MULTI_GAMES_PGN:"multi-games-pgn.pgn",MULTI_PGN_VIEWER:"multi-pgn-viewer",TIMEOUT:500,VARIATION_HEIGHT:25},g={INSIDE:"inside"},y={COMMON:"?",DATE:"????.??.??",DAY:"??",MONTHS:"??",RESULT:"*",YEAR:"????"},_={FORWARD:"forward",BACKWARD:"backward"},x={DAILY_PUZZLE:"Daily Puzzle",DIAGRAM_VIEWER_BLUR:"DIAGRAM_VIEWER_BLUR",DIAGRAM_VIEWER_FOCUS:"DIAGRAM_VIEWER_FOCUS",FOCUS_ON_WIDGET:"focus-on-widget"},w={ANALYSIS:"chess-board-search",DOWNLOAD:"download",FLIPBOARD:"repeat",HINT:"lightbulb",LEFT:"chevron-left",NEXT:"chevron-next",PAUSE:"pause",PLAY:"play",PREVIOUS:"chevron-previous",RESET:"redo",RIGHT:"chevron-right",SHARE:"share",SOLUTION:"circle-question"},S={DOWN:40,ENTER:13,LEFT:37,RIGHT:39,UP:38,X:88},M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],T={BLACK_TO_MOVE:"Black to Move",CORRECT:"Correct!",INCORRECT:"Incorrect",WHITE_TO_MOVE:"White to Move",SOLVED:"Solved!"},P={CHESS_DIAGRAM:"chessDiagramDiv",CHESS_DAILY_PUZZLE:"dailyPuzzleDiv"},C={analysis:Object(o.a)("web_analysis_board_editor"),votechess:Object(o.a)("web_votechess_game")},A={BLACK:"black",DATE:"date",ECO:"eco",EVENT:"event",RESULT:"result",ROUND:"round",SITE:"site",WHITE:"white"},O={analysis:a.a.trans("Go To Analysis"),download:a.a.trans("Download all PGNs"),firstMove:a.a.trans("First Move"),flipBoard:a.a.trans("Flip Board"),hint:a.a.trans("Hint"),lastMove:a.a.trans("Last Move"),nextMove:a.a.trans("Next Move"),playPause:a.a.trans("Play / Pause"),previousMove:a.a.trans("Previous Move"),reset:a.a.trans("Reset"),share:a.a.trans("Share"),solution:a.a.trans("Solution"),unknownPlayer:a.a.trans("Unknown player")},L={DIAGRAM:"diagram",DAILY_PUZZLE:"daily-puzzle"}},"./web/core/api/diagram-viewer/helpers/can-make-puzzle-move.js":function(t,r,i){"use strict";function canMakePuzzleMove(t,r){var i=t.game.tree,o=t.setup.endNode,a=-1===i.selected.move?r:i.selected.move+r;return(0!==o?o:i.lines[0].length)>a}i.d(r,"a",(function(){return canMakePuzzleMove}))},"./web/core/api/diagram-viewer/helpers/get-diagram-id.js":function(t,r,i){"use strict";function getDiagramId(t){var r=t.getAttribute("id")||"",i="";if(r){var o=r.split("_").reverse();i="".concat(o[0],"_").concat(o[1])}return i}i.d(r,"a",(function(){return getDiagramId}))},"./web/core/api/diagram-viewer/helpers/get-diagram-setup.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o=function getDiagramSetup(t){return t&&t.childNodes[0]?function getSetupString(t){return t.data.replace(/^\s+/,"").replace(/\s+$/,"").replace(/^&amp;-/gm,"&-")}(t.childNodes[0]):function getDefaultSetupString(){return["&-diagramtype:\n","simpleDiagram\n","&-colorscheme:\n","green\n","&-piecestyle:\n","neo\n","&-float:\n","left\n","&-flip:\n","false\n","&-size:\n","45\n","&-lastmove:\n","\n","&-focusnode:\n","\n","&-beginnode:\n","\n","&-endnode:\n","\n","&-hideglobalbuttons:\n","false\n","&-pgnbody:\n",'[Event ""]\n','[Site ""]\n','[Date "????.??.??"]\n','[Round ""]\n','[White ""]\n','[Black ""]\n','[Result "*"]\n','[FEN "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"]\n',"\n","*\n"].join("")}()}},"./web/core/api/diagram-viewer/helpers/get-diagram-type.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return getDiagramType}));var o=i("./web/core/api/diagram-viewer/config.js");function getDiagramType(t){return t===".".concat(o.k.CHESS_DAILY_PUZZLE)?o.o.DAILY_PUZZLE:o.o.DIAGRAM}},"./web/core/api/diagram-viewer/helpers/is-chess-game.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return isChessGame}));var o=i("./web/core/api/diagram-editor/config.js");function isChessGame(t){return t===o.b.CHESS_GAME}},"./web/core/api/modals/config.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return g})),i.d(r,"h",(function(){return y})),i.d(r,"a",(function(){return _})),i.d(r,"i",(function(){return x})),i.d(r,"g",(function(){return S})),i.d(r,"e",(function(){return T})),i.d(r,"f",(function(){return P})),i.d(r,"c",(function(){return C})),i.d(r,"d",(function(){return O}));var o,a=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),l=i.n(a),h=i("./utils/translation/translation.helper.js"),g={HIDE_MODAL:"hide-modal",HIDE_MODAL_BACKGROUND_CLICK:"hide-background",HIDE_MODAL_SOCIAL_SHARE:"hide-modal-social-share",LOGIN_OR_REGISTER_MODAL:"LOGIN_OR_REGISTER_MODAL",MODAL_DID_HIDE:"modal-did-hide",SHOW_GUEST_MODAL:"show-guest-modal",SHOW_MODAL_SOCIAL_SHARE:"show-modal-social-share",SHOW_UPGRADE_MODAL:"show-upgrade-modal"},y={AUTHENTICATION_MODAL:"authentication-modal",FIRST_TIME_MODAL:"first-time-modal",GUEST_MODAL:"guest-modal",GUEST_MODAL_TRIGGER:"guest-modal-trigger",UPGRADE_MODAL:"upgrade-modal"},_=(Object(h.b)("Sign up to analyze your games!"),Object(h.b)("Sign up to play Automate!"),Object(h.b)("Sign up to unlock Lessons!"),Object(h.b)("Sign up to use this feature."),Object(h.b)("Sign up to keep solving puzzles!"),Object(h.b)("Sign up to track your progress!"),Object(h.b)("Already have an account? Log in"),{GUEST_MODAL_SLIDES:{analysis:"analysis",automate:"automate",lessons:"lessons",pawn:"pawn",puzzles:"puzzles-learning",stats:"stats"}}),x=["analysis","lessons","puzzles-learning","puzzles-rush","puzzles-battle"],w=[{title:Object(h.b)("Play, Learn and Connect"),subtitle:Object(h.b)("Join millions of chess players."),icon:"pawn"},{title:Object(h.b)("150k+ Puzzles"),subtitle:Object(h.b)("Play every day to improve"),icon:"puzzles-learning"},{title:Object(h.b)("1500+ Lessons"),subtitle:Object(h.b)("Learn from chess masters!"),icon:"lessons"},{title:Object(h.b)("Full Game Analysis"),subtitle:Object(h.b)("Learn from every game!"),icon:"analysis"},{title:Object(h.b)("Get a Rating"),subtitle:Object(h.b)("Save your games!"),icon:"stats"},{title:Object(h.b)("Explore Full Openings"),subtitle:Object(h.b)("See moves played by masters!"),icon:"explorer"}],S="dismissedOnboardModalId",M=[{title:Object(h.b)("Full Analysis"),subtitle:Object(h.b)("Full Report, Accuracy, Key Moments"),icon:"analysis",generic:!0},{title:Object(h.b)("Unlimited Puzzles"),subtitle:Object(h.b)("Solve 8+ Puzzles/day to improve fast"),icon:"puzzles-learning",generic:!0},{title:Object(h.b)("Unlimited Lessons"),subtitle:Object(h.b)("Your step-by-step path to mastery"),icon:"lessons",generic:!0},{title:Object(h.b)("Remove Ads"),subtitle:Object(h.b)("Get the best Chess.com experience"),icon:"no-ads",generic:!0},{title:Object(h.b)("Unlimited Puzzle Rush"),subtitle:Object(h.b)("3 strikes and you're out!"),icon:"puzzles-rush"},{title:Object(h.b)("Unlimited Puzzle Battles"),subtitle:Object(h.b)("Rush another player to win!"),icon:"puzzles-battle"},{title:Object(h.b)("Get Your Own Flair"),subtitle:Object(h.b)("Share your unique personality"),icon:"flair"},{title:Object(h.b)("Explore Full Openings"),subtitle:Object(h.b)("See moves played by masters!"),icon:"explorer"},{title:Object(h.b)("Master Every Position"),subtitle:Object(h.b)("Practice means everything!"),icon:"workout"},{title:Object(h.b)("Unlock All Bots"),subtitle:Object(h.b)("Play vs various skills and styles."),icon:"computer"},{title:Object(h.b)("Unlimited Collections"),subtitle:Object(h.b)("Build and organize your library"),icon:"library",id:12}],T=function getGuestSlides(t){var r=w.find((function(r){return r.icon===t}))||w[0],i=w.filter((function(t){return t!==r}));return i.unshift(r),i},P=function getUpgradeSlides(t){var r=M.find((function(r){return r.icon===t}))||M[0],i=M.filter((function(t){return t.generic&&t!==r}));return i.unshift(r),i},C={CLUBS:"clubs",COMPUTER:"computer",DRILLS:"drills",EXPLORER:"explorer",LESSONS:"lessons",OPENINGS:"openings",SOLO_CHESS:"solo",TOURNAMENTS:"tournaments",VISION:"vision"},A=(o={},l()(o,C.COMPUTER,{bullets:[{icon:"select",text:Object(h.b)("Play bots with various strengths and styles")},{icon:"chip",text:Object(h.b)("Use optional coaching features for insights")},{icon:"user",text:Object(h.b)("Practice at any time - with no pressure")}],icon:"computer",storageKey:"vs_computer_intro_modal_dismissed",subtitle:Object(h.b)("Challenge the computer to an online chess game."),title:Object(h.b)("Chess Computer")}),l()(o,C.DRILLS,{bullets:[{icon:"vscomp",text:Object(h.b)("Play Key Positions vs Computer")},{icon:"lightbulb",text:Object(h.b)("Strengthen Tactical Decisions")},{icon:"chess-move-alt",text:Object(h.b)("Improve Positional Play")}],icon:"drills",storageKey:"drills_intro_modal_dismissed",subtitle:Object(h.b)("Practice playing common positions vs a chess computer."),title:Object(h.b)("Chess Drills")}),l()(o,C.EXPLORER,{bullets:[{icon:"magnifying-glass",text:Object(h.b)("Search millions of master games")},{icon:"user",text:Object(h.b)("Choose specific players to explore")},{icon:"chess-move-alt",text:Object(h.b)("Find winning moves from your games")}],icon:"explorer",storageKey:"explorer_intro_modal_dismissed",subtitleBottom:Object(h.b)("See moves chess masters have made and the outcome of the game from any position."),title:Object(h.b)("Chess Explorer")}),l()(o,C.OPENINGS,{bullets:[{icon:"magnifying-glass",text:Object(h.b)("Search more than 3,000 opening lines")},{icon:"book-open",text:Object(h.b)("Find the perfect chess opening for you")},{icon:"circle-compass",text:Object(h.b)("Explore variations and master chess games")}],icon:"openings",storageKey:"openings_intro_modal_dismissed",subtitleBottom:Object(h.b)("Learn and explore chess openings to try in your chess games."),title:Object(h.b)("Chess Openings")}),l()(o,C.SOLO_CHESS,{bullets:[{icon:"incorrect",text:Object(h.b)("Capture a piece with every move until just one remains")},{icon:"circle-stop",text:Object(h.b)("No piece may capture more than 2 times per puzzle")},{icon:"king-black",text:Object(h.b)("If there is a King on the board, it must be the final piece")},{icon:"circle-checkmark",text:Object(h.b)("Try for a perfect run in Challenge Mode!")}],buttonText:Object(h.b)("Start"),icon:"solo",modalWidth:"lg",storageKey:"solo_intro_modal_dismissed",subtitleTop:Object(h.b)("How to Play"),title:Object(h.b)("Solo Chess")}),l()(o,C.VISION,{bullets:[{icon:"chess-board-vision",text:Object(h.b)("Improve vision with coordinate training")},{icon:"chess-board-arrow-down",text:Object(h.b)("Identify squares or make moves")},{icon:"live",text:Object(h.b)("Answer as many as you can in 30 seconds")}],icon:"vision",showConfirmButton:!1,storageKey:"vision_intro_modal_dismissed",subtitleBottom:Object(h.b)("Learn to quickly follow and record chess coordinates and annotation."),title:Object(h.b)("Vision Trainer")}),l()(o,C.LESSONS,{bullets:[{icon:"play",text:Object(h.b)("Watch videos to learn concepts")},{icon:"circle-checkmark",text:Object(h.b)("Test knowledge with Challenges")},{icon:"king-black",text:Object(h.b)("Level up to achieve Mastery")}],icon:"lessons",storageKey:"lessons_intro_modal_dismissed",subtitleBottom:Object(h.b)("Learn from interactive lessons created by chess masters."),title:Object(h.b)("Chess Lessons")}),l()(o,C.CLUBS,{bullets:[{icon:"teammatch",text:Object(h.b)("Represent your club in matches")},{icon:"chat",text:Object(h.b)("Chat in private forums")},{icon:"square-four",text:Object(h.b)("Organize your team")}],icon:"clubs",storageKey:"clubs_intro_modal_dismissed",subtitleBottom:Object(h.b)("Join an Online Chess Club and connect and compete with your friends in matches."),title:Object(h.b)("Chess Clubs")}),l()(o,C.TOURNAMENTS,{bullets:[{icon:"circle-timer",text:Object(h.b)("Join tournaments starting every few minutes")},{icon:"calendar",text:Object(h.b)("Compete in Daily, multi-game tournaments")},{icon:"cup",text:Object(h.b)("Win trophies to display on your Profile")}],icon:"tournaments",storageKey:"tournaments_intro_modal_dismissed",subtitleBottom:Object(h.b)("Compete in online chess tournaments or join an online Arena, where anyone can win."),title:Object(h.b)("Chess Tournaments")}),o),O=function getFirstTimeModalConfig(t){return A[t]}},"./web/core/api/move-list/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a})),i.d(r,"c",(function(){return l})),i.d(r,"b",(function(){return h})),i.d(r,"d",(function(){return g}));var o=i("./utils/object.js"),a=function defaultNodeLimit(){return{begin:{},focus:{},end:{}}},l={$1:"!",$2:"?",$3:"!!",$4:"??",$5:"!?",$6:"?!",$10:"=",$11:"=",$12:"=",$13:"∞",$14:"⩲",$15:"⩱",$16:"±",$17:"∓",$18:"+-",$19:"-+",$22:"⨀",$23:"⨀",$32:"⟳",$33:"⟳",$36:"→",$37:"→",$40:"↑",$41:"↑",$44:"∞/=",$45:"=/∞",$132:"⇆",$133:"⇆",$146:"N"},h=Object(o.d)(l),g={DIAGRAM_EDITOR:"diagram-editor-container"}},"./web/core/api/move-list/context-menu/config.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return x})),i.d(r,"a",(function(){return w})),i.d(r,"e",(function(){return S})),i.d(r,"c",(function(){return T})),i.d(r,"d",(function(){return P})),i.d(r,"g",(function(){return C})),i.d(r,"f",(function(){return A})),i.d(r,"h",(function(){return O}));var o,a,l,h=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),g=i.n(h),y=i("./web/core/api/move-list/config.js"),_=i("./utils/translator.js"),x={AFTER:"after",BEFORE:"before"},w={ADD_ANNOTATION:"addAnnotation",ADD_EVAL_NOTATION:"addEvalNotation",CLEAR_ANALYSIS:"clearAnalysis",CREATE_CONTINUATION:"createContinuation",CREATE_VARIATION:"createVariation",DELETE_COMMENT:"deleteComment",DELETE_LINE:"deleteLine",DELETE_MOVE:"deleteMove",INSERT_COMMENT:"insertComment",MOVE_VARIATION_DOWN:"moveVariationDown",MOVE_VARIATION:"moveVariation",PROMOTE_VARIATION:"promoteVariation",REMOVE_ANNOTATION:"removeAnnotation",REMOVE_BEGIN:"removeBegin",REMOVE_END:"removeEnd",REMOVE_EVAL_ANNOTATION:"removeEvalAnnotation",REMOVE_FOCUS:"removeFocus",SET_BEGIN:"setBegin",SET_END:"setEnd",SET_FOCUS:"setFocus",UPDATE_COMMENT:"updateComment"},S={CLEAR_ANALYSIS:"clear-analysis-on-confirm"},M=[{code:"$1",display:y.c.$1,meaning:_.a.trans("Good move"),action:w.ADD_ANNOTATION},{code:"$2",display:y.c.$2,meaning:_.a.trans("Bad move"),action:w.ADD_ANNOTATION},{code:"$3",display:y.c.$3,meaning:_.a.trans("Excellent move"),action:w.ADD_ANNOTATION},{code:"$4",display:y.c.$4,meaning:_.a.trans("Blunder"),action:w.ADD_ANNOTATION},{code:"$5",display:y.c.$5,meaning:_.a.trans("Speculative move"),action:w.ADD_ANNOTATION},{code:"$6",display:y.c.$6,meaning:_.a.trans("Dubious move"),action:w.ADD_ANNOTATION},{code:"$10",display:y.c.$10,meaning:_.a.trans("Drawish"),action:w.ADD_EVAL_NOTATION},{code:"$13",display:y.c.$13,meaning:_.a.trans("Unclear"),action:w.ADD_EVAL_NOTATION},{code:"$14",display:y.c.$14,meaning:_.a.trans("White has a slight advantage"),action:w.ADD_EVAL_NOTATION},{code:"$15",display:y.c.$15,meaning:_.a.trans("Black has a slight advantage"),action:w.ADD_EVAL_NOTATION},{code:"$16",display:y.c.$16,meaning:_.a.trans("White has a moderate advantage"),action:w.ADD_EVAL_NOTATION},{code:"$17",display:y.c.$17,meaning:_.a.trans("Black has a moderate advantage"),action:w.ADD_EVAL_NOTATION},{code:"$18",display:y.c.$18,meaning:_.a.trans("White has a decisive advantage"),action:w.ADD_EVAL_NOTATION},{code:"$19",display:y.c.$19,meaning:_.a.trans("Black has a decisive advantage"),action:w.ADD_EVAL_NOTATION},{code:"$22",display:y.c.$22,meaning:_.a.trans("The position is in zugzwang"),action:w.ADD_EVAL_NOTATION},{code:"$146",display:y.c.$146,meaning:_.a.trans("Novelty"),action:w.ADD_EVAL_NOTATION}],T={CLEAR_ALL_ANALYSIS:{name:_.a.trans("Clear All Analysis"),action:w.CLEAR_ANALYSIS},CREATE_CONTINUATION:{name:_.a.trans("Insert Continuation"),action:w.CREATE_CONTINUATION},CREATE_VARIATION:{name:_.a.trans("Insert Alternate Line"),action:w.CREATE_VARIATION},DELETE_COMMENT_AFTER:{name:_.a.trans("Delete Comment After"),action:w.DELETE_COMMENT,position:x.AFTER},DELETE_COMMENT_BEFORE:{name:_.a.trans("Delete Comment Before"),action:w.DELETE_COMMENT,position:x.BEFORE},DELETE_LINE:{name:_.a.trans("Delete Entire Variation"),action:w.DELETE_LINE},DELETE_MOVE:{name:_.a.trans("Delete Move"),action:w.DELETE_MOVE},INSERT_COMMENT_AFTER:{name:_.a.trans("Comment After"),action:w.INSERT_COMMENT,position:x.AFTER},INSERT_COMMENT_BEFORE:{name:_.a.trans("Comment Before"),action:w.INSERT_COMMENT,position:x.BEFORE},MOVE_VARIATION_DOWN:{name:_.a.trans("Move Variation Down"),action:w.MOVE_VARIATION_DOWN},MOVE_VARIATION_UP:{name:_.a.trans("Move Variation Up"),action:w.MOVE_VARIATION},PROMOTE_VARIATION:{name:_.a.trans("Promote"),action:w.PROMOTE_VARIATION},REMOVE_ANNOTATION:{name:_.a.trans("Remove Annotation"),action:w.REMOVE_ANNOTATION},REMOVE_BEGIN:{name:_.a.trans("Remove Begin"),action:w.REMOVE_BEGIN},REMOVE_END:{name:_.a.trans("Remove End"),action:w.REMOVE_END},REMOVE_EVAL_ANNOTATION:{name:_.a.trans("Remove Evaluation Annotation"),action:w.REMOVE_EVAL_ANNOTATION},REMOVE_FOCUS:{name:_.a.trans("Remove Focus"),action:w.REMOVE_FOCUS},SET_BEGIN:{name:_.a.trans("Set Begin"),action:w.SET_BEGIN},SET_END:{name:_.a.trans("Set End"),action:w.SET_END},SET_FOCUS:{name:_.a.trans("Set Focus"),action:w.SET_FOCUS}},P=[w.SET_BEGIN,w.SET_END,w.SET_FOCUS,w.REMOVE_BEGIN,w.REMOVE_END,w.REMOVE_FOCUS],C={BEGIN:"begin",END:"end",FOCUS:"focus"},A={SET:(o={},g()(o,w.SET_BEGIN,C.BEGIN),g()(o,w.SET_END,C.END),g()(o,w.SET_FOCUS,C.FOCUS),o),REMOVE:(a={},g()(a,w.REMOVE_BEGIN,C.BEGIN),g()(a,w.REMOVE_END,C.END),g()(a,w.REMOVE_FOCUS,C.FOCUS),a)},O=(l=[],M.forEach((function(t){var r=l[l.length-1]||null;r&&4!==r.length?r.push(t):l.push([t])})),l)},"./web/core/api/move-list/move-list.js":function(t,r,i){"use strict";i.r(r),i.d(r,"nodeProps",(function(){return h}));var o=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),a=i.n(o),l=i("./chessboard/src/game/line.js"),h=["additionalAnnotation","annotation","arrows","color","comment","commentBefore","fen","flags","from","ids","lines","moveNumber","piece","previous","promotion","san","time","to"];r.default=function moveList(){var t,r={lines:[]};return{state:r,updateLines:function updateLines(i){r.lines=a()(i),(i||[]).forEach((function(o,a){t=l.a.isContinuation(i,o.id),r.lines[a]=o.map((function(r){var i={};return h.forEach((function(t){void 0!==r[t]&&(i[t]=r[t])})),t&&0===r.ids.move&&(i.commentBefore=o.initComment),i})),r.lines[a].atMoveNode=o.atMoveNode,r.lines[a].id=o.id,r.lines[a].parentId=o.parentId}))}}}()},"./web/core/api/move-list/move-node/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return l})),i.d(r,"d",(function(){return h})),i.d(r,"e",(function(){return g})),i.d(r,"c",(function(){return y})),i.d(r,"b",(function(){return _}));var o,a=i("./utils/translation/translation.helper.js"),l={FIGURINE:"figurine",TEXT:"text"},h={BLACK:2,WHITE:1},g={BLACK:"black",WHITE:"white"},y={B:"bishop",K:"king",N:"knight",R:"rook",Q:"queen"},_=function moveNotationTranslations(){return o||(o={B:a.a.trans("move_list.algebraic.B",null,"moves")||"B",K:a.a.trans("move_list.algebraic.K",null,"moves")||"K",N:a.a.trans("move_list.algebraic.N",null,"moves")||"N",R:a.a.trans("move_list.algebraic.R",null,"moves")||"R",Q:a.a.trans("move_list.algebraic.Q",null,"moves")||"Q"}),o}},"./web/core/api/move-list/move-node/helper.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return g})),i.d(r,"c",(function(){return y})),i.d(r,"a",(function(){return _}));var o=i("./chessboard/src/game/game.lib.js"),a=i("./chessboard/src/game/move-node/helper.js"),l=i("./web/core/api/move-list/move-node/config.js"),h=i("./web/core/api/move-list/move-node/translate-move-text.ts");i.d(r,"d",(function(){return h.a}));var g=function getFigurineIndex(t){return t.san.search(/[BKNRQ]/)},y=function getIconName(t){var r=t.color===l.d.WHITE?l.e.WHITE:l.e.BLACK,i=t.san[g(t)];return"".concat(l.c[i],"-").concat(r)},_=function createMoveNode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.assign({annotationString:Object(a.f)(t),coords:Object(h.a)(t.san),classification:t.classification||null,closeParenthesisCount:0,figurineIndex:g(t),hasComment:Object(a.i)(t),hasCommentBefore:Object(a.j)(t),hasLines:Object(a.k)(t),iconName:y(t),indentation:0,isEnPassant:Object(a.l)(t),isFirstNodeOnLine:Object(a.m)(t),isInvisible:!1,isWhite:Boolean(t.color===l.d.WHITE),nodeMoveNumber:o.a.getMoveNumber(t.color,t.moveNumber),openParenthesis:!1,previousHasComment:!!r&&Object(a.i)(r),previousHasLines:!!r&&Object(a.k)(r)},t)}},"./web/core/api/move-list/move-node/translate-move-text.ts":function(t,r,i){"use strict";i.d(r,"a",(function(){return translateMoveText}));var o=i("./web/core/api/move-list/move-node/config.js");function getTranslation(t){return Object(o.b)()[t]}function translateMoveText(t){return t.includes("O-O")?t:t.replace(/[BKNRQ]/g,getTranslation)}},"./web/core/api/navigation/bus.js":function(t,r,i){"use strict";var o=i("./web/core/api/navigation/config/refs.js"),a={expanded:null===document.querySelector("".concat(o.a.SIDEBAR,".").concat(o.a.SIDEBAR_COLLAPSED)),forcedOpen:!1,isLive:"/live"===window.location.pathname.substr(0,5),isLiveElement:document.querySelector("#live-app"),isVisible:!0,isWide:"en-US"!==document.documentElement.getAttribute("lang"),position:"horizontal",showingSecondary:null};r.a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[],i=function emit(i,o){r.filter((function(t){return t.type===i})).forEach((function(r){return r.handler(t,o)}))},o=function on(t,i){return r.push({type:t,handler:i}),r},a=function off(t){return-1!==r.findIndex((function(r){return r.type===t.type&&r.handler===t.handler}))&&r.splice(r,1),r};return{emit:i,off:a,on:o,state:t,subscriptions:r}}(a)},"./web/core/api/navigation/config/refs.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o})),i.d(r,"b",(function(){return a}));var o={AUTHENTICATE:"navigation-sidebar-authenticate-component",AUTHENTICATE_COLLAPSED:"navigation-sidebar-authenticate-collapsed",BADGE_HOME:"navigation-sidebar-home-badge",BADGE_INDEX:"navigation-sidebar-index-badge",BADGE_MESSAGES:"navigation-sidebar-messages-badge",BADGE_PLAY:"navigation-sidebar-play-badge",BOTTOM_LINK_EXPAND_COLLAPSE:"navigation-sidebar-expand-collapse-feature",BOTTOM_LINK_HELP:"navigation-sidebar-help-feature",BOTTOM_LINK_SEARCH:"navigation-sidebar-search-feature",BOTTOM_LINK_SETTINGS:"navigation-settings-link",BOTTOM_LINK_TOP_MENU:"navigation-toggle",DAILY_TIME_CONTROLS_BUTTON:"navigation-sidebar-play-button",HELP_POPOVER:"navigation-popover-help-component navigation-sidebar-feature-popover-help",LINK:"navigation-sidebar-category-component",LINK_HOME:"navigation-sidebar-home-category",LINK_INDEX:"navigation-sidebar-index-category",LINK_LEARN:"navigation-sidebar-learn-category",LINK_PLAY:"navigation-sidebar-play-category",LINK_SHARE:"navigation-sidebar-share-category",LOGO:"navigation-sidebar-primary-logo",LOGO_COLLAPSED:"navigation-sidebar-logo-collapsed",NAV_CLOSE_ICON:"nav-close-icon",NAV_OPEN_ICON:"nav-open-icon",NOTIFICATIONS_PANEL_CATCHMENT:"navigation-sidebar-notifications-catchment",SEARCH_BUTTON:"navigation-search-link",SEARCH_POPOVER:"navigation-sidebar-feature-popover-search",SECONDARY:"navigation-sidebar-secondary-component",SECONDARY_ACTIVE:"navigation-sidebar-secondary-active",SECONDARY_COLLAPSED:"navigation-sidebar-secondary-collapsed",SECONDARY_CONTROLS_SHOW:"navigation-sidebar-play-show",SECONDARY_DAILY_TIME_CONTROLS:"navigation-sidebar-play-daily",SECONDARY_ELEMENT:"navigation-sidebar-secondary-element",SECONDARY_LINK_DAILY:"navigation-secondary-dailychess",SECONDARY_LINK_LIVE:"navigation-secondary-livechess",SECONDARY_LIVE_TIME_CONTROLS:"navigation-sidebar-play-live",SECONDARY_NAVIGATION:"navigation-sidebar-secondary-navigation",SECONDARY_PANEL_HOME:"navigation-sidebar-home-component",SECONDARY_PANEL_LEARN:"navigation-sidebar-learn-component",SECONDARY_PANEL_NOTIFICATIONS:"navigation-sidebar-notifications-component",SECONDARY_PANEL_PLAY:"navigation-sidebar-play-component",SECONDARY_PANEL_SHARE:"navigation-sidebar-share-component",SECONDARY_WIDE:"navigation-sidebar-secondary-wide",SIDEBAR:"#sb",SIDEBAR_CATEGORIES_COLLAPSED:"navigation-sidebar-categories-collapsed",SIDEBAR_CATEGORY:"navigation-sidebar-category-component",SIDEBAR_CATEGORY_COLLAPSED:"navigation-sidebar-category-collapsed",SIDEBAR_COLLAPSED:"collapsed",SIDEBAR_FEATURE:"navigation-sidebar-feature-component",SIDEBAR_FEATURE_COLLAPSED:"navigation-sidebar-feature-collapsed",SIDEBAR_FEATURES:"navigation-sidebar-features-component",SIDEBAR_FEATURES_COLLAPSED:"navigation-sidebar-features-collapsed",SIDEBAR_FORCED_OPEN:"navigation-sidebar-open",SIDEBAR_GAMES:"navigations-sidebar-games",SIDEBAR_INTERNATIONAL:"nav-sidebar-wide",SIDEBAR_LINKS:"navigation-sidebar-primary-top",TIME_CONTROLS:"navigation-sidebar-play-daily",TV_COMPONENT:"navigation-sidebar-category-component navigation-sidebar-categories-watch",TV_ELEMENT:"chesstv",TV_EXCLAM:"navigation-sidebar-categories-exclamation",TV_POPOVER:"navigation-popover-watch-component navigation-sidebar-categories-popover-watch"},a={DAILY_TIME_CONTROLS_HEADER:"daily-time-controls-header",DAILY_TIME_CONTROLS_SIDEBAR:"daily-time-controls-sidebar",LANGUAGE_PICKER_MODAL:"language-picker-modal",LIVE_TIME_CONTROLS_HEADER:"live-time-controls-header",LIVE_TIME_CONTROLS_SIDEBAR:"live-time-controls-sidebar",MOBILE_NAV_TOGGLE:"mobile-nav-toggle",MODAL_VIDEO:"modal-video",KEYBOARD_NAVIGATION_IN_USE:"keyboard-navigation-in-use"}},"./web/core/api/position/helper.js":function(t,r,i){"use strict";i.d(r,"b",(function(){return y})),i.d(r,"a",(function(){return _})),i.d(r,"c",(function(){return x})),i.d(r,"d",(function(){return w}));var o=i("./web/core/api/position/is-rtl.js"),a="top",l="right",h="bottom",g="left",y=function getUserPopoverPosition(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:172,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,o={top:null,left:null,right:null,x:null,y:null},y=24,_=28,x=y/2,w=t.width/2,S=window,M=t.bottom+r<S.innerHeight,T=i-_-x,P=i-T,C=t.left+w+T<S.innerWidth;return M?(o.top=t.bottom,o.y=h):(o.top=t.top-r,o.y=a),C?(o.left=t.left+w-P,o.right=window.innerWidth-t.right,o.x=l):(o.left=t.left+w-T,o.right=window.innerWidth-t.right,o.x=g),o.top=Math.round(o.top),o.left=Math.round(o.left),o.right=Math.round(o.right),o},_=function getPosition(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t||!r)return null;var y=t.getBoundingClientRect(),_={},x=window.innerWidth-y.x,w=function canFitTop(){return y.top-(r.clientHeight+o)>0},S=function canFitBottom(){return y.bottom+r.clientHeight+o<window.innerHeight},M=function canFitLeft(){return y.left-(r.clientWidth+o)>0},T=function canFitRight(){return y.right+r.clientWidth+o<window.innerWidth};return i===a&&w()||i===h&&!S()?(_.left=y.left-(r.clientWidth-y.width)/2,_.rtlLeft=x-r.clientWidth/2-y.width/2,_.top=y.top-r.clientHeight-o,_.placement=a):i===h||i===a&&!w()?(_.left=y.left-(r.clientWidth-y.width)/2,_.rtlLeft=x-r.clientWidth/2-y.width/2,_.top=y.bottom+o,_.placement=h):i===g&&M()||i===l&&!T()?(_.left=y.left-r.clientWidth-o,_.rtlLeft=y.rtlLeft-r.clientWidth-o,_.top=y.top-(r.clientHeight-y.height)/2,_.placement=g):(i===l||i===g&&!M())&&(_.left=y.right+o,_.rtlLeft=y.rtlLeft+o,_.top=y.top-(r.clientHeight-y.height)/2,_.placement=l),{left:Math.round(_.left),placement:_.placement,rtlLeft:Math.round(_.rtlLeft),top:Math.round(_.top)}},x=function positionTooltip(t,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!t||!r)return null;var l=_(t,r,i,a);return Object(o.a)()?r.style.transform="translate(-".concat(l.rtlLeft,"px, ").concat(l.top,"px)"):r.style.transform="translate(".concat(l.left,"px, ").concat(l.top,"px)"),r.classList.add(l.placement),r},w=function removePositionStyle(t){return t?(t.style.transform="translate(-100%, -100%)",t.classList.remove(g,l,h,a),t):null}},"./web/core/api/position/is-rtl.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return o}));var o=function isRtl(){return"rtl"===document.querySelector("html").getAttribute("dir")}},"./web/core/api/social/config.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return g})),i.d(r,"b",(function(){return y})),i.d(r,"c",(function(){return _})),i.d(r,"d",(function(){return x})),i.d(r,"e",(function(){return w})),i.d(r,"f",(function(){return S})),i.d(r,"g",(function(){return M}));var o=i("./utils/browser.js"),a=i("./utils/router.js"),l=i("./utils/translator.js"),h=Object(o.d)().slice(0,-13),g={BACKGROUND:"data-background",CHESS_TV_EXTRA_BUTTONS:"data-chess-tv-extra-buttons"},y={REPORT_TV_VIDEO:"report-tv-video"},_={SOCIAL_INVITE:"social-invite",SOCIAL_SHARE:"social-share"},x={android:function android(){return a.a.generate("web_play_app_view",{type:"android"},!0)},ios:function ios(){return a.a.generate("web_play_app_view",{type:"ios"},!0)},index:function index(){return a.a.generate("web_index",{},!0)},register:function register(){return a.a.generate("web_security_register",{},!0)},windows:function windows(){return a.a.generate("web_play_app_view",{type:"windows-phone"},!0)}},w={discord:function discord(){return"https://go.chess.com/Discord"},facebook:function facebook(){return"http://www.facebook.com/sharer.php?u=".concat(Object(o.c)())},linkedin:function linkedin(){return"https://www.linkedin.com/shareArticle?mini=true&url=".concat(Object(o.c)(),"&title=").concat(Object(o.d)(),"&summary=").concat(Object(o.d)(),"&source=Chess.com")},mix:function mix(){return"http://www.mix.com/submit?url=".concat(Object(o.c)(),"&title=").concat(Object(o.d)())},reddit:function reddit(){return"http://reddit.com/r/chess/submit?url=".concat(Object(o.c)(),"&title=").concat(Object(o.d)())},tumblr:function tumblr(){return"http://www.tumblr.com/share/link?url=".concat(Object(o.c)(),"&name=").concat(Object(o.d)(),"&description=").concat(Object(o.d)())},twitch:function twitch(){return"https://www.chess.com/twitch"},twitter:function twitter(){return"https://twitter.com/intent/tweet?text=".concat(h,"&url=").concat(Object(o.c)())}},S={addFavorites:l.a.trans("Add to Favorites"),android:l.a.trans("Android App"),discord:l.a.trans("Discord"),facebook:l.a.trans("Facebook"),gamesToday:l.a.trans("Games Today"),google:l.a.trans("Google+"),instagram:l.a.trans("Instagram"),ios:l.a.trans("iOS App"),members:l.a.trans("Members"),playersOnline:l.a.trans("Players Online"),print:l.a.trans("Print"),report:l.a.trans("Report"),sendEmail:l.a.trans("Send by Mail"),titledOnline:l.a.trans("Titled Online"),twitch:l.a.trans("Twitch"),twitter:l.a.trans("Twitter"),windows:l.a.trans("Windows App"),youtube:l.a.trans("Youtube"),shareFacebook:l.a.trans("Share on Facebook"),shareGplus:l.a.trans("Share on Google Plus"),shareLinkedIn:l.a.trans("Share on LinkedIn"),shareMix:l.a.trans("Share on Mix"),shareReddit:l.a.trans("Share on Reddit"),shareTumblr:l.a.trans("Post to Tumblr"),shareTwitter:l.a.trans("Share on Twitter"),showMore:l.a.trans("Show More")},M={facebook:"https://www.facebook.com/chess",instagram:"https://www.instagram.com/wwwchesscom/",twitch:"https://www.twitch.tv/chess",twitter:"https://twitter.com/chesscom",youtube:"https://www.youtube.com/user/wwwChesscom"}},"./web/core/api/user/config.js":function(t,r,i){"use strict";i.d(r,"c",(function(){return _})),i.d(r,"b",(function(){return x})),i.d(r,"a",(function(){return w})),i.d(r,"k",(function(){return S})),i.d(r,"m",(function(){return M})),i.d(r,"n",(function(){return T})),i.d(r,"h",(function(){return P})),i.d(r,"i",(function(){return C})),i.d(r,"j",(function(){return A})),i.d(r,"e",(function(){return O})),i.d(r,"g",(function(){return L})),i.d(r,"f",(function(){return I})),i.d(r,"d",(function(){return R})),i.d(r,"l",(function(){return j}));var o,a,l=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),h=i.n(l),g=i("./utils/router.js"),y=i("./utils/translator.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}var _={REPORT_USER:"web_user_callback_report_user",REPORT_TV_USER:"web_tv_callback_report",USER_POPUP:"web_user_callback_popup"},x=(y.a.trans("Membership Icons"),y.a.trans("Emoji"),y.a.trans("Chess"),y.a.trans("Holiday"),y.a.trans("Hosts"),y.a.trans("Computer Chess"),y.a.trans("PRO Chess League"),{category:"membership_icons",code:"nothing",description:y.a.trans("Nothing"),id:206,imageCode:"nothing",membershipLevelCode:"staff",name:y.a.trans("Nothing"),status:""}),w=["blocked","clear","clear_light"],S={USER_FLAIR:"user-flair",USER_SEARCH:"user-search",USER_POPOVER_CONTAINER:"user-popover"},M={about:function about(){return g.a.generate("web_about")},membership:function membership(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"icon";return g.a.generate("web_membership",{c:t})},usernameSearch:function usernameSearch(t){return g.a.generate("web_user_callback_username_search",function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){h()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({activeDays:4e3},t))}},T={acceptFriendRequest:y.a.trans("Accept Friend Request"),addFriend:y.a.trans("Add Friend"),block:y.a.trans("Block"),blockConfirm:y.a.trans("Are you sure you want to block this user?"),cancel:y.a.trans("Cancel"),cancelFriendRequest:y.a.trans("Cancel Friend Request"),challenge:y.a.trans("Challenge"),follow:y.a.trans("Follow"),gameArchive:y.a.trans("Game Archive"),giftMembership:y.a.trans("Gift Membership"),giveTrophy:y.a.trans("Give Award"),joinedDate:function joinedDate(t){return y.a.trans("Joined %1$s%",{"%1$s%":t})},lastOnline:function lastOnline(t){return y.a.trans("Online %1$s%",{"%1$s%":t})},moderator:y.a.trans("Moderator"),onlineNow:y.a.trans("Online Now"),inLiveNow:y.a.trans("In Live"),removeFriend:y.a.trans("Remove Friend"),removeFriendConfirm:y.a.trans("Are you sure you want to remove this friend from your list?"),report:y.a.trans("Report"),reportUser:function reportUser(t){return y.a.trans("Report %username%",{"%username%":t})},sendMessage:y.a.trans("Send Message"),showYourFlair:y.a.trans("Show your flair!"),staff:y.a.trans("Staff"),unblock:y.a.trans("Unblock"),unfollow:y.a.trans("Unfollow"),userReportError:y.a.trans("Tell us more...")},P={cheater:5,abuser:6,voluntarilyClosed:7,unspecifiedClosed:8,basic:10,silver:20,gold:30,platinum:40,diamond:50,moderator:80,staff:90},C=(o={},h()(o,P.diamond,"diamond"),h()(o,P.abuser,"abuser"),h()(o,P.cheater,"cheater"),h()(o,P.voluntarilyClosed,"inactive"),h()(o,P.unspecifiedClosed,"cheater"),h()(o,P.gold,"gold"),h()(o,P.moderator,"pawn-blue"),h()(o,P.platinum,"platinum"),h()(o,P.staff,"pawn-green"),o),A=(a={},h()(a,P.basic,y.a.trans("Basic Membership")),h()(a,P.diamond,y.a.trans("Diamond Membership")),h()(a,P.cheater,y.a.trans("Closed: Fair Play")),h()(a,P.abuser,y.a.trans("Closed: Abuse")),h()(a,P.voluntarilyClosed,y.a.trans("Closed: Inactive")),h()(a,P.unspecifiedClosed,y.a.trans("Account Closed")),h()(a,P.gold,y.a.trans("Gold Membership")),h()(a,P.moderator,y.a.trans("Moderator Account")),h()(a,P.platinum,y.a.trans("Platinum Membership")),h()(a,P.silver,y.a.trans("Silver Membership")),h()(a,P.staff,y.a.trans("Staff Account")),a),O={GM:y.a.trans("Grandmaster"),WGM:y.a.trans("Woman Grandmaster"),IM:y.a.trans("International Master"),WIM:y.a.trans("Woman International Master"),FM:y.a.trans("FIDE Master"),WFM:y.a.trans("Woman FIDE Master"),NM:y.a.trans("National Master"),CM:y.a.trans("FIDE Candidate Master"),WCM:y.a.trans("FIDE Woman Candidate Master"),WNM:y.a.trans("Woman National Master")},L=function isOnline(t){return!0===t||"online"===t},I=function isLive(t){return"onlive"===t},R={AUTOCOMPLETE_CLEAR_SELECTED:"form-autocomplete-clear-selected"},j={FETCH_ROLES:"fetchRoles"}},"./web/core/api/user/helper.js":function(t,r,i){"use strict";i.d(r,"e",(function(){return g})),i.d(r,"d",(function(){return y})),i.d(r,"a",(function(){return _})),i.d(r,"b",(function(){return x})),i.d(r,"c",(function(){return w}));var o=i("./utils/is-2fa.js"),a=(i("./utils/router.js"),i("./utils/dark-mode.ts")),l=i("./web/core/api/user/config.js"),h=window.context,g=function isLoggedIn(){return!(!h||!h.user||Object(o.a)())},y=function isImpersonating(){return!(!g()||!h.user.isImpersonating)},_=function checkUserStatus(t){if(!g())return!1;var r=!1;switch(t){case"isActivated":r=h.user.isActivated;break;case"isStaff":r=h.user.membershipLevel>=l.h.staff;break;case"isStaffOnly":r=h.user.membershipLevel===l.h.staff;break;case"isModerator":r=h.user.membershipLevel>=l.h.moderator;break;case"isModeratorOnly":r=h.user.membershipLevel===l.h.moderator;break;case"isDiamond":r=h.user.membershipLevel>=l.h.diamond;break;case"isDiamondOnly":r=h.user.membershipLevel===l.h.diamond;break;case"isPlatinum":r=h.user.membershipLevel>=l.h.platinum;break;case"isPlatinumOnly":r=h.user.membershipLevel===l.h.platinum;break;case"isSilver":r=h.user.membershipLevel>=l.h.silver;break;case"isSilverOnly":r=h.user.membershipLevel===l.h.silver;break;case"isGold":r=h.user.membershipLevel>=l.h.gold;break;case"isGoldOnly":r=h.user.membershipLevel===l.h.gold;break;case"isPremium":r=h.user.membershipLevel>=l.h.silver;break;case"isBasic":r=h.user.membershipLevel===l.h.basic;break;case"isNewlyRegistered":r=h.user.isNewlyRegistered;break;case"isGuest":r=h.user.isGuest;break;case"chessTitle":r=h.user.chessTitle;break;default:r=!1}return r},x=function getAdditionalUserInfo(t){var r=!1;if(!g()){switch(t){case"diagramSettings":r={};break;case"isDarkMode":r=Object(a.a)();break;default:r=null}return r}switch(t){case"cohort":r=h.user.cohort;break;case"flairCode":r=h.user.flairCode;break;case"getUserId":r=h.user.id;break;case"getUsername":r=h.user.username;break;case"getAvatarUrl":r=h.user.avatarUrl;break;case"getAvatarLargeUrl":r=h.user.avatarLargeUrl;break;case"getSettingsAvatarUrl":r=h.user.settingsAvatarUrl;break;case"getLastLoginDate":r=h.user.lastLoginDate;break;case"registerDate":r=h.user.registerDate;break;case"getBrowserTimezone":r=window.jstz.determine().name();break;case"getTimezone":r=h.user.timezone;break;case"getDiagramSettings":r=h.diagramSettings;break;case"language":r=h.i18n.locale;break;case"contentLanguage":r=h.i18n.contentLanguage;break;case"speaksEnglish":r="en_US"===h.i18n.locale;break;case"eligibleFirstTrial":r=h.user.eligibleFirstTrial;break;case"fairPlayAgree":r=h.user.fairPlayAgree;break;case"getArchiveView":r=h.user.archiveView?h.user.archiveView:"grid";break;case"homeContentType":r="following";break;case"getMembershipLevel":r=h.user.membershipLevel;break;case"isClassicTheme":r=h.user.isClassicTheme;break;case"isContentHidden":r=h.user.isContentHidden;break;case"isDarkMode":r=Object(a.a)();break;case"safeMode":r=h.user.safeMode;break;case"uuid":r=h.user.uuid;break;default:r=!1}return r},w=function getMembershipNumber(t,r){return!r&&t>=l.h.basic?l.h.unspecifiedClosed:t}},"./web/core/store/helper.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return a}));var o=i("./web/core/store/index.js"),a=function registerModules(t){Object.keys(t).forEach((function(r){var i=t[r];o.default.state&&o.default.state[r]||o.default.registerModule(r,i)}))}},"./web/core/store/index.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./web/core/store/index.js")},"./web/core/store/modules/board/index.js":function(t,r,i){"use strict";var o,a=i("./node_modules/@babel/runtime/regenerator/index.js"),l=i.n(a),h=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),g=i.n(h),y=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),_=i.n(y),x=i("./web/core/api/board/helper/index.js"),w=i("./chessboard/src/board/board.config.js"),S=i("./web/core/api/board/config.js"),M=i("./web/core/store/plugins/save-state/index.js"),T=i("./core/board-layout/api/toggle-body-class.ts"),P=i("./web/core/api/alerts/config.ts"),C=i("./utils/browser.js"),A=i("./chessboard/src/board/board.service.js"),O=i("./chessboard/src/components/chessboard/ChessSounds/index.js"),L=i("./chessboard/src/board/board.helper.js"),I=i("./chessboard/src/event-hub.js");function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){g()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var R={loadOptions:function loadOptions(t){var r=arguments;return _()(l.a.mark((function _callee(){var i,a,h,g,y,_,x,S,T,O;return l.a.wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return i=t.commit,a=t.dispatch,h=t.state,g=t.rootState,y=r.length>1&&void 0!==r[1]&&r[1],o||(o=A.a.getOptions()),l.prev=3,l.t0=_objectSpread,l.t1=_objectSpread,l.t2={},l.next=9,o;case 9:l.t3=l.sent,l.t4=(0,l.t1)(l.t2,l.t3),l.t5={},l.t6={fetched:!0},_=(0,l.t0)(l.t4,l.t5,l.t6),y&&"real3d"===_.pieceStyle&&(_.pieceStyle=A.a.getDefaultOptions().pieceStyle),x=g.user&&g.user.isImpersonating,S=L.a.pieceChangeRequiresRefresh(_.pieceStyle,h.boardOptions.pieceStyle)&&!x,"real3d"===_.pieceStyle&&("IE"===Object(C.b)().name?(T=A.a.getDefaultOptions().pieceStyle,a("updateOption",{option:"pieceStyle",value:T}),_.pieceStyle=T,S=!0):w.c.animations.indexOf(_.animationType)>=0&&(O=A.a.getDefaultOptions().animationType,a("updateOption",{option:"animationType",value:O}),_.animationType=O,S=!0)),i("setOptions",_),S&&(M.saveStateDebounce.flush(),window.location.reload()),o=null,l.next=27;break;case 23:l.prev=23,l.t7=l.catch(3),a("alerts/create",{type:P.f.error,message:P.b.badRequest},{root:!0}),o=null;case 27:case"end":return l.stop()}}),_callee,null,[[3,23]])})))()},loadStyles:function loadStyles(t){var r=t.commit,i=t.dispatch;return A.a.getStyles().then((function(t){return r("setStyles",t)})).catch((function(){return i("alerts/create",{type:P.f.error,message:P.b.badRequest},{root:!0})}))},playSound:function playSound(t,r){var i=t.state,o=new O.a(i.boardOptions.soundTheme);return i.boardOptions.playSounds&&o.play(r),o},updateBoardEffect:function updateBoardEffect(t,r){var i=t.dispatch,o=t.rootState,a=r.classification,l=r.node,h=void 0===l?{}:l,g=r.square,y=void 0===g?null:g,_=r.persist,w=void 0!==_&&_,S=r.gameStore,M=void 0===S?"game":S;if(o[M].isNewBoard){if(!h)return;var T={square:h.to,type:a.type};i("".concat(M||"game","/markEffect"),{effect:T,persist:w},{root:!0})}else{var P=(a||{}).icon,C=Object(x.b)({icon:P,node:h,square:y});i("".concat(M||"game","/markEffect"),{effect:C,persist:w},{root:!0})}},updateOption:function updateOption(t,r){var i=t.commit,o=t.dispatch,a=t.rootState,l=r.option,h=r.value,g=r.save,y=void 0===g||g;"highlightMoves"===l&&i("setOption",{option:"highlightMovesUI",value:h}),"darkMode"===l&&(I.a.emit(S.i.DARK_MODE_CHANGE,h),Object(T.a)("dark-mode",h));var _=l,x=h;if("coordinates"===l&&(x=L.a.getCoordinatePositioning(h)),"colorScheme"===l&&(_="boardStyle"),i("setOption",{option:_,value:x}),a.user&&a.user.isLoggedIn&&w.a.updateOption[l]&&y)return A.a.updateOption(l,h).catch((function(){return o("alerts/create",{type:P.f.error,message:P.b.badRequest},{root:!0})}))},flipBoard:function flipBoard(t){(0,t.commit)("setOption",{option:"flipBoard",value:!t.state.boardOptions.flipBoard})}},j={setOption:function setOption(t,r){var i=r.option,o=r.value;t.boardOptions[i]=o},setOptions:function setOptions(t,r){var i=r.animationType||t.boardOptions.animationType;w.c.pieces.indexOf(r.pieceStyle)>=0&&w.c.animations.indexOf(r.animationType)>=0&&(i="default"),t.boardOptions=Object.assign(t.boardOptions,r,{animationType:i})},setStyle:function setStyle(t,r){var i=r.style,o=r.value;t.styles[i]=o},setSettings:function setSettings(t,r){t.settings=Object.assign({},t.settings,r)},setStyles:function setStyles(t,r){var i=L.a.getAnimationTypes(r.animationTypes),o=L.a.getPieceStyles(r.pieceStyles);t.styles=Object.assign(t.styles,r,{animationTypes:i},{pieceStyles:o})},setDebugMode:function setDebugMode(t,r){t.debugMode=r}},N=i("./utils/common/merge.js"),k=i("./utils/cache/cached.js");function state_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function state_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?state_ownKeys(Object(i),!0).forEach((function(r){g()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):state_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var D=A.a.getDefaultOptions(),B={boardId:"board".concat(Date.now()),boardOptions:state_objectSpread(state_objectSpread({},D),{},{highlightMovesUI:!0,maxWidth:0}),debugMode:!1,settings:{boardColors:[{code:"8_bit",name:"8-Bit"},{code:"bases",name:"Bases"},{code:"blue",name:"Blue"},{code:"brown",name:"Brown"},{code:"bubblegum",name:"Bubblegum"},{code:"burled_wood",name:"Burled Wood"},{code:"dark_wood",name:"Dark Wood"},{code:"dash",name:"Dash"},{code:"glass",name:"Glass"},{code:"graffiti",name:"Graffiti"},{code:"green",name:"Green"},{code:"icy_sea",name:"Icy Sea"},{code:"light",name:"Light"},{code:"lolz",name:"Lolz"},{code:"marble",name:"Marble"},{code:"metal",name:"Metal"},{code:"neon",name:"Neon"},{code:"newspaper",name:"Newspaper"},{code:"orange",name:"Orange"},{code:"overlay",name:"Overlay"},{code:"parchment",name:"Parchment"},{code:"purple",name:"Purple"},{code:"red",name:"Red"},{code:"sand",name:"Sand"},{code:"sky",name:"Sky"},{code:"stone",name:"Stone"},{code:"tan",name:"Tan"},{code:"tournament",name:"Tournament"},{code:"translucent",name:"Translucent"},{code:"walnut",name:"Walnut"}],pieceStyles:[{code:"8_bit",name:"8-Bit"},{code:"alpha",name:"Alpha"},{code:"bases",name:"Bases"},{code:"blindfold",name:"Blindfold"},{code:"book",name:"Book"},{code:"bubblegum",name:"Bubblegum"},{code:"cases",name:"Cases"},{code:"classic",name:"Classic"},{code:"club",name:"Club"},{code:"condal",name:"Condal"},{code:"dash",name:"Dash"},{code:"game_room",name:"Game Room"},{code:"glass",name:"Glass"},{code:"gothic",name:"Gothic"},{code:"graffiti",name:"Graffiti"},{code:"icy_sea",name:"Icy Sea"},{code:"light",name:"Light"},{code:"lolz",name:"Lolz"},{code:"marble",name:"Marble"},{code:"maya",name:"Maya"},{code:"metal",name:"Metal"},{code:"modern2",name:"Modern"},{code:"nature",name:"Nature"},{code:"neon",name:"Neon"},{code:"neo",name:"Neo"},{code:"neo_wood",name:"Neo-Wood"},{code:"newspaper",name:"Newspaper"},{code:"ocean",name:"Ocean"},{code:"sky",name:"Sky"},{code:"space",name:"Space"},{code:"tigers",name:"Tigers"},{code:"tournament",name:"Tournament"},{code:"vintage",name:"Vintage"},{code:"wood",name:"Wood"},{code:"3dwood",name:"3D - Wood"},{code:"3d_staunton",name:"3D - Staunton"},{code:"3dplastic",name:"3D - Plastic"},{code:"3dchesskid",name:"3D - ChessKid"},{code:"real3d",name:"Real 3D"}],sounds:[{code:"default",name:"Default"},{code:"nature",name:"Nature"},{code:"metal",name:"Metal"},{code:"marble",name:"Marble"},{code:"space",name:"Space"},{code:"beat",name:"Beat"},{code:"silly",name:"Silly"},{code:"lolz",name:"Lolz"},{code:"newspaper",name:"Newspaper"}],moveListDisplayTypes:[{code:"text",name:"Text"},{code:"figurine",name:"Figurine"}],animationTypes:[{code:"default",name:"Default"},{code:"none",name:"None"},{code:"slow",name:"Slow"},{code:"natural",name:"Natural"},{code:"arcade",name:"Arcade"}],coordinates:[{code:null,name:"Off"},{code:"inside",name:"Inside"},{code:"outside",name:"Outside"}],component:"standard",moveMethods:[{code:"click",name:"Click Squares"},{code:"drag",name:"Drag Pieces"}]},styles:{boardColors:[],pieceStyles:[],userSize:null}},G={boardOptions:{allowMarkings:!0,captureKeyStrokes:!0,enabled:!0,fadeSetup:0,fetched:!1,flipBoard:!1,flipped:!1,highlightColor:null,highlightOpacity:D.highlightOpacity}},H=Object(N.a)(B,k.a.board,G);r.a={namespaced:!0,actions:R,mutations:j,state:H}},"./web/core/store/modules/diagram-viewer/index.js":function(t,r,i){"use strict";var o=i("./web/core/api/diagram-viewer/helpers/can-make-puzzle-move.js"),a=i("./web/core/api/diagram-viewer/config.js");var l=i("./chessboard/src/game/index.js"),h={correctMove:function correctMove(t,r){var i=t.dispatch,h=r.currentGame,g=r.id,y=r.text,_=h.game;l.a.canMoveForward(_,2)&&Object(o.a)(h,2)?(i("hintMove",{game:_,id:g,text:y}),setTimeout((function(){var t=h.setup.puzzleSetup.isWhite?a.j.WHITE_TO_MOVE:a.j.BLACK_TO_MOVE;Object(o.a)(h,2)||(t=a.j.SOLVED,i("lastPuzzleMove",g)),i("hintMove",{game:_,id:g,text:t})}),a.b.TIMEOUT)):(i("lastPuzzleMove",g),i("hintMove",{game:_,id:g,text:a.j.SOLVED}))},goToNode:function goToNode(t,r){var i=t.commit,o=r.game,a=r.id,l=r.ids;o.tree.selected.line===l.line&&o.tree.selected.move===l.move||(i("selectNode",{game:o,id:a,ids:l}),0!==l.line&&i("setVariationParentNode",{id:a,game:o}))},hintMove:function hintMove(t,r){var i=t.commit,o=r.game,a=r.id;i("changePuzzleButtonText",{id:a,text:r.text}),i("moveForward",{game:o,id:a})},init:function init(t,r){(0,t.commit)("setViewer",r)},lastPuzzleMove:function lastPuzzleMove(t,r){var i=t.commit;i("clearPuzzleMoveList",r),i("changeAbilityToMove",{id:r,newState:!1}),i("puzzleSolution",r)},selectVariation:function selectVariation(t,r){var i=t.commit,o=t.rootState,a=r.id,l=r.step,h=o.diagramViewer.viewers[a].selectedGame.setup.variations,g=h.findIndex((function(t){return!0===t.selected}))+l;g<0?g=0:g>h.length-1&&(g=h.length-1),i("clearSelectedVariations",a),i("switchVariation",{id:a,index:g})},setVariations:function setVariations(t,r){(0,t.commit)("setVariations",{id:r.id,variations:function createVariationsArray(t,r){var i=t.tree;if(i.selectedNode)return r.reduce((function(t,r){var o=r.moves.filter((function(t){return t.beforeFen===i.selectedNode.fen})).map((function(t){return{ids:t.ids,isFirstNodeOnLine:t.isFirstNodeOnLine,isWhite:t.isWhite,nodeMoveNumber:t.nodeMoveNumber,previousHasComment:t.previousHasComment,previousHasLines:t.previousHasLines,san:t.san,selected:!1}}));return o.forEach((function(t){t.ids.move===i.selected.move+1&&t.ids.line===i.selected.line&&(t.selected=!0)})),t.concat(o)}),[])}(r.game,r.lines)})}},g=i("./web/core/api/diagram-viewer/helpers/is-chess-game.js"),y=i("./web/core/api/diagram-editor/config.js");var _={getGameById:function getGameById(t){return function(r){return t.viewers[r].selectedGame}},getPuzzleButtonText:function getPuzzleButtonText(t){return function(r){return t.viewers[r].selectedGame.setup.puzzleSetup.puzzleButtonText}},getPuzzleMoveList:function getPuzzleMoveList(t){return function(r){return t.viewers[r].selectedGame.setup.puzzleSetup.puzzleMoveList}},getPuzzleStart:function getPuzzleStart(t){return function(r){return t.viewers[r].selectedGame.setup.puzzleSetup.puzzleStart}},getShareModal:function getShareModal(t){return function(r){return t.viewers[r].shareModal}},getVariations:function getVariations(t){return function(r){return t.viewers[r].selectedGame.setup.variations}},getVariationPopover:function getVariationPopover(t){return function(r){return t.viewers[r].variationPopover}},getViewerById:function getViewerById(t){return function(r){return t.viewers[r]}},isBlackAtBottom:function isBlackAtBottom(t){return function(r){return t.viewers[r].selectedGame.setup.boardFlip}},isChessGame:function isChessGame(t){return function(r){return Object(g.a)(t.viewers[r].selectedGame.setup.diagramType)}},isChessProblem:function isChessProblem(t){return function(r){return function is_chess_problem_isChessProblem(t){return t===y.b.CHESS_PROBLEM}(t.viewers[r].selectedGame.setup.diagramType)}},isSimpleDiagram:function isSimpleDiagram(t){return function(r){return function is_simple_diagram_isSimpleDiagram(t){return t===y.b.SIMPLE_DIAGRAM}(t.viewers[r].selectedGame.setup.diagramType)}},isWhiteMove:function isWhiteMove(t){return function(r){return t.viewers[r].selectedGame.setup.puzzleSetup.isWhite}}},x=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),w=i.n(x);function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){w()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}function createGames(t){return t.map((function(t){var r={isWhite:!0,puzzleButtonText:a.j.WHITE_TO_MOVE,puzzleMoveList:[],puzzleStart:!0,lastMovePlayed:!1},i=_objectSpread(_objectSpread({},t),{},{puzzleSetup:r,variations:[],variationParentNode:{}}),o={allowMarkings:!0,boardStyle:i.colorScheme,coordinates:!!i.boardCoords&&a.c.INSIDE,enabled:i.diagramType===y.b.CHESS_PROBLEM,flipBoard:i.boardFlip,overlayInAnalysisMode:!1,pieceStyle:i.pieceStyle,playSounds:!1};return{game:function createCurrentGame(t){var r=l.a.createGame({settings:{analysis:!0,variations:!0}}),i=l.a.loadFromPgn(r,t.pgnBody),o=l.a.selectLineStart(i);return t.beginNode&&(o=l.a.selectNode(i,{line:0,move:t.beginNode-1})),t.focusNode&&(o=l.a.selectNode(i,{line:0,move:t.focusNode-1})),o}(i),boardOptions:o,setup:i}}))}function mutations_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function mutations_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?mutations_ownKeys(Object(i),!0).forEach((function(r){w()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):mutations_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var S={changeAbilityToMove:function changeAbilityToMove(t,r){var i=r.id,o=r.newState;t.viewers[i].selectedGame.boardOptions.enabled=o},changePuzzleButtonText:function changePuzzleButtonText(t,r){var i=r.id,o=r.text;t.viewers[i].selectedGame.setup.puzzleSetup.puzzleButtonText=o},clearVariationParentNode:function clearVariationParentNode(t,r){t.viewers[r].selectedGame.setup.variationParentNode={}},clearPuzzleMoveList:function clearPuzzleMoveList(t,r){t.viewers[r].selectedGame.setup.puzzleSetup.puzzleMoveList=[]},clearSelectedVariations:function clearSelectedVariations(t,r){t.viewers[r].selectedGame.setup.variations.forEach((function(t){return t.selected=!1}))},clearVariations:function clearVariations(t,r){t.viewers[r].selectedGame.setup.variations=[]},deleteLine:function deleteLine(t,r){t.viewers[r].selectedGame.game=l.a.deleteLine(t.viewers[r].selectedGame.game,1)},firstTryOfLastMove:function firstTryOfLastMove(t,r){t.viewers[r].selectedGame.setup.puzzleSetup.lastMovePlayed=!0},flipBoard:function flipBoard(t,r){t.viewers[r].selectedGame.boardOptions.flipBoard=!t.viewers[r].selectedGame.boardOptions.flipBoard},hideShareModal:function hideShareModal(t,r){t.viewers[r].shareModal=!1},hideVariationPopover:function hideVariationPopover(t,r){t.viewers[r].variationPopover=!1},loadFromPgn:function loadFromPgn(t,r){var i=r.id,o=r.pgn;t.viewers[i].selectedGame.game=l.a.loadFromPgn(t.viewers[i].selectedGame.game,o)},makeMove:function makeMove(t,r){var i=r.id,o=r.move;t.viewers[i].selectedGame.game=l.a.makeMove(t.viewers[i].selectedGame.game,o)},moveBackward:function moveBackward(t,r){var i=r.game,o=r.id;l.a.canMoveBackward(i)&&(t.viewers[o].selectedGame.game=l.a.moveBackward(i))},moveForward:function moveForward(t,r){var i=r.game,o=r.id;l.a.canMoveForward(i)&&(t.viewers[o].selectedGame.game=l.a.moveForward(i))},moveToEnd:function moveToEnd(t,r){var i=r.game,o=r.id,a=t.viewers[o].selectedGame,h=a.setup.endNode-1;h&&h!==a.game.tree.selected.move&&-1!==h?t.viewers[o].selectedGame.game=l.a.selectNode(i,{line:0,move:h}):t.viewers[o].selectedGame.game=l.a.moveToEnd(i)},moveToStart:function moveToStart(t,r){var i,o=r.game,a=r.id,h=t.viewers[a].selectedGame,g=h.setup,_=g.diagramType;g.beginNode&&(i=g.beginNode-1),g.focusNode&&_===y.b.CHESS_PROBLEM&&(i=g.focusNode-1),i&&i!==h.game.tree.selected.move?t.viewers[a].selectedGame.game=l.a.selectNode(o,{line:0,move:i}):t.viewers[a].selectedGame.game=l.a.moveToStart(o)},pushMoveOnPuzzleMoveList:function pushMoveOnPuzzleMoveList(t,r){var i=r.id,o=r.move;t.viewers[i].selectedGame.setup.puzzleSetup.puzzleMoveList.push(o)},puzzleReset:function puzzleReset(t,r){t.viewers[r].selectedGame.setup.puzzleSetup.puzzleStart=!0},puzzleSolution:function puzzleSolution(t,r){t.viewers[r].selectedGame.setup.puzzleSetup.puzzleStart=!1},selectNode:function selectNode(t,r){var i=r.game,o=r.id,a=r.ids;t.viewers[o].selectedGame.game=l.a.selectNode(i,{line:a.line,move:a.move})},selectStartLine:function selectStartLine(t,r){t.viewers[r].selectedGame.game=l.a.selectLineStart(t.viewers[r].selectedGame.game)},setBlackAtBottom:function setBlackAtBottom(t,r){t.viewers[r].selectedGame.boardOptions.flipBoard=!0},setVariationParentNode:function setVariationParentNode(t,r){var i=r.id,o=r.game;t.viewers[i].selectedGame.setup.variationParentNode=function parentNode(t){var r=t.tree.selected;return t.tree.lines.reduce((function(t,i){return t||i.find((function(t){var i=t.lines;return i&&i.includes(r.line)}))}),null)}(o)},setViewer:function setViewer(t,r){var i=r.id,o=createGames(r.setup);t.viewers=mutations_objectSpread(mutations_objectSpread({},t.viewers),{},w()({},i,{games:o,selectedGame:o[0],shareModal:!1,variationPopover:!1}))},setSelectedGame:function setSelectedGame(t,r){var i=r.id,o=r.game;t.viewers[i].selectedGame=o},setFirstMoveIsWhite:function setFirstMoveIsWhite(t,r){var i=r.id,o=r.type;t.viewers[i].selectedGame.setup.puzzleSetup.isWhite=o},showShareModal:function showShareModal(t,r){t.viewers[r].shareModal=!0},showVariationPopover:function showVariationPopover(t,r){t.viewers[r].variationPopover=!0},setVariations:function setVariations(t,r){var i=r.id,o=r.variations;t.viewers[i].selectedGame.setup.variations=o},switchVariation:function switchVariation(t,r){var i=r.id,o=r.index;t.viewers[i].selectedGame.setup.variations[o].selected=!0},togglePuzzle:function togglePuzzle(t,r){t.viewers[r].selectedGame.setup.puzzleStart=!t.viewers[r].selectedGame.setup.puzzleStart}};r.a={namespaced:!0,actions:h,getters:_,mutations:S,state:{viewers:{}}}},"./web/core/store/plugins/save-state/index.js":function(t,r,i){t.exports=i("dll-reference vueDLL")("./web/core/store/plugins/save-state/index.js")},"./web/core/widgets/diagram-viewer/create-diagram-viewer.js":function(t,r,i){"use strict";i.d(r,"a",(function(){return createDiagramViewer}));var o=i("./web/core/api/diagram-viewer/helpers/get-diagram-setup.js"),a=i("./web/core/api/diagram-viewer/helpers/get-diagram-id.js"),l=i("./web/core/api/diagram-viewer/helpers/get-diagram-type.js"),h=i("./web/core/widgets/diagram-viewer/diagram-viewer.vue"),g=i("./utils/multivue.js"),y=i("./web/core/store/index.js");function createDiagramViewer(t){return Object(g.a)(t,h.a,(function(r){return{data:Object(o.a)(r),id:Object(a.a)(r),type:Object(l.a)(t)}}),"",y.default)}},"./web/core/widgets/diagram-viewer/diagram-analysis.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-analysis.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-board.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-board.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-button-bar.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-button-bar.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-button.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-button.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-game-header.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-header.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-game-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-list.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-game-row.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-game-row.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-header.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-header.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-move-list.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-move-list.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-share-modal.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-share-modal.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-variation-popover.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-variation-popover.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/diagram-viewer.vue":function(t,r,i){"use strict";var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),a=i.n(o),l=i("./web/core/api/diagram-viewer/config.js"),h=function getShortDiagramId(t){return t.split("_")[0]},g=i("./utils/browser.js"),y=i("./node_modules/vuex/dist/vuex.esm.js");function selected_node_selectedNode(t,r){var i=t.tree.selected;if(!(i.move<0)){var o=r.$refs["move-".concat(i.line,"-").concat(i.move)];return o?o[0].$refs.moveText:void 0}}var _=i("./web/core/api/diagram-viewer/helpers/is-chess-game.js");function addNonEmptyValue(t,r,i){var o=i;r&&""!==o&&(o.includes("\n")&&(o+="\n"),t[r]=o)}var x=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),w=i.n(x);function replaceDefaultPgnHeaderSymbol(t,r,i){var o=l.d.COMMON;return!!t[r]&&(r===l.m.RESULT&&(o=l.d.RESULT),t[r]===o?i[r]="":t[r]===l.m.WHITE||l.m.BLACK||l.m.SITE||l.m.EVENT?i[r]=function entityNumbersToChars(t){return t.replace(/&#(\d+);/g,(function(t,r){return String.fromCharCode(r)}))}(t[r]):i[r]=t[r],i[l.m.RESULT]===l.d.COMMON&&(i[l.m.RESULT]=""),i.whiteElo===l.d.COMMON&&(i.whiteElo=""),i.blackElo===l.d.COMMON&&(i.blackElo=""),i)}function getCorrectTagsRegister(t){var r={annotator:t.annotator,black:t.black||"",blackElo:t.blackelo,currentPosition:t.currentposition,date:"",eco:t.eco,eventDate:t.eventdate,fen:t.fen,opening:t.opening,playCount:t.plycount,setUp:t.setup,sourceDate:t.sourcedate,white:t.white||"",whiteElo:t.whiteelo};return[l.m.BLACK,l.m.EVENT,l.m.RESULT,l.m.ROUND,l.m.SITE,l.m.WHITE].forEach((function(i){return replaceDefaultPgnHeaderSymbol(t,i,r)})),t.date&&function formatGameDate(t,r){var i="";if(t.match(/([12]\d{3}\.(0[1-9]|1[0-2]|\?\?)\.(0[1-9]|[12]\d|3[01]|\?\?))/g)){var o=t.split("."),a=w()(o,3),h=a[0],g=a[1],y=a[2];if(h!==l.d.YEAR&&(i+=h,r.year=h,g!==l.d.MONTHS)){var _=l.i,x=Number(g)-1;_[x]&&(i="".concat(_[x]," ").concat(i),y!==l.d.DAY&&(i="".concat(y," ").concat(i)))}}return r.date=i,r}(t.date,r),r}function parseGameSetup(t){var r,i=function getSetupValues(t){var r={},i=null,o="";return t.split("\n").forEach((function(t){var a=t.trim();!function isPropertyNamePattern(t){return t.match("&-[a-z]+:")}(a)?i&&(o=function addRowToValue(t,r){var i=t;return""!==i&&(i+="\n"),i+r}(o,a)):(addNonEmptyValue(r,i,o),i=function trimPropertyName(t){var r=t.substring(2,t.length-1);return r.indexOf(":")===r.length-1&&(r=r.substring(0,r.length-1)),r}(a),o="")})),addNonEmptyValue(r,i,o),r}(t),o={beginNode:Number(i.beginnode)||0,boardCoords:"true"===i.coords,boardFlip:"true"===i.flip,boardFloat:i.float,boardPrompt:"true"===i.prompt,boardSize:Number(i.size),colorScheme:i.colorscheme,diagramType:i.diagramtype,endNode:Number(i.endnode)||0,focusNode:Number(i.focusnode)||0,lastMove:i.lastmove,hideGlobalButtons:"true"===i.hideglobalbuttons,pgnBody:i.pgnbody,pieceStyle:i.piecestyle,tags:(r=i.pgnbody,getCorrectTagsRegister(function pgnHeaderToObj(t,r){return t.forEach((function(t){var i=t.slice(1,-1).split('"'),o=i[0].toLowerCase().trim(),a=i[1];r[o]=a})),r}(function getPgnHeader(t){var r=t.findIndex((function(t){return""===t.trim()}));return t.slice(0,r)}(function pgnStringToArray(t){return t.split("\n")}(r)),{})))};return i.movelistcontrol&&(o.moveListControl=i.movelistcontrol),i.commentbox&&(o.commentBox=i.commentbox),o}function ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var S={props:{gameId:{type:String,required:!0}},computed:_objectSpread(_objectSpread({},Object(y.mapGetters)("diagramViewer",["getGameById","getViewerById"])),{},{currentGame:function currentGame(){return this.getGameById(this.gameId)},games:function games(){return this.getViewerById(this.gameId).games},setup:function setup(){var setup=this.getGameById(this.gameId).setup;return setup}})},M={name:"DiagramAnalysis",mixins:[S],data:function data(){return{routes:l.l}},computed:{fen:function fen(){return this.setup.tags.fen||""},formId:function formId(){return"diagram-".concat(this.gameId,"-analysis")}}},T=i("./web/core/widgets/diagram-viewer/diagram-analysis.vue?vue&type=style&index=0&lang=scss&module=true&"),P=i("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var C=Object(P.a)(M,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("form",{attrs:{id:t.formId,method:"POST",target:"_blank",action:t.routes.analysis}},[i("input",{attrs:{name:"pgn",type:"hidden"},domProps:{value:t.setup.pgnBody}}),t._v(" "),i("input",{attrs:{name:"fen",type:"hidden"},domProps:{value:t.fen}})])])}),[],!1,(function injectStyles(t){this.$style=T.default.locals||T.default}),null,null).exports,A=i("./web/core/api/diagram-viewer/helpers/can-make-puzzle-move.js"),O=i("./chessboard/src/game/index.js"),L=i("./chessboard/src/game/utils.js");function moveIsValid(t,r,i){var o=t.tree.lines[0],a=o[0];if(i&&o.includes(i)){var l=o.indexOf(i)+1,h=o[l];if(!h)return!1;a=h}var g=!(a.promotion&&r.promotion)||a.promotion===r.promotion;return a.from===r.from&&a.to===r.to&&g}var I=i("./utils/amplitude/logger.js");function diagram_boardvue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_boardvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_boardvue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_boardvue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var R={name:"DiagramBoard",components:{ChessBoard:window.chesscom.defaultChessBoard},mixins:[S],props:{type:{type:String,required:!0}},emits:["wrapper-click"],computed:diagram_boardvue_type_script_lang_js_objectSpread(diagram_boardvue_type_script_lang_js_objectSpread({},Object(y.mapGetters)("diagramViewer",["isWhiteMove"])),{},{lastAvailableUserMove:function lastAvailableUserMove(){var t=this.currentGame,r=t.game,i=(t.setup.puzzleSetup.puzzleMoveList.length+1||1)===r.tree.lines[0].length,o=!O.a.canMoveForward(r,3)&&!Object(A.a)(t,3);return i||o},lastMovePlayed:function lastMovePlayed(){return this.currentGame.setup.puzzleSetup.lastMovePlayed}}),methods:diagram_boardvue_type_script_lang_js_objectSpread(diagram_boardvue_type_script_lang_js_objectSpread(diagram_boardvue_type_script_lang_js_objectSpread({},Object(y.mapActions)("diagramViewer",["correctMove"])),Object(y.mapMutations)("diagramViewer",["changeAbilityToMove","changePuzzleButtonText","clearPuzzleMoveList","deleteLine","loadFromPgn","makeMove","puzzleSolution","selectNode","selectStartLine","firstTryOfLastMove"])),{},{logAmplitude:function logAmplitude(t){var r=t?l.a.SOLVED:l.a.FAILED;I.a.logEvent(l.f.DAILY_PUZZLE,{result:r})},makeBoardMove:function makeBoardMove(t){var r=this,i=this.currentGame.game,o=this.gameId,a=function getFormattedMove(t){return{from:L.a.getSanFromFileRank(t.from),to:L.a.getSanFromFileRank(t.to),promotion:t.promotion}}(t),h=moveIsValid(i,a,i.tree.selectedNode);if(this.type===l.o.DAILY_PUZZLE&&this.lastAvailableUserMove&&!this.lastMovePlayed&&(this.logAmplitude(h),this.firstTryOfLastMove(o)),!t.isIllegal)if(h)this.correctMove({currentGame:this.currentGame,id:o,text:l.j.CORRECT});else{var g=i.tree.selected,y=-1===g.move,_=O.a.getPgn(i);this.makeMove({id:o,move:a}),this.changePuzzleButtonText({id:o,text:l.j.INCORRECT}),setTimeout((function(){y?(r.loadFromPgn({id:o,pgn:_}),r.selectStartLine(o)):(r.selectNode({game:i,id:o,ids:g}),r.deleteLine(o));var t=r.isWhiteMove(o)?l.j.WHITE_TO_MOVE:l.j.BLACK_TO_MOVE;r.changePuzzleButtonText({id:o,text:t})}),l.b.TIMEOUT)}},wrapperClickEvent:function wrapperClickEvent(){this.$emit("wrapper-click")}})},j=i("./web/core/widgets/diagram-viewer/diagram-board.vue?vue&type=style&index=0&lang=scss&module=true&");var N=Object(P.a)(R,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component,on:{click:t.wrapperClickEvent}},[i("chess-board",{attrs:{"board-id":t.gameId,game:t.currentGame.game,options:t.currentGame.boardOptions},on:{"chessboard-makeMove":t.makeBoardMove}})],1)}),[],!1,(function diagram_board_injectStyles(t){this.$style=j.default.locals||j.default}),null,null).exports,k=i("./web/core/api/diagram-editor/config.js"),D=[{click:function click(){this.formSubmit()},icon:l.g.ANALYSIS,show:l.b.ANALYSIS,title:l.n.analysis},{click:function click(){this.hint()},icon:l.g.HINT,show:k.b.CHESS_PROBLEM,title:l.n.hint},{click:function click(){this.solution()},icon:l.g.SOLUTION,show:k.b.CHESS_PROBLEM,title:l.n.solution},{click:function click(){this.reset()},icon:l.g.RESET,show:k.b.CHESS_PROBLEM,title:l.n.reset},{click:function click(){this.boardFlip()},icon:l.g.FLIPBOARD,show:k.b.CHESS_PROBLEM,title:l.n.flipBoard},{click:function click(){this.openShareModal()},icon:l.g.SHARE,show:"",title:l.n.share},{click:function click(){this.downloadMultiPgn()},icon:l.g.DOWNLOAD,show:l.b.MULTI_PGN_VIEWER,title:l.n.download}];function vue_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function bindFunction(t,r){return t.map((function(t){var i=function vue_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?vue_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):vue_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}({},t);return Object.keys(i).filter((function(t){return"function"==typeof i[t]})).forEach((function(t){return i[t]=i[t].bind(r)})),i}))}var B=[{click:function click(){this.boardFlip()},icon:l.g.FLIPBOARD,show:k.b.CHESS_GAME,title:l.n.flipBoard},{click:function click(){this.triggerPlayPause()},icon:l.g.PLAY,show:"",title:l.n.playPause},{click:function click(){this.triggerMoveToStart()},icon:l.g.PREVIOUS,show:"",title:l.n.firstMove},{click:function click(){this.triggerMoveBackward()},icon:l.g.LEFT,show:"",title:l.n.previousMove},{click:function click(){this.triggerMoveForward()},icon:l.g.RIGHT,show:"",title:l.n.nextMove},{click:function click(){this.triggerMoveToEnd()},icon:l.g.NEXT,show:"",title:l.n.lastMove}],G=i("./utils/download-as-file.js"),H={name:"DiagramButton",props:{click:{type:Function,required:!0},icon:{type:String,required:!0},title:String}},V=i("./web/core/widgets/diagram-viewer/diagram-button.vue?vue&type=style&index=0&lang=scss&module=true&");function diagram_button_barvue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_button_barvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_button_barvue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_button_barvue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var U={name:"DiagramButtonBar",components:{DiagramButton:Object(P.a)(H,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("button",{class:t.$style.component,attrs:{"aria-label":t.title,title:t.title},on:{click:t.click}},[i("div",{staticClass:"icon-font-chess",class:[t.$style.icon,t.icon]})])}),[],!1,(function diagram_button_injectStyles(t){this.$style=V.default.locals||V.default}),null,null).exports},mixins:[S],data:function data(){return{actions:bindFunction(D,this),controls:bindFunction(B,this),nextMoveTimeout:null,playing:!1}},computed:diagram_button_barvue_type_script_lang_js_objectSpread(diagram_button_barvue_type_script_lang_js_objectSpread({},Object(y.mapGetters)("diagramViewer",["getPuzzleButtonText","getPuzzleStart","isChessGame","isChessProblem","isSimpleDiagram","isWhiteMove"])),{},{isVotechessPage:function isVotechessPage(){return window.location.href.includes(l.l.votechess)},multiPgn:function multiPgn(){return this.games.map((function(t){return t.setup.pgnBody})).join("")},puzzleStart:function puzzleStart(){return this.isChessProblem(this.gameId)&&this.getPuzzleStart(this.gameId)},showControlsButtons:function showControlsButtons(){return(this.isChessGame(this.gameId)||!this.puzzleStart)&&!this.isSimpleDiagram(this.gameId)}}),methods:diagram_button_barvue_type_script_lang_js_objectSpread(diagram_button_barvue_type_script_lang_js_objectSpread(diagram_button_barvue_type_script_lang_js_objectSpread({},Object(y.mapActions)("diagramViewer",["correctMove"])),Object(y.mapMutations)("diagramViewer",["changeAbilityToMove","changePuzzleButtonText","clearPuzzleMoveList","flipBoard","moveBackward","moveForward","moveToEnd","moveToStart","puzzleReset","puzzleSolution","showShareModal"])),{},{boardFlip:function boardFlip(){this.flipBoard(this.gameId)},changeIcon:function changeIcon(){var t=this;this.controls.forEach((function(r){t.playing&&r.icon===l.g.PLAY&&(r.icon=l.g.PAUSE),t.playing||r.icon!==l.g.PAUSE||(r.icon=l.g.PLAY)}))},delayedMoveForward:function delayedMoveForward(){this.triggerMoveForward(),this.nextMoveTimeout=setTimeout(this.playNextMove.bind(this),l.b.TIMEOUT)},downloadMultiPgn:function downloadMultiPgn(){Object(G.a)(this.multiPgn,l.b.MULTI_GAMES_PGN)},filteredButtons:function filteredButtons(t){var r=this;return t.filter((function(t){return r.showButton(t)}))},formSubmit:function formSubmit(){document.getElementById("diagram-".concat(this.gameId,"-analysis")).submit()},hint:function hint(){var t=this.gameId;if(this.getPuzzleButtonText(t)!==l.j.SOLVED){var r=this.isWhiteMove(t)?l.j.BLACK_TO_MOVE:l.j.WHITE_TO_MOVE;this.correctMove({currentGame:this.currentGame,id:t,text:r})}},notEndNode:function notEndNode(t){var r=this.currentGame.setup.endNode,i=t.tree.selectedNode;return!r||!i||i.moveNumber<r-1},openShareModal:function openShareModal(){this.showShareModal(this.gameId)},playNextMove:function playNextMove(){clearTimeout(this.nextMoveTimeout);var t=this.currentGame.game,r=this.gameId,i=O.a.canMoveForward(t,1),o=this.notEndNode(t),a=this.isChessProblem(r),h=Object(A.a)(this.currentGame,1);i&&o&&(!a||h)?this.delayedMoveForward():(this.triggerPlayPause(),this.isChessProblem(r)&&(this.changeAbilityToMove({id:r,newState:!1}),this.changePuzzleButtonText({id:r,text:l.j.SOLVED})))},reset:function reset(){var t=this.gameId;if(this.triggerMoveToStart(),this.clearPuzzleMoveList(t),this.changeAbilityToMove({id:t,newState:!0}),!this.getPuzzleStart(t)){var r=this.isWhiteMove(t)?l.j.WHITE_TO_MOVE:l.j.BLACK_TO_MOVE;this.puzzleReset(t),this.changePuzzleButtonText({id:t,text:r})}},showButton:function showButton(t){return t.show===this.setup.diagramType||""===t.show&&!this.puzzleStart||t.icon===l.g.SHARE||t.show===l.b.MULTI_PGN_VIEWER&&this.games.length>1||t.show===l.b.ANALYSIS&&!this.isVotechessPage&&!this.puzzleStart},solution:function solution(){this.clearPuzzleMoveList(this.gameId),this.getPuzzleStart(this.gameId)&&this.puzzleSolution(this.gameId)},triggerMoveBackward:function triggerMoveBackward(){this.moveBackward({game:this.currentGame.game,id:this.gameId})},triggerMoveForward:function triggerMoveForward(){this.isChessProblem(this.gameId)&&!Object(A.a)(this.currentGame,1)||this.moveForward({game:this.currentGame.game,id:this.gameId})},triggerMoveToEnd:function triggerMoveToEnd(){this.moveToEnd({game:this.currentGame.game,id:this.gameId})},triggerMoveToStart:function triggerMoveToStart(){this.moveToStart({game:this.currentGame.game,id:this.gameId})},triggerPlayPause:function triggerPlayPause(){this.playing=!this.playing,this.changeIcon(),this.playing?this.playNextMove():clearTimeout(this.nextMoveTimeout)}})},z=i("./web/core/widgets/diagram-viewer/diagram-button-bar.vue?vue&type=style&index=0&lang=scss&module=true&");var W=Object(P.a)(U,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{class:t.$style.wrapper},t._l(t.filteredButtons(t.actions),(function(t){return i("diagram-button",{key:t.id,attrs:{click:t.click,icon:t.icon,title:t.title}})})),1),t._v(" "),t.showControlsButtons?i("div",{class:t.$style.wrapper},t._l(t.filteredButtons(t.controls),(function(t){return i("diagram-button",{key:t.id,attrs:{click:t.click,icon:t.icon,title:t.title}})})),1):t._e()])}),[],!1,(function diagram_button_bar_injectStyles(t){this.$style=z.default.locals||z.default}),null,null).exports,q={name:"DiagramGamesHeader"},$=i("./web/core/widgets/diagram-viewer/diagram-game-header.vue?vue&type=style&index=0&lang=scss&module=true&");var X=Object(P.a)(q,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("div",{class:t.$style.wrapper},[i("div",{class:t.$style.common,domProps:{textContent:t._s(t.$trans("players"))}}),t._v(" "),i("div",{class:t.$style.separate,domProps:{textContent:t._s(t.$trans("white"))}}),t._v(" "),i("div",{class:t.$style.separate,domProps:{textContent:t._s(t.$trans("black"))}})]),t._v(" "),i("div",{class:[t.$style.info,t.$style.center],domProps:{textContent:t._s(t.$trans("result"))}}),t._v(" "),i("div",{class:[t.$style.info,t.$style.right],domProps:{textContent:t._s(t.$trans("round"))}}),t._v(" "),i("div",{class:[t.$style.info,t.$style.right],domProps:{textContent:t._s(t.$trans("year"))}})])}),[],!1,(function diagram_game_header_injectStyles(t){this.$style=$.default.locals||$.default}),null,null).exports,K={name:"DiagramGameRow",props:{game:Object},emits:["click"],computed:{result:function result(){return this.tags.result||""},round:function round(){return this.tags.round||""},tags:function tags(){return this.game.setup.tags},year:function year(){return this.tags.year}},methods:{player:function player(t){return t||l.n.unknownPlayer},rating:function rating(t){return t?"(".concat(t,")"):""}}},Y=i("./web/core/widgets/diagram-viewer/diagram-game-row.vue?vue&type=style&index=0&lang=scss&module=true&");function diagram_game_listvue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_game_listvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_game_listvue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_game_listvue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var Z={name:"DiagramGamesList",components:{DiagramGameHeader:X,DiagramGameRow:Object(P.a)(K,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component,on:{click:function(r){return t.$emit("click")}}},[i("div",{class:t.$style.wrapper},[i("div",{class:[t.$style.item,t.$style.big]},[i("span",{class:t.$style.username,domProps:{textContent:t._s(t.player(t.tags.white))}}),t._v(" "),i("span",{class:t.$style.rating,domProps:{textContent:t._s(t.rating(t.tags.whiteElo))}})]),t._v(" "),i("div",{class:[t.$style.item,t.$style.big]},[i("span",{class:t.$style.username,domProps:{textContent:t._s(t.player(t.tags.black))}}),t._v(" "),i("span",{class:t.$style.rating,domProps:{textContent:t._s(t.rating(t.tags.blackElo))}})])]),t._v(" "),i("div",{class:[t.$style.item,t.$style.small,t.$style.center],domProps:{textContent:t._s(t.result)}}),t._v(" "),i("div",{class:[t.$style.item,t.$style.small,t.$style.right],domProps:{textContent:t._s(t.round)}}),t._v(" "),i("div",{class:[t.$style.item,t.$style.small,t.$style.right],domProps:{textContent:t._s(t.year)}})])}),[],!1,(function diagram_game_row_injectStyles(t){this.$style=Y.default.locals||Y.default}),null,null).exports},mixins:[S],methods:diagram_game_listvue_type_script_lang_js_objectSpread(diagram_game_listvue_type_script_lang_js_objectSpread({},Object(y.mapMutations)("diagramViewer",["setSelectedGame"])),{},{changeSelectedGame:function changeSelectedGame(t){this.setSelectedGame({id:this.gameId,game:t})},selectedGame:function selectedGame(t){return t.game.id===this.currentGame.game.id}})},Q=i("./web/core/widgets/diagram-viewer/diagram-game-list.vue?vue&type=style&index=0&lang=scss&module=true&");var J=Object(P.a)(Z,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component},[i("diagram-game-header"),t._v(" "),i("div",{class:t.$style.list},t._l(t.games,(function(r,o){var a;return i("diagram-game-row",{key:o,class:[t.$style.item,(a={},a[t.$style.selected]=t.selectedGame(r),a)],attrs:{game:r},on:{click:function(i){return t.changeSelectedGame(r)}}})})),1)],1)}),[],!1,(function diagram_game_list_injectStyles(t){this.$style=Q.default.locals||Q.default}),null,null).exports,ee=i("./chessboard/src/game/move-node/helper.js");function diagram_variation_popovervue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_variation_popovervue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_variation_popovervue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_variation_popovervue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var te={name:"DiagramVariationPopover",directives:{clickOutside:i("./utils/directives/click-outside.js").a},mixins:[S],props:{selectedNode:{type:Object,required:!0}},data:function data(){return{positionObj:{top:0,left:0},scroll:0,startingMoveNumber:1}},computed:diagram_variation_popovervue_type_script_lang_js_objectSpread(diagram_variation_popovervue_type_script_lang_js_objectSpread({},Object(y.mapGetters)("diagramViewer",["getVariations"])),{},{padding:function padding(){return{x:-3,y:16,bottom:10}},selectedVariation:function selectedVariation(){return this.getVariations(this.gameId).find((function(t){return!0===t.selected}))},variations:function variations(){return this.getVariations(this.gameId)}}),mounted:function mounted(){this.$el.focus(),this.position()},destroyed:function destroyed(){this.clearVariations(this.gameId)},methods:diagram_variation_popovervue_type_script_lang_js_objectSpread(diagram_variation_popovervue_type_script_lang_js_objectSpread(diagram_variation_popovervue_type_script_lang_js_objectSpread({},Object(y.mapActions)("diagramViewer",["selectVariation"])),Object(y.mapMutations)("diagramViewer",["hideVariationPopover","selectNode","moveBackward","clearSelectedVariations","switchVariation","clearVariations"])),{},{changeSelectedVariation:function changeSelectedVariation(t){var r=this.gameId;this.clearSelectedVariations(r),this.switchVariation({id:r,index:t})},close:function close(){var t=this.gameId;this.hideVariationPopover(t)},doubleClickAction:function doubleClickAction(t){this.changeSelectedVariation(t);var r=this.currentGame.game,i=this.gameId,o=this.selectedVariation.ids;this.hideVariationPopover(i),this.selectNode({game:r,id:i,ids:o}),this.$emit(l.f.FOCUS_ON_WIDGET)},getPopoverPosition:function getPopoverPosition(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},a={top:0,left:0},l=i.x-t.x+o.x,h=t.width-r.width-1;return a.left=Math.min(l,h),a.top=i.y-t.y+o.y,t.bottom<i.x+o.x+r.height&&(a.maxHeight=t.bottom-i.bottom-o.bottom),a},onKeyDown:function onKeyDown(t){t.preventDefault(),t.stopPropagation();var r=this.currentGame.game,i=this.gameId,o=this.selectedVariation.ids;switch(t.keyCode){case l.h.LEFT:this.hideVariationPopover(i),this.moveBackward({game:r,id:i}),this.$emit(l.f.FOCUS_ON_WIDGET);break;case l.h.UP:this.selectVariation({id:i,step:-1}),this.scroll-=l.b.VARIATION_HEIGHT,this.$el.scrollTop=this.scroll;break;case l.h.RIGHT:case l.h.ENTER:this.hideVariationPopover(i),this.selectNode({game:r,id:i,ids:o}),this.$emit(l.f.FOCUS_ON_WIDGET);break;case l.h.DOWN:this.selectVariation({id:i,step:1}),this.scroll+=l.b.VARIATION_HEIGHT,this.$el.scrollTop=this.scroll}},moveNumber:function moveNumber(t){return Object(ee.e)(t,this.startingMoveNumber)},position:function position(){var t=this.getPopoverPosition(this.$el.parentNode.getBoundingClientRect(),this.$el.getBoundingClientRect(),this.selectedNode.$el.getBoundingClientRect(),this.padding),r=t.top,i=t.left,o=t.maxHeight;this.positionObj.top="".concat(r,"px"),this.positionObj.left="".concat(i,"px"),this.positionObj.maxHeight="".concat(o,"px")}})},ne=i("./web/core/widgets/diagram-viewer/diagram-variation-popover.vue?vue&type=style&index=0&lang=scss&module=true&");var re=Object(P.a)(te,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.close,expression:"close"}],ref:"popover",class:t.$style.component,style:t.positionObj,attrs:{tabindex:"-1"},on:{keydown:t.onKeyDown}},[i("div",{class:t.$style.wrapper},t._l(t.variations,(function(r,o){var a;return i("div",{key:r.id,class:[t.$style.row,(a={},a[t.$style.selected]=r.selected,a)],on:{click:function(r){return t.changeSelectedVariation(o)},dblclick:function(r){return t.doubleClickAction(o)}}},[i("span",{class:t.$style["icon-wrap"]},[r.selected?i("div",{staticClass:"icon-font-chess arrow-right",class:t.$style.icon}):t._e()]),t._v(" "),t.moveNumber(r)?i("span",{domProps:{innerHTML:t._s(t.moveNumber(r))}}):t._e(),t._v("\n\n      "+t._s(r.san)+"\n    ")])})),0)])}),[],!1,(function diagram_variation_popover_injectStyles(t){this.$style=ne.default.locals||ne.default}),null,null).exports,ie=i("./web/core/api/move-list/config.js"),oe=i("./web/core/api/move-list/context-menu/config.js"),ae=i("./utils/dom/index.js");function handleHistoryEvent(t,r){var i=r.type,o=r.payload,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.prototype.hasOwnProperty.call(a,i)&&a[i].call(null,t,o)}var se,ce=i("./chessboard/src/game/history.js"),le=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ue=i.n(le),de=i("./chessboard/src/game/line.js"),he=function mappings(){var t={mappings:{}},r=function getMappingKey(t,r){return"line-".concat(t,"-move-").concat(r)};return{addMapping:function addMapping(r,i){t.mappings[r]=i},getMappingKey:r,getMappedMoveIds:function getMappedMoveIds(i,o){return t.mappings[r(i,o)]},resetMappings:function resetMappings(){t.mappings={}},state:t}}(),pe=i("./node_modules/@babel/runtime/helpers/classCallCheck.js"),fe=i.n(pe),me=i("./node_modules/@babel/runtime/helpers/createClass.js"),ge=i.n(me),ve=i("./web/core/api/move-list/move-node/helper.js"),ye=function(){function LineNode(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];fe()(this,LineNode);var a=Object.assign({id:0,hasAltLines:!1,isChild:!1,isContinuation:!1,moves:[]},r);this.formattedLineNumber=i,this._JCELines=o,Object.keys(a).forEach((function(r){return t[r]=a[r]}))}return ge()(LineNode,[{key:"addMove",value:function addMove(t){var r=t.previous?de.a.findNode(this._JCELines,t.previous):null;this.moves.push(Object(ve.a)(t,r)),this.addMoveMapping(t)}},{key:"addMoveMapping",value:function addMoveMapping(t){var r=he.getMappingKey(t.ids.line,t.ids.move);he.addMapping(r,{line:this.formattedLineNumber,move:this.getLastMoveIndex()})}},{key:"getFirstMove",value:function getFirstMove(){return this.moves[0]||{}}},{key:"getLastMove",value:function getLastMove(){return this.moves[this.getLastMoveIndex()]||{}}},{key:"getLastMoveIndex",value:function getLastMoveIndex(){return this.moves.length-1}},{key:"toObject",value:function toObject(){var t=this,r={};return["id","hasAltLines","isChild","isContinuation","moves"].forEach((function(i){return r[i]=t[i]})),r}}]),LineNode}(),be=function(){function MoveListLines(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];fe()(this,MoveListLines),this.lines=[],this._JCELines=t}return ge()(MoveListLines,[{key:"addLine",value:function addLine(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.getLastLineIndex()+1;this.lines.push(new ye(t,r,this._JCELines))}},{key:"getLastLine",value:function getLastLine(){return this.getLine(this.getLastLineIndex())}},{key:"getLastLineIndex",value:function getLastLineIndex(){return this.lines.length-1}},{key:"getLine",value:function getLine(t){return this.lines[t]}},{key:"toObjects",value:function toObjects(){return this.lines.map((function(t){return t.toObject()}))}}]),MoveListLines}(),_e=function getAlternateLines(t,r){return r.lines.reduce((function(r,i){return[].concat(ue()(r),[t[i]])}),[])},xe=function flattenAlternateLine(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r.forEach((function(a,l){var h=Object.assign({},a);h.openParenthesis=Boolean(0===l),h.indentation=o,i.addMove(h),h.lines&&_e(t,h).forEach((function(r){flattenAlternateLine(t,r,i,o+1)})),h.lines||l+1!==r.length||(i.getLastMove().closeParenthesisCount=i.getLastMove().closeParenthesisCount+1||1)}));var a=i.getFirstMove(),l=i.getLastMove();r.id===i.id&&l.indentation!==a.indentation&&l.closeParenthesisCount>0&&(i.getLastMove().closeParenthesisCount+=l.indentation-1)},we=function createFormattedLinesFromMoveNodeLines(t,r,i){var o=_e(t,i);Array.isArray(o)&&void 0!==o&&(o=o.filter(Boolean)).forEach((function(i){if(r.addLine({hasAltLines:void 0!==i.lines,id:i.id,isChild:!0}),xe(t,i,r.getLastLine()),de.a.isContinuation(t,i.id)){var o=r.getLastLine();o.isContinuation=!0,o.getFirstMove().isInvisible=o.length>1}}))},Se=function getFormattedLines(t){var r=new be(t);return he.resetMappings(),r.addLine(),t[0].forEach((function(i){r.getLastLine().isChild&&r.addLine(),r.getLastLine().addMove(i),i.lines&&we(t,r,i)})),r.toObjects()},Me=i("./chessboard/src/game/move-list/helper.js"),get_lines=function(t){return Object(Me.a)(t.game)?t.game.tree.lines:t.moveList.lines};var setup_game=function(t){t.lines=Se(get_lines(t)),t.startingMoveNumber=function getStartingMoveNumber(t){var r=get_lines(t),i=t.game.setup.moveNumber;if(r&&r[0].length){var o=t.game.tree.selectedNode;o&&(i-=Math.ceil(o.moveNumber/2),2===r[0][0].color&&2===o.color&&(i-=1))}return i}(t),t.$nextTick((function(){var r=t.game.tree.selected,i=t.getComponentRefByLineMove(r.line,r.move);i&&(se&&(se.isSelected=!1),se=i,i.isSelected=!0,t.updateScrollPosition(r))}))};var deselect_selected_nodes=function(t){Object.keys(t.$refs).forEach((function(r){var i=t.$refs[r]&&t.$refs[r][0];i&&void 0!==i.isSelected&&!0===i.isSelected&&(i.isSelected=!1)}))};var Ee,Te=i("./utils/object.js"),Pe=i("./web/core/api/move-list/move-list.js"),Ce=["annotationString","coords","closeParenthesisCount","figurineIndex","hasComment","hasCommentBefore","hasLines","iconName","indentation","isEnPassant","isInvisible","isFirstNodeOnLine","isWhite","nodeMoveNumber","openParenthesis","previousHasComment","previousHasLines"].concat(ue()(Pe.nodeProps)),Ae=["atMoveNode","curFen","id","initComment","startingFen","parentId","hasAltLines","isChild","isContinuation"],Oe=function updateLine(t,r,i){Ae.forEach((function(o){t.lines[r][o]!==i[o]&&t.$set(t.lines[r],o,i[o])}))},Le=function updateMove(t,r,i){var o=r.line,a=r.move,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ce;l.forEach((function(r){(!Object(Te.b)(t.lines[o].moves[a],r)&&void 0!==i[r]||t.lines[o].moves[a][r]!==i[r])&&t.$set(t.lines[o].moves[a],r,i[r])}))},Ie=function mergeFormattedLines(t){var r=Se(get_lines(t));!function trimDeletedLines(t,r){if(t.lines.length!==r.length){var i=t.lines.length-r.length;if(i>0)for(var o=i,a=t.lines.length-1;o>0;)t.$delete(t.lines,a),a--,o--}}(t,r),r.forEach((function(i,o){void 0===t.lines[o]?t.$set(t.lines,o,i):(!function trimDeletedMoves(t,r,i){var o=t.lines[i].moves?t.lines[i].moves.length:-1;if(r[i].moves.length<o)for(var a=o-r[i].moves.length,l=t.lines[i].moves.length-1;a>0;)t.$delete(t.lines[i].moves,l),l--,a--}(t,r,o),Oe(t,o,i),i.moves.forEach((function(r,i){void 0===t.lines[o].moves[i]?t.$set(t.lines[o].moves,i,r):Le(t,{line:o,move:i},r)})))}))},highlight_selected_node=function(t){var r=t.game.tree.selected,i=t.getComponentRefByLineMove(r.line,r.move);i&&(i.isSelected=!0)};function treeChange(t){setTimeout((function(){deselect_selected_nodes(t)})),setTimeout((function(){Ie(t)})),setTimeout((function(){t.$nextTick((function(){highlight_selected_node(t)}))}))}var Re=(Ee={},a()(Ee,ce.a.INIT,(function init(t){setup_game(t)})),a()(Ee,ce.a.LOAD,(function load(t){setup_game(t)})),a()(Ee,ce.a.JUMP_TO_POSITION,(function jumpToPosition(t,r){deselect_selected_nodes(t),function(t,r){var i=t.getComponentRefByLineMove(r.from.line,r.from.move),o=t.getComponentRefByLineMove(r.to.line,r.to.move);i&&(i.isSelected=!1),o&&(o.isSelected=!0)}(t,r)})),a()(Ee,ce.a.MAKE_MOVE,(function makeMove(t){setTimeout((function(){Ie(t)})),setTimeout((function(){deselect_selected_nodes(t)})),setTimeout((function(){highlight_selected_node(t)})),setTimeout((function(){!function(t){t.updateScrollPosition(t.game.tree.selected)}(t)}))})),a()(Ee,ce.a.TREE_CHANGE,treeChange),a()(Ee,ce.a.TREE_AMENDED,treeChange),a()(Ee,ce.a.SETTINGS_CHANGE,treeChange),a()(Ee,ce.a.UPDATE_NODE,(function updateNode(t,r){var i=get_lines(t),o=Se(i),a=he.getMappedMoveIds(r.line,r.move),l=o[a.line],h=o[a.line].moves[a.move];if(a){Oe(t,a.line,l),Le(t,a,h);var g=de.a.findNode(i,r,1);if(g.ids.line!==r.line||g.ids.move!==r.move){var y=he.getMappedMoveIds(g.ids.line,g.ids.move),_=o[y.line].moves[y.move];Le(t,y,_,["previousHasComment","previousHasLines"])}}})),Ee),je=i("./utils/event-hub.js"),Ne=i("./utils/mixins/dark-mode-forces.js"),ke=i("./web/core/api/move-list/move-node/config.js"),De=i("./web/core/api/content/config.js"),Be=i("./ui/components/icons/icon-font.vue"),Fe=i("./utils/directives/tooltip.js"),Ge={name:"MoveText",components:{IconFont:Be.a},directives:{Tooltip:Fe.a},props:{moveDisplayType:{type:String,default:ke.a.TEXT},moveCoords:{type:String,required:!1},moveIcon:{type:String,required:!1},moveIsEnpassant:{type:Boolean,default:!1},moveFigurineIndex:{type:Number,required:!1},moveText:{type:String,required:!1},isDarkMode:{type:Boolean,default:!1}},data:function data(){return{coloredMoveIcon:this.moveIcon,coords:"",isSelected:!1,showEnPassantTooltip:!1,showLeadingFigurine:!1,showTrailingFigurine:!1}},watch:{isDarkMode:{handler:"determineIconColor",immediate:!0},moveIcon:{handler:"determineIconColor"},moveDisplayType:function setFigurinesConditions(t,r){t!==r&&(this.setCoordinates(),this.setFigurinesConditions())},moveText:function updateDeps(t,r){t!==r&&this.setCoordinates()},moveFigurineIndex:function updateDeps(t,r){t!==r&&this.setFigurinesConditions()}},created:function created(){this.setCoordinates(),this.setFigurinesConditions()},methods:{determineIconColor:function determineIconColor(){var t=this.moveIcon;this.isDarkMode&&(t=this.moveIcon.includes(ke.e.WHITE)?this.moveIcon.replace(ke.e.WHITE,ke.e.BLACK):this.moveIcon.replace(ke.e.BLACK,ke.e.WHITE)),this.coloredMoveIcon=t},openEnPassantHelpWindow:function openEnPassantHelpWindow(){window.open(De.f.enPassant(),"_blank")},setCoordinates:function setCoordinates(){this.moveDisplayType===ke.a.TEXT?this.coords=this.moveCoords:this.coords=this.moveText.replace(/[BKNRQ]/g,"")},setFigurinesConditions:function setFigurinesConditions(){this.moveDisplayType===ke.a.FIGURINE?(this.showLeadingFigurine=Boolean(0===this.moveFigurineIndex),this.showTrailingFigurine=Boolean(this.moveFigurineIndex>0)):(this.showLeadingFigurine=!1,this.showTrailingFigurine=!1),this.showTrailingFigurine&&(this.coords=this.coords.replace("+",""))},setEnPassantConditions:function setEnPassantConditions(){var t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t=!!this.moveIsEnpassant&&r,this.showEnPassantTooltip!==t&&(this.showEnPassantTooltip=t)}}},He=i("./ui/components/move-list/move-node/move-text.vue?vue&type=style&index=0&lang=scss&module=true&");var Ve=Object(P.a)(Ge,(function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("span",r._g({class:[r.$style.component,(t={},t[r.$style["contains-figurine"]]=r.showLeadingFigurine||r.showTrailingFigurine,t[r.$style.selected]=r.isSelected,t[r.$style["dark-mode"]]=r.isDarkMode,t)]},r.$listeners),[r.showLeadingFigurine?o("icon-font",{class:r.$style.icon,attrs:{name:r.coloredMoveIcon}}):r._e(),r._v("\n\n  "+r._s(r.coords)+"\n\n  "),r.showTrailingFigurine?o("icon-font",{class:r.$style.icon,attrs:{name:r.coloredMoveIcon}}):r._e(),r._v(" "),r.showEnPassantTooltip?o("icon-font",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:r.$trans("En Passant"),position:"top",delay:50},expression:"{ content: $trans('En Passant'), position: 'top', delay: 50 }"}],class:[r.$style.icon,r.$style["en-passant"]],attrs:{name:"circle-question"},on:{click:r.openEnPassantHelpWindow}}):r._e()],1)}),[],!1,(function move_text_injectStyles(t){this.$style=He.default.locals||He.default}),null,null).exports,Ue=i("./node_modules/@babel/runtime/helpers/typeof.js"),ze=i.n(Ue),We=i("./utils/common/debounce.js"),qe={name:"NodeComment",props:{comment:{type:String,required:!0},editable:{type:Boolean,default:!0},node:{type:Object,required:!0},position:{type:String,default:"after"}},emits:["moveList-onCommentChange"],data:function data(){return{isFocused:!1,ignoredKeys:["Backspace","Enter","Meta","Shift","Alt"],showPlaceholder:!this.comment.length}},computed:{shouldShowPlaceholder:function shouldShowPlaceholder(){return 0===this.comment.length&&this.showPlaceholder}},watch:{"node.comment":function watchNodeComment(){!this.isFocused&&this.comment.length&&this.comment!==this.$el.innerHTML.replace(/&nbsp;/g," ")&&this.setCommentText(this.comment)}},beforeDestroy:function beforeDestroy(){this.$el.removeEventListener("paste",this.fixClipboard)},mounted:function mounted(){this.addListeners(),this.showPlaceholder?this.setDefaultCommentText():this.setCommentText(this.comment),this.focus()},methods:{addListeners:function addListeners(){this.$el.addEventListener("paste",this.fixClipboard)},click:function click(){this.setCaretAtBeginningIfEmpty()},fixClipboard:function fixClipboard(t){t.preventDefault();var r=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,r)},focus:function focus(){setTimeout(this.setCaretAtBeginningIfEmpty)},focusIn:function focusIn(){this.isFocused=!0},focusOut:function focusOut(){this.isFocused=!1},keydown:function keydown(t){-1===this.ignoredKeys.indexOf(t.key)&&this.removePlaceholder()},keyup:function keyup(){this.showPlaceholder||this.saveText()},removePlaceholder:function removePlaceholder(){this.showPlaceholder&&(this.showPlaceholder=!1,this.setCommentText(""))},saveText:Object(We.default)((function saveText(){var t=Object(ee.d)(this.$el.innerHTML);this.$emit("moveList-onCommentChange",{node:this.node,actionItem:{action:oe.a.UPDATE_COMMENT,position:this.position,value:t}}),this.showPlaceholder=!t.length,this.showPlaceholder&&setTimeout(this.setDefaultCommentText)}),500),setCaretAtBeginning:function setCaretAtBeginning(){var t=document.createRange(),r=window.getSelection();"object"===ze()(this.$el.childNodes[0])&&(t.setStart(this.$el.childNodes[0],0),t.collapse(!0),r.removeAllRanges(),r.addRange(t)),this.$el.focus()},setCaretAtBeginningIfEmpty:function setCaretAtBeginningIfEmpty(){this.comment.length||this.setCaretAtBeginning()},setCommentText:function setCommentText(t){this.$el.innerHTML=t},setDefaultCommentText:function setDefaultCommentText(){this.setCommentText(this.$trans("Add comment..."))}}},$e=i("./ui/components/move-list/move-node/node-comment.vue?vue&type=style&index=0&lang=scss&module=true&");var Xe=Object(P.a)(qe,(function(){var t,r=this,i=r.$createElement;return(r._self._c||i)("span",{class:[r.$style.component,(t={},t[r.$style.placeholder]=r.shouldShowPlaceholder,t)],attrs:{contenteditable:r.editable},on:{click:r.click,focusout:r.focusOut,focusin:r.focusIn,keydown:function(t){return t.stopPropagation(),r.keydown(t)},keyup:function(t){return t.stopPropagation(),r.keyup(t)}}})}),[],!1,(function node_comment_injectStyles(t){this.$style=$e.default.locals||$e.default}),null,null).exports,Ke={name:"NodeSpace"},Ye=i("./ui/components/move-list/move-node/node-space.vue?vue&type=style&index=0&module=true&lang=css&");function updateComponentClasses(t,r){t!==r&&this.setComponentClasses()}var Ze={name:"MoveNode",components:{MoveText:Ve,NodeComment:Xe,NodeSpace:Object(P.a)(Ke,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("span",{class:t.$style.component},[i("span"),t._v(" "),i("span")])}),[],!1,(function node_space_injectStyles(t){this.$style=Ye.default.locals||Ye.default}),null,null).exports},mixins:[Ne.a],props:{editable:{type:Boolean,default:!0},hasAltLines:{type:Boolean,default:!1},index:{type:Number,required:!0},isContinuation:{type:Boolean,default:!1},isLast:{type:Boolean,required:!0},moveDisplayType:{type:String,default:"text"},node:{type:Object,required:!0},onClick:{type:Function,required:!0},onCommentChange:{type:Function,required:!0},onContextMenu:{type:Function,required:!0},startingMoveNumber:{type:Number,default:1},isDarkMode:{type:Boolean,default:!1},moveListNodeLimits:{type:Object}},data:function data(){return{componentClasses:{},isSelected:!1,nodeLimitTypes:{begin:!1,end:!1,focus:!1}}},computed:{showSpaceAfterComment:function showSpaceAfterComment(){return(!this.node.closeParenthesisCount||this.hasAltLines)&&this.node.hasComment},showSpaceBeforeComment:function showSpaceBeforeComment(){return(!this.node.closeParenthesisCount||this.node.hasLines)&&!this.node.isInvisible||this.node.hasComment},numberClasses:function numberClasses(){var t;return[this.$style.number,(t={},a()(t,this.$style.colored,this.node.classification),a()(t,this.$style["main-line"],0===this.node.ids.line),t)]},moveClasses:function moveClasses(){var t;return[this.$style.colorable,(t={},a()(t,"analysis-".concat(this.node.classification),this.node.classification),a()(t,this.$style.colored,this.node.classification),a()(t,this.$style["main-line"],0===this.node.ids.line),t)]}},watch:{isDarkMode:updateComponentClasses,isSelected:updateComponentClasses,"node.indentation":updateComponentClasses,moveListNodeLimits:{handler:function updateNodeLimits(){var t=this;Object.keys(this.moveListNodeLimits).forEach((function(r){var i=Object(ee.s)(t.moveListNodeLimits,t.node,r);t.nodeLimitTypes[r]!==i&&(t.nodeLimitTypes[r]=i)}))},deep:!0}},created:function created(){this.setComponentClasses()},methods:{moveNumber:function moveNumber(t){return Object(ee.e)(t,this.startingMoveNumber)},setComponentClasses:function setComponentClasses(){var t;this.componentClasses=(t={},a()(t,this.$style.component,!0),a()(t,this.$style.darkMode,this.isDarkMode),a()(t,this.$style.highlighted,this.isSelected),t)}}},Qe=i("./ui/components/move-list/move-node/move-node.vue?vue&type=style&index=0&lang=scss&module=true&");var Je=Object(P.a)(Ze,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("span",{class:t.componentClasses},[t.node.openParenthesis?i("span",[t._v("(")]):t._e(),i("span",{class:t.$style.clickable,on:{click:function(r){return t.onClick(t.node.ids)},contextmenu:function(r){return r.preventDefault(),t.onContextMenu(t.node,t.node.ids.line>0)}}},[t.node.isInvisible&&t.node.closeParenthesisCount?i("span",[t._v("  ")]):t._e(),!t.node.isInvisible&&t.nodeLimitTypes.begin?i("span",[t._v("[[")]):t._e(),t.node.hasCommentBefore?i("node-comment",{attrs:{comment:t.node.commentBefore,editable:t.editable,node:t.node,position:"before"},on:{"moveList-onCommentChange":t.onCommentChange}}):t._e(),t.node.hasCommentBefore?i("node-space"):t._e(),t.node.isInvisible?t._e():i("span",{class:[t.numberClasses,t.themeClasses],domProps:{innerHTML:t._s(t.moveNumber(t.node))}}),i("span",{class:[t.moveClasses,t.themeClasses]},[i("move-text",{directives:[{name:"show",rawName:"v-show",value:!t.node.isInvisible,expression:"!node.isInvisible"}],ref:"moveText",class:[t.$style["move-text"],t.themeClasses],style:{"font-style":t.nodeLimitTypes.focus?"italic":""},attrs:{"is-dark-mode":t.isDarkMode,"move-display-type":t.moveDisplayType,"move-coords":t.node.coords,"move-icon":t.node.iconName,"move-is-enpassant":t.node.isEnPassant,"move-figurine-index":t.node.figurineIndex,"move-text":t.node.san,"show-annotations":!0}}),t.node.isInvisible?t._e():i("span",{domProps:{innerHTML:t._s(t.node.annotationString)}})],1)],1),t.showSpaceBeforeComment?i("node-space"):t._e(),t.node.hasComment?i("node-comment",{attrs:{comment:t.node.comment,editable:t.editable,node:t.node},on:{"moveList-onCommentChange":t.onCommentChange}}):t._e(),t.showSpaceAfterComment?i("node-space"):t._e(),t._l(t.node.closeParenthesisCount,(function(r,o){return i("span",{key:o},[t._v(")")])})),t.node.closeParenthesisCount?i("node-space"):t._e(),!t.node.isInvisible&&t.nodeLimitTypes.end?i("span",[t._v("]]")]):t._e()],2)}),[],!1,(function move_node_injectStyles(t){this.$style=Qe.default.locals||Qe.default}),null,null).exports,et=i("./utils/directives/confirm-popover.js"),tt={props:{clearAnalysisOnConfirm:Boolean,game:Object,isChildNode:Boolean,isDarkMode:Boolean,isDiagram:Boolean,mainLineIsImmutable:Boolean,moveNode:Object,nodeLimit:Object},emits:["onAction","closeMenu"],data:function data(){return{moveList:Pe.default.state,notationRows:oe.h}},computed:{commands:function commands(){var commands=[],t=de.a.findNode(this.moveList.lines,this.moveNode.ids,-1);if(Object(ee.j)(this.moveNode)||!de.a.isFirstNodeInLine(this.moveList.lines,this.moveNode.ids)&&Object(ee.i)(t)?commands.push(oe.c.DELETE_COMMENT_BEFORE):commands.push(oe.c.INSERT_COMMENT_BEFORE),Object(ee.i)(this.moveNode)?commands.push(oe.c.DELETE_COMMENT_AFTER):commands.push(oe.c.INSERT_COMMENT_AFTER),Object(ee.h)(this.moveNode)&&commands.push(oe.c.REMOVE_ANNOTATION),Object(ee.g)(this.moveNode)&&commands.push(oe.c.REMOVE_EVAL_ANNOTATION),Object(ee.r)(this.moveNode)||commands.push(oe.c.DELETE_LINE),Object(ee.c)(this.moveNode,this.mainLineIsImmutable)&&commands.push(oe.c.DELETE_MOVE),this.isChildNode){var r=de.a.getParentNode(this.moveList.lines,this.moveNode.ids),i=r.lines.length>1;this.mainLineIsImmutable&&de.a.isMainLine(r.ids.line)||commands.push(oe.c.PROMOTE_VARIATION),i&&!Object(ee.p)(this.moveNode,r)&&commands.push(oe.c.MOVE_VARIATION_UP),i&&!Object(ee.q)(this.moveNode,r)&&commands.push(oe.c.MOVE_VARIATION_DOWN)}if(Object(ee.n)(this.moveNode,this.moveList)&&(commands.push(oe.c.CREATE_VARIATION),commands.push(oe.c.CREATE_CONTINUATION)),this.isDiagram&&!this.moveNode.indentation){var o=Object(ee.s)(this.nodeLimit,this.moveNode,oe.g.BEGIN),a=Object(ee.s)(this.nodeLimit,this.moveNode,oe.g.END),l=Object(ee.s)(this.nodeLimit,this.moveNode,oe.g.FOCUS),h=Object(ee.t)(this.nodeLimit,this.moveNode),g=Object(ee.u)(this.nodeLimit,this.moveNode);a||h||(o?commands.push(oe.c.REMOVE_BEGIN):commands.push(oe.c.SET_BEGIN)),h||g||(l?commands.push(oe.c.REMOVE_FOCUS):commands.push(oe.c.SET_FOCUS)),o||g||(a?commands.push(oe.c.REMOVE_END):commands.push(oe.c.SET_END))}return commands.push(oe.c.CLEAR_ALL_ANALYSIS),commands},componentClasses:function componentClasses(){var t;return t={},a()(t,this.$style.component,!0),a()(t,this.$style.darkMode,this.isDarkMode),t}},mounted:function mounted(){document.addEventListener("mousedown",this.documentClick)},beforeDestroy:function beforeDestroy(){document.removeEventListener("mousedown",this.documentClick)},methods:{documentClick:function documentClick(t){t.target===this.$el||this.$el.contains(t.target)||this.$emit("closeMenu")},onAction:function onAction(t){t.action===oe.a.CLEAR_ANALYSIS&&this.clearAnalysisOnConfirm?Object(et.a)({message:this.$trans("Are you sure that you want to clear all analysis?"),onConfirm:je.a.emit(oe.e.CLEAR_ANALYSIS,t)}):this.$emit("onAction",t)}}},nt=i("./ui/components/move-list/move-node-context-menu.vue?vue&type=style&index=0&lang=scss&module=true&");var rt={components:{MoveNode:Je,MoveNodeContextMenu:Object(P.a)(tt,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("ul",{class:t.componentClasses},[t._l(t.commands,(function(r,o){var a;return i("li",{key:"command-"+o,class:[t.$style.big,t.$style.item,(a={},a[t.$style.last]=o===t.commands.length-1,a)],domProps:{textContent:t._s(r.name)},on:{click:function(i){return t.onAction(r)}}})})),t._v(" "),t._l(t.notationRows,(function(r,o){return i("li",{key:"notation-"+o,class:t.$style.small},t._l(r,(function(r,a){return i("span",{key:o+"-"+a,class:t.$style.item,attrs:{title:r.meaning},domProps:{innerHTML:t._s(r.display||r.code)},on:{click:function(i){return t.onAction(r)}}})})),0)}))],2)}),[],!1,(function move_node_context_menu_injectStyles(t){this.$style=nt.default.locals||nt.default}),null,null).exports},mixins:[{props:{enabled:{type:Boolean,default:!0},game:{type:Object,required:!0},moveDisplayType:{type:String,default:"text"},showLegalMoves:{type:Boolean,default:!1}},data:function data(){return{cachedHistoryLength:0,moveList:[],startingMoveNumber:1}},methods:{goToNode:function goToNode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{line:0,move:0};this.enabled&&this.$emit("moveList-goToNode",t)},updateScrollPosition:function updateScrollPosition(t,r){Object(Me.c)({moveIds:t,moveList:this,scrollEl:r||this.$el})},getComponentRefByLineMove:function getComponentRefByLineMove(t,r){var i=this.$refs["move-".concat(t,"-").concat(r)];return i?i[0]:void 0}},mounted:function mounted(){this.cachedHistoryLength=this.game.history.length,Object(Me.a)(this.game)||(this.moveList=Pe.default.state),this.fireHistoryEvent({type:ce.a.INIT,payload:{}}),this.updateScrollPosition(this.game.tree.selected)},watch:{"game.id":function watchGameId(){this.fireHistoryEvent({type:ce.a.INIT,payload:{}}),this.fireHistoryEvent({type:ce.a.TREE_CHANGE,payload:{}})},"game.history.length":{handler:function handler(t){if(t<this.cachedHistoryLength)return this.fireHistoryEvent({type:ce.a.INIT,payload:{}}),void(this.cachedHistoryLength=t);var r=t-this.cachedHistoryLength;this.game.history.slice(-r).forEach(this.fireHistoryEvent),this.cachedHistoryLength=t}},"game.tree.selected":function watchSelected(t,r){this.nodeSelectedFromContextMenu?this.nodeSelectedFromContextMenu=!1:t.line===r.line&&t.move===r.move||this.updateScrollPosition(t)},showLegalMoves:function updateEnPassantNodes(t,r){t!==r&&this.fireHistoryEvent({type:"TOGGLE_LEGAL_MOVES",payload:{}})}}}],props:{clearAnalysisOnConfirm:Boolean,debounceUpdatesMs:{default:0,type:Number},enableGameResult:Boolean,initialNodeLimit:{type:Object,default:function _default(){return Object(ie.a)()}},isDarkMode:{type:Boolean,default:!1},isDiagram:{type:Boolean,required:!1},lightMode:{type:Boolean},onCommentChange:{type:Function,default:function _default(){}},showMoveNodeContextMenu:{type:Boolean,default:!0}},emits:["moveList-contextMenuAction","nodeLimit","moveList-saveComment"],data:function data(){return{cachedHistoryLength:0,contextMenuIsChildNode:!1,contextMenuNode:null,contextMenuStyleObj:{left:0,top:0},isContextMenuVisible:!1,lines:[],nodeLimit:Object(ie.a)(),nodeSelectedFromContextMenu:!1}},watch:{initialNodeLimit:"copyNodeLimit",debounceUpdatesMs:{handler:function handler(t){t>0&&(this.debouncedHandleHistoryEvent=Object(We.default)(handleHistoryEvent,t))},immediate:!0}},created:function created(){this.copyNodeLimit()},mounted:function mounted(){var t=this;this.clearAnalysisOnConfirm&&je.a.on(oe.e.CLEAR_ANALYSIS,(function(r){t.onContextMenuAction(r)})),document.addEventListener("scroll",this.closeContextMenu)},beforeDestroy:function beforeDestroy(){document.removeEventListener("scroll",this.closeContextMenu)},methods:{fireHistoryEvent:function fireHistoryEvent(t){this.debounceUpdatesMs>0?this.debouncedHandleHistoryEvent(this,t,Re):handleHistoryEvent(this,t,Re)},closeContextMenu:function closeContextMenu(){this.isContextMenuVisible=!1,this.contextMenuNode=null,this.contextMenuIsChildNode=!1},copyNodeLimit:function copyNodeLimit(){this.nodeLimit={begin:Object.assign({},this.initialNodeLimit.begin),end:Object.assign({},this.initialNodeLimit.end),focus:Object.assign({},this.initialNodeLimit.focus)}},getClasses:function getClasses(t,r){var i=this.lines[r+1],o=t&&(!i||!i.isChild);return[this.$style.line,a()({},this.$style.alternate,t),a()({},this.$style.main,!t),a()({},this.$style["last-child"],o),a()({},this.$style["dark-mode"],this.isDarkMode)]},handleDiagramSpecificActions:function handleDiagramSpecificActions(t){Object.prototype.hasOwnProperty.call(oe.f.SET,t)?this.nodeLimit[oe.f.SET[t]]=this.contextMenuNode:Object.prototype.hasOwnProperty.call(oe.f.REMOVE,t)&&(this.nodeLimit[oe.f.REMOVE[t]]={})},onContextMenuAction:function onContextMenuAction(t){var r=this;oe.d.includes(t.action)?(this.handleDiagramSpecificActions(t.action),this.$emit("nodeLimit",this.nodeLimit)):this.$emit("moveList-contextMenuAction",{node:this.contextMenuNode,actionItem:t}),this.closeContextMenu(),this.$nextTick((function(){r.updateScrollPosition(r.game.tree.selected)}))},openContextMenu:function openContextMenu(t,r){var i=this;this.showMoveNodeContextMenu&&(this.isContextMenuVisible=!0,this.contextMenuNode=t,this.contextMenuIsChildNode=r,this.nodeSelectedFromContextMenu=!0,this.goToNode(this.contextMenuNode.ids),this.$nextTick((function(){var r=function getMenuPosition(t,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{left:0,top:0},a={left:0,top:0},l=window.innerHeight-r.height-o.top,h=15;return a.top=i.top+o.top,a.bottom=a.top+r.height,a.left=i.left,t.left+t.width<i.left+r.width&&(a.left=t.left+t.width-r.width-h),a.top>l&&(a.top=l),a}(i.$el.getBoundingClientRect(),i.$refs.moveNodeContextMenu.$el.getBoundingClientRect(),i.getComponentRefByLineMove(t.ids.line,t.ids.move).$el.getBoundingClientRect(),{left:10,top:20}),o=r.top,a=r.left,l=r.bottom,h=Object(ae.c)(ie.d.DIAGRAM_EDITOR);h&&(l>h.getBoundingClientRect().bottom&&(i.contextMenuStyleObj.height="270px",i.contextMenuStyleObj.overflowX="scroll"));i.contextMenuStyleObj.top="".concat(o,"px"),i.contextMenuStyleObj.left="".concat(a,"px")})))},showGameResult:function showGameResult(t,r){return this.enableGameResult&&t===r-1&&"*"!==this.game.setup.result}}},it=i("./ui/components/move-list/horizontal-move-list.vue?vue&type=style&index=0&lang=scss&module=true&");function diagram_move_listvue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_move_listvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_move_listvue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_move_listvue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var ot={name:"DiagramMoveList",components:{DiagramVariationPopover:re,HorizontalMoveList:Object(P.a)(rt,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return t.game.settings.rules?i("div",{class:t.$style.component},[i("div",[t._l(t.lines,(function(r,o){return i("div",{key:o,class:t.getClasses(r.isChild,o)},[t._l(r.moves,(function(o,a){return i("move-node",{key:"move-"+o.ids.line+"-"+o.ids.move,ref:"move-"+o.ids.line+"-"+o.ids.move,refInFor:!0,attrs:{editable:t.showMoveNodeContextMenu,"has-alt-lines":r.hasAltLines,index:a,"is-continuation":r.isContinuation,"is-dark-mode":t.isDarkMode,"is-last":a===r.moves.length-1,"light-mode":t.lightMode,"move-display-type":t.moveDisplayType,"move-list-node-limits":t.nodeLimit,node:o,"on-click":t.goToNode,"on-comment-change":t.onCommentChange,"on-context-menu":t.openContextMenu,"starting-move-number":t.startingMoveNumber},on:{"moveList-saveComment":function(r){return t.$emit("moveList-saveComment",r)}}})})),t._v(" "),t.showGameResult(o,t.lines.length)?i("span",{class:t.$style.result,domProps:{textContent:t._s(t.game.setup.result)}}):t._e()],2)})),t._v(" "),t.showMoveNodeContextMenu&&t.isContextMenuVisible?i("move-node-context-menu",{ref:"moveNodeContextMenu",style:t.contextMenuStyleObj,attrs:{"clear-analysis-on-confirm":t.clearAnalysisOnConfirm,game:t.game,"is-child-node":t.contextMenuIsChildNode,"is-dark-mode":t.isDarkMode,"is-diagram":t.isDiagram,"main-line-is-immutable":t.game.settings.mainLineIsImmutable,"move-node":t.contextMenuNode,"node-limit":t.nodeLimit},on:{closeMenu:t.closeContextMenu,onAction:t.onContextMenuAction}}):t._e()],2)]):t._e()}),[],!1,(function horizontal_move_list_injectStyles(t){this.$style=it.default.locals||it.default}),null,null).exports,MoveText:Ve},mixins:[S],data:function data(){return{events:l.f}},computed:diagram_move_listvue_type_script_lang_js_objectSpread(diagram_move_listvue_type_script_lang_js_objectSpread(diagram_move_listvue_type_script_lang_js_objectSpread({},Object(y.mapGetters)("diagramViewer",["getPuzzleButtonText","getPuzzleMoveList","getPuzzleStart","getVariationPopover","isBlackAtBottom","isChessProblem"])),Object(y.mapState)({boardOptions:function boardOptions(t){return t.diagramViewerBoard.boardOptions}})),{},{blackToMove:function blackToMove(){return this.puzzleButtonText===l.j.BLACK_TO_MOVE},buttonTextIsCorrect:function buttonTextIsCorrect(){return this.puzzleButtonText===l.j.CORRECT},buttonTextIsIncorrect:function buttonTextIsIncorrect(){return this.puzzleButtonText===l.j.INCORRECT},buttonTextIsSolved:function buttonTextIsSolved(){return this.puzzleButtonText===l.j.SOLVED},nextMoveIndex:function nextMoveIndex(){var t=this.currentGame.setup,nextMoveIndex=0;return t.beginNode&&(nextMoveIndex=t.beginNode),t.focusNode&&(nextMoveIndex=t.focusNode),nextMoveIndex},isPuzzle:function isPuzzle(){return this.isChessProblem(this.gameId)},isSmallMobile:function isSmallMobile(){return g.e&&window.innerHeight<l.b.BIG_SCREEN_HEIGHT},moveList:function moveList(){var t=[];return Array.from(this.$refs.moveList.lines).forEach((function(r){0===r.id&&(t=t.concat(r.moves))})),t},puzzleButtonText:function puzzleButtonText(){return this.getPuzzleButtonText(this.gameId)},puzzleMoveList:function puzzleMoveList(){return this.getPuzzleMoveList(this.gameId)},puzzleStart:function puzzleStart(){return this.getPuzzleStart(this.gameId)},selectedNode:function selectedNode(){return selected_node_selectedNode(this.currentGame.game,this.$refs.moveList)},showVariationPopover:function showVariationPopover(){return this.getVariationPopover(this.gameId)},startingMoveNumber:function startingMoveNumber(){return this.$refs.moveList.startingMoveNumber},whiteToMove:function whiteToMove(){return this.puzzleButtonText===l.j.WHITE_TO_MOVE}}),watch:{"currentGame.game.tree.selectedNode":function watchSelectedMove(t,r){if(void 0!==t&&this.isPuzzle&&this.puzzleStart){var i=moveIsValid(this.currentGame.game,t,r),o=this.moveList.find((function(r){return r.move===t.move})),a={move:null};if(this.puzzleMoveList.length>0){var l=this.puzzleMoveList.length-1;a=this.puzzleMoveList[l]}i&&a.move!==o.move&&this.pushMoveOnPuzzleMoveList({id:this.gameId,move:o})}}},mounted:function mounted(){var t=this,r=this.gameId,i=this.$refs.moveList;if(i.$el.addEventListener("scroll",(function(){return t.hideVariationPopover(r)})),this.isChessProblem(r)){var o=i.lines.filter((function(t){return!1===t.isChild})).reduce((function(t,r){return t.concat(r.moves)}),[])[this.nextMoveIndex];o&&o.isWhite||(this.changePuzzleButtonText({id:r,text:l.j.BLACK_TO_MOVE}),this.setFirstMoveIsWhite({id:r,type:!1}),this.isBlackAtBottom(r)||this.setBlackAtBottom(r))}},beforeDestroy:function beforeDestroy(){var t=this.$refs.moveList,r=this.gameId;t.$el.removeEventListener("scroll",this.hideVariationPopover(r))},methods:diagram_move_listvue_type_script_lang_js_objectSpread(diagram_move_listvue_type_script_lang_js_objectSpread(diagram_move_listvue_type_script_lang_js_objectSpread({},Object(y.mapActions)("diagramViewer",["goToNode"])),Object(y.mapMutations)("diagramViewer",["changePuzzleButtonText","hideVariationPopover","pushMoveOnPuzzleMoveList","setBlackAtBottom","setFirstMoveIsWhite"])),{},{changeSelectedNode:function changeSelectedNode(t){var r=diagram_move_listvue_type_script_lang_js_objectSpread(diagram_move_listvue_type_script_lang_js_objectSpread({},this.currentGame),{},{id:this.gameId,ids:t});this.goToNode(r)},moveNumber:function moveNumber(t){return Object(ee.e)(t,this.startingMoveNumber)}})},at=i("./web/core/widgets/diagram-viewer/diagram-move-list.vue?vue&type=style&index=0&lang=scss&module=true&");var st=Object(P.a)(ot,(function(){var t,r=this,i=r.$createElement,o=r._self._c||i;return o("div",{class:[r.$style.component,(t={},t[r.$style["small-screen"]]=r.isSmallMobile,t)]},[o("horizontal-move-list",{ref:"moveList",class:r.$style.list,attrs:{"light-mode":"","enable-game-result":!0,game:r.currentGame.game,"move-display-type":r.boardOptions.moveListDisplayType,"show-move-node-context-menu":!1},on:{"moveList-goToNode":r.changeSelectedNode}}),r._v(" "),r.isPuzzle?o("div",{class:[r.$style["puzzle-container"],{"diagram-move-list-puzzle-full-size":r.puzzleStart}]},[r.puzzleStart?o("div",{class:r.$style["puzzle-move-list"]},r._l(r.puzzleMoveList,(function(t){return o("span",{key:t.move,class:r.$style["puzzle-node"]},[t.isInvisible?r._e():o("span",{domProps:{innerHTML:r._s(r.moveNumber(t))}}),r._v(" "),o("move-text",{directives:[{name:"show",rawName:"v-show",value:!t.isInvisible,expression:"!move.isInvisible"}],class:r.$style["puzzle-move"],attrs:{"move-coords":t.coords,"move-display-type":r.boardOptions.moveListDisplayType,"move-figurine-index":t.figurineIndex,"move-icon":t.iconName,"move-is-enpassant":t.isEnPassant,"move-text":t.san,"show-annotations":!0}}),r._v(" "),o("span",{class:r.$style["puzzle-node-space"]})],1)})),0):r._e(),r._v(" "),o("div",{class:[r.$style["puzzle-progress"],{"black-to-move":r.blackToMove},{solved:r.buttonTextIsSolved||r.buttonTextIsCorrect},{"white-to-move":r.whiteToMove},{failure:r.buttonTextIsIncorrect}],domProps:{textContent:r._s(r.$trans(r.puzzleButtonText))}})]):r._e(),r._v(" "),r.showVariationPopover?o("diagram-variation-popover",{ref:"moveNodeVariationPopover",attrs:{"game-id":r.gameId,"selected-node":r.selectedNode},on:{"focus-on-widget":function(t){return r.$emit(r.events.FOCUS_ON_WIDGET)}}}):r._e()],1)}),[],!1,(function diagram_move_list_injectStyles(t){this.$style=at.default.locals||at.default}),null,null).exports,ct={name:"DiagramHeader",mixins:[S],data:function data(){return{translations:l.n}},computed:{tags:function tags(){return this.setup.tags},showHeader:function showHeader(){var t=[l.m.WHITE,l.m.BLACK],r=[l.m.SITE,l.m.ROUND,l.m.DATE,l.m.ECO,l.m.RESULT],i=Object(Te.f)(this.tags,t),o=Object(Te.f)(this.tags,r);return i||o}},methods:{rating:function rating(t){if(!t)return"";var r=t.replace(/[^\d]/g,"");return r?"(".concat(r,")"):""}}},lt=i("./web/core/widgets/diagram-viewer/diagram-header.vue?vue&type=style&index=0&lang=scss&module=true&");var ut=Object(P.a)(ct,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return t.showHeader?i("div",{class:t.$style.component},[t.tags.white||t.tags.black?i("div",{class:t.$style.title},[t.tags.white?[t._v("\n      "+t._s(t.tags.white)+" "+t._s(t.rating(t.tags.whiteElo))+"\n    ")]:t._e(),t._v(" "),t.tags.white?t._e():void 0,t._v(" "),i("span",{class:t.$style.versus},[t._v(" "+t._s(t.$trans("vs."))+" ")]),t._v(" "),t.tags.black?[t._v("\n      "+t._s(t.tags.black)+" "+t._s(t.rating(t.tags.blackElo))+"\n    ")]:t._e(),t._v(" "),t.tags.black?t._e():void 0],2):t._e(),t._v(" "),i("div",{class:t.$style.info},[t.tags.result?i("span",{domProps:{textContent:t._s(t.tags.result)}}):t._e(),t._v(" "),t.tags.event||t.tags.site||t.tags.date?i("span",{class:t.$style.separator},[t.tags.event?i("span",{domProps:{textContent:t._s(t.tags.event)}}):t._e(),t._v(" "),t.tags.site?i("span",{domProps:{textContent:t._s(t.tags.site)}}):t._e(),t._v(" "),t.tags.date?i("span",{domProps:{textContent:t._s(t.tags.date)}}):t._e()]):t._e(),t._v(" "),t.tags.opening?i("span",[t._v("\n      "+t._s(t.$trans("Opening"))+": "+t._s(t.tags.opening)+"\n    ")]):t._e(),t._v(" "),t.tags.round?i("span",[t._v("\n      "+t._s(t.$trans("Round"))+": "+t._s(t.tags.round)+"\n    ")]):t._e(),t._v(" "),t.tags.eco?i("span",[t._v("\n      ECO: "+t._s(t.tags.eco)+"\n    ")]):t._e()])]):t._e()}),[],!1,(function diagram_header_injectStyles(t){this.$style=lt.default.locals||lt.default}),null,null).exports,dt=i("./web/core/api/modals/config.js"),ht=function replaceSpace(t,r){return t?t.replace(/,/g,"").replace(/\s+/g,r):""},pt=i("./web/core/api/navigation/bus.js");function diagram_share_modalvue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_share_modalvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_share_modalvue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_share_modalvue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var ft={name:"DiagramShareModal",components:{ShareMenu:i("./ui/components/board/share-menu/share-menu.vue").a},mixins:[S],computed:diagram_share_modalvue_type_script_lang_js_objectSpread(diagram_share_modalvue_type_script_lang_js_objectSpread(diagram_share_modalvue_type_script_lang_js_objectSpread({},Object(y.mapGetters)({getShareModal:"diagramViewer/getShareModal",isChessProblem:"diagramViewer/isChessProblem",loggedIn:"user/isLoggedIn"})),Object(y.mapState)({boardSettings:function boardSettings(t){return t.diagramViewerBoard.settings}})),{},{tcn:function tcn(){return O.a.getTcn(this.currentGame.game)},additionalOptions:function additionalOptions(){var t;return{games:this.games,initialPosition:null===(t=this.currentGame.game.tree.lines[0][0])||void 0===t?void 0:t.beforeFen,isPuzzle:this.isChessProblem(this.gameId),parentViewerId:h(this.gameId)}},pgnHeaders:function pgnHeaders(){return{Black:ht(this.currentGame.setup.tags.black,"-").toLowerCase(),Date:ht(this.currentGame.setup.tags.date,"-").toLowerCase(),FEN:this.currentGame.game.setup.fen,White:ht(this.currentGame.setup.tags.white,"-").toLowerCase()}},shareUrl:function shareUrl(){return window.location.href},showModal:function showModal(){return this.getShareModal(this.gameId)}}),watch:{showModal:function showModal(){this.showModal&&(this.$refs.shareMenu.selectTab("image"),this.$refs.shareMenu.show())}},mounted:function mounted(){var t=this;pt.a.on(dt.b.HIDE_MODAL,(function(){t.hideShareModal(t.gameId)}))},methods:diagram_share_modalvue_type_script_lang_js_objectSpread(diagram_share_modalvue_type_script_lang_js_objectSpread({},Object(y.mapMutations)("diagramViewer",["hideShareModal"])),{},{hide:function hide(){this.hideShareModal(this.gameId)}})},mt=i("./web/core/widgets/diagram-viewer/diagram-share-modal.vue?vue&type=style&index=0&lang=scss&module=true&");function diagram_viewervue_type_script_lang_js_ownKeys(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),i.push.apply(i,o)}return i}function diagram_viewervue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?diagram_viewervue_type_script_lang_js_ownKeys(Object(i),!0).forEach((function(r){a()(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):diagram_viewervue_type_script_lang_js_ownKeys(Object(i)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))}))}return t}var gt={name:"DiagramViewer",components:{DiagramAnalysis:C,DiagramBoard:N,DiagramButtonBar:W,DiagramGameList:J,DiagramMoveList:st,DiagramHeader:ut,DiagramShareModal:Object(P.a)(ft,(function(){var t=this,r=t.$createElement;return(t._self._c||r)("share-menu",{ref:"shareMenu",attrs:{"board-options":t.currentGame.boardOptions,"board-settings":t.boardSettings,"is-logged-in":t.loggedIn,"initial-diagram-options":t.additionalOptions,"pgn-headers":t.pgnHeaders,tcn:t.tcn,fen:t.currentGame.game.setup.fen,pgn:t.currentGame.setup.pgnBody,variant:t.currentGame.game.variant,"share-url":t.shareUrl},on:{hide:t.hide}})}),[],!1,(function diagram_share_modal_injectStyles(t){this.$style=mt.default.locals||mt.default}),null,null).exports},props:{id:{type:String,required:!0},data:{type:String,required:!0},type:{type:String,required:!0}},data:function data(){return{setup:(t=this.data,r="&-diagramtype:",i=t.split(r),1===(i=(i=i.slice(1)).map((function(t){return parseGameSetup("".concat(r).concat(t))}))).length?i:i.filter((function(t){return Object(_.a)(t.diagramType)}))),shortDiagramId:h(this.id)};var t,r,i},computed:diagram_viewervue_type_script_lang_js_objectSpread(diagram_viewervue_type_script_lang_js_objectSpread({},Object(y.mapGetters)("diagramViewer",["getGameById","getPuzzleStart","getViewerById","isChessGame","isChessProblem","isSimpleDiagram","getVariationPopover"])),{},{currentGame:function currentGame(){return this.getGameById(this.id)},games:function games(){return this.getViewerById(this.id).games},isVariation:function isVariation(){return 0!==this.currentGame.game.tree.selected.line},multiPgnViewer:function multiPgnViewer(){return this.games.length>1},puzzleStart:function puzzleStart(){return this.isChessProblem(this.id)&&this.getPuzzleStart(this.id)},simpleDiagram:function simpleDiagram(){return this.isSimpleDiagram(this.id)}}),created:function created(){this.init({id:this.id,setup:this.setup})},methods:diagram_viewervue_type_script_lang_js_objectSpread(diagram_viewervue_type_script_lang_js_objectSpread(diagram_viewervue_type_script_lang_js_objectSpread({},Object(y.mapActions)("diagramViewer",["init","setVariations"])),Object(y.mapMutations)("diagramViewer",["clearVariationParentNode","flipBoard","moveBackward","moveForward","moveToEnd","moveToStart","selectNode","setVariationParentNode","showVariationPopover"])),{},{blur:function blur(){window.postMessage(l.f.DIAGRAM_VIEWER_BLUR,window.location.origin)},focus:function focus(){window.postMessage(l.f.DIAGRAM_VIEWER_FOCUS,window.location.origin)},focusOnWidget:function focusOnWidget(){this.$el.focus()},hasVariations:function hasVariations(){var t=this.currentGame.game.tree;return!!t.selectedNode&&t.lines.some((function(r){return t.selectedNode.fen===r[0].beforeFen}))},onKeyDown:function onKeyDown(t){if(!this.getViewerById(this.id).shareModal&&!this.getVariationPopover(this.id)){t.preventDefault();var r=this.currentGame.game,i=this.id,o=this.$refs.moveList.$refs.moveList.lines,a=r.tree.selected.line,h=r.tree.selected.move+1,y=r.tree.selected.move-1,_=r.tree.lines[a].length-1;if((this.isChessGame(i)||!this.puzzleStart)&&!this.isSimpleDiagram(i))switch(t.keyCode){case l.h.LEFT:this.isVariation&&y<0?this.selectParentMove(l.e.BACKWARD):this.moveBackward({game:r,id:i});break;case l.h.UP:this.isVariation?this.selectParentMove(l.e.BACKWARD):this.moveToStart({game:r,id:i});break;case l.h.RIGHT:this.hasVariations()&&!Object(g.e)()&&window.innerWidth>l.b.DESKTOP_WIDTH&&this.selectedNodeIsVisible()?(this.setVariations({id:i,game:r,lines:o}),this.showVariationPopover(i)):h>_&&this.isVariation?this.selectParentMove():this.moveForward({game:r,id:i});break;case l.h.DOWN:this.isVariation?this.selectParentMove():this.moveToEnd({game:r,id:i});break;case l.h.X:this.flipBoard(i)}}},selectParentMove:function selectParentMove(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.e.FORWARD,r=this.currentGame.game,i=this.id,o=r.tree.selected.line,a=r.tree.lines[o].length-1,h=this.currentGame.setup;this.setVariationParentNode({id:i,game:r});var g={line:o,move:t===l.e.FORWARD?a:0};if(r.tree.selected.move===g.move){var y=h.variationParentNode.ids;if(g.line=y.line,t===l.e.FORWARD){var _=r.tree.lines[y.line];g.move=y.move+1>_.length-1?y.move:y.move+1}else g.move=y.move}this.selectNode({game:r,id:i,ids:g}),this.clearVariationParentNode(i)},selectedNodeIsVisible:function selectedNodeIsVisible(){var t=this.currentGame.game,r=this.$refs.moveList.$refs.moveList,i=r.$el.getBoundingClientRect().top,o=selected_node_selectedNode(t,r)?selected_node_selectedNode(t,r).$el.getBoundingClientRect().top:void 0;return!o||i<o}})},vt=i("./web/core/widgets/diagram-viewer/diagram-viewer.vue?vue&type=style&index=0&lang=scss&module=true&");var yt=Object(P.a)(gt,(function(){var t=this,r=t.$createElement,i=t._self._c||r;return i("div",{class:t.$style.component,attrs:{id:t.shortDiagramId,tabindex:"-1"},on:{blur:t.blur,focus:t.focus,keydown:t.onKeyDown}},[i("div",{class:[t.$style.body,{"diagram-viewer-full-width":!t.simpleDiagram}]},[i("diagram-header",{attrs:{"game-id":t.id}}),t._v(" "),i("diagram-analysis",{attrs:{"game-id":t.id}}),t._v(" "),i("diagram-board",{attrs:{"game-id":t.id,type:t.type},on:{"wrapper-click":t.focusOnWidget}}),t._v(" "),i("diagram-button-bar",{attrs:{"game-id":t.id}}),t._v(" "),t.simpleDiagram?t._e():i("diagram-move-list",{ref:"moveList",attrs:{"game-id":t.id},on:{"focus-on-widget":t.focusOnWidget}}),t._v(" "),t.multiPgnViewer?i("diagram-game-list",{attrs:{"game-id":t.id}}):t._e(),t._v(" "),i("diagram-share-modal",{attrs:{"game-id":t.id}})],1)])}),[],!1,(function diagram_viewer_injectStyles(t){this.$style=vt.default.locals||vt.default}),null,null);r.a=yt.exports},"./web/core/widgets/diagram-viewer/diagram-viewer.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/diagram-viewer/diagram-viewer.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/diagram-viewer/index.js":function(t,r,i){"use strict";i.r(r);var o=i("./web/core/widgets/diagram-viewer/create-diagram-viewer.js"),a=i("./utils/dom/index.js"),l=i("./web/core/api/diagram-viewer/config.js"),h=i("./web/core/store/helper.js"),g=i("./web/core/store/modules/board/index.js"),y=i("./web/core/store/modules/diagram-viewer/index.js"),_=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),x=i.n(_),w=i("./web/core/api/diagram-viewer/helpers/get-diagram-id.js"),S=i("./web/core/api/diagram-viewer/helpers/get-diagram-setup.js"),M=i("./web/core/api/diagram-viewer/helpers/get-diagram-type.js"),T=i("./utils/lazy-vue/index.js"),P=i("./web/core/widgets/diagram-viewer/diagram-viewer.vue"),C=i("./web/core/store/index.js"),diagram_observer=function(t){var r=Object(a.a)(t),i=new IntersectionObserver((function(r){r.forEach((function(r){if(r.isIntersecting){var o=r.target;Object(T.a)(x()({},o.id,{component:P.a,el:"#".concat(o.id),propsData:{data:Object(S.a)(o),id:Object(w.a)(o),type:Object(M.a)(t)},store:C.default})).createInstance(o.id),i.unobserve(o)}}))}),{rootMargin:"100px 0px",threshold:.01});r.forEach((function(t){t.getAttribute(l.b.DIAGRAM_OBSERVED)||(i.observe(t),t.setAttribute(l.b.DIAGRAM_OBSERVED,1))}))};Object(h.a)({diagramViewerBoard:g.a,diagramViewer:y.a}),C.default.dispatch("diagramViewerBoard/loadOptions");window.chesscom=window.chesscom||{},window.chesscom.loadDiagramViewer||(window.chesscom.loadDiagramViewer=function(){var t=Object(a.d)(l.k.CHESS_DIAGRAM),r=Object(a.d)(l.k.CHESS_DAILY_PUZZLE);t.length>0&&(window.IntersectionObserver?diagram_observer(".".concat(l.k.CHESS_DIAGRAM)):Object(o.a)(".".concat(l.k.CHESS_DIAGRAM))),r.length>0&&(window.IntersectionObserver?diagram_observer(".".concat(l.k.CHESS_DAILY_PUZZLE)):Object(o.a)(".".concat(l.k.CHESS_DAILY_PUZZLE)))}),window.chesscom.loadDiagramViewer()},"./web/core/widgets/modals/confirm-popover-inline.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/modals/confirm-popover-inline.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},"./web/core/widgets/modals/confirm-popover.vue?vue&type=style&index=0&lang=scss&module=true&":function(t,r,i){"use strict";var o=i("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./web/core/widgets/modals/confirm-popover.vue?vue&type=style&index=0&lang=scss&module=true&"),a=i.n(o);i.d(r,"default",(function(){return a.a}))},0:function(t,r,i){t.exports=i("./web/core/widgets/diagram-viewer/index.js")},"dll-reference amplitudeDLL":function(t,r){t.exports=amplitudeDLL},"dll-reference vueDLL":function(t,r){t.exports=vueDLL}});