/*! For license information please see board-default.client.cf72c0f0.js.LICENSE.txt */
!function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/bundles/app/js/",__webpack_require__(__webpack_require__.s=14)}({"./chessboard/src/board/board.config.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a}));var r={getOptions:"web_user_callback_get_board_settings",getStyles:"web_themes_data_callback",updateOption:{animationType:"web_user_game_settings_email_callback_animation_type",boardStyle:"web_user_game_settings_email_callback_board_color",coordinates:"web_user_game_settings_email_callback_coordinates",darkMode:"web_user_game_settings_callback_dark_mode_toggle",highlightLegalMoves:"web_user_game_settings_email_callback_show_legal_moves_toggle",highlightMoves:"web_user_game_settings_email_callback_highlight_last_move_toggle",moveListDisplayType:"web_user_game_settings_email_callback_move_list_display_type",pieceStyle:"web_user_game_settings_email_callback_piece",playSounds:"web_user_game_settings_email_callback_sound_toggle",soundTheme:"web_user_game_settings_email_callback_sound_theme",showTimestamps:"web_user_game_settings_email_callback_show_timestamps"}},o=[{key:"0",value:null},{key:"1",value:"inside"},{key:"2",value:"outside"}],a={pieces:["real3d"],animations:["arcade","natural"]}},"./chessboard/src/board/board.helper.js":function(e,t,n){"use strict";var r=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),i=n.n(a),s=n("./node_modules/@babel/runtime/helpers/createClass.js"),c=n.n(s),u=n("./chessboard/src/board/board.config.js"),l=n("./utils/browser.js"),d=function(){function BoardHelper(){i()(this,BoardHelper)}return c()(BoardHelper,null,[{key:"getAnimationType",value:function getAnimationType(e){return"battle"===e?"default":e}},{key:"getAnimationTypes",value:function getAnimationTypes(e,t){if(!Array.isArray(e))return e;var n=o()(e),r=["battle"];return u.c.pieces.indexOf(t)>=0&&(r=r.concat(u.c.animations)),r.forEach((function(e){var t=n.findIndex((function(t){return t.code===e}));t>-1&&n.splice(t,1)})),n}},{key:"getPieceStyles",value:function getPieceStyles(e){if(!Array.isArray(e)||"IE"!==Object(l.b)().name)return e;var t=e.findIndex((function(e){return"real3d"===e.code}));return t>-1&&e.splice(t,1),e}},{key:"getCoordinatePositioning",value:function getCoordinatePositioning(e){var t=u.b.find((function(t){return[t.key,t.value].includes(e)}));return t?t.value:null}},{key:"pieceChangeRequiresRefresh",value:function pieceChangeRequiresRefresh(e,t){var n=e===t,r=u.c.pieces.indexOf(e)>-1||u.c.pieces.indexOf(t)>-1;return!n&&r}},{key:"animationChangeRequiresRefresh",value:function animationChangeRequiresRefresh(e,t){return u.c.animations.indexOf(e)>-1||u.c.animations.indexOf(t)>-1}},{key:"validateSize",value:function validateSize(e,t,n,r){var o=Math.min(e,t);return o=Math.max(o,n),o=(o=Math.floor(o/r)*r)>=n?o:o+r}}]),BoardHelper}();t.a=d},"./chessboard/src/board/board.service.js":function(e,t,n){"use strict";var r=n("./node_modules/axios/index.js"),o=n.n(r),a=n("./utils/dark-mode.ts"),i=n("./utils/router.js"),s=n("./chessboard/src/board/board.config.js"),c=n("./chessboard/src/board/board.helper.js");t.a={getDefaultOptions:function getDefaultOptions(){return{allowMarkings:!0,animationType:"default",autoPromote:!1,boardStyle:"green",captureKeyStrokes:!0,coordinates:"inside",darkMode:a.b,diagramStyle:!0,enabled:!0,highlightColor:"#f8f893",highlightLegalMoves:!1,highlightMoves:!0,highlightOpacity:.5,isWhiteOnBottom:!1,legalPositionCheck:"full",moveMethod:"drag",overlayInAnalysisMode:!0,pieceStyle:"neo",playSounds:!0,premoveHighlightColor:"#f42a32",premoveHighlightOpacity:.5,real3D:!1,rounded:!0,soundTheme:"default",showTimestamps:0}},getOptions:function getOptions(){return o.a.get(i.a.generate(s.a.getOptions)).then((function(e){return e.data})).then((function(e){return{animationType:c.a.getAnimationType(e.animationType),boardSize:e.boardSize,boardStyle:e.colorScheme,darkMode:Object(a.a)(),highlightLegalMoves:Boolean(e.highlightLegalMoves),highlightMoves:"1"===e.highlightMoves,isWhiteOnBottom:Boolean(e.isWhiteOnBottom),moveListDisplayType:e.moveListDisplayType,moveMethod:e.moveMethod,pieceStyle:e.pieceStyle,playSounds:"1"===e.playSounds,soundTheme:e.soundTheme,coordinates:c.a.getCoordinatePositioning(e.boardCoords),showTimestamps:e.showTimestamps}}))},getStyles:function getStyles(){return o.a.get(i.a.generate(s.a.getStyles)).then((function(e){return e.data}))},updateOption:function updateOption(e,t){var n=i.a.generate(s.a.updateOption[e]);return o.a.post(n,{action:t}).then((function(e){return e.data}))}}},"./chessboard/src/components/chessboard/ChessEvents.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/createClass.js"),i=n.n(a),s=n("./core/utils/dom/has-touch.js"),c=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,u=document.documentElement,l="mouseup",d="mousedown",f="mousemove",p="dragstart",m="contextmenu",h="touchend",g="touchstart",b="touchmove",v=function(){function ChessEvents(e){o()(this,ChessEvents),this.chessboard=e}return i()(ChessEvents,[{key:"setFixed",value:function setFixed(e){this.inFixedElement=!!e}},{key:"destroy",value:function destroy(){this.destroyTouch&&(this.destroyTouch(),delete this.destroyTouch),this.destroyMouse&&(this.destroyMouse(),delete this.destroyMouse)}},{key:"observe",value:function observe(e){this.destroy(),s.a&&this.observeTouch(e),this.observeMouse(e)}},{key:"observeTouch",value:function observeTouch(e){var t,n,r,o,a,i=this.chessboard,s=!1,c=function handleMove(c){if(e.keepDefault||(c.returnValue=!1,"function"==typeof c.preventDefault&&c.preventDefault()),c.cancelBubble=!0,"function"==typeof c.stopPropagation&&c.stopPropagation(),c.touches&&c.touches[0]?(o=c.touches[0].pageX,a=c.touches[0].pageY):c.changedTouches&&c.changedTouches[0]&&(o=c.changedTouches[0].pageX,a=c.changedTouches[0].pageY),s)"function"==typeof e.dragmove&&(c.pointer={x:o,y:a,type:"touch",target:r},e.dragmove.call(i,c));else{var u=Math.abs(o-t)>1,l=Math.abs(a-n)>1;(s=u||l)&&"function"==typeof e.dragstart&&(c.pointer={x:t,y:n,type:"touch",target:r},e.dragstart.call(i,c))}},l=function handleEnd(l){e.keepDefault||(l.returnValue=!1,"function"==typeof l.preventDefault&&l.preventDefault()),s?"function"==typeof e.dragstop&&(l.pointer={x:o,y:a,type:"touch",target:r},e.dragstop.call(i,l)):"function"==typeof e.click&&(l.pointer={x:o,y:a,type:"touch",target:r},e.click.call(i,l)),t=void 0,n=void 0,r=void 0,o=void 0,a=void 0,s=!1,u.removeEventListener(b,c),u.removeEventListener(h,handleEnd)},d=function handleStart(s){e.keepDefault||(s.returnValue=!1,"function"==typeof s.preventDefault&&s.preventDefault()),r=s.target,s.touches&&s.touches[0]?(o=s.touches[0].pageX,t=s.touches[0].pageX,a=s.touches[0].pageY,n=s.touches[0].pageY):s.changedTouches&&s.changedTouches[0]&&(o=s.changedTouches[0].pageX,t=s.changedTouches[0].pageX,a=s.changedTouches[0].pageY,n=s.changedTouches[0].pageY),"function"==typeof e.pointerdown&&(s.pointer={x:t,y:n,type:"touch",target:r},e.pointerdown.call(i,s)),u.addEventListener(b,c,!1),u.addEventListener(h,l,!1)},f=function handleCancel(){t=void 0,n=void 0,r=void 0,o=void 0,a=void 0,s=!1,u.removeEventListener(b,c),u.removeEventListener(h,l)};i.addEventListener(g,d,!1),i.addEventListener("touchcancel",f,!1),this.destroyTouch=function(){i.removeEventListener(g,d),i.removeEventListener(g,f)}}},{key:"observeMouse",value:function observeMouse(e){var t,n,r,o=this.chessboard;c&&(o.style.touchAction="none",o.style.msTouchAction="none");var a=!1,i=!1,s=!1,h=!1,g=this.inFixedElement,b=function hasButtonChanged(e){if(e.buttons){if(s&&1===e.buttons)return!0;if(i&&2===e.buttons)return!0}else if(e.button){if(s&&1===e.button)return!0;if(i&&2===e.button)return!0}else if(e.which){if(s&&1===e.which)return!0;if(i&&3===e.which)return!0}return!1},v=function handleDrag(t){e.keepDefault||(t.returnValue=!1,"function"==typeof t.preventDefault&&t.preventDefault()),t.cancelBubble=!0,"function"==typeof t.stopPropagation&&t.stopPropagation()},E=function handleMenu(t){e.keepDefault||(t.returnValue=!1,"function"==typeof t.preventDefault&&t.preventDefault()),t.cancelBubble=!0,"function"==typeof t.stopPropagation&&t.stopPropagation(),"function"==typeof e.contextmenu&&e.contextmenu.call(o,t)},_=function handleMove(c){var u,l;if(e.keepDefault||(c.returnValue=!1,"function"==typeof c.preventDefault&&c.preventDefault()),!h)if(g?(u=c.clientX,l=c.clientY):(u=c.pageX,l=c.pageY),r.parentNode||(r=c.target||c.srcElement),b(c))a&&("function"==typeof e.dragcancel&&(c.pointer={x:u,y:l,type:"mouse",target:r},c.isRightClick=s,e.dragcancel.call(o,c)),a=!1);else if(a)"function"==typeof e.dragmove&&(c.pointer={x:u,y:l,type:"mouse",target:r},c.isRightClick=s,e.dragmove.call(o,c));else if(i||s){var d=Math.abs(u-t)>1,f=Math.abs(l-n)>1;if(a=d||f)if("function"==typeof e.dragstart)c.pointer={x:t,y:n,type:"mouse",target:r},c.isRightClick=s,!1===e.dragstart.call(o,c)&&(h=!0)}},y=function handleUp(c){var d,p;e.keepDefault||(c.returnValue=!1,"function"==typeof c.preventDefault&&c.preventDefault()),g?(d=c.clientX,p=c.clientY):(d=c.pageX,p=c.pageY),r.parentNode||(r=c.target||c.srcElement),b(c)?a&&("function"==typeof e.dragcancel&&(c.pointer={x:d,y:p,type:"mouse",target:r},c.isRightClick=s,e.dragcancel.call(o,c)),a=!1):a?h||"function"==typeof e.dragstop&&(c.pointer={x:d,y:p,type:"mouse",target:r},c.isRightClick=s,e.dragstop.call(o,c)):i?"function"==typeof e.click&&(c.pointer={x:d,y:p,type:"mouse",target:r},c.isRightClick=s,e.click.call(o,c)):s&&"function"==typeof e.rightclick&&(c.pointer={x:d,y:p,type:"mouse",target:r},c.isRightClick=s,e.rightclick.call(o,c)),"function"==typeof e.pointerup&&(c.pointer={x:t,y:n,type:"mouse",target:r},c.isRightClick=s,e.pointerup.call(o,c)),t=void 0,n=void 0,r=void 0,a=!1,i=!1,s=!1,h=!1,u.removeEventListener(f,_),u.removeEventListener(l,handleUp)},O=function handleDown(c){e.keepDefault||(c.returnValue=!1,"function"==typeof c.preventDefault&&c.preventDefault()),c.which?(i=1===c.which,s=3===c.which):c.button?(i=1===c.button,s=2===c.button):c.buttons&&(i=1===c.buttons,s=2===c.buttons),(i||s)&&(a&&("function"==typeof e.dragcancel&&(c.pointer={x:t,y:n,type:"mouse",target:r},c.isRightClick=s,e.dragcancel.call(o,c)),a=!1),r=c.target||c.srcElement,g?(t=c.clientX,n=c.clientY):(t=c.pageX,n=c.pageY),"function"==typeof e.pointerdown&&(c.pointer={x:t,y:n,type:"mouse",target:r},c.isRightClick=s,e.pointerdown.call(o,c)),u.addEventListener(f,_,!1),u.addEventListener(l,y,!1))};o.addEventListener(d,O,!1),o.addEventListener(p,v,!1),o.addEventListener(m,E,!1),this.destroyMouse=function(){o.removeEventListener(d,O),o.removeEventListener(p,v),o.removeEventListener(m,E)}}}]),ChessEvents}()},"./chessboard/src/components/chessboard/ChessSounds/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/createClass.js"),i=n.n(a),s=n("./utils/shared/add-directive-event-listeners.helper.js"),c=window.AudioContext||window.webkitAudioContext,u=Boolean(c);function isSuspended(){return u}function resumeAudio(e){if(c){if(window.chessComAudioContext||(window.chessComAudioContext=function newAudioContext(){try{return new c}catch(e){return null}}()),!window.chessComAudioContext||!window.chessComAudioContext.resume)return u=!1,void e();window.chessComAudioContext.resume().then((function(){u=!1,e()}))}}var l="sound-suspended",d="sound-enabled",f=["webm","ogg","mp3","wav"],p="default",m="//images.chesscomfiles.com/chess-themes/sounds",h=["move-check","premove","capture","castle","game-end","game-start","promote","move-opponent","move-self"],g=h.concat(["click","correct","drawoffer","illegal","incorrect","notify","tenseconds"]),b=n("./utils/window/post-message.ts");function getThemeUrl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p;return"".concat(m,"/_").concat(t.toUpperCase(),"_/").concat(n,"/").concat(e,".").concat(t)}var v=function(){function Sound(e,t){o()(this,Sound),this.code=e,this.theme=t,this.tags=[]}return i()(Sound,[{key:"load",value:function load(){this.unload(),this.addTag()}},{key:"addTag",value:function addTag(){var e=document.createElement("audio");e.setAttribute("preload","auto"),function getUrls(e,t){return h.includes(e)?f.map((function(n){return getThemeUrl(e,n,t)})):g.includes(e)?f.map((function(t){return getThemeUrl(e,t)})):["/bundles/web/sounds/".concat(e,".mp3")]}(this.code,this.theme).forEach((function(t){var n=t.split(".").pop(),r="mp3"===n?"audio/mpeg":"audio/".concat(n),o=document.createElement("source");o.setAttribute("src",t),o.setAttribute("type",r),e.appendChild(o)})),document.body.appendChild(e),e.pause&&e.pause(),this.tags.push(e)}},{key:"unload",value:function unload(){for(;this.tags.length;){var e=this.tags.shift();e.parentNode&&e.parentNode.removeChild(e)}}},{key:"play",value:function play(){var e=this.tags.find((function(e){return e.paused||e.ended}));if(!e){if(this.tags.length>=5)return;return this.addTag(),void this.play()}var t=e.play();t&&t.catch((function(){}))}}]),Sound}(),E=0,_=!1;function enableSound(){isSuspended()&&resumeAudio((function(){E=0,_=!1,Object(b.a)({key:d}),window.$unbindSound&&window.$unbindSound()}))}function whenEnabled(e){window.addEventListener("message",(function listener(t){t&&t.data&&t.data.key===d&&(e(),window.removeEventListener("message",listener))}))}function loadSound(e,t){var n=new v(e,t);return isSuspended()?(!function waitUserInteraction(){window.$unbindSound||Object(s.a)("Sound",window,{mousedown:enableSound,keydown:enableSound,touchstart:enableSound,touchend:enableSound})}(),whenEnabled((function(){return n.load()}))):n.load(),n}function unloadSound(e){e.unload()}var y=["game-start","game-end","capture","castle","premove","move-self","move-check","move-opponent","promote","notify","tenseconds","illegal"],O=function(){function ChessSounds(e,t){o()(this,ChessSounds),this.sounds={},this.load(e,t)}return i()(ChessSounds,[{key:"load",value:function load(e,t){var n=this,r=t;t||(r=y),r.forEach((function(t){n.sounds[t]=loadSound(t,e)}))}},{key:"play",value:function play(e){!function playSound(e){isSuspended()?!_&&E>3?(E=0,_=!0,Object(b.a)({key:l})):_||(E++,enableSound(),whenEnabled((function(){return e.play()}))):e.play()}(this.sounds[e])}},{key:"removeAll",value:function removeAll(){Object.values(this.sounds).forEach(unloadSound),this.sounds={}}}]),ChessSounds}()},"./chessboard/src/components/chessboard/coordinates.vue":function(e,t,n){"use strict";var r=n("./chessboard/src/components/config.js"),o={props:{boardStyle:{type:String,default:r.a.defaultBoardOptions.boardStyle},colors:{type:Object,required:!0},flipped:{type:Boolean,default:!1},position:{type:String,default:null},size:{type:Number,required:!0}},methods:{colorForLetter:function colorForLetter(e){return e%2==0?this.colors.white:this.colors.black},colorForNumber:function colorForNumber(e){return e%2==0?this.colors.black:this.colors.white}},computed:{className:function className(){return"inside"===this.position?"inside-coords chess-color-scheme-".concat(this.boardStyle):""},fontSize:function fontSize(){return"outside"===this.position?"".concat(Math.min(this.size/4.1,20),"px"):"".concat(this.size/4.5,"px")},letters:function letters(){var e=["a","b","c","d","e","f","g","h"];return this.flipped?e.reverse():e},numbers:function numbers(){var e=["1","2","3","4","5","6","7","8"];return this.flipped?e:e.reverse()},outsideNumbersFontWidth:function outsideNumbersFontWidth(){return"".concat(Math.min(this.size/6.15,20),"px")}}},a=(n("./chessboard/src/components/chessboard/coordinates.vue?vue&type=style&index=0&lang=scss&"),n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js")),i=Object(a.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.position?n("div",{staticClass:"coordinates",class:[e.position,e.className]},[e._l(e.numbers,(function(t,r){return n("div",{staticClass:"number",class:[r%2==0?"coords-light":"coords-dark"],style:{color:e.colorForNumber(r),fontSize:e.fontSize,transform:"inside"===e.position?"translate(0, "+100*r+"%)":"translate(-145%, "+100*r+"%)",width:"inside"===e.position?"":e.outsideNumbersFontWidth}},[e._v(e._s(t))])})),e._v(" "),e._l(e.letters,(function(t,r){return n("div",{staticClass:"letter",class:[r%2==0?"coords-dark":"coords-light"],style:{color:e.colorForLetter(r),fontSize:e.fontSize,transform:"inside"===e.position?"translate("+100*r+"%, 0)":"translate("+100*r+"%, 110%)"}},[e._v("\n    "+e._s(t)+"\n  ")])}))],2):e._e()}),[],!1,null,null,null);t.a=i.exports},"./chessboard/src/components/chessboard/coordinates.vue?vue&type=style&index=0&lang=scss&":function(e,t,n){"use strict";n("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/coordinates.vue?vue&type=style&index=0&lang=scss&")},"./chessboard/src/components/chessboard/custom-item.vue?vue&type=style&index=0&lang=scss&":function(e,t,n){"use strict";n("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/custom-item.vue?vue&type=style&index=0&lang=scss&")},"./chessboard/src/components/chessboard/marked-arrow.vue":function(e,t,n){"use strict";var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./chessboard/src/components/config.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var i={props:{additionalStyles:{type:Object,default:function _default(){return{}}},color:{type:String,default:a.a.defaultBoardOptions.arrowColor},files:{type:Number,default:a.a.defaultBoardOptions.files},flipped:{type:Boolean,default:!1},fromFileRank:{type:Object,required:!0},ranks:{type:Number,default:a.a.defaultBoardOptions.ranks},squareSize:{type:Number,required:!0},toFileRank:{type:Object,required:!0}},computed:{arrowStyles:function arrowStyles(){var e=this.transform,t=e.origin,n=e.position,r=e.rotation,o=e.scale;return _objectSpread(_objectSpread({},{transform:"translate(".concat(n.x,"px, ").concat(n.y,"px)\n                    rotate(").concat(r,"deg)\n                    scale(").concat(o.x,", ").concat(o.y,")"),transformOrigin:"".concat(t.x,"% ").concat(t.y,"%")}),this.additionalStyles)},isStraight:function isStraight(){var e=this.fromFileRank,t=this.toFileRank;return e.file===t.file||e.rank===t.rank||Math.abs(e.file-t.file)===Math.abs(e.rank-t.rank)},arrowPoints:function arrowPoints(){return this.isStraight?"\n            ".concat(39," ").concat(87,",\n            ").concat(61," ").concat(87,",\n            ").concat(61," ").concat(113+this.transform.length,",\n            ").concat(76," ").concat(113+this.transform.length,",\n            50 ").concat(150+this.transform.length,",\n            ").concat(24," ").concat(113+this.transform.length,",\n            ").concat(39," ").concat(113+this.transform.length,"\n          "):"\n          ".concat(87," ").concat(39,",\n          ").concat(261," ").concat(39,",\n          ").concat(261," ").concat(113,",\n          ").concat(276," ").concat(113,",\n          ",250," ").concat(150,",\n          ").concat(224," ").concat(113,",\n          ").concat(239," ").concat(113,",\n          ").concat(239," ").concat(61,",\n          ").concat(87," ").concat(61,"\n        ")},transform:function transform(){var e=this.files,t=this.ranks,n=this.squareSize,r=this.fromFileRank,o=this.toFileRank;this.flipped&&(r={file:e+1-r.file,rank:t+1-r.rank},o={file:e+1-o.file,rank:t+1-o.rank});var transform={length:0,baseOffset:0,width:this.isStraight?n:3*n,height:2*n,viewBox:{width:this.isStraight?100:300,height:200},origin:{x:0,y:0},position:{x:0,y:0},rotation:0,scale:{x:1,y:1}};if(this.isStraight){var a=Math.abs(r.file-o.file),i=Math.abs(r.rank-o.rank);if(r.file===o.file){var s=i+1;transform.length=100*(i-1),transform.height=n*s,transform.viewBox.height=100*s,transform.origin.x=50,transform.position.x=(r.file-1)*n,r.rank<o.rank?(transform.rotation=180,transform.position.y=(t+1-r.rank)*n):transform.position.y=(t-r.rank)*n}if(r.rank===o.rank){var c=a+1;transform.length=100*(a-1),transform.height=n*c,transform.viewBox.height=100*c,transform.position.x=(r.file-1)*n,transform.position.y=(t+1-r.rank)*n,r.file<o.file?transform.rotation=-90:(transform.rotation=90,transform.origin.x=100)}if(Math.abs(r.file-o.file)===Math.abs(r.rank-o.rank)){var u=i+1,l=Math.sqrt(2*Math.pow(n,2)),d=141.42;transform.length=d*i-100,transform.baseOffset=20.71,transform.height=l*u,transform.viewBox.height=d*u,transform.origin={x:50,y:50},r.file<o.file?(transform.position.x=(r.file-1+i/2)*n,r.rank<o.rank?(transform.rotation=-135,transform.position.y=(t-o.rank+u/2)*n-transform.height/2):(transform.rotation=-45,transform.position.y=(t-r.rank+u/2)*n-transform.height/2)):(transform.position.x=(o.file-1+i/2)*n,r.rank<o.rank?(transform.rotation=135,transform.position.y=(t-o.rank+u/2)*n-transform.height/2):(transform.rotation=45,transform.position.y=(t-r.rank+u/2)*n-transform.height/2))}}else transform.origin.y=50,2===Math.abs(r.rank-o.rank)?(r.rank<o.rank?(transform.rotation=-90,transform.position.y=(t-r.rank)*n):(transform.rotation=90,transform.position.y=(t-1-r.rank)*n),r.file<o.file?(transform.position.x=r.file*n,r.rank>o.rank&&(transform.scale.y=-1)):(transform.position.x=(r.file-1)*n,r.rank<o.rank&&(transform.scale.y=-1))):r.file<o.file?(transform.position.x=(r.file-1)*n,r.rank<o.rank?(transform.position.y=(t-o.rank)*n,transform.scale.y=-1):transform.position.y=(t-r.rank)*n):(transform.position.x=r.file*n,transform.scale.x=-1,r.rank<o.rank?(transform.position.y=(t-1-r.rank)*n,transform.scale.y=-1):transform.position.y=(t-r.rank)*n);return transform}}},s=(n("./chessboard/src/components/chessboard/marked-arrow.vue?vue&type=style&index=0&lang=less&"),n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js")),c=Object(s.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{staticClass:"arrow-container",style:e.arrowStyles,attrs:{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",width:e.transform.width+"px",height:e.transform.height+"px",viewBox:"0 0 "+e.transform.viewBox.width+" "+e.transform.viewBox.height}},[n("polygon",{staticClass:"arrow",style:{fill:e.color},attrs:{points:e.arrowPoints,transform:"translate(0, "+e.transform.baseOffset+")"}})])}),[],!1,null,null,null);t.a=c.exports},"./chessboard/src/components/chessboard/marked-arrow.vue?vue&type=style&index=0&lang=less&":function(e,t,n){"use strict";n("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/less-loader/dist/cjs.js!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/marked-arrow.vue?vue&type=style&index=0&lang=less&")},"./chessboard/src/components/chessboard/marked-effect.vue":function(e,t,n){"use strict";var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./chessboard/src/components/config.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var i="top",s="left",c={props:{additionalStyles:{type:Object,default:function _default(){return{}}},files:{type:Number,default:a.a.defaultBoardOptions.files},flipped:{type:Boolean,default:!1},square:{type:Object,required:!0},ranks:{type:Number,default:a.a.defaultBoardOptions.ranks},position:{type:Object,default:function _default(){return{y:i,x:s}}},squareSize:{type:Number,required:!0},template:{type:String,required:!0}},computed:{effectStyles:function effectStyles(){return _objectSpread(_objectSpread({},{transform:"translate3d(".concat(this.transform.x,"px, ").concat(this.transform.y,"px, 0)"),width:"".concat(this.size,"px"),height:"".concat(this.size,"px")}),this.additionalStyles)},size:function size(){return.4*this.squareSize},shift:function shift(){var e=this.position,t=e.x,n=e.y;return{x:t===s?-this.size/2.5:this.squareSize-this.size/1.5,y:n===i?-this.size/2.5:this.squareSize-this.size/1.5}},transform:function transform(){var e=this.files,t=this.ranks,n=this.squareSize,r=this.square;return this.flipped&&(r={file:e+1-r.file,rank:t+1-r.rank}),{x:(r.file-1)*n+this.shift.x,y:(t-r.rank)*n+this.shift.y}}}},u=n("./chessboard/src/components/chessboard/marked-effect.vue?vue&type=style&index=0&lang=scss&module=true&"),l=n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js");var d=Object(l.a)(c,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{class:e.$style.effect,style:e.effectStyles,domProps:{innerHTML:e._s(e.template)}})}),[],!1,(function injectStyles(e){this.$style=u.default.locals||u.default}),null,null);t.a=d.exports},"./chessboard/src/components/chessboard/marked-effect.vue?vue&type=style&index=0&lang=scss&module=true&":function(e,t,n){"use strict";var r=n("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/marked-effect.vue?vue&type=style&index=0&lang=scss&module=true&"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},"./chessboard/src/components/chessboard/standalone/core/actions/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return T}));var r=n("./chessboard/src/components/chessboard/standalone/core/config.js"),o=n("./chessboard/src/components/chessboard/standalone/core/utils.js"),a=function cancelPromotion(e){var t=e.emit,n=e.state;t(r.b.SET_PIECE,{piece:n.promotion.from,fileRank:n.promotion.from}),n.promotion={from:null,piece:null,to:null},t(r.b.CLOSE_PROMOTION_MENU),t(r.b.REMOVE_SQUARES,{type:r.f.SELECTION})},i=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),s=n.n(i),c=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),u=n.n(c);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=0,d=function getKey(){return"piece-".concat(l+=1)},f=function mapArrayToObjectById(e){var t={};return e.forEach((function(e){return t[e.id]=_objectSpread({},e)})),t},p=function mapObjtoArray(e){return Object.keys(e).map((function(t){return e[t]}))},m=function getDiff(e,t){var n=f(e),r=f(function addIds(e){return e.map((function(e){return _objectSpread(_objectSpread({},e),{},{id:"".concat(1===e.color?"w":"b").concat(e.type).concat(e.file).concat(e.rank)})}))}(t)),o=[],a=[],i=[];Object.keys(r).forEach((function(e){n[e]&&(o.push(_objectSpread(_objectSpread({},r[e]),{},{key:n[e].key})),delete n[e],delete r[e])}));var s=p(n);return o=p(r).map((function(e){var t,n=s.findIndex((function(t){return t&&t.type===e.type&&t.color===e.color}));return-1!==n?(t=s[n].key,a.push(_objectSpread(_objectSpread({},e),{},{key:t})),s[n]=null):(t=d(),i.push(_objectSpread(_objectSpread({},e),{},{key:t}))),_objectSpread(_objectSpread({},e),{},{key:t||d()})})).concat(o),{added:i,final:o,moved:a,previous:e,removed:s.filter((function(e){return null!==e}))}},h={type:null,timeout:null};function clearCachedSound(){h.type=null,h.timeout=null}function change_position_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function change_position_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?change_position_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):change_position_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function getMoveType(e){if(!e)return null;var t=e.san.slice(-1);return"+"===t?r.d.CHECK:"#"===t?r.d.CHECKMATE:1===e.flags||4===e.flags?r.d.CAPTURE:16===e.flags||32===e.flags?r.d.CASTLE:8===e.flags||9===e.flags?r.d.PROMOTION:r.d.NORMAL},b=function getSound(e,t){var n;switch(e){case r.d.CHECK:case r.d.CHECKMATE:n=r.e.CHECK;break;case r.d.CAPTURE:n=r.e.CAPTURE;break;case r.d.CASTLE:n=r.e.CASTLE;break;case r.d.PREMOVE:n=r.e.PREMOVE;break;case r.d.PROMOTION:n=r.e.PROMOTION;break;default:n=t?r.e.MOVE_OPPONENT:r.e.MOVE_SELF}return n},v=n("./chessboard/src/components/chessboard/standalone/shared/helpers/position.helpers.js");function drag_start_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function drag_start_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?drag_start_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):drag_start_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=n("./utils/common/throttle.js");var _=Object(E.a)((function handler(e,t){var n=e.emit;if(!e.state.options.captureKeyStrokes)return null;switch(n(r.c.KEY_PRESS,t),t){case 37:n(r.c.MOVE_BACKWARD,1);break;case 38:n(r.c.MOVE_TO_START);break;case 39:n(r.c.MOVE_FORWARD,1);break;case 40:n(r.c.MOVE_TO_END)}}),120);function mark_arrow_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mark_arrow_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mark_arrow_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mark_arrow_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=0,O=function getId(){return"arrow-".concat(y+=1)};function mark_effect_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var S=0,P=function getId(){return"effect-".concat(S+=1)};function make_move_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function make_move_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?make_move_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):make_move_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=n("./chessboard/src/components/chessboard/standalone/core/state.js");function reset_board_state_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function reset_board_state_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?reset_board_state_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):reset_board_state_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k;function select_piece_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function set_board_dimensions_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function set_board_dimensions_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?set_board_dimensions_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):set_board_dimensions_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=n("./chessboard/src/components/chessboard/style/style.helpers.js");function update_board_image_state_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function update_board_image_state_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?update_board_image_state_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):update_board_image_state_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function update_game_settings_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function update_game_settings_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?update_game_settings_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):update_game_settings_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=n("./chessboard/src/components/chessboard/style/style.config.js");function update_options_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function update_options_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?update_options_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):update_options_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w={addCustomItem:function addCustomItem(e,t){var n=e.emit,o=e.state;o.customItems.push(t),n(r.b.SET_CUSTOM_ITEMS,o.customItems)},cancelPromotion:a,changePosition:function changePosition(e,t){var n=e.dispatch,a=e.emit,i=e.state;!function flushSound(e){clearTimeout(h.timeout),e(r.b.PLAY_SOUND,h.type),clearCachedSound()}(a);var c=!1,u=null,l=i.busy,d=t.animate?function getAnimationSpeed(e){switch(e){case"none":return 0;case"slow":return.5;default:return.2}}(i.options.animationType):0,f=m(i.pieces,t.pieces),p=t.sideToMove===t.playingAs,v=t.premoves.length>i.premoves.length?r.d.PREMOVE:g(t.selectedNode),E=change_position_objectSpread({},i.selectedNode);i.isCheck=t.isCheck,i.isCheckmate=t.isCheckmate,i.pieces=s()(f.final),i.premoves=s()(t.premoves),i.previousPieces=s()(f.previous),i.selectedNode=change_position_objectSpread({},t.selectedNode),i.sideToMove=t.sideToMove,i.playingAs=t.playingAs,i.promotion.to&&(i.promotion={from:null,piece:null,to:null},a(r.b.CLOSE_PROMOTION_MENU)),n(T.UPDATE_LEGAL_MOVES,t),E&&(t.selectedNode||(t.selectedNode={moveNumber:-1}),c=1===Math.abs(E.moveNumber-t.selectedNode.moveNumber)),t.playSound?c&&E.moveNumber>t.selectedNode.moveNumber?u=b(g(E),!p):t.selectedNode&&(u=b(v,p)):u=null;var _={fadeTime:c?d:0,pieces:f.added,moveType:v},y={animationSpeed:i.options.fadeSetup>0?0:d,pieces:f.moved,moveType:v},O={fadeTime:!c||i.movedPiece||i.draggingPiece?0:d,pieces:f.removed,moveType:v};n(T.SET_BUSY_FLAG,!0);var S=i.options.highlightMoves?Object(o.c)(i.selectedNode,t.premoves,t.squares):Object(o.c)({},t.premoves,t.squares);(n(T.SET_MOVE_SQUARES,S),i.options.fadeSetup>0&&a(r.b.FADE_PIECES),t.loaded&&(n(T.DESELECT_PIECE),a(r.c.LOADED)),i.draggingPiece&&O.pieces&&O.pieces.length>0)&&(O.pieces.findIndex((function(e){return e.key===i.draggingPiece.key}))>=0&&(n(T.DESELECT_PIECE),n(T.DRAG_CANCEL)));if(a(r.c.POSITION_CHANGED,f),a(r.b.SET_PIECES,f.previous),a(r.b.REMOVE_PIECES,O),a(r.b.ADD_PIECES,_),u&&i.options.playSounds&&(l?a(r.b.PLAY_SOUND,u):function playSoundTimeout(e,t,n){h.type=t,h.timeout=setTimeout((function(){n(r.b.PLAY_SOUND,t),clearCachedSound()}),1e3*e)}(d,u,a)),i.selectedPiece&&y.pieces&&y.pieces.length&&y.pieces.findIndex((function(e){return e.key===i.selectedPiece.key}))>=0&&n(T.DESELECT_PIECE),(i.movedPiece||i.draggingPiece)&&y.pieces&&y.pieces.length>0){var P=null,j=-1;i.draggingPiece&&((j=y.pieces.findIndex((function(e){return e.key===i.draggingPiece.key})))>=0&&(P={file:y.pieces[j].file,rank:y.pieces[j].rank},y.pieces.splice(j,1)),null!==P&&(a(r.b.DROP_PIECE,{state:i,draggingPiece:i.draggingPiece,fileRank:P}),i.draggingPiece=null)),i.movedPiece&&(P=null,(j=y.pieces.findIndex((function(e){return e.key===i.movedPiece.key})))>=0&&(P={file:y.pieces[j].file,rank:y.pieces[j].rank},y.pieces.splice(j,1)),null!==P&&(a(r.b.DROP_PIECE,{state:i,draggingPiece:i.movedPiece,fileRank:P}),i.movedPiece=null))}a(r.b.MOVE_PIECES,y);var k=100;d>0&&(y.pieces&&y.pieces.length||i.options.fadeSetup>0)&&(k+=1e3*d),null!==i.busyFlagTimeout&&clearTimeout(i.busyFlagTimeout),i.busyFlagTimeout=setTimeout((function(){i.busyFlagTimeout=null,n(T.SET_BUSY_FLAG,!1)}),k)},clearArrow:function clearArrow(e,t){var n=e.emit,a=e.state;a.arrows=a.arrows.filter((function(e){return!Object(o.h)(e,t)})),n(r.c.ARROW_CLEARED,t)},clearMarkings:function clearMarkings(e){var t=e.emit,n=e.state;n.squares=[],n.arrows=[],t(r.c.MARKINGS_CLEARED)},clearSquare:function clearSquare(e,t){var n=e.emit,a=e.state;a.squares=a.squares.filter((function(e){return!Object(o.h)(e,t)})),n(r.c.SQUARE_CLEARED,t)},click:function click(e,t){var n=e.dispatch,i=e.emit,s=e.state;if(!s.options.enabled||!Object(v.g)(t,s.board.files,s.board.ranks))return null;(s.squares&&s.squares.length||s.arrows&&s.arrows.length)&&n(T.CLEAR_MARKINGS),t.piece=Object(o.d)(s.pieces,t),"drag"===s.options.moveMethod&&s.draggingPiece&&Object(o.h)(s.draggingPiece,t)?(n(T.DROP_PIECE,s.draggingPiece),s.preselectedPiece&&s.selectedPiece&&s.preselectedPiece.key===s.selectedPiece.key?(n(T.DESELECT_PIECE),s.preselectedPiece=null):n(T.SELECT_PIECE,t)):s.selectedPiece&&"drag"===s.options.moveMethod?(null!==s.promotion.from&&a({emit:i,state:s}),n(T.MAKE_MOVE,t)):!s.selectedPiece&&t.piece?s.preventNextSelect?s.preventNextSelect=!1:n(T.SELECT_PIECE,t):n(T.DESELECT_PIECE),s.busyFlagTimeout=setTimeout((function(){s.busyFlagTimeout=null,n(T.SET_BUSY_FLAG,!1)}),100),i(r.c.CLICKED,{state:s,file:t.file,rank:t.rank})},deselectPiece:function deselectPiece(e){var t=e.emit,n=e.dispatch,o=e.state;t(r.b.REMOVE_LEGAL_MOVES),t(r.c.PIECE_UNSELECTED,o.selectedPiece),o.selectedPiece=null,n(T.UPDATE_SELECTED_PIECE_SQUARE)},droppableDragStart:function droppableDragStart(e){var t=e.emit;(0,e.dispatch)(T.SET_BUSY_FLAG,!0),t(r.b.DISABLE_FAKE_CURSOR)},droppableDragEnd:function droppableDragEnd(e){var t=e.emit;(0,e.dispatch)(T.SET_BUSY_FLAG,!1),t(r.b.ENABLE_FAKE_CURSOR)},dragCancel:function dragCancel(e){var t=e.emit,n=e.dispatch,o=e.state;null!==o.busyFlagTimeout&&(clearTimeout(o.busyFlagTimeout),o.busyFlagTimeout=null,n(T.SET_BUSY_FLAG,!1)),o.draggingPiece&&(n(T.DROP_PIECE,{file:o.draggingPiece.file,rank:o.draggingPiece.rank}),t(r.c.PIECE_DROPPED,{state:o,draggingPiece:o.draggingPiece})),o.drawingArrow=!1},dragMove:function dragMove(e,t){var n=e.emit,o=e.state;if(!o.draggingPiece)return null;n(r.b.DRAG_PIECE,{state:o,draggingPiece:o.draggingPiece,coords:t}),n(r.b.SHOW_HOVER_SQUARE,{state:o,coords:t})},dragStart:function dragStart(e,t){var n=e.dispatch,i=e.emit,s=e.state;if(!s.options.enabled||!Object(v.g)(t,s.board.files,s.board.ranks)||s.draggingPiece||s.preventNextSelect)return null;s.selectedPiece&&null!==s.promotion.from?a({emit:i,state:s}):(t.piece=Object(o.d)(s.pieces,t),!t.piece||s.selectedPiece&&s.selectedPiece.color!==t.piece.color||(s.selectedPiece=t.piece),s.selectedPiece&&(t.piece=drag_start_objectSpread({},s.selectedPiece)),!t.isRightClick&&s.selectedPiece?(s.draggingPiece=drag_start_objectSpread({},s.selectedPiece),n(T.SET_BUSY_FLAG,!0),n(T.SELECT_PIECE,t),i(r.b.PICK_UP_PIECE,s.selectedPiece),i(r.c.PIECE_PICKED_UP,s.selectedPiece)):t.isRightClick&&s.options.allowMarkings&&(s.drawingArrowFrom=t))},dragStop:function dragStop(e,t){var n=e.emit,a=e.dispatch,i=e.state;if(!i.draggingPiece&&!i.drawingArrowFrom||!t)return null;var s=t.file,c=t.rank,u=t.isRightClick,l={file:s,rank:c};if(i.drawingArrowFrom&&u){if(Object(o.h)(i.drawingArrowFrom,l))return i.drawingArrowFrom=null,null;var d={fromFileRank:i.drawingArrowFrom,toFileRank:Object(o.b)(l,i.board.files,i.board.ranks)};if(Object(o.i)(d.fromFileRank,d.toFileRank))return i.drawingArrowFrom=null,null;i.arrows.find((function(e){return Object(o.h)(e.fromFileRank,d.fromFileRank)&&Object(o.h)(e.toFileRank,d.toFileRank)}))?a(T.CLEAR_ARROW,d):a(T.MARK_ARROW,d),i.drawingArrowFrom=null,i.selectedPiece=null}else Object(v.g)(l,i.board.files,i.board.ranks)?(null!==i.busyFlagTimeout&&clearTimeout(i.busyFlagTimeout),i.busyFlagTimeout=setTimeout((function(){i.busyFlagTimeout=null,a(T.SET_BUSY_FLAG,!1)}),100),u?i.draggingPiece&&(a(T.DROP_PIECE,{file:i.draggingPiece.file,rank:i.draggingPiece.rank}),n(r.c.PIECE_DROPPED,{state:i,draggingPiece:i.draggingPiece})):i.selectedPiece&&!Object(o.h)(i.selectedPiece,l)?a(T.MAKE_MOVE,t):a(T.DROP_PIECE,l)):(null!==i.busyFlagTimeout&&clearTimeout(i.busyFlagTimeout),i.busyFlagTimeout=setTimeout((function(){i.busyFlagTimeout=null,a(T.SET_BUSY_FLAG,!1)}),100),a(T.MAKE_MOVE,null))},dropPiece:function dropPiece(e,t){var n=e.emit,o=e.state;o.draggingPiece&&(n(r.b.DROP_PIECE,{state:o,draggingPiece:o.draggingPiece,fileRank:t}),n(r.b.HIDE_HOVER_SQUARE,{state:o}),o.draggingPiece=null)},keyDown:_,makeMove:function makeMove(e,t){var n=e.dispatch,a=e.emit,i=e.state;if(!(i.selectedPiece||i.promotion&&i.promotion.piece&&i.promotion.from))return i.draggingPiece=null,null;var s,c=i.selectedPiece?make_move_objectSpread({},Object(o.d)(i.pieces,i.selectedPiece)):null;if(!c||!c.file&&!c.rank||c&&i.selectedPiece&&(c.type!==i.selectedPiece.type||c.color!==i.selectedPiece.color)){if(i.draggingPiece=null,n(T.DESELECT_PIECE),!i.promotion.from)return null;c=i.promotion.from}a(r.c.SQUARE_UNSELECTED,{state:i,square:i.selectedPiece});var u={file:c.file,rank:c.rank},l=i.promotion.piece,d=i.promotion.to||t,f=i.options.autoPromote&&!(t&&t.altKey),p=Object(o.k)(i.pieces,c,d),m=0===i.legalMoves.filter((function(e){return e.from===Object(o.e)(u)&&e.to===Object(o.e)(d)&&"k"!==e.captured})).length,h=p&&!m&&!i.promotion.piece&&!f,g=!m&&p&&(f||i.promotion.piece);if(h)return i.promotion={from:make_move_objectSpread({},c),piece:null,to:t},n(T.DROP_PIECE,t),a(r.b.OPEN_PROMOTION_MENU,{piece:c,toFileRank:t,top:i.options.flipBoard&&2===c.color||!i.options.flipBoard&&1===c.color});if((g&&(u=i.promotion.from||u,d=i.promotion.to||t,l=f?"q":i.promotion.piece,n(T.DROP_PIECE,t)),i.movedPiece=i.draggingPiece,null===t&&i.gameSettings.rules&&(s={file:c.file,rank:c.rank}),m&&(s={file:c.file,rank:c.rank}),s&&n(T.DROP_PIECE,s),m||n(T.DROP_PIECE,t),a(r.c.MOVE_MADE,{from:u,to:d,isIllegal:m,promotion:l}),n(T.DESELECT_PIECE),i.isCheck&&m&&c&&c.color===i.sideToMove)&&!i.pieces.find((function(e){return e&&d&&e.file===d.file&&e.rank===d.rank&&e.color===i.sideToMove}))){var b=i.pieces.find((function(e){return"k"===e.type&&e.color===i.sideToMove}));a(r.b.BLINK_SQUARE,{file:b.file,rank:b.rank,times:3,color:"#ff0000",interval:200}),i.options.playSounds&&a(r.b.PLAY_SOUND,r.e.ILLEGAL)}i.promotion={from:null,piece:null,to:null}},markArrow:function markArrow(e,t){var n=e.emit;if(!t||!t.fromFileRank||!t.toFileRank)return null;var o={id:O(),fromFileRank:mark_arrow_objectSpread({},t.fromFileRank),toFileRank:mark_arrow_objectSpread({},t.toFileRank)};return n(r.c.ARROW_MARKED,o)},markEffect:function markEffect(e,t){var n=e.emit;if(!t||!t.square)return null;var o=function mark_effect_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mark_effect_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mark_effect_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:P()},t);return n(r.c.EFFECT_MARKED,o)},markSquare:function markSquare(e,t){var n=e.emit,a=e.state;if(!t||!t.file||!t.rank)return null;var i={id:Object(o.f)(),file:t.file,rank:t.rank,color:t.color||a.options.highlightColor,opacity:t.opacity||a.options.highlightOpacity};return n(r.c.SQUARE_MARKED,i)},pointerdown:function pointerdown(e,t){var n=e.dispatch,a=e.emit,i=e.state;if(t){var s=t.file,c=t.rank,u=t.x,l=t.y,d=t.boardRect;if(t.isRightClick)return n(T.DRAG_CANCEL);if(!i.options.enabled||!Object(v.g)({file:s,rank:c},i.board.files,i.board.ranks)||i.selectedPiece&&null!==i.promotion.from)return null;if("drag"===i.options.moveMethod){if(!i.gameSettings.rules)return;if(i.selectedPiece)if(i.legalMoves.findIndex((function(e){return e.from===Object(o.e)(i.selectedPiece)&&e.to===Object(o.e)({file:s,rank:c})}))>-1)return;if(!Object(o.d)(i.pieces,{file:s,rank:c}))return;i.selectedPiece=null,n(T.DRAG_START,{file:s,rank:c,x:u,y:l}),a(r.b.DRAG_PIECE,{state:i,draggingPiece:i.selectedPiece,coords:{x:u,y:l,boardRect:d}})}else i.selectedPiece&&!Object(o.h)(i.selectedPiece,{file:s,rank:c})?(i.preventNextSelect=!0,n(T.MAKE_MOVE,t),null!==i.busyFlagTimeout&&(clearTimeout(i.busyFlagTimeout),i.busyFlagTimeout=null,n(T.SET_BUSY_FLAG,!1))):i.preventNextSelect=!1}},pointerup:function pointerup(e,t){var n=e.dispatch,o=e.emit,a=e.state,i=(t.file,t.rank,t.x,t.y,t.isRightClick);if(a.draggingPiece&&!i)n(T.DROP_PIECE,{file:a.draggingPiece.file,rank:a.draggingPiece.rank}),o(r.c.PIECE_DROPPED,{state:a,draggingPiece:a.draggingPiece});else if(i){if(a.gameSettings.premoves&&a.premoves.length)return o(r.c.CANCEL_PREMOVES),null;if(a.gameSettings.GTM&&a.premoves.length)return o(r.c.CANCEL_GTM),null}},removeCustomItem:function removeCustomItem(e,t){var n=e.emit,a=e.state;a.customItems=a.customItems.filter((function(e){return!Object(o.h)(e.fileRank,t.fileRank)})),n(r.b.SET_CUSTOM_ITEMS,a.customItems)},resetBoardState:function resetBoardState(e){var t=e.dispatch,n=e.state,r=j.a.busy,o=j.a.busyFlagTimeout,a=j.a.movedPiece,i=j.a.promotion;n=Object.assign(n,{busy:r,busyFlagTimeout:o,movedPiece:a,promotion:reset_board_state_objectSpread({},i)}),t(T.DESELECT_PIECE),t(T.DROP_PIECE)},resizeBoard:function resizeBoard(e,t){var n=e.dispatch,o=e.emit;clearTimeout(k),n(T.SET_BOARD_DIMENSIONS,t),k=setTimeout((function(){o(r.b.UPDATE_BOARD_IMAGE),o(r.b.UPDATE_PIECE_IMAGES)}),300)},rightClick:function rightClick(e,t){var n=e.dispatch,i=e.emit,s=e.state;if(!s.options.enabled)return null;if(s.draggingPiece)return s.busyFlagTimeout=setTimeout((function(){s.busyFlagTimeout=null,n(T.SET_BUSY_FLAG,!1)}),100),i(r.c.PIECE_DROPPED,{state:s,draggingPiece:s.draggingPiece,fileRank:{file:s.draggingPiece.file,rank:s.draggingPiece.rank}}),void(s.draggingPiece=null);if(s.selectedPiece&&null!==s.promotion.from)return a({emit:i,state:s}),null;if(s.gameSettings.premoves&&s.premoves.length)return i(r.c.CANCEL_PREMOVES),null;if(s.gameSettings.GTM&&s.premoves.length)return i(r.c.CANCEL_GTM),null;if(!Object(v.g)(t,s.board.files,s.board.ranks))return null;if(s.options.allowMarkings){var c={file:t.file,rank:t.rank,color:s.markedSquareColors[t.key],opacity:s.markedSquareOpacity,userGenerated:!0};s.squares&&s.squares.find((function(e){return Object(o.h)(e,c)}))?n(T.CLEAR_SQUARE,c):n(T.MARK_SQUARE,c)}return!0},selectPiece:function selectPiece(e,t){var n=e.emit,a=e.state,i=e.dispatch,s=t.piece;if(!Object(v.g)(s,a.board.files,a.board.ranks))return null;a.selectedPiece=function select_piece_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?select_piece_ownKeys(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):select_piece_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},s),i(T.UPDATE_SELECTED_PIECE_SQUARE),a.options.highlightLegalMoves&&n(r.b.ADD_LEGAL_MOVES,a.legalMoves.filter((function(e){return e.from===Object(o.e)(s)})).map((function(e){return Object(o.a)(e.to)}))),n(r.c.PIECE_SELECTED,t)},selectPromotionPiece:function selectPromotionPiece(e,t){var n=e.dispatch,a=e.emit,i=e.state;if(!Object(o.j)(t))return null;if(i.promotion.piece=t,i.promotion.from){var s=i.pieces.findIndex((function(e){return e.key===i.promotion.from.key}));i.pieces.splice(s,1)}a(r.b.CLOSE_PROMOTION_MENU),a(r.b.REMOVE_LEGAL_MOVES),n(T.MAKE_MOVE,i.promotion.to)},setBoardDimensions:function setBoardDimensions(e,t){var n=e.dispatch,o=e.emit,a=e.state,i=t.height,s=t.width,c=t.aspectRatio,u=void 0===c?1:c,l=s/u<i,d=l?s:i*u,f=l?s/u:i,p=Math.min(d,f),m=Math.floor(p/a.board.files),h=u>1?s:m*a.board.files;a.board=set_board_dimensions_objectSpread(set_board_dimensions_objectSpread({},a.board),{},{size:h,squareSize:m}),n(T.UPDATE_BOARD_IMAGE_STATE),o(r.b.UPDATE_BOARD_SIZE),o(r.b.UPDATE_PIECE_SIZES),o(r.b.UPDATE_PROMOTION_MENU_SIZE),o(r.c.BOARD_DIMENSIONS_SET)},setBusyFlag:function setBusyFlag(e,t){var n=e.emit,o=e.state;t!==o.busy&&(o.busy=t,n(r.c.BUSY_FLAG,o.busy))},setMoveSquares:function setMoveSquares(e,t){var n=e.emit,a=e.state,i=(t||[]).filter((function(e){return e})).map((function(e){return{id:Object(o.f)(),file:e.file,rank:e.rank,color:e.isPremove?a.options.premoveHighlightColor:e.color||a.options.highlightColor,opacity:e.isPremove?a.options.premoveHighlightOpacity:a.options.highlightOpacity,playerColor:1===a.sideToMove?2:1}}));n(r.b.REMOVE_SQUARES,{type:r.f.MOVE}),n(r.b.ADD_SQUARES,{moveSquares:i,type:r.f.MOVE})},updateBoardImageState:function updateBoardImageState(e){var t=e.state;t.board=update_board_image_state_objectSpread(update_board_image_state_objectSpread({},t.board),{},{boardBg:Object(C.a)(t.options.boardStyle,t.board.squareSize),pieceBaseBg:Object(C.b)(t.options.pieceStyle,t.board.squareSize)})},updateGameSettings:function updateGameSettings(e,t){var n=e.dispatch,o=e.emit,a=e.state;a.gameSettings=update_game_settings_objectSpread(update_game_settings_objectSpread({},a.gameSettings),t),n(T.UPDATE_BOARD_IMAGE_STATE),o(r.b.UPDATE_BOARD_IMAGE)},updateLegalMoves:function updateLegalMoves(e,t){var n=e.emit,o=e.state,a=t.legalMoves;if(!Array.isArray(a))return null;o.legalMoves=s()(a),n(r.c.LEGAL_MOVES_UPDATED,o.legalMoves)},updateMarkings:function updateMarkings(e,t){var n=e.emit,a=e.dispatch,i=e.state;i.arrows=t.arrows?s()(t.arrows):[],i.squares=t.squares?s()(t.squares):[],i.effects=t.effects?s()(t.effects):[],(t.blinkingSquares||[]).forEach((function(e){return n(r.b.BLINK_SQUARE,e)}));var c=i.options.highlightMoves?Object(o.c)(i.selectedNode,i.premoves,i.squares):Object(o.c)({},i.premoves,i.squares);a(T.SET_MOVE_SQUARES,c),a(T.UPDATE_SELECTED_PIECE_SQUARE),n(r.b.SET_ARROWS,i.arrows),n(r.b.SET_EFFECTS,i.effects),n(r.b.SET_SQUARES,i.squares)},updateOptions:function updateOptions(e,t){var n=e.dispatch,a=e.emit,i=e.state,s=function getUpdates(e,t){var n={};return Object.keys(e).filter((function(n){return e[n]!==t[n]})).forEach((function(t){n[t]=e[t]})),n}(t,i.options);if(i.options=update_options_objectSpread(update_options_objectSpread({},i.options),t),Boolean(s.highlightColor)?i.options.highlightColor=s.highlightColor:A.a[i.options.boardStyle]&&A.a[i.options.boardStyle].length>=5&&(i.options.highlightColor=A.a[i.options.boardStyle][4]),void 0!==s.highlightMoves||void 0!==s.boardStyle||void 0!==s.highlightColor){var c=i.options.highlightMoves?Object(o.c)(i.selectedNode,i.premoves,i.squares):Object(o.c)({},i.premoves,i.squares);n(T.SET_MOVE_SQUARES,c),n(T.UPDATE_SELECTED_PIECE_SQUARE)}void 0!==s.overlayInAnalysisMode&&a(r.b.UPDATE_BOARD_IMAGE),void 0!==s.boardStyle&&(n(T.UPDATE_BOARD_IMAGE_STATE),a(r.b.UPDATE_BOARD_IMAGE)),void 0!==s.pieceStyle&&(n(T.UPDATE_BOARD_IMAGE_STATE),a(r.b.UPDATE_PIECE_IMAGES)),void 0===s.enabled&&void 0===s.flipBoard&&void 0===s.rounded||a(r.b.UPDATE_BOARD_CLASSES,t),void 0!==s.flipBoard&&a(r.b.FLIP_BOARD),!0===i.options.autoPromote&&null!==i.promotion.piece&&"q"!==i.promotion.piece&&n(T.SELECT_PROMOTION_PIECE,"q"),a(r.c.OPTIONS_CHANGED,s)},updateSelectedPieceSquare:function updateSelectedPieceSquare(e){var t=e.state,n=e.emit,a=t.selectedPiece;if(n(r.b.REMOVE_SQUARES,{type:r.f.SELECTION}),t.options.highlightMoves&&a){var i=!0;if(t.premoves.forEach((function(e){(e.from&&Object(o.h)(e.from,a)||e.to&&Object(o.h)(e.to,a))&&(i=!1)})),t.squares.forEach((function(e){Object(o.h)(e,a)&&(i=!1)})),i){var s={id:Object(o.f)(),file:a.file,rank:a.rank,color:t.options.highlightColor,opacity:t.options.highlightOpacity};n(r.b.ADD_SQUARES,{moveSquares:[s],type:r.f.SELECTION})}}}},T={ADD_CUSTOM_ITEM:"addCustomItem",CANCEL_PROMOTION:"cancelPromotion",CHANGE_POSITION:"changePosition",CLEAR_ARROW:"clearArrow",CLEAR_MARKINGS:"clearMarkings",CLEAR_SQUARE:"clearSquare",CLICK:"click",DESELECT_PIECE:"deselectPiece",DROPPABLE_DRAG_START:"droppableDragStart",DROPPABLE_DRAG_END:"droppableDragEnd",DRAG_CANCEL:"dragCancel",DRAG_MOVE:"dragMove",DRAG_START:"dragStart",DRAG_STOP:"dragStop",DROP_PIECE:"dropPiece",JUMP_TO_POSITION:"jumpToPosition",KEY_DOWN:"keyDown",MAKE_MOVE:"makeMove",MARK_ARROW:"markArrow",MARK_EFFECT:"markEffect",MARK_SQUARE:"markSquare",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",REMOVE_CUSTOM_ITEM:"removeCustomItem",RESET_BOARD_STATE:"resetBoardState",RESIZE_BOARD:"resizeBoard",RIGHT_CLICK:"rightClick",SELECT_PIECE:"selectPiece",SELECT_PROMOTION_PIECE:"selectPromotionPiece",SET_BOARD_DIMENSIONS:"setBoardDimensions",SET_BUSY_FLAG:"setBusyFlag",SET_FROM_FILE_RANK:"setFromFileRank",SET_MOVE_SQUARES:"setMoveSquares",UPDATE_BOARD_IMAGE_STATE:"updateBoardImageState",UPDATE_LEGAL_MOVES:"updateLegalMoves",UPDATE_MARKINGS:"updateMarkings",UPDATE_OPTIONS:"updateOptions",UPDATE_GAME_SETTINGS:"updateGameSettings",UPDATE_SELECTED_PIECE_SQUARE:"updateSelectedPieceSquare"}},"./chessboard/src/components/chessboard/standalone/core/config.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return c}));var r={HISTORY_CHANGE:"HISTORY_CHANGE"},o={ADD_LEGAL_MOVES:"ADD_LEGAL_MOVES",ADD_PIECES:"ADD_PIECES",ADD_SQUARES:"ADD_SQUARES",BLINK_SQUARE:"BLINK_SQUARE",CLOSE_PROMOTION_MENU:"CLOSE_PROMOTION_MENU",DRAG_PIECE:"DRAG_PIECE",DROP_PIECE:"DROP_PIECE",DISABLE_FAKE_CURSOR:"DISABLE_FAKE_CURSOR",ENABLE_FAKE_CURSOR:"ENABLE_FAKE_CURSOR",FADE_PIECES:"FADE_PIECES",FLIP_BOARD:"FLIP_BOARD",HIDE_HOVER_SQUARE:"HIDE_HOVER_SQUARE",MOVE_PIECES:"MOVE_PIECES",OPEN_PROMOTION_MENU:"OPEN_PROMOTION_MENU",PICK_UP_PIECE:"PICK_UP_PIECE",PLAY_SOUND:"PLAY_SOUND",REMOVE_LEGAL_MOVES:"REMOVE_LEGAL_MOVES",REMOVE_PIECES:"REMOVE_PIECES",REMOVE_SQUARES:"REMOVE_SQUARES",SET_ARROWS:"SET_ARROWS",SET_CUSTOM_ITEMS:"SET_CUSTOM_ITEMS",SET_EFFECTS:"SET_EFFECTS",SET_SQUARES:"SET_SQUARES",SET_PIECE:"SET_PIECE",SET_PIECES:"SET_PIECES",SHOW_HOVER_SQUARE:"SHOW_HOVER_SQUARE",UPDATE_BOARD_CLASSES:"UPDATE_BOARD_CLASSES",UPDATE_BOARD_IMAGE:"UPDATE_BOARD_IMAGE",UPDATE_BOARD_SIZE:"UPDATE_BOARD_SIZE",UPDATE_PIECE_IMAGES:"UPDATE_PIECE_IMAGES",UPDATE_PIECE_SIZES:"UPDATE_PIECE_SIZES",UPDATE_PROMOTION_MENU_SIZE:"UPDATE_PROMOTION_MENU_SIZE"},a={ANOTHER_CHESSBOARD_ONBLUR:"DIAGRAM_VIEWER_BLUR",ANOTHER_CHESSBOARD_ONFOCUS:"DIAGRAM_VIEWER_FOCUS",ARROW_CLEARED:"ARROW_CLEARED",ARROW_MARKED:"ARROW_MARKED",BUSY_FLAG:"BUSY_FLAG",BOARD_DIMENSIONS_SET:"BOARD_DIMENSIONS_SET",CANCEL_GTM:"CANCEL_GTM",CANCEL_PREMOVES:"CANCEL_PREMOVES",CHANGED_POSITION:"CHANGED_POSITION",CLICKED:"CLICKED",EFFECT_MARKED:"EFFECT_MARKED",EFFECT_CLEARED:"EFFECT_CLEARED",KEY_PRESS:"KEY_PRESS",LEGAL_MOVES_UPDATED:"LEGAL_MOVES_UPDATED",LOADED:"LOADED",MARKINGS_CLEARED:"MARKINGS_CLEARED",MOVE_BACKWARD:"MOVE_BACKWARD",MOVE_FORWARD:"MOVE_FORWARD",MOVE_MADE:"MOVE_MADE",MOVE_SQUARES_SET:"MOVE_SQUARES_SET",MOVE_TO_END:"MOVE_TO_END",MOVE_TO_START:"MOVE_TO_START",OPTIONS_CHANGED:"OPTIONS_CHANGED",PIECE_DROPPED:"PIECE_DROPPED",PIECE_PICKED_UP:"PIECE_PICKED_UP",PIECE_SELECTED:"PIECE_SELECTED",PIECE_UNSELECTED:"PIECE_UNSELECTED",POSITION_CHANGED:"POSITION_CHANGED",PROMOTION_ATTEMPTED:"PROMOTION_ATTEMPTED",PROMOTION_PIECE_SET:"PROMOTION_PIECE_SET",PROMOTION_PIECE_UNSET:"PROMOTION_PIECE_UNSET",SOUND_THEME_UPDATED:"SOUND_THEME_UPDATED",SQUARE_CLEARED:"SQUARE_CLEARED",SQUARE_MARKED:"SQUARE_MARKED",SQUARE_UNSELECTED:"SQUARE_UNSELECTED"},i={MARKED:"marked",MOVE:"move",SELECTION:"selection"},s={CAPTURE:"capture",CASTLE:"castle",CHECK:"move-check",MOVE_OPPONENT:"move-opponent",MOVE_SELF:"move-self",PREMOVE:"premove",PROMOTION:"promote",ILLEGAL:"illegal"},c={CAPTURE:"CAPTURE",CASTLE:"CASTLE",CHECK:"CHECK",CHECKMATE:"CHECKMATE",NORMAL:"NORMAL",PREMOVE:"PREMOVE",PROMOTION:"PROMOTION"}},"./chessboard/src/components/chessboard/standalone/core/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./utils/sentry/set-sentry-context.js"),i=n("./chessboard/src/components/chessboard/standalone/core/state.js"),s=n("./chessboard/src/components/chessboard/standalone/core/actions/index.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var c=function createCore(e){var t=function eventEmitter(){var e={};return{emit:function emit(t,n){(e[t]||[]).forEach((function(e){return e.handler(n)}))},fire:function fire(t,n){return e[t]&&e[t].length?[].concat(e[t]).reduce((function(e,t){return e.then((function(){return t.handler(n)}))}),Promise.resolve()):[]},on:function on(t,n){var r={type:t,handler:n};return e[t]=e[t]||[],e[t].push(r),r},off:function off(t){var n=e[t.type].findIndex((function(e){return t.type===e.type&&t.handler===e.handler}));-1!==n&&e[t.type].splice(n,1)},subscriptions:e}}(),n=t.emit,r=t.off,c=t.on,u=t.subscriptions,l=function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},i.a),d=function dispatch(e,t){try{return n("action-".concat(e),t),s.a[e]({dispatch:dispatch,emit:n,state:l},t)}catch(r){throw Object(a.setSentryContext)({chessboardState:l,chessboardDispatchErrorOn:{data:t,type:e}}),r}};return Object.keys(e||{}).forEach((function(t){if("function"==typeof e[t])return e[t]({dispatch:d,emit:n,off:r,on:c,state:l});Object.entries(e[t]).forEach((function(e){return c(e[0],e[1])}))})),{dispatch:d,emit:n,extensions:e,off:r,on:c,state:l,subscriptions:u}}},"./chessboard/src/components/chessboard/standalone/core/state.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={arrows:[],squares:[],customItems:[],board:{files:8,ranks:8,size:0,squareSize:0,boardBg:null,pieceBaseBg:null,highlightColor:null},busy:!1,busyFlagTimeout:null,draggingPiece:null,drawingArrow:!1,drawingArrowFrom:null,movedPiece:null,gameSettings:{},legalMoves:[],isCheck:!1,isCheckmate:!1,markedSquareColors:{alt:"#0098c8",default:"#f42a32",shift:"#75bb37",ctrl:"#75bb37"},markedSquareOpacity:.9,options:n("./chessboard/src/board/board.service.js").a.getDefaultOptions(),pieces:[],previousPieces:[],premoves:[],preselectedPiece:null,promotion:{from:null,piece:null,to:null},selectedNode:void 0,selectedPiece:null,analysisMode:!1,sideToMove:1,playingAs:null,preventNextSelect:!1}},"./chessboard/src/components/chessboard/standalone/core/utils.js":function(e,t,n){"use strict";n.d(t,"g",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"h",(function(){return h})),n.d(t,"i",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"j",(function(){return v}));var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=n.n(a);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function isFileRank(e){return null!=e&&void 0!==e.file&&void 0!==e.rank},c=function getPiece(e,t){return e.filter((function(e){return e.file===t.file&&e.rank===t.rank}))[0]},u=function getFileRankInsideBoard(e,t,n){return s(e)?{file:Math.min(Math.max(e.file,1),t),rank:Math.min(Math.max(e.rank,1),n)}:null},l=function getSanFromFileRank(e){return e&&e.file&&e.rank?String.fromCharCode(96+e.file)+e.rank.toString():null},d=function getFileRankFromSan(e){return e?{file:e.toLowerCase().charCodeAt(0)-96,rank:Number(e.charAt(1))}:null},f=function getMoveSquares(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(null===t&&(t=[]),null===n&&(n=[]),0===Object.keys(e).length&&0===t.length)return[];var r=t.reduce((function(e,t){return t.from&&e.push(t.from),t.to&&e.push(t.to),e}),[]).concat(n.map((function(e){return l(e)})));return[e.from&&!r.includes(e.from)?d(e.from):null,e.to&&!r.includes(e.to)?d(e.to):null].concat(i()(t.reduce((function(e,t){return e.push(t.from?_objectSpread(_objectSpread({},d(t.from)),{},{isPremove:!0}):null),e.push(t.to?_objectSpread(_objectSpread({},d(t.to)),{},{isPremove:!0}):null),e}),[])))},p=0,m=function getSquareId(){return"square-".concat(p+=1)},h=function isFileRankEqual(e,t){return e.file===t.file&&e.rank===t.rank},g=function isInvalidArrow(e,t){return!!h(e,t)||e.file!==t.file&&e.rank!==t.rank&&(Math.abs(e.file-t.file)!==Math.abs(e.rank-t.rank)&&!(2===Math.abs(e.file-t.file)&&1===Math.abs(e.rank-t.rank)||2===Math.abs(e.rank-t.rank)&&1===Math.abs(e.file-t.file)))},b=function isValidPromotion(e,t,n){if(!e||!t||!n)return!1;var r=c(e,t);if(!r||!r.color||!r.type)return!1;var o=1===r.color?7:2,a=1===r.color?8:1;return t.rank===o&&n.rank===a&&"p"===r.type},v=function isShortString(e){return-1!=="pnbrqkPNBRQK".indexOf(e)}},"./chessboard/src/components/chessboard/standalone/default/chessboard.vue?vue&type=style&index=0&lang=scss&module=true&":function(e,t,n){"use strict";var r=n("./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/standalone/default/chessboard.vue?vue&type=style&index=0&lang=scss&module=true&"),o=n.n(r);n.d(t,"default",(function(){return o.a}))},"./chessboard/src/components/chessboard/standalone/default/dom/events.js":function(e,t,n){"use strict";t.a={PIECE_ADDED:"DOM_PIECE_ADDED",PIECE_DROPPED:"DOM_PIECE_DROPPED",PIECE_MOVED:"DOM_PIECE_MOVED",PIECE_PICKED_UP:"DOM_PIECE_PICKED_UP",PIECE_REMOVED:"DOM_PIECE_REMOVED"}},"./chessboard/src/components/chessboard/standalone/default/dom/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return g})),n.d(t,"h",(function(){return A})),n.d(t,"i",(function(){return T})),n.d(t,"j",(function(){return N})),n.d(t,"k",(function(){return M})),n.d(t,"l",(function(){return R})),n.d(t,"m",(function(){return I})),n.d(t,"n",(function(){return q})),n.d(t,"o",(function(){return G})),n.d(t,"p",(function(){return z})),n.d(t,"q",(function(){return H})),n.d(t,"r",(function(){return D})),n.d(t,"s",(function(){return w})),n.d(t,"t",(function(){return $})),n.d(t,"u",(function(){return Q})),n.d(t,"v",(function(){return Y})),n.d(t,"w",(function(){return X})),n.d(t,"x",(function(){return ee})),n.d(t,"y",(function(){return te})),n.d(t,"z",(function(){return ne}));var r=n("./chessboard/src/components/chessboard/standalone/shared/helpers/misc.helpers.js"),o=function getPieceImg(e,t){return"\n  url('".concat(t).concat(Object(r.b)(e.color)).concat(e.type,".png')\n")},a=function getSquareClass(e){if(!e)return null;var t="0".concat(e.file).slice(-2),n="0".concat(e.rank).slice(-2);return"square-".concat(t).concat(n)},i=function getTransformPercent(e,t,n){var r={x:100*(e.file-1),y:100*-(e.rank-1)},o=n.indexOf("3d")>=0;if(t&&(r.x*=-1,r.y*=-1),o){var a=1.3142;r.y=t?100*(e.rank-1)-23.90808096180187*e.rank:-(e.rank-1)*(100/a)}return r},s=function addLegalMoves(e,t,n){var r=n.map((function(e){return{id:"legal-move-hint-".concat(e.file).concat(e.rank),fileRank:e}})),o=Array.from(e.getElementsByClassName("legal-move-hint"));o.forEach((function(e){e.style.display=""})),o.filter((function(e){return-1===r.findIndex((function(t){return t.id===e.id}))})).forEach((function(e){return e.parentNode.removeChild(e)}));var i=r.filter((function(e){return-1===o.findIndex((function(t){return t.id===e.id}))})).map((function(e){return function createLegalMove(e,t){var n=document.createElement("div"),r=document.createElement("div");return n.id=e,n.className="legal-move-hint ".concat(t),r.classList.add("legal-move-hint-inner"),n.appendChild(r),n}(e.id,a(e.fileRank))}));if(i.length>0){var s=document.createDocumentFragment();i.forEach((function(e){return s.appendChild(e)})),e.appendChild(s)}},c=n("./chessboard/src/components/chessboard/standalone/shared/helpers/style.helpers.js"),u=n("./chessboard/src/components/chessboard/standalone/default/dom/events.js"),l=function addPieces(e,t,n,r){var i=Array.from(e.getElementsByClassName("piece")),s=r.pieces.filter((function(e){return-1===i.findIndex((function(t){return t.id===e.id}))})).map((function(e){var t,r,i,s=n.test?(r=(t=e).color,i=t.type,"chessboard-piece-".concat(1===r?i.toUpperCase():i.toLowerCase())):void 0;return g(e.type,e.key,a(e),o(e,Object(c.c)(n.options.pieceStyle,150)),s)}));if(s.length>0){var l=document.createDocumentFragment(),d=n.options.pieceStyle.indexOf("3d")>=0;s.forEach((function(e){d&&e.setAttribute("piece-style","pseudo3d"),r.fadeTime?(e.style.opacity="0",e.style.transition="opacity ".concat(r.fadeTime,"s"),l.appendChild(e),requestAnimationFrame((function(){e.style.opacity="1"}))):l.appendChild(e),t(u.a.PIECE_ADDED,{id:e.id})})),e.querySelector(".pieces").appendChild(l)}},d=function createSquare(e,t,n,r,o){var a=document.createElement("div");return a.id=e,a.className="square ".concat(t),void 0!==n&&(a.style.backgroundColor=n),void 0!==r&&(a.style.opacity=r),o&&a.setAttribute("data-test",o),a},f=function addSquares(e,t,n,r){var o=r.map((function(e){var r=t.test?function(e){return"chessboard-square-".concat(e)}(n):void 0;return d(e.id,"".concat(a({file:e.file,rank:e.rank})," ").concat(n,"-square"),e.color,e.opacity,r)}));if(o.length>0){var i=document.createDocumentFragment();o.forEach((function(e){return i.appendChild(e)})),e.insertBefore(i,e.firstChild)}},p=function blinkSquare(e,t){var n,r=d(t.id,"".concat(a({file:t.file,rank:t.rank})),t.color,.5);e.insertBefore(r,e.querySelector(".pieces"));var o=0;n=setInterval((function(){o+1===2*t.times?(clearInterval(n),e.removeChild(r)):(r.style.opacity=o%2?.5:0,o+=1)}),t.interval)},m=function closePromotionMenu(e){var t=document.getElementById("promotion-menu");t&&e.removeChild(t)},h=function createBoard(e){if(!e.getElementsByClassName("pieces")[0]){var t=document.createElement("div");t.classList.add("pieces"),e.appendChild(t)}},g=function createPiece(e,t,n,r,o){var a=document.createElement("div");return a.id=t,a.className="piece ".concat(n),a.style.backgroundImage=r,o&&a.setAttribute("data-test",o),a},b="mousedown",v="mousemove",E="mouseup",_="pointerdown",y="pointermove",O="pointerup",S="touchstart",P="touchmove",j="touchend",k=function getPointerEvents(){var e,t,n,r="onpointerdown"in window,o="ontouchstart"in window;return r?(e=_,t=y,n=O):o?(e=S,t=P,n=j):(e=b,t=v,n=E),{pointerdown:e,pointermove:t,pointerup:n}}(),C=k.pointerdown,A=(k.pointermove,k.pointerup,function dragPiece(e){var t=e.state,n=e.draggingPiece,r=e.coords;if(n){var o=document.getElementById(n.key);if(o){var a=t.options.flipBoard?r.x+t.board.squareSize/2-t.board.size:r.x-t.board.squareSize/2,i=t.options.flipBoard?r.y-t.board.squareSize/2:r.y+t.board.squareSize/2-t.board.size;o.style[c.e]="translate3d(".concat(a,"px, ").concat(i,"px, 0)")}}}),w=function setPiece(e,t){if(e){var n=e instanceof Node?e:document.getElementById(e.key);if(n instanceof Node){var r=Array.from(n.classList).filter((function(e){return e.includes("square")}))[0];n.classList.remove(r),n.classList.add(a(t)),n.style.transform="",n.style.zIndex=""}}},T=function dropPiece(e,t){if(t.draggingPiece){var n=document.getElementById(t.draggingPiece.key);n&&(w(n,t.fileRank),e(u.a.PIECE_DROPPED,{id:n.id,to:t.fileRank}),n.classList.remove("dragging"))}},N=function fadePieces(e,t){var n=e.getElementsByClassName("pieces")[0],r=t.options.fadeSetup;requestAnimationFrame((function(){n.style.transition="opacity 0s",n.style.opacity="0",requestAnimationFrame((function(){n.style.transition="opacity ".concat(r,"s"),n.style.opacity="1"}))}))},M=function flipPromotionMenu(e,t){var n=e.querySelector("#promotion-menu");n&&(ne(e,t),n.classList.contains("top")?(n.classList.remove("top"),e.querySelector("#promotion-close").style.order=0):(n.classList.add("top"),e.querySelector("#promotion-close").style.order=5))},D=function removeSquares(e,t,n){(void 0===n?Array.from(e.getElementsByClassName("".concat(t,"-square"))):Array.from(e.getElementsByClassName("".concat(t,"-square"))).filter((function(e){return-1!==[].concat(n).findIndex((function(t){return e.id===t.id}))}))).forEach((function(e){return e.parentNode.removeChild(e)}))},R=function hideHoverSquare(e,t){t.state.options.highlightLegalMoves&&D(e,"hover")},I=function hideLegalMoves(e){Array.from(e.getElementsByClassName("legal-move-hint")).forEach((function(e){e.style.display="none"}))},L=n("./chessboard/src/components/chessboard/standalone/shared/helpers/position.helpers.js"),x=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),F=n.n(x),B=n("./node_modules/@babel/runtime/helpers/createClass.js"),U=n.n(B),V=[];function animUpdate(e,t){Object.keys(e.fromValues).forEach((function(n){var r=e.fromValues[n],o=e.toValues[n];e.updatedValues[n]=(o-r)*t+r})),e.onUpdate&&e.onUpdate(e.updatedValues)}function animLoop(e){V.forEach((function(t,n){var r=0;t.startTime<0?(t.startTime=e,t.onStart&&t.onStart()):(r=(e-t.startTime)*t.durationRatio)>1&&(r=1),animUpdate(t,r),1===r&&(t.onEnd&&t.onEnd(),V.splice(n,1))})),V.length&&requestAnimationFrame(animLoop)}var K=function(){function Animation(e){F()(this,Animation),this.fromValues=e.from||null,this.toValues=e.to||null,this.updatedValues={},this.startTime=-1,this.durationRatio=e.duration?1/(1e3*e.duration):0,this.onStart=e.onStart||null,this.onUpdate=e.onUpdate||null,this.onEnd=e.onEnd||null}return U()(Animation,[{key:"start",value:function start(){V.push(this),1===V.length&&requestAnimationFrame(animLoop)}}],[{key:"endAll",value:function endAll(){V.forEach((function(e){animUpdate(e,1),e.onEnd&&e.onEnd()})),V.length=0}}]),Animation}(),q=function movePieces(e,t,n,r){Array.from(e.getElementsByClassName("piece")).map((function(e){var t=r.pieces.findIndex((function(t){return t.key===e.id}));return{domPiece:e,fromFileRank:Object(L.b)(e.className),toFileRank:-1!==t?{file:r.pieces[t].file,rank:r.pieces[t].rank}:null}})).filter((function(e){return null!==e.toFileRank})).forEach((function(e){var o=i(e.fromFileRank,n.options.flipBoard,n.options.pieceStyle),a=i(e.toFileRank,n.options.flipBoard,n.options.pieceStyle);r.animationSpeed>0?new K({duration:r.animationSpeed,from:{x:o.x,y:o.y},to:{x:a.x,y:a.y},onStart:function onStart(){e.domPiece.style.zIndex=3},onUpdate:function onUpdate(t){e.domPiece.style.transform="translate3d(".concat(t.x,"%, ").concat(t.y,"%, 0)")},onEnd:function onEnd(){w(e.domPiece,e.toFileRank)}}).start():w(e.domPiece,e.toFileRank);t(u.a.PIECE_MOVED,{to:e.toFileRank,id:e.domPiece.id})}))},G=function openPromotionMenu(e,t,n,r){var a=document.getElementById("promotion-menu");a||(!function createPromotionMenu(e,t,n){var r=document.createDocumentFragment(),a=document.createElement("div");a.classList.add("promotion-menu"),a.id="promotion-menu",a.style.height="".concat(Math.round(4.3*t.board.squareSize),"px"),a.style.width="".concat(t.board.squareSize,"px"),a.addEventListener(C,(function clickHandler(e){e.preventDefault(),e.stopPropagation();var t=e.toElement||e.relatedTarget||e.target;return"promotion-close"===t.id?n.close():n.select(t.getAttribute("data-type"))}));var i=document.createElement("i");i.className="icon-x close-button icon-font-chess x",i.id="promotion-close",i.style.order=4,a.appendChild(i),["q","n","r","b"].map((function(e,n){var r=document.createElement("div");return r.classList.add("promotion-piece"),r.setAttribute("data-type",e),r.style.backgroundImage=o({color:1,type:e},Object(c.c)(t.options.pieceStyle,150)),r.style.order=n,r.style.width="".concat(t.board.squareSize,"px"),r.style.height="".concat(t.board.squareSize,"px"),r})).forEach((function(e){return a.appendChild(e)})),r.appendChild(a),e.appendChild(r)}(e,t,n),a=document.getElementById("promotion-menu"));var i=t.options.flipBoard?(t.board.files-r.toFileRank.file)*t.board.squareSize:(r.toFileRank.file-1)*t.board.squareSize;t.options.pieceStyle.indexOf("3d")>=0?a.classList.add("pseudo3d"):a.classList.remove("pseudo3d"),a.style.left="".concat(i,"px"),a.setAttribute("data-file",r.toFileRank.file),r.top?a.classList.add("top"):a.classList.remove("top");var s=r.top?["q","n","r","b"]:["b","r","n","q"];Array.from(a.getElementsByClassName("promotion-piece")).forEach((function(e){var n=e.getAttribute("data-type"),a=t.test?"chessboard-promotion-piece-".concat(n):void 0;a&&e.setAttribute("data-test",a),e.style.order=s.indexOf(n),e.style.backgroundImage=o({color:r.piece.color,type:n},Object(c.c)(t.options.pieceStyle,150))})),document.getElementById("promotion-close").style.order=r.top?5:0},z=function pickUpPiece(e,t){if(t){var n=document.getElementById(t.key);n&&(n.classList.add("dragging"),e(u.a.PIECE_PICKED_UP,{id:n.id}))}},H=function removePieces(e,t,n){Array.from(e.getElementsByClassName("piece")).filter((function(e){return-1!==n.pieces.findIndex((function(t){return t.key===e.id}))})).forEach((function(e){var r=e.id;n.fadeTime?(e.style.opacity=1,e.style.transition="opacity ".concat(n.fadeTime,"s"),requestAnimationFrame((function(){e.style.opacity=0,setTimeout((function(){e&&e.parentNode&&e.parentNode.removeChild(e)}),1e3*n.fadeTime)}))):e.parentNode.removeChild(e),t(u.a.PIECE_REMOVED,{id:r})}))},$=function setPieces(e,t,n,r){K.endAll();var o=Array.from(e.getElementsByClassName("piece")),a=r.filter((function(e){return-1===o.findIndex((function(t){return t.id===e.key}))}));l(e,t,n,{pieces:a,fadeTime:.3}),Array.from(e.getElementsByClassName("piece")).map((function(e){var t=r.findIndex((function(t){return t.key===e.id}));return-1===t&&e.parentNode.removeChild(e),{domPiece:e,to:-1!==t?r[t]:null}})).filter((function(e){return null!==e.to})).filter((function(e){return!(n.draggingPiece&&n.draggingPiece.key===e.domPiece.id)})).forEach((function(e){return w(e.domPiece,{file:e.to.file,rank:e.to.rank})}))},W=n("./chessboard/src/components/chessboard/standalone/core/config.js"),Q=function setSquares(e,t,n){var r=Array.from(e.getElementsByClassName("".concat(W.f.MARKED,"-square"))),o=n.filter((function(e){return-1===r.findIndex((function(t){return t.id===e.id}))}));r.filter((function(e){return-1===n.findIndex((function(t){return t.id===e.id}))})).forEach((function(e){return e.parentNode.removeChild(e)})),f(e,t,W.f.MARKED,o)},Y=function showHoverSquare(e,t){var n=t.state,r=t.coords;if(n.options.highlightLegalMoves){var o=Object(L.a)(Object(L.c)(r,e,n.board.files,n.board.ranks,n.options.flipBoard)),a={id:"hover-square",file:o.file,rank:o.rank};D(e,"hover"),f(e,n,"hover",[a])}},J=n("./core/utils/features/index.js"),Z=n("./core/utils/features/constants.js"),X=function updateBoardImage(e,t){var n="url('".concat(Object(c.b)(t.options.boardStyle,Object(J.a)(Z.a.OLD_BOARD_IMAGE_SIZE_150)?150:75),"') 0% 0% / 100% 100% no-repeat");t.options.overlayInAnalysisMode&&t.gameSettings.analysis&&(n="\n      linear-gradient(rgba(255, 255, 255, 0.2),\n      rgba(255, 255, 255, 0.2)) 0% 0% / 100% 100%,\n      ".concat(n,"\n    ")),e.style.background=n},ee=function updateBoardSize(e,t){e.style.width="".concat(t.board.size,"px"),e.style.height="".concat(t.board.size,"px"),e.style.backgroundSize="".concat(t.board.size,"px ").concat(t.board.size,"px")},te=function updatePieceImages(e,t){var n=Object(c.c)(t.options.pieceStyle,150),o=t.options.pieceStyle.indexOf("3d")>=0;Array.from(e.querySelectorAll(".piece")).forEach((function(e){var t=Object(r.c)(e.style.backgroundImage);o&&e.setAttribute("piece-style","pseudo3d"),e.style.backgroundImage="url('".concat(n).concat(t,".png')")}))},ne=function updatePromotionMenuSize(e,t){var n=e.querySelector("#promotion-menu");if(n){n.style.height="".concat(Math.round(4.3*t.board.squareSize),"px"),n.style.width="".concat(t.board.squareSize,"px");var r=parseInt(n.getAttribute("data-file"),10),o=t.options.flipBoard?(t.board.files-r)*t.board.squareSize:(r-1)*t.board.squareSize,a=t.options.pieceStyle.indexOf("3d")>=0;n.style.left="".concat(o,"px"),Array.from(e.getElementsByClassName("promotion-piece")).forEach((function(e){e.style.width="".concat(t.board.squareSize,"px"),e.style.height="".concat(t.board.squareSize,"px"),a&&(e.style.backgroundSize="".concat(t.board.squareSize,"px ").concat(t.board.squareSize,"px"))}))}}},"./chessboard/src/components/chessboard/standalone/extensions/usersnap-logger/index.js":function(e,t,n){"use strict";var r=n("./utils/sentry/set-sentry-context.js"),o=n("./chessboard/src/components/chessboard/standalone/core/config.js"),a=n("./chessboard/src/components/chessboard/standalone/core/actions/index.js"),i=n("./chessboard/src/components/chessboard/standalone/default/dom/events.js");t.a=function(e){var t=e.on,n=e.state;if(window.Raven){var s=Date.now(),c=[],u=0;Object.keys(o.c).forEach((function(e){t(e,(function(t){return addChessboardEvent("Emit: ".concat(e),t)}))})),Object.values(i.a).forEach((function(e){t(e,(function(t){return addChessboardEvent("DOM Event: ".concat(e),t)}))})),Object.keys(o.b).forEach((function(e){t(e,(function(t){return addChessboardEvent("Command: ".concat(e),t)}))})),Object.values(a.b).forEach((function(e){t("action-".concat(e),(function(t){return addChessboardEvent("Action: ".concat(e),t)}))})),t(o.a.HISTORY_CHANGE,(function(e){e.slice(u).forEach((function(e){return addChessboardEvent("API History Event",e)})),u=e.length-1})),t(o.c.OPTIONS_CHANGED,(function(){Object(r.setSentryContext)({chessboardOptions:undefined})}))}function addChessboardEvent(e,t){c.unshift({timestamp:Date.now()-s,type:e,data:t}),c.length>50&&c.pop(),Object(r.setSentryContext)({chessboardEvents:c,chessboardState:n})}}},"./chessboard/src/components/chessboard/standalone/shared/config/style.config.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r={default:["#B58863","#F0D9B5",null,".png","#ffff33"],"8_bit":["#6a9b41","#f3f3f4","8_bit",".png","#ffff33"],bases:["#c26b38","#efcca1","bases",".jpg","#f5cc2a"],blue:["#4D6D92","#ECECD7","blue",".png","#00a5ff"],brown:["#B58863","#F0D9B5","brown",".png","#ffff33"],bubblegum:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],burled_wood:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],dark_wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],dash:["#6b3a27","#bd9257","dash",".jpg","#eca722"],glass:["#282f3f","#667188","glass",".png","#5b91b3"],graffiti:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],green:["#779952","#edeed1","green",".png","#ffff33"],icy_sea:["#7a9db2","#c5d5dc","icy_sea",".jpg","#5ed7f1"],light:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],lolz:["#909898","#e0e9e9","lolz",".jpg","#a3becd"],marble:["#706b66","#c7bdaa","marble",".jpg","#f0db86"],metal:["#6e6e6e","#c9c9c9","metal",".jpg","#a3becd"],nature:["#8c976e","#c3d1a4","translucent",".png","#eef396"],neon:["#636363","#b9b9b9","neon",".png","#6d90a6"],newspaper:["#5a5956","#5a5956","newspaper",".jpg","#99976e"],orange:["#D08B18","#FCE4B2","orange",".png","#ffff33"],overlay:["#789ebd","#4878a0","overlay",".png","#0d9acf"],parchment:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],purple:["#8877B7","#EFEFEF","purple",".png","#7dacc9"],red:["#BA5546","#F0D8BF","red",".png","#f8f893"],sand:["#b8a590","#e5d3c4","sand",".jpg","#e2bc87"],sky:["#c2d7e2","#efefef","sky",".png","#65daf7"],stone:["#666463","#c8c3bd","stone",".jpg","#36525f"],tan:["#D08B18","#FCE4B2","tan",".png","#f7d84a"],tournament:["#316549","#ebece8","tournament",".jpg","#a4c25b"],translucent:["#667188","#282f3f","translucent",".png","#5b91b3"],walnut:["#835f42","#c0a684","walnut",".jpg","#d1a52d"],wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],grey:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],pink:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],natural:["#D08B18","#FCE4B2","tan",".png","#f0e464"],winboard:["#316549","#ebece8","tournament",".jpg","#a4c25b"],blackwhite:["#667188","#282f3f","translucent",".png","#5b91b3"],marbleblue:["#c2d7e2","#efefef","marbleblue",".jpg","#65daf7"],marblebrown:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],marblegreen:["#706b66","#c7bdaa","marblegreen",".jpg","#f0db86"],wooddark:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],woodlight:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],woodmid:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],woodolive:["#6e6e6e","#c9c9c9","woodolive",".jpg","#a3becd"]},o={modern2:{imgPath:"modern",imgFormat:".png"},lines:{imgPath:"alpha",imgFormat:".png"},"3dwood":{imgPath:"3d_wood",imgFormat:".png"},"3dplastic":{imgPath:"3d_plastic",imgFormat:".png"},"3dchesskid":{imgPath:"3d_chesskid",imgFormat:".png"}}},"./chessboard/src/components/chessboard/standalone/shared/dom/update-board-classes.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function updateBoardClasses(e,t){var n={disabled:!t.enabled,flipped:t.flipBoard,rounded:t.rounded};Object.keys(n).forEach((function(t){return n[t]?e.classList.add(t):e.classList.remove(t)}))}},"./chessboard/src/components/chessboard/standalone/shared/formatters/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return _}));var r=function boardDimensions(e,t){return Object.assign(e.parentNode.getBoundingClientRect(),{aspectRatio:t})},o=(n("./chessboard/src/game/index.js"),n("./chessboard/src/game/history.js")),a=n("./chessboard/src/game/line.js"),i=function changePosition(e,t){var n=e.setup.legalMoves;e.settings.analysis||e.setup.sideToMove===e.setup.playingAs||(n=e.settings.premoves&&e.premoves&&e.premoves.length<8&&e.setup.legalPremoves&&e.setup.legalPremoves.length>0?e.setup.legalPremoves:[]);var r=-1!==[o.a.INIT,o.a.LOAD].indexOf(e.history?e.history[e.history.length-1].type:null);return{animate:!r,isCheck:e.setup.check,isCheckmate:e.setup.checkmate,loaded:r,legalMoves:n,markings:e.markings,pieces:e.premoves&&e.premoves.length&&a.a.isHead(e.tree.lines||t,e.tree.selected)?e.premoves.slice(-1)[0].pieces:e.setup.pieces,premoves:e.premoves.map((function(e){return e.move})),previousPieces:[],playingAs:e.setup.playingAs,playSound:!r,selectedNode:e.tree.selectedNode,sideToMove:e.setup.sideToMove}},s=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),c=n.n(s);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=function updateMarkings(e,t){return _objectSpread(_objectSpread({},t),{},{premoves:e.settings.premoves?e.premoves:null})},l=n("./chessboard/src/components/chessboard/standalone/shared/helpers/position.helpers.js");function click_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function click_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?click_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):click_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function getClickFormatter(e){return function(t,n,r){var o=e(t,n,r),a=Object(l.f)(t,n),i=Object(l.e)(a,o.file,o.rank,r.board.files,r.board.ranks,r.board.isFlipped);return click_objectSpread(click_objectSpread(click_objectSpread({altKey:t.altKey},o),a),i)}};function right_click_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function right_click_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?right_click_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):right_click_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=function getKey(e){return e.altKey?"alt":e.shiftKey?"shift":e.ctrlKey?"ctrl":"default"},p=function getRightClickFormatter(e){return function(t,n,r){return right_click_objectSpread(right_click_objectSpread({},e(t,n,r)),{},{key:f(t)})}},m=function dragMove(e,t,n){var r=Object(l.f)(e,t);return Object(l.a)(r,n.board.files,n.board.ranks)};function drag_start_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function drag_start_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?drag_start_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):drag_start_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h=function getDragStartFormatter(e){return function(t,n,r){var o=e(t,n,r),a=Object(l.f)(t,n);if(!Object(l.g)(o,r.board.files,r.board.ranks))return null;var i=Object(l.e)(a,o.file,o.rank,r.board.files,r.board.ranks,r.board.isFlipped);return drag_start_objectSpread(drag_start_objectSpread(drag_start_objectSpread(drag_start_objectSpread({},o),a),i),{},{isRightClick:t.isRightClick})}};function drag_stop_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function drag_stop_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?drag_stop_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):drag_stop_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g=function getDragStopFormatter(e){return function(t,n,r){return drag_stop_objectSpread(drag_stop_objectSpread({},e(t,n,r)),{},{altKey:t.altKey,isRightClick:t.isRightClick})}},b=function keydown(e,t){var n=e.keyCode;return 38!==n&&40!==n||!t||e.preventDefault(),n};function pointerdown_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pointerdown_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pointerdown_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pointerdown_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function getPointerdownFormatter(e){return function(t,n,r){var o=e(t,n,r);if(!Object(l.g)(o,r.board.files,r.board.ranks))return null;var a=Object(l.f)(t,n);return pointerdown_objectSpread(pointerdown_objectSpread(pointerdown_objectSpread({},o),a),{},{isRightClick:t.isRightClick,altKey:t.altKey})}};function pointerup_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pointerup_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pointerup_ownKeys(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pointerup_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=function getPointerupFormatter(e){return function(t,n,r){var o=e(t,n,r),a=Object(l.f)(t,n);return pointerup_objectSpread(pointerup_objectSpread(pointerup_objectSpread({},o),a),{},{isRightClick:t.isRightClick})}},_=function getDomFormatters(e){return{click:d(e),rightClick:p(e),dragMove:m,dragStart:h(e),dragStop:g(e),keydown:b,pointerdown:v(e),pointerup:E(e)}}},"./chessboard/src/components/chessboard/standalone/shared/helpers/misc.helpers.js":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var r=function getColorFromNumeric(e){return 1===e?"w":"b"},o=function getShortStringFromUrl(e){return e.replace("url(","").replace(")","").replace(/"/g,"").slice(-6,-4)},a=function cssHexToNumber(e){var t=e.replace("#","");return 3===e.length&&(t="".concat(t[0]).concat(t[0]).concat(t[1]).concat(t[1]).concat(t[2]).concat(t[2])),parseInt(t,16)}},"./chessboard/src/components/chessboard/standalone/shared/helpers/position.helpers.js":function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return l}));var r=n("./chessboard/src/components/chessboard/standalone/core/utils.js"),o=function isInsideBoard(e,t,n){return Object(r.g)(e)?e.file>0&&e.file<t+1&&e.rank>0&&e.rank<n+1:null},a=function getCoordsInsideBoard(e,t,n){var r={};return void 0!==e.file?(r.file=Math.max(e.file,1),r.file=Math.min(r.file,t||8),r.rank=Math.max(e.rank,1),r.rank=Math.min(r.rank,n||8)):void 0!==e.x&&(r.x=Math.max(e.x,0),r.x=Math.min(r.x,e.boardRect.width),r.y=Math.max(e.y,0),r.y=Math.min(r.y,e.boardRect.height),r.boardRect=e.boardRect),r},i=function getXYFromEvent(e,t){var n,r,o=t.getBoundingClientRect(),a=0;return e.touches&&e.pointer?(n=e.pointer.x,r=e.pointer.y,a=Number(window.scrollY||0)):e.touches&&e.touches[0]?(n=e.touches[0].clientX,r=e.touches[0].clientY):(n=e.clientX,r=e.clientY),{x:n-o.left,y:r-(o.top+a),boardRect:o}},s=function getSquareOffset(e,t,n,r,o,a){var i=e.boardRect.width/o,s=a?(8-t)*i:(t-1)*i,c=a?(n-1)*i:(8-n)*i;return{offsetX:e.x-s,offsetY:e.y-c}},c=function getFileRankFromCoords(e,t,n,r,o){var a=e.boardRect.width/r,i=Math.floor(e.x/a),s=Math.floor(e.y/a);return{file:o?n-i:i+1,rank:o?s+1:r-s}},u=function getFileRankFromMouseEvent(e,t,n){return function getFileRankFromEvent(e,t,n,r,o){return c(i(e,t),t,n,r,o)}(e,t,n.board.files,n.board.ranks,n.options.flipBoard)},l=function getFileRankFromClassName(e){var t=e.match(/square-(\d+)/);if(!t)return null;var n=t[1].match(/.{1,2}/g).map((function(e){return parseInt(e,10)}));return{file:n[0],rank:n[1]}}},"./chessboard/src/components/chessboard/standalone/shared/helpers/style.helpers.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"e",(function(){return d}));var r=n("./chessboard/src/components/config.js"),o=n("./chessboard/src/components/chessboard/standalone/shared/config/style.config.js"),a=function getPieceScheme(e){return o.b[e]?o.b[e]:{imgPath:e,imgFormat:".png"}},i=new Array(76).join().split(",").map((function(e,t){return 2*t})).slice(22),s=function getAdjustedSize(e){var t=function isHighRes(){return window.devicePixelRatio>1}()?2*e:e;return i.reduceRight((function(e,n){return n===t||n>t?n:e}))},c=function getBoardBackground(e,t){var n=function getBoardScheme(e){return o.a[e]}(e),a=s(t);return"".concat(r.a.paths.boards,"/").concat(n[2],"/").concat(a).concat(n[3])},u=function getPieceBaseUrl(e,t){var n=a("real3d"!==e?e:"neo"),o=s(t);return"".concat(r.a.paths.pieces,"/").concat(n.imgPath,"/").concat(o,"/")},l=function getWebglDataBaseUrl(e){return"".concat(r.a.paths.webglData,"/").concat(e,"/")},d="webkitTransform"in document.body.style?"webkitTransform":"transform"},"./chessboard/src/components/chessboard/standalone/shared/mixins/chessboard.mixin.js":function(e,t,n){"use strict";var r=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=n.n(r),a=n("./chessboard/src/game/utils.js"),i=n("./chessboard/src/game/history.js"),s=n("./chessboard/src/components/chessboard/ChessEvents.js"),c=n("./chessboard/src/components/chessboard/ChessSounds/index.js"),u=n("./web/core/api/move-list/move-list.js"),l=n("./chessboard/src/components/chessboard/standalone/core/config.js"),d=n("./chessboard/src/components/chessboard/standalone/core/actions/index.js"),f=n("./chessboard/src/components/chessboard/standalone/shared/formatters/index.js");t.a={props:{boardId:{type:String,default:a.a.getId()},extensions:{type:Object,default:function _default(){return{}}},game:{type:Object,required:!0},options:{type:Object,default:function _default(){return{}}},resizeModifier:{type:Object,default:function _default(){return{x:0,y:0}}},handleWindowResize:{type:Boolean,default:!0}},data:function data(){return{arrows:[],customItems:[],effects:[],initialized:!1,squareSize:0,moveList:u.default.state,actionsQueue:[]}},mounted:function mounted(){var e=this;this.createChessboard().then((function(t){var n;e.initialized=!0,Object.defineProperty(e,"chessboard",{value:t,writable:!0,enumerable:!0,configurable:!1}),e.actionsQueue.forEach((function(t){var n=t.action,r=t.params;e.chessboard.dispatch(n,r)})),e.actionsQueue.length=0,e.chessboard.dispatch(d.b.UPDATE_GAME_SETTINGS,e.game.settings),e.chessboard.dispatch(d.b.UPDATE_OPTIONS,e.options),e.chessboard.dispatch(d.b.RESIZE_BOARD,e.getBoardParentBoundingRect()),e.chessboard.dispatch(d.b.CHANGE_POSITION,f.b(e.game,e.moveList.lines)),e.squareSize=e.chessboard.state.board.squareSize,e.$emit("chessboard-boardInitialized",!0),e.$emit("chessboard-mounted"),e.chessboard.on(l.c.CLICKED,(function(t){e.$emit("chessboard-clickOnFileRank",{file:t.file,rank:t.rank})})),e.chessboard.on(l.c.ARROW_CLEARED,(function(t){e.$emit("chessboard-clearArrow",t)})),e.chessboard.on(l.c.ARROW_MARKED,(function(t){e.$emit("chessboard-markArrow",t)})),e.chessboard.on(l.c.BOARD_DIMENSIONS_SET,(function(){e.squareSize=e.chessboard.state.board.squareSize,e.$emit("chessboard-resized",e.squareSize)})),e.chessboard.on(l.c.BUSY_FLAG,(function(t){e.$emit("chessboard-busyFlag",t)})),e.chessboard.on(l.c.CANCEL_PREMOVES,(function(){e.$emit("chessboard-cancelPremoves")})),e.chessboard.on(l.c.CANCEL_GTM,(function(){e.$emit("chessboard-cancelGuessTheMove")})),e.chessboard.on(l.c.EFFECT_CLEARED,(function(t){e.$emit("chessboard-clearEffect",t)})),e.chessboard.on(l.c.EFFECT_MARKED,(function(t){e.$emit("chessboard-markEffect",t)})),e.chessboard.on(l.c.MARKINGS_CLEARED,(function(){e.$emit("chessboard-clearMarkings")})),e.chessboard.on(l.c.MOVE_MADE,(function(t){e.$emit("chessboard-makeMove",t)})),e.chessboard.on(l.b.SET_ARROWS,(function(t){e.arrows=o()(t)})),e.chessboard.on(l.b.SET_EFFECTS,(function(t){e.effects=o()(t)})),e.chessboard.on(l.b.SET_CUSTOM_ITEMS,(function(t){e.customItems=o()(t)})),e.chessboard.on(l.c.SQUARE_CLEARED,(function(t){e.$emit("chessboard-clearSquare",t)})),e.chessboard.on(l.c.SQUARE_MARKED,(function(t){e.$emit("chessboard-markSquare",t)})),e.chessboard.on(l.c.MOVE_BACKWARD,(function(){e.$emit("chessboard-moveBackward")})),e.chessboard.on(l.c.MOVE_FORWARD,(function(){e.$emit("chessboard-moveForward")})),e.chessboard.on(l.c.MOVE_TO_END,(function(){e.$emit("chessboard-moveToEnd")})),e.chessboard.on(l.c.MOVE_TO_START,(function(){e.$emit("chessboard-moveToStart")})),e.chessboard.on(l.c.KEY_PRESS,(function(t){88===t&&e.$emit("chessboard-flipBoard")})),e.options.playSounds&&(n=new c.a(e.options.soundTheme)),e.chessboard.on(l.c.OPTIONS_CHANGED,(function(e){void 0!==e.soundTheme&&(n&&n.removeAll(),n=new c.a(e.soundTheme))})),e.chessboard.on(l.b.PLAY_SOUND,(function(e){null!==e&&n&&n.play(e)}));var r=e.getDomFormatters();new s.a(e.$el).observe({click:function onClick(t){return document.activeElement!==e.$el&&e.$el.focus(),e.chessboard.dispatch(d.b.CLICK,r.click(t,e.$el,e.chessboard.state))},dragcancel:function onDragCancel(){return e.chessboard.dispatch(d.b.DRAG_CANCEL)},dragmove:function onDragMove(t){return e.chessboard.dispatch(d.b.DRAG_MOVE,r.dragMove(t,e.$el,e.chessboard.state))},dragstart:function onDragStart(t){return e.chessboard.dispatch(d.b.DRAG_START,r.dragStart(t,e.$el,e.chessboard.state))},dragstop:function onDragStop(t){return e.chessboard.dispatch(d.b.DRAG_STOP,r.dragStop(t,e.$el,e.chessboard.state))},pointerdown:function onPointerDown(t){return e.chessboard.dispatch(d.b.POINTERDOWN,r.pointerdown(t,e.$el,e.chessboard.state))},pointerup:function onPointerUp(t){return e.chessboard.dispatch(d.b.POINTERUP,r.pointerup(t,e.$el,e.chessboard.state))},rightclick:function onRightClick(t){return e.chessboard.dispatch(d.b.RIGHT_CLICK,r.rightClick(t,e.$el,e.chessboard.state))}});var a=function disableMovesOnArrowKeys(){return document.removeEventListener("keydown",e.onKeydown)},i=function enableMovesOnArrowKeys(){return document.addEventListener("keydown",e.onKeydown)};window.addEventListener("message",(function(e){var t=e.data;t===l.c.ANOTHER_CHESSBOARD_ONBLUR?i():t===l.c.ANOTHER_CHESSBOARD_ONFOCUS&&a()})),i(),e.chessboard.on("destroy",a),e.handleWindowResize&&(window.addEventListener("resize",e.resizeBoard),e.chessboard.on("destroy",(function(){window.removeEventListener("resize",e.resizeBoard)})))}))},destroy:function destroy(){this.chessboard&&this.chessboard.emit("destroy")},computed:{historyLength:function historyLength(){return this.game.history.length},positionChanged:function positionChanged(){return{fen:this.game.setup.fen,isPremove:this.game.premoves.length,check:this.game.setup.check,checkmate:this.game.setup.checkmate,sideToMove:this.game.setup.sideToMove,playingAs:this.game.setup.playingAs}},legalMovesChanged:function legalMovesChanged(){return{legalMoves:this.game.setup.legalMoves,legalPremoves:this.game.setup.legalPremoves}}},watch:{"game.id":function watchGameId(){this.dispatch(d.b.CHANGE_POSITION,f.b(this.game,this.moveList.lines))},historyLength:function watchHistoryLength(){this.chessboard&&this.chessboard.emit(l.a.HISTORY_CHANGE,this.game.history)},positionChanged:function watchPositionChanged(e,t){i.b.getLastItem(this.game.history).type===i.a.LOAD&&this.dispatch(d.b.RESET_BOARD_STATE),e.fen===t.fen&&e.isPremove===t.isPremove&&e.check===t.check&&e.checkmate===t.checkmate&&e.markingSquares===t.markingSquares&&e.markingArrows===t.markingArrows&&e.sideToMove===t.sideToMove&&e.playingAs===t.playingAs||this.dispatch(d.b.CHANGE_POSITION,f.b(this.game,this.moveList.lines))},legalMovesChanged:function watchLegalMoves(){this.dispatch(d.b.UPDATE_LEGAL_MOVES,f.b(this.game,this.moveList.lines))},"game.markings.arrows":function watchGameMarkingsArrows(){this.dispatch(d.b.UPDATE_MARKINGS,f.d(this.game,this.game.markings))},"game.markings.effects":function watchGameMarkingsEffects(){this.dispatch(d.b.UPDATE_MARKINGS,f.d(this.game,this.game.markings))},"game.markings.squares":function watchGameMarkingsSquares(){this.dispatch(d.b.UPDATE_MARKINGS,f.d(this.game,this.game.markings))},"game.markings.blinkingSquares":function watchGameMarkingsBSquares(){this.dispatch(d.b.UPDATE_MARKINGS,f.d(this.game,this.game.markings))},"options.maxWidth":function watchMaxWidth(){this.dispatch(d.b.SET_BOARD_DIMENSIONS,f.a(this.$el,this.aspectRatio))},"game.settings":{handler:function watchSettings(){this.dispatch(d.b.UPDATE_GAME_SETTINGS,this.game.settings)},deep:!0},options:{handler:function watchBoardOptions(e){this.dispatch(d.b.UPDATE_OPTIONS,e)},deep:!0}},methods:{createChessboard:function createChessboard(){throw new Error('You must override the "createChessboard" method in child component!')},dispatch:function dispatch(e,t){this.initialized?this.chessboard.dispatch(e,t):this.actionsQueue.push({action:e,params:t})},getDomFormatters:function getDomFormatters(){throw new Error('You must override the "getDomFormatters" method in child component!')},getBoardParentBoundingRect:function getBoardParentBoundingRect(){var e=this.$el.parentNode.getBoundingClientRect(),t=e.height,n=e.width;return{aspectRatio:this.aspectRatio,width:n-(this.resizeModifier.x||0),height:t-(this.resizeModifier.y||0)}},onKeydown:function onKeydown(e){var t=this.getDomFormatters();return this.chessboard.dispatch(d.b.KEY_DOWN,t.keydown(e,this.options.enabled&&this.options.captureKeyStrokes))},resizeBoard:function resizeBoard(){this.$el&&this.$el.parentNode&&this.chessboard.dispatch(d.b.RESIZE_BOARD,this.getBoardParentBoundingRect())}}}},"./chessboard/src/components/chessboard/style/style.config.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r={default:["#B58863","#F0D9B5",null,".png","#ffff33"],"8_bit":["#6a9b41","#f3f3f4","8_bit",".png","#ffff33"],bases:["#c26b38","#efcca1","bases",".jpg","#f5cc2a"],blue:["#4D6D92","#ECECD7","blue",".png","#00a5ff"],brown:["#B58863","#F0D9B5","brown",".png","#ffff33"],bubblegum:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],burled_wood:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],dark_wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],dash:["#6b3a27","#bd9257","dash",".jpg","#eca722"],glass:["#282f3f","#667188","glass",".png","#5b91b3"],graffiti:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],green:["#779952","#edeed1","green",".png","#ffff33"],icy_sea:["#7a9db2","#c5d5dc","icy_sea",".jpg","#5ed7f1"],light:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],lolz:["#909898","#e0e9e9","lolz",".jpg","#a3becd"],marble:["#706b66","#c7bdaa","marble",".jpg","#f0db86"],metal:["#6e6e6e","#c9c9c9","metal",".jpg","#a3becd"],nature:["#8c976e","#c3d1a4","translucent",".png","#eef396"],neon:["#636363","#b9b9b9","neon",".png","#6d90a6"],newspaper:["#5a5956","#5a5956","newspaper",".jpg","#99976e"],orange:["#D08B18","#FCE4B2","orange",".png","#ffff33"],overlay:["#789ebd","#4878a0","overlay",".png","#0d9acf"],parchment:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],purple:["#8877B7","#EFEFEF","purple",".png","#7dacc9"],red:["#BA5546","#F0D8BF","red",".png","#f8f893"],sand:["#b8a590","#e5d3c4","sand",".jpg","#e2bc87"],sky:["#c2d7e2","#efefef","sky",".png","#65daf7"],stone:["#666463","#c8c3bd","stone",".jpg","#36525f"],tan:["#D08B18","#FCE4B2","tan",".png","#f7d84a"],tournament:["#316549","#ebece8","tournament",".jpg","#a4c25b"],translucent:["#667188","#282f3f","translucent",".png","#5b91b3"],walnut:["#835f42","#c0a684","walnut",".jpg","#d1a52d"],wood:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],grey:["#aaaaaa","#dcdcdc","light",".png","#a4b8c4"],pink:["#f9cdd3","#fff3f3","bubblegum",".png","#de5d6f"],natural:["#D08B18","#FCE4B2","tan",".png","#f0e464"],winboard:["#316549","#ebece8","tournament",".jpg","#a4c25b"],blackwhite:["#667188","#282f3f","translucent",".png","#5b91b3"],marbleblue:["#c2d7e2","#efefef","marbleblue",".jpg","#65daf7"],marblebrown:["#b96f18","#aeaeae","graffiti",".jpg","#f39011"],marblegreen:["#706b66","#c7bdaa","marblegreen",".jpg","#f0db86"],wooddark:["#895132","#d9b088","burled_wood",".jpg","#ee9016"],woodlight:["#B58863","#F0D9B5","parchment",".jpg","#d8cc66"],woodmid:["#8d675e","#e7cdb2","dark_wood",".jpg","#cc9122"],woodolive:["#6e6e6e","#c9c9c9","woodolive",".jpg","#a3becd"]},o={modern2:{imgPath:"modern",imgFormat:".png"},lines:{imgPath:"alpha",imgFormat:".png"},"3dwood":{imgPath:"3d_wood",imgFormat:".png"},"3dplastic":{imgPath:"3d_plastic",imgFormat:".png"},"3dchesskid":{imgPath:"3d_chesskid",imgFormat:".png"}}},"./chessboard/src/components/chessboard/style/style.helpers.js":function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n("./chessboard/src/components/config.js"),o=n("./chessboard/src/components/chessboard/style/style.config.js"),a=function getPieceScheme(e){return o.b[e]?o.b[e]:{imgPath:e,imgFormat:".png"}},i=new Array(76).join().split(",").map((function(e,t){return 2*t})).slice(22),s=function getAdjustedSize(e){var t=function isHighRes(){return window.devicePixelRatio>1}()?2*e:e;return i.reduceRight((function(e,n){return n===t||n>t?n:e}))},c=function getBoardBackground(e,t){var n=function getBoardScheme(e){return null==e||null==o.a[e]?o.a.default:o.a[e]}(e),a=s(t);return"".concat(r.a.paths.boards,"/").concat(n[2],"/").concat(a).concat(n[3])},u=function getPieceBaseUrl(e,t){var n=a("real3d"!==e?e:"neo"),o=s(t);return"".concat(r.a.paths.pieces,"/").concat(n.imgPath,"/").concat(o,"/")}},"./chessboard/src/components/config.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r="//images.chesscomfiles.com",o={paths:{boards:"".concat(r,"/chess-themes/boards"),pieces:"".concat(r,"/chess-themes/pieces"),sounds:"".concat(r,"/chess-themes/sounds"),variants:"//betacssjs.chesscomfiles.com/bundles/web/images/variants",webglData:"/bundles/web/images/webgl_data"},defaultBoardOptions:{boardStyle:"green",pieceStyle:"neo",highlightColor:"#FFFF33",highlightOpacity:.5,arrowColor:"rgb(255, 168, 0)",flipped:!1,files:8,ranks:8}}},"./chessboard/src/game/api/premoves/index.js":function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var r=n("./chessboard/src/game/history.js"),o=n("./chessboard/src/game/game.lib.js"),a=n("./chessboard/src/game/game.premoves.lib.js"),i=n("./chessboard/src/game/state.js"),s=n("./chessboard/src/game/api/select-node.js"),c=n("./chessboard/src/game/line.js"),u=function makePremove(e,t){var n=o.a.getJCEMove(e,t);return null===n?(r.b.add(e.history,r.a.ILLEGAL_MOVE),e):c.a.isHead(e.jce._lines(),e.tree.selected)||e.settings.analysis?e.settings.analysis?void 0:(a.a.premove(e,n)?(r.b.add(e.history,r.a.PREMOVE),i.a.updateState(e)):r.b.add(e.history,r.a.ILLEGAL_MOVE),e):Object(s.a)(e,c.a.getHeadIds(e.jce._lines(),e.tree.selected.line))},l=function cancelPremoves(e){return a.a.cancelPremoves(e)&&(r.b.add(e.history,r.a.CANCEL_PREMOVES),i.a.updateState(e)),e},d=function consumePremove(e){return e.premoves.length?(a.a.consumePremove(e)?(r.b.add(e.history,r.a.MAKE_MOVE),i.a.updateState(e)):l(e),e):e}},"./chessboard/src/game/api/select-node.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./chessboard/src/game/game.lib.js"),i=n("./chessboard/src/game/line.js"),s=n("./chessboard/src/game/history.js"),c=n("./chessboard/src/game/state.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=function selectNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=i.a.findNode(e.jce._lines(),t,n,r),u=_objectSpread({},e.tree.selected),l=u.line,d=u.move;if(!o)return e;var f={};return f=t.move+n<0&&t.line===o.ids.line?{line:0,move:-1}:o.ids,a.a.selectNode(e,f),s.b.add(e.history,s.a.JUMP_TO_POSITION,{from:{line:l,move:d},to:f}),c.a.updateState(e)}},"./chessboard/src/game/api/set-hand.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("./chessboard/src/game/state.js");var r={p:1,n:32,b:256,r:2048,q:16384},o=function setHand(e,t,n){return e.jce._hand[t]=n.split("").reduce((function(e,t){return e+r[t]}),0),e.setup.hand=e.jce.hand(),e}},"./chessboard/src/game/engine/JCE.js":function(e,t,n){"use strict";var r,o,a,i=n("./node_modules/@babel/runtime/helpers/typeof.js"),s=n.n(i),c=(r=function(){var e=[[2637767806,863464769],[720845184,95069639],[1155203408,610415943],[2618685246,1655139042],[1971536997,1218186377],[848342074,540017087],[263957791,1627660921],[3896152207,4076560586],[226391645,1484086288],[436746274,3467632685],[2516964848,3797861296],[3491888988,3510251221],[1086189917,1248276018],[18044180,1876255637],[1572111136,1190386149],[597658413,2146900428],[97624494,2243205793],[1738507407,1854916977],[1950989311,2149575947],[2098318769,3283594736],[2194108574,2015279052],[4079062812,2500884588],[856979699,2941369318],[1270058469,3877737539],[2858720366,3170717948],[2378012835,1387254795],[2278688587,2178388503],[435406673,3555273441],[3031118064,1655806655],[2063925420,1107589828],[3376753832,436852829],[615148625,1302492416],[1285502018,1963045959],[346460119,1016137793],[2803604355,1176288659],[55085973,2968618255],[1669016372,4287873088],[164740250,1037634196],[896886403,883023163],[1935551383,2764331555],[410153072,4055711755],[533441746,1505690343],[3541084098,3466290517],[3214426080,4267541060],[2675233103,1951705124],[1374411850,3115986997],[1552073989,3684348154],[4244110986,875606593],[844343081,3115990494],[2356462440,135999605],[3116133511,377238503],[2129956651,2197966368],[299173332,3276914047],[1701379241,745972291],[1306570996,254977976],[2530644806,214138461],[1122123979,1667800879],[1831591130,3801192033],[1116211970,920967505],[1594837592,2551651254],[972591349,2046373768],[2479207924,1935030411],[1675376029,2367888248],[3960916618,3935874422],[1398143232,3265801671],[133930885,1520005442],[1351827834,2829577566],[2076951437,2723839804],[435980918,2364847828],[1668970368,3738157273],[2185864314,3993911799],[2041407829,31969768],[346864372,2004703094],[4047877822,3437142421],[3669961416,538399484],[616810829,4190688246],[3144558884,4030272234],[216165387,2513010905],[2761740594,3216997572],[3919406634,4096014649],[669429112,2434161727],[2234904640,3111407601],[1421079802,1598085235],[1924213810,310373675],[4002762044,2067865415],[2592451728,2586110625],[1890340057,4031717877],[4189625662,2577429954],[2276713138,3049850801],[2741429688,3310307512],[2924122950,3426712818],[421576781,1193704381],[2277442246,3030264553],[153237420,595540057],[4278711886,4176286928],[2380848297,4030514510],[2618700582,1303682185],[3018992701,185284845],[957243316,1291916363],[1543415220,1898408169],[504378001,531073412],[2591337657,1692896435],[1333852064,903543556],[1661259930,188168388],[561112646,2197961224],[1536910315,2632972300],[1349168372,2307429186],[411152329,2745631190],[1694697476,1081411140],[3755185459,2631660711],[4019355068,4027326706],[2066937809,3761668332],[3120395808,3878773315],[94890149,2109283191],[3045629038,358812277],[1249184265,3465901047],[3477490924,2308583306],[4114113436,3875911716],[1014604031,1434513279],[3991324799,2222416029],[2040431088,1539915569],[2253613964,4081224332],[2547464012,1611168627],[2722521980,4281500978],[71289574,213969824],[2450408597,903689630],[1894451515,364024012],[1939968537,374938813],[1447259295,3785468557],[4021046128,1664847745],[3139524504,3562928047],[1173487682,4065269608],[2467266804,3907744866],[4284945151,3486998177],[2925674454,1953016432],[3710671816,1271453948],[2129465869,1422863833],[587093076,18243356],[3373793513,2411305257],[2156648078,1791034213],[3737413652,1534461430],[468575139,2935304962],[1129551363,3603256834],[2861996892,1763494778],[2826449619,2465197654],[1704209531,1014895022],[3738359347,3402630390],[569410928,4095796581],[3021312909,2108247612],[2444777957,2664129360],[282063667,3773661258],[682545472,3188439005],[3318488457,1917822038],[1447622272,4045023041],[757420137,4038580915],[2613420942,4146703316],[4012836163,150381244],[2938127093,3428591704],[1208226490,3086335530],[2935205706,1446903363],[430957978,3830532479],[1381578755,3757172800],[4109399782,1596778224],[288855589,1954372339],[3169178148,2256716053],[2644780093,3895892303],[107966643,1071681559],[1304747544,2607225372],[1359190711,1898207171],[3229237120,3273634996],[3027167685,3863637628],[3011615298,2883984519],[564135827,978463264],[770797430,362326607],[1983662611,1907583229],[4153656423,48268960],[3609759233,720080177],[3727911466,1270989899],[200708787,2366086947],[744508026,393422515],[1213261630,65757284],[3485747185,3845951003],[2958861301,1680248217],[2598470344,3163845864],[2767997908,4233451722],[3881113485,1492930166],[1773764017,2764062206],[4189435844,2898689174],[4234838742,1267095035],[2624081078,3302114327],[2395569449,390426320],[1728307101,690284926],[3309827454,1118258254],[2028172868,3888829086],[4271523049,909051386],[146617804,942892565],[2467685867,974297806],[2483428231,503635829],[3743260573,2018222096],[1002067894,2289153437],[3535252974,3738302271],[4154611160,1002664952],[3623154244,2349656961],[3646679180,3524329383],[862933752,4282853607],[2806008282,3272780913],[2734037942,3828874677],[1328176304,2137666995],[2278785213,2780788825],[381286368,1816476193],[2074232908,2316293454],[4087773386,3651330956],[967884669,3728964514],[4239349185,3213509668],[419231360,1463788948],[1275421624,2672384707],[1088456595,436245261],[2365565249,783696577],[1758083333,845223583],[2048846183,3530914274],[2635948261,124738415],[940630937,3069598626],[839474029,1253439921],[902477345,165479306],[2836079689,2681188273],[2007115168,2093139645],[1363041891,1282466609],[1130479818,1063857938],[3644959908,1260430427],[1385135238,46497915],[1386975934,3110156681],[2635987502,4233461619],[1915744629,4117939016],[487743653,285736599],[2049219159,3960249250],[69242857,3908563670],[1511066720,1488527520],[215590039,1703564952],[1459430344,4184955468],[676103291,2642967214],[83799035,3182827979],[1949179493,476101251],[2593534694,1493478716],[2283504289,995211746],[1349412676,3449243940],[2954378677,1878813305],[249149717,3329151870],[1578231917,1483986052],[4135085182,890874990],[461755528,3505523909],[3669622373,634949665],[219487622,2914465301],[2825233742,3703631897],[2479105382,2935590907],[2582097898,3187672881],[1221328648,1843341402],[2140891889,3958868911],[1482849818,345750049],[751922730,3178831411],[3546542069,4036458902],[216179596,877293293],[444615341,3117393729],[2424254530,494454238],[1344234989,3003337991],[929188581,2760877801],[2507911009,1879899982],[980166547,1311840394],[3566535507,1790747461],[143525013,2311336672],[4181962471,4273938872],[1815842366,862009811],[911175674,1179575598],[3591335374,3694215714],[1452686093,3393294272],[385158879,2447709103],[4011414929,1264623507],[1448477120,911094312],[3971299641,2289992053],[3133647265,2234591563],[3007628400,964409938],[1708345684,3673411261],[3031964479,2843021794],[3022128657,2480338599],[118850112,473449293],[2048127371,3202109429],[3158349745,382018770],[1505327237,3807570472],[2568424029,3272693060],[1866609495,3888556537],[844703982,1852802964],[3504617058,682636099],[1448882679,3733580327],[821387540,2215744532],[3631471417,311618895],[2077838877,2383929020],[3352949096,1688694420],[2491080787,3998672444],[3368630402,4182204255],[983299419,2837414346],[3651215291,1033373924],[265429091,3988955082],[3019003608,2896212153],[2955948456,3025235588],[903690197,2266253487],[3925215275,89402958],[3959093811,3609545561],[2455088053,223552128],[3115011301,2133669107],[1765081558,673805649],[3324795129,2111392191],[3443871631,432345706],[3152559950,3425427147],[3699649406,672784944],[3129545774,7668664],[2747044893,173040075],[3925243406,852328481],[164095314,3161868591],[2234471571,1302682825],[2164784335,105893718],[159995093,536831360],[599199451,425051327],[3274759746,1680930461],[1192619331,3903085578],[2832721114,3078660237],[91404660,4030521531],[3044880024,1578375623],[3906596030,754177855],[803516785,1894094672],[288455592,2030430096],[2143232492,2317305324],[388352703,3406060288],[2521731420,3588403719],[1043041227,4028028525],[3195290851,2468913324],[4166724431,3168683191],[1228226538,968516529],[500177583,3444787306],[533367442,4252082053],[4236023256,657816314],[413575568,3367198397],[3435884549,3334062733],[1004255532,1135705894],[2859513268,4170618274],[3914086821,1251487871],[3080761716,3489067886],[3571165255,699353261],[773372954,3648014952],[769693293,2939128604],[3116440923,507748478],[1687629160,3739431776],[2489486648,3502376324],[3686847158,2878383449],[3530767427,902211375],[2121652637,2493976397],[1827477891,930064171],[2549918411,4029725732],[2071415163,844118802],[2236083679,3088894868],[2040110303,4144562891],[3489536313,1133419300],[2190878435,2301466071],[2465915458,2448602097],[1675766804,2073834499],[3329799896,1613253148],[1483966600,1348836071],[159505618,2527621997],[2674227354,1695130688],[2683539437,1927873839],[3833196123,2570082188],[3891433165,759819981],[1455453349,2179602430],[1430583255,1957776111],[2067726741,4235143439],[303380021,2998980439],[2136024795,3126725799],[2054591852,1051702291],[1029141665,489794361],[2317027384,569642164],[2068461795,624418658],[2499875684,1830645251],[1302894490,4319401],[1002663431,2406815191],[1560941298,2060652753],[2141002286,515773223],[3661248027,475092913],[3705503008,2419919909],[914567990,3496539911],[3462935583,2039034761],[2878378006,2379243316],[1133857586,1390159333],[3023618742,2140726761],[282908558,944874642],[3686955701,1148723903],[2604456805,4163675010],[3061545110,377179268],[3218002352,76459088],[2836503392,916455101],[536836808,151306053],[2886925079,404221671],[2936593041,2011015485],[453815187,1852163908],[3042568989,82176306],[3279635891,4174836410],[3282689058,2360003049],[4088968807,1516570623],[2680453086,1322680794],[1731693966,3438253771],[1842894553,1294307894],[2736377365,2964642609],[121205621,521330014],[2324595870,3005710757],[3784465521,676493813],[1958759409,2030833406],[1306150933,1016370058],[2636541290,482366508],[1950415745,1695073534],[322077955,3746046623],[3602873262,3829181504],[1211684447,1861645455],[504701736,4080111082],[2407799203,1223857855],[1925743434,1498920209],[3617596327,845198428],[2498480299,3484773806],[2680229135,2560201696],[3731399221,1536412390],[2756509305,2924710846],[2635957500,3459716133],[1372762539,769635894],[802677945,3878474636],[1707760534,3075809808],[3714687192,2872792173],[1615679922,1606381794],[1940556374,1337437342],[445390489,731124040],[2864974375,64601760],[1984806574,2141516710],[513390958,1890172555],[744398315,1475299139],[982749166,852662657],[652663695,4260736510],[1184061125,82616221],[3363191899,147951756],[1064069880,1507328085],[2138882964,547595589],[2616926846,3186935246],[2298715513,3606862940],[2414381911,811477686],[2694745228,900437726],[4202576185,2201114451],[3602305260,3323446937],[3756663274,2658490339],[3061587876,2171079416],[3390977925,2850497765],[486312941,224925241],[3515712841,3510684394],[1322319486,2647200565],[3839619171,1148450258],[392296762,1154854654],[1401523788,957405781],[1934485528,527352730],[645968162,3131215255],[696971825,3361451947],[2038689491,1946699733],[1723966113,2785859721],[2652365974,1118037185],[3988018407,3134982149],[1354171594,3053634345],[1287854075,2631782435],[1723106141,2662328866],[563845090,1878819261],[639520332,171129501],[534957223,1696062352],[3612364282,2283204027],[3109494688,1304463816],[500957989,630925278],[3477030536,2149497258],[4109750364,281719363],[951472732,564407054],[922095147,2767874048],[3946156928,829677774],[2622281253,2086286851],[2936811901,850242186],[630086272,3340782667],[2340986210,1296336989],[4107355543,3865114709],[3560210278,3968418243],[3868847493,2967450637],[611513888,2083325060],[3265390517,3025776309],[2874106961,3424470508],[1668707698,2923258228],[2778598353,24320552],[292356118,3415510793],[754567370,86994591],[185141877,1621715171],[2884558258,3722473457],[1492107531,111281805],[3336927864,4225337056],[782994598,1021838039],[346133860,18281270],[2080909533,1649329040],[3612065399,3859901127],[2151962287,284556115],[3957975594,3745718727],[52533817,3998775856],[1232633839,397383972],[2716413964,3629253960],[1531307298,3836851439],[3030137657,2500401718],[3561556693,653345841],[313061910,2945718466],[2065276,3342140708],[410498334,1470588117],[2726640512,4051654894],[2570984935,758567696],[3008987264,3462702678],[623860175,228525243],[3527183895,1829844480],[467272850,3890501742],[568376656,650516927],[990477018,4035508558],[2366955227,817792110],[4183621538,989198068],[946958343,1639184195],[3395758993,3924097558],[1690887473,3220519765],[605184237,1255270525],[275515833,1926424610],[2142902612,283494960],[2021972412,1823828440],[105373677,3448326697],[1666662384,1042433908],[1338566998,261206307],[498685668,1344755577],[3101233780,3119109371],[2733370951,3808165089],[3656512268,3449289481],[4025308119,1607880299],[778896067,1612183167],[2846510368,3674754715],[3058428120,2991822529],[1892379383,3268787440],[2565895844,4154602030],[3213117192,98999135],[2495816991,116985075],[1040203361,1785041385],[3106252493,69316595],[1639829808,2087117568],[3213709576,3799911752],[604681594,2340981536],[4236730699,2938666503],[4009938384,1878897714],[2701667332,1725918218],[2182473079,1258184],[3550198211,2760750799],[657991062,875584532],[1640976276,3380476221],[460041378,2924352091],[1972323596,2287414795],[2510248061,1350206297],[2959337826,3762681165],[1625877874,3235902929],[2070189957,1429368735],[4245163299,1839731898],[2358312347,138364248],[275739390,2179122576],[2037777210,972544338],[2766930226,1984733259],[1933485829,4209310327],[3034118011,3286589799],[2653025529,62078937],[2641780289,2679545709],[3540781195,2787026415],[1569993599,3215949659],[441337890,3947723353],[1878946792,459505587],[3724105660,920173002],[1691411102,3934795955],[148741087,3647709027],[142506469,2776440083],[3811107376,3823285243],[472209891,252266174],[1913386482,1867329194],[2960608550,482740699],[1145005292,1513558421],[1091751784,1687823886],[3625186042,3086337482],[1712140887,940065262],[1504455800,1945702563],[3896940088,2003245591],[2478191531,4197739e3],[3233871270,250924495],[3404865229,1131917964],[1462204167,429621621],[1349259705,3641608989],[3627860584,2048468319],[1244251718,1513180369],[3979211282,371413143],[3043187861,4285699810],[581894202,3060983825],[1390895705,1811317301],[2599134010,3337406128],[2488233440,2436161462],[1816641224,2208816697],[1792034756,815866116],[2779893723,2695577703],[2084952115,2951772258],[1351806869,169269771],[2469979804,86740603],[1163545420,4264616949],[1795352113,2511146232],[1796715044,3134635815],[3521170642,1538900329],[3725363621,1455009392],[1342594643,1512127734],[2618386938,662157428],[2028859350,2494504685],[1841905045,648351336],[4002935891,4033319405],[850071259,1768358867],[979915719,3876018087],[830889197,1629549437],[1744763229,2455795856],[522919199,368499868],[3063822504,2522639205],[2861636095,407686388],[4097602344,1945259027],[4215946617,1251639506],[894485042,534122652],[924809191,1807237502],[1811585710,1589663609],[3439653887,1722232],[3810997538,105152714],[2677100683,4291805514],[77233985,102407776],[4239834691,2851274395],[148802076,2006440603],[2409138150,126301601],[3048474397,3217504870],[588133437,4221603123],[1139638106,263087485],[982032635,3165674595],[562514827,1294842959],[467575086,905357513],[1405117894,3370530088],[3813285157,242912619],[3601878331,1985076606],[1586505598,2092146221],[738488098,103663229],[2970334297,321718822],[1068097019,1742926233],[235518094,420804527],[283685722,4092504887],[2666392744,3799169331],[3569817788,1256762975],[2169728352,292617248],[2444571896,2239859206],[3967907832,1066404216],[420376911,2913277294],[3046293305,2956347747],[2311278792,2477686209],[2885955184,4172514290],[3030078181,2275536480],[4212469731,4280736393],[1046900335,1773022229],[995380926,1414273529],[3892683234,2429494358],[615726237,2127712535],[3880203074,2071130305],[176180504,3070850165],[1474506861,2283723599],[1256707747,1857412043],[764236850,359687368],[3521530334,511649419],[2318567964,3992868140],[128167623,2518992858],[2220129756,1042300052],[2567608573,1349636707],[441446694,384760969],[4143447316,829506048],[817912603,2738025500],[2368091832,357934982],[1187643061,1561463042],[3438021235,3030161697],[1318922279,895468690],[434876457,1130220303],[1180291767,1132759596],[2520707785,1798553137],[1962430872,2958700157],[1510954061,3534879512],[57831539,3269538993],[3354831405,3852135009],[891783098,2698494511],[2555636406,996018997],[2881342935,3982231648],[3473267445,2894952368],[1238029452,3958679326],[2051805420,559465638],[3655936674,1186951582],[330209165,167662935],[1929681327,2450868735],[1313566811,2458925988],[4283920930,3243182650],[1438004300,4185567150],[3093439067,89876832],[3401620219,3721579956],[3673745794,2682874719],[3053321309,825410712],[822915968,3681514755],[3900685126,561657358],[553823814,1857753416],[4166295066,983949325],[128359165,3426887194],[3300989119,3884968622],[4193552686,3647722552],[452189154,1569670618],[4122259632,3537825460],[2519387887,2821594244],[74333898,2940550377],[4032631446,2173999692],[2521268686,1934310532],[2620314688,2177785789],[1378755571,2455646622],[394133753,4231198609],[734399075,2800989170],[573292462,1634883078],[1214417373,3426576256],[2110224475,2399009920],[2331215665,3224086912],[531326186,698539511],[3839443603,583861850],[2644531398,2017784332],[616620850,3070237104],[590349237,2798642861],[3582377217,3317831670],[1582708616,1596570667],[2126148205,2358511947],[173450736,3219362418],[3616831144,1323437318],[2655785577,3131359031],[401600069,2967397952],[496349349,4244179910],[2479612086,2579650653],[1710903074,2049666425],[3589924952,690291925],[3266682943,1900485231],[1496318498,3025542656],[3459221058,3389461212],[2091479615,3140389256],[663040899,1207089672],[3323704225,1105530508],[353318429,2879253542],[2674540957,941987316],[1688550857,620657353],[338551967,4286217277],[204689992,2239736295],[178008789,3940832005],[3871613304,3300636974],[1911672356,2429684487],[4055679954,1974461722],[3878217928,1009991796],[2533095482,310920740],[2174833823,3596041637],[1604814460,2939543881],[1452830254,4092397851],[2441027029,4169690209],[3524103304,3372213855]],t=[[836181454,1689436944],[2776523577,3710710688],[4049974663,3750330768],[519497435,2979405513]],n=[[1892447193,197291556],[3793382197,3742120663],[3838936,2994760034],[479846099,1018728609],[3476112862,182272649],[3504620154,1427438450],[2009473484,2679350403],[1738755500,1129731339]],r=[4174784170,2938602761],o={p:0,P:1,n:2,N:3,b:4,B:5,r:6,R:7,q:8,Q:9,k:10,K:11},a=[];a[5]=1,a[6]=0,a[9]=3,a[10]=2,a[17]=5,a[18]=4,a[33]=7,a[34]=6,a[65]=9,a[66]=8,a[129]=11,a[130]=10;var i,s=[2,5,10,20,40,80,160,64],c=["","0000000","000000","00000","0000","000","00","0",""];function to32BitHex(e){var t=e.toString(16);return c[t.length]+t}function to64BitHex(e){return to32BitHex(e[0])+to32BitHex(e[1])}function hash(a,i){var c,u,l,d,f,p,m,h,g,b,v,E,_=a.split(" "),y=_[0].split("/"),O="w"===_[1],S=0,P=Number(O),j=P?3:4;for(l=7;l>=0;l-=1)for(d=0,m=(f=y[l]).length,p=0;p<m;p+=1)h=f[p],(v=o[h])>=0&&(c=(c^(g=e[64*v+8*(7-l)+d])[0])>>>0,u=(u^g[1])>>>0,v===P&&l===j&&(S|=1<<d)),d+=Number(h)||1;return"-"!==_[2]&&((b=_[2]).indexOf("K")>-1&&(c=(c^(g=t[0])[0])>>>0,u=(u^g[1])>>>0),b.indexOf("Q")>-1&&(c=(c^(g=t[2])[0])>>>0,u=(u^g[1])>>>0),b.indexOf("k")>-1&&(c=(c^(g=t[1])[0])>>>0,u=(u^g[1])>>>0),b.indexOf("q")>-1&&(c=(c^(g=t[3])[0])>>>0,u=(u^g[1])>>>0)),_[3]&&"-"!==_[3]&&(E=_[3].charCodeAt(0)-97,s[E]&S&&(c=(c^(g=n[E])[0])>>>0,u=(u^g[1])>>>0)),O&&(c=(c^r[0])>>>0,u=(u^r[1])>>>0),i&&"hex"===i?to64BitHex([c,u]):[c,u]}function wrap(e){var t,n,r,o,a={};function parseBook(e,t){var r,o,a,i,s,c,u=n.getUint16(e+8),l=n.getUint16(e+10);return o=u>>9&7,i=u>>3&7,s=7&u,c=u>>12&7,4==(a=u>>6&7)&&t&&o===i&&"-"!==t&&(7===s&&(0===o&&t.indexOf("K")>-1||7===o&&t.indexOf("k")>-1)?s-=1:0===s&&(0===o&&t.indexOf("Q")>-1||7===o&&t.indexOf("q")>-1)&&(s+=2)),r=String.fromCharCode(a+97)+(o+1)+String.fromCharCode(s+97)+(i+1),c&&(r+="nbrq"[c-1]),{move:r,weight:l}}function query(e){return"string"==typeof e&&(e={fen:e}),t(e)}if(a={query:query,pick:function pick(e){var t,n,r,o,a,i=0;if(function sortMoves(e){e.sort((function sorter(e,t){return t.weight-e.weight}))}(t=(e=e||{}).moves||query(e)),r=t.length){if(e.type&&1!==r&&"best"!==e.type){if("random"===e.type){for(o=Math.floor(Math.random()*t.sum)+1,a=0;a<r-1&&!(o<=(i+=t[a].weight));a+=1);return t[a].move}return"randomDisregardWeight"===e.type?t[Math.floor(Math.random()*r)].move:"worst"===e.type?t[r-1].move:((n=parseInt(e.type)||1)<0&&(n=r+n+1),n<1?n=1:n>r&&(n=r),t[n-1].move)}return t[0].move}}},e.getUint32)t=function bufferBookFind(e){var t,r,o,a,i,s=n.length||n.byteLength||0,c=e.offset||0,u=e.fen,l=e.chess960,d=e.checkAll,f=[],p=0;for(e.hash?"string"==typeof(t=e.hash)&&(t=function hex64ToDec(e){return[parseInt(e.substr(0,8),16),parseInt(e.substr(8),16)]}(t)):t=hash(u),!l&&u&&(i=u.split(" ")[2]),c=0;c<s;c+=16)if(n.getUint32(c)===t[0]&&n.getUint32(c+4)===t[1])o=parseBook(c,i),f[f.length]=o,p+=o.weight,r=!0;else if(r&&!d)break;if(f.sum=p,e.relative)for(a=f.length-1;a>=0;a-=1)f[a].relative=Math.round(f[a].weight/p*1e4);return f},n=e,a.buffer=n;else for(o in t=function jsonBookFind(e){var t,n,o,i,s,c,u=0,l=e.fen;if(a.useFen)o=l.replace(/ \d+ \d+$/,""),(t=r[o])||(i=o.replace(/[a-h][1-8]$/,"-"))!==o&&(t=r[i]);else if(e.hash||(e.hash=hash(l,"hex")),t=r[e.hash]){if(t[0]&&t[0].n&&(t=t[0]),t.n&&!t.b)return[];if(t.b)t=function decompressMoves(e){var t,n=[],r=e.b.length;for(t=0;t<r;++t)n.push({move:e.b[t],weight:e.w[t]});return n}(t);else if(!e.chess960&&l)for(c=l.split(" ")[2],n=t.length-1;n>=0;n-=1)(s=t[n].move.match(/e([18])([ah])\1/))&&("h"===s[2]&&("1"===s[1]&&c.indexOf("K")>-1||"8"===s[1]&&c.indexOf("k")>-1)?t[n]={move:"e"+s[1]+"g"+s[1],weight:t[n].weight}:"a"===s[2]&&("1"===s[1]&&c.indexOf("Q")>-1||"8"===s[1]&&c.indexOf("q")>-1)&&(t[n]={move:"e"+s[1]+"c"+s[1],weight:t[n].weight}))}if(t)for(n=t.length-1;n>=0;n-=1)u+=Number(t[n].weight);else t=[];return t.sum=u,t},r=e,a.json=r,r){a.useFen=o.indexOf(" ")>-1;break}return a}function getBook(e,t){!function ajaxLoad(e,t){var n=new XMLHttpRequest,r=e.toLowerCase().indexOf(".json")>-1;function onload(){var e;if(n.status>=200&&n.status<300||304===n.status||0===n.status||1223===n.status)if(r)try{t(null,JSON.parse(n.response))}catch(o){t(o)}else e=new DataView(n.response),t(null,e);else t(new Error("Error code: "+n.status))}n.open("GET",e,!0),r||(n.responseType="arraybuffer"),n.onload=onload,n.onerror=onload,n.send()}(e,(function onload(e,n){var r;if(n&&(r=wrap(n)),t)return t(e,r);if(e)throw e;return r}))}return{hash:hash,loadBook:(i={},function loadBook(e,t){i[e]?i[e].book?setTimeout((function(){t(null,i[e].book)}),0):i[e].cbs.push(t):(i[e]={cbs:[t]},getBook(e,(function onload(t,n){var r=i[e].cbs;t?delete i[e]:(i[e].book=n,i[e].cbs=void 0),r.forEach((function(e){setTimeout((function(){e(t,n)}),0)}))})))}),to64BitHex:to64BitHex,zobristPiece:e,zobristCastle:t,zobristEnPassant:n,zobristTurn:r,zobristPieceValue:o,zobristPieceValueNumbers:a}}(),o=function init(){var e,t,n,o,a={Chess:0,Chess960:1,Crazyhouse:2,"3-check":3,"King of the Hill":4,Bughouse:5,chess960:1,Fischerandom:1,fischerandom:1,crazyhouse:2,"three-check":3,kingofthehill:4,koth:4,bughouse:5},i=["Chess","Chess960","Crazyhouse","3-check","King of the Hill","Bughouse"],c={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0,f=0,p=0,m=-1,h=32,g=128,b=252,v=255,E=512,_=112,y=14,O=21,S=127,P="pnbrqkPNBRQK",j="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",k=[];k[5]=[-16,-17,-15],k[6]=[16,17,15],k[8]=[-18,-33,-31,-14,18,33,31,14],k[16]=[-17,-15,17,15],k[32]=[-16,1,16,-1],k[64]=[-17,-16,-15,1,17,16,15,-1],k[128]=[-17,-16,-15,1,17,16,15,-1];var C={P:5,p:6,N:9,n:10,B:17,b:18,R:33,r:34,Q:65,q:66,K:129,k:130},A={P:4,p:4,N:8,n:8,B:16,b:16,R:32,r:32,Q:64,q:64,K:128,k:128},w={5:"P",6:"p",9:"N",10:"n",17:"B",18:"b",33:"R",34:"r",65:"Q",66:"q",129:"K",130:"k"},T={9:"N",10:"N",17:"B",18:"B",33:"R",34:"R",65:"Q",66:"Q",129:"K",130:"K"},N=[80,0,0,0,0,0,0,96,0,0,0,0,0,0,80,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,96,96,96,96,96,96,224,0,224,96,96,96,96,96,96,0,0,0,0,0,0,8,212,224,212,8,0,0,0,0,0,0,0,0,0,0,0,80,8,96,8,80,0,0,0,0,0,0,0,0,0,0,80,0,0,96,0,0,80,0,0,0,0,0,0,0,0,80,0,0,0,96,0,0,0,80,0,0,0,0,0,0,80,0,0,0,0,96,0,0,0,0,80,0,0,0,0,80,0,0,0,0,0,96,0,0,0,0,0,80,0,0,80,0,0,0,0,0,0,96,0,0,0,0,0,0,80],M=[336,80,80,0,0,0,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,360,508,252,0,252,508,360,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,476,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,0,0,0,80,80,336],D=[336,80,80,0,0,0,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,360,508,252,0,252,508,488,352,352,352,352,0,96,96,96,96,120,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,476,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,88,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,80,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,0,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,0,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,0,96,352,96,96,0,0,80,80,336],R=[336,80,80,0,0,96,96,352,96,0,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,352,352,352,352,488,508,252,0,252,508,360,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,120,96,96,96,96,0,0,0,0,80,88,508,252,508,252,476,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,88,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,80,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,0,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,0,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,0,0,0,80,80,336],I=[336,80,80,0,0,96,96,352,96,96,0,0,80,80,336,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,352,352,352,352,488,508,252,0,252,508,488,352,352,352,352,0,96,96,96,104,252,252,252,252,252,252,252,104,96,96,96,0,0,0,0,80,88,508,252,508,252,508,88,80,0,0,0,0,0,0,80,80,336,120,120,360,120,120,336,80,80,0,0,0,0,80,80,336,80,112,96,352,96,112,80,336,80,80,0,0,80,80,336,80,80,96,96,352,96,96,80,80,336,80,80,0,80,336,80,80,0,96,96,352,96,96,0,80,80,336,80,0,336,80,80,0,0,96,96,352,96,96,0,0,80,80,336],L=[336,80,80,112,112,112,96,352,96,96,112,112,112,80,336,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,352,352,480,480,488,508,252,0,252,508,488,480,480,480,352,0,96,104,252,252,252,252,252,252,252,252,252,252,252,252,104,0,0,80,88,120,120,508,252,508,252,508,120,120,120,88,80,0,80,80,80,112,368,120,120,376,120,120,368,112,112,80,80,0,80,80,80,368,112,112,112,368,112,112,112,368,112,80,80,0,80,80,336,112,112,112,112,368,112,112,112,112,368,80,80,0,80,336,80,112,112,112,112,352,96,112,112,112,112,336,80,0,336,80,80,112,112,112,96,352,96,96,112,112,112,80,336],x=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,33,16,31,15,0,0,0,0,0,0,0,0,0,0,0,18,17,16,15,14,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,-14,-15,-16,-17,-18,0,0,0,0,0,0,0,0,0,0,0,-15,-31,-16,-33,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],F=[0,5,8,11,14],B=[31,7,7,7,63],U={P:0,p:0,N:5,n:5,B:8,b:8,R:11,r:11,Q:14,q:14},V=[4,8,16,h,64],K=["","N","B","R","Q"],q={CAPTURE:1,BIG_PAWN:2,EP_CAPTURE:4,ANY_CAPTURE:5,PROMOTION:8,KSIDE_CASTLE:16,QSIDE_CASTLE:32,KQSIDE_CASTLE:48,DROP:64,DROP_OR_PROMOTE:72},G=[0,6,1],z={K:119,Q:112,k:7,q:0,A:112,B:113,C:114,D:115,E:116,F:117,G:118,H:119,a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},H=["Event","Site","Date","Round","White","Black","Result"],$=["Event","Site","Date","Round","White","Black","Result","Variant","SetUp","FEN","WhiteA","WhiteB","BlackA","BlackB"];function rank(e){return e>>4}function file(e){return 7&e}function algebraic(e){return String.fromCharCode(file(e)+97)+(8-rank(e))}function swapColor(e){return 3-e}function hashNum(e,t){e[0]=(e[0]^t[0])>>>0,e[1]=(e[1]^t[1])>>>0}function completeFen(e){var t,n;return(t=[""," w - - 0 1"," - - 0 1"," - 0 1"," 0 1"," 1"][(n=(e=e.trim()).split(" ")).length])&&e?e+=t:"0"===n[5]&&(n[5]=1,e=n.join(" ")),e}function createVariantZobristNumbers(){r.zobristCheck=[[441249556,340005552],[1040760204,311043682],[1621584863,1749286446],[1006868636,1625552915],[1953853171,24921145],[161251506,1935545265]]}function validateFen(e,t){var n,r,o,i,s,c,u,l,d,f,p,m,h,g,b,v,E,_,y,O,S=/^(?:[A-H]{1,2}[a-h]{0,2}|[A-H]{0,2}[a-h]{1,2}|KQ?k?q?|Qk?q?|kq?|q|-)$/,j=1*t===a.Crazyhouse||a[t]===a.Crazyhouse||1*t===a.Bughouse||a[t]===a.Bughouse,k=0,C=0,A=!0,w="",T={0:0,7:0},N={0:0,7:0},M={0:"k",7:"K"},D={0:"r",7:"R"},R=1*t===a.Chess960||a[t]===a.Chess960;if(!e)return 1;if((1*t===a.Bughouse||a[t]===a.Bughouse)&&2===(s=e.split(" | ")).length)return 0===(c=validateFen(s[0],t))&&(c=validateFen(s[1],t)),c;if(s=e.split(/\s+/),(1*t===a["3-check"]||a[t]===a["3-check"])&&7===s.length&&(i=s.pop(),!/^\+[0-3]\+[0-3]$/.test(i)||"+3+3"===i))return 14;if(6!==s.length)return 1;if(/\D|.{7,}|^0|^$/.test(s[5]))return 2;if(/\D|.{7,}|^0.|^$/.test(s[4]))return 3;if(!/^(?:-|[abcdefgh][36])$/.test(s[3]))return 4;if(f=s[2],R){if(!S.test(f))return 12}else if(!/^(?:KQ?k?q?|Qk?q?|kq?|q|-)$/.test(f)){if(void 0!==t||!S.test(f))return 5;R=!0}if("w"!==s[1]&&"b"!==s[1])return 6;if(j&&(s[0]=s[0].replace(/~(?=.*\/)/g,"")),r=s[0].split("/"),j&&9===r.length&&(i=r.pop(),!/^[pnbrq]{0,63}$/i.test(i)))return 13;if(8!==r.length)return 7;if("3"===s[3][1]&&"w"===s[1]||"6"===s[3][1]&&"b"===s[1])return 11;for("-"!==s[3]&&(u=4==(C="3"===s[3][1]?4:3)?5:2,k=s[3].charCodeAt(0)-97,A=!1,w=4===C?"P":"p"),n=0;n<r.length;++n){for(_=0,y=!1,O=0;O<r[n].length;O++)if(+(o=r[n][O])==+o){if(y)return 8;_+=1*o,y=!0}else{if(-1===P.indexOf(o))return 9;if(A||C!==n||k!==_||w!==o||(A=!0),u===n&&k===_)return 11;n%7==0&&(o===M[n]?N[n]=1<<_:o===D[n]&&(T[n]|=1<<_)),++_,y=!1}if(8!==_)return 10}if(!A)return 11;if("-"!==f)if(R)for(m={0:0,1:0,2:252,4:248,8:240,16:224,32:192,64:128,128:0},p={0:0,1:0,2:1,4:3,8:7,16:15,32:31,64:63,128:0},E={0:[0,0],7:[0,0]},n=f.length-1;n>=0;--n){if(b=f.charCodeAt(n),v&&v>b&&v-b<8)return 15;if(75===b?h=T[g=7]&m[N[g]]:81===b?h=T[g=7]&p[N[g]]:107===b?h=T[g=0]&m[N[g]]:113===b?h=T[g=0]&p[N[g]]:(h=1<<b-((g=b>=97?0:7)?65:97),v=b),!h||0!=(h&h-1))return 15;if(N[g]<2||N[g]>64||(h&T[g])!==h)return 15;if(++E[g][1*(N[g]<h)]>1)return 15}else{if((l=(f.indexOf("K")>-1?128:0)|(f.indexOf("Q")>-1?1:0))&&(16!==N[7]||(l&T[7])!==l))return 15;if((d=(f.indexOf("k")>-1?128:0)|(f.indexOf("q")>-1?1:0))&&(16!==N[0]||(d&T[0])!==d))return 15}return 0}function handToString(e,t){var n,r,o="",a=0,i=t?6:0;if(e)for(;a<5;){for(n=e>>F[a]&B[a],r=0;r<n;++r)o+=P[a+i];++a}return o}function hashEP(e,t,n,o){e[n+1]!==o&&e[n-1]!==o||hashNum(t,r.zobristEnPassant[file(n)])}function addPawnMove(e,n,r){var o;(0===t||2&u[n])&&(rank(n)%7==0?(o=r|q.PROMOTION|e<<7|n<<y,l[f++]=8388608|o,l[f++]=6291456|o,l[f++]=4194304|o,l[f++]=2097152|o):l[f++]=r|e<<7|n<<y)}function kingOfTheHillWin(e){switch(e){case 67:case 68:case 51:case 52:return!0}return!1}function canCastle960(e,t,n,r){var o,a,i,s=t+(n-t%8),c=n>t%8?1:-1;for(i=t+c;i!==s;i+=c)if(e[i])return!1;if(a=(o=1===r?1===c?118:114:1===c?6:2)-c,u[o]||e[o]&&o!==t&&o!==s||e[a]&&a!==t&&a!==s)return!1;if(o!==t)for(i=t+(c=o>t?1:-1);i!==o;i+=c)if(i!==s&&e[i]||u[i])return!1;return!0}var W=function(){function createLine(e,t,n,r,o,i){var s,c,u,l,d,f,p,m,h,g,b,v,E=[],_="",y=!0,O=t[n],S=O.length,P="";if(O.commands&&!i)for(d in O.commands)P+="[%"+d+" "+O.commands[d]+"]";for(O.initComment&&(P=(P+" "+O.initComment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),P&&E.push("{"+P+"}"),u=0;u<S;++u){if(p=1===(c=O[u]).color,_="",P="",s=c.commands,r!==a.Bughouse?(y&&!p?_=e+"...":p&&(_=e+"."),o&&(p||y)&&(_+=" ")):(E.bughouseOrder||(E.bughouseOrder=[]),E.bughouseOrder.push(c.bughouseOrder),u||(E.blackCountOffset=2===O[0].color?1:0)),_+=c.san,c.annotation&&(_+=c.annotation),c.additionalAnnotation&&(_+=" "+c.additionalAnnotation.join(" ")),y=!1,void 0===c.time||s||(s={clk:(g=c.time,b=void 0,v=void 0,b=Math.floor(g%36e3/600),v=Math.floor(g%36e3%600)/10,Math.floor(g/36e3)+":"+(b<10?"0":"")+b+":"+(v<10?"0":"")+v)}),s&&!i)for(d in s)P+="[%"+d+" "+s[d]+"]";if(c.comment&&(P=(P+" "+c.comment.replace(/(\"|\}|\%|\\)/g,"\\$1")).trim()),P&&(_+=" {"+P+"}",y=!0),E.push(_),c.lines)for(m=c.lines.length,l=0;l<m;++l)t[h=c.lines[l]].length&&((f=createLine(e,t,h,r,o,i))[0]="("+f[0],f[f.length-1]+=")",E=E.concat(f),y=!0);p||e++}return E}function createHeader(e,t){return"["+e+' "'+String(t).replace(/(\"|\\)/g,"\\$1")+'"]'}return function generatePgn(e,t,n,r,o,i){var s,c,u="string"==typeof e.newline?e.newline:"\n",l=void 0===e.spaceAfterPeriods||e.spaceAfterPeriods,d="";for(s in d+=createHeader("Event",t.Event)+u,d+=createHeader("Site",t.Site)+u,d+=createHeader("Date",t.Date)+u,d+=createHeader("Round",t.Round)+u,o===a.Bughouse?(d+=createHeader("WhiteA",t.WhiteA||"?")+u,d+=createHeader("BlackA",t.BlackA||"?")+u,d+=createHeader("WhiteB",t.WhiteB||"?")+u,d+=createHeader("BlackB",t.BlackB||"?")+u):(d+=createHeader("White",t.White)+u,d+=createHeader("Black",t.Black)+u),d+=createHeader("Result",t.Result)+u,o&&(d+=createHeader("Variant",t.Variant)+u),t.FEN&&t.FEN!==j&&(d+=createHeader("SetUp","1")+u,d+=createHeader("FEN",t.FEN)+u),t)-1===$.indexOf(s)&&(d+=createHeader(s,t[s])+u);if(d+=u,c=createLine(r,n,0,o,l,e.hideCommands),o===a.Bughouse){if(i.isDependent)return c;c=function makeBugHousePgn(e,t,n){var r=t,o=e.siblingGame.pgn(),a=0,i=0,s=[];for(t.bughouseOrder=t.bughouseOrder||[],o.bughouseOrder=o.bughouseOrder||[];t.bughouseOrder.length||o.bughouseOrder.length;)!t.bughouseOrder.length||o.bughouseOrder.length&&t.bughouseOrder[0]>o.bughouseOrder[0]?(o.bughouseOrder.shift(),s.push("B")):(t.bughouseOrder.shift(),s.push("A"));return t=[],s.forEach((function(s){var c,u,l,d="";"A"===s?(c=r,u=++a,l=e.startingMoveNumber()):(c=o,u=++i,l=e.siblingGame.startingMoveNumber()),d=String(Math.floor((u+1)/2)+l-1),(c.blackCountOffset+u)%2?d+=s:d+=s.toLowerCase(),d+="."+(n?" ":"")+c.shift(),t.push(d)})),t}(i,c,l)}return c.push(t.Result),d+function wordWrap(e,t,n){return t<1?e:(t="number"==typeof t?t:80,e.replace(new RegExp("(.{1,"+t+"})(?: |$|\r?\n)","g"),"$1"+n).slice(0,-n.length))}(c.join(" "),e.maxWidth,u)}}(),Q=function(){var e="!?‼⁇⁉⁈□∇Δ∞⩲⩱±∓⨀⟳→↑⇆∆⌓⇔⇗⟫⟪✕⊥⊕○⇄↻⊙~",t=/\[%(\S+)\s([^\]]+)\]/,n=/^(?:[+=~\/\-\u2212]+|T?N|RR|D)$/;function extractCommands(e){var n,r,o={};do{(n=t.exec(e.value))&&(r=!0,e.value=e.value.replace(n[0],"").trim(),o[n[1]]=n[2])}while(n);r&&(e.commands=o)}function isSplitGame(e,t,n){for(var r;++t<n;)if(r=e[t].match(/^\s*(\S+)/))return/^(?:\[|1(?:\.|$))/.test(r[1])}return function tokenize(t,r){var o,a,i,s,c,u,l,d="tags",f=[],p={type:d,value:""},m=0,h=[],g=!0;for(r=r||{},s=(o=t.split(/\r?\n/)).length,a=0;a<s;++a)if("%"!==(i=o[a].trim())[0])if(i){if(u=(i=" "+i+" ").length,c=0,g)for(;c<u;++c)if(l=i[c],"tags"===d){if("["===l)p={type:d="tagName",value:""};else if(l.trim()){p={type:d="san",value:""},g=!1;break}}else if("tagName"===d)p.value&&""===l.trim()?(f.push(p),d="tagValueStart"):" "!==l&&(p.value+=l);else if("tagValueStart"===d){if('"'===l||"“"===l)p={type:d="tagValue",value:""};else if(l.trim())return!1}else if("tagValue"===d)'"'===l||"”"===l?(f.push(p),"]"===i[c+1]?(p={type:d="tags",value:""},++c):d="tagEnd"):("\\"===l&&c+2<u&&(l=i[++c]),c>0&&(p.value+=l));else if("]"===l)p={type:d="tags",value:""};else if(l.trim())return!1;for(;c<u;++c)if(l=i[c],"san"===d)if(e.indexOf(l)>-1)"!"===l||"?"===l||e.indexOf(l)<6&&(l=["!!","??","!?","?!"][e.indexOf(l)-2])?(p.value&&f.push(p),p={type:"a",value:l},"!"!==i[c+1]&&"?"!==i[c+1]||(p.value+=i[++c]),f.push(p),p={type:"san",value:""}):("∞"===l&&"=/"===p.value?(p.type="aa",p.value+=l):(p.value&&(n.test(p.value)&&("--"!==p.value||r.rejectNullMoves)&&(p.type="aa"),f.push(p)),p={type:"aa",value:l},"↑"===l&&"↑"===i[c+1]&&(p.value="↻",++c)),f.push(p),p={type:"san",value:""});else if(" "===l||"\t"===l||"\n"===l||"\r"===l||"{"===l||"("===l||")"===l){if(p.value){if("$"===p.value[0])p.type="nag";else if("*"===p.value||"1-0"===p.value||"0-1"===p.value||"1/2-1/2"===p.value||"½-½"===p.value){if(c+1<u)return!1;p.type="result","½-½"===p.value&&(p.value="1/2-1/2")}n.test(p.value)&&("--"!==p.value||r.rejectNullMoves)&&(p.type="aa"),f.push(p),p={type:d,value:""}}if(" "===l||"\t"===l||"\n"===l||"\r"===l)d="san";else if("{"===l)d="comment";else if("("===l)d="san",f.push({type:"variationStart",value:++m});else if(f.push({type:"variationEnd",value:m}),d="san",!m--)return!1;p.type=d}else if("."===l||!p.value&&+l==+l&&"-"!==i[c+1]&&"/"!==i[c+1]){if(+l==+l)switch(p.number||(p.number=""),p.number+=l,i[c+1]){case"A":case"a":case"B":case"b":p.number+=i[++c],f.push({type:"number",value:p.number}),delete p.number}}else p.value+=l;else 0===c&&(p.value=p.value.trim()),"}"!==l?("\\"===l&&c+2<u&&(l=i[++c]),p.value+=l):(p.value=p.value.trim(),p.value.indexOf("[")>-1&&extractCommands(p),f.push(p),p={type:d="san",value:""})}else"tags"===d?(d="san",g=!1):"comment"!==d&&"tagValueStart"!==d&&!m&&f.length&&isSplitGame(o,a,s)&&("tagValue"!==f[f.length-1].type&&(h.push(f),f=[]),d="tags",g=!0);return h.push(f),h}}();function Chess($,Y){var J,Z,X=0,ee=!0,te=[],ne=1,re=[],oe=m,ae=0,ie=1,se=1,ce=[],ue=[ce],le=0;ce.id=le;var de={},fe=[],pe=!1,me=!1,he=makeMoveChess;function hashPosition(){var e,t,n,o=1===ne?[4174784170,2938602761]:[0,0];for(n=0;n<120;++n)136&n&&(n+=8),(e=Z[n])&&hashNum(o,r.zobristPiece[64*r.zobristPieceValueNumbers[e&v]+8*(7-rank(n))+file(n)]);if(me)for(t=1;t<3;++t)re[t]&&(0!=(re[t]&re[t]-1)?(hashNum(o,r.zobristCastle[t-1]),hashNum(o,r.zobristCastle[t+1])):re[t]>1<<file(te[t])?hashNum(o,r.zobristCastle[t-1]):hashNum(o,r.zobristCastle[t+1]));else{for(t=1;t<3;++t)re[t]&&(re[t]&q.KSIDE_CASTLE&&hashNum(o,r.zobristCastle[t-1]),re[t]&q.QSIDE_CASTLE&&hashNum(o,r.zobristCastle[t+1]));pe?function hashHand(e,t){var n,o,a,i,s,c,u,l=0;for(n=1;n<3;++n){if(o=t[n])for(a=0;a<5;){for(s=l+63*a,i=o>>F[a]&B[a],c=0;c<i;++c)hashNum(e,[31*(u=r.zobristPiece[s++])[0]>>>0,17*u[1]>>>0]);++a}l=315}}(o,J._hand):X===a["3-check"]&&function hash3Check(e,t){t[1]&&hashNum(e,r.zobristCheck[t[1]-1]),t[2]&&hashNum(e,r.zobristCheck[t[2]+2])}(o,fe)}return oe!==m&&hashEP(Z,o,oe+(1===ne?16:-16),4|ne),o}function getCurrentHash(){var e;return ce.length?e=ce[ce.length-1].hash:(ce.hash||(ce.hash=hashPosition()),e=ce.hash),[e[0],e[1]]}function setVariant(e,t){X!==(X=e?a[e]||1*e||a[String(e).replace(/ /g,"").toLowerCase()]||a.Chess:0)&&(X===a.Bughouse?(pe=!0,J.isDependent||(J.siblingGame=Chess(),J.siblingGame.hashing(ee),J.siblingGame.isDependent=!0,J.siblingGame.siblingGame=J,J.siblingGame.header({Variant:"Bughouse"})),createVariantZobristNumbers(),he=makeMoveVariant):(delete J.siblingGame,pe=X===a.Crazyhouse,me=X===a.Chess960,X?(createVariantZobristNumbers(),he=makeMoveVariant):he=makeMoveChess),t||updateSetup(generateFen()))}function disambiguate960Rook(e,t){for(var n,r,o=e>7?1:2;!(136&e);){if((n=Z[e])&o)if(n&h){if(r)return;r=e%8+(1===o?65:97)}else if(n&g)return r;e+=t}}function _clear(e,t,n){Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ne=1,te[1]=m,te[2]=m,re[1]=0,re[2]=0,J._hand[1]=0,J._hand[2]=0,fe[1]=0,fe[2]=0,oe=m,ae=0,ie=1,t||(ue=[ce=[]],le=0,ce.id=le,de={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},e?setHeader(["Variant",e]):setVariant(!1,n),n||updateSetup(generateFen()))}function reset(){_clear(0,!1,!0),ce.hash=[1178310168,378666140],Z=[34,10,18,66,130,18,10,34,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,33,9,17,65,129,17,9,33],se=1,te[1]=116,te[2]=4,re[1]=48,re[2]=48}function load(e,t,n,r){var o,s,u,l,d,f,p,b,v,_,y,O,S=0;if(r?(O=(o=e.split(" "))[3],y=o[2]):(O=(o=e.trim().split(/\s+/))[3]||"-",y=o[2]||"-"),void 0===t?(31&y.charCodeAt(0))<9&&setVariant(a.Chess960,!0):setVariant(t,!0),s=o[0],!r&&!(s=function fixFenPieces(e,t){var n,r,o=e.length,i=0,s=0,c=t&&(t===a.Crazyhouse||t===a.Bughouse);for(n=0;n<o;++n)if(+(r=e[n])!=+r)if("/"===r){if(8!==s&&(e=e.substr(0,n)+(8-s)+e.substr(n),++n,++o),s=0,++i>7){if(!c&&n<o-1||!/^[pnbrq]{0,63}$/i.test(e.substr(n+1)))return!1;break}}else if(C[r]){if(++s>8)return!1}else{if("~"!==r)return!1;c&&n&&/[nbrq]/i.test(e[n-1])||(e=e.substr(0,n)+e.substr(n+1),--n,--o)}else(s+=1*r)>8&&(e=e.substr(0,n)+(r-(s-8))+e.substr(n+1),s=8);return e}(s,X)))return!1;if(l=s.length,_clear(i[X],n,!0),pe){if(X===a.Bughouse&&!J.isDependent&&(f=e.split(" | "),!J.siblingGame.load(1===f.length?e:f[1],t,n,r)))return reset(),!1;for(d=0;d<l;++d)if(+(p=s[d])!=+p)if("/"===p){if(S>111){for(++d;d<l;++d)p=s[d],J._hand[p<"a"?1:2]+=1<<U[p]>>>0;break}S+=8}else Z[S]=C[p],"~"===s[d+1]&&(++d,Z[S]|=E),Z[S]&g&&(te[3&Z[S]]=S),++S;else S+=1*p}else for(d=0;d<l;++d)+(p=s[d])!=+p?"/"===p?S+=8:(Z[S]=C[p],Z[S]&g&&(te[3&Z[S]]=S),++S):S+=1*p;if(ne="b"===o[1]?2:1,"-"!==y)if(me){for(v={1:[0,0],2:[0,0]},d=y.length-1;d>=0;--d)75===(u=y.charCodeAt(d))?u=disambiguate960Rook(119,-1):81===u?u=disambiguate960Rook(112,1):107===u?u=disambiguate960Rook(7,-1):113===u&&(u=disambiguate960Rook(0,1)),b=u<97?1:2,_=z[String.fromCharCode(u)],(p=Z[_])===(h|b)&&(u>=97?te[b]>=1&&te[b]<=6&&(re[b]|=1<<u-97):te[b]>=113&&te[b]<=118&&(re[b]|=1<<u-65),++v[b][1*(te[b]<_)]);(v[1][0]>1||v[1][1]>1)&&(re[1]=0),(v[2][0]>1||v[2][1]>1)&&(re[2]=0)}else{if(!r)for(d=y.length-1;d>=0;--d)p=Z[z[y[d]]],b=y.charCodeAt(d)<97?1:2,p===(h|b)&&te[b]===(1===b?116:4)||(y=y.substr(0,d)+y.substr(d+1)||"-");for(d=y.length-1;d>=0;--d)switch(y[d]){case"K":re[1]|=q.KSIDE_CASTLE;break;case"Q":re[1]|=q.QSIDE_CASTLE;break;case"k":re[2]|=q.KSIDE_CASTLE;break;case"q":re[2]|=q.QSIDE_CASTLE}}return!r&&(2!==O.length||1===ne&&"6"!==O[1]||2===ne&&"3"!==O[1]||Z[O.charCodeAt(0)-97+16*(8-("3"===O[1]?4:5))]!==(4|swapColor(ne))||Z[c[O]])&&(O="-"),oe="-"===O?m:c[O],ae=1*o[4]||0,ie=1*o[5]||1,X===a["3-check"]&&(o[6]&&"+3+3"!==o[6]&&(f=o[6].match(/^\+([0-3])\+([0-3])$/)),f=f||[0,0,0],fe[1]=1*f[1],fe[2]=1*f[2]),n||(se=ie,updateSetup(generateFen())),!0}function generateFen(){return X?function generateVariantFen(){var e,t,n,r=0,o="",i="";for(e=0;e<120;++e)136&e&&(r&&(o+=r),o+="/",r=0,e+=8),(n=Z[e])?(r&&(o+=r,r=0),o+=w[n&v],pe&&n&E&&(o+="~")):++r;if(r&&(o+=r),pe&&(o+="/"+handToString(J._hand[1],!0)+handToString(J._hand[2])),me){for(t=re[2],e=0;t;)1&t&&(i=String.fromCharCode(e+97)+i),t>>=1,++e;for(t=re[1],e=0;t;)1&t&&(i=String.fromCharCode(e+65)+i),t>>=1,++e}else re[1]&q.KSIDE_CASTLE&&(i+="K"),re[1]&q.QSIDE_CASTLE&&(i+="Q"),re[2]&q.KSIDE_CASTLE&&(i+="k"),re[2]&q.QSIDE_CASTLE&&(i+="q");return o+=" "+(1===ne?"w":"b")+" "+(i||"-")+" "+(oe===m?"-":algebraic(oe))+" "+ae+" "+ie,X===a["3-check"]?o+=" +"+fe[1]+"+"+fe[2]:X!==a.Bughouse||J.isDependent||(o+=" | "+J.siblingGame.fen()),o}():function generateStandardFen(){var e,t,n=0,r="",o="";for(e=0;e<120;++e)136&e&&(n&&(r+=n),r+="/",n=0,e+=8),(t=Z[e])?(n&&(r+=n,n=0),r+=w[t&v]):++n;return n&&(r+=n),re[1]&q.KSIDE_CASTLE&&(o+="K"),re[1]&q.QSIDE_CASTLE&&(o+="Q"),re[2]&q.KSIDE_CASTLE&&(o+="k"),re[2]&q.QSIDE_CASTLE&&(o+="q"),r+" "+(1===ne?"w":"b")+" "+(o||"-")+" "+(oe===m?"-":algebraic(oe))+" "+ae+" "+ie}()}function setHeader(e){var t,n,r;for(t=0;t<e.length;t+=2)n=e[t],r=e[t+1],n&&("Variant"===n&&(setVariant(r),r=X?i[X]:void 0),"Result"===n&&"*"!==r&&"1-0"!==r&&"0-1"!==r&&"1/2-1/2"!==r&&(r="*"),void 0!==r?de[n]=String(r):H.indexOf(n)>-1?de[n]="Date"===n?"????.??.??":"?":delete de[n]);return de}function updateSetup(e){ce.length>0||le||(e!==j?(de.SetUp="1",de.FEN=e,ce.hash=null):(delete de.SetUp,delete de.FEN,ce.hash=[1178310168,378666140]))}function get(e){var t=Z[c[e]];return t?{type:w[t&b|2],color:3&t,promoted:0!=(t&E)}:null}function calculateLegalMoveInfo(r,a){var i,s,c,l,d,f,p,h,v,E,y,O,S,P,j=ne,C=g|j,A=u;if(e=[],t=0,n=0,o=0,A[0]=A[1]=A[2]=A[3]=A[4]=A[5]=A[6]=A[7]=A[16]=A[17]=A[18]=A[19]=A[20]=A[21]=A[22]=A[23]=A[32]=A[33]=A[34]=A[35]=A[36]=A[37]=A[38]=A[39]=A[48]=A[49]=A[50]=A[51]=A[52]=A[53]=A[54]=A[55]=A[64]=A[65]=A[66]=A[67]=A[68]=A[69]=A[70]=A[71]=A[80]=A[81]=A[82]=A[83]=A[84]=A[85]=A[86]=A[87]=A[96]=A[97]=A[98]=A[99]=A[100]=A[101]=A[102]=A[103]=A[112]=A[113]=A[114]=A[115]=A[116]=A[117]=A[118]=A[119]=0,a!==m){for(S=function chooseKingThreats(e,t){return me&&re[e]?L:re[e]&q.KSIDE_CASTLE&&!Z[t+1]&&!Z[t+2]?re[e]&q.QSIDE_CASTLE&&!Z[t-1]&&!Z[t-2]&&!Z[t-3]?(o=q.KQSIDE_CASTLE,I):(o=q.KSIDE_CASTLE,D):re[e]&q.QSIDE_CASTLE&&!Z[t-1]&&!Z[t-2]&&!Z[t-3]?(o=q.QSIDE_CASTLE,R):M}(j,a),i=0;i<120;++i)if(136&i&&(i+=8),l=Z[i])if(l&j)(!r||(0|l)&r)&&e.push(i);else if(0!=((P=S[i-a+119])&l))if(4&l)for(E=k[l],s=1;s<3;++s)136&(h=i+E[s])||(A[h]|=1,h===a&&(++t,A[i]|=2));else for(v=(E=k[l&b]).length,O=l&_,s=0;s<v;++s)if(y=E[s],!(a>(h=i)&&y<0&&a-h>16||a<h&&y>0&&h-a>16))for(;!(136&(h+=y));){if(A[h]|=1,d=Z[h]){if(d&j)if(h===a){for(c=h-y;c!==i;c-=y)A[c]|=2;A[i]|=2,++t,O&&0==(136&(h+=y))&&(A[h]|=1)}else if(O&&256&P&&t<2)for(p=h+y;0==(136&p);){if(f=Z[p]){f===C&&(A[h]|=4+(Math.abs(y)<<3),++n);break}p+=y}break}if(!O)break}t>1&&(e=[a])}else e=function getPieces(e,t){var n,r,o=[];for(n=0;n<120;++n)136&n&&(n+=8),(r=e[n])&&(r&t)===t&&o.push(n);return o}(Z,j|r)}function validateEnPassant(e,n){var r,o,a,i=n+16*(1===ne?1:-1);return(1!==t||0!=(2&u[n])||0!=(2&u[i]))&&(r=Z[e],Z[n]=r,Z[e]=0,o=Z[i],Z[i]=0,a=inCheck(),Z[e]=r,Z[n]=0,Z[i]=o,!a)}function addCastlingMoves(e){var t,n,r;if(me){if(re[e])for(n=(t=te[e])%8,r=0;r<8;++r)re[e]&1<<r&&canCastle960(Z,t,r,e)&&(l[f++]=(r>n?q.KSIDE_CASTLE:q.QSIDE_CASTLE)+(t<<7)+(t+(r-n)<<y),++r)}else o&q.KSIDE_CASTLE&&(n=(t=te[e])+2,0===u[t+1]&&0===u[t+2]&&(l[f++]=q.KSIDE_CASTLE+(t<<7)+(n<<y))),o&q.QSIDE_CASTLE&&(n=(t=te[e])-2,0===u[t-1]&&0===u[t-2]&&(l[f++]=q.QSIDE_CASTLE+(t<<7)+(n<<y)))}function generateMoves(r,o){var a,i,s,c,m,h,g,v,E,S,P=ne,j=swapColor(P),C=te[P];for(calculateLegalMoveInfo(r,C),p=e.length,f=d,E=0;E<p;++E)if(a=e[E],c=Z[a],!(t&&n&&4&u[a]))if(4&c)for(h=k[c],0!==n&&0!=(4&u[a])&&u[a]>>3!=16||(m=a+h[0],0===Z[m]&&(addPawnMove(a,m,0),G[P]===rank(a)&&(m+=h[0],Z[m]||addPawnMove(a,m,q.BIG_PAWN)))),i=1;i<3;++i)136&(m=a+(g=h[i]))||n&&4&u[a]&&u[a]>>3!==Math.abs(g)||(Z[m]&j?addPawnMove(a,m,q.CAPTURE):m===oe&&validateEnPassant(a,m)&&(l[f++]=q.EP_CAPTURE|a<<7|m<<y));else{if(n&&4&u[a]){if(8&c)continue;if(!(N[a-te[P]+119]&c))continue;h=[g=u[a]>>3,-g]}else h=k[c&b];if(S=a<<7,a===C){for(i=0;i<8;++i)0==(136&(m=a+(g=h[i])))&&(Z[m]?Z[m]&j&&0==(1&u[m])&&(l[f++]=q.CAPTURE|S|m<<y):0==(1&u[m])&&(l[f++]=S|m<<y));0===t&&addCastlingMoves(P)}else for(s=h.length,v=c&_,i=0;i<s;++i)for(g=h[i],m=a;!(136&(m+=g));){if(Z[m]){Z[m]&j&&(0===t||2&u[m])&&(l[f++]=q.CAPTURE|S|m<<y);break}if((0===t||2&u[m])&&(l[f++]=S|m<<y),!v)break}}return pe&&function drop(e,n,r){var o,a,i,s,c;if(!e)for(n&&(n>>=26),s=0;s<5;++s)if((!n||(0|n)==1<<s)&&J._hand[r]&B[s]<<F[s]){for(0===s?(o=16,a=103,i=q.DROP):(o=0,a=119,i=q.DROP|s<<O),c=o;c<=a;++c)136&c&&(c+=8),Z[c]||(0===t||1===t&&2&u[c])&&(l[f++]=i|c<<y);if(n)return}}(o,r,P),f}function inCheckAfterMove(e,t,n,r){var o,i,s,c,u,l,d,f;if(X===a["King of the Hill"]&&e&g&&kingOfTheHillWin(n))return!0;if(r&q.KQSIDE_CASTLE&&(n=1===ne?r&q.KSIDE_CASTLE?117:115:r&q.KSIDE_CASTLE?5:3,e=h,f=!0),(o=te[swapColor(ne)])===m)return!1;if(0==(e&g)&&N[n-o+119]&e)for(u=e&_,c=n+(s=x[n-o+119]);0==(136&c);){if(c===o){if(4&e){if(1==(3&e)?o-n<0:o-n>0)return!0;break}return!0}if(c!==t&&Z[c]||!u)break;c+=s}if(!f){if((i=N[t-o+119])&_&&(s=x[t-o+119])!==x[n-o+119])for(c=o-s;0==(136&c);){if(c!==t&&(l=Z[c])){if(l&ne&&i&l&&l&_)return!0;break}c-=s}if(r&q.EP_CAPTURE&&(i=N[(d=n+16*(1===ne?1:-1))-o+119])&_)for(c=o-(s=x[d-o+119]);0==(136&c);){if(c!==t&&c!==d){if(c===n)break;if(l=Z[c]){if(l&ne&&i&l&&l&_)return!0;break}}c-=s}}return!1}function moveToSan(e,t){var n,r,o,i,s,c,u="";return e&q.KQSIDE_CASTLE?u=e&q.KSIDE_CASTLE?"O-O":"O-O-O":e&q.DROP?((n=e>>O)&&(u+=K[n]),u+="@"+algebraic(o=e>>y&S)):(o=e>>y&S,4&(i=Z[r=e>>7&S])?(e&q.ANY_CAPTURE&&(u+=String.fromCharCode(file(r)+97)+"x"),u+=algebraic(o),e&q.PROMOTION&&(u+="="+K[n=e>>O])):(u+=T[i&v],p>1&&(u+=function getDisambiguator(e,t,n){var r,o,a,i,s,c;if(f<2)return"";for(e&=b,c=0;c<f;++c)if(n===(r=l[c])>>y&&(a=r>>7&S)!==t&&Z[a]&e){if(o=!0,rank(t)===rank(a)){if(i)return algebraic(t);s=!0}if(file(t)===file(a)){if(s)return algebraic(t);i=!0}}return o?i?String(8-rank(t)):String.fromCharCode(file(t)+97):""}(i,r,o)),e&q.ANY_CAPTURE&&(u+="x"),u+=algebraic(o))),t||(e&q.KQSIDE_CASTLE?(r=e>>7&S,o=e>>y&S):e&q.DROP_OR_PROMOTE&&(i=V[n]+ne),inCheckAfterMove(i,r,o,e)&&(he(e,r,o,n),s=d,d=f,c=p,X!==a.Chess&&isVariantWin()?u+="#":generateMoves()-d?u+="+":u+="#",f=d,d=s,p=c,reverseMove(ce.pop()))),u}function kingAttacked(e){return te[e]!==m&&function attacked(e,t){var n,r,o,a,i=k[8],s=8|e;for(n=0;n<8;++n)if(0==(136&(o=t+i[n]))&&((r=Z[o])&s)===s)return!0;for(i=k[128],n=0;n<8;++n)for(o=t+(a=i[n]);0==(136&o);){if(r=Z[o]){if(r&e&&N[t-o+119]&r){if(!(4&r))return!0;if(1===e?t-o<0:t-o>0)return!0}break}o+=a}return!1}(swapColor(e),te[e])}function inCheck(){return kingAttacked(ne)}function inCheckmate(){return inCheck()&&0===generateMoves()}function inStalemate(){var e=!inCheck()&&0===generateMoves();return e&&X===a.Bughouse&&!J.isDependent&&(e=J.siblingGame.inStalemate()),e}function insufficientMaterial(e){var t,n,r=0,o=0,a=0;for(n=0;n<120;++n)if(136&n&&(n+=8),t=Z[n]){if(e&&0==(t&e))continue;if(100&t)return!1;if(8&t){if(o||r++)return!1}else if(16&t){if(r)return!1;if(++o,(rank(n)+n)%2&&++a,a&&o!==a)return!1}}return!0}function inThreefoldRepetition(){if(ae<8)return!1;for(var e,t=getCurrentHash(),n=!1,r=ae,o=!1,a=ce,i=a.length-1;;){if((i-=2)<0){if(a.id){i=a.atMoveNode+i+2,a=ue[a.parentId];continue}if(-2===i)return!1;e=a.hash,o=!0}else e=a[i].hash,a[i].halfMoves>r||r<2?o=!0:r=a[i].halfMoves;if(e[0]===t[0]&&e[1]===t[1]){if(n)return!0;n=!0}if(o)return!1}}function modifyHand(e){var t,n,o,i,s,c,u,l,d,f=e.move;if(X===a.Crazyhouse||f&q.DROP?(n=J._hand,s=e.hash,d=e.color):(n=J.siblingGame._hand,e.handSibling=!0,ee&&((c=J.siblingGame._history()).length?s=c[c.length-1].hash:(c.hash||(c.hash=J.siblingGame._hashPosition()),s=c.hash)),d=swapColor(e.color)),e.captured){switch((e.captured&E?4:e.captured&b)&b){case 4:u=0;break;case 8:u=1;break;case 16:u=2;break;case h:u=3;break;default:u=4}t=1<<F[u],ee&&(i=n[d]>>F[u]&B[u],l=r.zobristPiece[i+63*u+(1===d?0:315)])}else t=-1<<F[o=f>>O],ee&&(i=n[d]>>F[o]&B[o],l=r.zobristPiece[i-1+63*o+(1===d?0:315)]);n[d]+=t,e.handChange=t,ee&&hashNum(s,[31*l[0]>>>0,17*l[1]>>>0])}function makeMoveChess(e,t,n,o){var a,i,s,c,u,l,d,f,p=ne,b=swapColor(p),_={move:e,epSquare:oe,halfMoves:ae,castlingW:re[1],castlingB:re[2],color:p},y=1===p;ee&&(c=getCurrentHash(),_.hash=c,hashNum(c,r.zobristTurn),oe!==m&&hashEP(Z,c,oe+(y?16:-16),4|p)),0==(e&q.KQSIDE_CASTLE)?pe&&e&q.DROP?(Z[n]=V[o]|p,ee&&hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[Z[n]]+8*(7-rank(n))+file(n)]),modifyHand(_),d=0):(d=Z[t],(f=Z[n])&&(_.captured=f,ee&&hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[Z[n]&v]+8*(7-rank(n))+file(n)]),f&h&&re[b]&&(me?rank(n)===(y?0:7)&&(s=1<<file(n),re[b]&s&&(re[b]^=s,ee&&(s>1<<file(te[p])?hashNum(c,r.zobristCastle[b-1]):hashNum(c,r.zobristCastle[b+1])))):n===(y?7:119)?re[b]&q.KSIDE_CASTLE&&(re[b]^=q.KSIDE_CASTLE,ee&&hashNum(c,r.zobristCastle[b-1])):n===(y?0:112)&&re[b]&q.QSIDE_CASTLE&&(re[b]^=q.QSIDE_CASTLE,ee&&hashNum(c,r.zobristCastle[b+1])))),Z[n]=e&q.PROMOTION?V[o]|p|E:Z[t],Z[t]=0,ee&&(hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[d&v]+8*(7-rank(t))+file(t)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[Z[n]&v]+8*(7-rank(n))+file(n)]))):d=g,e&q.EP_CAPTURE?(y?(l=n+16,u=6):(l=n-16,u=8),_.captured=4|b,Z[l]=0,ee&&hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[4|b]+8*(u-rank(n))+file(n)])):d&g?(me?(e&q.KQSIDE_CASTLE&&(Z[n]=0,Z[t]=0,e&q.KSIDE_CASTLE?y?(a=118,i=117):(a=6,i=5):y?(a=114,i=115):(a=2,i=3),Z[a]=p|g,Z[i]=p|h,ee&&(hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[g|p]+8*(7-rank(t))+file(t)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[h|p]+8*(7-rank(n))+file(n)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[g|p]+8*(7-rank(a))+file(a)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[h|p]+8*(7-rank(i))+file(i)]))),ee&&(0!=(re[p]&re[p]-1)?(hashNum(c,r.zobristCastle[p-1]),hashNum(c,r.zobristCastle[p+1])):re[p]>1<<file(te[p])?hashNum(c,r.zobristCastle[p-1]):hashNum(c,r.zobristCastle[p+1])),te[p]=a||n):(e&q.KQSIDE_CASTLE&&(Z[n]=Z[t],Z[t]=0,e&q.KSIDE_CASTLE?(a=n-1,i=n+1):(a=n+1,i=n-2),Z[a]=Z[i],Z[i]=0,ee&&(hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[g|p]+8*(7-rank(t))+file(t)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[h|p]+8*(7-rank(i))+file(i)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[g|p]+8*(7-rank(n))+file(n)]),hashNum(c,r.zobristPiece[64*r.zobristPieceValueNumbers[h|p]+8*(7-rank(a))+file(a)]))),ee&&(re[p]&q.KSIDE_CASTLE&&hashNum(c,r.zobristCastle[p-1]),re[p]&q.QSIDE_CASTLE&&hashNum(c,r.zobristCastle[p+1])),te[p]=n),re[p]=0):d&h&&re[p]&&(me?rank(t)===(y?7:0)&&(s=1<<file(t),re[p]&s&&(re[p]^=s,ee&&(s>1<<file(te[p])?hashNum(c,r.zobristCastle[p-1]):hashNum(c,r.zobristCastle[p+1])))):t===(y?119:7)?re[p]&q.KSIDE_CASTLE&&(re[p]^=q.KSIDE_CASTLE,ee&&hashNum(c,r.zobristCastle[p-1])):t===(y?112:0)&&re[p]&q.QSIDE_CASTLE&&(re[p]^=q.QSIDE_CASTLE,ee&&hashNum(c,r.zobristCastle[p+1]))),e&q.BIG_PAWN?(oe=y?n+16:n-16,ee&&hashEP(Z,c,n,4|b)):oe=m,4&d||e&q.ANY_CAPTURE?ae=0:ae++,ne=b,ce.push(_)}function makeMoveVariant(e,t,n,o){var i,s=ne;makeMoveChess(e,t,n,o),i=ce[ce.length-1],pe?(ae=i.halfMoves+1,i.captured&&modifyHand(i),X===a.Bughouse&&(i.bughouseOrder=J.moveCount()-1+J.siblingGame.moveCount())):X===a["3-check"]&&kingAttacked(ne)&&(i.checked=!0,ee&&fe[s]&&hashNum(i.hash,r.zobristCheck[fe[s]+(1===s?-1:2)]),++fe[s],ee&&hashNum(i.hash,r.zobristCheck[fe[s]+(1===s?-1:2)]))}function reverseMove(e){var t,n,r=ne,o=swapColor(r),i=e.move,s=i>>y&S,c=i>>7&S;if(ne=o,re[2]=e.castlingB,re[1]=e.castlingW,oe=e.epSquare,ae=e.halfMoves,X){if(me&&i&q.KQSIDE_CASTLE)return i&q.KSIDE_CASTLE?1===o?(n=118,t=117):(n=6,t=5):1===o?(n=114,t=115):(n=2,t=3),Z[n]=0,Z[t]=0,Z[c]=o|g,Z[s]=o|h,void(te[o]=c);if(e.handChange&&(X!==a.Crazyhouse&&e.handSibling?J.siblingGame._hand[swapColor(o)]-=e.handChange:J._hand[o]-=e.handChange),i&q.DROP)return void(Z[s]=0);e.checked&&--fe[o]}i&q.PROMOTION?(Z[c]=4|o,Z[s]=i&q.CAPTURE?e.captured:0):(Z[c]=Z[s],i&q.KQSIDE_CASTLE?(Z[s]=0,i&q.KSIDE_CASTLE?(t=s+1,n=s-1):(t=s-2,n=s+1),Z[t]=o|h,Z[n]=0,te[o]=c):(s===te[o]&&(te[o]=c),i&q.CAPTURE?Z[s]=e.captured:(Z[s]=0,i&q.EP_CAPTURE&&(Z[s-(1===o?-16:16)]=4|r))))}function beautifyMove(e,t,n){var r,o,a=e>>y&S,i={color:ne,to:algebraic(a),flags:e&S};return pe&&0!=(e&q.DROP)?(o=e>>O,i.drop=o,i.piece=V[o]+ne):(r=e>>7&S,i.from=algebraic(r),i.piece=Z[r],e&q.PROMOTION&&(o=e>>O,i.promotion=V[o]+ne),e&q.CAPTURE?i.captured=Z[a]:e&q.EP_CAPTURE&&(i.captured=4|swapColor(ne))),i.san=t||moveToSan(e,n),i}function isVariantWin(){return X===a["3-check"]?3===fe[swapColor(ne)]:X===a["King of the Hill"]?kingOfTheHillWin(te[swapColor(ne)]):void 0}function isBughouseWin(){if(X===a.Bughouse)return J.siblingGame.inCheckmate()}function createVariation(){var e=[],t=generateFen(),n=ce.length-1,r=ce[n];return!!r&&(e.parentId=le,e.id=ue.length,ce.curFen=t,r.lines||(r.lines=[]),r.lines.push(e.id),r.move?reverseMove(r):(oe=r.epSquare,--ae,ne=swapColor(ne)),2===ne&&--ie,e.atMoveNode=n,e.hash=n?ce[n-1].hash:ce.hash,le=e.id,ue.push(e),ce=e,!0)}function selectLine(e){var t=generateFen();ce.curFen=t,ce=ue[e],le=e,load(ce.curFen,X,!0,!0)}return J={WHITE:1,BLACK:2,PAWN:4,KNIGHT:8,BISHOP:16,ROOK:h,QUEEN:64,KING:g,FLAGS:q,load:load,reset:reset,moves:function moves(e){var t,n,r,moves=[],o=moveToSan;for(e&&(e.verbose&&(o=beautifyMove),e.type&&(n=e.type|e.type<<24),r=e.noDrop),generateMoves(n,r),t=0;t<f;++t)moves.push(o(l[t]));return moves},inCheck:inCheck,inCheckmate:inCheckmate,inStalemate:inStalemate,isBughouseWin:isBughouseWin,in50MoveRule:function in50MoveRule(){return ae>=100},inDraw:function inDraw(){return ae>=100||inStalemate()||insufficientMaterial()||inThreefoldRepetition()||Boolean(function isBughouseDraw(){if(X===a.Bughouse)return J.siblingGame.in50MoveRule()||J.siblingGame.inThreefoldRepetition()}())},insufficientMaterial:insufficientMaterial,inThreefoldRepetition:inThreefoldRepetition,isVariantWin:isVariantWin,gameOver:function gameOver(){return J.inDraw()||inCheckmate()||Boolean(isVariantWin())||Boolean(isBughouseWin())},isPositionValid:function isPositionValid(e){var t,n,r,o=0;if(!1!==(e=e||{}).pawns)for(t=0;t<=119;){if(4&(r=Z[t]))return!1;8==++t&&(t=112)}if(!1!==e.kings){for(t=0;t<=119;++t)if(136&t&&(t+=8),(r=Z[t])&g){if(++o>2)return!1;if(n&&n&r)return!1;n=3&r}if(2!==o)return!1}return!1===e.check||!1===e.kings&&te[swapColor(ne)]===m||!kingAttacked(swapColor(ne))},validateFen:validateFen,fen:generateFen,pgn:function pgn(e){return(e=e||{}).useResultHeader||le||(isVariantWin()||inCheckmate()?de.Result=2===ne?"1-0":"0-1":J.inStalemate()?de.Result="1/2-1/2":isBughouseWin()&&(de.Result=1===J.siblingGame.turn()?"1-0":"0-1")),W(e,de,ue,se,X,J)},loadPgn:function loadPgn(e,t,n){var r,o,i,s,c,u,l,d,f,p={},m=0;if("number"!=typeof t&&(n=n||t,t=0),n=n||{},"string"==typeof e&&(n.singleGame&&(e=e.replace(/(?:\r?\n\s*){2,}/g,"\n")),e=J.tokenizePgn(e,n)),t<0&&(t=e.length+t),!(s=e[t]))return!1;for(reset(),o=s.length,r=0;r<o&&"tagName"===(i=s[r]).type;++r){if(!s[r+1]||"tagValue"!==s[r+1].type)return!1;++r,"FEN"===i.value?l=completeFen(s[r].value):p[i.value]=s[r].value}if(n.variant&&(p.Variant=n.variant),p.Variant&&!l&&(l=j),l||"1"===p.SetUp)if("0"===p.SetUp)p.FEN=l;else if(!l||!load(l,p.Variant))return!1;for(J.header(p),u=(c=J)._history();r<o;++r)if("san"===(i=s[r]).type&&0===m){if(!c.move(i.value)){if(!n.skipBadLines||!(0!==le||ce.length&&n.allowBadMainLine))return reset(),!1;m=1}}else if("result"===i.type&&"*"===de.Result)setHeader(["Result",i.value]);else if("a"===i.type&&0===m&&u[u.length-1])u[u.length-1].annotation=i.value;else if("nag"!==i.type&&"aa"!==i.type||0!==m||!u[u.length-1]){if("comment"===i.type&&0===m)u.length?(i.value.trim()&&(u[u.length-1].comment=i.value),i.commands&&(u[u.length-1].commands=i.commands,i.commands.clk&&(u[u.length-1].time=(d=i.commands.clk,f=void 0,10*(3600*(f=d.split(":"))[0]+60*f[1]+1*f[2]))))):(u.initComment=String(i.value),i.commands&&(u.commands=i.commands));else if("variationStart"===i.type){if(m>0)++m;else if(!createVariation())return reset(),!1;u=c._history()}else if("variationEnd"===i.type)m>0&&--m,0===m&&(selectLine(u.parentId),u=c._history());else if("number"===i.type&&X===a.Bughouse){if(!(c=/b/i.test(i.value.slice(-1))?J.siblingGame:J))return!1;u=c._history()}}else u[u.length-1].additionalAnnotation||(u[u.length-1].additionalAnnotation=[]),-1===u[u.length-1].additionalAnnotation.indexOf(i.value)&&u[u.length-1].additionalAnnotation.push(i.value);return!0},header:function header(e){return Array.isArray(e)?setHeader(e):"object"===s()(e)?(Object.keys(e).forEach((function(t){setHeader([t,e[t]])})),de):de},turn:function turn(e){return 1!==e&&2!==e||(ne=e),ne},move:function playMove(e){var t,n,o,i,s,u,d,p,h,v,_,j,k;if("string"==typeof e){switch(e[i=e.length-1]){case"+":case"#":e=e.substr(0,i)}for(h=P.indexOf(e[0])>6?A[e[0]]:"O"===e[0]?g:4,pe&&(-1===e.indexOf("@")?v=!0:(v=!1,h<<=24)),generateMoves(h,v),i=0;i<f;++i)if(e===(u=moveToSan(l[i],!0))){n=l[i];break}if(!n)return"--"===e?function makeNullMove(){var e,t={color:ne,san:"--",epSquare:oe},n={color:ne,san:"--"};return ee&&(e=getCurrentHash(),t.hash=e,hashNum(e,r.zobristTurn),oe!==m&&hashEP(Z,e,oe+(1===ne?16:-16),4|ne)),oe=m,ae++,1===(ne=swapColor(ne))&&++ie,ce.push(t),n}():(e=Chess.fixSanMove(e,Z,ne))?playMove(e):null;d=n>>7&S,p=n>>y&S,o=n>>O}else{if(e.drop){switch(e.drop){case"p":o=0;break;case"n":o=1;break;case"b":o=2;break;case"r":o=3;break;case"q":o=4;break;default:return null}h=1<<26+o}else{if(e.promotion)switch(e.promotion){case"q":o=4;break;case"n":o=1;break;case"r":o=3;break;case"b":o=2;break;default:return null}d=c[e.from],v=!0,h=Z[d]&b}for(p=c[e.to],t=((o?o<<O:0)|p<<y)>>7|d,generateMoves(h,v),i=0;i<f;++i)if(l[i]>>7===t){n=l[i];break}if(!n)return(e=Chess.fixObjMove(e,Z,ne))?playMove(e):null}return k=n&q.DROP_OR_PROMOTE?V[o]+ne:Z[d],s=beautifyMove(n,u,!0),_=inCheckAfterMove(k,d,p,n),he(n,d,p,o),_&&(X!==a.Chess&&isVariantWin()||0===generateMoves()?s.san+="#":s.san+="+"),(j=ce[ce.length-1]).san=s.san,s.piece&E&&(j.promoted=!0),1===ne&&++ie,s},undo:function undo(e){var t=ce.pop();return t?(1===ne&&--ie,t.move?(reverseMove(t),!!e||beautifyMove(t.move,t.san)):(oe=t.epSquare,--ae,ne=swapColor(ne),!!e||{san:"--",color:t.color})):null},clear:function clear(e){_clear(e)},put:function put(e,t,n){var r,o=c[t],a=!1,i=Z[o],s=3&i,u=e.color;if(isNaN(o)||!e.type||!u||-1===P.indexOf(e.type))return!1;if(Z[o]=A[e.type]|u|(e.promoted?E:0),Z[o]&g&&(te[u]=o),i&&Z[te[s]]&&Z[te[s]]!==(g|s)){for(r=0;r<120;++r)136&r&&(r+=8),Z[r]===(g|s)&&(te[s]=r,a=!0);a||(te[s]=m)}return n||load(generateFen(),X,!0,!1),!0},get:get,remove:function remove(e,t){var n,r=Z[c[e]],o=get(e),a=3&r;if(Z[c[e]]=0,r&g)for(te[a]=m,re[a]=0,n=0;n<120;++n)if(136&n&&(n+=8),Z[n]===(g|a)){te[r.color]=n;break}return t||load(generateFen(),X,!0,!1),o},history:function history(e,t){for(var n,r=[],o=ce,a=o.length;;){if(-1==--a){if(o.id&&!t){a=o.atMoveNode,o=ue[o.parentId];continue}break}e?((n=beautifyMove(o[a].move,o[a].san)).color=o[a].color,!a&&o.initComment&&(n.firstComment=o.initComment),void 0!==o[a].comment&&(n.comment=o[a].comment),void 0!==o[a].time&&(n.time=o[a].time),void 0!==o[a].annotation&&(n.annotation=o[a].annotation),void 0!==o[a].additionalAnnotation&&(n.additionalAnnotation=o[a].additionalAnnotation),void 0!==o[a].commands&&(n.commands=o[a].commands),void 0!==o[a].captured&&(n.captured=o[a].captured),void 0!==o[a].promoted&&(n.promoted=o[a].promoted),void 0!==o[a].lines&&(n.lines=o[a].lines),void 0!==o[a].bughouseOrder&&(n.bughouseOrder=o[a].bughouseOrder),P.indexOf(o[a].san[0])>6?n.piece=A[o[a].san[0]]:"O"===o[a].san[0]?n.piece=g:n.piece=4,n.piece|=n.color,r.unshift(n)):r.unshift(o[a].san)}return r},hashes:function hashes(){for(var hashes=[],e=ce,t=e.length;;){if(-1==--t){if(e.id){t=e.atMoveNode,e=ue[e.parentId];continue}e.hash||getCurrentHash(),hashes.unshift(e.hash);break}hashes.unshift(e[t].hash)}return hashes},moveCount:function moveCount(){return ce.length},startingMoveNumber:function startingMoveNumber(){return se},completeFen:completeFen,createVariation:createVariation,selectLine:selectLine,hash:function hash(){var hash=getCurrentHash();return X!==a.Bughouse||J.isDependent?hash:[hash,J.siblingGame.hash()]},hashing:function hashing(e){ee=e,X!==a.Bughouse||J.isDependent||J.siblingGame.hashing(ee)},hand:function hand(){if(pe)return handToString(J._hand[1],!0)+handToString(J._hand[2])},checks:function checks(){if(X===a["3-check"])return[fe[1],fe[2]]},tokenizePgn:Q,_hand:[],_history:function _history(e){return e&&(le=(ce=e).id),ce},_lines:function _lines(){return ue},_hashPosition:hashPosition,_board:function _board(){return Z}},$&&load($,Y)||reset(),J}return Chess.fixSanMove=function(e,t,n){var r,o,a;if(/0|[?!+#]$|[18][QNRB]$|^P/.test(e))return e.replace(/[?!+#]+$/,"").replace(/0/g,"O").replace(/([18])([QNRB])$/,"$1=$2").replace(/^P/,"");if(o=e.indexOf("=")>0?-4:-2,r=e.substr(o,2),n=swapColor(n),t[c[r]]&n||/^[a-h]x?[a-h]/.test(e)){if(-1===e.indexOf("x"))return e.slice(0,o)+"x"+e.substr(o)}else if(e.indexOf("x")>-1)return e.replace("x","");return(a=e.match(/^([KQNRB]?)([a-h][1-8]?|[1-8])(x?[a-h][1-8])=?(.?)$/))?t[c[a[2]]]?{from:a[2],to:r,promotion:a[4].toLowerCase()}:a[1]+a[3]+a[4]:void 0},Chess.fixObjMove=function(e,t,n){if(t[c[e.from]]===(g|n)&&e.to&&e.from[1]===e.to[1]){if(e.from<e.to)return"O-O";if(e.from>e.to)return"O-O-O"}},Chess.variants=i,Chess}(),a=function ENGINE_MANAGER(e){var t=["bench","d","eval","flip","isready","perft","ponderhit","stop","uci","ucinewgame"],n=[{cmd:"position",args:["fen","startpos","moves","continuation"]},{cmd:"go",args:["binc","btime","confidence","depth","infinite","mate","mindepth","mintime","maxdepth","maxtime","movestogo","movetime","ponder","searchmoves","shallow","winc","wtime"]}],o=["moves","searchmoves"],a=["ponder","infinite","startpos"],i=/Total Evaluation[\s\S]+\n$/i;function createWebWorker(e,t,n){var r=new Worker(e||"stockfish.js"),o={terminate:function terminate(){r.terminate()},postMessage:postMessage,addEventListener:function addEventListener(e,t){o["on"+e]=t}};function postMessage(e){r.postMessage(e)}return r.onmessage=function(e){o.onmessage(e)},r.onerror=function(a){if(t.pathToNonWasmEngine&&t.pathToNonWasmEngine!==e){a.preventDefault&&a.preventDefault();try{r.terminate()}catch(a){}return(r=createWebWorker(t.pathToNonWasmEngine,t,n)).onmessage=function(e){o.onmessage(e)},function requeue(e){e.length&&e.forEach((function(e){e.message="",postMessage(e.cmd)}))}(n._activeCommands()),!1}if(t.onError)return t.onError(a)},o}function parseSearchLine(e){var t,n,r,o,a,i={},s=["lowerbound","upperbound","score"],c=["depth","seldepth","time","nodes","multipv","cp","mate","currmovenumber","hashfull","nps","tbhits","sbhits","cpuload"],u=["depth","seldepth","time","nodes","pv","multipv","score","cp","mate","lowerbound","upperbound","currmove","currmovenumber","hashfull","nps","tbhits","sbhits","cpuload","string","refutation","currline","bestmove","ponder","baseTurn","pvSan","bestmoveSan","ponderSan","bmc"],l=["pv","pvSan","string","refutation","currline"];for(n=(t=e.split(" ")).length,r="info"===t[0]?1:0,i.mtype=t[0];r<n;r+=1)t[r]&&(!a||o&&u.indexOf(t[r])>-1?(a=t[r],s.indexOf(a)>-1?(i[a]=!0,a=null):o=l.indexOf(a)>-1||-1===u.indexOf(a)):(c.indexOf(a)>-1&&(t[r]=Number(t[r])),o?(void 0===i[a]&&(i[a]=[]),i[a].push(t[r])):(i[a]=t[r],a=null)));return"(none)"!==i.bestmove&&"0000"!==i.bestmove||(i.bestmove=void 0,i.bestmoveSan=void 0),"(none)"!==i.ponder&&"0000"!==i.ponder||(i.ponder=void 0,i.ponderSan=void 0),i}function getFirstWord(e){var t=e.indexOf(" ");return-1===t?e:e.substr(0,t)}return function loadEngine(s,c){var u,l,d={},f=function createWorker(e,t){var n=e.pathToNonWasmEngine&&"undefined"==typeof WebAssembly?e.pathToNonWasmEngine:e.enginePath||e.pathToEngineWorker;if(e.pathToWasmEngine&&(n+="#"+e.pathToWasmEngine),"undefined"!=typeof Worker)return createWebWorker(n,e,t)}(s,d),p=[],m=[];function onmessage(t){var n,r,o,a,s,c,u="string"==typeof t?t:t.data;if(d)if((null===(n=u.indexOf)||void 0===n?void 0:n.call(u,"\n"))>-1)for(s=u.split("\n"),c=0;c<s.length;c+=1)onmessage(s[c]);else if(e.log&&console.log("debug (onmessage): "+u),d.stream&&d.stream(u),p.length&&0!==u.indexOf("No such option")&&0!==u.indexOf("id ")&&0!==u.indexOf("Stockfish")&&0!==u.indexOf("info string variant")&&(o=function determineQueueNum(e,t){var n,r,o,a,i=getFirstWord(e);if("bench"!==t[0].cmd&&"perft"!==t[0].cmd)for(n="uciok"===i||"option"===i?"uci":"readyok"===i||"ready"===i?"isready":"json"===i?"fetch":"bestmove"===i||"info"===i?"go":"other",a=t.length,o=0;o<a;o+=1)if((r=getFirstWord(t[o].cmd))===n||"other"===n&&("d"===r||"eval"===r))return o;return 0}(u,p),a=p[o])){if(a.stream&&!a.discard&&a.stream(u),void 0===a.message?a.message="":""!==a.message&&(a.message+="\n"),a.message+=u,"uciok"===getFirstWord(u))r=!0;else if("readyok"===getFirstWord(u)||"ready"===getFirstWord(u))r=!0,d.ready=!0;else if(0!==u.indexOf("bestmove")&&"bestmove"!==getFirstWord(u)||"bench"===a.cmd)if("d"===a.cmd)0!==u.indexOf("Legal uci moves")&&0!==u.indexOf("Key is")||(a.done=!0,r=!0);else if("fetch json"===a.cmd)try{a.message=JSON.parse(a.message.replace(/^json /gm,"").replace(/\n/g,"")),r=!0}catch(t){}else"eval"===a.cmd?i.test(a.message)&&(r=!0):(0===u.indexOf("pawn key")||0===u.indexOf("Nodes/second")||0===u.indexOf("Unknown command"))&&(r=!0);else r=!0,a.message=u;r&&(p.splice(o,1),a.cb&&!a.discard?a.cb(a.message):a.ondiscard&&a.ondiscard())}}function bestMoveSearch(){var t,n,r,o,a,i=1,s=[],c=[],l=null,f=m[0].args,p=m[0].cb,h=m[0].stream,g=f.timeout,b=1;function convertpv(e){var t=[],n=c[e]||createSanPv(s[e]);return s[e].forEach((function oneach(e,r){t.push({moveSan:n[r],moveLan:e})})),t}function getpv(e,t,n,r){var o;for(o=s.length-1;o>=0;o-=1)if(s[o][0]===e)return convertpv(o);return n?[{moveSan:t,moveLan:e},{moveSan:r,moveLan:n}]:t?[{moveSan:t,moveLan:e}]:[]}function convertScore(e){0===e.mate?(e.mateIn=0,e.cp=-31800*b):(e.mateIn=Number(e.mate*b)||null,"number"!=typeof e.mateIn||isNaN(e.mateIn)||"number"==typeof e.cp?(e.cp*=b,9===Math.abs(e.cp)&&(e.cp=0),f.normalize&&e.depth<=14&&"number"==typeof loadEngine._previousCP&&1===e.multipv&&function normalize(e){var t=.03*Math.pow(32,e.depth/14);e.cp=loadEngine._previousCP+(e.cp-loadEngine._previousCP)*t}(e)):e.cp=31800*b*(e.mate/Math.abs(e.mate))),e.score=e.cp/100}function addBestMoveProps(a){var s;if(a.baseTurn=r,a.cp=t,a.score=t/100,a.mate=n,a.mateIn=l,a.depth=i,a.moveLan=a.bestmove,a.moveLan){if(a.move=e.uciToObj(a.moveLan)[0],!(s=o.move(a.move)))throw d.forceStop(),new Error("Bad moveLan in line: "+a.moveLan+" at "+o.fen()+"\ndata: "+JSON.stringify(a)+"\nargs: "+JSON.stringify(f));if(a.moveSan=a.bestmoveSan=s.san,a.ponder&&("(none)"!==a.ponder||"0000"!==a.ponder)){if(!(s=o.move(e.uciToObj(a.ponder)[0])))throw d.forceStop(),new Error("Bad ponder in line: "+a.ponder+" at "+o.fen()+"\ndata: "+JSON.stringify(a)+"\nargs: "+JSON.stringify(f));a.ponderSan=s.san,o.undo(!0)}o.undo(!0)}}function createSanPv(t){var n,r,a=t.length,i=[];for(n=0;n<a;++n){if(!(r=o.move(e.uciToObj(t[n])[0])))throw d.forceStop(),new Error("Bad pv in line: "+t[n]+" ("+n+") at "+o.fen()+"\npv: "+JSON.stringify(t)+"\nargs: "+JSON.stringify(f));i.push(r.san)}for(n=0;n<a;++n)o.undo(!0);return i}function createTimeout(){g&&(clearTimeout(u),u=setTimeout((function(){d.stop(),p&&(p(),p=void 0)}),g))}f.timeout=void 0,m[0].started=!0,f.difficulty>=0&&f.difficulty<20?(d.setoption("Skill Level",f.difficulty),f.maximumError>=0&&f.maximumError<=4999&&d.setoption("Skill Level Maximum Error",f.maximumError),f.errorProbability>=1&&f.errorProbability<=128&&d.setoption("Skill Level Probability",f.errorProbability)):d.setoption("Skill Level",20),void 0!==f.contempt?d.setoption("Contempt",f.contempt):d.setoption("Contempt","0"),f.multiPv>1?d.setoption("MultiPV",f.multiPv):d.setoption("MultiPV",1),f.movetime||f.wtime&&f.btime||f.depth||(f.btime=f.btime||72e3,f.wtime=f.wtime||72e3),!f.startpos&&f.fen||f.moves||f.variant?(o=e.createGame({fen:f.fen?(a=f.fen,(a+"").replace(/\[([qrbnp]*)\]/i,"/$1").replace(/([0-3])\+([0-3]) (\d+ \d+)/,(function(e,t,n,r){return r+" +"+(3-t)+"+"+(3-n)}))):"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",moves:f.moves,variant:f.variant,disableHashing:!0})).turn()===o.WHITE?r="w":(r="b",b=-1):(r="w",o=e.createGame({disableHashing:!0})),d.setVariant(f.variant),d.position(f),d.go(f,(function returnBestMove(e){var n=parseSearchLine(e);if(addBestMoveProps(n),i>14&&t<5e3&&t>-5e3&&(loadEngine._previousCP=t),n.pv=getpv(n.moveLan,n.moveSan),1===n.pv.length&&n.ponder&&(n.pv=getpv(n.moveLan,n.moveSan,n.ponder,n.ponderSan)),p)try{p(n)}catch(r){console.error(r)}m.shift(),m.length>0&&bestMoveSearch(),clearTimeout(u)}),(function streamInfo(e){var o=parseSearchLine(e);o.score&&(o.baseTurn=r,convertScore(o),!o.multipv&&o.depth&&(o.multipv=1),1!==o.multipv&&0!==o.depth||(t=o.cp,n=o.mate,l=o.mateIn)),o.pv&&h&&(o.pvSan=createSanPv(o.pv)),!o.pv||o.lowerbound||o.upperbound||(s.push(o.pv),h&&c.push(o.pvSan)),o.depth>i?i=o.depth:"bestmove"===o.mtype&&addBestMoveProps(o),!h||0===o.mateIn&&o.pv||h(o),createTimeout()})),createTimeout()}function startUp(){d.isready((function onstart(){s.settings?d.uci((function onuci(){Object.keys(s.settings).forEach((function oneach(e){d.setoption(e,s.settings[e])})),c&&c(d)})):c&&c(d)}))}return d.send=function(t,n,r){var o;t=String(t).trim(),e.log&&console.log("debug (send): "+t),"ucinewgame"!==t&&"flip"!==t&&"stop"!==t&&"ponderhit"!==t&&0!==t.indexOf("position")&&0!==t.indexOf("setoption")?p[p.length]={cmd:t,cb:n,stream:r}:o=!0,f&&(f.postMessage(t),o&&n&&setTimeout(n,0))},d._activeCommands=function(){return p},d.quit=function(){f&&f.terminate&&(f.terminate(),f=null,d.ready=void 0),clearTimeout(u)},t.forEach((function oneach(e){d[e]=function makeSCmd(t,n){d.send(e,t,n)}})),n.forEach((function oneach(e){d[e.cmd]=function makeCCmd(t,n,r){var i=[e.cmd];l&&t.fen&&(t.fen=function convertStockfishVariantFen(e){return(e+"").replace(/^([^/]+)((?:\/[^/]+){7})\/([qrbnp]*)/i,"$1$2[$3]").replace(/( \d+ \d+) \+([0-3])\+([0-3])/,(function(e,t,n,r){return" "+(3-n)+"+"+(3-r)+t}))}(t.fen)),e.args.forEach((function oneach(e){if(t[e]||0===t[e]){if(o.indexOf(e)>-1){if(!t[e]||!t[e].length)return;Array.isArray(t[e])&&(t[e]=t[e].join(" "))}i.push(e),-1===a.indexOf(e)&&i.push(t[e])}})),d.send(i.join(" "),n,r)}})),d.setoption=function(e,t){d.send("setoption name "+e+" value "+t)},d.setVariant=function(e){var t;e!==l&&(t=String(e).toLowerCase().replace(/ |-/g,""),e&&"chess"!==t?"chess960"===t?(d.setoption("UCI_Variant","chess"),d.setoption("UCI_Chess960","true")):("threecheck"===t&&(t="3check"),d.setoption("UCI_Variant",t),d.setoption("UCI_Chess960","false")):(t=void 0,d.setoption("UCI_Variant","chess"),d.setoption("UCI_Chess960","false")),l=t)},d.loadBook=function(e,t){r.loadBook(e,(function onload(n,r){d.book=r,d.pathToBook=e,d.bookLoaded=!0,n&&(console.error("Error loading opening book."),console.error(n),d.pathToBook=null,d.bookLoaded=!1),t()}))},d.getBestMove=function(t,n,r){var o;if((t=t||{}).fen=t.fen||t.baseFen,t.is960&&(t.variant="Chess960"),d.bookLoaded&&t.useBook&&(o=function getBookMove(t){var n,r,o;if(o=t.moves&&t.moves.length?e.getFenFromMoves(t.fen,t.moves,t.variant):t.fen,(n=d.book.pick({fen:o,type:void 0!==t.bookPick?t.bookPick:"random",chess960:"Chess960"===t.variant}))&&(e.getLegalMoves(o,t.variant).some((function(e){if(e.from+e.to+(e.promotion||"")===n)return r=e,!0})),r))return{moveSan:r.san,moveLan:n,move:{from:r.from,to:r.to,promotion:r.promotion||null},baseTurn:o.split(" ")[1],pv:[{moveSan:r.san,moveLan:n}],depth:null,score:null,mateIn:null,isBookMove:!0}}(t)))return setTimeout((function(){o.mtype="bestmove",n(o)}),0);!function queueBestMoveSearch(e,t,n){m.push({args:e,cb:t,stream:n}),1===m.length&&bestMoveSearch()}(t,n,r)},d.stopAll=function(t){var n,r=p.length,o=0;function ondiscard(){0==(o-=1)&&t()}for(m=[],n=0;n<r;n+=1)e.log&&console.log("debug (stop_moves): "+n,getFirstWord(p[n].cmd)),"go"!==getFirstWord(p[n].cmd)||p[n].discard||(d.stop(),p[n].discard=!0,t&&(o+=1,p[n].ondiscard=ondiscard));t&&!o&&d.isready(t)},d.restartEngine=function(e){return d.stopAll(),d.quit(),p=[],m=[],d.bookLoaded&&!s.book&&((s=JSON.parse(JSON.stringify(s))).book=d.book),loadEngine(s,e)},d.forceStop=function(){d.stopAll((function(){}))},d.stopFast=function(e,t){var n;d.stopAll((function(){clearTimeout(n),e(d)})),n=setTimeout((function(){d.restartEngine(e)}),t||5e3)},"undefined"!=typeof Worker&&(function addListener(){f.addEventListener("message",onmessage,!1)}(),s.book&&(d.book=s.book,d.bookLoaded=!0,d.pathToBook=s.pathToBook),!d.book&&s.pathToBook?d.loadBook(s.pathToBook,startUp):setTimeout(startUp,0),d.getFenFromMoves=e.getFenFromMoves,d.getLegalMoves=e.getLegalMoves,d.getPositionInfo=e.getPositionInfo,d.isFenValid=e.isFenValid,d.ready=!1,d)}},function(){var e,t=o(),n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",i=252,c={4:"p",5:"P",6:"p",8:"n",9:"N",10:"n",16:"b",17:"B",18:"b",32:"r",33:"R",34:"r",64:"q",65:"Q",66:"q",128:"k",129:"K",130:"k"},u="pnbrq",l=512,d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!?{~}(^)[_]@#$,./&-*++=",f="qnrbkp";function decodeTCN(e){var t,n,r,o,a=e.length,i=[];for(t=0;t<a;t+=2)o={},n=d.indexOf(e[t]),(r=d.indexOf(e[t+1]))>63&&(o.promotion=f[Math.floor((r-64)/3)],r=n+(n<16?-8:8)+(r-1)%3-1),n>75?o.drop=f[n-79]:o.from=d[n%8]+(Math.floor(n/8)+1),o.to=d[r%8]+(Math.floor(r/8)+1),i.push(o);return i}function uciToObj(e){var t,n,r=e.split(" "),o=r.length,a=[];if(e)for(t=0;t<o;++t)4===(n=r[t]).length?"@"===n[1]?a.push({drop:n[0].toLowerCase(),to:n.substr(2,2)}):a.push({from:n.substr(0,2),to:n.substr(2,2)}):a.push({from:n.substr(0,2),to:n.substr(2,2),promotion:n[4]});return a}function isSameMove(e,t){return e.san===t.san||e.from==t.from&&e.to==t.to&&e.promotion==t.promotion&&e.drop==t.drop}function makePremove(e,n,r){var a,i,s,c,u,l=e.header().Variant,d=getPremoves(e.fen(),n,l);if(d){for(a=d.length-1;a>=0;--a)if(isSameMove(i=d[a],r)){s=!0;break}if(s)return i.drop?e.put({type:i.drop,color:n},i.to,!0):(c=e.remove(i.from,!0),i.flags===t.FLAGS.KSIDE_CASTLE?(u=e.remove("Chess960"===l?i.to:"h"+i.from[1],!0),e.put(c,"g"+i.from[1],!0),e.put(u,"f"+i.from[1],!0)):i.flags===t.FLAGS.QSIDE_CASTLE?(u=e.remove("Chess960"===l?i.to:"a"+i.from[1],!0),e.put(c,"c"+i.from[1],!0),e.put(u,"d"+i.from[1],!0)):(i.promotion&&(c.type=i.promotion,c.promoted=!0),e.put(c,i.to,!0))),i}if(r.from&&(r=o.fixObjMove(r,e._board(),n)))return makePremove(e,n,{san:r})}function getPieces(e,t){var n,r,o,a=t?{}:[],s=e._board();if(t)for(n=112;n>=0;++n)136&n&&(n-=24),(r=s[n])&&(a[o=d[7&n]+(8-(n>>4))]={type:c[r&i],color:3&r,promoted:0!=(r&l),square:o});else for(n=112;n>=0;++n)136&n&&(n-=24),(r=s[n])&&a.push({type:c[r&i],color:3&r,promoted:0!=(r&l),rank:8-(n>>4),file:1+(7&n)});return a}function makeMoves(e,t,n,r){var o,a,i,s,c,u,l,d,f,p;for(n=n||{},"string"==typeof t&&(t=t.trim().split(" ")),i=t.length,o=0;o<i;o+=1){if(c="b"===t[o].board||"B"===t[o].board?e.siblingGame:e,u="string"==typeof t[o]?uciToObj(t[o])[0]:t[o].san?t[o].san:t[o],!c.move(u)){if(!n.autoPromote){if(n.skipBadLines)break;return!1}if(!0===n.autoPromote?u.promotion="q":u.promotion=n.autoPromote,!c.move(u)){if(n.skipBadLines)break;return!1}}if(d=(l=c._history())[l.length-1],r&&(f=parseInt(r[o],10)),("number"!=typeof f||isNaN(f))&&(f=parseInt(t[o].time,10)),"number"!=typeof f||isNaN(f)||(d.time=f,f=void 0),t[o].firstComment&&(l.initComment=t[o].firstComment),t[o].comment&&(d.comment=t[o].comment),t[o].annotation&&(d.annotation=t[o].annotation),t[o].additionalAnnotation&&(d.additionalAnnotation=t[o].additionalAnnotation),t[o].commands&&(d.commands=t[o].commands),t[o].lines)for(s=t[o].lines.length,a=0;a<s;++a){if(p=e._history().id,e.createVariation(),!makeMoves(e,t[o].lines[a],n)&&!n.skipBadLines)return!1;e.selectLine(p)}}return!0}function extendChess(e){var t,r,a=-1,i=0;function fixContComment(t){var n=e._lines()[t.ids.line];return n.initComment&&(t.comment=(n.initComment+" "+(t.comment||"")).trim(),n.initComment=""),!0}e.extended||(e.extended=!0,t={header:e.header,load:e.load,loadPgn:e.loadPgn,createVariation:e.createVariation,undo:e.undo,pgn:e.pgn},e._move=e.move,e.premoves=[],e.undo=function(){return e.deletePosition(a,i)},e.isLegalMove=function(n){return!!e._move(n)&&t.undo(!0)},e.premove=function(t,n){var r,a=e.premoves.length,i=o();return a?i.load(e.premoves[a-1].fen,e.header().Variant):i.load(e.fen(),e.header().Variant),(r=makePremove(i,n,t))?(e.premoves.push({move:r,pieces:getPieces(i),fen:i.fen()}),r):null},e.getPieces=function(t){return getPieces(e,t)},e.origHistory=e.history,e.history=function(t,n){var r,o,a,i=[],c=e._history(),u=c.length,l=e._lines();for("boolean"==typeof t&&(t={verbose:t}),t=t||{},n&&(t.noParentLines=n),t.toCurrent&&(u=e.ids().move+1);;){if(-1==--u){if(c.id&&!t.noParentLines){u=c.atMoveNode,c=l[c.parentId];continue}break}if(t.verbose){for(o in r={},c[u])if(c[u][o]&&"object"===s()(c[u][o]))for(a in r[o]=c[u][o].constructor===Array?[]:{},c[u][o])r[o][a]=c[u][o][a];else r[o]=c[u][o];i.unshift(r)}else i.unshift(c[u].san)}return i},e._getPos=function(r,o){var s,c;return"number"!=typeof r&&(r=a),"number"!=typeof o&&(o=i),s=(c=e._lines())[o],r>=0?s[r]:s.id?s.atMoveNode?c[s.parentId][s.atMoveNode-1]:e._getPos(s.atMoveNode-1,s.parentId):{fen:t.header().FEN||n,hash:s.hash,initial:!0}},e.move=function(t,n){var r,o,s,c,u=e._history();if(t&&("string"==typeof t||t.to&&(t.from||t.drop))){if(i===u.id&&a<u.length-1||n){if(e.moveForward(n,t))return!0;a<u.length-1&&(e.selectPosition(a+1),e.createVariation(),u=e._history())}e.siblingGame&&(s=e.isDependent?e.siblingGame.fen():e.fen()),(r=e._move(t))&&(normalizeMoveObj(r),i=u.id,o=u[a=u.length-1],c=e._getPos(a-1),e.siblingGame?(e.isDependent?o.fen=e.siblingGame.fen():o.fen=e.fen(),o.beforeFen=s):(o.fen=e.fen(),o.beforeFen=c.fen),c.initial?(o.moveNumber=0,o.previous=null):(o.moveNumber=c.moveNumber+1,o.previous=c.ids,c.isContinuation&&fixContComment(c)),i&&0===a&&e._lines()[u.parentId][u.atMoveNode].move===o.move&&(o.isContinuation=!0),o.flags=r.flags,o.to=r.to,o.from=r.from,o.drop=r.drop,o.capturedStr=r.captured,o.promotion=r.promotion,o.piece=r.piece,r.promoted&&(o.promoted=!0),r.capturedPromotedPawn&&(o.capturedPromotedPawn=!0),o.ids={move:a,line:i})}return r},e.header=e.headers=function(n){var r=t.header(n);return e.siblingGame&&extendChess(e.siblingGame),r},e.load=function(n,r,o,s){var c=t.load(n,r,o,s);return e.siblingGame&&extendChess(e.siblingGame),c&&!o&&(a=-1,i=0),c},e.removeEmptyLines=function(){var t,n,r=e._lines();for(t=r.length-1;t>0;--t)r[t].length||(r[t]=void 0,n=!0);n&&e.reorderLines()},e.loadPgn=function(n,r,o){var s=t.loadPgn(n,r,o),c=e._history();return e.removeEmptyLines(),a=c.length-1,i=c.id,s},e.ids=function(){return{move:a,line:i}},e.selectLine=function(t){e.selectPosition(null,t)},e.moveBackward=function(){var t;if(a<=1)if(0===i){if(-1===a)return!1;e.selectPosition(a-1)}else(t=e._getPos(a-1,i)).isContinuation?e.selectPosition(e._history().atMoveNode,e._history().parentId):t.initial?e.selectPosition(-1,0):e.selectPosition(t.ids.move,t.ids.line);else e.selectPosition(a-1);return!0},e.moveForward=function(t,n){var r,s,c,u,l,d,f=e._lines();if("string"==typeof n&&(n={san:n}),!(r=f[i][a+1])||n&&!isSameMove(n,r)){if(n&&r&&r.lines)for(l=r.lines.length,u=0;u<l;++u)if((c=f[r.lines[u]][0])&&isSameMove(n,c)){r=c,d=!0;break}if(!d&&t&&(s=f[i][a])&&s.lines)for(l=s.lines.length,u=0;u<l;++u)if((c=f[s.lines[u]][0])&&c.isContinuation&&(c=f[s.lines[u]][1])&&(!n||isSameMove(n,c))){r=c,d=!0;break}if(!d)return!!(n&&n.san&&(n=o.fixSanMove(n.san,e._board(),e.turn()))||n&&n.to&&n.from&&Math.abs(n.to.charCodeAt(0)-n.from.charCodeAt(0))>1&&(n=o.fixObjMove(n,e._board(),e.turn())))&&e.moveForward(t,n)}return e.selectPosition(r.ids.move,r.ids.line)},e.moveVariation=function(t,n){var r,o,a,i=e._lines(),s=i[t];if(s&&s.id)for(o=(r=i[s.parentId][s.atMoveNode].lines).length-1;o>=0;--o)if(r[o]===t&&r[a=o-(n?1:-1)])return r[o]=r[a],r[a]=t,e.reorderLines(),!0;return!1},e.promoteVariation=function(t,n){for(var r,o,s,c,u,l,d=e._lines(),f=d[t];f&&f[0]&&f.id&&(-1!==n||f.parentId);){for(r=d[s=f.parentId],c=f.atMoveNode,f[0].lines=r[c].lines.concat(f[0].lines||[]),r[c].lines=void 0,l=r.length-c,o=r.splice(c,l),u=0;u<l;++u)o[u].ids.line=t,o[u].ids.move=u;for(o.id=t,o.parentId=s,o.atMoveNode=c,o.hash=f.hash,0===c?(o.initComment=r.initComment,r.initComment=f.initComment):f.initComment&&(r[c-1].comment=((r[c-1].comment||"")+" "+f.initComment).trim()),d[t]=o,l=f.length,u=0;u<l;++u)f[u].ids.line=s,f[u].ids.move=u+c,r.push(f[u]);for(o[0].isContinuation=!!f[0].isContinuation&&fixContComment(o[0]),r[c].isContinuation=!c&&"number"==typeof r.parentId&&d[r.parentId][r.atMoveNode].move===r[0].move&&fixContComment(r[c]),l=r[c].lines.length,u=0;u<l;++u)d[r[c].lines[u]].atMoveNode=c,d[r[c].lines[u]][0]&&(d[r[c].lines[u]][0].isContinuation=d[r[c].lines[u]][0].move===r[c].move&&fixContComment(d[r[c].lines[u]][0]));if(i===t?(i=s,a+=c):i===s&&a>=c&&(i=t,a-=c),1===n)break;f=d[t=s]}return void 0!==r&&(e._history(d[i]),e.reorderLines(),!a&&d[i][0].isContinuation&&e.selectPosition(d[i].atMoveNode,d[i].parentId),!0)},e.reorderLines=function(t,n){var o,a,s,c,u,l,d,f,p,m,h=e._lines();for(t?p=n.length-1:(t=0,n=[h[0]],p=0,r=!1),s=(o=h[t]).length,a=0;a<s;++a)if((c=o[a]).ids.line=p,c.lines)for(u=c.lines.length,l=0;l<u;++l)(f=h[d=c.lines[l]])?(f.atMoveNode=a,m=n.length,c.lines[l]=m,f.parentId=p,r||d!==i||(r=!0,i=m),n.push(f),e.reorderLines(d,n)):(1===c.lines.length?delete c.lines:c.lines.splice(l,1),--l,--u);t||e.saveLines(n,!0)},e.createVariation=function(){var n,r,o,s,c=e._history(),u=e._lines();return a===c.length-1?(n=t.createVariation(),c=e._history(),a=c.length-1,i=c.id,n):-1!==a&&(r=[],o=c[a],r.parentId=c.id,r.id=u.length,o.lines||(o.lines=[]),o.lines.push(r.id),s=e._getPos(a-1),r.hash=s.hash,r.atMoveNode=a,u.push(r),e.selectPosition(-1,r.id))},e.selectLineEnd=function(t){return"number"!=typeof t&&(t=i),(t!==i||a<e._history().length-1)&&e.selectPosition(null,t,!0)},e.selectLineStart=function(){var t,n;return i?(a>1||1===a&&!e._getPos(0).isContinuation?t=e._history():(n=e._getPos(-1),t=e._lines()[n.ids?n.ids.line:0]),e.selectPosition(t.id?t[1]&&t[0].isContinuation?1:0:-1,t.id)):-1!==a&&e.selectPosition(-1,0)},e.selectPosition=function(n,r,o){var s=e._lines(),c=e._history();if("number"==typeof r&&(r!==i||o)){if(r<0||r>=s.length)return!1;if(c=s[r],"number"!=typeof n)n=c.length-1;else if(n<-1||n>=c.length)return!1;i=r,e._history(c),o=!0}if("number"==typeof n&&(n!==a||o)){if(n<-1||n>=c.length)return!1;t.load(e._getPos(n).fen,t.header().Variant,!0,!0),a=n}return!0},e.resetToMainLine=function(){var t=e._lines();e.selectLineEnd(0),t.length>1&&(t.length=1,e.reorderLines())},e.saveLines=function(t,n){var r,o,a,i=e._lines(),s=t.length;for(t!==i&&(i.length=0),o=0;o<s;++o){if(r=t[o],o&&"number"!=typeof r.parentId)return!1;t!==i&&i.push(r),r.id=o}return n||(a=e.ids(),e.selectPosition(-1,0,!0),e.selectPosition(a.move,a.line)),!0},e.deletePosition=function(t,n){var r,o,s=e._lines();return!(!s[n]||!(s[n][t]||-1===t&&0!==n))&&(n&&(0===t||1===t&&s[n][0].isContinuation)&&(t=-1),i>0&&n!==i?o=!1!==(r=function descendsFromMove(e,t,n){for(var r,o=e[t];"number"==typeof(r=o.parentId);){if(r===n)return o.atMoveNode;o=e[r]}return!1}(s,i,n))&&r>=t:n===i&&t<=a&&(o=!0),o&&(t>1?e.selectPosition(t-1,n):(e.selectPosition(s[n][0].isContinuation||1===t?1:0,n),e.moveBackward())),t>0?s[n].length=t:n?s[n]=null:s[0].length=0,e.reorderLines(),e.ids())},e.mark=function(t,n){var r=a<0?e._lines()[i]:e._lines()[i][a],o=t.type,s=1;t.color&&("arrow"===o?e.mark({key:t.color+t.key,type:"cal"},n):"square"===o&&e.mark({key:t.color+t.key,type:"csl"},n)),"cal"!==o&&"csl"!==o&&(o="c_"+o,s=0),r.commands&&r.commands[o]&&(r.commands[o]=r.commands[o].split(",").filter((function rm(e){return e.slice(s).split(";")[0]!==t.key.slice(s)})).join(","),r.commands[o]||delete r.commands[o]),n||(r.commands||(r.commands={}),r.commands[o]=(r.commands[o]?r.commands[o]+",":"")+t.key+(t.data?";"+t.data.join(";"):""))},e.markings=function(){var t,n,r,o,s,c,u,l,d={},f=a<0?e._lines()[i]:e._lines()[i][a],p={cal:"arrow",csl:"square"};for(n in f.commands){if(r=f.commands[n],p[n])n=p[n],o=0;else{if("c_"!==n.substr(0,2))continue;n=n.slice(2),o=1}for(d[n]=d[n]||{},c=(s=r.split(",")).length,t=0;t<c;++t)o?(l=(u=s[t].split(";")).shift(),d[n][l]=d[n][l]||{type:n,key:l},d[n][l].data=u):(l=s[t].slice(1),d[n][l]=d[n][l]||{type:n,key:l},d[n][l].color=s[t][0])}return d},e.clearMarkings=function(){var t,n=a<0?e._lines()[i]:e._lines()[i][a];for(t in n.commands)/^c[sa]l$|^c_/.test(t)&&delete n.commands[t]},e.pgn=function(n){var r,o=e.ids();return e.selectLineEnd(0),r=t.pgn(n),e.selectPosition(o.move,o.line),r},e.loadMoves=function(t,n){var r,o,s;if(n=n||{},"string"==typeof t&&(t=decodeTCN(t)),t){for(n.atCurrent||e.selectPosition(-1,0),s=i,o=t.length,r=0;r<o;++r){if(!e.move(t[r],!0)&&(t[r].promotion=!0===n.autoPromote?"q":n.autoPromote,!e.move(t[r],!0)))return!1;i!==s&&"merge"!==n.method&&(e.promoteVariation(i,1),"promote"!==n.method&&(e._history()[a].lines=void 0,e.reorderLines()),s=i)}"merge"!==n.method&&"promote"!==n.method&&e.deletePosition(a+1,i)}return!0})}function createGame(e){var t,r;if((e=e||{}).game)return e.game;if(t=o(),e.analysis&&extendChess(t),e.disableHashing&&t.hashing(!1),e.pgn){if(!(t.loadPgn(e.pgn,e.index,e.options)||"detect"===e.variant&&o.variants.some((function(n){return e.options=e.options||{},e.options.variant=n,t.loadPgn(e.pgn,e.index,e.options)}))))return!1}else{if(e.headers&&(e.variant=e.headers.Variant||e.variant,e.fen||(e.fen=e.headers.FEN)),"detect"===e.variant&&e.fen&&(e.fen.indexOf("|")>-1?e.variant="Bughouse":9===e.fen.split("/").length?e.variant="Crazyhouse":e.fen.indexOf("+")>-1?e.variant="3-check":e.variant=void 0),(e.fen||e.variant)&&!t.load(e.fen||n,e.variant))return!1;e.headers&&"object"===s()(e.headers)&&!Array.isArray(e.headers)&&t.header(e.headers)}if(e.tcn)if("object"===s()(e.tcn)){if(!function playBughouseTCN(e,t,n){var r,o,a,i=[decodeTCN(t[0]),decodeTCN(t[1])],s=[0,0],c=[0,0],u=i[0].length+i[1].length,l=Math.max(0|n[0][0],0|n[0][1],0|n[1][0],0|n[1][1]),d=[0,0],f=[0,0];for(r=[[l+=600-l%600,l],[l,l]];u--;){if(f[0]=d[0]+r[0][c[0]]-n[0][s[0]]||0,f[1]=d[1]+r[1][c[1]]-n[1][s[1]]||0,i[o=f[0]<=f[1]?0:1][s[o]]||(o^=1),(!(a=o?e.siblingGame:e).move(i[o][s[o]])||u&&a.inCheckmate()&&a.undo(!0))&&!(a=(o^=1)?e.siblingGame:e).move(i[o][s[o]]))return!1;a._history()[s[o]].time=n[o][s[o]],r[o][c[o]]=n[o][s[o]],d[o]=f[o],c[o]^=1,++s[o]}return!0}(t,e.tcn,e.timestamps||[[],[]]))return!1}else r=decodeTCN(e.tcn);else r=e.moves;return!(r&&!makeMoves(t,r,e,e.timestamps))&&t}function normalizeMoveObj(e){return e&&(e.piece&l&&(e.promoted=!0),e.piece=c[e.piece&i],e.captured&&(e.captured&l&&(e.capturedPromotedPawn=!0),e.captured=c[255&e.captured]),e.promotion&&(e.promotion=c[e.promotion&i]),void 0!==e.drop&&(e.drop=u[e.drop])),e}function normalizeHistory(e){var t,n,r,o,a,i,s,c=e.history(!0,!0);if(e.siblingGame){for(t=e.siblingGame.history(!0,!0),r=c.length+t.length,n=[],o=0;o<r;++o)!c.length||t.length&&t[0].bughouseOrder<c[0].bughouseOrder?(a=t.shift()).board="b":(a=c.shift()).board="a",n.push(a);c=n}for(r=c.length,o=0;o<r;++o)if((i=c[o]).fen||normalizeMoveObj(i),i.lines)for(s=i.lines.length-1;s>=0;--s)e.selectLine(i.lines[s]),i.lines[s]=normalizeHistory(e).moves;return{moves:c}}function getPremoves(e,n,r){var a,i,s,c,l,d,f,p,m=[];function pawnCapture(e){var r,o=l[0]+"x"+e;if(1===n&&7===a||2===n&&2===a)for(r=4;r>0;--r)m.push({color:n,to:e,flags:t.FLAGS.CAPTURE|t.FLAGS.PROMOTION,from:l,promotion:1<<r+2,piece:4,san:o+"="+u[r].toUpperCase()});else 1===a&&2===n||8===a&&1===n||m.push({color:n,to:e,flags:t.FLAGS.CAPTURE,from:l,piece:4,san:o})}if(1!==n&&2!==n||!t.load(e,r||"chess"))return null;for(e=t.fen(),(c=o()).clear(),r&&c.header({Variant:r}),t.turn(n),c.turn(n),a=1;a<9;++a)for(i=1;i<9;++i)l=String.fromCharCode(i+96)+a,(s=t.get(l))&&(t.remove(l,!0),s.color===n&&("p"===s.type?(i>1&&pawnCapture(String.fromCharCode(i-1+96)+(a+(1===n?1:-1))),i<8&&pawnCapture(String.fromCharCode(i+1+96)+(a+(1===n?1:-1)))):"k"===s.type&&(f=l[0],p=a),c.put(s,l,!0),m=m.concat(c.moves({verbose:!0})),c.remove(l,!0)));return"-"!==(d=e.split(" ")[2])&&d.split("").forEach((function(e){(1===n&&e<"a"||2===n&&e>="a")&&("k"===(e=e.toLowerCase())?m.push({color:n,to:"g"+p,flags:t.FLAGS.KSIDE_CASTLE,from:"e"+p,piece:128,san:"O-O"}):"q"===e?m.push({color:n,to:"c"+p,flags:t.FLAGS.QSIDE_CASTLE,from:"e"+p,piece:128,san:"O-O-O"}):e>f?m.push({color:n,to:e+p,flags:t.FLAGS.KSIDE_CASTLE,from:f+p,piece:128,san:"O-O"}):m.push({color:n,to:e+p,flags:t.FLAGS.QSIDE_CASTLE,from:f+p,piece:128,san:"O-O-O"}))})),(m=m.concat(t.moves({verbose:!0}))).forEach((function(e){normalizeMoveObj(e)})),m}function getLegalMoves(e,n){var r,o,a,i;if("string"==typeof e){if(!(o=t).load(e,n))return null}else o=createGame(e);for(i=(r=o.moves({verbose:!0})).length,a=0;a<i;++a)normalizeMoveObj(r[a]);return r}function jce(t,n){return(e=e||a(jce))(t,n)}return jce.gameFingerprints=function gameFingerprints(e){var t,o,a,i,s,c,u,l,d,f=createGame(e),p=[""],m=[];if(!f)return!1;for(d=(l=f.header()).Variant||"",c=f.hashes(),t="function"==typeof f.origHistory?f.origHistory(!0):f.history(!0),s=c.length,o=[c[0][0],c[0][1]],m.push(r.to64BitHex(o)+d),c[0]=r.to64BitHex(c[0]),a=1;a<s;++a)o[0]=(o[0]^c[a][0]*(a+58465))>>>0,o[1]=(o[1]^c[a][1]*(a+984))>>>0,c[a]=r.to64BitHex(c[a]),m.push(r.to64BitHex(o)+d),normalizeMoveObj(t[i=a-1]),u=(t[i].from?t[i].from:t[i].drop.toUpperCase()+"@")+t[i].to+(t[i].promotion||""),i&&(u=p[i]+" "+u),p.push(u);return{startingFen:l.FEN||n,hashes:c,fingerprints:m,moves:p,variant:l.Variant}},jce.getFenFromMoves=function getFenFromMoves(e,n,r){return t.reset(),t.load(e,r),!(n&&!makeMoves(t,n))&&t.fen()},jce.getLegalMoves=getLegalMoves,jce.getPremoves=getPremoves,jce.getPositionInfo=function getPositionInfo(e,n,r){var o,a,i,s={gameOver:!1,check:!1,checkmate:!1,draw:!1,stalemate:!1,threefold:!1,insufficient:!1};if(Array.isArray(n)||(r=n,n=null),"boolean"==typeof r?(o=r,r={}):o=(r=r||{}).variant,"string"==typeof e){if(0!==(i=t).validateFen(e,o)||!i.load(e,o))return!1}else i=createGame(e);return!(n&&!makeMoves(i,n))&&(r.getLegalMoves?(a=getLegalMoves({game:i}),s.legalMoves=a):a=i.moves(),i.inCheck()?(s.check=!0,s.checkmate=0===a.length):s.stalemate=0===a.length,r.premove&&(r.check=!1,r.kings=!1),s.threefold=i.inThreefoldRepetition(),s.insufficient=i.insufficientMaterial(r.color),s.fiftyMoveRule=i.in50MoveRule(),s.draw=s.stalemate||s.threefold||s.insufficient||s.fiftyMoveRule||i.inDraw(),r.skipValidation||(s.isValid=i.isPositionValid(r)),o&&(s.variantWin=i.isVariantWin(),void 0===s.variantWin&&(s.variantWin=i.isBughouseWin())),s.gameOver=s.checkmate||s.draw||Boolean(s.variantWin),s)},jce.isFenValid=function isFenValid(e,n){return 0===t.validateFen(e,n)},jce.encodeTCN=function encodeTCN(e){var t,n,r,o,a="";for(Array.isArray(e)||(e=[e]),n=e.length,t=0;t<n;t+=1)r=e[t].drop?79+f.indexOf(e[t].drop):d.indexOf(e[t].from[0])+8*(e[t].from[1]-1),o=d.indexOf(e[t].to[0])+8*(e[t].to[1]-1),e[t].promotion&&(o=3*f.indexOf(e[t].promotion)+64+(o<r?9+o-r:o-r-7)),a+=d[r]+d[o];return a},jce.decodeTCN=decodeTCN,jce.uciToObj=uciToObj,jce.generatePgn=function generatePgn(e){var t;return(e=e||{}).disableHashing=!0,!!(t=createGame(e))&&t.pgn(e)},jce.pgnToFen=function pgnToFen(e,n){var r,o,a=[];if(t.reset(),!t.loadPgn(e))return!1;if(r=t.moveCount(),"number"==typeof n){for(n<0&&(n=r+n+1),o=r-1;o>=n&&o>=0;o-=1)t.undo();return t.fen()}for(o=0;o<=r;o+=1)a.unshift(t.fen()),t.undo();return a},jce.pgnToJson=function pgnToJson(e,n,r){var o,a=[],i=t;return"number"!=typeof n&&(r=n,n=void 0),o=i.tokenizePgn(e,r),n<0&&(n=o.length+n),!!o&&(r&&r.includeFen&&(i=createGame({analysis:!0})),o.forEach((function(e,t){var o,s;t===n||void 0===n?i.loadPgn([e],0,r)?(s=normalizeHistory(i),o=i.header(),a.push({headers:o,moves:s.moves})):a.push(!1):a.push(void 0)})),"number"==typeof n?a[n]:a)},jce.sanToObj=function sanToObj(e,n,r){return t.reset(),!!t.load(n,r)&&normalizeMoveObj(t.move(e))},jce.completeFen=t.completeFen,jce.shortenFen=function shortenFen(e,n){return t.completeFen(e).split(" ").slice(0,n||4).join(" ")},jce.createGame=createGame,jce.getPositionDetails=function getPositionDetails(e,t){var n,r,o,a;if((e=e||{}).disableHashing=!0,!(n=createGame(e)))return null;if(t)if(e.premove){if(!(o=makePremove(n,e.color,t)))return null}else{if(!(o=n.move(t)))return null;n.extended||normalizeMoveObj(o)}return a=n.fen(),e.premove&&(e.check=!1,e.kings=!1),e.skipValidation||n.isPositionValid(e)?(r=a.split(" "),{fen:a,pieces:getPieces(n),sideToMove:n.turn(),castling:r[2],epSquare:"-"===r[3]?null:r[3],halfMoves:+r[4],moveNumber:+r[5],move:o,hand:n.hand(),checks:n.checks()}):null},jce.predict=function predict(e,t){var n=Math.min(Math.max(.20773843*Math.atan(2.49085889*e/100-2.47841945*t/100)+.02262979*e/100-.02256839*t/100+.52239679,0),1),r=Math.min(Math.max(-.20720905*Math.atan(2.49626837*e/100-2.48220286*t/100)+-.02352551*e/100+.02172627*t/100+.49443923,0),1),o=Math.min(Math.max(Math.exp(.037043456*e/100+.178106427*t/100-8.069742932)+.004823544*Math.exp(-1.364136591*Math.pow(e/100-t/100,2))+-.001625539,0),1),a=n+r+o;return{w:n/a,b:r/a,d:o/a}},jce.FLAGS=t.FLAGS,jce.loadECO=function loadECO(e,t){r.loadBook(e,(function onload(e,n){if(!n||!n.json)return t(e||new Error("Invalid book"));t(e,(function queryECO(e){var t,o,a,i,s,c,u,l,d;if(e.hash)o="string"==typeof e.hash?[r.hex64ToDec(e.hash)]:[e.hash],i=1;else{if(!(t=createGame(e)))return!1;i=(o=t.hashes()).length}for(a=0;a<i;++a)if(s=n.json[r.to64BitHex(o[a])]){if(s.constructor===Array)if(c&&-1===s[0].m.indexOf(c.m)){for(l=s.length-1;l>=0;--l)if(!l||-1!==s[l].m.indexOf(c.m)){(d=s[l]).e=s[0].e,d.s=s[0].s,d.mate=s[0].mate,d.v=s[0].v,d.h=s[0].h,d.n=d.n||s[0].n,d.u=d.u||s[0].u,d.c=d.c||s[0].c;break}}else d=s[0];else d=s;(d.n||e.allowNameless)&&(c=d)}else e.mustEndInBook&&(c=void 0);if(c)return u={name:c.n},c.m&&(u.moves=c.m),void 0!==c.d&&(u.sdiff=c.d/100),c.c&&(u.code=c.c,u.url=c.u||c.n.replace(/[\u00e1-\u00e5]/g,"a").replace(/[\u0107\u010d]/g,"c").replace(/[\u00e9\u00e8\u0117\u0113]/g,"e").replace(/[\u00f3\u00f6\u00f8]/g,"o").replace(/[\u016f\u00fc]/g,"u").replace(/['+,]/g,"").replace(/[^a-z0-9.]+/gi,"-").replace(/(with-\d|St)\.+-?/,"$1-")),c.e?(u.eval=c.e,u.depth=c.h,u.score=c.e[0].cp/100,void 0!==c.e[0].mate&&(u.mate=c.e[0].mate)):(u.score=c.s/100,void 0!==c.mate&&(u.mate=c.mate)),c.v&&(u.bad=!0),u}),n.json)}))},jce}());t.a=c},"./chessboard/src/game/game.lib.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("./chessboard/src/game/engine/JCE.js"),o=n("./chessboard/src/game/line.js"),a=n("./chessboard/src/game/index.js"),i=n("./chessboard/src/game/utils.js"),s={createJce:function createJce(e){var t=Object.assign({},e,{analysis:!0});return r.a.createGame(t)||null},updateIdsFromJce:function updateIdsFromJce(e){return e&&e.jce?(e.tree.selected=e.jce.ids(),e):null},getSelectedIds:function getSelectedIds(e){return e.jce.ids()},getPositionInfo:function getPositionInfo(e){var t=r.a.getPositionInfo({game:e.jce},{skipValidation:!0,getLegalMoves:!0});return e.settings.premoves?t.legalPremoves=s.getLegalPremoves(e):t.legalPremoves=[],t},getPositionDetails:function getPositionDetails(e){return Object.assign(r.a.getPositionDetails({game:e.jce,kings:!1,skipValidation:!0}),{hand:s.getHand(e)})},addExtraCastlingMoves:function addExtraCastlingMoves(e){e.setup.legalMoves.forEach((function(t){16!==t.flags&&32!==t.flags||("chess960"===e.variant?s.addCastlingMoves960(e,t):s.addCastlingMoves(e,t))}))},addCastlingMoves:function addCastlingMoves(e,t){var n=1===t.color?1:8;(16===t.flags?[8]:[1,2]).forEach((function(r){e.setup.legalMoves.push({color:t.color,flags:t.flags,piece:"k",from:t.from,san:16===t.flags?"O-O":"O-O-O",to:i.a.getSanFromFileRank({file:r,rank:n})})}))},addCastlingMoves960:function addCastlingMoves960(e,t){for(var n=i.a.getFileRankFromSan(t.from).rank,r=1,o=0;o<2;){var a=i.a.getPieceAt(e,{file:r,rank:n});void 0!==a&&"r"===a.type&&o++,(1===o&&32===t.flags||2===o&&16===t.flags)&&e.setup.legalMoves.push({color:t.color,flags:t.flags,piece:"k",from:t.from,san:16===t.flags?"O-O":"O-O-O",to:i.a.getSanFromFileRank({file:r,rank:n})})}r++},getHeaders:function getHeaders(e){return e.jce.header()},getFen:function getFen(e){return e.jce.fen()},getPgn:function getPgn(e,t){return e.jce.pgn(t)},getPremoves:function getPremoves(e){return e.jce.premoves},getHand:function getHand(e){return e.jce.hand()},getChecks:function getChecks(e){return e.jce.checks()},getLegalPremoves:function getLegalPremoves(e){return r.a.getPremoves(e.jce.premoves&&e.jce.premoves.length>0?e.jce.premoves[e.jce.premoves.length-1].fen:e.jce.fen(),e.setup.playingAs,e.variant)},load:function load(e,t){return e.jce.load(t)&&s.updateIdsFromJce(e),e},loadPgn:function loadPgn(e,t){return e.jce.loadPgn(t)&&s.updateIdsFromJce(e),e},loadPgnSoft:function loadPgnSoft(e,t){if(!e.jce.loadPgn(t)){var n=r.a.createGame({variant:"detect",pgn:t});n&&(t=n.pgn())}return e.jce.loadPgn(t)||s.updateIdsFromJce(e),e},createVariation:function createVariation(e){return e.jce.createVariation()&&(e.jce.reorderLines(),s.updateIdsFromJce(e)),e},getJCEMove:function getJCEMove(e,t){var n=t;return s.isValidMoveObject(t)?(n.san?n=r.a.sanToObj(n.san,s.getFen(e),e.variant):n.tcn&&(n=r.a.decodeTCN(n.tcn)[0]),n):null},move:function move(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t)return null;var r=!1;if(!1===n){var o=t.from?e.jce.get(t.from):null,a=t.to?e.jce.get(t.to):null;if(o&&a&&"k"===a.type)return null;e.jce.remove(t.to),e.jce.remove(t.from);var i=t.drop||t.put;r=e.jce.put(o||{type:i.toLowerCase(),color:i&&i.toUpperCase()===i?1:2},t.to),t.from&&o&&null===t.to&&(r=!0)}else t.drop&&(t.drop=t.drop.toLowerCase()),r=e.jce.move(t);return r&&s.updateIdsFromJce(e),r},selectLine:function selectLine(e,t){var n=o.a.getLine(e.tree.lines,t);return n&&(e.jce.selectLine(t),e.tree.selected={line:t,move:n.length-1}),e},selectNode:function selectNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{line:0,move:0};return e.jce.selectPosition(t.move,t.line),e},updateHeaders:function updateHeaders(e,t){return e.jce.header(t)},clear:function clear(e){return e.jce.clear(e.variant)},isFileRankEqual:function isFileRankEqual(e,t){return e.file&&t.file&&e.rank&&t.rank&&e.file===t.file&&e.rank===t.rank},isValidMoveObject:function isValidMoveObject(e){return"string"==typeof e.from&&"string"==typeof e.to||"string"==typeof e.san||"string"==typeof e.tcn||!e.from&&"string"==typeof e.to&&"string"==typeof e.drop||null===e.to&&"string"==typeof e.from||!e.from&&"string"==typeof e.to&&"string"==typeof e.put},movesMatch:function movesMatch(e,t){return!(e.from!==t.from||e.to!==t.to||e.promotion&&e.promotion!==t.promotion||e.drop&&e.drop!==t.drop)},getMoveNumber:function getMoveNumber(e,t){return 1===e?Math.ceil(t/2+1):Math.floor(t/2+1)},isUserTurn:function isUserTurn(e){return e.setup.playingAs===e.setup.sideToMove},getFens:function getFens(e){var t=[e.setup.fen];return(e.tree.lines||n("./web/core/api/move-list/move-list.js").default.state.lines)[0].forEach((function(e){t.push(e.fen)})),t},getLastTcn:function getLastTcn(e){var t=a.a.getTcn(e);return t.substr(t.length-2)},getSanMoves:function getSanMoves(e,t){var r=[];return(e.tree.lines||n("./web/core/api/move-list/move-list.js").default.state.lines)[0].some((function(e,n){return"number"==typeof t&&n>=t||(r.push(e.san),!1)})),r}}},"./chessboard/src/game/game.premoves.lib.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("./chessboard/src/game/game.lib.js"),o={premove:function premove(e,t){var n=!1;return e.settings.premoves&&!e.settings.analysis&&e.jce.premoves.length<8&&(n=e.jce.premove(t,e.setup.playingAs)),n},cancelPremoves:function cancelPremoves(e){return!!e.jce.premoves.length&&(e.jce.premoves.length=0,!0)},consumePremove:function consumePremove(e){if(e.jce.premoves.length){var t=e.jce.premoves.shift();if(r.a.move(e,t.move)){var n=e.jce.premoves.map((function(e){return e}));e.jce.premoves.length=0;for(var a=0;a<n.length;a+=1){var i=n[a];if(delete i.move.san,!o.premove(e,i.move))break}return!0}}return!1}}},"./chessboard/src/game/history.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r={ADD_BLINKING_SQUARE:"ADD_BLINKING_SQUARE",CLEAR_ARROW:"CLEAR_ARROW",CLEAR_BLINKING_SQUARE:"CLEAR_BLINKING_SQUARE",CLEAR_EFFECT:"CLEAR_EFFECT",CLEAR_MARKED_SQUARE:"CLEAR_MARKED_SQUARE",INIT:"INIT",LOAD:"LOAD",MAKE_MOVE:"MAKE_MOVE",ILLEGAL_MOVE:"ILLEGAL_MOVE",JUMP_TO_POSITION:"JUMP_TO_POSITION",TREE_CHANGE:"TREE_CHANGE",TREE_AMENDED:"TREE_AMENDED",SETTINGS_CHANGE:"SETTINGS_CHANGE",PGN_HEADERS_UPDATED:"PGN_HEADERS_UPDATED",CANCEL_PREMOVES:"CANCEL_PREMOVES",PREMOVE:"PREMOVE",GUESS_THE_MOVE:"GUESS_THE_MOVE",CANCEL_GUESS_THE_MOVE:"CANCEL_GUESS_THE_MOVE",UPDATE_NODE:"UPDATE_NODE"},o={MAX_HISTORY_LIMIT:200,getInitialHistory:function getInitialHistory(){return[]},add:function add(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.length>o.MAX_HISTORY_LIMIT-1){var r=e.findIndex((function(e){return null!==e}));e[r]=null}e.push({type:t,payload:n})},getLastItem:function getLastItem(e){return e[e.length-1]}}},"./chessboard/src/game/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return L}));var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./chessboard/src/game/utils.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var i=n("./chessboard/src/game/game.lib.js"),s=n("./chessboard/src/game/api/select-node.js"),c=n("./chessboard/src/game/history.js"),u=n("./chessboard/src/game/state.js"),l=n("./chessboard/src/game/engine/JCE.js"),d=n("./chessboard/src/game/line.js");function create_variation_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function create_variation_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?create_variation_ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):create_variation_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=function createVariation(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=create_variation_objectSpread({},e.tree.selected);if(!e.settings.variations)return null;void 0!==n.line&&void 0!==n.move?i.a.selectNode(e,n):n=e.tree.selected;var o=d.a.getNode(e.jce._lines(),{line:n.line,move:n.move}).san;return i.a.createVariation(e),t&&i.a.move(e,o),c.b.add(e.history,c.a.JUMP_TO_POSITION,{from:r,to:n}),u.a.updateState(e)},p=function shouldNotMutateLine(e){return-1!==e.tree.selected.move&&e.settings.mainLineIsImmutable&&d.a.isMainLine(e.tree.selected.line)},m=function isValidMove(e,t){return null!==l.a.getPositionDetails({fen:i.a.getFen(e),variant:i.a.getHeaders(e).Variant||"Chess"},t)},h=function makeMove(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=i.a.getJCEMove(e,t);if(null===r)return c.b.add(e.history,c.a.ILLEGAL_MOVE),e;var o=e.settings.analysis||n;if(!d.a.isHead(e.jce._lines(),e.tree.selected)){if(!o)return Object(s.a)(e,d.a.getHeadIds(e.jce._lines(),e.tree.selected.line));var a=d.a.getNextMatchingNode(e.jce._lines(),e.tree.selected,r);if(a)return Object(s.a)(e,a.ids);if(m(e,r)){if(c.b.add(e.history,c.a.TREE_AMENDED),e.settings.variations)return i.a.selectNode(e,{line:e.tree.selected.line,move:e.tree.selected.move+1}),i.a.createVariation(e),u.a.updateState(e),makeMove(e,r);if(!e.settings.mainLineIsImmutable)return d.a.prune(e.jce._lines(),e.tree.selected),makeMove(e,r)}return c.b.add(e.history,c.a.ILLEGAL_MOVE),e}if(!o&&!i.a.isUserTurn(e))return c.b.add(e.history,c.a.ILLEGAL_MOVE),e;if(o&&e.settings.variations&&p(e)&&m(e,r)){var l=d.a.getNextMatchingNode(e.jce._lines(),e.tree.selected,r);return l?Object(s.a)(e,l.ids):(f(e,!0),u.a.updateState(e),makeMove(e,r))}return!p(e)&&i.a.move(e,r,e.settings.rules)?(c.b.add(e.history,c.a.MAKE_MOVE,r),u.a.updateState(e)):(c.b.add(e.history,c.a.ILLEGAL_MOVE),e)},g=function setPlayingAs(e,t){return[1,2].indexOf(t)>=0&&(e.setup.playingAs=t),e},b=n("./chessboard/src/game/api/premoves/index.js"),v=function changeSettings(e,t){var n=Object.prototype.hasOwnProperty.call(t,"premoves")&&e.settings.premoves!==t.premoves;return e.settings=Object.assign(e.settings,t),e.settings.premoves||Object(b.a)(e),c.b.add(e.history,c.a.SETTINGS_CHANGE),n&&u.a.updateState(e),e},E=function loadFromFen(e,t){return t?(d.a.clearAllMarkings(e.jce._lines()),i.a.load(e,t),c.b.add(e.history,c.a.LOAD),u.a.updateState(e)):null},_=function clearMarkings(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=d.a.getNode(e.jce._lines(),t)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;return(r.arrows&&r.arrows.length||r.squares&&r.squares.length||r.effects&&r.effects.length)&&(r.arrows=[],r.squares=[],r.effects=[],n&&(u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE))),e},y=function convertFileToInteger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.charCodeAt(0)-97+1},O=function createGame(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={id:a.a.getId(),variant:e.variant||"chess",settings:Object.assign(u.a.getInitialSettings(),e.settings),setup:Object.assign(u.a.getInitialSetup(),e.setup),tree:Object.assign(u.a.getInitialTree(),e.tree),history:c.b.getInitialHistory(),markings:Object.assign(u.a.getInitialMarkings(),e.markings),premoves:[]};return g(t,e.player||1),Object.defineProperty(t,"jce",{writable:!1,enumerable:!1,configurable:!1,value:i.a.createJce(e)}),i.a.updateIdsFromJce(t),c.b.add(t.history,c.a.INIT),t.jce.siblingGame&&!t.sibling&&(t.sibling={id:a.a.getId(),variant:t.variant||"chess",sibling:t,settings:t.settings,setup:u.a.getInitialSetup(),tree:u.a.getInitialTree(),history:c.b.getInitialHistory(),markings:Object.assign(u.a.getInitialMarkings(),e.markings),premoves:[]},Object.defineProperty(t.sibling,"jce",{writable:!1,enumerable:!1,configurable:!1,value:i.a.createJce({game:t.jce.siblingGame})}),i.a.updateIdsFromJce(t.sibling)),u.a.updateState(t),t},S=n("./chessboard/src/game/move-node/helper.js");function select_line_start_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var P=function selectLineStart(e){var t=d.a.getSelectedLine(e),n=0,r=function select_line_start_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?select_line_start_ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):select_line_start_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.tree.selected);0===e.tree.selected.move&&void 0!==t.parentId?(i.a.selectLine(e,t.parentId),t=d.a.getSelectedLine(e)):d.a.isMainLine(t.id)&&(n=-1);var a={line:t.id,move:n};return i.a.selectNode(e,a),c.b.add(e.history,c.a.JUMP_TO_POSITION,{from:r,to:a}),u.a.updateState(e)},j=function deleteNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign(e.tree.selected,t);return n.line>0&&(n.move<=0||d.a.isFirstVisibleNode(e.jce._lines(),n))&&(n.move=-1),e.jce.deletePosition(n.move,n.line),c.b.add(e.history,c.a.TREE_CHANGE),u.a.updateState(e),e},k=function deleteRemainingNodes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign(e.tree.selected,t);return j(e,{move:n.move+1,line:n.line})},C=function getTcn(e,t){var r=e.jce&&e.jce._lines()||n("./web/core/api/move-list/move-list.js").default.state.lines;return l.a.encodeTCN(d.a.getLine(r,t)||r[0])},A=n("./chessboard/src/game/move-list/helper.js"),w=n("./chessboard/src/game/api/set-hand.js"),T=function loadFromTcn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.a.getInitialFen(),r=arguments.length>3?arguments[3]:void 0;E(e,n);var o=l.a.decodeTCN(t);return o?(o.forEach((function(t){"Crazyhouse"!==e.variant&&"Bughouse"!==e.variant||!t.drop||Object(w.a)(e,e.setup.sideToMove,t.drop),h(e,t,!0)})),u.a.updateState(e),r?Object(s.a)(e,e.tree.selected,-1):(c.b.add(e.history,c.a.LOAD),e)):null},N=function markArrow(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=d.a.getNode(e.jce._lines(),n)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;return o.arrows||(o.arrows=[]),o.arrows.find((function(e){return i.a.isFileRankEqual(e.fromFileRank,t.fromFileRank)&&i.a.isFileRankEqual(e.toFileRank,t.toFileRank)}))||(o.arrows.push(t),r&&(u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE))),e},M=function markEffect(e){var t=e.game,n=e.effect,r=e.ids,o=e.persist,a=e.updateState,s=void 0===a||a;if(o)return t.setup.effects=n?[n]:null,u.a.updateState(t),t;var l=d.a.getNode(t.jce._lines(),r)||d.a.getNode(t.jce._lines(),i.a.getSelectedIds(t))||t.tree.initialMarkings;return l.effects||(l.effects=[]),l.effects.find((function(e){return i.a.isFileRankEqual(e.square,n.square)}))||(l.effects.push(n),s&&(u.a.updateState(t),c.b.add(t.history,c.a.TREE_CHANGE))),t},D=function markSquare(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=d.a.getNode(e.jce._lines(),n)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;return o.squares||(o.squares=[]),o.squares.find((function(e){return i.a.isFileRankEqual(e,t)}))||(o.squares.push(t),r&&(u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE))),e},R=function fixTcn(e,t){var n=O({variant:e.variant,fen:a.a.getFirstFen(e)});return T(n,t,n.setup.fen),C(n)};function merge_tcn_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function select_line_end_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function select_line_end_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?select_line_end_ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):select_line_end_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function selectLineEnd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.tree.selected.line,n=d.a.getLine(e.jce._lines(),t).length-1,r=select_line_end_objectSpread({},e.tree.selected);if(e.tree.selected.move!==n||t!==e.tree.selected.line){var o={line:t,move:n};return i.a.selectNode(e,o),c.b.add(e.history,c.a.JUMP_TO_POSITION,{from:r,to:o}),u.a.updateState(e)}return e};function reset_to_main_line_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var L={addBlinkingSquare:function addBlinkingSquare(e,t,n,r){var i=a.a.getId(),s=function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:i,interval:t,times:n},r);return e.markings.blinkingSquares.push(s),setTimeout((function(){var t=e.markings.blinkingSquares.findIndex((function(e){return e.id===i}));e.markings.blinkingSquares.splice(t,1)}),0),e},addVariant:function addVariant(e,t){return t?(Object(s.a)(e,{line:0,move:0}),t.match(/.{2}/g).forEach((function(t){return h(e,{tcn:t},!0)})),e):e},canMoveBackward:function canMoveBackward(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===e.tree.selected.line&&e.tree.selected.move-t<-1)return!1;var r=e.tree.lines||n("./web/core/api/move-list/move-list.js").default.state.lines;return null!==d.a.findNode(r,e.tree.selected,-1*t,!1)},canMoveForward:function canMoveForward(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e.tree.lines||n("./web/core/api/move-list/move-list.js").default.state.lines;return null!==d.a.findNode(r,e.tree.selected,t,!1)},changeSettings:v,clearAnalysis:function clearAnalysis(e){var t=L.resetToMainLine(e),n=d.a.clearAnalysis(t.jce._lines());return t.jce.saveLines(n),c.b.add(t.history,c.a.TREE_CHANGE),u.a.updateState(e)},clearArrow:function clearArrow(e,t,n){var r=d.a.getNode(e.jce._lines(),n)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;r.arrows||(r.arrows=[]);var o=r.arrows.findIndex((function(e){return i.a.isFileRankEqual(e.fromFileRank,t.fromFileRank)&&i.a.isFileRankEqual(e.toFileRank,t.toFileRank)}));return-1!==o&&(r.arrows.splice(o,1),u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE)),e},clearBlinkingSquare:function clearBlinkingSquare(e,t){return e.markings.blinkingSquares[t]&&delete e.markings.blinkingSquares[t],e},clearBoard:function clearBoard(e){return v(e,{rules:!1}),E(e,"8/8/8/8/8/8/8/8 w - - 0 1"),c.b.add(e.history,c.a.LOAD),u.a.updateState(e)},clearEffect:function clearEffect(e,t,n){var r=d.a.getNode(e.jce._lines(),n)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;r.effects||(r.effects=[]);var o=r.effects.findIndex((function(e){return i.a.isFileRankEqual(e.square,t.square)}));return-1!==o&&(r.effects.splice(o,1),u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE)),e},clearMarkedSquare:function clearMarkedSquare(e,t,n){var r=d.a.getNode(e.jce._lines(),n)||d.a.getNode(e.jce._lines(),i.a.getSelectedIds(e))||e.tree.initialMarkings;r.squares||(r.squares=[]);var o=r.squares.findIndex((function(e){return i.a.isFileRankEqual(e,t)}));return-1!==o&&(r.squares.splice(o,1),u.a.updateState(e),c.b.add(e.history,c.a.TREE_CHANGE)),e},clearMarkings:_,clearNodes:function clearNodes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.jce._lines();if(!n)return e;if(void 0===t.line&&void 0===t.move)return n.forEach((function(e){e.forEach((function(e,t){return d.a.clearNode(n,{line:e.ids.line,move:t})}))})),c.b.add(e.history,c.a.TREE_CHANGE),e;if(void 0===t.move){var r=d.a.getLine(e.jce._lines(),t.line);return r?(r.forEach((function(e,t){return d.a.clearNode(n,{line:r.id,move:t})})),c.b.add(e.history,c.a.TREE_CHANGE),e):e}return d.a.getNode(n,t)?(d.a.clearNode(n,t),c.b.add(e.history,c.a.TREE_CHANGE),e):e},convertLanToFileRanks:function convertLanToFileRanks(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{fromFileRank:{file:y(e[0]),rank:Number(e[1])},toFileRank:{file:y(e[2]),rank:Number(e[3])}}},createGame:O,createVariation:f,deleteLine:function deleteLine(e,t){return e.jce.deletePosition(-1,t)?(c.b.add(e.history,c.a.TREE_CHANGE),u.a.updateState(e),e):null},deleteNode:j,deleteRemainingNodes:k,getCurrentFullLine:function getCurrentFullLine(e){var t=e.jce._history().length-e.jce.ids().move-1,n=e.jce.history(!0);return 0===t?n:n.slice(0,-t)},getPgn:function getPgn(e,t){return i.a.getPgn(e,t)},getPgnHeaders:function getPgnHeaders(e){return i.a.getHeaders(e)},getSelectedNode:function getSelectedNode(e){return d.a.getSelectedNode(e)},getTcn:C,isMoveLegal:function isMoveLegal(e,t){var n=!1;if(!e.settings.rules)return!0;for(var r=0;r<e.setup.legalMoves.length;r++){var o=e.setup.legalMoves[r];if(o.from===t.from&&o.to===t.to){n=!0;break}}return n},loadFromFen:E,loadFromLan:function loadFromLan(e,t,n,r){var o=t.map((function(e){return l.a.encodeTCN({from:e.slice(0,2),to:e.slice(2,4),promotion:e.slice(4,5)||void 0})})).join("");return L.loadFromTcn(e,o,n,r)},loadFromPgn:function loadFromPgn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t)return e;var o=Object(A.b)(t);return r&&!e.jce.loadPgn(o)?i.a.loadPgnSoft(e,o):i.a.loadPgn(e,o),u.a.updateState(e),n?Object(s.a)(e,e.tree.selected,n):(c.b.add(e.history,c.a.LOAD),e)},loadFromSanMoves:function loadFromSanMoves(e,t,n,r){return t&&t.length?(n&&i.a.load(e,n),t.forEach((function(t){return h(e,{san:t},!0)})),u.a.updateState(e),r?Object(s.a)(e,e.tree.selected,-1):(c.b.add(e.history,c.a.LOAD),e)):null},loadFromTcn:T,makeMove:h,makeOpponentMove:function makeOpponentMove(e,t){return g(e,3-e.setup.playingAs),h(e,t),g(e,3-e.setup.playingAs),u.a.updateState(e)},markArrow:N,markEffect:M,markSquare:D,mergeTcn:function mergeTcn(e,t,n){if("string"!=typeof t||e.settings.mainLineIsImmutable)return null;if(""===t)return P(e),T(e,"",e.setup.fen);var r=function merge_tcn_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?merge_tcn_ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):merge_tcn_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.tree.selected),a=C(e),i=t,u=e.history.length-1;if(!(a.includes(i)||i.includes(a)||(a=R(e,a),i=R(e,i),a.includes(i)||i.includes(a))))return T(e,i);if(i.length<a.length)Object(s.a)(e,{line:0,move:i.length/2-1}),k(e);else{if(!(i.length>a.length))return e;var f;if(Object(s.a)(e,{line:0,move:a.length/2-1}),i.slice(a.length).match(/.{2}/g).forEach((function(t){f=l.a.decodeTCN(t)[0],"Crazyhouse"!==e.variant&&"Bughouse"!==e.variant||!f.drop||Object(w.a)(e,e.setup.sideToMove,f.drop),h(e,f,!0)})),e.history.slice(u+1).some((function(e){return e&&e.type===c.a.ILLEGAL_MOVE})))return Object(s.a)(e,r),k(e),e.history=e.history.slice(0,u),mergeTcn(e,R(e,i))}if(n)return Object(s.a)(e,e.tree.selected,-1);if(r.line!==e.tree.selected.line||r.move!==e.tree.selected.move){var p=d.a.getNode(e.jce._lines(),r)?r:e.tree.selected;return Object(s.a)(e,p)}return e},moveBackward:function moveBackward(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(s.a)(e,e.tree.selected,-1*t,!1)},moveForward:function moveForward(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(s.a)(e,e.tree.selected,t,!1)},moveToEnd:function moveToEnd(e){return d.a.isMainLine(e.tree.selected.line)||i.a.selectLine(e,0),I(e),u.a.updateState(e)},moveToStart:function moveToStart(e){return d.a.isMainLine(e.tree.selected.line)||i.a.selectLine(e,0),P(e),u.a.updateState(e)},moveVariation:function moveVariation(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=d.a.getLine(e.jce._lines(),t);if(r&&void 0!==r.parentId){var o=d.a.getLine(e.jce._lines(),r.parentId)[r.atMoveNode],a=-1;if(o.lines.forEach((function(e,n){t===e&&(a=n)})),a>-1){var i=null;n&&a>0?(i=o.lines[a-1],o.lines[a-1]=t,o.lines[a]=i):!n&&a<o.lines.length-1&&(i=o.lines[a+1],o.lines[a+1]=t,o.lines[a]=i)}c.b.add(e.history,c.a.TREE_CHANGE)}return e},promoteVariation:function promoteVariation(e,t){var n=t;void 0===n&&(n=e.tree.selected);var r=d.a.getLine(e.jce._lines(),n.line);if(r&&void 0!==r.parentId)for(var o=n.move,a=function _loop(){if(e.settings.mainLineIsImmutable&&d.a.isMainLine(r.parentId))return"break";var t=d.a.getLine(e.jce._lines(),r.parentId),n=d.a.isContinuation(e.jce._lines(),r.id)?1:0,a=r[n]&&r[n].commentBefore,s=r.atMoveNode,c=r.slice(0);r.length=0,a&&t[s-1]&&(t[s-1].comment?(" "!==t[s-1].comment.substr(-1)&&(t[s-1].comment+=" "),t[s-1].comment+=a):t[s-1].comment=a,delete c[n].commentBefore,delete r.initComment);var u=t.slice(s),l=u[0].lines.map((function(e){return e}));delete u[0].lines,u.forEach((function(t,n){t.lines&&t.lines.length&&t.lines.forEach((function(t){var o=d.a.getLine(e.jce._lines(),t);o.parentId=r.id,o.atMoveNode=n}))})),t.length=s,c.forEach((function(n){n.ids={line:t.id,move:t.length},n.lines&&n.lines.length&&n.lines.forEach((function(n){var r=d.a.getLine(e.jce._lines(),n);r.parentId=t.id,r.atMoveNode=t.length})),t.push(n)})),u.forEach((function(e,t){e.ids={line:r.id,move:t},r.push(e)})),t[s].lines=l,t[s].lines.forEach((function(n){d.a.getLine(e.jce._lines(),n).parentId=t.id})),i.a.selectNode(e,{line:t.id,move:s+o}),r=d.a.getLine(e.jce._lines(),r.parentId),o=s+o};void 0!==r.parentId;){if("break"===a())break}return e.jce.saveLines(e.tree.lines),c.b.add(e.history,c.a.TREE_CHANGE),u.a.updateState(e)},resetToMainLine:function resetToMainLine(e){var t=function reset_to_main_line_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?reset_to_main_line_ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):reset_to_main_line_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.tree.selected);d.a.isMainLine(e.tree.selected.line)||i.a.selectLine(e,0),I(e);var n=e.tree.selected;return e.tree.lines.length=1,e.tree.lines=d.a.rebuildIds(e.tree.lines),e.jce.saveLines(e.tree.lines),c.b.add(e.history,c.a.JUMP_TO_POSITION,{from:t,to:n}),u.a.updateState(e)},selectLineEnd:I,selectLineStart:P,selectNode:s.a,setPlayingAs:g,updateMarkings:function updateMarkings(e){var t=e.arrow,n=e.effect,r=e.game,o=e.ids,a=e.square,i=e.resetFirst,s=!1;return(void 0===i||i)&&_(r,o,s),t&&N(r,t,o,s),n&&M({game:r,effect:n,ids:o,updateState:s}),a&&D(r,a,o,s),u.a.updateState(r),c.b.add(r.history,c.a.TREE_CHANGE),r},updateNode:function updateNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=e.jce._lines(),o=d.a.findNode(r,t);if(!o||!n||n.commentBefore&&!d.a.isFirstVisibleNode(r,t))return null;var a=d.a.getLine(r,t.line);if(void 0===n.commentBefore&&d.a.isFirstVisibleNode(r,t)?delete a.initComment:n.commentBefore&&(a.initComment=n.commentBefore),n.insertCommentAfterLastNode&&a.length){var i=a[a.length-1];i&&(i.comment=n.insertCommentAfterLastNode,delete n.insertCommentAfterLastNode)}if(n.annotation&&(n.annotation=Object(S.b)(o,n.annotation)?"":Object(S.m)(n.annotation)),n.additionalAnnotation){if(!Object(S.k)(n.additionalAnnotation))return null;Object(S.a)(o,n.additionalAnnotation)&&(n.additionalAnnotation=[]),n.additionalAnnotation=[].concat(Object(S.m)(n.additionalAnnotation))}return Object.assign(o,n),c.b.add(e.history,c.a.UPDATE_NODE,{line:t.line,move:t.move}),u.a.updateState(e)},updatePgnHeaders:function updatePgnHeaders(e,t){if(!t)return null;var n=Object.keys(t).reduce((function(e,n){return"Date"===n&&"number"==typeof t[n]&&(t[n]=a.a.formatJSTimestampForPgn(t[n])),e.push(n),e.push(t[n]),e}),[]);return i.a.updateHeaders(e,n),c.b.add(e.history,c.a.PGN_HEADERS_UPDATED),e.setup.result=u.a.getResult(e),e}}},"./chessboard/src/game/line.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={getLine:function getLine(e,t){return e[t]||null},getNode:function getNode(e,t,n){if("number"==typeof t){if(void 0!==n){var o=r.getLine(e,Math.max(0,t));return o?o[n]:null}return null}if(!t)return null;var a=r.getLine(e,Math.max(0,t.line));return a?a[t.move]:null},getSelectedLine:function getSelectedLine(e){return r.getLine(e.jce._lines(),e.tree.selected.line)},getSelectedNode:function getSelectedNode(e){return r.getNode(e.jce._lines(),e.tree.selected)},nodeIsSelected:function nodeIsSelected(e,t){return!!(t||t.line||t.move)&&(e.selected.line===t.line&&e.selected.move===t.move)},getLinesFromJce:function getLinesFromJce(e){return r.formatLinesFromJce(e.jce._lines())},getJceSelectedLine:function getJceSelectedLine(e){return e._lines()[e._history().id]},formatLinesFromJce:function formatLinesFromJce(e){return r.consolidateComments(e)},consolidateComments:function consolidateComments(e){return e.map((function(t){var n=r.isContinuation(e,t.id)?r.getNode(e,t.id,1):r.getNode(e,t.id,0);return n?(t.initComment&&(n.commentBefore=t.initComment),t):t}))},isContinuation:function isContinuation(e,t){var n=r.getLine(e,t);if(!n)return!1;if(void 0!==n.parentId&&void 0!==n[0]){var o=r.getNode(e,n.parentId,n.atMoveNode);return!(!o||!o.move)&&o.move===n[0].move}return!1},isMainLine:function isMainLine(e){return 0===e},getNextNodeIds:function getNextNodeIds(e,t){return!e||e.move+t<0?null:{line:e.line,move:e.move+t}},getNextContinuationLineId:function getNextContinuationLineId(e,t){var n=r.getNode(e,t);if(!n||!n.lines)return null;var o=n.lines.find((function(t){return r.isContinuation(e,t)}));return-1!==o?o:null},getParentNode:function getParentNode(e,t){var n={line:e[t.line].parentId,move:e[t.line].atMoveNode};return r.findNode(e,n)},getParentNodeIds:function getParentNodeIds(e,t){var n=r.getLine(e,t.line);return n&&void 0!==n.parentId?{line:n.parentId,move:n.atMoveNode}:null},deleteRemainingNodes:function deleteRemainingNodes(e,t){return e?(e.length=t+1,e):null},deleteNode:function deleteNode(e,t){return r.prune(e,{line:t.line,move:t.move-1})},deleteLine:function deleteLine(e,t){var n=r.getLine(e,t);if(void 0!==n.parentId){var o=r.getNode(e,{line:n.parentId,move:n.atMoveNode});o.lines=o.lines.filter((function(e){return e!==t})),0===o.lines.length&&delete o.lines}var a=e.filter((function(e){return r.isMainLine(e.id)||e.id!==t}));return r.rebuildIds(a)},rebuildIds:function rebuildIds(e){var t=[];return e.forEach((function(e,n){e.id!==n&&(t[e.id]=n)})),e.map((function(n){return n.id=void 0!==t[n.id]?t[n.id]:n.id,void 0!==t[n.parentId]&&(n.parentId=t[n.parentId]),n.forEach((function(n){n.ids.line=void 0!==t[n.ids.line]?t[n.ids.line]:n.ids.line,n.lines&&n.lines.length>0&&(n.lines=n.lines.map((function(e){return void 0!==t[e]?t[e]:e})).filter((function(t){return void 0!==e[t]})),0===n.lines.length&&delete n.lines)})),n}))},prune:function prune(e,t){return r.getNode(e,{line:t.line,move:t.move+1})?(e[t.line]=r.deleteRemainingNodes(e[t.line],t.move),!r.isMainLine(t.line)&&r.isFirstVisibleNode(e,t)&&e.splice(e.findIndex((function(e){return e.id===t.line})),1),e.sort((function(e,t){return e.id-t.id})).reduce((function(e,t){var n=r.getNode(e,{line:t.parentId,move:t.atMoveNode});return(r.isMainLine(t.id)||n)&&e.push(t),e}),[])):e},isFirstNodeInTree:function isFirstNodeInTree(e){return 0===e.line&&-1===e.move},isFirstVisibleNode:function isFirstVisibleNode(e,t){return r.isContinuation(e,t.line)?1===t.move:0===t.move},isFirstNodeInLine:function isFirstNodeInLine(e,t){return t&&e&&e[t.line]&&e[t.line][0]&&e[t.line][0].ids&&e[t.line][0].ids.line===t.line&&e[t.line][0].ids.move===t.move},isHead:function isHead(e,t){return t&&e[t.line].length-1===t.move||!1},getHeadIds:function getHeadIds(e,t){return{line:t,move:e[t].length-1}},nodeMatchesMove:function nodeMatchesMove(e,t,n){var o=r.getNode(e,t);return!!o&&(o.from===n.from&&o.to===n.to&&(o.promotion||null)===(n.promotion||null))},shouldMatchMove:function shouldMatchMove(e,t,n){return e&&1===t&&0===n},getNextMatchingNode:function getNextMatchingNode(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=r.getNode(e,t),a=r.getNode(e,t.line,t.move+1),i=e.reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return o&&e.moveNumber===o.moveNumber+1||a&&e.moveNumber===a.moveNumber})).filter((function(t){return!!(o&&t.ids.line===o.ids.line||a&&t.ids.line===a.ids.line)||(!!(o&&o.lines&&-1!==o.lines.indexOf(t.ids.line)&&r.isContinuation(e,t.ids.line))||!(!a||!a.lines||-1===a.lines.indexOf(t.ids.line)||r.isContinuation(e,t.ids.line)))})).filter((function(t){return r.nodeMatchesMove(e,t.ids,n)})).sort((function(e,t){return e.ids.line-t.ids.line}))[0];return i||null},clearNode:function clearNode(e,t){var n=r.getNode(e,t);return n?(delete n.comment,delete n.annotation,n):null},findNode:function findNode(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!e||void 0===n.line)return null;if("string"==typeof o)switch(n.move){case"begin":n.move=0;break;case"end":n.move=e[0].length-1}else if(void 0===n.move)return e[n.line];return o&&0!==Math.abs(o)&&(n=new Array(Math.abs(o)).fill(o/Math.abs(o)).reduce((function(n,o){if(null===n)return null;var i=r.isContinuation(e,n.line),s=r.getNextNodeIds(n,o);if(r.getNode(e,s)&&(-1!==o||!i||0!==s.move))return s;switch(o){case 1:return a?n:null!==(t=r.getNextContinuationLineId(e,n))?{line:t,move:1}:null;case-1:return s=i?r.getParentNodeIds(e,n):r.getNextNodeIds(r.getParentNodeIds(e,n),-1),r.getNode(e,s)?s:n;default:return null}}),n)),r.getNode(e,n)||null},clearNodeMarkings:function clearNodeMarkings(e,t){var n=r.getNode(e,t);return n?(delete n.squares,delete n.arrows,delete n.effects,n):null},clearNodeAnalysis:function clearNodeAnalysis(e,t){var n=r.getNode(e,t);return n?(delete n.comment,delete n.annotation,delete n.additionalAnnotation,n):null},clearAllMarkings:function clearAllMarkings(e){return e?(e.forEach((function(t){t.length>0&&t.forEach((function(t){return r.clearNodeMarkings(e,{line:t.ids.line,move:t.ids.move})}))})),e):null},clearAnalysis:function clearAnalysis(e){return e?(e.forEach((function(t){t.length>0&&t.forEach((function(t){return r.clearNodeAnalysis(e,{line:t.ids.line,move:t.ids.move})}))})),e):null}}},"./chessboard/src/game/move-list/helper.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s}));var r=n("./web/core/api/move-list/config.js"),o=n("./chessboard/src/game/move-node/helper.js"),a=function hasTreeLines(e){return Boolean(e&&e.tree&&e.tree.lines)},i=function normalizePgnAnnotation(e){return Object.keys(r.b).forEach((function(t){e=e.replace(new RegExp("\\".concat(t,"\\b"),"gm"),Object(o.m)(t))})),e},s=function updateScrollPosition(e){var t=e.moveIds,n=e.moveList,r=e.scrollEl;if(t&&n&&r){var o=n.getComponentRefByLineMove(t.line,t.move);if(o){var a=r.getBoundingClientRect(),i=o.$el?o.$el.getBoundingClientRect():o.getBoundingClientRect(),s=r.scrollTop,c=a.top+Math.floor(a.height/2)-i.top;r.scrollTop=s-c}}}},"./chessboard/src/game/move-node/helper.js":function(e,t,n){"use strict";n.d(t,"m",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"k",(function(){return s})),n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"l",(function(){return f})),n.d(t,"c",(function(){return p})),n.d(t,"e",(function(){return m})),n.d(t,"j",(function(){return h})),n.d(t,"d",(function(){return displayNumber}));n("./chessboard/src/game/line.js");var r=n("./web/core/api/move-list/config.js"),o=(n("./web/core/api/move-list/context-menu/config.js"),function normalizeAnnotation(e){return Object.prototype.hasOwnProperty.call(r.b,e)||Object.prototype.hasOwnProperty.call(r.a,e)?s(e)?r.b[e]:normalizeAnnotation(r.a[e]):e||""}),a=function additionalAnnotationExists(e,t){return e.additionalAnnotation&&Array.isArray(e.additionalAnnotation)&&o(e.additionalAnnotation[0])===o(t)},i=function annotationExists(e,t){return o(e.annotation)===o(t)},s=function isNagFormat(e){return e&&"$"===e.charAt(0)},c=function hasComment(e){return Boolean(e&&"string"==typeof e.comment)},u=function hasCommentBefore(e){return Boolean(e&&"string"==typeof e.commentBefore)},l=function hasLines(e){return Boolean(e&&e.lines&&e.lines.length)},d=function isEnPassant(e){return 4===e.flags},f=function nodeIsALimit(e,t,n){return Object.prototype.hasOwnProperty.call(e,n)&&Object.prototype.hasOwnProperty.call(e[n],"ids")&&e[n].ids.move===t.ids.move&&e[n].ids.line===t.ids.line},p=function cleanCommentString(e){var t;return" "===(t=(t=e.replace(/<\/?[^>]+(>|$)/g,"")).replace(/&nbsp;/g," "))&&(t=""),t},m=function generateAnnotationString(e){var t,n,r="";return e.annotation&&(r="".concat(r).concat(o(e.annotation))),1===(null===(t=e.additionalAnnotation)||void 0===t?void 0:t.length)&&(r="".concat(r,"&nbsp;").concat(o(e.additionalAnnotation[0]))),(null===(n=e.additionalAnnotation)||void 0===n?void 0:n.length)>1&&(r="".concat(r,"&nbsp;").concat(o(e.additionalAnnotation.join("")))),r},h=function isFirstNodeOnFormattedLine(e){return 0===e.ids.move};function displayNumber(e,t){var n="";return function shouldShowDisplayNumber(e){return Boolean(e.isWhite||e.isFirstNodeOnLine||e.previousHasComment||e.previousHasLines)}(e)&&(n+="".concat(e.nodeMoveNumber+(t-1),"."),function shouldShowEllipsisOnBlackMoveNumber(e){return Boolean(!e.isWhite&&(e.previousHasComment||e.previousHasLines||e.isFirstNodeOnLine))}(e)&&(n+=".."),n+="&nbsp;"),n}},"./chessboard/src/game/state.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./chessboard/src/game/line.js"),i=n("./chessboard/src/game/game.lib.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s={},c={q:9,r:5,b:3,n:3,p:1,k:0},u={getInitialSettings:function getInitialSettings(){return{variations:!1,analysis:!1,mainLineIsImmutable:!1,rules:!0,premoves:!1,GTM:!1}},getInitialSetup:function getInitialSetup(){return{ranks:8,files:8}},getInitialTree:function getInitialTree(){return{initialMarkings:{arrows:[],effects:[],squares:[]}}},getInitialMarkings:function getInitialMarkings(){return{arrows:[],blinkingSquares:[],effects:[],squares:[]}},clearState:function clearState(e){return e.setup=u.getInitialSetup(),e},updateState:function updateState(e){e.setup=Object.assign({},e.setup,i.a.getPositionInfo(e),i.a.getPositionDetails(e)),i.a.addExtraCastlingMoves(e),e.tree.lines=a.a.getLinesFromJce(e),e.tree.selected=e.jce.ids(),e.tree.selectedNode=a.a.getSelectedNode(e),e.setup.capturedPieces=u.getCapturedPieces(e.setup),e.setup.capturedScores=u.getCapturedScores(e.setup),e.setup.result=u.getResult(e),e.premoves=i.a.getPremoves(e),e.variant=i.a.getHeaders(e).Variant||e.variant,e.startingMoveNumber=e.setup.moveNumber;var t=a.a.getNode(e.tree.lines,i.a.getSelectedIds(e))||e.tree.initialMarkings;return t&&(e.markings.squares=t.squares?t.squares.map((function(e){return _objectSpread({},e)})):[],e.markings.arrows=t.arrows?t.arrows.map((function(e){return _objectSpread({},e)})):[],e.setup.effects?e.markings.effects=e.setup.effects:t.effects?e.markings.effects=t.effects.map((function(e){return _objectSpread({},e)})):e.markings.effects=[]),s[e.id]=!0,e.sibling&&!s[e.sibling.id]&&(e.sibling=u.updateState(e.sibling)),s={},e},getCapturedPieces:function getCapturedPieces(e){return e.pieces.reduce((function(e,t){if("k"===t.type)return e;var n=t.promoted?"p":t.type;return e[t.color-1][n]-=1,e}),[{p:8,n:2,b:2,r:2,q:1},{p:8,n:2,b:2,r:2,q:1}])},getCapturedScores:function getCapturedScores(e){return e.pieces.reduce((function(e,t){return e[t.color-1]+=c[t.type],e}),[0,0])},getResult:function getResult(e){var t=i.a.getHeaders(e).Result;return"*"!==t?t:e.setup.insufficient||e.setup.stalemate?"1/2-1/2":e.setup.gameOver&&!e.setup.draw?1===e.setup.sideToMove?"0-1":"1-0":"*"}}},"./chessboard/src/game/utils.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=n.n(a);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s={getId:function getId(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array(e||20).fill().reduce((function(e){return e+t.charAt(Math.floor(Math.random()*t.length))}),"")},getInitialFen:function getInitialFen(){return"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},formatJSTimestampForPgn:function formatJSTimestampForPgn(e){var t=new Date(e),n="0".concat(t.getUTCDate()).slice(-2),r="0".concat(t.getUTCMonth()+1).slice(-2);return"".concat(t.getFullYear(),"-").concat(r,"-").concat(n)},getSanFromFileRank:function getSanFromFileRank(e){return e&&e.file&&e.rank?String.fromCharCode(96+e.file)+e.rank.toString():null},getFileRankFromSan:function getFileRankFromSan(e){return e?{file:e.toLowerCase().charCodeAt(0)-96,rank:Number(e.charAt(1))}:null},getPieceAt:function getPieceAt(e,t){return e.setup.pieces.find((function(e){return e.file===t.file&&e.rank===t.rank}))},cloneGame:function cloneGame(e){return{id:e.id,variant:e.variant,jce:e.jce,tree:s.cloneTree(e.tree),setup:JSON.parse(JSON.stringify(e.setup)),markings:_objectSpread({},e.markings),settings:_objectSpread({},e.settings),history:o()(e.history),premoves:e.premoves.map((function(e){return JSON.parse(JSON.stringify(e))}))}},cloneTree:function cloneTree(e){return _objectSpread(_objectSpread({},e),{},{initialMarkings:JSON.parse(JSON.stringify(e.initialMarkings)),selected:_objectSpread({},e.selected),selectedNode:e.selectedNode?_objectSpread(_objectSpread({},e.selectedNode),{},{ids:_objectSpread({},e.selectedNode.ids),hash:o()(e.selectedNode.hash),lines:e.selectedNode.lines&&o()(e.selectedNode.lines),arrows:e.selectedNode.arrows&&o()(e.selectedNode.arrows)}):null})},getFirstFen:function getFirstFen(e){return e.tree.lines[0].length?e.tree.lines[0][0].beforeFen:e.setup.fen}}},"./core/navigation/config/targets.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./core/navigation/config/targets.js")},"./core/utils/dom/has-touch.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r="ontouchstart"in window||window.navigator.maxTouchPoints>0||window.navigator.msMaxTouchPoints>0||/firefox/i.test(window.navigator.userAgent)&&"TouchEvent"in window},"./core/utils/features/constants.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={ADMIN_USER_LIVE_CHESS_PRIORITY:"data-admin-user-live-chess-priority",ANALYSIS_GAME_PGN_SUPPORT:"data-feature-game-analysis-support-for-game-pgn",ADS_PLAYWIRE_INTEGRATION:"data-feature-ads-playwire-integration",CHESSBOARD_BETA:"data-feature-chessboard-beta",CHESSBOARD_REPORTING_PLUGIN:"data-feature-chessboard-reporting-plugin",CHESS_TODAY:"data-feature-chess-today",CHESS_VARIANTS:"data-feature-chess-variants",DE_NEW_CHESSBOARD:"data-diagram-editor-new-chessboard-migration",EVENTS_REDIRECT:"data-feature-events-redirect",GAME_OF_THE_DAY:"data-feature-game-of-the-day-widget",IS_LIVE:"data-is-live",IS_NOT_MESSAGEABLE_REASON:"data-feature-is-not-messageable-reason",LEADERBOARD_TREND:"data-feature-leaderboard-trend",LESSONS_BOOKMARKS:"data-feature-lessons-bookmarks",LIBRARY:"data-feature-library",MULTI_PGN_VIEWER:"data-feature-multi-pgn-viewer",FORM_CHIPS_NEW_DS:"data-feature-form-chips-new-ds",NEW_GAME_MODAL_USE_PLAY_ONLINE:"data-new-game-modal-use-play-online",PAGE_WITH_NEW_CHESSBOARD_AND_DIAGRAMS_IN_COMMENTS:"data-feature-page-with-new-chessboard-and-diagrams-in-comments",PAYMENTS_PURCHASE_WITH_TAX:"data-feature-payments-purchase-with-tax",PGN_ANNOTATIONS:"data-feature-pgn-annotation-for-download",PLATFORM_USER_NOTICES:"data-feature-platform-user-notices",PLAY_ONLINE:"data-feature-play-online",PLAY_RCN:"data-feature-play-rcn",PAYMENTS_PAYU_REDIRECT:"data-feature-payments-payu-redirect",PUZZLE_RESET:"data-feature-puzzle-reset",PUZZLE_RUSH_LEADERBOARD_FIX:"data-feature-puzzle-rush-leaderboard-fix",OLD_BOARD_IMAGE_SIZE_150:"data-feature-old-board-image-size-150",REGISTER_FACEBOOK:"data-feature-register-facebook",REDIRECT_TO_WEB_PAGE_PLAY:"data-feature-redirect-to-web-page-play",SEO_EXIT_RETENTION_MODAL:"data-feature-seo-exit-retention-modal",SEO_FIRST_TIME_MODAL:"data-feature-seo-first-time-modal",V5_NEW_FRIENDS_REDESIGN:"data-feature-v5-new-friends-redesign",V5_NEW_CLUBS_PAGES:"data-feature-v5-new-clubs-pages",V5_PROFILE_HEADER:"data-feature-v5-profile-header"}},"./core/utils/features/index.js":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("./core/navigation/config/targets.js"),o={},a=document.getElementById(r.targets.NAV_ROOT),i=function hasFeatureAccess(e,t){var n=t||a;return o[e]||(o[e]=Boolean(n&&n.getAttribute(e))),o[e]}},"./node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(e,t){e.exports=function _arrayWithHoles(e){if(Array.isArray(e))return e}},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/classCallCheck.js")},"./node_modules/@babel/runtime/helpers/createClass.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/createClass.js")},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/defineProperty.js")},"./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(e,t){e.exports=function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(c){o=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}}},"./node_modules/@babel/runtime/helpers/nonIterableRest.js":function(e,t){e.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},"./node_modules/@babel/runtime/helpers/slicedToArray.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayWithHoles.js"),o=n("./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),a=n("./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js"),i=n("./node_modules/@babel/runtime/helpers/nonIterableRest.js");e.exports=function _slicedToArray(e,t){return r(e)||o(e,t)||a(e,t)||i()}},"./node_modules/@babel/runtime/helpers/toConsumableArray.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/toConsumableArray.js")},"./node_modules/@babel/runtime/helpers/typeof.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/typeof.js")},"./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js")},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/less-loader/dist/cjs.js!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/marked-arrow.vue?vue&type=style&index=0&lang=less&":function(e,t,n){},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/coordinates.vue?vue&type=style&index=0&lang=scss&":function(e,t,n){},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/custom-item.vue?vue&type=style&index=0&lang=scss&":function(e,t,n){},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/marked-effect.vue?vue&type=style&index=0&lang=scss&module=true&":function(e,t,n){e.exports={effect:"marked-effect-effect"}},"./node_modules/@chesscom/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/dist/cjs.js?!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/sass-loader/dist/cjs.js?!./node_modules/vue-loader/lib/index.js?!./chessboard/src/components/chessboard/standalone/default/chessboard.vue?vue&type=style&index=0&lang=scss&module=true&":function(e,t,n){},"./node_modules/axios/index.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/axios/index.js")},"./node_modules/bazinga-translator/js/translator.js":function(e,t,n){var r,o;void 0===(o="function"==typeof(r=function(){"use strict";var e={},t="en",n=[],r=new RegExp(/^\w+\: +(.+)$/),o=new RegExp(/^\s*((\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]]))\s?(.+?)$/),a=new RegExp(/^\s*(\{\s*(\-?\d+[\s*,\s*\-?\d+]*)\s*\})|([\[\]])\s*(-Inf|\-?\d+)\s*,\s*(\+?Inf|\-?\d+)\s*([\[\]])/),i={locale:get_current_locale(),fallback:t,placeHolderPrefix:"%",placeHolderSuffix:"%",defaultDomain:"messages",pluralSeparator:"|",add:function(t,r,o,a){var i=a||this.locale||this.fallback,s=o||this.defaultDomain;return e[i]||(e[i]={}),e[i][s]||(e[i][s]={}),e[i][s][t]=r,!1===exists(n,s)&&n.push(s),this},trans:function(e,t,n,r){return replace_placeholders(get_message(e,n,r,this.locale,this.fallback),t||{})},transChoice:function(e,t,n,r,o){var a=get_message(e,r,o,this.locale,this.fallback),i=parseInt(t,10);return void 0===(n=n||{}).count&&(n.count=t),void 0===a||isNaN(i)||(a=pluralize(a,i,o||this.locale||this.fallback)),replace_placeholders(a,n)},fromJSON:function(e){if("string"==typeof e&&(e=JSON.parse(e)),e.locale&&(this.locale=e.locale),e.fallback&&(this.fallback=e.fallback),e.defaultDomain&&(this.defaultDomain=e.defaultDomain),e.translations)for(var t in e.translations)for(var n in e.translations[t])for(var r in e.translations[t][n])this.add(r,e.translations[t][n][r],n,t);return this},reset:function(){e={},n=[],this.locale=get_current_locale()}};function replace_placeholders(e,t){var n,r=i.placeHolderPrefix,o=i.placeHolderSuffix;for(n in t){var a=new RegExp(r+n+o,"g");if(a.test(e)){var s=String(t[n]).replace(new RegExp("\\$","g"),"$$$$");e=e.replace(a,s)}}return e}function get_message(t,r,o,a,i){var s,c,u,l=o||a||i,d=r,f=l.split("_")[0];if(!(l in e))if(f in e)l=f;else{if(!(i in e))return t;l=i}if(null==d)for(var p=0;p<n.length;p++)if(has_message(l,n[p],t)||has_message(f,n[p],t)||has_message(i,n[p],t)){d=n[p];break}if(has_message(l,d,t))return e[l][d][t];for(;l.length>2&&(s=l.length,u=(c=l.split(/[\s_]+/))[c.length-1].length,1!==c.length);)if(has_message(l=l.substring(0,s-(u+1)),d,t))return e[l][d][t];return has_message(i,d,t)?e[i][d][t]:t}function has_message(t,n,r){return t in e&&n in e[t]&&r in e[t][n]}function pluralize(e,t,n){var s,c,u=[],l=[],d=e.split(i.pluralSeparator),f=[];for(s=0;s<d.length;s++){var p=d[s];o.test(p)?u[(f=p.match(o))[0]]=f[f.length-1]:r.test(p)?(f=p.match(r),l.push(f[1])):l.push(p)}for(c in u)if(a.test(c))if((f=c.match(a))[1]){var m,h=f[2].split(",");for(m in h)if(t==h[m])return u[c]}else{var g=convert_number(f[4]),b=convert_number(f[5]);if(("["===f[3]?t>=g:t>g)&&("]"===f[6]?t<=b:t<b))return u[c]}return l[plural_position(t,n)]||l[0]||void 0}function convert_number(e){return"-Inf"===e?Number.NEGATIVE_INFINITY:"+Inf"===e||"Inf"===e?Number.POSITIVE_INFINITY:parseInt(e,10)}function plural_position(e,t){var n=t;switch("pt_BR"===n&&(n="xbr"),n.length>3&&(n=n.split("_")[0]),n){case"bo":case"dz":case"id":case"ja":case"jv":case"ka":case"km":case"kn":case"ko":case"ms":case"th":case"tr":case"vi":case"zh":return 0;case"af":case"az":case"bn":case"bg":case"ca":case"da":case"de":case"el":case"en":case"eo":case"es":case"et":case"eu":case"fa":case"fi":case"fo":case"fur":case"fy":case"gl":case"gu":case"ha":case"he":case"hu":case"is":case"it":case"ku":case"lb":case"ml":case"mn":case"mr":case"nah":case"nb":case"ne":case"nl":case"nn":case"no":case"om":case"or":case"pa":case"pap":case"ps":case"pt":case"so":case"sq":case"sv":case"sw":case"ta":case"te":case"tk":case"ur":case"zu":return 1==e?0:1;case"am":case"bh":case"fil":case"fr":case"gun":case"hi":case"ln":case"mg":case"nso":case"xbr":case"ti":case"wa":return 0===e||1==e?0:1;case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2;case"cs":case"sk":return 1==e?0:e>=2&&e<=4?1:2;case"ga":return 1==e?0:2==e?1:2;case"lt":return e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2;case"sl":return e%100==1?0:e%100==2?1:e%100==3||e%100==4?2:3;case"mk":return e%10==1?0:1;case"mt":return 1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3;case"lv":return 0===e?0:e%10==1&&e%100!=11?1:2;case"pl":return 1==e?0:e%10>=2&&e%10<=4&&(e%100<12||e%100>14)?1:2;case"cy":return 1==e?0:2==e?1:8==e||11==e?2:3;case"ro":return 1==e?0:0===e||e%100>0&&e%100<20?1:2;case"ar":return 0===e?0:1==e?1:2==e?2:e>=3&&e<=10?3:e>=11&&e<=99?4:5;default:return 0}}function exists(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}function get_current_locale(){return"undefined"!=typeof document?document.documentElement.lang.replace("-","_"):t}return i})?r.call(t,n,t,e):r)||(e.exports=o)},"./node_modules/lodash-es/_Symbol.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/lodash-es/_Symbol.js")},"./node_modules/lodash-es/_basePropertyOf.js":function(e,t,n){"use strict";t.a=function basePropertyOf(e){return function(t){return null==e?void 0:e[t]}}},"./node_modules/lodash-es/debounce.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/lodash-es/debounce.js")},"./node_modules/lodash-es/isArray.js":function(e,t,n){"use strict";var r=Array.isArray;t.a=r},"./node_modules/lodash-es/isObject.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/lodash-es/isObject.js")},"./node_modules/lodash-es/isSymbol.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./node_modules/lodash-es/isSymbol.js")},"./node_modules/lodash-es/toString.js":function(e,t,n){"use strict";var r=n("./node_modules/lodash-es/_Symbol.js");var o=function arrayMap(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o},a=n("./node_modules/lodash-es/isArray.js"),i=n("./node_modules/lodash-es/isSymbol.js"),s=r.default?r.default.prototype:void 0,c=s?s.toString:void 0;var u=function baseToString(e){if("string"==typeof e)return e;if(Object(a.a)(e))return o(e,baseToString)+"";if(Object(i.default)(e))return c?c.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};t.a=function toString_toString(e){return null==e?"":u(e)}},"./node_modules/vue-loader/lib/runtime/componentNormalizer.js":function(e,t,n){"use strict";function normalizeComponent(e,t,n,r,o,a,i,s){var c,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),r&&(u.functional=!0),a&&(u._scopeId="data-v-"+a),i?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},u._ssrRegister=c):o&&(c=s?function(){o.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:o),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function renderWithStyleInjection(e,t){return c.call(t),l(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:u}}n.d(t,"a",(function(){return normalizeComponent}))},"./utils/browser.js":function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"i",(function(){return a})),n.d(t,"j",(function(){return i})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"e",(function(){return f})),n.d(t,"b",(function(){return m}));var r=function getWindowTitle(){return encodeURIComponent(window.document.title)},o=function getWindowLocation(){return encodeURIComponent(window.location.href)},a=window.location.pathname,i=r(),s=o();window.chessBrowserChecker={};var c=function bookmarkPage(){if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,s,"");else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(s,i);else{var e=-1!==window.navigator.userAgent.toLowerCase().indexOf("mac")?"Cmd":"Ctrl";alert("Press ".concat(e,"+D to bookmark this page."))}},u={chrome:"Chrome",edge:"edge",firefox:"Firefox",ie:"IE",safari:"Safari",waterfox:"Waterfox"},l=function printWindow(){window.print()},d=function sendEmail(e,t){window.location.href="mailto:?".concat(e,"&").concat(t)},f=function isMobile(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)},p=function isEdge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return null!==e.match(/Edg/)},m=function getBrowser(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(p(t)){var r=t.indexOf("Edg"),o=4;t.match("Edge/")&&(o=5);var a=r+o,i=parseInt(t.substring(a,t.indexOf(".",a)),10);return{name:"Edge",version:parseInt(i,10)}}if(/trident/i.test(n[1]))return e=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"IE",version:parseInt(e[1]||-1,10)};if(n[1]===u.chrome&&null!=(e=t.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:parseInt(e[1],10)};if(n[1]===u.firefox){var s=t.match(/(waterfox(?=\/))\/?\s*(\d+)/i)||[];if(s[1]===u.waterfox)return{name:s[1],version:parseInt(s[2],10)}}return(n=n[2]?[n[1],n[2]]:[window.navigator.appName,window.navigator.appVersion,"-?"])[0]===u.safari&&null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),"MSIE"===n[0]?{name:u.ie,version:parseInt(n[1],10)}:{name:n[0],version:parseInt(n[1],10)}}},"./utils/common/throttle.js":function(e,t,n){"use strict";var r=n("./node_modules/lodash-es/debounce.js"),o=n("./node_modules/lodash-es/isObject.js");var a=function throttle(e,t,n){var a=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Object(o.default)(n)&&(a="leading"in n?!!n.leading:a,i="trailing"in n?!!n.trailing:i),Object(r.default)(e,t,{leading:a,maxWait:t,trailing:i})};t.a=a},"./utils/dark-mode.ts":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var r="dark-mode",o=function getIsDarkMode(){return document.body.classList.contains(r)},a=o()},"./utils/object.js":function(e,t,n){"use strict";n.d(t,"d",(function(){return ie})),n.d(t,"b",(function(){return se})),n.d(t,"c",(function(){return ce})),n.d(t,"e",(function(){return ue})),n.d(t,"a",(function(){return le}));n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),n("./node_modules/@babel/runtime/helpers/typeof.js");var r=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(r),a=n("./node_modules/lodash-es/toString.js");var i=function baseSlice(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(o);++r<o;)a[r]=e[r+t];return a};var s=function castSlice(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:i(e,t,n)},c=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var u=function hasUnicode(e){return c.test(e)};var l=function asciiToArray(e){return e.split("")},d="[\\ud800-\\udfff]",f="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",p="\\ud83c[\\udffb-\\udfff]",m="[^\\ud800-\\udfff]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",g="[\\ud800-\\udbff][\\udc00-\\udfff]",b="(?:"+f+"|"+p+")"+"?",v="[\\ufe0e\\ufe0f]?",E=v+b+("(?:\\u200d(?:"+[m,h,g].join("|")+")"+v+b+")*"),_="(?:"+[m+f+"?",f,h,g,d].join("|")+")",y=RegExp(p+"(?="+p+")|"+_+E,"g");var O=function unicodeToArray(e){return e.match(y)||[]};var S=function stringToArray(e){return u(e)?O(e):l(e)};var P=function createCaseFirst(e){return function(t){t=Object(a.a)(t);var n=u(t)?S(t):void 0,r=n?n[0]:t.charAt(0),o=n?s(n,1).join(""):t.slice(1);return r[e]()+o}}("toUpperCase");var j=function capitalize(e){return P(Object(a.a)(e).toLowerCase())};var k=function arrayReduce(e,t,n,r){var o=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++o]);++o<a;)n=t(n,e[o],o,e);return n},C=n("./node_modules/lodash-es/_basePropertyOf.js"),A=Object(C.a)({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),w=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,T=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var N=function deburr(e){return(e=Object(a.a)(e))&&e.replace(w,A).replace(T,"")},M=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var D=function asciiWords(e){return e.match(M)||[]},R=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var I=function hasUnicodeWord(e){return R.test(e)},L="\\u2700-\\u27bf",x="a-z\\xdf-\\xf6\\xf8-\\xff",F="A-Z\\xc0-\\xd6\\xd8-\\xde",B="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",U="["+B+"]",V="\\d+",K="[\\u2700-\\u27bf]",q="["+x+"]",G="[^\\ud800-\\udfff"+B+V+L+x+F+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",H="[\\ud800-\\udbff][\\udc00-\\udfff]",$="["+F+"]",W="(?:"+q+"|"+G+")",Q="(?:"+$+"|"+G+")",Y="(?:['’](?:d|ll|m|re|s|t|ve))?",J="(?:['’](?:D|LL|M|RE|S|T|VE))?",Z="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",X="[\\ufe0e\\ufe0f]?",ee=X+Z+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",z,H].join("|")+")"+X+Z+")*"),te="(?:"+[K,z,H].join("|")+")"+ee,ne=RegExp([$+"?"+q+"+"+Y+"(?="+[U,$,"$"].join("|")+")",Q+"+"+J+"(?="+[U,$+W,"$"].join("|")+")",$+"?"+W+"+"+Y,$+"+"+J,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",V,te].join("|"),"g");var re=function unicodeWords(e){return e.match(ne)||[]};var oe=function words(e,t,n){return e=Object(a.a)(e),void 0===(t=n?void 0:t)?I(e)?re(e):D(e):e.match(t)||[]},ae=RegExp("['’]","g");(function createCompounder(e){return function(t){return k(oe(N(t).replace(ae,"")),e,"")}})((function(e,t,n){return t=t.toLowerCase(),e+(n?j(t):t)}));function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie=function objectIsEmpty(e){return e&&!Object.keys(e).length};var se=function objectHasData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e&&Object.keys(e).length>0};var ce=function objectHasProp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Object.prototype.hasOwnProperty.call(e,t)},ue=function objectWithExcludedProps(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object.keys(e).filter((function(e){return!t.includes(e)})).reduce((function(t,n){return _objectSpread(_objectSpread({},t),{},o()({},n,e[n]))}),{})},le=function invertObject(e){return Object.keys(e).reduce((function(t,n){return _objectSpread(_objectSpread({},t),{},o()({},e[n],n))}),{})}},"./utils/router.js":function(e,t,n){"use strict";var r=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n("./node_modules/@babel/runtime/helpers/createClass.js"),i=n.n(a),s=n("./utils/sentry/capture-exception.js"),c=(n("./utils/sentry/set-sentry-context.js"),function(){function Router(){o()(this,Router),this.baseUrl=null,null==window.Routing&&(window.Routing={generate:function generate(e){return e}})}return i()(Router,[{key:"generate",value:function generate(e,t,n){var r=t||{},o=this.baseUrl||r.baseUrl||null;"string"==typeof r.username&&(r.username=r.username.toLowerCase());try{return null!=o?(delete r.baseUrl,o+window.Routing.generate(e,r,!1)):window.Routing.generate(e,r,n)}catch(i){var a=new Error("Couldn't find missing route '".concat(e,"'."));return console.error(a),Object(s.a)(a,{missing_route:e}),"/"}}},{key:"getRouteRegex",value:function getRouteRegex(e){for(var t=function escapeRegex(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},n=function removePossesiveQuantifier(e){return e.replace("++","+")},r=window.Routing.getRoute(e),o="",a=r.tokens.length-1;a>=0;--a){var i=r.tokens[a];"variable"===i[0]?o+="".concat(t(i[1]),"(?<").concat(i[3],">").concat(n(i[2]),")"):o+=t(i[1])}return"^".concat(o,"$")}},{key:"setBaseUrl",value:function setBaseUrl(e){this.baseUrl=e}}]),Router}());t.a=new c},"./utils/sentry/capture-exception.js":function(e,t,n){"use strict";function captureException(e,t){if(window.Sentry){var n=e instanceof Error?e:new Error(e);t?window.Sentry.withScope((function(e){Object.keys(t).forEach((function(n){return e.setExtra(n,t[n])})),window.Sentry.captureException(n)})):window.Sentry.captureException(n)}}n.d(t,"a",(function(){return captureException}))},"./utils/sentry/set-sentry-context.js":function(e,t,n){e.exports=n("dll-reference vueDLL")("./utils/sentry/set-sentry-context.js")},"./utils/shared/add-directive-event-listeners.helper.js":function(e,t,n){"use strict";function addDirectiveEventListeners(e,t,n){var r="$unbind".concat(e);t[r]&&t[r](),Object.keys(n).forEach((function(e){t.addEventListener(e,n[e])})),t[r]=function(){Object.keys(n).forEach((function(e){t.removeEventListener(e,n[e]),delete n[e]})),delete t[r]}}n.d(t,"a",(function(){return addDirectiveEventListeners}))},"./utils/translation/translation.helper.js":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return u}));var r=n("./node_modules/bazinga-translator/js/translator.js"),o=n.n(r);o.a.placeHolderPrefix="",o.a.placeHolderSuffix="";var a=function escapeParameters(e){var t={};return null!=e&&Object.keys(e).forEach((function(n){var r=function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(n);null!=r&&r.length>0&&(t[r]=e[n])})),t},i=function getTranslatedPhrase(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"messages",n=arguments.length>2?arguments[2]:void 0;return window.chesscom_translations&&window.chesscom_translations[t]&&window.chesscom_translations[t][e]?window.chesscom_translations[t][e]:window.chesscom_live_translations&&window.chesscom_live_translations[t]&&window.chesscom_live_translations[t][e]?window.chesscom_live_translations[t][e]:"live"===t&&window.i18n_phrases&&window.i18n_phrases[e]?window.i18n_phrases:"countries"===t&&window.Country&&window.Country[e]?window.Country:n?void 0:"javascript"!==t?getTranslatedPhrase(e,"javascript"):e},s=function trans(e,t,n){return o.a.trans(i(e,n),a(t),n)},c=function transChoice(e,t,n,r){return void 0===t?"":o.a.transChoice(i(e,r),t,a(n))},u={trans:s,transChoice:c}},"./utils/translator.js":function(e,t,n){"use strict";var r=n("./utils/translation/translation.helper.js");t.a=r.a},"./utils/window/post-message.ts":function(e,t,n){"use strict";function postMessage(e){window.postMessage(e,window.location.origin)}n.d(t,"a",(function(){return postMessage}))},"./web/core/api/move-list/config.js":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i}));var r=n("./utils/object.js"),o={$1:"!",$2:"?",$3:"!!",$4:"??",$5:"!?",$6:"?!",$10:"=",$11:"=",$12:"=",$13:"∞",$14:"⩲",$15:"⩱",$16:"±",$17:"∓",$18:"+-",$19:"-+",$22:"⨀",$23:"⨀",$32:"⟳",$33:"⟳",$36:"→",$37:"→",$40:"↑",$41:"↑",$44:"∞/=",$45:"=/∞",$132:"⇆",$133:"⇆",$146:"N"},a=Object(r.a)(o),i={defaultCharLength:7,defaultCharWidth:6}},"./web/core/api/move-list/context-menu/config.js":function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"c",(function(){return p}));var r,o,a,i=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),s=n.n(i),c=n("./web/core/api/move-list/config.js"),u=n("./utils/translator.js"),l={AFTER:"after",BEFORE:"before"},d={ADD_ANNOTATION:"addAnnotation",ADD_EVAL_NOTATION:"addEvalNotation",CLEAR_ANALYSIS:"clearAnalysis",CREATE_CONTINUATION:"createContinuation",CREATE_VARIATION:"createVariation",DELETE_COMMENT:"deleteComment",DELETE_LINE:"deleteLine",DELETE_MOVE:"deleteMove",INSERT_COMMENT:"insertComment",MOVE_VARIATION_DOWN:"moveVariationDown",MOVE_VARIATION:"moveVariation",PROMOTE_VARIATION:"promoteVariation",REMOVE_ANNOTATION:"removeAnnotation",REMOVE_BEGIN:"removeBegin",REMOVE_END:"removeEnd",REMOVE_EVAL_ANNOTATION:"removeEvalAnnotation",REMOVE_FOCUS:"removeFocus",SET_BEGIN:"setBegin",SET_END:"setEnd",SET_FOCUS:"setFocus",UPDATE_COMMENT:"updateComment"},f=[{code:"$1",display:c.b.$1,meaning:u.a.trans("Good move"),action:d.ADD_ANNOTATION},{code:"$2",display:c.b.$2,meaning:u.a.trans("Bad move"),action:d.ADD_ANNOTATION},{code:"$3",display:c.b.$3,meaning:u.a.trans("Excellent move"),action:d.ADD_ANNOTATION},{code:"$4",display:c.b.$4,meaning:u.a.trans("Blunder"),action:d.ADD_ANNOTATION},{code:"$5",display:c.b.$5,meaning:u.a.trans("Speculative move"),action:d.ADD_ANNOTATION},{code:"$6",display:c.b.$6,meaning:u.a.trans("Dubious move"),action:d.ADD_ANNOTATION},{code:"$10",display:c.b.$10,meaning:u.a.trans("Drawish"),action:d.ADD_EVAL_NOTATION},{code:"$13",display:c.b.$13,meaning:u.a.trans("Unclear"),action:d.ADD_EVAL_NOTATION},{code:"$14",display:c.b.$14,meaning:u.a.trans("White has a slight advantage"),action:d.ADD_EVAL_NOTATION},{code:"$15",display:c.b.$15,meaning:u.a.trans("Black has a slight advantage"),action:d.ADD_EVAL_NOTATION},{code:"$16",display:c.b.$16,meaning:u.a.trans("White has a moderate advantage"),action:d.ADD_EVAL_NOTATION},{code:"$17",display:c.b.$17,meaning:u.a.trans("Black has a moderate advantage"),action:d.ADD_EVAL_NOTATION},{code:"$18",display:c.b.$18,meaning:u.a.trans("White has a decisive advantage"),action:d.ADD_EVAL_NOTATION},{code:"$19",display:c.b.$19,meaning:u.a.trans("Black has a decisive advantage"),action:d.ADD_EVAL_NOTATION},{code:"$22",display:c.b.$22,meaning:u.a.trans("The position is in zugzwang"),action:d.ADD_EVAL_NOTATION},{code:"$146",display:c.b.$146,meaning:u.a.trans("Novelty"),action:d.ADD_EVAL_NOTATION}],p=(u.a.trans("Clear All Analysis"),d.CLEAR_ANALYSIS,u.a.trans("Insert Continuation"),d.CREATE_CONTINUATION,u.a.trans("Insert Alternate Line"),d.CREATE_VARIATION,u.a.trans("Delete Comment After"),d.DELETE_COMMENT,l.AFTER,u.a.trans("Delete Comment Before"),d.DELETE_COMMENT,l.BEFORE,u.a.trans("Delete Entire Variation"),d.DELETE_LINE,u.a.trans("Delete Move"),d.DELETE_MOVE,u.a.trans("Comment After"),d.INSERT_COMMENT,l.AFTER,u.a.trans("Comment Before"),d.INSERT_COMMENT,l.BEFORE,u.a.trans("Move Variation Down"),d.MOVE_VARIATION_DOWN,u.a.trans("Move Variation Up"),d.MOVE_VARIATION,u.a.trans("Promote"),d.PROMOTE_VARIATION,u.a.trans("Remove Annotation"),d.REMOVE_ANNOTATION,u.a.trans("Remove Begin"),d.REMOVE_BEGIN,u.a.trans("Remove End"),d.REMOVE_END,u.a.trans("Remove Evaluation Annotation"),d.REMOVE_EVAL_ANNOTATION,u.a.trans("Remove Focus"),d.REMOVE_FOCUS,u.a.trans("Set Begin"),d.SET_BEGIN,u.a.trans("Set End"),d.SET_END,u.a.trans("Set Focus"),d.SET_FOCUS,d.SET_BEGIN,d.SET_END,d.SET_FOCUS,d.REMOVE_BEGIN,d.REMOVE_END,d.REMOVE_FOCUS,{BEGIN:"begin",END:"end",FOCUS:"focus"});r={},s()(r,d.SET_BEGIN,p.BEGIN),s()(r,d.SET_END,p.END),s()(r,d.SET_FOCUS,p.FOCUS),o={},s()(o,d.REMOVE_BEGIN,p.BEGIN),s()(o,d.REMOVE_END,p.END),s()(o,d.REMOVE_FOCUS,p.FOCUS),a=[],f.forEach((function(e){var t=a[a.length-1]||null;t&&4!==t.length?t.push(e):a.push([e])}))},"./web/core/api/move-list/move-list.js":function(e,t,n){"use strict";n.r(t),n.d(t,"nodeProps",(function(){return i}));var r=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=n.n(r),a=n("./chessboard/src/game/line.js"),i=["additionalAnnotation","annotation","arrows","color","comment","commentBefore","fen","flags","from","ids","lines","moveNumber","piece","previous","promotion","san","time","to"];t.default=function moveList(){var e,t={lines:[]};return{state:t,updateLines:function updateLines(n){t.lines=o()(n),(n||[]).forEach((function(r,o){e=a.a.isContinuation(n,r.id),t.lines[o]=r.map((function(t){var n={};return i.forEach((function(e){void 0!==t[e]&&(n[e]=t[e])})),e&&0===t.ids.move&&(n.commentBefore=r.initComment),n})),t.lines[o].atMoveNode=r.atMoveNode,t.lines[o].id=r.id,t.lines[o].parentId=r.parentId}))}}}()},"./web/core/base/boot/board/board-default.js":function(e,t,n){"use strict";n.r(t);var r=n("./chessboard/src/components/chessboard/style/style.config.js"),o=n("./chessboard/src/components/chessboard/coordinates.vue"),a=n("./chessboard/src/components/chessboard/marked-arrow.vue"),i=n("./chessboard/src/components/chessboard/marked-effect.vue"),s=n("./chessboard/src/components/config.js"),c={props:{color:{type:String,default:"#ffa704"},files:{type:Number,default:s.a.defaultBoardOptions.files},flipped:{type:Boolean,default:!1},fileRank:{type:Object,required:!0},ranks:{type:Number,default:s.a.defaultBoardOptions.ranks},squareSize:{type:Number,required:!0}},computed:{transform:function transform(){var e=this.fileRank;return this.flipped&&(e={file:this.files+1-this.fileRank.file,rank:this.ranks+1-this.fileRank.rank}),{width:this.squareSize,height:this.squareSize,position:{x:(e.file-1)*this.squareSize,y:(this.ranks-e.rank)*this.squareSize}}}}},u=(n("./chessboard/src/components/chessboard/custom-item.vue?vue&type=style&index=0&lang=scss&"),n("./node_modules/vue-loader/lib/runtime/componentNormalizer.js")),l=Object(u.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"transition"}},[n("svg",{staticClass:"item-container",style:{left:e.transform.position.x+"px",top:e.transform.position.y+"px"},attrs:{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",width:e.transform.width+"px",height:e.transform.height+"px",viewBox:"0 0 40 40"}},[n("path",{style:{fill:e.color},attrs:{d:"M23.12,17.84H16.4a1.11,1.11,0,0,1-1.06-1.43L18.7,5.21a1.11,1.11,0,0,1,2.13,0l3.36,11.2A1.11,1.11,0,0,1,23.12,17.84Z"}}),e._v(" "),n("path",{style:{fill:e.color},attrs:{d:"M27.21,34.11,4.35,16.88a1.11,1.11,0,0,1,.67-2l17.89,0a1.11,1.11,0,0,1,1.06.8l5,17.19A1.11,1.11,0,0,1,27.21,34.11Z"}}),e._v(" "),n("path",{style:{fill:e.color},attrs:{d:"M35.17,16.88,12.31,34.11a1.11,1.11,0,0,1-1.74-1.2l5-17.19a1.11,1.11,0,0,1,1.06-.8l17.89,0A1.11,1.11,0,0,1,35.17,16.88Z"}})])])}),[],!1,null,null,null).exports,d=n("./chessboard/src/components/chessboard/standalone/shared/mixins/chessboard.mixin.js"),f=n("./chessboard/src/components/chessboard/standalone/shared/formatters/index.js"),p=n("./chessboard/src/components/chessboard/standalone/shared/helpers/position.helpers.js"),m=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),h=n.n(m),g=n("./chessboard/src/components/chessboard/standalone/core/actions/index.js"),b=n("./chessboard/src/components/chessboard/standalone/core/index.js"),v=n("./chessboard/src/components/chessboard/standalone/core/config.js"),E=n("./chessboard/src/components/chessboard/standalone/default/dom/index.js"),_=n("./chessboard/src/components/chessboard/standalone/shared/dom/update-board-classes.js"),y=n("./chessboard/src/components/chessboard/standalone/extensions/usersnap-logger/index.js");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){h()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={name:"ChessBoard",mixins:[d.a],components:{CustomItem:l,Coordinates:o.a,MarkedArrow:a.a,MarkedEffect:i.a},computed:{coordColors:function coordColors(){return{white:r.a[this.options.boardStyle][1],black:r.a[this.options.boardStyle][0]}}},methods:{createChessboard:function createChessboard(){return function createChessboard(e,t){return new Promise((function(n){var r=Object(b.a)(_objectSpread(_objectSpread({},t),{},{usersnapLogger:y.a})),o={close:function close(){return r.dispatch(g.b.CANCEL_PROMOTION)},select:function select(e){return r.dispatch(g.b.SELECT_PROMOTION_PIECE,e)}};r.on(v.b.ADD_LEGAL_MOVES,(function(t){return E.a(e,r.state,t)})),r.on(v.b.ADD_PIECES,(function(t){return E.b(e,r.emit,r.state,t)})),r.on(v.b.ADD_SQUARES,(function(t){return E.c(e,r.state,t.type,t.moveSquares)})),r.on(v.b.BLINK_SQUARE,(function(t){return E.d(e,t)})),r.on(v.b.CLOSE_PROMOTION_MENU,(function(){return E.e(e)})),r.on(v.b.DRAG_PIECE,(function(e){return E.h(e)})),r.on(v.b.DROP_PIECE,(function(e){return E.i(r.emit,e)})),r.on(v.b.FADE_PIECES,(function(){return E.j(e,r.state)})),r.on(v.b.FLIP_BOARD,(function(){return E.k(e,r.state)})),r.on(v.b.MOVE_PIECES,(function(t){return E.n(e,r.emit,r.state,t)})),r.on(v.b.OPEN_PROMOTION_MENU,(function(t){return E.o(e,r.state,o,t)})),r.on(v.b.PICK_UP_PIECE,(function(e){return E.p(r.emit,e)})),r.on(v.b.REMOVE_LEGAL_MOVES,(function(){return E.m(e)})),r.on(v.b.REMOVE_SQUARES,(function(t){return E.r(e,t.type,t.squares)})),r.on(v.b.REMOVE_PIECES,(function(t){return E.q(e,r.emit,t)})),r.on(v.b.SET_PIECE,(function(e){return E.s(e.piece,e.fileRank)})),r.on(v.b.SET_PIECES,(function(t){return E.t(e,r.emit,r.state,t)})),r.on(v.b.SET_SQUARES,(function(t){return E.u(e,r.state,t)})),r.on(v.b.SHOW_HOVER_SQUARE,(function(t){return E.v(e,t)})),r.on(v.b.HIDE_HOVER_SQUARE,(function(t){return E.l(e,t)})),r.on(v.b.UPDATE_BOARD_CLASSES,(function(t){return Object(_.a)(e,t)})),r.on(v.b.UPDATE_BOARD_IMAGE,(function(){return E.w(e,r.state)})),r.on(v.b.UPDATE_BOARD_SIZE,(function(){return E.x(e,r.state)})),r.on(v.b.UPDATE_PIECE_IMAGES,(function(){return E.y(e,r.state)})),r.on(v.b.UPDATE_PROMOTION_MENU_SIZE,(function(){return E.z(e,r.state)})),E.f(e),n(r)}))}(this.$el,this.extensions)},getDomFormatters:function getDomFormatters(){return f.c(p.d)}}},S=n("./chessboard/src/components/chessboard/standalone/default/chessboard.vue?vue&type=style&index=0&lang=scss&module=true&");var P=Object(u.a)(O,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"board v-board",attrs:{tabindex:"-1",id:e.boardId}},[e.initialized&&e.options.coordinates?n("coordinates",{attrs:{colors:e.coordColors,position:e.options.coordinates,"board-style":e.options.boardStyle,flipped:e.options.flipBoard,size:e.squareSize}}):e._e(),e._v(" "),n("div",{staticClass:"arrows-container"},e._l(e.arrows,(function(t){return n("marked-arrow",{key:""+t.fromFileRank.file+t.fromFileRank.rank+t.toFileRank.file+t.toFileRank.rank,attrs:{"additional-styles":t.additionalStyles,"square-size":e.squareSize,files:e.game.setup.files,ranks:e.game.setup.ranks,flipped:e.options.flipBoard,"from-file-rank":t.fromFileRank,"to-file-rank":t.toFileRank,color:t.color,opacity:t.opacity}})})),1),e._v(" "),e._l(e.effects,(function(t){return n("marked-effect",{key:""+t.square.file+t.square.rank,attrs:{"additional-styles":t.additionalStyles,files:e.game.setup.files,flipped:e.options.flipBoard,position:t.position,ranks:e.game.setup.ranks,square:t.square,"square-size":e.squareSize,template:t.template}})})),e._v(" "),e._l(e.customItems,(function(t){return n("custom-item",{key:""+t.fileRank.file+t.fileRank.rank,attrs:{"square-size":e.squareSize,files:e.game.setup.files,ranks:e.game.setup.ranks,flipped:e.options.flipBoard,"file-rank":t.fileRank}})}))],2)}),[],!1,(function injectStyles(e){this.$style=S.default.locals||S.default}),null,null).exports;window.chesscom=window.chesscom||{},window.chesscom.chessBoard||(window.chesscom.chessBoard=P),window.chesscom.defaultChessBoard=P},14:function(e,t,n){e.exports=n("./web/core/base/boot/board/board-default.js")},"dll-reference vueDLL":function(e,t){e.exports=vueDLL}});